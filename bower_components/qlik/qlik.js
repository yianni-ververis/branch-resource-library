/*!
* Copyright(C) 2015
* Qlik International AB
* All Rights Reserved
*/
define("js/configloader",{load:function(a,b,c){b(["assets/general/require-config"],function(){b([a],function(a){c(a)})})}}),define("js/qlik-impl",["qvangular","translator","core.models/app","core.models/rpc-session","core.utils/deferred","workbench/mashupapi/qglobal","workbench/mashupapi/qapp","client.utils/state","general.utils/touch-configuration-util","general.models/library/extension-list","general.services/content-api/content-api","qlikui/components","general.utils/qv-activate","general.utils/qv-swipe","general.utils/qv-longtapswipe","objects/object","client.views/current-selections/current-selections"],function(a,b,c,d,e,f,g,h,i,j,k){function l(){t||(t=!0,i.configureTouchSupport(),h.setState(h.States.analysis),h.setView(h.Views.sheet),b.setup())}function m(a){q=a,g.setErrorCallback(a)}function n(a){return a&&a.backendApi?new g(a.backendApi.model.session.currentApp):(r||(r=new g(c.current)),r)}function o(b,d){l();var e=b;return d&&(e+="/"+d.host+d.identity?"/"+d.identity:""),s[e]?s[e]:(a.$apply(a.$rootScope,function(){var a=c.getSync(b,d,!0);if(a){a.waitForOpen.promise.then(null,function(a){q&&(q(a.error),a.isHandled=!0)});var f=new g(a);f.close=function(){return delete s[e],a.close()},s[e]=f}}),s[e])}function p(a){return new f(a)}var q,r,s={},t=!1,u={openApp:o,currApp:n,getGlobal:p,setOnError:m,getAppList:function(b,e){a.$apply(a.$rootScope,function(){var a=d.get("?transient=",e);a.open(),c.getList(a).then(function(c){b(c),a.close()})})},resize:function(a){pubsub.publish(a?"/ui/object/resize."+a:"/resize/end")},getExtensionList:function(a){var b=new e;return j.getList().then(function(c){a&&a(c),b.resolve(c)}),b.promise},callRepository:function(a,b,c){return k.request({method:b||"GET",url:a,data:c})}};return define("qlik",u),u}),define("js/qlik",["js/configloader!js/qlik-impl"],function(a){return a}),/**
 * @license AngularJS v1.2.15
 * (c) 2010-2014 Google, Inc. http://angularjs.org
 * License: MIT
 */
function(a,b,c){b.module("ngAnimate",["ng"]).factory("$$animateReflow",["$$rAF","$document",function(a,b){var c=b[0].body;return function(b){return a(function(){c.offsetWidth+1;b()})}}]).config(["$provide","$animateProvider",function(d,e){function f(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.nodeType==l)return c}}function g(a){return b.element(f(a))}function h(a,b){return f(a)==f(b)}var i=b.noop,j=b.forEach,k=e.$$selectors,l=1,m="$$ngAnimateState",n="ng-animate",o={running:!0};d.decorator("$animate",["$delegate","$injector","$sniffer","$rootElement","$$asyncCallback","$rootScope","$document",function(a,c,d,l,p,q){function r(a){if(a){var b=[],e={},f=a.substr(1).split(".");(d.transitions||d.animations)&&f.push("");for(var g=0;g<f.length;g++){var h=f[g],i=k[h];i&&!e[h]&&(b.push(c.get(i)),e[h]=!0)}return b}}function s(a,c,d){function e(a,b){var c=a[b],d=a["before"+b.charAt(0).toUpperCase()+b.substr(1)];return c||d?("leave"==b&&(d=c,c=null),v.push({event:b,fn:c}),s.push({event:b,fn:d}),!0):void 0}function f(b,c,e){function f(a){if(c){if((c[a]||i)(),++l<g.length)return;c=null}e()}var g=[];j(b,function(a){a.fn&&g.push(a)});var l=0;j(g,function(b,e){var g=function(){f(e)};switch(b.event){case"setClass":c.push(b.fn(a,h,k,g));break;case"addClass":c.push(b.fn(a,h||d,g));break;case"removeClass":c.push(b.fn(a,k||d,g));break;default:c.push(b.fn(a,g))}}),c&&0===c.length&&e()}var g=a[0];if(g){var h,k,l="setClass"==c,m=l||"addClass"==c||"removeClass"==c;b.isArray(d)&&(h=d[0],k=d[1],d=h+" "+k);var n=a.attr("class"),o=n+" "+d;if(z(o)){var p=i,q=[],s=[],t=i,u=[],v=[],w=(" "+o).replace(/\s+/g,".");return j(r(w),function(a){var b=e(a,c);!b&&l&&(e(a,"addClass"),e(a,"removeClass"))}),{node:g,event:c,className:d,isClassBased:m,isSetClassOperation:l,before:function(a){p=a,f(s,q,function(){p=i,a()})},after:function(a){t=a,f(v,u,function(){t=i,a()})},cancel:function(){q&&(j(q,function(a){(a||i)(!0)}),p(!0)),u&&(j(u,function(a){(a||i)(!0)}),t(!0))}}}}}function t(a,c,d,e,f,g,h){function i(b){var e="$animate:"+b;u&&u[e]&&u[e].length>0&&p(function(){d.triggerHandler(e,{event:a,className:c})})}function k(){i("before")}function l(){i("after")}function o(){i("close"),h&&p(function(){h()})}function q(){q.hasBeenRun||(q.hasBeenRun=!0,g())}function r(){if(!r.hasBeenRun){r.hasBeenRun=!0;var b=d.data(m);b&&(t&&t.isClassBased?v(d,c):(p(function(){var b=d.data(m)||{};H==b.index&&v(d,c,a)}),d.data(m,b))),o()}}var t=s(d,a,c);if(!t)return q(),k(),l(),void r();c=t.className;var u=b.element._data(t.node);u=u&&u.events,e||(e=f?f.parent():d.parent());var y=d.data(m)||{},z=y.active||{},A=y.totalActive||0,B=y.last,C=t.isClassBased?y.disabled||B&&!B.isClassBased:!1;if(C||w(d,e))return q(),k(),l(),void r();var D=!1;if(A>0){var E=[];if(t.isClassBased){if("setClass"==B.event)E.push(B),v(d,c);else if(z[c]){var F=z[c];F.event==a?D=!0:(E.push(F),v(d,c))}}else if("leave"==a&&z["ng-leave"])D=!0;else{for(var G in z)E.push(z[G]),v(d,G);z={},A=0}E.length>0&&j(E,function(a){a.cancel()})}if(!t.isClassBased||t.isSetClassOperation||D||(D="addClass"==a==d.hasClass(c)),D)return k(),l(),void o();"leave"==a&&d.one("$destroy",function(){var a=b.element(this),c=a.data(m);if(c){var d=c.active["ng-leave"];d&&(d.cancel(),v(a,"ng-leave"))}}),d.addClass(n);var H=x++;A++,z[c]=t,d.data(m,{last:t,active:z,index:H,totalActive:A}),k(),t.before(function(b){var e=d.data(m);b=b||!e||!e.active[c]||t.isClassBased&&e.active[c].event!=a,q(),b===!0?r():(l(),t.after(r))})}function u(a){var c=f(a);if(c){var d=b.isFunction(c.getElementsByClassName)?c.getElementsByClassName(n):c.querySelectorAll("."+n);j(d,function(a){a=b.element(a);var c=a.data(m);c&&c.active&&j(c.active,function(a){a.cancel()})})}}function v(a,b){if(h(a,l))o.disabled||(o.running=!1,o.structural=!1);else if(b){var c=a.data(m)||{},d=b===!0;!d&&c.active&&c.active[b]&&(c.totalActive--,delete c.active[b]),(d||!c.totalActive)&&(a.removeClass(n),a.removeData(m))}}function w(a,b){if(o.disabled)return!0;if(h(a,l))return o.disabled||o.running;do{if(0===b.length)break;var c=h(b,l),d=c?o:b.data(m),e=d&&(!!d.disabled||d.running||d.totalActive>0);if(c||e)return e;if(c)return!0}while(b=b.parent());return!0}var x=0;l.data(m,o),q.$$postDigest(function(){q.$$postDigest(function(){o.running=!1})});var y=e.classNameFilter(),z=y?function(a){return y.test(a)}:function(){return!0};return{enter:function(b,c,d,e){this.enabled(!1,b),a.enter(b,c,d),q.$$postDigest(function(){b=g(b),t("enter","ng-enter",b,c,d,i,e)})},leave:function(b,c){u(b),this.enabled(!1,b),q.$$postDigest(function(){t("leave","ng-leave",g(b),null,null,function(){a.leave(b)},c)})},move:function(b,c,d,e){u(b),this.enabled(!1,b),a.move(b,c,d),q.$$postDigest(function(){b=g(b),t("move","ng-move",b,c,d,i,e)})},addClass:function(b,c,d){b=g(b),t("addClass",c,b,null,null,function(){a.addClass(b,c)},d)},removeClass:function(b,c,d){b=g(b),t("removeClass",c,b,null,null,function(){a.removeClass(b,c)},d)},setClass:function(b,c,d,e){b=g(b),t("setClass",[c,d],b,null,null,function(){a.setClass(b,c,d)},e)},enabled:function(a,b){switch(arguments.length){case 2:if(a)v(b);else{var c=b.data(m)||{};c.disabled=!0,b.data(m,c)}break;case 1:o.disabled=!a;break;default:a=!o.disabled}return!!a}}}]),e.register("",["$window","$sniffer","$timeout","$$animateReflow",function(d,e,g,h){function k(a,b){J&&J(),W.push(b),J=h(function(){j(W,function(a){a()}),W=[],J=null,U={}})}function m(a,c){var d=f(a);a=b.element(d),Z.push(a);var e=Date.now()+1e3*c;Y>=e||(g.cancel(X),Y=e,X=g(function(){n(Z),Z=[]},c,!1))}function n(a){j(a,function(a){var b=a.data(P);b&&(b.closeAnimationFn||i)()})}function o(a,b){var c=b?U[b]:null;if(!c){var e,f,g,h,i=0,k=0,m=0,n=0;j(a,function(a){if(a.nodeType==l){var b=d.getComputedStyle(a)||{};g=b[E+K],i=Math.max(p(g),i),h=b[E+L],e=b[E+M],k=Math.max(p(e),k),f=b[G+M],n=Math.max(p(f),n);var c=p(b[G+K]);c>0&&(c*=parseInt(b[G+N],10)||1),m=Math.max(c,m)}}),c={total:0,transitionPropertyStyle:h,transitionDurationStyle:g,transitionDelayStyle:e,transitionDelay:k,transitionDuration:i,animationDelayStyle:f,animationDelay:n,animationDuration:m},b&&(U[b]=c)}return c}function p(a){var c=0,d=b.isString(a)?a.split(/\s*,\s*/):[];return j(d,function(a){c=Math.max(parseFloat(a)||0,c)}),c}function q(a){var b=a.parent(),c=b.data(O);return c||(b.data(O,++V),c=V),c+"-"+f(a).className}function r(a,b,c,d){var e=q(b),f=e+" "+c,g=U[f]?++U[f].total:0,h={};if(g>0){var j=c+"-stagger",k=e+" "+j,l=!U[k];l&&b.addClass(j),h=o(b,k),l&&b.removeClass(j)}d=d||function(a){return a()},b.addClass(c);var m=b.data(P)||{},n=d(function(){return o(b,f)}),p=n.transitionDuration,r=n.animationDuration;if(0===p&&0===r)return b.removeClass(c),!1;b.data(P,{running:m.running||0,itemIndex:g,stagger:h,timings:n,closeAnimationFn:i});var s=m.running>0||"setClass"==a;return p>0&&t(b,c,s),r>0&&h.animationDelay>0&&0===h.animationDuration&&u(b),!0}function s(a){return"ng-enter"==a||"ng-move"==a||"ng-leave"==a}function t(a,b,c){s(b)||!c?f(a).style[E+L]="none":a.addClass(Q)}function u(a){f(a).style[G]="none 0s"}function v(a){var b=E+L,c=f(a);c.style[b]&&c.style[b].length>0&&(c.style[b]=""),a.removeClass(Q)}function w(a){var b=G,c=f(a);c.style[b]&&c.style[b].length>0&&(c.style[b]="")}function x(a,b,c,d){function e(){b.off(t,g),b.removeClass(k),C(b,c);var a=f(b);for(var d in v)a.style.removeProperty(v[d])}function g(a){a.stopPropagation();var b=a.originalEvent||a,c=b.$manualTimeStamp||b.timeStamp||Date.now(),e=parseFloat(b.elapsedTime.toFixed(R));Math.max(c-s,0)>=r&&e>=p&&d()}var h=f(b),i=b.data(P);if(-1==h.className.indexOf(c)||!i)return void d();var k="";j(c.split(" "),function(a,b){k+=(b>0?" ":"")+a+"-active"});var l=i.stagger,n=i.timings,o=i.itemIndex,p=Math.max(n.transitionDuration,n.animationDuration),q=Math.max(n.transitionDelay,n.animationDelay),r=q*T,s=Date.now(),t=H+" "+F,u="",v=[];if(n.transitionDuration>0){var w=n.transitionPropertyStyle;-1==w.indexOf("all")&&(u+=I+"transition-property: "+w+";",u+=I+"transition-duration: "+n.transitionDurationStyle+";",v.push(I+"transition-property"),v.push(I+"transition-duration"))}if(o>0){if(l.transitionDelay>0&&0===l.transitionDuration){var x=n.transitionDelayStyle;u+=I+"transition-delay: "+y(x,l.transitionDelay,o)+"; ",v.push(I+"transition-delay")}l.animationDelay>0&&0===l.animationDuration&&(u+=I+"animation-delay: "+y(n.animationDelayStyle,l.animationDelay,o)+"; ",v.push(I+"animation-delay"))}if(v.length>0){var z=h.getAttribute("style")||"";h.setAttribute("style",z+" "+u)}b.on(t,g),b.addClass(k),i.closeAnimationFn=function(){e(),d()};var A=o*(Math.max(l.animationDelay,l.transitionDelay)||0),B=(q+p)*S,D=(A+B)*T;return i.running++,m(b,D),e}function y(a,b,c){var d="";return j(a.split(","),function(a,e){d+=(e>0?",":"")+(c*b+parseInt(a,10))+"s"}),d}function z(a,b,c,d){return r(a,b,c,d)?function(a){a&&C(b,c)}:void 0}function A(a,b,c,d){return b.data(P)?x(a,b,c,d):(C(b,c),void d())}function B(a,b,c,d){var e=z(a,b,c);if(!e)return void d();var f=e;return k(b,function(){v(b,c),w(b),f=A(a,b,c,d)}),function(a){(f||i)(a)}}function C(a,b){a.removeClass(b);var c=a.data(P);c&&(c.running&&c.running--,c.running&&0!==c.running||a.removeData(P))}function D(a,c){var d="";return a=b.isArray(a)?a:a.split(/\s+/),j(a,function(a,b){a&&a.length>0&&(d+=(b>0?" ":"")+a+c)}),d}var E,F,G,H,I="";a.ontransitionend===c&&a.onwebkittransitionend!==c?(I="-webkit-",E="WebkitTransition",F="webkitTransitionEnd transitionend"):(E="transition",F="transitionend"),a.onanimationend===c&&a.onwebkitanimationend!==c?(I="-webkit-",G="WebkitAnimation",H="webkitAnimationEnd animationend"):(G="animation",H="animationend");var J,K="Duration",L="Property",M="Delay",N="IterationCount",O="$$ngAnimateKey",P="$$ngAnimateCSS3Data",Q="ng-animate-block-transitions",R=3,S=1.5,T=1e3,U={},V=0,W=[],X=null,Y=0,Z=[];return{enter:function(a,b){return B("enter",a,"ng-enter",b)},leave:function(a,b){return B("leave",a,"ng-leave",b)},move:function(a,b){return B("move",a,"ng-move",b)},beforeSetClass:function(a,b,c,d){var e=D(c,"-remove")+" "+D(b,"-add"),f=z("setClass",a,e,function(d){var e=a.attr("class");a.removeClass(c),a.addClass(b);var f=d();return a.attr("class",e),f});return f?(k(a,function(){v(a,e),w(a),d()}),f):void d()},beforeAddClass:function(a,b,c){var d=z("addClass",a,D(b,"-add"),function(c){a.addClass(b);var d=c();return a.removeClass(b),d});return d?(k(a,function(){v(a,b),w(a),c()}),d):void c()},setClass:function(a,b,c,d){c=D(c,"-remove"),b=D(b,"-add");var e=c+" "+b;return A("setClass",a,e,d)},addClass:function(a,b,c){return A("addClass",a,D(b,"-add"),c)},beforeRemoveClass:function(a,b,c){var d=z("removeClass",a,D(b,"-remove"),function(c){var d=a.attr("class");a.removeClass(b);var e=c();return a.attr("class",d),e});return d?(k(a,function(){v(a,b),w(a),c()}),d):void c()},removeClass:function(a,b,c){return A("removeClass",a,D(b,"-remove"),c)}}}])}])}(window,window.angular),define("angular-animate",["angular"],function(a){return function(){var b,c;return c=function(a){return a.module("ngAnimate")},b=c.apply(a,arguments)}}(this)),define("assets/qvangular/qvangular-core",["jquery","angular-animate","angular-sanitize","angular"],function(a){function b(a){return function(){var b=Array.prototype.slice.apply(arguments);m.$rootScope.$$phase?a.apply(this,b):m.$rootScope.$apply(function(){a.apply(this,b)})}}var c,d,e,f,g,h,i,j,k,l=window.angular,m={};m.module=l.module("qvangularmodule",["ngAnimate","ngSanitize"],["$provide","$compileProvider","$filterProvider","$animateProvider",function(a,b,c,d){g=a,h=b,i=c,d.classNameFilter(/\bqv-animate\b/i),a.value("$anchorScroll",function(){})}]);var n=Object.keys(window.qvangularNgModules||[]),o=(window.angular.mock?["ngMock","qvangularmodule"]:["qvangularmodule"]).concat(n);return c=l.bootstrap(document,o),c.invoke(["$rootScope","$compile","$controller","$timeout","$q",function(a,b,c,g,h){d=a,e=b,f=c,j=g,k=h}]),m.directive=function(a,b){h.directive(a,b)},m.filter=function(a,b){i.register(a,b)},m.service=function(a,b){return g.service(a,b),c.get(a)},m.provider=function(a,b){return g.provider(a,b)},a.fn.showComponent=function(a,b){return"string"==typeof a?m.injectComponent(this,{template:a,controller:b||function(){}},{}):m.injectComponent(this,a,b)},m.injectComponent=function(b,g,h){var i;if(!g)throw"Trying to show undefined component.";if("function"==typeof g)return g.apply({},[b,h]);if(Array.isArray(g)){var j={$element:b,input:h};for(var k in h)h.hasOwnProperty(k)&&(j[k]=h[k]);return c.invoke(g,{},j)}if(g.controller){var l=a(b).scope();return l||(l=d),m.$apply(l,function(){var a=l.$new();a.extractComponent=function(){a.$$destroyed||(a.$destroy(),b.off(".qvangularcoreshowcomponent"),b.html(""))},a.destroyComponent=a.extractComponent;var c={$scope:a,$element:b,$transclude:void 0,input:h};for(var d in h)h.hasOwnProperty(d)&&(c[d]=h[d],a[d]=h[d]);b.html(g.template);var j=e(b.contents());g.controller&&(i=f(g.controller,c),b.contents().data("$ngControllerController",i)),j(a),b.on("remove.qvangularcoreshowcomponent",function(){a.$$destroyed||a.$destroy()})}),i}},m.componentDirective=function(a,b,c){var d={};for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);d[a]="=",d.input="=",d.component="=",m.directive(a,["$http","$templateCache","$compile","$controller",function(a,b,e,f){return{restrict:"EA",replace:!0,terminal:!0,scope:d,link:function(a,b,d){var g,h=0;a.$watch("component",function(i){var j=++h;if(i||(i=c),i&&i.template){if(j!==h)return;g&&g.$destroy(),g=a.$new(),b.html(i.template);var k=e(b.contents()),m={$scope:g,$element:b,$attrs:d};if(a.input&&i.scope&&l.forEach(i.scope,function(b,c){g[c]=a.input[c];var d=g[c];g.$watch(function(){var b=a.input[c];return b!==g[c]&&(b!==d?d=g[c]=b:a.input[c]=d=g[c]),b})}),a.input){for(var n in a.input)a.input.hasOwnProperty(n)&&(m[n]=a.input[n]);m.input=a.input}if(i.controller){var o=f(i.controller,m);b.contents().data("$ngControllerController",o)}k(g)}else g&&(g.$destroy(),g=null),b.html("")})}}}])},m.componentType=m.componentDirective,m.componentDirective("qvaInclude",{ngModel:"="}),m.$apply=function(a,b){b?a.$root.$$phase?b&&b():a.$apply(b):(b=a,"function"==typeof b?m.$rootScope.$$phase?b():m.$rootScope.$apply(b):b&&b.$apply&&(m.$rootScope.$$phase||a.$apply()))},m.defer=function(){return k.defer()},m.when=function(a,b,c){return k.when(a,b,c)},m.promise=function(a){return j(function(){return a})},m.getService=function(a){return c.get(a)},m.$injector=c,m.$rootScope=d,m.$applyify=b,window.qvangularGlobal=m,m}),define("assets/qvangular/qvangular-locale",["assets/qvangular/qvangular-core","translator"],function(a,b){a.directive("qPlaceholder",function(){return{restrict:"A",link:function(a,c,d){d.ngDisabled?a.$watch(d.ngDisabled,function(a){a?c.attr("placeholder",""):c.attr("placeholder",b.get(d.qPlaceholder))}):c.attr("placeholder",b.get(d.qPlaceholder))}}}),a.directive("qSimpleTranslation",function(){return{restrict:"A",link:function(a,c,d){function e(a){c.text(b.get(a))}b.ready.then(function(){d.$observe("qTranslation",e)})}}}),a.directive("qTranslation",function(){return{restrict:"A",link:function(a,c,d){function e(a){var e,f,g,h=a.split(","),i=JSON.parse(d.qHtmlTranslationIndexes||"null"),j=i?"html":"text",k=h[0].indexOf("|");for(f=k>=0&&h.length>=2?"1"===h[1]?h[0].substring(0,k).trim():h[0].substring(k+1).trim():h[0],e=b.get(f),i&&h.push.apply(h,i),g=1;g<h.length;g++)e=e.replace("{"+(g-1)+"}",h[g]);c[j](e)}b.ready.then(function(){d.$observe("qTranslation",e),e(d.qTranslation)})}}}),a.directive("translate",function(){return function(a,c,d){function e(a){a?"string"==typeof a?(c.attr("data-translation",a),c.removeAttr("data-text")):(c.attr("data-translation",a.id),c.data("text",{value:a.value})):(c.removeAttr("data-translation"),c.removeAttr("data-text")),b.apply(c[0])}a.$watch(d.translate,e)}}),a.directive("qTitleTranslation",function(){return{restrict:"A",link:function(a,c,d){function e(a){c.attr("title",b.get(a))}b.ready.then(function(){d.$observe("qTitleTranslation",e)})}}}),a.filter("translate",function(){return function(a){return b.get(a)}}),a.filter("translatetoupper",function(){return function(a){return b.get(a).toUpperCase()}})}),define("assets/qvangular/qvangular-filters",["assets/qvangular/qvangular-core"],function(a){a.filter("qvCropString",function(){function a(a,b){return"undefined"!=typeof b&&a.length>b&&(a=a.substr(0,b)+"..."),a}return a}),a.filter("qvOptStringExpression",function(){function a(a){return"object"==typeof a&&(a=a.qStringExpression.qExpr,a.length&&"="===a[0]||(a="="+a)),a}return a}),a.filter("qvToArray",function(){return function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b}})}),define("assets/qvangular/qvangular-highlight/highlight",["general.utils/string-normalization","util","encoder"],function(a,b,c){function d(){return{scope:{text:"@",query:"="},restrict:"EA",replace:!0,link:function(b,c){b.$watchCollection("[text, query]",function(){var e=a.string(b.query);if(!e)return void c.text(b.text);var f=d.highlightMatches(a.string(b.text),e,"qui-texthighlight",b.text);c.html(f)})}}}return d.highlightMatches=function(a,b,e,f){return d.markMatches(a,b,f).map(function(a){return a.match?"<span "+c.encodeForAttr("class",e)+">"+c.encodeForHTML(a.text)+"</span>":c.encodeForHTML(a.text)}).join("")},d.markMatches=function(a,c,d){d=d||a;for(var e=[],f=0,g=new RegExp(b.escapeRegExp(c),"gi");;){var h=g.exec(a);if(!h){f<a.length&&e.push({text:d.substring(f),match:!1});break}h.index>f&&e.push({text:d.substring(f,h.index),match:!1}),e.push({text:d.substring(h.index,g.lastIndex),match:!0}),f=g.lastIndex}return e},d}),define("general.utils/dom-util",["jquery"],function(a){var b={};return b.getParentElementWithAttribute=function(a,b,c){for(var d=!1,e=0;a&&a.parentNode&&100>e&&!d;){if(e++,a.nodeName===b.toUpperCase()&&a.hasAttribute(c))return d=!0,a;a=a.parentNode}return d?void 0:null},b.getAncestorsUntil=function(a,b){var c=[];for(b||(b=function(){return!1});a&&a.parentNode&&!b(a);)c.push(a),a=a.parentNode;return c},b.isInput=function(a){return a&&("INPUT"===a.tagName||"SELECT"===a.tagName||"TEXTAREA"===a.tagName||a.isContentEditable)},b.elementFromEventPosition=function(a){var b=document,c=b.body,d=a.pageX+(b&&b.clientLeft||c&&c.clientLeft||0)-(b&&b.scrollLeft||c&&c.scrollLeft||0),e=a.pageY+(b&&b.clientTop||c&&c.clientTop||0)-(b&&b.scrollTop||c&&c.scrollTop||0);return document.elementFromPoint(d,e)},b.scrollElmentIntoView=function(b,c,d){var e;if(e=c instanceof a?c:b.closest(c),e.length){var f,g=e.offset().top,h=g+e.height(),i=b.offset().top,j=i+b.outerHeight();f=b[0].getBoundingClientRect().top,d?(f-=e.height()/2,e.scrollTop(e.scrollTop()+f)):j>h&&(f=j-h,e.scrollTop(e.scrollTop()+f))}},b.getAction=function(b,c,d){var e,f,g,h=(d?a(b.target).closest("[data-action]"):a(b.target).parent())[0];return b.target.getAttribute("data-action")?(e=b.target.getAttribute("data-action"),f=a(b.target)):h&&h.getAttribute("data-action")&&(e=h.getAttribute("data-action"),f=a(h)),e&&c&&(g=a(f.closest(c)).scope()),{action:e,element:f,scope:g}},b}),define("assets/qvangular/qvangular-directives",["jquery","assets/qvangular/qvangular-core","assets/qvangular/qvangular-highlight/highlight","general.utils/dom-util","touche"],function(a,b,c,d,e){function f(a,c){b.directive(a,["$parse",function(b){return function(d,e,f){for(var g=f[a].split(";"),h=0;h<g.length;h++){var i=g[h].trim().split("#"),j=i[0],k=b(i[1]);!function(a,b){e.on(c,j,function(a){d.$apply(function(){b(d,{$event:a})})})}(j,k)}}}])}function g(b,c,d){return["$parse",function(e){return{restrict:"A",link:function(f,g,h){var i=e(h[b]),j=function(a){c&&c!==a.which||setTimeout(function(){a.preventDefault(),f.$apply(function(){i(f,{$event:a})})})};a(d?d:g).bind("keydown",j),f.$on("$destroy",function(){a(d?d:g).unbind("keydown",j)})}}}]}b.directive("qvaBlur",["$parse",function(a){return function(c,d,e){var f=a(e.qvaBlur);d.bind("blur",function(a){b.$apply(c,function(){f(c,{$event:a})})})}}]),b.directive("qvaDblclick",["$parse",function(a){return function(b,c,d){var f=a(d.qvaDblclick),g="qva-dblclick"+b.$id;e(c[0]).doubletap({id:g,options:{timeThreshold:250,preventDefault:!1},end:function(){b.$apply(f)}}),b.$on("$destroy",function(){e(c[0]).off("doubletap",g)})}}]),b.directive("qvaDblclick",["$parse",function(a){return function(b,c,d){var f=a(d.qvaDblclick),g="qva-dblclick"+b.$id;e(c[0]).doubletap({id:g,options:{timeThreshold:250,preventDefault:!1},end:function(){b.$apply(f)}}),b.$on("$destroy",function(){e(c[0]).off("doubletap",g)})}}]),b.directive("qvaActivate",["$parse",function(b){return function(c,d,e){var f=b(e.qvaActivate);d.on("qv-activate keypress",function(b){var d="keypress"===b.type&&32===b.which;("keypress"!==b.type||d&&a(b.target).is(":input"))&&c.$apply(function(){f(c,{$event:b})})})}}]),b.directive("qvaScrollIntoView",["$timeout",function(a){return{restrict:"A",link:function(b,c,e){b.$watch(e.qvaScrollIntoView,function(b){b.scrollSelector&&b.scroll&&a(function(){d.scrollElmentIntoView(c,b.scrollSelector)})},!0)}}}]),b.directive("qvaPress",["$parse",function(a){return function(b,c,d){var e=a(d.qvaPress);c.on("qv-press",function(a){b.$apply(function(){e(b,{$event:a})})})}}]),b.directive("qvaContextMenu",["$parse",function(a){return function(b,c,d){var e=a(d.qvaContextMenu);c.bind("qv-contextmenu",function(a){b.$apply(function(){e(b,{$event:a})})})}}]),b.directive("qvaRadialContextMenu",["$parse",function(a){return function(b,c,d){var e=a(d.qvaRadialContextMenu);c.bind("qv-radial-contextmenu",function(a){b.$apply(function(){e(b,{$event:a})})})}}]),b.directive("qvaSwipeUpdate",["$parse",function(a){return function(b,c,d){var e=a(d.qvaSwipeUpdate);c.bind("qv-swipeupdate",function(a){b.$apply(function(){e(b,{$event:a,$element:c})})})}}]),b.directive("qvaSwipe",["$parse",function(a){return function(b,c,d){var e=a(d.qvaSwipe);c.bind("qv-swipe",function(a){b.$apply(function(){e(b,{$event:a,$element:c})})})}}]),b.directive("qvaLoad",["$parse",function(a){return function(b,c,d){var e=a(d.qvaLoad);c.on("load",function(a){b.$apply(function(){e(b,{$event:a})})})}}]),f("qvaDelegatedClick","click"),f("qvaDelegatedActivate","qv-activate"),b.directive("indeterminate",["$parse",function(){return function(a,b,c){var d=c.indeterminate;b.prop("indeterminate",d===!0||"true"===d),a.$watch(c.indeterminate,function(a){b.prop("indeterminate",a===!0||"true"===a)})}}]),b.directive("qvaOutside",["$parse",function(b){return function(c,d,e){var f=b(e.qvaOutside),g=!1,h=!1;d.bind("qv-outside",function(b){g="allOutside"===a(b.target).attr("qva-outside-ignore-for")||a(b.target).closest('[qva-outside-ignore-for="allOutside"]').length,h=a(b.target).data("overrideignore"),(!g||h)&&(e.qvaOutsideIgnoreFor&&e.qvaOutsideIgnoreFor===a(b.target).closest("[qva-outside-ignore-for]").attr("qva-outside-ignore-for")||c.$apply(function(){f(c,{$event:b})}))})}}]),b.directive("qvaOnDragstart",["$parse",function(b){return function(c,d,e){if("ondragstart"in window){var f=b(e.qvaOnDragstart);c.$watch(e.qvaDragDisabled,function(b){b||d.attr("draggable","true").addClass("draggable").on("dragstart",function(b){a(this).addClass("dragging"),f(c,{$event:b})}).on("dragend",function(){a(this).removeClass("dragging")}).on("selectstart",function(a){var b=a.originalEvent.target;b.dragDrop&&b.dragDrop()}).on("mousedown","button",function(a){a.preventDefault()})})}}}]),b.directive("qvaModelOnblur",function(){return{restrict:"A",require:"ngModel",priority:1,link:function(a,b,c,d){"radio"!==c.type&&"checkbox"!==c.type&&(b.unbind("input keydown change compositionend"),b.bind("blur",function(){a.$apply(function(){"undefined"!=typeof c.qvaCancelEditingOnEmpty&&""===b.val().trim()?b.val(d.$modelValue):d.$setViewValue(b.val())})}),b.bind("keydown",function(a){27===a.which?(a.stopPropagation(),b.val(d.$modelValue),b.closest("*[tabindex]").focus()):13===a.which&&(a.stopPropagation(),b.closest("*[tabindex]").focus())}))}}}),b.directive("qvaSelect",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){(0===d.qvaSelect.length||"true"===d.qvaSelect)&&a(function(){"ontouchstart"in window||c[0].select()})}}}]),b.directive("qvaSelectWatch",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.qvaSelectWatch,function(b){(""===d.qvaSelectWatch||""!==d.qvaSelectWatch&&b===!0)&&a(function(){"ontouchstart"in window||c[0].select()})},!0)}}}]),b.directive("qvaFocus",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.qvaFocus,function(b){b===!0&&a(function(){c[0].focus()})},!0)}}}]),b.directive("qveHighlight",c),b.directive("qvaReportedWindowSize",function(){return{restrict:"A",link:function(c,d,e){function f(){b.$apply(function(){c[e.qvaReportedWindowSize]={width:a(window).width(),height:a(window).height()}})}f(),a(window).bind("resize",f),c.$on("$destroy",function(){a(window).unbind("resize",f)})}}}),b.directive("qvGlobalKeydown",g("qvGlobalKeydown",void 0,a("body"))),b.directive("qvGlobalEscape",g("qvGlobalEscape",27,a("body"))),b.directive("qvGlobalEnter",g("qvGlobalEnter",13,a("body"))),b.directive("qvKeydown",g("qvKeydown",void 0)),b.directive("qvEscape",g("qvEscape",27)),b.directive("qvEnter",g("qvEnter",13))}),define("qvangular",["assets/qvangular/qvangular-core","assets/qvangular/qvangular-locale","assets/qvangular/qvangular-filters","assets/qvangular/qvangular-directives"],function(a){return a}),define("core.utils/deferred",["qvangular"],function(a){var b,c;return b=a.getService("$q"),c=function(){var a=b.defer();return a},c.resolve=function(a){var c=b.defer();return c.resolve(a),c.promise},c.reject=b.reject,c.all=b.all,c.when=b.when,c}),define("core.utils/class",[],function(){var a=/xyz/.test(function(){})?/\b_super\b/:/.*/,b=function(){};return b.extend=function c(b,d){var e=this.prototype;"string"!=typeof b&&(d=b,b="Class");var f=Object.create(this.prototype);for(var g in d)f[g]="function"==typeof d[g]&&"function"==typeof e[g]&&a.test(d[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,d[g]):d[g];if(!/^[_a-z][_a-z\d]*$/i.test(b))throw new Error("Invalid subclass name. Alphanumericals only.");var h=new Function("return (function "+b+"(){ typeof this.init === 'function' && this.init.apply(this, [].slice.call(arguments)) });")();return h.prototype=f,h.prototype.constructor=h,h.extend=c,h},b}),define("core.utils/errors",["core.utils/class"],function(a){var b={};return Error.extend=function(b,c){var d=c.init||function(){};return c.init=function(){var a,c;this.stack=null,a=new Error,a.stack&&(c=a.stack.split("\n"),c.splice(1,2),c[0]=this.constructor.name,this.stack=c.join("\n")),this.name=b,d.apply(this,arguments)},a.extend.call(Error,b,c)},b.ArgumentError=Error.extend("ArgumentError",{init:function(a,b){this.message=b||"Invalid argument '"+a+"'."}}),b.ConflictError=Error.extend("ConflictError",{init:function(a){this.message=a||"This version is out of date"}}),b.ValidationError=Error.extend("ValidationError",{init:function(a,b){this.message=b||"Validation failed",Object.defineProperty(this,"errors",{value:a.errors})}}),b}),Function.prototype.curry=function(){var a=this,b=Array.prototype.slice.call(arguments);return function(){return a.apply(this,b.concat(Array.prototype.slice.call(arguments)))}},"undefined"==typeof Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{enumerable:!1,get:function(){var a=this.toString().match(/^function( (.*?))?\(/);return a&&a.length>=3?a[2]:"anonymous function"}}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Array.from=function(a){return Array.prototype.slice.call(a)},Array.prototype.unique||Object.defineProperty(Array.prototype,"unique",{enumerable:!1,value:function(a){var b,c,d=[],e=this.length;for(b=0;e>b;b++){for(c=b+1;e>c;c++)(a&&a(this[b],this[c])||!a&&this[b]===this[c])&&(c=++b);d.push(this[b])}return d}}),Array.prototype.contains||Object.defineProperty(Array.prototype,"contains",{enumerable:!1,value:function(a){return-1!==this.indexOf(a)}}),Array.prototype.lastElement||Object.defineProperty(Array.prototype,"lastElement",{enumerable:!1,get:function(){return this.length>0?this[this.length-1]:void 0}}),"scrollX"in window.constructor.prototype||Object.defineProperties(window.constructor.prototype,{scrollX:{get:function(){return this.pageXOffset}},scrollY:{get:function(){return this.pageYOffset}}}),define("core.utils/augment",function(){}),define("core.utils/notification",["core.utils/errors","core.utils/augment"],function(a){var b,c,d=!1,e=a.ArgumentError,f=a.ConflictError;return b=function(a,b){if(d!==!0)throw new Error("This class can't be instantiated directly.");this.observers=[],this.receiver=a,Object.defineProperty(this,"name",{get:function(){return b}})},b.prototype.bind=function(a){if("function"!=typeof a)throw new e("observer","Observer must be a function.");if(a===b.prototype.emit)throw new e("observer","Observer cannot be proxied this way. Use a wrapper function.");this.observers.push(a)},b.prototype.once=function(a){function b(){c.unbind(b),a.apply(c.receiver,arguments)}var c=this;b.onceObserver=a,c.bind(b)},b.prototype.unbind=function(a){var b;b=this.observers.reduce(function(b,c,d){return-1!==b?b:c===a||c.onceObserver===a?d:-1},-1),-1!==b&&this.observers.splice(b,1)},b.prototype.emit=function(){var a=this.receiver,b=Array.from(arguments);this.observers.forEach(function(c){c.apply(a,b)})},b.prototype.release=function(){var a=this.receiver;delete a[this.name],Object.keys(c.prototype).forEach(function(b){delete a[b]}),this.receiver=null,this.observers=null},b.create=function(a,c){if(!a)throw new e("receiver","Not a valid receiver.");if("string"!=typeof c)throw new e("name","Nofification name not optional.");if(!/^([A-Z][a-z]+)+$/.test(c))throw new e("name","The notification name must be PascalCased.");if(c in a)throw new f("A property named '"+c+"' is already present on the receiver.");return d=!0,a[c]=new b(a,c),d=!1,a[c]},b.mixin=function(a){if(!a)throw new e("receiver","Not a valid receiver.");Object.keys(c.prototype).forEach(function(b){if(b in a)throw new f("A property named '"+b+"' is already present on the receiver.");a[b]=c.prototype[b]})},b.release=function(a){Object.keys(a).forEach(function(c){var d=a[c];d instanceof b&&d.release()})},c={prototype:{notification:function(a){return b.create(this,a)}}},b}),define("core.utils/json-patch",["jquery"],function(a){function b(a,b){return l(a[b])||"$$"===b.substring(0,2)||"_"===b.substring(0,1)}function c(a,b){var c,d="/",e=b.substring(1).split(d).slice(0,-1);return e.forEach(function(b,d){d!==e.length&&(c=+b,a=a[c||b]=k(a[c||b])?isNaN(c)?{}:[]:a[b])}),a}function d(a){Object.keys(a).forEach(function(c){var d=Object.getOwnPropertyDescriptor(a,c);d.configurable&&!b(a,c)&&delete a[c]})}function e(a,b){var c,d,f=!0;if(i(a)&&i(b))return Object.keys(a).length!==Object.keys(b).length?!1:(Object.keys(a).forEach(function(c){return e(a[c],b[c])?void 0:(f=!1,!1)}),f);if(j(a)&&j(b)){if(a.length!==b.length)return!1;for(c=0,d=a.length;d>c;c++)if(!e(a[c],b[c]))return!1;return!0}return a===b}function f(a,b,c){function d(a,b,c){if(a[c]&&k(a[c].qInfo))return null;if(a[c]&&a[c].qInfo.qId===b)return c;for(var d=0,e=a.length;e>d;d++)if(a[d]&&a[d].qInfo.qId===b)return d;return-1}var f,h,i=[],j=a.slice(),l=-1;if(e(b,j))return i;if(!k(b[0])&&k(b[0].qInfo))return i.push({op:"replace",path:c,value:b}),i;for(f=j.length-1;f>=0;--f)l=d(b,j[f].qInfo&&j[f].qInfo.qId,f),-1===l?(i.push({op:"remove",path:c+"/"+f}),j.splice(f,1)):i=i.concat(g.generate(j[f],b[l],c+"/"+f));for(f=0,h=b.length;h>f;++f)l=d(j,b[f].qInfo&&b[f].qInfo.qId),-1===l?(i.push({op:"add",path:c+"/"+f,value:b[f]}),j.splice(f,0,b[f])):l!==f&&(i.push({op:"move",path:c+"/"+f,from:c+"/"+l}),j.splice(f,0,j.splice(l,1)[0]));return i}var g={},h=function(){a.extend.apply(a,[!0].concat(Array.prototype.slice.call(arguments)))
},i=a.isPlainObject,j=Array.isArray,k=function(a){return"undefined"==typeof a},l=function(a){return"function"==typeof a};return g.generate=function(a,c,d){d=d||"";var l=[];return Object.keys(c).forEach(function(h){var m=c[h],n=a[h],o=d+"/"+h;e(m,n)||b(c,h)||(k(n)?l.push({op:"add",path:o,value:m}):i(m)&&i(n)?l=l.concat(g.generate(n,m,o)):j(m)&&j(n)?l=l.concat(f(n,m,o)):l.push({op:"replace",path:d+"/"+h,value:m}))}),Object.keys(a).forEach(function(e){k(c[e])&&!b(a,e)&&l.push({op:"remove",path:d+"/"+e})}),l.forEach(function(a){if("undefined"!=typeof a.value){var b={};h(b,{value:a.value}),a.value=b.value}}),l},g.apply=function(a,b){b.forEach(function(b){var e=c(a,b.path),f=b.path.split("/").splice(-1)[0],g=f&&isNaN(+f)?e[f]:e[+f]||e,k=b.from?b.from.split("/").splice(-1)[0]:null;"add"===b.op||"replace"===b.op?j(e)?("-"===f&&(f=e.length),e.splice(+f,"add"===b.op?0:1,b.value)):j(g)&&j(b.value)?(g.length=0,g.push.apply(g,b.value)):i(g)&&i(b.value)?(d(g),h(g,b.value)):e[f]=b.value:"move"===b.op?j(e)?e.splice(+f,0,e.splice(+k,1)[0]):(e[f]=e[k],delete e[k]):"remove"===b.op&&(j(e)?e.splice(+f,1):delete e[f])})},g.updateObject=function(a,b){return Object.keys(a).length?void g.apply(a,g.generate(a,b)):void h(a,b)},g}),define("core.utils/debug-flags",["util"],function(a){var b=(a.getParameterByName("debug")||"").split("+"),c={};return b.forEach(function(a){c[a.toUpperCase()]=!0}),c}),define("core.utils/permissions",[],function(){function a(a,b){return a.length||(a=["update","publish","export","exportdata","changeowner","delete"]),e&&(a=[]),b=b||{},b.update=a.contains("update"),b.publish=a.contains("publish"),b["export"]=a.contains("export"),b.exportData=a.contains("exportdata"),b.changeOwner=a.contains("changeowner"),b.remove=a.contains("delete"),b}function b(a,b){b=b||{};for(var c in b)delete b[c];return e?b:(a.forEach(function(a){a.canCreate&&(b["create"+a.resource[0].toUpperCase()+a.resource.substring(1)]=!0)}),b)}function c(c,f){var g={};return c.permissions||Object.defineProperty(c,"permissions",{configurable:!1,enumerable:!1,get:function(){return c&&(f&&(e=c.qReadOnly,b(c.create||d,g)),a(c.privileges||c.qMeta&&c.qMeta.privileges||[],g)),g}}),c}var d=[{resource:"sheet",canCreate:!0},{resource:"bookmark",canCreate:!0},{resource:"story",canCreate:!0},{resource:"dimension",canCreate:!0},{resource:"measure",canCreate:!0},{resource:"masterobject",canCreate:!0}],e=!0;return{mapToLayout:c,parse:a,parseCreate:b}}),define("autogenerated/qix/engine-enums",[],function(){return{NxLocalizedErrorCode:{LOCERR_INTERNAL_ERROR:-128,LOCERR_GENERIC_UNKNOWN:-1,LOCERR_GENERIC_OK:0,LOCERR_GENERIC_NOT_SET:1,LOCERR_GENERIC_NOT_FOUND:2,LOCERR_GENERIC_ALREADY_EXISTS:3,LOCERR_GENERIC_INVALID_PATH:4,LOCERR_GENERIC_ACCESS_DENIED:5,LOCERR_GENERIC_OUT_OF_MEMORY:6,LOCERR_GENERIC_NOT_INITIALIZED:7,LOCERR_GENERIC_INVALID_PARAMETERS:8,LOCERR_GENERIC_EMPTY_PARAMETERS:9,LOCERR_GENERIC_INTERNAL_ERROR:10,LOCERR_GENERIC_CORRUPT_DATA:11,LOCERR_GENERIC_MEMORY_INCONSISTENCY:12,LOCERR_GENERIC_INVISIBLE_OWNER_ABORT:13,LOCERR_GENERIC_PROHIBIT_VALIDATE:14,LOCERR_GENERIC_ABORTED:15,LOCERR_GENERIC_CONNECTION_LOST:16,LOCERR_GENERIC_UNSUPPORTED_IN_PRODUCT_VERSION:17,LOCERR_HTTP_400:400,LOCERR_HTTP_401:401,LOCERR_HTTP_402:402,LOCERR_HTTP_403:403,LOCERR_HTTP_404:404,LOCERR_HTTP_405:405,LOCERR_HTTP_406:406,LOCERR_HTTP_407:407,LOCERR_HTTP_408:408,LOCERR_HTTP_409:409,LOCERR_HTTP_410:410,LOCERR_HTTP_411:411,LOCERR_HTTP_412:412,LOCERR_HTTP_413:413,LOCERR_HTTP_414:414,LOCERR_HTTP_415:415,LOCERR_HTTP_416:416,LOCERR_HTTP_417:417,LOCERR_HTTP_500:500,LOCERR_HTTP_501:501,LOCERR_HTTP_502:502,LOCERR_HTTP_503:503,LOCERR_HTTP_504:504,LOCERR_HTTP_505:505,LOCERR_HTTP_509:509,LOCERR_APP_ALREADY_EXISTS:1e3,LOCERR_APP_INVALID_NAME:1001,LOCERR_APP_ALREADY_OPEN:1002,LOCERR_APP_NOT_FOUND:1003,LOCERR_APP_IMPORT_FAILED:1004,LOCERR_APP_SAVE_FAILED:1005,LOCERR_APP_CREATE_FAILED:1006,LOCERR_APP_INVALID:1007,LOCERR_APP_CONNECT_FAILED:1008,LOCERR_APP_ALREADY_OPEN_IN_DIFFERENT_MODE:1009,LOCERR_CONNECTION_ALREADY_EXISTS:2e3,LOCERR_CONNECTION_NOT_FOUND:2001,LOCERR_CONNECTION_FAILED_TO_LOAD:2002,LOCERR_CONNECTION_FAILED_TO_IMPORT:2003,LOCERR_CONNECTION_NAME_IS_INVALID:2004,LOCERR_FILE_ACCESS_DENIED:3e3,LOCERR_FILE_NAME_INVALID:3001,LOCERR_FILE_CORRUPT:3002,LOCERR_FILE_NOT_FOUND:3003,LOCERR_FILE_FORMAT_UNSUPPORTED:3004,LOCERR_USER_ACCESS_DENIED:4e3,LOCERR_USER_IMPERSONATION_FAILED:4001,LOCERR_SERVER_OUT_OF_SESSION_AND_USER_CALS:5e3,LOCERR_SERVER_OUT_OF_SESSION_CALS:5001,LOCERR_SERVER_OUT_OF_USAGE_CALS:5002,LOCERR_SERVER_OUT_OF_CALS:5003,LOCERR_SERVER_OUT_OF_NAMED_CALS:5004,LOCERR_SERVER_OFF_DUTY:5005,LOCERR_SERVER_BUSY:5006,LOCERR_SERVER_LICENSE_EXPIRED:5007,LOCERR_SERVER_AJAX_DISABLED:5008,LOCERR_HC_INVALID_OBJECT:6e3,LOCERR_HC_RESULT_TOO_LARGE:6001,LOCERR_HC_INVALID_OBJECT_STATE:6002,LOCERR_HC_MODAL_OBJECT_ERROR:6003,LOCERR_CALC_INVALID_DEF:7e3,LOCERR_CALC_NOT_IN_LIB:7001,LOCERR_CALC_HEAP_ERROR:7002,LOCERR_CALC_TOO_LARGE:7003,LOCERR_CALC_TIMEOUT:7004,LOCERR_CALC_EVAL_CONDITION_FAILED:7005,LOCERR_CALC_MIXED_LINKED_AGGREGATION:7006,LOCERR_CALC_MISSING_LINKED:7007,LOCERR_CALC_INVALID_COL_SORT:7008,LOCERR_CALC_PAGES_TOO_LARGE:7009,LOCERR_CALC_SEMANTIC_FIELD_NOT_ALLOWED:7010,LOCERR_CALC_VALIDATION_STATE_INVALID:7011,LOCERR_CALC_PIVOT_DIMENSIONS_ALREADY_EXISTS:7012,LOCERR_LAYOUT_EXTENDS_INVALID_ID:8e3,LOCERR_LAYOUT_LINKED_OBJECT_NOT_FOUND:8001,LOCERR_LAYOUT_LINKED_OBJECT_INVALID:8002,LOCERR_PERSISTENCE_WRITE_FAILED:9e3,LOCERR_PERSISTENCE_READ_FAILED:9001,LOCERR_PERSISTENCE_DELETE_FAILED:9002,LOCERR_PERSISTENCE_NOT_FOUND:9003,LOCERR_PERSISTENCE_UNSUPPORTED_VERSION:9004,LOCERR_SCRIPT_DATASOURCE_ACCESS_DENIED:1e4,LOCERR_RELOAD_IN_PROGRESS:11e3,LOCERR_PERSONAL_NEW_VERSION_AVAILABLE:12e3,LOCERR_PERSONAL_VERSION_EXPIRED:12001,LOCERR_PERSONAL_SECTION_ACCESS_DETECTED:12002,LOCERR_PERSONAL_APP_DELETION_FAILED:12003,LOCERR_EXPORT_OUT_OF_MEMORY:13e3,LOCERR_EXPORT_NO_DATA:13001,LOCERR_SYNC_INVALID_OFFSET:14e3,LOCERR_SEARCH_TIMEOUT:15e3,LOCERR_DIRECT_DISCOVERY_LINKED_EXPRESSION_FAIL:16e3,LOCERR_DIRECT_DISCOVERY_ROWCOUNT_OVERFLOW:16001,LOCERR_DIRECT_DISCOVERY_EMPTY_RESULT:16002,LOCERR_DIRECT_DISCOVERY_DB_CONNECTION_FAILED:16003,LOCERR_DIRECT_DISCOVERY_MEASURE_NOT_ALLOWED:16004,LOCERR_DIRECT_DISCOVERY_DETAIL_NOT_ALLOWED:16005,LOCERR_DIRECT_DISCOVERY_NOT_SYNTH_CIRCULAR_ALLOWED:16006,LOCERR_JSON_RPC_INVALID_REQUEST:-32600,LOCERR_JSON_RPC_METHOD_NOT_FOUND:-32601,LOCERR_JSON_RPC_INVALID_PARAMETERS:-32602,LOCERR_JSON_RPC_INTERNAL_ERROR:-32603,LOCERR_JSON_RPC_PARSE_ERROR:-32700},NxLocalizedWarningCode:{LOCWARN_PERSONAL_RELOAD_REQUIRED:0,LOCWARN_PERSONAL_VERSION_EXPIRES_SOON:1,LOCWARN_EXPORT_DATA_TRUNCATED:1e3},NxLocalizedMessageCode:{LOCMSG_SCRIPTEDITOR_EMPTY_MESSAGE:0,LOCMSG_SCRIPTEDITOR_PROGRESS_SAVING_STARTED:1,LOCMSG_SCRIPTEDITOR_PROGRESS_BYTES_LEFT:2,LOCMSG_SCRIPTEDITOR_PROGRESS_STORING_TABLES:3,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_ROWS_SO_FAR:4,LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECTED:5,LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECTING_TO:6,LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECT_FAILED:7,LOCMSG_SCRIPTEDITOR_PROGRESS_OLD_QVD_ROWISH:8,LOCMSG_SCRIPTEDITOR_PROGRESS_NEW_OVD_COLUMNAR:9,LOCMSG_SCRIPTEDITOR_ERROR:10,LOCMSG_SCRIPTEDITOR_DONE:11,LOCMSG_SCRIPTEDITOR_LOAD_EXTERNAL_DATA:12,LOCMSG_SCRIPTEDITOR_PROGRESS_OLD_QVD_ISLOADING:13,LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_LOADING:14,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_BUFFERED:15,LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_PREPARING:16,LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_APPENDING:17,LOCMSG_SCRIPTEDITOR_REMOVE_SYNTHETIC:18,LOCMSG_SCRIPTEDITOR_PENDING_LINKEDTABLE_FETCHING:19,LOCMSG_SCRIPTEDITOR_RELOAD:20,LOCMSG_SCRIPTEDITOR_LINES_FETCHED:21}}}),define("core.utils/authentication",["core.utils/deferred"],function(a){var b,c,d,e,f={},g=!1,h=new a;return f.parse=function(a){b=a.userId,c=a.userDirectory,g=a.mustAuthenticate,e=a.loginUri,d=a.logoutUri,g===!0&&(window.location.href=a.logoutUri),h.resolve(this)},f.onDataReceived=h.promise,Object.defineProperties(f,{userId:{get:function(){return b}},userDirectory:{get:function(){return c}},mustAuthenticate:{get:function(){return g}},loginUri:{get:function(){return e}},logoutUri:{get:function(){return d}}}),f}),define("core.models/rpc-base",["core.utils/deferred","core.utils/notification","core.utils/class","core.utils/json-patch","core.utils/debug-flags","core.utils/permissions","autogenerated/qix/engine-enums","core.utils/authentication"],function(a,b,c,d,e,f,g,h){function i(a,b){Array.isArray(b)?d.apply(a,b):d.updateObject(a,b)}var j,k,l=g.NxLocalizedErrorCode,m=["GetLayout","GetAppLayout","AbortModal","DoSave"];h.onDataReceived.then(function(a){"NONE"!==a.userDirectory&&(j=a.userId,k=a.userDirectory)});var n=c.extend("RPCBase",{init:function(a){var c=this;b.mixin(c),c.notification("Validated"),c.notification("Invalidated"),c.notification("Aborted"),c.notification("Validating"),c.notification("Closed"),c.notification("Closing"),c.notification("Cancelled"),c.id=a.id,c.session=a.session,c.handle=a.handle,c.layout={},c._properties={},c.properties={},c.propertyTree={},c.ongoingRequests={},c.needCacheProperties=!0,c.setState(n.States.INVALID),f.mapToLayout(c.layout,a.checkCreate),"App"!==c.constructor.name&&c.bindToRPC()},bindToRPC:function(){var a=this;a.session.onChange(a.handle,a.changeHandler.bind(a)),a.Aborted.bind(a.clearPending.bind(a)),a.Cancelled.bind(a.clearPending.bind(a))},changeHandler:function(){var a=this;a.clearPending(),a.needCacheProperties=!0,a.isCancelled||a.setState(n.States.INVALID)},clearPending:function(){for(var a in this.ongoingRequests)delete this.ongoingRequests[a]},publish:function(){return this.layout.permissions.publish?this.rpc("Publish"):a.reject("permission denied")},unpublish:function(){var b=this,c=a();return b.getLayout().then(function(a){return!a.qMeta.published||a.qMeta.approved||a.qMeta.owner.userId!==j||a.qMeta.owner.userDirectory!==k?c.reject("permission denied"):void b.rpc("UnPublish").then(function(a){c.resolve(a)})}),c.promise},setState:function(a){var b=this,c=b.state;delete this.__layoutRPCId,b.state=a,c!==b.state&&(a===n.States.INVALID?b.Invalidated.emit():a===n.States.VALID?b.Validated.emit():a===n.States.ABORTED?b.Aborted.emit():a===n.States.VALIDATING?b.Validating.emit():a===n.States.CLOSED?b.Closed.emit():a===n.States.CLOSING?b.Closing.emit():a===n.States.CANCELLED&&b.Cancelled.emit())},getLayout:function(b,c){function d(a){return e.DELTA&&h&&window.console.info("[DBGFLG:DELTA] APPLY ["+g.constructor.name+"]:",a),i(g.layout,a),g.setState(n.States.VALID),g.layout}function f(b){return b.error.code!==l.LOCERR_GENERIC_ABORTED||g.isCancelled||(g.setState(n.States.ABORTED),b.isHandled=!0),a.reject(b)}var g=this,h=!0;if(g.isValid||g.isCancelled)return a.resolve(g.layout);if(b=b||"GetLayout",c=c||"qLayout",g.isValidating||g.setState(n.States.VALIDATING),g.ongoingRequests[b+h])return g.ongoingRequests[b+h];var j=g.rpc(b,c,[],{delta:h}),k=j.then(d,f);return g.__layoutRPCId=j.rpcId,g.ongoingRequests[b+h]=k,k},getProperties:function(b){var c=this,e=!1;if(b=b||"GetProperties",c.isValid&&!c.needCacheProperties)return a.resolve(c.properties);if(c.ongoingRequests[b+e])return c.ongoingRequests[b+e];var f=c.rpc(b,"qProp",[],{delta:e}).then(function(a){var b=d.generate(c._properties,a);return c._properties=a,d.apply(c.properties,b),c.isValid&&(c.needCacheProperties=!1),c.properties});return c.ongoingRequests[b+e]=f,f},hasChanges:function(){var a=d.generate(this._properties,this.properties);return a.length>0},markAsInvalid:function(){this.state=-99,this.setState(n.States.INVALID)},getFullPropertyTree:function(a){var b=this,c=!1;return a=a||"GetFullPropertyTree",b.rpc(a,"qPropEntry",[],c).then(function(a){return b._propertyTree=a,i(b.propertyTree,a),b.propertyTree})},setProperties:function(a,b,c){var e=this;return b=b||"SetProperties",Array.isArray(a)||(a=[a]),this.rpc(b,null,a,c).then(function(){d.updateObject(e._properties,e.properties)})},setFullPropertyTree:function(a,b,c){return b=b||"SetFullPropertyTree",Array.isArray(a)||(a=[a]),this.rpc(b,null,a,c)},save:function(){return this.hasChanges()?this.setProperties(this.properties):a.resolve()},saveTree:function(){return this.setFullPropertyTree(this.propertyTree)},getChildInfos:function(){return this.rpc("GetChildInfos","qInfos",[])},close:function(b){var c=this;c.setState(n.States.CLOSING);var d=b||"App"===c.constructor.name?a.resolve():c.rpc("Close","qReturn",[]);delete c.session.changeHandlers[c.handle],delete c.session.modelCache[c.id];for(var e in c.ongoingRequests)c.ongoingRequests[e].then&&c.ongoingRequests[e].then(null,function(a){a.isHandled=!0});return d.then(function(){c.setState(n.States.CLOSED),setTimeout(function(){n.releaseModel(c)},5e3)})},rpc:function(b,c,d,e){e=e||{delta:!1,raw:!1};var f=this,g=[].slice.call(arguments);if(!f.handle&&"App"===f.constructor.name)return f.waitForOpen.promise.then(function(){return f.rpc.apply(f,g)});var h={method:b,handle:this.handle,params:d||[]};if(e.delta&&(h.delta=!0),!f.session||f.isClosing||f.isClosed)return a.reject();var i=f.session.rpc(h).then(function(a){return c?a.result[c]:e.raw?a:a.result},function(b){return b.error.code===l.LOCERR_HC_MODAL_OBJECT_ERROR?(b.isHandled=!0,f.session.currentApp.abortModal().then(function(){return f.rpc.apply(f,g)})):a.reject(b)});return m.indexOf(b)>-1&&(f.ongoingRequests[b+e.delta]=i,i["finally"](function(){delete f.ongoingRequests[b+e.delta]})),i.rpcId=h.id,i}});return n.releaseModel=function(a){b.release(a);for(var c in a)delete a[c]},n.getModel=function(b,c,d){function e(d){return delete c.modelCache[b],a.reject({error:{code:d,message:"No object with Id "+b+" found",parameter:b}})}var f=c.modelCache[b],g=this;return b?f?f:(f=d().then(function(a){var d=null!==a.qHandle?new g({id:b,session:c,handle:a.qHandle}):null;return d?d:e({error:{code:l.LOCERR_GENERIC_NOT_FOUND}})},e),c.modelCache[b]=f,f):a.reject("No ID given to RPCBase#getModel")},n.getLayout=function(a,b){return this.get(a,b).then(function(a){return a.getLayout().then(function(a){return a})})},n.getProperties=function(a,b){return this.get(a,b).then(function(a){return a.getProperties().then(function(){return a})})},n.extend=function(a,b){var d=c.extend.call(this,a,b);return d.bindLayout=n.bindLayout,d.releaseModel=n.releaseModel,d.getLayout=n.getLayout,d.getProperties=n.getProperties,d.getModel=n.getModel,d},Object.defineProperties(n.prototype,{isValid:{get:function(){return this.state===n.States.VALID}},isValidating:{get:function(){return this.state===n.States.VALIDATING}},isInvalid:{get:function(){return this.state===n.States.INVALID}},isAborted:{get:function(){return this.state===n.States.ABORTED}},isClosed:{get:function(){return this.state===n.States.CLOSED}},isClosing:{get:function(){return this.state===n.States.CLOSING}},isCancelled:{get:function(){return this.state===n.States.CANCELLED}}}),n.States={VALID:1,INVALID:2,VALIDATING:3,ABORTED:4,CLOSED:5,CLOSING:6,CANCELLED:7},n.bindLayout=function(a,b,c,d){function e(){var c=a.$eval(b);c&&c.Invalidated&&c.Invalidated.unbind(f)}b=b||"model";var f,g,h,i=function(){var d=this,e=this.getLayout();a.__layoutRPCId=e.rpcId,e.then(function(e){var f=a.$eval(b);f===d&&c&&c(e)})};return h=a.$on("$destroy",function(){e()}),g=a.$watch(b,function(a,b){b&&b!==a&&b.Invalidated&&b.Invalidated.unbind(f),!a||a.isClosing&&a.isClosed||(d&&d(a),a.getLayout().then(c),f=i.bind(a),a.Invalidated.bind(f))}),function(){e(),g(),h(),c&&(c=null),d&&(d=null)}},n}),/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */
function(a){function b(a,b,c,d,e){this._listener=b,this._isOnce=c,this.context=d,this._signal=a,this._priority=e||0}function c(a,b){if("function"!=typeof a)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))}function d(){this._bindings=[],this._prevParams=null;var a=this;this.dispatch=function(){d.prototype.dispatch.apply(a,arguments)}}b.prototype={active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,c),this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},d.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,c,d,e){var f,g=this._indexOfListener(a,d);if(-1!==g){if(f=this._bindings[g],f.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else f=new b(this,a,c,d,e),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,d){return c(a,"add"),this._registerListener(a,!1,b,d)},addOnce:function(a,b,d){return c(a,"addOnce"),this._registerListener(a,!0,b,d)},remove:function(a,b){c(a,"remove");var d=this._indexOfListener(a,b);return-1!==d&&(this._bindings[d]._destroy(),this._bindings.splice(d,1)),a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var e=d;e.Signal=d,"function"==typeof define&&define.amd?define("signals",[],function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:a.signals=e}(this),/** @license
 * crossroads <http://millermedeiros.github.com/crossroads.js/>
 * Author: Miller Medeiros | MIT License
 * v0.12.0 (2013/01/21 13:47)
 */
function(){var a=function(a){function b(a,b){if(a.indexOf)return a.indexOf(b);for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function c(a,c){var d=b(a,c);-1!==d&&a.splice(d,1)}function d(a,b){return"[object "+b+"]"===Object.prototype.toString.call(a)}function e(a){return d(a,"RegExp")}function f(a){return d(a,"Array")}function g(a){return"function"==typeof a}function h(a){var b;return b=null===a||"null"===a?null:"true"===a?!0:"false"===a?!1:a===o||"undefined"===a?o:""===a||isNaN(a)?a:parseFloat(a)}function i(a){for(var b=a.length,c=[];b--;)c[b]=h(a[b]);return c}function j(a,b){for(var c,d,e=(a||"").replace("?","").split("&"),f=e.length,g={};f--;)c=e[f].split("="),d=b?h(c[1]):c[1],g[c[0]]="string"==typeof d?decodeURIComponent(d):d;return g}function k(){this.bypassed=new a.Signal,this.routed=new a.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function l(b,c,d,f){var g=e(b),h=f.patternLexer;this._router=f,this._pattern=b,this._paramsIds=g?null:h.getParamIds(b),this._optionalParamsIds=g?null:h.getOptionalParamsIds(b),this._matchRegexp=g?b:h.compilePattern(b,f.ignoreCase),this.matched=new a.Signal,this.switched=new a.Signal,c&&this.matched.add(c),this._priority=d||0}var m,n,o;return n=""===/t(.+)?/.exec("t")[1],k.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new k},addRoute:function(a,b,c){var d=new l(a,b,c,this);return this._sortedInsert(d),d},removeRoute:function(a){c(this._routes,a),a._destroy()},removeAllRoutes:function(){for(var a=this.getNumRoutes();a--;)this._routes[a]._destroy();this._routes.length=0},parse:function(a,b){if(a=a||"",b=b||[],this.ignoreState||a!==this._prevMatchedRequest&&a!==this._prevBypassedRequest){var c,d=this._getMatchedRoutes(a),e=0,f=d.length;if(f)for(this._prevMatchedRequest=a,this._notifyPrevRoutes(d,a),this._prevRoutes=d;f>e;)c=d[e],c.route.matched.dispatch.apply(c.route.matched,b.concat(c.params)),c.isFirst=!e,this.routed.dispatch.apply(this.routed,b.concat([a,c])),e+=1;else this._prevBypassedRequest=a,this.bypassed.dispatch.apply(this.bypassed,b.concat([a]));this._pipeParse(a,b)}},_notifyPrevRoutes:function(a,b){for(var c,d=0;c=this._prevRoutes[d++];)c.route.switched&&this._didSwitch(c.route,a)&&c.route.switched.dispatch(b)},_didSwitch:function(a,b){for(var c,d=0;c=b[d++];)if(c.route===a)return!1;return!0},_pipeParse:function(a,b){for(var c,d=0;c=this._piped[d++];)c.parse(a,b)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(a){var b=this._routes,c=b.length;do--c;while(b[c]&&a._priority<=b[c]._priority);b.splice(c+1,0,a)},_getMatchedRoutes:function(a){for(var b,c=[],d=this._routes,e=d.length;(b=d[--e])&&((!c.length||this.greedy||b.greedy)&&b.match(a)&&c.push({route:b,params:b._getParamsArray(a)}),this.greedyEnabled||!c.length););return c},pipe:function(a){this._piped.push(a)},unpipe:function(a){c(this._piped,a)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},m=new k,m.VERSION="0.12.0",m.NORM_AS_ARRAY=function(a,b){return[b.vals_]},m.NORM_AS_OBJECT=function(a,b){return[b]},l.prototype={greedy:!1,rules:void 0,match:function(a){return a=a||"",this._matchRegexp.test(a)&&this._validateParams(a)},_validateParams:function(a){var b,c=this.rules,d=this._getParamsObject(a);for(b in c)if("normalize_"!==b&&c.hasOwnProperty(b)&&!this._isValidParam(a,b,d))return!1;return!0},_isValidParam:function(a,c,d){var h=this.rules[c],i=d[c],j=!1,k=0===c.indexOf("?");return null==i&&this._optionalParamsIds&&-1!==b(this._optionalParamsIds,c)?j=!0:e(h)?(k&&(i=d[c+"_"]),j=h.test(i)):f(h)?(k&&(i=d[c+"_"]),j=this._isValidArrayRule(h,i)):g(h)&&(j=h(i,a,d)),j},_isValidArrayRule:function(a,c){if(!this._router.ignoreCase)return-1!==b(a,c);"string"==typeof c&&(c=c.toLowerCase());for(var d,e,f=a.length;f--;)if(d=a[f],e="string"==typeof d?d.toLowerCase():d,e===c)return!0;return!1},_getParamsObject:function(a){for(var c,d,e=this._router.shouldTypecast,f=this._router.patternLexer.getParamValues(a,this._matchRegexp,e),g={},i=f.length;i--;)d=f[i],this._paramsIds&&(c=this._paramsIds[i],0===c.indexOf("?")&&d&&(g[c+"_"]=d,d=j(d,e),f[i]=d),n&&""===d&&-1!==b(this._optionalParamsIds,c)&&(d=void 0,f[i]=d),g[c]=d),g[i]=d;return g.request_=e?h(a):a,g.vals_=f,g},_getParamsArray:function(a){var b,c=this.rules?this.rules.normalize_:null;return c=c||this._router.normalizeFn,b=c&&g(c)?c(a,this._getParamsObject(a)):this._getParamsObject(a).vals_},interpolate:function(a){var b=this._router.patternLexer.interpolate(this._pattern,a);if(!this._validateParams(b))throw new Error("Generated string doesn't validate against `Route.rules`.");return b},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},k.prototype.patternLexer=function(){function a(){var a,b;for(a in n)n.hasOwnProperty(a)&&(b=n[a],b.id="__CR_"+a+"__",b.save="save"in b?b.save.replace("{{id}}",b.id):b.id,b.rRestore=new RegExp(b.id,"g"))}function b(a,b){var c,d=[];for(a.lastIndex=0;c=a.exec(b);)d.push(c[1]);return d}function c(a){return b(m,a)}function d(a){return b(n.OP.rgx,a)}function e(a,b){return a=a||"",a&&(r===o?a=a.replace(k,""):r===q&&(a=a.replace(l,"")),a=f(a,"rgx","save"),a=a.replace(j,"\\$&"),a=f(a,"rRestore","res"),r===o&&(a="\\/?"+a)),r!==p&&(a+="\\/?"),new RegExp("^"+a+"$",b?"i":"")}function f(a,b,c){var d,e;for(e in n)n.hasOwnProperty(e)&&(d=n[e],a=a.replace(d[b],d[c]));return a}function g(a,b,c){var d=b.exec(a);return d&&(d.shift(),c&&(d=i(d))),d}function h(a,b){if("string"!=typeof a)throw new Error("Route pattern should be a string.");var c=function(a,c){var d;if(c="?"===c.substr(0,1)?c.substr(1):c,null!=b[c]){if("object"==typeof b[c]){var e=[];for(var f in b[c])e.push(encodeURI(f+"="+b[c][f]));d="?"+e.join("&")}else d=String(b[c]);if(-1===a.indexOf("*")&&-1!==d.indexOf("/"))throw new Error('Invalid value "'+d+'" for segment "'+a+'".')}else{if(-1!==a.indexOf("{"))throw new Error("The segment "+a+" is required.");d=""}return d};return n.OS.trail||(n.OS.trail=new RegExp("(?:"+n.OS.id+")+$")),a.replace(n.OS.rgx,n.OS.save).replace(m,c).replace(n.OS.trail,"").replace(n.OS.rRestore,"/")}var j=/[\\.+*?\^$\[\](){}\/'#]/g,k=/^\/|\/$/g,l=/\/$/g,m=/(?:\{|:)([^}:]+)(?:\}|:)/g,n={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},o=1,p=2,q=3,r=o;return a(),{strict:function(){r=p},loose:function(){r=o},legacy:function(){r=q},getParamIds:c,getOptionalParamsIds:d,getParamValues:g,compilePattern:e,interpolate:h}}(),m};"function"==typeof define&&define.amd?define("crossroads",["signals"],a):"undefined"!=typeof module&&module.exports?module.exports=a(require("signals")):window.crossroads=a(window.signals)}(),define("general.controllers/route-controller",["crossroads","util"],function(a,b){function c(){n.forEach(function(a){a.dispose()}),m.forEach(function(a){e.addRoute(a)})}function d(){window.addEventListener("popstate",function(){var a=b.getParameterByName("app");return f&&f!==a?void(location.href=location.href):void e.parse()},!1)}if(location.pathname.match(/hub$/i))return void(location.href=location.href+"/");location.hash&&history.replaceState(null,null,location.href.replace("#!/",""));var e={},f=b.getParameterByName("app"),g=b.getParameterByName("language"),h=b.getParameterByName("theme"),i=b.getParameterByName("debug"),j=b.getParameterByName("noData"),k=[],l=[],m=[],n=[];return f&&k.push("app",f),g&&l.push("language",g),h&&l.push("theme",h),i&&l.push("debug",i),j&&l.push("noData",!0),e.isSuffixInUse=function(a){for(var b=0;b<l.length;b++)if(l[b]===a)return!0;return!1},e.removePartialSuffix=function(a){for(var b=!1,d=0;d<l.length;d++)if(l[d]===a){l.splice(d,2),b=!0;break}if(b){var f=location.href,g=new RegExp("/"+a+"/[^/]+","i");c(),g.test(f)&&(f=f.replace(g,""),e.setUrl(f))}return b},e.parse=function(b){a.parse(b||location.pathname)},e.addRoute=function(b){var c=this,d=b.pattern;m.push(b),b.isPartial&&("/"===d&&(d=""),d=c.buildUrl("replaceme").replace(location.protocol+"//"+location.host+"/","").replace("/replaceme",d));var e=a.addRoute(d,function(){c.lastRoute&&c.lastRoute!==b&&c.lastRoute.DeRoute.emit(),c.lastRoute=b,b.Route.emit.apply(b.Route,arguments)});n.push(e)},e.setUrl=function(a,c,d){c=!0;var f=location.href.toLowerCase().indexOf("?x-")>-1;f&&(a=a.replace(/\?x-.+?=[^&]+/i,"").replace("&","?")),0!==a.indexOf(b.baseURI)?location.href=a:a!==location.href&&(history[c?"replaceState":"pushState"](null,null,a),d||e.parse())},e.start=function(){this.setUrl(location.href),d(this),e.parse()},e.buildUrl=function(){var a,c=Array.apply(null,arguments),d="",e="";return c[0]===!0?(d=c[1],c=c.slice(2)):c.unshift.apply(c,k),l.length&&c.push.apply(c,l),c=c.map(function(a){return encodeURIComponent(a).replace(/'/g,"%27")}),e=d?b.baseURI.replace("/"+b.project+"/","/"+d+"/"):b.baseURI,a=e+c.join("/").replace(/[\/]+/g,"/")},e}),define("text!general.services/delayed-modal/delayed-modal.ng.html",[],function(){return'<div class="qui-delayedModal" on-close-view="closeView( $event )" qv-escape="handleEscButton( $event )" ng-style="modalStyle">\r\n	<header class="dm-header" ng-if="title" q-translation="{{title}}"></header>\r\n	<main ng-if="!html" class="dm-main"> <p class="dm-p" q-translation="{{content}}"></p> </main>\r\n	<main ng-if="html" class="dm-main qv-appname"></main>\r\n	<footer class="dm-footer">\r\n		<qui-button qv-delayed-dialog-button ng-if="!buttons.length && showDefaultButton" qva-activate="closeModal( $event, true );" qva-focus="true"\r\n					q-translation="Common.OK" tid="confirm"></qui-button>\r\n		<qui-button qv-delayed-dialog-button ng-repeat="button in buttons" qva-focus="button.defaultButton" qva-activate="closeModal( $event );" ng-disabled="button.expression === false"\r\n					q-translation="{{button.name}}" tid="{{button.tid}}"></qui-button>\r\n	</footer>\r\n</div>\r\n'}),define("general.services/delayed-modal/delayed-modal",["jquery","core.utils/deferred","qvangular","text!general.services/delayed-modal/delayed-modal.ng.html","angular"],function(a,b,c,d){var e,f=window.angular,g={"max-height":"90%","max-width":"90%","min-height":"180px",width:"400px"},h=!1,i=!1;c.directive("qvDelayedDialogButton",function(){return{replace:!0,restrict:"A",link:function(a){a.button&&a.button.defaultEscButton&&(e=a),a.closeModal=function(b,c){b&&(b.preventDefault(),b.stopPropagation()),a.button&&a.button.callback&&("undefined"==typeof a.button.expression||a.button.expression)&&a.button.callback(),(c||a.autoClose||a.button&&!a.button.callback)&&a.destroyModal()}}}}),c.service("$delayedModal",["$compile","$rootScope","$document",function(c,j,k){var l,m,n,o,p={},q=d,r={open:function(a){var d,r=new b;l&&(m=l,o=n),l=j.$new(),n=f.element('<div class="qv-modal-container qui-modalbackground-centered" qva-outside-ignore-for="allOutside" ng-style="containerStyle" ng-class="classes"></div>'),l.containerStyle={content:" "},l.classes={},l.modalStyle={};for(var s in g)l.modalStyle[s]=g[s];l.wasDisabled=[],l.showDefaultButton=!0,h=!0,i=!1,p=a,l.failed=!1,l.autoClose=!0;for(s in p)l[s]=p[s];return n.html(q).appendTo(k.find("body")),l.html&&n.find("main").append(l.html),d=l.$watch("element",function(){r.resolve(),d()}),l.element=c(n)(l),l.destroyModal=this.close.bind(this),l.handleEscButton=function(a){a&&(a.preventDefault(),a.stopPropagation()),l.buttons&&e?e&&e.closeModal():l.destroyModal()},l.$broadcast("delayed-modal-opened"),l.$watchCollection("[width, height]",function(){l.width&&(l.modalStyle.width=l.width),l.height&&(l.modalStyle.height=l.height)}),r.promise},update:function(a){if(h){for(var b in a)l[b]=a[b],p[b]=a[b];(a.html||a.buttons)&&(n.html(q),n.find("main").html(a.html),k.find("body").find(".qui-delayedModal").replaceWith(n.html()),l.element=c(n)(l))}},close:function(){l&&n&&(n.remove(),l.$destroy(),l.$broadcast("delayed-modal-closed"),l=m||null,n=o||null,m=o=null),h=!1,i=!1},lock:function(){i=!0,l.wasDisabled.length=0,l.element.find("button, input, textarea, select").each(function(){var b=a(this);b.prop("disabled")?l.wasDisabled.push(this):b.prop("disabled",!0)})},unlock:function(){i=!1,l.element.find("button, input, textarea, select").each(function(){-1===l.wasDisabled.indexOf(this)&&a(this).prop("disabled",!1)}),l.wasDisabled.length=0}};return Object.defineProperty(r,"isOpened",{get:function(){return h}}),Object.defineProperty(r,"isLocked",{get:function(){return i}}),Object.defineProperty(r,"scope",{get:function(){return l}}),r}])}),define("client.controllers/error-handler-controller",["jquery","qvangular","translator","autogenerated/qix/engine-enums","general.controllers/route-controller","general.services/delayed-modal/delayed-modal"],function(a,b,c,d,e){function f(b){if(!h){if(h=!0,"OnSessionLoggedOut"===b)return j={title:"Hub.OnSessionLoggedOut.title",content:"Hub.OnSessionLoggedOut.message",buttons:[{name:"Hub.OnSessionLoggedOut.button",defaultButton:!0,callback:function(){location.href=e.buildUrl(!0,"hub")}}],showDefaultButton:!1,classes:{"qs-e-dim":!0}},void c.ready.then(function(){g.open(j),g.scope.$on("delayed-modal-closed",function(){h=!1})});if(b.code===i.LOCERR_JSON_RPC_INVALID_PARAMETERS)return void(h=!1);var d=[{name:"Common.Close",defaultEscButton:!0,defaultButton:!0,callback:function(){var a=null;2===j.buttons.length&&(a=j.buttons[1]),g.scope.$root.$broadcast("errorHandlerClosed",j.content,a)}}];b.buttons?d=b.buttons:b.code===i.LOCERR_APP_NOT_FOUND||b.code===i.LOCERR_APP_CONNECT_FAILED?d=[{name:"Common.Refresh",callback:function(){k(location.reload)}},{name:"ErrorDialog.GoToHub",defaultButton:!0,callback:function(){location.href=e.buildUrl(!0,"hub")}}]:(b.code===i.LOCERR_SERVER_LICENSE_EXPIRED||b.code===i.LOCERR_SERVER_OUT_OF_SESSION_AND_USER_CALS||b.code===i.LOCERR_SERVER_OUT_OF_SESSION_CALS||b.code===i.LOCERR_SERVER_OUT_OF_USAGE_CALS||b.code===i.LOCERR_SERVER_OUT_OF_CALS||b.code===i.LOCERR_SERVER_OUT_OF_NAMED_CALS||b.code===i.LOCERR_GENERIC_CONNECTION_LOST)&&(d[0].defaultButton=!1,d.push({name:"Common.Refresh",defaultButton:!0,callback:function(){k(location.reload)}})),j=a.extend(!0,{},b,{title:"ErrorDialog.Title",content:b.code?"ErrorCode."+b.code:b.message,buttons:d,showDefaultButton:!1,classes:{"qs-e-dim":!0}}),c.ready.then(function(){g.open(j),g.scope.$on("delayed-modal-closed",function(){h=!1}),g.scope.$root.$broadcast("errorHandlerOpen")}),document.activeElement&&a(document.activeElement).blur()}}var g=b.getService("$delayedModal"),h=!1,i=d.NxLocalizedErrorCode,j={},k=b.getService("$timeout");return{showDialog:f,isOpen:function(){return h}}}),define("client.controllers/warning-handler-controller",["jquery","qvangular","autogenerated/qix/engine-enums","general.services/delayed-modal/delayed-modal"],function(a,b,c){function d(){i.scope.$on("delayed-modal-closed",function(){m.length&&j(function(){f(m.shift())})})}function e(a){return a.indexOf(k.LOCWARN_PERSONAL_VERSION_EXPIRES_SOON)}function f(b){var c={};c=a.extend(!0,{},b,{title:"WarningDialog.Title",content:"WarningCode."+b,buttons:l,showDefaultButton:!1}),h.ready.then(function(){i.open(c),d()}),document.activeElement&&a(document.activeElement).blur()}function g(a,b){var c=a.slice(0);if(h||(h=b),n){var g=e(c);-1!==g&&c.splice(g,1)}else-1!==e(c)&&(n=!0);c.length>0&&(m.push.apply(m,c),i.isOpened?d():f(m.shift()))}var h,i=b.getService("$delayedModal"),j=b.getService("$timeout"),k=c.NxLocalizedWarningCode,l=[{name:"Common.Close",defaultEscButton:!0,defaultButton:!0}],m=[],n=!1;return{showDialog:g}}),define("core.models/rpc-session",["core.utils/class","core.utils/notification","core.utils/deferred","core.utils/authentication","core.utils/debug-flags","util","qvangular","translator","client.controllers/error-handler-controller","client.controllers/warning-handler-controller","autogenerated/qix/engine-enums"],function(a,b,c,d,e,f,g,h,i,j,k){function l(a){clearTimeout(p),v.push(a),p=setTimeout(function(){g.$apply(g.$rootScope,function(){for(var a=0;a<v.length;a++)try{v[a]()}catch(b){}v.length=0})})}function m(a){a.promise.then(null,function(a){return t(function(){a||(a={isHandled:!1}),a.isHandled||a.error.isHandled||a.error.code===u.LOCERR_GENERIC_ABORTED||i.showDialog(a.error)},1e3),c.reject(a)})}function n(a){var b="",c=encodeURIComponent(a.appName),d=a.host||location.hostname,e=a.port||location.port;return b+=a.isSecure?"wss":"ws",b+="://",b+=d,e&&(b+=":"+e),b+=a.prefix,b+="app/"+c,a.identity&&(b+="/identity/"+a.identity),b+="?reloadUri="+(location.href.indexOf("#")>-1?location.href.substring(0,location.href.indexOf("#")):location.href)}var o,p,q=1,r={},s="https:"===location.protocol,t=g.getService("$timeout"),u=k.NxLocalizedErrorCode,v=[];return o=a.extend("RPCSession",{init:function(a){var c=this;b.mixin(c),c.notification("Open"),c.notification("Close"),c.notification("Send"),c.notification("Data"),c.notification("Error"),c.notification("ClosedHandles"),c.notification("ChangedHandles"),c.notification("Notification"),c.changeHandlers=[],c.cacheName=a.cacheName,c.queue=[],c.modelCache={},c.reqCache={},c.dfdCache={},c.options=a},open:function(){var a=this;a.socket=a.socket||new WebSocket(n(a.options)),a.socket.onopen=a.onOpen.bind(a),a.socket.onclose=a.onClose.bind(a),a.socket.onerror=a.onError.bind(a),a.socket.onmessage=a.onData.bind(a)},onOpen:function(){var a=this;setTimeout(function(){a.queue.forEach(function(b){a.send(b)}),a.queue.length=0,a.Open.emit()},100)},onError:function(a){var b=this;Object.keys(b.dfdCache).forEach(function(c){a.error={err:a,isHandled:!0},b.dfdCache[c].reject(a),delete b.dfdCache[c]}),this.Error.emit(a)},onClose:function(){var a=this;a.queue.length=0,delete r[a.cacheName],setTimeout(function(){a.Close.emit();for(var c in a.modelCache)a.modelCache[c].then(function(a){"App"!==a.constructor.name&&a.close(!0)});b.release(a)},1e3)},onData:function(a){var b=this,c=JSON.parse(a.data),d=b.dfdCache[c.id];c.change&&b.handleChanged(c),c.close&&b.handleClosed(c),e.SOCKET&&window.console.info("[DBGFLG:SOCKET] RECV:",c),l(function(){c.handle&&!b.changeHandlers[c.handle]?d&&d.reject("No model mapped to handle"):c.result?(b.Data.emit(c),c.warnings&&b.handleWarning(c),d&&d.resolve(c)):c.params?(b.handleNotification(c),d&&d.resolve(c)):c.suspend?(b.rpc({method:"Resume",params:[],handle:c.suspend[0]}),d&&d.resolve(c)):c.error&&(d&&d.reject(c),b.handleError(c)),delete b.dfdCache[c.id],delete b.reqCache[c.id]})},handleChanged:function(a){var b=this;a.change.forEach(function(a){var c=b.changeHandlers[a];c&&c.forEach(function(a){a()})}),b.ChangedHandles.emit(a.change)},handleClosed:function(a){var b=this;Object.keys(b.modelCache).forEach(function(c){b.modelCache[c].then(function(b){a.close.indexOf(b.handle)>-1&&b.close(!0)})}),b.ClosedHandles.emit(a.close)},handleError:function(a){this.Error.emit(a)},handleWarning:function(a){"ExportData"!==this.reqCache[a.id].method&&j.showDialog(a.warnings,h)},handleNotification:function(a){"OnSessionLoggedOut"===a.method?i.showDialog(a.method):"OnLicenseAccessDenied"===a.method||"OnSessionClosed"===a.method||"OnEngineWebsocketFailed"===a.method||"OnNoEngineAvailable"===a.method||"OnSessionTimedOut"===a.method||"OnSessionClosed"===a.method?i.showDialog({message:h.get("ProxyError."+a.method)}):"OnAuthenticationInformation"===a.method&&d.parse(a.params),this.Notification.emit(a)},send:function(a){var b=this,c=a;return"string"!=typeof a&&(c=JSON.stringify(a)),b.socket&&1===b.socket.readyState?(b.Send.emit(a),void b.socket.send(c)):void b.queue.push(a)},close:function(){var a=this;return a.socket?(a.socket.close(),void delete a.socket):void 0},rpc:function(a,b){return b||(b=new c),m(b),"undefined"==typeof a.id&&(a.id=q++),a.jsonrpc="2.0",this.send(a),this.dfdCache[a.id]=b,this.reqCache[a.id]=a,b.id=a.id,e.SOCKET&&window.console.info("[DBGFLG:SOCKET] SENT:",a),b.promise},onChange:function(a,b){this.changeHandlers[a]||(this.changeHandlers[a]=[]),this.changeHandlers[a].push(b)},getRequest:function(a){return this.reqCache[a]||null}}),o.get=function(a,b){var c={appName:a};return b||(b={}),c.host=b.host,c.port=b.port,c.isSecure="undefined"==typeof b.isSecure?s:b.isSecure,c.prefix=b.prefix||f.basePath,c.identity=b.identity,c.cacheName=n(c),r[c.cacheName]=r[c.cacheName]||new o(c),r[c.cacheName]},o}),define("autogenerated/qix/engine-api-def",[],function(){var a={Field:{GetCardinal:{},GetAndMode:{},SetAndMode:{qAndMode:!1},LowLevelSelect:{qValues:[0],qToggleMode:!1,qSoftLock:!1},SelectValues:{qFieldValues:[{qText:"",qIsNumeric:!1,qNumber:0}],qToggleMode:!1,qSoftLock:!1},Select:{qMatch:"",qSoftLock:!1,qExcludedValuesMode:0},ToggleSelect:{qMatch:"",qSoftLock:!1,qExcludedValuesMode:0},ClearAllButThis:{qSoftLock:!1},SelectPossible:{qSoftLock:!1},SelectExcluded:{qSoftLock:!1},SelectAll:{qSoftLock:!1},Clear:{},Lock:{},Unlock:{},SelectAlternative:{qSoftLock:!1},GetNxProperties:{},SetNxProperties:{qProperties:{qOneAndOnlyOne:!1}}},Variable:{GetContent:{},GetRawContent:{},SetContent:{qContent:"",qUpdateMRU:!1},ForceContent:{qs:"",qd:0},GetNxProperties:{},SetNxProperties:{qProperties:{qName:"",qNumberPresentation:{qType:0,qnDec:0,qUseThou:0,qFmt:"",qDec:"",qThou:""},qIncludeInBookmark:!1,qUsePredefListedValues:!1,qPreDefinedList:[""]}}},GenericObject:{GetLayout:{},GetListObjectData:{qPath:"",qPages:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},GetHyperCubeData:{qPath:"",qPages:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},GetHyperCubeReducedData:{qPath:"",qPages:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}],qZoomFactor:0,qReductionMode:0},GetHyperCubePivotData:{qPath:"",qPages:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},GetHyperCubeStackData:{qPath:"",qPages:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}],qMaxNbrCells:0},ApplyPatches:{qPatches:[{qOp:0,qPath:"",qValue:""}],qSoftPatch:!1},ClearSoftPatches:{},SetProperties:{qProp:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}},GetProperties:{},SetFullPropertyTree:{qPropEntry:{qProperty:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}},qChildren:[],qEmbeddedSnapshotRef:null}},GetFullPropertyTree:{},GetInfo:{},ClearSelections:{qPath:"",qColIndices:[0]},ExportData:{qFileType:0,qPath:"",qFileName:"",qExportState:0},SelectListObjectValues:{qPath:"",qValues:[0],qToggleMode:!1,qSoftLock:!1},SelectListObjectPossible:{qPath:"",qSoftLock:!1},SelectListObjectExcluded:{qPath:"",qSoftLock:!1},SelectListObjectAlternative:{qPath:"",qSoftLock:!1},SelectListObjectAll:{qPath:"",qSoftLock:!1},SearchListObjectFor:{qPath:"",qMatch:""},AbortListObjectSearch:{qPath:""},AcceptListObjectSearch:{qPath:"",qToggleMode:!1,qSoftLock:!1},ExpandLeft:{qPath:"",qRow:0,qCol:0,qAll:!1},ExpandTop:{qPath:"",qRow:0,qCol:0,qAll:!1},CollapseLeft:{qPath:"",qRow:0,qCol:0,qAll:!1},CollapseTop:{qPath:"",qRow:0,qCol:0,qAll:!1},DrillUp:{qPath:"",qDimNo:0,qNbrSteps:0},Lock:{qPath:"",qColIndices:[0]},Unlock:{qPath:"",qColIndices:[0]},SelectHyperCubeValues:{qPath:"",qDimNo:0,qValues:[0],qToggleMode:!1},SelectHyperCubeCells:{qPath:"",qRowIndices:[0],qColIndices:[0],qSoftLock:!1,qDeselectOnlyOneSelected:!1},SelectPivotCells:{qPath:"",qSelections:[{qType:0,qCol:0,qRow:0}],qSoftLock:!1,qDeselectOnlyOneSelected:!1},RangeSelectHyperCubeValues:{qPath:"",qRanges:[{qRange:{qMin:0,qMax:0,qMinInclEq:!1,qMaxInclEq:!1},qMeasureIx:0}],qColumnsToSelect:[0],qOrMode:!1,qDeselectOnlyOneSelected:!1},GetChild:{qId:""},GetChildInfos:{},CreateChild:{qProp:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}},qPropForThis:null},DestroyChild:{qId:"",qPropForThis:null},DestroyAllChildren:{qPropForThis:null},SetChildArrayOrder:{qIds:[""]},GetLinkedObjects:{},CopyFrom:{qFromId:""},BeginSelections:{qPaths:[""]},EndSelections:{qAccept:!1},ResetMadeSelections:{},EmbedSnapshotObject:{qId:""},GetSnapshotObject:{},Publish:{},UnPublish:{}},GenericDimension:{GetLayout:{},ApplyPatches:{qPatches:[{qOp:0,qPath:"",qValue:""}]},SetProperties:{qProp:{qInfo:{qId:"",qType:""},qDim:{qGrouping:0,qFieldDefs:[""],qFieldLabels:[""]},qMetaDef:{}}},GetProperties:{},GetInfo:{},GetDimension:{},GetLinkedObjects:{},Publish:{},UnPublish:{}},GenericBookmark:{GetLayout:{},ApplyPatches:{qPatches:[{qOp:0,qPath:"",qValue:""}]},SetProperties:{qProp:{qInfo:{qId:"",qType:""},qMetaDef:{}}},GetProperties:{},GetInfo:{},Apply:{},Publish:{},UnPublish:{}},GenericMeasure:{GetLayout:{},ApplyPatches:{qPatches:[{qOp:0,qPath:"",qValue:""}]},SetProperties:{qProp:{qInfo:{qId:"",qType:""},qMeasure:{qLabel:"",qDef:"",qGrouping:0,qExpressions:[""],qActiveExpression:0},qMetaDef:{}}},GetProperties:{},GetInfo:{},GetMeasure:{},GetLinkedObjects:{},Publish:{},UnPublish:{}},GenericDerivedDefinition:{SetProperties:{qProp:{qInfo:{qId:"",qType:""},qDerivedDefinition:{qName:"",qTags:[""],qParameters:[{qName:"",qValue:""}],qFieldDefs:[{qName:"",qExpression:"",qTags:[""]}],qGroupDefs:[{qName:"",qGrouping:0,qFieldDerivedDefinitionNames:[""]}]},qMetaDef:{}}},GetProperties:{},MatchTags:{qTags:[""]},GetInfo:{},Publish:{},UnPublish:{}},GenericDerivedFields:{SetProperties:{qProp:{qInfo:{qId:"",qType:""},qDerivedDefinitionId:"",qFieldName:[""],qMetaDef:{}}},GetProperties:{},GetInfo:{},GetDerivedFieldData:{},GetDerivedField:{qId:""},GetListData:{},GetDerivedFields:{},GetDerivedGroups:{},Publish:{},UnPublish:{}},InternalTest:{Initialised:{},TestMemoryManagement:{},TestNextFileFormat:{},BombQRS:{},BombQRSParallel:{qNThreads:0}},Doc:{GetProperties:{},GetField:{qFieldName:"",qStateName:""},GetFieldDescription:{qFieldName:""},GetVariable:{qName:""},GetLooselyCoupledVector:{},SetLooselyCoupledVector:{qv:[0]},BackCount:{},ForwardCount:{},Evaluate:{qExpression:""},EvaluateEx:{qExpression:""},ClearAll:{qLockedAlso:!1,qStateName:""},LockAll:{qStateName:""},UnlockAll:{qStateName:""},Back:{},Forward:{},ReduceData:{qConfirm:!1,qDropFieldNames:[""]},RemoveAllData:{qConfirm:!1},CreateVariable:{qName:""},RemoveVariable:{qName:""},GetLocaleInfo:{},GetTablesAndKeys:{qWindowSize:{qcx:0,qcy:0},qNullSize:{qcx:0,qcy:0},qCellHeight:0,qSyntheticMode:!1,qIncludeSysVars:!1},GetViewDlgSaveInfo:{},SetViewDlgSaveInfo:{qInfo:{qPos:{qLeft:0,qTop:0,qWidth:0,qHeight:0},qCtlInfo:{qInternalView:{qTables:[{qPos:{qLeft:0,qTop:0,qWidth:0,qHeight:0},qCaption:""}],qBroomPoints:[{qPos:{qx:0,qy:0},qTable:"",qFields:[""]}],qConnectionPoints:[{qPos:{qx:0,qy:0},qFields:[""]}],qZoomFactor:0},qSourceView:{qTables:[{qPos:{qLeft:0,qTop:0,qWidth:0,qHeight:0},qCaption:""}],qBroomPoints:[{qPos:{qx:0,qy:0},qTable:"",qFields:[""]}],qConnectionPoints:[{qPos:{qx:0,qy:0},qFields:[""]}],qZoomFactor:0}},qMode:0}},GetEmptyScript:{qLocalizedMainSection:""},DoReload:{qMode:0,qPartial:!1,qDebug:!1},GetScriptBreakpoints:{},SetScriptBreakpoints:{qBreakpoints:[{qbufferName:"",qlineIx:0,qEnabled:!1}]},GetScript:{},GetTextMacros:{},SetFetchLimit:{qLimit:0},DoSave:{qFileName:""},GetTableData:{qOffset:0,qRows:0,qSyntheticMode:!1,qTableName:""},GetAppLayout:{},SetAppProperties:{qProp:{qTitle:"",qLastReloadTime:""}},GetAppProperties:{},CreateSessionObject:{qProp:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}},DestroySessionObject:{qId:""},CreateObject:{qProp:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}},DestroyObject:{qId:""},GetObject:{qId:""},CloneObject:{qId:""},CreateDraft:{qId:""},CommitDraft:{qId:""},DestroyDraft:{qId:"",qSourceId:""},Undo:{},Redo:{},ClearUndoBuffer:{},CreateDimension:{qProp:{qInfo:{qId:"",qType:""},qDim:{qGrouping:0,qFieldDefs:[""],qFieldLabels:[""]},qMetaDef:{}}},DestroyDimension:{qId:""},GetDimension:{qId:""},CloneDimension:{qId:""},CreateMeasure:{qProp:{qInfo:{qId:"",qType:""},qMeasure:{qLabel:"",qDef:"",qGrouping:0,qExpressions:[""],qActiveExpression:0},qMetaDef:{}}},DestroyMeasure:{qId:""},GetMeasure:{qId:""},CloneMeasure:{qId:""},CreateDerivedDefinition:{qProp:{qInfo:{qId:"",qType:""},qDerivedDefinition:{qName:"",qTags:[""],qParameters:[{qName:"",qValue:""}],qFieldDefs:[{qName:"",qExpression:"",qTags:[""]}],qGroupDefs:[{qName:"",qGrouping:0,qFieldDerivedDefinitionNames:[""]}]},qMetaDef:{}}},GetDerivedDefinitionByName:{qName:""},AssignDerivedFieldFor:{qFieldName:"",qDerivedDefinitionNames:[""]},CreateDerivedFields:{qProp:{qInfo:{qId:"",qType:""},qDerivedDefinitionId:"",qFieldName:[""],qMetaDef:{}}},GetDerivedFields:{qId:""},GetAllDerivedFields:{},CheckExpression:{qExpr:"",qLabels:[""]},CheckNumberOrExpression:{qExpr:""},AddAlternateState:{qStateName:""},RemoveAlternateState:{qStateName:""},CreateBookmark:{qProp:{qInfo:{qId:"",qType:""},qMetaDef:{}}},DestroyBookmark:{qId:""},GetBookmark:{qId:""},ApplyBookmark:{qId:""},CloneBookmark:{qId:""},AddFieldFromExpression:{qName:"",qExpr:""},Resume:{},AbortModal:{qAccept:!1},GenerateThumbNail:{qObjectId:""},Publish:{qStreamId:"",qName:""},UnPublish:{},GetMatchingFields:{qTags:[""],qMatchingFieldMode:0},FindMatchingFields:{qFieldName:"",qTags:[""]},SearchSuggest:{qOptions:{qSearchFields:[""]},qTerms:[""]},SearchAssociations:{qOptions:{qSearchFields:[""]},qTerms:[""],qPage:{qOffset:0,qCount:0,qMaxNbrFieldMatches:0}},SelectAssociations:{qOptions:{qSearchFields:[""]},qTerms:[""],qMatchIx:0,qSoftLock:!1},SetScript:{qScript:""},CheckScriptSyntax:{},GetFavoriteVariables:{},SetFavoriteVariables:{qNames:[""]},GetIncludeFileContent:{qPath:""},CreateConnection:{qConnection:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}},ModifyConnection:{qConnectionId:"",qConnection:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}},qOverrideCredentials:!1},DeleteConnection:{qConnectionId:""},GetConnection:{qConnectionId:""},GetConnections:{},GetDatabaseInfo:{qConnectionId:""},GetDatabases:{qConnectionId:""},GetDatabaseOwners:{qConnectionId:"",qDatabase:""},GetDatabaseTables:{qConnectionId:"",qDatabase:"",qOwner:""},GetDatabaseTableFields:{qConnectionId:"",qDatabase:"",qOwner:"",qTable:""},GetDatabaseTablePreview:{qConnectionId:"",qDatabase:"",qOwner:"",qTable:""},GetFolderItemsForConnection:{qConnectionId:"",qRelativePath:""},GuessFileType:{qConnectionId:"",qRelativePath:""},GetFileTables:{qConnectionId:"",qRelativePath:"",qDataFormat:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}},GetFileTableFields:{qConnectionId:"",qRelativePath:"",qDataFormat:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""},qTable:""},GetFileTablePreview:{qConnectionId:"",qRelativePath:"",qDataFormat:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""},qTable:""},GetFileTablesEx:{qConnectionId:"",qRelativePath:"",qDataFormat:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}},SendGenericCommandToCustomConnector:{qProvider:"",qCommand:"",qMethod:"",qParameters:[""],qAppendConnection:""}},Global:{AbortRequest:{qRequestId:0},AbortAll:{},GetProgress:{qRequestId:0},OpenDoc:{qDocName:"",qUserName:"",qPassword:"",qSerial:"",qNoData:!1},QvVersion:{},OSVersion:{},OSName:{},QTProduct:{},GetDocList:{},GetInteract:{qRequestId:0},InteractDone:{qRequestId:0,qDef:{qType:0,qTitle:"",qMsg:"",qButtons:0,qLine:"",qOldLineNr:0,qNewLineNr:0,qPath:"",qHidden:!1,qResult:0,qInput:""}},GetAuthenticatedUser:{},GetStreamList:{},CreateDocEx:{qDocName:"",qUserName:"",qPassword:"",qSerial:"",qLocalizedScriptMainSection:""},GetActiveDoc:{},AllowCreateApp:{},CreateApp:{qAppName:"",qLocalizedScriptMainSection:""},DeleteApp:{qAppId:""},IsDesktopMode:{},CancelRequest:{qRequestId:0},GetInternalTest:{qKey:""},TestLogging:{qLogger:"",qVerbosity:0,qSteps:0},TestRepositoryLogging:{qLogger:"",qVerbosity:0,qMessage:""},ShutdownProcess:{},ReloadExtensionList:{},ReplaceAppFromID:{qTargetAppId:"",qSrcAppID:"",qIds:[""]},ReplaceAppFromPath:{qTargetAppId:"",qSrcPath:"",qIds:[""]},CopyApp:{qTargetAppId:"",qSrcAppId:"",qIds:[""]},ImportApp:{qAppId:"",qSrcPath:"",qIds:[""]},ExportApp:{qTargetPath:"",qSrcAppId:"",qIds:[""]},PublishApp:{qAppId:"",qStreamId:"",qCopy:!1,qReplaceId:""},IsPersonalMode:{},GetUniqueID:{},ConfigureReload:{qCancelOnScriptError:!1,qUseErrorData:!1,qInteractOnError:!1},CancelReload:{},GetBNF:{qBnfType:0},GetFunctions:{qGroup:0},GetOdbcDsns:{},GetOleDbProviders:{},GetDatabasesFromConnectionString:{qConnection:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}},IsValidConnectionString:{qConnection:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}},GetDefaultAppFolder:{},GetMyDocumentsFolder:{},GetLogicalDriveStrings:{},GetFolderItemsForPath:{qPath:""},GetSupportedCodePages:{},GetCustomConnectors:{qReloadList:!1}}};
return a}),define("assets/datamodelviewer/services/dmv-observer-service",[],function(){function a(a){var b=e[a];return b||(e[a]=b=[]),b}function b(b,c){if(!b)throw new Error("Key is not defined.");if("string"!=typeof b)throw new Error("Key has to a String.");if(!c)throw new Error("No observer was defined.");if("function"!=typeof c)throw new Error("Observer is not a function.");var d=a(b);d.push(c)}function c(b,c,d){if(!b)throw new Error("Key is not defined.");if("string"!=typeof b)throw new Error("Key has to a String.");var e=a(b);for(var f in e)e[f](c,d)}function d(b,c){if(!b)throw new Error("Key is not defined.");if(!c)throw new Error("Observer is not defined.");var d=a(b),e=d.indexOf(c);if(-1===e)throw new Error('Unknown observer for the key "'+b+'".');d.splice(e,1)}var e={};return{addObserver:b,notifyAll:c,removeObserver:d}}),define("ng",[],function(){return{load:function(a,b,c,d){function e(){window.qvangularGlobal?c(window.qvangularGlobal.getService(a)):setTimeout(e,5)}d.isBuild?c():e()}}}),define("core.models/engine",["qvangular","core.models/rpc-session","autogenerated/qix/engine-api-def","util","assets/datamodelviewer/services/dmv-observer-service","ng!$q"],function(a,b,c,d,e,f){function g(a){e.addObserver(v,a)}function h(a){e.notifyAll(v,a)}function i(a){e.addObserver(w,a)}function j(a){e.notifyAll(w,a)}function k(b,c){y.openApps[b]=c,a.$rootScope.$broadcast("app",c)}function l(a){this._session=a}function m(){setTimeout(function(){pubsub.publish("/server/error/unhandled",{message:"ErrorDialog.AppClosed"})},100)}function n(a,c){var e=a||d.getParameterByName("app"),f=b.get(e,c);return f.open(),f.Close.bind(m),f.ClosedHandles.bind(function(a){y.currentApp._handle===a[0]&&m()}),new l(f)}function o(a){return a.substring(0,1).toLowerCase()+a.substring(1)}function p(a,b){var c=function(b,c){this._cache={},this._handle=!!b&&!!b.qReturn&&b.qReturn.qHandle,this._session=c,this.__engineTypeName=a};for(var d in b){var e=b[d];c.prototype[o(d)]=s(d,e)}return function(a,b){return new c(a,b)}}function q(a,b,c){var d;return a._session?d="OpenDoc"!==b||!a._session.isAssignToApp()&&c===a._session.getAppName()?a._session:n(c,a._rpcOptions):(a._session=n(c,a._rpcOptions),d=a._session),d}function r(a,b){var c=Object.keys(a);for(var d in c)if(!b.hasOwnProperty(c[d]))return!1;return!0}function s(b,c){var d=function(){var d=this,e=Array.prototype.slice.apply(arguments);1===e.length&&"object"==typeof e[0]&&r(e[0],c)&&(e=e[0]);var g;"OpenDoc"===b?(g=q(d,b,e[0]),delete d._rpcOptions):g=q(d,b);var i={method:b,params:e,handle:this._handle||-1},l=g.rpc(i).then(function(c){var f;if(c){if(c.qReturn&&c.qReturn.qHandle&&c.qReturn.qType){var h=u[c.qReturn.qType];f=h(c,g)}else if(c.hasOwnProperty("qResult"))f=c.qResult,d["current"+b]=c.qResult;else if(c.hasOwnProperty("qReturn")&&1===Object.keys(c).length)f=c.qReturn,d["current"+b]=c.qReturn;else{for(var l in c)c.hasOwnProperty(l)&&(d[l]=c[l]);f=c}return"OpenDoc"===b&&(g._session.connectedAppHandle=c.qReturn.qHandle,f.name=e[0],f.selectAsCurrentApp=function(){y.currentApp=f,a.$rootScope.$broadcast("currentApp",[f])},k(e[0],f)),j(b),f&&"object"==typeof f&&(f.__protocolRequestId=i.id),f}return void 0},function(a){return a.error.code!==x?f.reject(a.error):void h(a.error)});return l.__protocolRequestId=i.id,l};return d}function t(){var a={};for(var b in c){var d=c[b];a[b]=p(b,d)}return a}var u={},v="OBSERVER_KEY_FATAL_ERROR",w="OBSERVER_KEY_DATA_HAS_BEEN_SENT",x=-32602,y={global:void 0,openApps:{},currentApp:void 0,onFatalErrorListeners:g,onDataHasBeenSent:i};return l.prototype.rpc=function(a){return this._session.rpc(a).then(function(a){return a.result})},l.prototype.getAppName=function(){return this._session.options.appName},l.prototype.isAssignToApp=function(){return!!this.appName},u=t(),y.global=u.Global(),y.types=u,y.getCurrentApp=function(){return y.currentApp},y.openApp=function(a,b){var c=y.global,d=b&&b.openWithoutData?b.openWithoutData:!1;return c._rpcOptions=b,c.openDoc(a,"","","",d)},window.engineModuleGlobal=y,y}),define("core.models/app",["core.models/rpc-base","core.models/rpc-session","core.models/engine","core.utils/deferred","util","qvangular","client.controllers/error-handler-controller","autogenerated/qix/engine-enums"],function(a,b,c,d,e,f,g,h){function i(){m(function(){g.showDialog({code:h.NxLocalizedErrorCode.LOCERR_GENERIC_CONNECTION_LOST})},1e3)}var j,k,l={},m=f.getService("$timeout");return j=a.extend("App",{init:function(a,c,e){var f=this;e&&k||(k=f);var g=b.get(a,c);if(g.Close.bind(i),g.modelCache[a]=d.resolve(f),f.waitForOpen=new d,f.rpcOptions=c,f._super({id:a,session:g,checkCreate:!0}),f.session.connectedAppHandle)f.handle=f.session.connectedAppHandle,f.bindToRPC(),f.waitForOpen.resolve(f);else try{f.session.open(),f.open().then(function(){f.waitForOpen.resolve(f)},function(a){f.waitForOpen.reject({error:a})})}catch(h){f.waitForOpen.reject({isHandled:!1,error:h})}f.session.currentApp=f},open:function(){function a(a){a.selectAsCurrentApp(),b.session.connectedAppHandle=b.handle=a._handle,b.bindToRPC()}var b=this;return b.session.Error.bind(function(a){window.console.log("Error from Engine:",a)}),"true"!==e.getParameterByName("noData")||b.rpcOptions&&b.rpcOptions.openWithoutData||(b.rpcOptions||(b.rpcOptions={}),b.rpcOptions.openWithoutData=!0),c.openApp(b.id,b.rpcOptions).then(a)},close:function(a){return a?g.showDialog({message:"ErrorDialog.AppClosed"}):this.session.Close.unbind(i),this.session.close(),this._super()},createSessionObject:function(a){return this.rpc("CreateSessionObject","qReturn",[a])},doSave:function(){return this.rpc("DoSave",null)},getLayout:function(){return this._super("GetAppLayout")},getProperties:function(){return this._super("GetAppProperties")},setProperties:function(a){return this._super(a,"SetAppProperties")},checkExpression:function(a,b){var c=[a];return b&&c.push(b),this.rpc("CheckExpression",null,c)},checkNumberOrExpression:function(a){return this.rpc("CheckNumberOrExpression",null,[a])},evaluateExpression:function(a){return this.rpc("Evaluate","qReturn",[a])},getVersion:function(){return this.session.rpc({method:"QvVersion",handle:-1,params:[]}).then(function(a){return a.result.qReturn})},getListOfFunctions:function(){return this.session.rpc({method:"GetFunctions",handle:-1,params:[]}).then(function(a){return a.result.qFunctions})},getLocaleInfo:function(){return this.rpc("GetLocaleInfo","qReturn")},getExpressions:function(){return this.rpc("GetExpressions","qExpressions")},getStreams:function(){var a=this;return a.streamsList?d.resolve(a.streamsList):this.session.rpc({method:"GetStreamList",handle:-1,params:[]}).then(function(b){return a.streamsList=b.result.qStreamList,a.streamsList})},getPublishableStreams:function(){var a=this.getLayout(),b=this.getStreams(),c=new d;return d.all({layout:a,streams:b}).then(function(a){var b=a.streams.filter(function(b){return a.layout.stream?b.qId===a.layout.stream.id&&-1!==b.privileges.indexOf("publish"):-1!==b.privileges.indexOf("publish")});c.resolve(b)}),c.promise},getMatchingFields:function(a){return this.rpc("GetMatchingFields",null,[a])},findMatchingFields:function(a,b){return this.rpc("FindMatchingFields",null,[a,b])},abortModal:function(a){return a=void 0!==a?a:!0,this.setModal(null),this.rpc("AbortModal",null,[a])},switchModal:function(a,b,c){var e,f=this;return a=a||null,b=b||"",e=Array.isArray(b)?b:[b],c=void 0!==c?c:!0,f.modalObject&&!f.modalObject.isClosed&&f.modalObject.rpc("EndSelections",null,[c]),a&&!a.isClosed?(f.modalObject=a,a.rpc("BeginSelections",null,[e])):(f.setModal(null),d.resolve())},setModal:function(a){this.modalObject=a},isModal:function(){return null!=this.modalObject},publish:function(a){return this.rpc("Publish",null,[a])}}),Object.defineProperty(j,"current",{get:function(){return k}}),j.get=function(a,b,c){var d=j.getSync(a,b,c);return d.waitForOpen.promise},j.getSync=function(a,b,c){a=a||e.getParameterByName("app")||"?transient=";var d=l[a.toLowerCase()]=l[a.toLowerCase()]||new j(a,b,c);return d},j.create=function(a,b){return b.rpc({method:"CreateApp",handle:-1,params:[a]}).then(function(a){return a.result})},j.remove=function(a,b){return b.rpc({method:"DeleteApp",handle:-1,params:[a]}).then(function(a){return a.result})},j.getList=function(a){return a.rpc({method:"GetDocList",handle:-1,params:[]}).then(function(a){return a.result.qDocList})},j}),define("workbench/mashupapi/qglobal",["qvangular","core.models/app","core.models/rpc-session"],function(a,b,c){function d(a,b,c,d){return a.session.rpc({method:b,handle:-1,params:c||[]}).then(function(a){return d&&d(a.result),a.result})}function e(a){"RPCSession"===a.constructor.name?this.session=a:(this.session=c.get("global",a),this.session.open())}return e.prototype.getAppList=function(c){var d=this.session;a.$apply(a.$rootScope,function(){b.getList(d).then(function(a){c(a)})})},e.prototype.getAuthenticatedUser=function(a){return d(this,"GetAuthenticatedUser",[],a)},e.prototype.isPersonalMode=function(a){return d(this,"IsPersonalMode",[],a)},e.prototype.getQTProduct=function(a){return d(this,"QTProduct",[],a)},e.prototype.getQvVersion=function(a){return d(this,"QvVersion",[],a)},e.prototype.cancelReload=function(){return d(this,"CancelReload",[])},e.prototype.GetProgress=function(a,b){return d(this,"GetProgress",[a],b)},e}),define("core.models/base-object",["core.models/rpc-base","core.models/app","core.utils/deferred","core.utils/permissions","util"],function(a,b,c,d,e){function f(c,e){var f,g,h=c.name+"List",i=Object.keys(e).filter(function(a){return a.indexOf("ListDef")>-1?a:void 0})[0].replace(/Def$/g,"");if(!i)throw new Error("BaseObject: Tried to create a model without a ListDef in properties");g=a.extend(h,{strippedLayout:{},getLayout:function(){var a=this;return this._super().then(function(b){return a.strippedLayout=b[i].qItems,a.strippedLayout.forEach(function(a){"object"==typeof a&&d.mapToLayout(a)}),a.strippedLayout})}}),e.qInfo={qId:h,qType:h},c.getList=function(a){return a=a||b.current,f?f:f=a.createSessionObject(e).then(function(b){return new g({id:h,handle:b.qHandle,session:a.session})})},c.getListLayout=function(a){return this.getList(a).then(function(a){return a.getLayout()})}}var g;return g=a.extend("BaseObject",{getInfo:function(){return this.rpc("GetInfo","qInfo")},clone:function(a,c){var d=this;return c=c||b.current,c.rpc(a||"CloneObject","qCloneId",[d.id]).then(function(a){return d.constructor.get(a)})}}),g.get=function(a,c){function d(){return c.rpc("GetObject","qReturn",[a])}return c=c||b.current,this.getModel(a,c.session,d)},g.create=function(a,d,f){var g=this;return a.qInfo=a.qInfo||{},a.qInfo.qId=a.qInfo.qId||e.generateId(),a.qInfo.qType=a.qInfo.qType||this.name.toLowerCase(),d=d||"CreateObject",f=f||b.current,f.rpc(d,null,[a]).then(function(b){return g.getModel(b.qInfo&&b.qInfo.qId||a.qInfo.qId,f.session,function(){return c.resolve(b.qReturn)})})},g.remove=function(a,c,d,e){var f=[a];return e&&f.push(e),d=d||b.current,c=c||"DestroyObject",d.rpc(c,"qReturn",f)},g.States=a.States,g.extend=function(b,c,d){var e=a.extend.call(this,b,c);return e.extend=g.extend,e.get=g.get,e.create=g.create,e.remove=g.remove,e.States=g.States,d&&d.listProperties&&f(e,d.listProperties),e},g}),define("core.models/generic-object",["core.models/base-object","core.utils/deferred","util"],function(a,b,c){var d;return d=a.extend("GenericObject",{createChild:function(a,e,f){var g=this.session,h=[a];return f=f||d,e&&h.push(e),a.qInfo.qId=a.qInfo.qId||c.generateId(),this.rpc("CreateChild",null,h).then(function(a){return f.getModel(a.qInfo.qId,g,function(){return b.resolve(a.qReturn)})})},removeChild:function(a,b){return d.remove(a,"DestroyChild",this,b)},setChildArrayOrder:function(a){var b=[a];return this.rpc("SetChildArrayOrder",null,b)},removeAllChildren:function(a){var b=[];return a&&b.push(a),this.rpc("DestroyAllChildren",null,b)},copyFrom:function(a){return this.rpc("CopyFrom",null,[a])},applyPatches:function(a,b){return this.rpc("ApplyPatches",null,[a,b])},clearSoftPatches:function(){return this.rpc("ClearSoftPatches")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])},exportData:function(a,b,c){a=a||"OOXML",b=b||"",c=c||"";var d=[a,b,c];return this.rpc("ExportData",null,d,{raw:!0})},cancelRequest:function(a){var b=this,c=b.session.getRequest(a);return b.session.rpc({method:"CancelRequest",handle:-1,params:[a]}).then(function(){c&&"GetLayout"===c.method&&b.setState(d.States.CANCELLED)})}})}),define("core.models/session-object",["core.models/generic-object","core.models/app"],function(a,b){var c;return c=a.extend("SessionObject",{remove:function(){return c.remove(this.id,b.current)}}),c.get=function(a,c){function d(){return c.createSessionObject(a)}var e=a.qInfo.qId||a.qInfo.qType;if(!e)throw new Error("no id");return a.qInfo.qId=e,c=c||b.current,this.getModel(e,c.session,d)},c.remove=function(b,c){return a.remove(b,"DestroySessionObject",c)},c.extend=function(){var b=a.extend.apply(this,arguments);return b.get=c.get,b.remove=c.remove,b},c}),define("general.models/field",["core.models/base-object","core.models/app"],function(a,b){var c;return c=a.extend("Field",{clear:function(){return this.rpc("Clear","qReturn")},lock:function(){return this.rpc("Lock","qReturn")},unlock:function(){return this.rpc("Unlock","qReturn")},clearOther:function(a){return this.rpc("ClearAllButThis","qReturn",[a||!1])},selectPossible:function(a){return this.rpc("SelectPossible","qReturn",[a||!1])},selectExcluded:function(a){return this.rpc("SelectExcluded","qReturn",[a||!1])},selectAll:function(a){return this.rpc("SelectAll","qReturn",[a||!1])},selectAlternative:function(a){return this.rpc("SelectAlternative",null,[a||!1])},selectMatch:function(a,b){return this.rpc("Select","qReturn",[a||"",b||!1])},toggleSelect:function(a,b){return this.rpc("ToggleSelect","qReturn",[a||"",b||!1])},select:function(a,b,c){return this.rpc("LowLevelSelect","qReturn",[a,b||!1,c||!1])},selectValues:function(a,b,c){return this.rpc("SelectValues","qReturn",[a,b||!1,c||!1])}},{listProperties:{qFieldListDef:{qShowSystem:!1,qShowHidden:!1,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0}}}),c.get=function(a,c,d){function e(){return d.rpc("GetField","qReturn",[a,c])}c=c||"$";var f="FIELD_"+a+"_"+c;return d=d||b.current,this.getModel(f,d.session,e)},c}),define("client.models/current-selections",["core.models/session-object","core.models/app","general.models/field"],function(a,b,c){function d(a,b,d){c.get(b,void 0,a).then(function(a){a[d]()})}var e;return e=a.extend("CurrentSelections",{clearField:function(a){d(this.app,a,"clear")},lockField:function(a){d(this.app,a,"lock")},unlockField:function(a){d(this.app,a,"unlock")},clearAll:function(){return this.app.rpc("ClearAll",null)},back:function(){return this.app.rpc("Back",null)},forward:function(){return this.app.rpc("Forward",null)}}),e.get=function(c){return c=c||b.current,a.get.call(this,{qInfo:{qType:"CurrentSelection"},qSelectionObjectDef:{}},c).then(function(a){return a.app=c,a})},e}),define("objects.models/visualization-object",["core.models/app","core.models/generic-object"],function(a,b){var c;return c=b.extend("VisualizationObject",{init:function(){this._super.apply(this,Array.prototype.slice.apply(arguments))}}),c.create=function(c,d,e){return d=d||a.current,d.createChild?d.createChild(c,e,this):b.create.call(this,c)},c.createTransient=function(b,c){c=c||a.current;var d=this;return c.createSessionObject(b).then(function(a){return new d({id:null,handle:a.qHandle,session:c.session})})},c.remove=function(a,c,d){var e=null;c&&c.removeChild&&(e="DestroyChild"),b.remove.call(this,a,e,c,d)},c.extend=function(){var a=b.extend.apply(this,arguments);return a.extend=c.extend,a.create=c.create,a.createTransient=c.createTransient,a.remove=c.remove,a},c}),define("client.models/bookmark",["jquery","core.models/base-object","core.models/app"],function(a,b,c){var d;return d=b.extend("Bookmark",{clone:function(){return this._super("CloneBookmark")},apply:function(){return d.apply(this.id,this.app)}},{listProperties:{qBookmarkListDef:{qType:"bookmark",qData:{title:"/title",description:"/description",sheetId:"/sheetId",selectionFields:"/selectionFields",creationDate:"/creationDate"}}}}),d.get=function(a,b){function d(){return b.rpc("GetBookmark","qReturn",[a])}return b=b||c.current,this.getModel(a,b.session,d)},d.apply=function(a,b){b=b||c.current;var d=b.rpc("ApplyBookmark","qSuccess",[a]);return d},d.create=function(c,d){var e={version:.96,title:"",description:"",sheetId:c.sheetId||null,selectionFields:c.selectionFields,creationDate:(new Date).toISOString()};return b.create.call(this,a.extend(!0,{},e,c),"CreateBookmark",d)},d.remove=function(a,c){return b.remove(a,"DestroyBookmark",c)},d.extend=function(a,c,e){var f=b.extend.call(this,a,c,e);return f.extend=d.extend,f.create=d.create,f.remove=d.remove,f.get=d.get,f},d}),define("client.models/snapshot",["client.models/bookmark","ng!$q"],function(a,b){var c,d=500;return c=a.extend("Snapshot",{applyEmbeddedSnapshot:function(){return this.rpc("Apply")}},{listProperties:{qBookmarkListDef:{qType:"snapshot",qData:{title:"/title",libraryTitle:"/libraryTitle",description:"/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}}}),c.getLibraryContent=function(a,c){var d,e=b.defer();return this.getList().then(function(b){b.getLayout().then(function(b){d=b.filter(function(b){var c=!0;return a&&(c=a===b.qData.sourceObjectId),!b.qData.isClone&&c}),e.resolve(d)}),b.Invalidated&&b.Invalidated.unbind(),b.Invalidated.bind(c)}),e.promise},c.unbindList=function(){this.getList().then(function(a){a.Invalidated.unbind()})},c.getSnapshotCount=function(a){var c,d=b.defer(),e=0;return this.getListLayout().then(function(b){for(c=0;c<b.length;c++)b[c].qData.isClone||b[c].qData.sourceObjectId!==a||e++;d.resolve(e)}),d.promise},c.create=function(e,f){var g,h,i=b.defer(),j=0;return this.getListLayout().then(function(b){for(g=0;g<b.length;g++)b[g].qData.isClone||j++;h=d>j,h?a.create.call(c,e,f).then(function(){i.resolve(h)}):i.resolve(h)}),i.promise},c.getEmbedded=function(a,b){function c(){return b.rpc("GetSnapshotObject","qReturn",[])}return this.getModel(a,b.session,c)},{Snapshot:c}}),define("objects.backend-api/engine-throttle",["jquery","core.utils/class","core.utils/notification","util"],function(a,b,c,d){function e(a,b){var c=this;this.queuedRequests.push(a),clearTimeout(this._debounceTimer),b>=10?this._debounceTimer=setTimeout(function(){f.call(c)},b):f.call(c)}function f(){var a=this.queuedRequests.pop();for(a&&g.call(this,a);this.queuedRequests.length;)a=this.queuedRequests.shift(),a.dfd.reject()}function g(a){this.ongoingRequests.push(a);var b=this,c=a.wrapper;a.sentAt=Date.now(),c.then(function(){b.ongoingRequests.splice(b.ongoingRequests.indexOf(a),1),a.respondedAt=Date.now(),b.resolvedRequests.push({sentAt:a.sentAt,respondedAt:a.respondedAt,requestedAt:a.requestedAt}),b.resolvedRequests.length>10&&(b.resolvedRequests=b.resolvedRequests.slice(-10)),a.requestedAt>b._latestResolvedRequestedAt?a.dfd.resolve.apply(a.dfd,[].slice.call(arguments)):a.dfd.reject(),b._latestResolvedRequestedAt=a.requestedAt},function(){b.ongoingRequests.splice(b.ongoingRequests.indexOf(a),1),a.respondedAt=Date.now(),a.dfd.reject.apply(a.dfd,[].slice.call(arguments))}),this.Send.emit(a.data,c)}var h,i={enabled:!0,delay:50};return h=b.extend("Throttle",{init:function(){this.options={},this.ongoingRequests=[],this.queuedRequests=[],this.recentRequests=[],this.resolvedRequests=[],this._debounceTimer=null,this._latestResolvedRequestedAt=-1,c.mixin(this),this.notification("Send"),this.notification("Cancel"),this.setOptions({})},destroy:function(){this.clear(),this.recentRequests=[],this.resolvedRequests=[],c.release(this)},setOptions:function(a){this.options=d.extend(!0,{},i,this.options,a),this.enabled=this.options.enabled||!1,this.delay=this.options.delay||-1},clear:function(){clearTimeout(this._debounceTimer);for(var a;this.queuedRequests.length;)a=this.queuedRequests.pop(),a.dfd.reject();for(;this.ongoingRequests.length;)a=this.ongoingRequests.pop(),a.dfd.reject()},queue:function(b){var c=this.enabled?this.delay:-1,d={data:b,dfd:new a.Deferred,wrapper:new a.Deferred,requestedAt:Date.now()},f=Math.max(this._getAvgResolutionTime(),c);return 1>c||this.recentRequests.length<1||Date.now()-this.recentRequests.slice(-1)[0].requestedAt>f?e.apply(this,[d,0]):e.apply(this,[d,Math.min(c,1e3)]),this.recentRequests.push(d),this.recentRequests.length>10&&(this.recentRequests=this.recentRequests.slice(-10)),d.dfd.promise()},updateResolutionTime:function(){this._latestResolvedRequestedAt=Date.now()},_getAvgResolutionTime:function(){var a;return this.resolvedRequests.length&&(a=0,this.resolvedRequests.forEach(function(b){a+=b.respondedAt-b.sentAt}),a/=this.resolvedRequests.length),a}})}),define("objects.utils/shapes/geometry-math",[],function(){var a,b=1e-12;return a={checkPointsCoincident:function(a,b){return a.x===b.x&&a.y===b.y?!0:!1},checkPointOnLineSegment2:function(c,d,e){var f,g,h,i;return f=e.x-d.x,g=e.y-d.y,0===f?0===g?a.checkPointsCoincident(c,d):c.x!==d.x?!1:(h=(c.y-d.y)/g,h>=0&&1>=h?!0:!1):0===g?c.y!==d.y?!1:(h=(c.x-d.x)/f,h>=0&&1>=h?!0:!1):(h=(c.x-d.x)/f,i=(c.y-d.y)/g,h>=0&&1>=h&&Math.abs(h-i)<b?!0:!1)},checkPointOnLineSegment:function(b,c){return a.checkPointOnLineSegment2(b,c[0],c[1])},checkLineSegmentIntersectingLineSegment2:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r;if(f=c.x-b.x,g=c.y-b.y,h=e.x-d.x,i=e.y-d.y,j=b.x-d.x,k=b.y-d.y,n=i*f-h*g,l=h*k-i*j,m=f*k-g*j,0===n){if(0===l&&0===m){if(0===f){if(0===g)return a.checkPointOnLineSegment2(b,d,e);q=(d.y-b.y)/g,r=(e.y-b.y)/g}else q=(d.x-b.x)/f,r=(e.x-b.x)/f;return 0>q&&0>r||q>1&&r>1?!1:!0}return!1}return o=l/n,p=m/n,o>=0&&1>=o&&p>=0&&1>=p?!0:!1},checkLineSegmentIntersectingLineSegment:function(b,c){return a.checkLineSegmentIntersectingLineSegment2(b[0],b[1],c[0],c[1])},checkPointInsideRectDefinedByMaxMin:function(a,b){return a.x>b.minX&&a.x<b.maxX&&a.y>b.minY&&a.y<b.maxY},checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin:function(a,b){return a.x>=b.minX&&a.x<=b.maxX&&a.y>=b.minY&&a.y<=b.maxY},checkLineSegmentIntersectingRectDefinedByMaxMin:function(b,c){return a.checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin(b[0],c)||a.checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin(b[0],c)?!0:a.checkLineSegmentIntersectingLineSegment(b,[{x:c.minX,y:c.minY},{x:c.minX,y:c.maxY}])?!0:a.checkLineSegmentIntersectingLineSegment(b,[{x:c.maxX,y:c.minY},{x:c.maxX,y:c.maxY}])?!0:a.checkLineSegmentIntersectingLineSegment(b,[{x:c.minX,y:c.minY},{x:c.maxX,y:c.minY}])?!0:a.checkLineSegmentIntersectingLineSegment(b,[{x:c.minX,y:c.maxY},{x:c.maxX,y:c.maxY}])?!0:!1},checkPolylineIntersectingRectDefinedByMaxMin:function(b,c){var d,e,f,g,h,i,j,k=b?b.length:0;if(0===k)return!1;if(e=b[0],e.x>c.maxX)return!1;if(e.x>=c.minX&&e.y>=c.minY&&e.y<=c.maxY)return!0;for(d=e,f=1;k>f;f++){if(e=b[f],e.x>=c.minX&&e.x<=c.maxX&&e.y>=c.minY&&e.y<=c.maxY)return!0;if(g=Math.min(d.x,e.x),g>c.maxX)return!1;if(h=Math.max(d.x,e.x),h<c.minX)d=e;else if(i=Math.min(d.y,e.y),i>c.maxY)d=e;else if(j=Math.max(d.y,e.y),j<c.minY)d=e;else{if(a.checkLineSegmentIntersectingRectDefinedByMaxMin([d,e],c))return!0;d=e}}return!1},checkPolylinesIntersectingRectDefinedByMaxMin:function(b,c){var d,e=b?b.length:0;for(d=0;e>d;d++)if(a.checkPolylineIntersectingRectDefinedByMaxMin(b[d],c))return!0;return!1},calculateBounds:function(a){var b,c,d,e,f,g=Number.MAX_VALUE,h=-Number.MAX_VALUE,i=Number.MAX_VALUE,j=-Number.MAX_VALUE,k=a?a.length:0;if(0===k)return null;for(d=0;k>d;d++)b=a[d],c=b?b.calculateBounds():void 0,c&&1/0!==c.x&&(e=c.getRight(),f=c.getBottom(),e>h&&(h=e),c.x<g&&(g=c.x),f>j&&(j=f),c.y<i&&(i=c.y));return{x:g,y:i,width:h-g,height:j-i}}}}),define("objects.utils/shapes/line",["./geometry-math"],function(a){function b(a,b,c,d){0===arguments.length?this.set(0,0,0,0):2===arguments.length?this.set(a.x,a.y,b.x,b.y):this.set(a,b,c,d)}return b.prototype={toString:function(){return this.x1+" "+this.y1+" "+this.x2+" "+this.y2},clone:function(){return new b(this.x1,this.y1,this.x2,this.y2)},set:function(a,b,c,d){this.x1=a,this.y1=b,this.x2=c,this.y2=d},intersectsLine:function(b){return a.checkLineSegmentIntersectingLineSegment(this.getPoints(),b.getPoints())},getPoints:function(){var a=[];return a.push({x:this.x1,y:this.y1}),a.push({x:this.x2,y:this.y2}),a}},b}),define("objects.utils/shapes/rect",["./line"],function(a){function b(a,b,c,d){0===arguments.length?this.set(0,0,0,0):this.set(a,b,c,d)}return b.prototype={toString:function(){return this.x+" "+this.y+" "+this.width+" "+this.height},clone:function(){return new b(this.x,this.y,this.width,this.height)},set:function(a,b,c,d){c>=0?(this.x=a,this.width=c):(this.x=a+c,this.width=-c),d>=0?(this.y=b,this.height=d):(this.y=b+d,this.height=-d)},setLTRB:function(a,b,c,d){c>=a?(this.x=a,this.width=c-a):(this.x=c,this.width=a-c),d>=b?(this.y=b,this.height=d-b):(this.y=d,this.height=b-d)},equal:function(a){return a&&this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height},combineWith:function(a){var c,d,e,f,g=Math.max(a.getRight(),this.getRight()),h=Math.max(a.getBottom(),this.getBottom());return c=Math.min(a.x,this.x),d=Math.min(a.y,this.y),e=Math.max(0,g-c),f=Math.max(0,h-d),new b(c,d,e,f)},intersectsWith:function(a){return a&&this.x<=a.getRight()&&a.x<=this.getRight()&&this.y<=a.getBottom()&&a.y<=this.getBottom()?!0:!1},intersectsRect:function(a){return this.intersectsWith(a)},intersection:function(a,c){var d,e,f,g;return this.intersectsWith(a)?(d=Math.max(this.x,a.x),e=Math.max(this.y,a.y),f=Math.min(this.getRight(),a.getRight()),g=Math.min(this.getBottom(),a.getBottom()),new b(d,e,f-d,g-e)):c?null:new b(this.x,this.y,this.width,this.height)},union:function(a){var c,d,e,f;return c=Math.min(this.x,a.x),d=Math.min(this.y,a.y),e=Math.max(this.getRight(),a.getRight()),f=Math.max(this.getBottom(),a.getBottom()),new b(c,d,e-c,f-d)},pointInside:function(a,b){return a>=this.x&&a<=this.getRight()&&b>=this.y&&b<=this.getBottom()},rectInside:function(a){var b,c=a.getPoints();for(b=0;4>b;b++)if(!this.pointInside(c[b].x,c[b].y))return!1;return!0},intersectsLine:function(b){var c=this.getRight(),d=this.getBottom();return this.pointInside(b.x1,b.y1)||this.pointInside(b.x2,b.y2)?!0:b.intersectsLine(new a(this.x,this.y,c,this.y))||b.intersectsLine(new a(c,this.y,c,d))||b.intersectsLine(new a(c,d,this.x,d))||b.intersectsLine(new a(this.x,d,this.x,this.y))?!0:!1},getPoints:function(){var a=[];return a.push({x:this.x,y:this.y}),a.push({x:this.getRight(),y:this.y}),a.push({x:this.getRight(),y:this.getBottom()}),a.push({x:this.x,y:this.getBottom()}),a},getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height},getCenterPoint:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},getBoundingRect:function(){return this},scale:function(a){var b=a-1,c=b*this.width/2,d=b*this.height/2;this.x-=c,this.y-=d,this.width*=a,this.height*=a},hasNaN:function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.width)||isNaN(this.height)}},b}),define("objects.backend-api/cube-slicer",["core.utils/class","objects.utils/shapes/rect"],function(a,b){var c,d=new b(0,0,0,0),e=new b(0,0,0,0);return c=a.extend("CubeSlicer",{init:function(){this.pages=[]},get:function(a){return a.map(function(a){return this.getPage(a)}.bind(this))},getPage:function(a){var c,f,g,h=[];for(f=0;f<this.pages.length;f++)if(c=this.pages[f].qArea,d.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),e.set(c.qLeft,c.qTop,c.qWidth,c.qHeight),g=e.intersection(d,!0),h.push({coverage:g?g.clone():new b(0,0,0,0),idx:f}),c.qLeft<=a.qLeft&&c.qLeft+c.qWidth>=a.qLeft+a.qWidth&&c.qTop<=a.qTop&&c.qTop+c.qHeight>=a.qTop+a.qHeight)return this._extract(a,this.pages[f]);return h.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),h[0].coverage.height>0&&h[0].coverage.width>0?this._extract(a,this.pages[h[0].idx]):{qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0},qMatrix:[]}},destroy:function(){this.clear()},isEmpty:function(){return!(this.pages&&this.pages[0]&&this.pages[0].qArea.qHeight&&this.pages[0].qArea.qWidth)},clear:function(){this.pages=[]},store:function(a){this.pages=a},containsArea:function(a){for(var b,c=0;c<this.pages.length;c++)if(b=this.pages[c].qArea,b.qLeft<=a.qLeft&&b.qLeft+b.qWidth>=a.qLeft+a.qWidth&&b.qTop<=a.qTop&&b.qTop+b.qHeight>=a.qTop+a.qHeight)return!0;return!1},contains:function(a){return this.pages&&this.pages.length?0===a.filter(function(a){return!this.containsArea(a)}.bind(this)).length:!1},_extract:function(a,b){d.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),e.set(b.qArea.qLeft,b.qArea.qTop,b.qArea.qWidth,b.qArea.qHeight);var c,f,g,h=d.intersection(e,!0);return h?(g=Math.max(0,a.qTop-b.qArea.qTop),f=Math.max(0,a.qLeft-b.qArea.qLeft),c=b.qMatrix.slice(g,g+h.height).map(function(a){return a.slice(f,f+h.width)}),{qArea:{qTop:h.y,qLeft:h.x,qWidth:h.width,qHeight:h.height},qMatrix:c}):{qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0},qMatrix:[]}}})}),define("objects.backend-api/pivot-cube-slicer",["./cube-slicer","objects.utils/shapes/rect"],function(a,b){function c(a,b){var c,d={};for(c in a)"qSubNodes"!==c&&a.hasOwnProperty(c)&&(d[c]=a[c]);return b.push(d),d}function d(a,b,e){var g,h,i,j=[],k=[],l=0,m=0;for(e.length&&(l=e[0].qUp||0,m=e[e.length-1].qDown||0),g=0;g<e.length;++g)if(h=e[g],h.qSubNodes.length>0&&(k=d(a,b,h.qSubNodes)),i=null,(0===h.qSubNodes.length&&f>=a&&a+b>=f||k.length>0)&&(i=c(h,j),void 0!==i.qUp&&1===j.length&&(i.qUp=l+g),i.qSubNodes=k),0===h.qSubNodes.length&&f++,f===a+b){i&&void 0!==i.qDown&&(i.qDown=m+(e.length-1-g));break}return j}function e(a,b,c){return f=0,d(a,b,c)}var f,g,h=new b(0,0,0,0),i=new b(0,0,0,0);return g=a.extend("PivotCubeSlicer",{init:function(){this._super(),this.requestedAreas=[]},getPage:function(a){var c,d,e,f=[];for(d=0;d<this.pages.length;d++)if(c=this.pages[d].qArea,h.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),i.set(c.qLeft,c.qTop,c.qWidth,c.qHeight),e=i.intersection(h,!0),f.push({coverage:e?e.clone():new b(0,0,0,0),idx:d}),c.qLeft<=a.qLeft&&c.qLeft+c.qWidth>=a.qLeft+a.qWidth&&c.qTop<=a.qTop&&c.qTop+c.qHeight>=a.qTop+a.qHeight)return this._extract(a,this.pages[d]);return f.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),f[0].coverage.height>0&&f[0].coverage.width>0?this._extract(a,this.pages[f[0].idx]):{qLeft:[],qTop:[],qData:[],qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0}}},_extract:function(a,b){var c,d;h.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),i.set(b.qArea.qLeft,b.qArea.qTop,b.qArea.qWidth,b.qArea.qHeight);var f,g,j,k=h.intersection(i,!0);return k?(j=Math.max(0,a.qTop-b.qArea.qTop),g=Math.max(0,a.qLeft-b.qArea.qLeft),f=b.qData.slice(j,j+k.height).map(function(a){return a.slice(g,g+k.width)}),c=e(j,k.height,b.qLeft),d=e(g,k.width,b.qTop),{qLeft:c,qTop:d,qData:f,qArea:{qTop:k.y,qLeft:k.x,qWidth:k.width,qHeight:k.height}}):{qLeft:[],qTop:[],qData:[],qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0}}}})}),define("objects.backend-api/cache-cube",["jquery","core.utils/class","util","objects.backend-api/engine-throttle","objects.backend-api/cube-slicer","objects.backend-api/pivot-cube-slicer"],function(a,b,c,d,e,f){var g,h={mode:"S",enabled:!0,debouncing:{enabled:!0,delay:50},height:250,width:250};return g=b.extend("CacheCube",{init:function(a,b,c,g){this.model=a,this.responseProperty=b,this.options={},this.cubeHeight=0,this.cubeWidth=0,this.setOptions(g||{}),this.setPath(c),this.cube="P"===this.options.mode?new f:new e,this.throttle=new d;var h=this;this.throttle.Send.bind(function(a,b){var c=h._getDirections(h.throttle.recentRequests.map(function(a){return{top:a.data[0].qTop,left:a.data[0].qLeft}})),d=h._getAreasToCache(a,c.vertical,c.horizontal);h.cacheData(d,a).then(function(a){h.cube?b.resolve(a):b.reject()},function(){b.reject()})}),this._modelBinding=function(){h.clear()},this.model.Invalidated.bind(this._modelBinding)
},destroy:function(){this.cube.destroy(),this.throttle.destroy(),this.model&&this.model.Invalidated&&this.model.Invalidated.unbind(this._modelBinding),this._modelBinding=null,delete this.model,delete this.throttle,delete this.cube},setMethodName:function(a){this.method=a},setPath:function(a){this.path=a},setCubeSize:function(a){this.cubeHeight=a.qcy,this.cubeWidth=a.qcx},setOptions:function(a){a&&(this.options=c.extend(!0,{},h,this.options,a),this.cacheHeight=this.options.height,this.cacheWidth=this.options.width,this.enabled=this.options.enabled||!1,this.debouncing={enabled:this.options.debouncing.enabled||!1,delay:this.options.debouncing.delay||-1})},clear:function(){this.cube.clear(),this.throttle.clear()},set:function(a){this.clear(),a&&a.length&&this.cube.store(a)},cacheData:function(a,b){return this.model.rpc(this.method,this.responseProperty,[this.path,a]).then(function(a){return this.cube?(this.cube.store(a),this.cube.get(b)):a}.bind(this))},getData:function(b){if(!this.enabled||!this.cubeHeight||!this.cubeWidth)return this.model.rpc(this.method,this.responseProperty,[this.path,b]);var c,d,e=[];for(c=0;c<b.length;++c)d=b[c],e.push({qTop:Math.max(Math.floor(d.qTop),0),qLeft:Math.max(d.qLeft,0),qHeight:Math.min(d.qHeight,this.cubeHeight-Math.floor(d.qTop)),qWidth:Math.min(d.qWidth,this.cubeWidth-d.qLeft)});return this.cube.contains(e)?(this.throttle.updateResolutionTime(),a.Deferred().resolve(this.cube.get(e)).promise()):0===e[0].qTop&&this.cube.isEmpty()?(this.throttle.updateResolutionTime(),this.cacheData(e,e)):this.throttle.queue(e)},_getDirections:function(a){if(!a||a.length<2)return{vertical:0,horizontal:0};var b=a.slice(-2),c=b[1].top-b[0].top,d=b[1].left-b[0].left;return{vertical:0>c?-1:c>0?1:0,horizontal:0>d?-1:d>0?1:0}},_getAreasToCache:function(a,b,c){var d,e,f,g,h,i,j,k,l,m=[];for("undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),d=0;d<a.length;++d)e=Math.floor(.5*Math.max(0,this.cacheHeight-a[d].qHeight)),f=Math.floor(.5*Math.max(0,this.cacheWidth-a[d].qWidth)),g=e*b-e,h=f*c-f,i=Math.max(0,Math.min(Math.max(a[d].qHeight,this.cacheHeight),this.cubeHeight)),j=Math.max(0,Math.min(Math.max(a[d].qWidth,this.cacheWidth),this.cubeWidth)),k=Math.max(0,Math.min(a[d].qTop+g,this.cubeHeight-i)),l=Math.max(0,Math.min(a[d].qLeft+h,this.cubeWidth-j)),m.push({qTop:k,qHeight:i,qLeft:l,qWidth:j});return m}})}),define("objects.backend-api/backend-throttle",["core.utils/class","util","objects.backend-api/engine-throttle"],function(a,b,c){var d,e={enabled:!0,debouncing:{enabled:!0,delay:50}};return d=a.extend({init:function(a,b,d){this.model=a,this.responseProperty=b,this.options={},this.setOptions({}),this.setPath(d),this.throttle=new c,this.throttle.Send.bind(function(a,b){e.model.rpc(e.method,e.responseProperty,[e.path,a]).then(function(a){b.resolve(a)},function(){b.reject()})});var e=this;this._modelBinding=function(){e.clear()},this.model.Invalidated.bind(this._modelBinding)},setMethodName:function(a){this.method=a},setPath:function(a){this.path=a},setOptions:function(a){this.options=b.extend(!0,{},e,this.options,a),this.enabled=this.options.enabled||!1,this.debouncing={enabled:this.options.debouncing.enabled||!1,delay:this.options.debouncing.delay||-1}},clear:function(){this.throttle.clear()},destroy:function(){this.throttle.destroy(),this.model&&this.model.Invalidated&&this.model.Invalidated.unbind(this._modelBinding),this._modelBinding=null,delete this.model,delete this.throttle},set:function(){this.clear()},getData:function(a){return this.enabled?this.throttle.queue(a):this.model.rpc(this.method,this.responseProperty,[this.path,a])}})}),define("objects.backend-api/backend-api",["jquery","core.utils/class","core.utils/deferred","./cache-cube","./backend-throttle","core.models/app"],function(a,b,c,d,e,f){var g;return g=b.extend("BackendApi",{init:function(a,b,c){this.model=a,this.localeInfo=a.session.currentApp.layout.qLocaleInfo,this.path=b,b&&(this.dataPath=b.slice(1,-3)),this.cacheCube=new d(a,"qDataPages",this.path,c),this.backendStackThrottle=new e(a,"qDataPages",this.path)},setCacheOptions:function(a){this.cacheCube.setOptions(a)},updateCache:function(){},applyPatches:function(a){return this.model.rpc("ApplyPatches",null,a)},clearSoftProperties:function(){var a=this;return this.model.getLayout().then(function(b){return b.qHasSoftPatches?a.model.rpc("ClearSoftPatches"):c.resolve()})},beginSelections:function(){return f.current.switchModal(this.model,this.path)},endSelections:function(a){return f.current.switchModal(null,null,a)},clearSelections:function(a){return a=a||0,this.model.rpc("ClearSelections",null,[this.path,[a]])},getDimensionInfos:function(){return this.model.layout[this.dataPath].qDimensionInfo?Array.isArray(this.model.layout[this.dataPath].qDimensionInfo)?this.model.layout[this.dataPath].qDimensionInfo:[this.model.layout[this.dataPath].qDimensionInfo]:[]},getMeasureInfos:function(){return this.model.layout[this.dataPath].qMeasureInfo},getRowCount:function(){return this.model.layout[this.dataPath].qSize.qcy},eachDataRow:function(b){var c=this.model.layout[this.dataPath],d=!0;c&&a.each(c.qDataPages,function(c,e){return a.each(e.qMatrix,function(a,c){return d=b(e.qArea.qTop+a,c)}),d})},drillUp:function(a,b){return this.model.rpc("DrillUp",null,[this.path,a,b])},hasSelections:function(){for(var a=this.getDimensionInfos(),b=0;b<a.length;++b)if(a[b].qStateCounts.qSelected>0)return!0;return!1},inSelections:function(){return this.model.layout.qSelectionInfo&&this.model.layout.qSelectionInfo.qInSelections},destroy:function(){this.cacheCube.destroy(),this.backendStackThrottle.destroy()},getSize:function(){return this.model.layout[this.dataPath].qSize}})}),define("objects.backend-api/snapshot-api",["./backend-api","core.utils/deferred","objects.backend-api/cube-slicer","objects.backend-api/pivot-cube-slicer"],function(a,b,c,d){function e(a,b,c,d){if(a){b.snapshotData.object.origDataPages||(b.snapshotData.object.origDataPages=b.qHyperCube[d]);for(var e=0;e<c.length;e++)c[e].qHeight=Math.min(b.qHyperCube.qSize.qcy,c[e].qHeight),c[e].qTop=b.snapshotData.object.origDataPages[e].qArea.qTop;b.qHyperCube[d]=a.get(c)}}function f(a){if("pivot-table"===a.visualization)this.responseProperty="qPivotDataPages",this.slicer=new d;else{if("table"!==a.visualization)return;this.slicer=new c}this.slicer.store(a.snapshotData.object.origDataPages?a.snapshotData.object.origDataPages:a.qHyperCube[this.responseProperty])}var g;return g=a.extend("SnapshotAPI",{init:function(a){this.responseProperty="qDataPages",f.call(this,a.layout),this._super(a,a.layout.qListObject?"/qListObjectDef":"/qHyperCubeDef")},getData:function(a){var c=b();if("map"===this.model.layout.visualization){var d=this.dataPath.split("/")[1],f=this.dataPath.split("/").lastElement;c.resolve("polygon"===this.model.layout.layers[d].type&&"3"===this.model.layout.layers[d].version?{qDataPages:this.model.layout.layers[d].geodata.qHyperCube[this.responseProperty]}:{qDataPages:this.model.layout.layers[d][f][this.responseProperty]})}else e(this.slicer,this.model.layout,a,this.responseProperty),c.resolve(this.model.layout[this.dataPath][this.responseProperty]);return c.promise},getSize:function(){return this.model.layout[this.dataPath].qSize},isSnapshot:!0})}),define("workbench/mashupapi/qfield",["qvangular","core.utils/deferred","general.models/field"],function(a,b,c){function d(a,c,d,e,f,g,h){var i=new b;return a.waitFor.then(function(){a.field[c](d,e,f,g,h).then(function(){i.resolve()},function(){i.reject()})}),i.promise}function e(d,e,f){var g=this,h=new b;g.waitFor=h.promise,a.$apply(a.$rootScope,function(){c.get(e,f||"$",d).then(function(a){g.field=a,h.resolve()},function(){h.reject()})})}return e.prototype.clear=function(){return d(this,"clear")},e.prototype.lock=function(){return d(this,"lock")},e.prototype.unlock=function(){return d(this,"unlock")},e.prototype.clearOther=function(a){return d(this,"clearOther",a||!1)},e.prototype.selectAll=function(a){return d(this,"selectAll",a||!1)},e.prototype.selectExcluded=function(a){return d(this,"selectExcluded",a||!1)},e.prototype.selectAlternative=function(a){return d(this,"selectAlternative",a||!1)},e.prototype.selectPossible=function(a){return d(this,"selectPossible",a||!1)},e.prototype.toggleSelect=function(a,b){return d(this,"toggleSelect",a,b||!1)},e.prototype.selectMatch=function(a,b){return d(this,"selectMatch",a,b||!1)},e.prototype.select=function(a,b,c){return d(this,"select",a,b||!1,c||!1)},e.prototype.selectValues=function(a,b,c){var e=[];return a.forEach(function(a){e.push("number"==typeof a?{qIsNumeric:!0,qNumber:a}:"string"==typeof a?{qText:a}:a)}),d(this,"selectValues",e,b||!1,c||!1)},e}),define("workbench/mashupapi/qbookmark",["qvangular","client.models/bookmark"],function(a,b){function c(a){this.app=a}return c.prototype.create=function(c,d){var e=this.app;a.$apply(a.$rootScope,function(){b.create({title:c,description:d},e)})},c.prototype.apply=function(c){var d=this.app;a.$apply(a.$rootScope,function(){b.apply(c,d)})},c.prototype.remove=function(c){var d=this.app;a.$apply(a.$rootScope,function(){b.remove(c,d)})},c}),define("core.models/variable",["core.models/base-object","core.models/app","core.utils/deferred","autogenerated/qix/engine-enums"],function(a,b,c,d){var e=d.NxLocalizedErrorCode,f=a.extend("Variable",{getContent:function(){var a=this,b=new c;return this.rpc("GetContent").then(function(a){b.resolve(a)},function(c){c.error.code===e.LOCERR_GENERIC_ABORTED?(a.rpc("GetContent").then(function(a){b.resolve(a)}),c.isHandled=!0):b.reject(c.error)}),b.promise},getRawContent:function(){return this.rpc("GetRawContent")},setContent:function(a,b){return this.rpc("SetContent",null,[a,b||!1])}});return f.get=function(a,c){function d(){return c.rpc("GetVariable","qReturn",[a])}return c=c||b.current,this.getModel(a,c.session,d)},f.create=function(a,c){return c=c||b.current,c.rpc("CreateVariable","qReturn",[a])},f}),define("workbench/mashupapi/qvariable",["core.utils/deferred","core.models/variable"],function(a,b){function c(a,b){this.app=a,this.qapp=b}return c.prototype.create=function(a){return b.create(a,this.app)},c.prototype.setContent=function(c,d){var e=new a;return b.get(c,this.app).then(function(a){a.setContent(d+"").then(function(a){e.resolve(a)},function(a){e.reject(a.error)})},function(a){e.reject(a.error)}),e.promise},c.prototype.getContent=function(c,d){var e=new a,f=this.qapp,g=d?function(a){d(a,f)}:function(){};return b.get(c,this.app).then(function(a){a.getContent().then(function(a){g(a,f),e.resolve(a)},function(a){e.reject(a.error)})},function(a){e.reject(a.error)}),e.promise},c}),define("workbench/mashupapi/qapp",["jquery","qvangular","core.utils/deferred","core.models/session-object","core.models/generic-object","client.models/current-selections","objects.models/visualization-object","client.models/snapshot","objects.backend-api/snapshot-api","workbench/mashupapi/qfield","workbench/mashupapi/qbookmark","workbench/mashupapi/qvariable","workbench/mashupapi/qglobal"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(c,d,e){var f=a(c),g=b.$rootScope.$new(),h="";e&&e.noInteraction&&(h='<div style="width:100%;height:100%;position:relative">'),h+=e&&e.currentSelections?'<qv-stage-current-selections class="qvt-selections"></qv-stage-current-selections>':'<qv-object model="model" options="options"></qv-object>',e&&e.noInteraction&&(h+='<div style="position:absolute;top:0;left:0;width:100%;height:100%;overflow: hidden;"></div>'),e&&e.noInteraction&&(h+="</div>"),f.html(h),g.model=d,g.options=e||{};var i=b.getService("$compile");return i(f.contents())(g),b.$apply(g),g}function o(a){this.fieldCache={},Object.defineProperties(this,{id:{value:a.id},model:{value:a},global:{value:new m(a.session)},bookmark:{value:new k(a)},variable:{value:new l(a,this)}})}var p,q=0;return o.prototype.clearAll=function(){var a=new c,d=this.model;return b.$apply(b.$rootScope,function(){d.rpc("ClearAll",null).then(function(){a.resolve()})}),a.promise},o.prototype.back=function(){var a=new c,d=this.model;return b.$apply(b.$rootScope,function(){d.rpc("Back",null).then(function(){a.resolve()})}),a.promise},o.prototype.forward=function(){var a=new c,d=this.model;return b.$apply(b.$rootScope,function(){d.rpc("Forward",null).then(function(){a.resolve()})}),a.promise},o.prototype.lockAll=function(){var a=new c,d=this.model;return b.$apply(b.$rootScope,function(){d.rpc("LockAll",null).then(function(){a.resolve()})}),a.promise},o.prototype.unlockAll=function(){var a=new c,d=this.model;return b.$apply(b.$rootScope,function(){d.rpc("UnlockAll",null).then(function(){a.resolve()})}),a.promise},o.prototype.getObject=function(a,d,e){var h,i,j=this.model;if(d?"string"==typeof a&&(a=document.getElementById(a)):(d=a,a=void 0),h=new c,"CurrentSelections"===d){if(a){var k=e||{};k.currentSelections=!0,i=n(a,null,k)}f.get(j).then(function(a){a.close=function(){i&&i.$destroy()},h.resolve(a)})}else b.$apply(b.$rootScope,function(){g.get(d,j).then(function(b){a&&(i=n(a,b,e)),b.getLayout().then(function(){b.close=function(){i&&i.$destroy()},h.resolve(b)})},function(a){p&&(p(a.error),a.isHandled=!0),h.reject(a.error)})});return h.promise},o.prototype.getSnapshot=function(a,b){var d=new c;return b||(b=a,a=void 0),h.Snapshot.get(b,this.model).then(function(b){a&&("string"==typeof a&&(a=document.getElementById(a)),n(a,b,{APIType:i,noInteraction:!0})),b.getLayout().then(function(){d.resolve(b)})}),d.promise},o.prototype.getObjectProperties=function(a){return e.getProperties(a,this.model)},o.prototype.getFullPropertyTree=function(a){return e.get(a,this.model).then(function(a){return a.getFullPropertyTree().then(function(){return a})})},o.prototype.createGenericObject=function(a,c){var e=this,f=c?function(a){c(a,e)}:function(){};q++,a.qInfo=a.qInfo||{},a.qInfo.qType=a.qInfo.qType||"mashup",a.qInfo.qId=a.qInfo.qId||"MU"+q;var g=d.get(a,this.model);return b.$apply(b.$rootScope,function(){g.then(function(a){a.getLayout().then(f),a.Invalidated.bind(function(){a.getLayout().then(f)}),a.Aborted.bind(function(){a.getLayout().then(f)})},function(a){p&&(p(a.error,e),a.isHandled=!0)})}),g},o.prototype.destroySessionObject=function(a){return this.model.rpc("DestroySessionObject",null,[a])},o.prototype.createCube=function(a,b){return this.createGenericObject({qHyperCubeDef:a},b)},o.prototype.createList=function(a,b){return this.createGenericObject({qListObjectDef:a},b)},o.prototype.getList=function(a,b){q++;var c={qInfo:{qType:a,qId:"MU"+q}};return"BookmarkList"===a?c.qBookmarkListDef={qType:"bookmark",qData:{title:"/title",description:"/description"}}:"SnapshotList"===a?c.qBookmarkListDef={qType:"snapshot",qData:{title:"/title",libraryTitle:"/libraryTitle",description:"/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}:"CurrentSelections"===a?c.qSelectionObjectDef={}:"DimensionList"===a?c.qDimensionListDef={qType:"dimension",qData:{title:"/title",tags:"/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}:"MeasureList"===a?c.qMeasureListDef={qType:"measure",qData:{title:"/title",tags:"/tags"}}:"sheet"===a?c.qAppObjectListDef={qType:"sheet",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}:"masterobject"===a?c.qAppObjectListDef={qType:"masterobject",qData:{name:"/metadata/name",visualization:"/visualization",tags:"/metadata/tags"}}:c["q"+a+"Def"]={},this.createGenericObject(c,b)},o.prototype.getAppObjectList=function(a,b){return b||(b=a,a="sheet"),this.getList(a,b)},o.prototype.searchSuggest=function(a,b,d){var e=new c;return this.model.rpc("SearchSuggest",null,[b,a]).then(function(a){d&&d(a),e.resolve()},function(){e.reject()}),e.promise},o.prototype.searchAssociations=function(a,b,d,e){var f=new c;return this.model.rpc("SearchAssociations",null,[d||{},a,b]).then(function(a){e&&e(a),f.resolve()},function(){f.reject()}),f.promise},o.prototype.selectAssociations=function(a,b,c,d){return this.model.rpc("SelectAssociations",null,[c||{},b,a,d||!1])},o.prototype.getAppLayout=function(a){var b=this,c=a?function(c){a(c,b)}:function(){},d=b.model.getLayout();return b.model.Invalidated.bind(function(){b.model.getLayout().then(c)}),b.model.Aborted.bind(function(){b.model.getLayout().then(c)}),d.then(c),d},o.prototype.addAlternateState=function(a){return this.model.rpc("AddAlternateState",null,[a])},o.prototype.removeAlternateState=function(a){return this.model.rpc("RemoveAlternateState",null,[a])},o.prototype.doReload=function(a,b,c){return this.model.rpc("DoReload",null,[a||0,b||!1,c||!1])},o.prototype.doSave=function(a){return this.model.rpc("DoSave",null,[a])},o.prototype.field=function(a,b){var c=b?a+"/"+b:a;return this.fieldCache[c]||(this.fieldCache[c]=new j(this.model,a,b)),this.fieldCache[c]},o.setErrorCallback=function(a){p=a},o}),define("client.utils/state",["core.utils/notification","general.controllers/route-controller","qvangular"],function(a,b,c){var d,e,f,g,h,i,j={};return j.States={analysis:0,edit:1,snapshot:2,play:3,editstory:4},j.Views={overview:0,sheet:1,story:2,object:3,masterObject:4},a.mixin(j),j.notification("StateChanged"),j.notification("SheetChanged"),j.notification("StoryChanged"),j.setState=function(a){a!==e&&(h=e,e=a,j.StateChanged.emit(d,e,i,h),d===j.Views.sheet||d===j.Views.object||d===j.Views.masterObject?b.setUrl(b.buildUrl("sheet",f.layout.qInfo.qId,"state",Object.keys(j.States)[a])):d===j.Views.story&&b.setUrl(b.buildUrl("story",f.layout.qInfo.qId,"state",Object.keys(j.States)[a],"slide",g)))},j.setView=function(a){a!==d&&(i=d,d=a,a===j.Views.overview&&(f=null),j.StateChanged.emit(d,e,i,h))},j.setSheet=function(a,b){var c=!1;a!==f&&(f=a,i=d,d=j.Views.sheet,j.SheetChanged.emit(a),c=!0),j.States[b]!==e&&(h=e,e=j.States[b]||j.States.analysis,c=!0),c&&j.StateChanged.emit(d,e,i,h)},j.setStory=function(a,b,c){var k=!1;a!==f&&(f=a,i=d,d=j.Views.story,j.StoryChanged.emit(a),k=!0),g=c,j.States[b]!==e&&(h=e,e=j.States[b]||j.States.editstory,k=!0),k&&j.StateChanged.emit(d,e,i,h)},j.isInAnalysisMode=function(){return e===j.States.analysis},j.isInEditMode=function(){return e===j.States.edit},j.isInSnapshotMode=function(){return e===j.States.snapshot},j.inStoryPlayState=function(){return j.inStorytelling()&&e===j.States.play},j.inStorytelling=function(){return d===j.Views.story},j.inAppOverView=function(){return d===j.Views.overview},j.inSheetView=function(){return d===j.Views.sheet},j.inObjectView=function(){return d===j.Views.object},j.inMasterObjectView=function(){return d===j.Views.masterObject},j.getModel=function(){return j.model},Object.defineProperties(j,{state:{get:function(){return e}},view:{get:function(){return d}},model:{get:function(){return f}}}),c.$rootScope.State=j,j}),define("general.utils/touch-configuration-util",["jquery","touche"],function(a,b){function c(){a(document.body.parentElement).addClass(b.utils.msPointer&&0===window.navigator.msMaxTouchPoints?"touch-off":"touch-"+(a.support.touch?"on":"off"))}return{configureTouchSupport:c}}),function(){define("xsrfplugin",["jquery"],function(a){function b(a){var b,c,d="";for(b=0;a>b;b++)c=Math.floor(62*Math.random()),d+=10>c?c:String.fromCharCode(c>9&&36>c?c+55:c+61);return d}function c(){var c,d;e||(e=!0,c=b(16),d=a.ajax,a.extend({ajax:function(a){if(a.headers||(a.headers={}),a.headers["X-Qlik-XrfKey"]=c,"GET"===a.type)void 0===a.data&&(a.data={}),a.data.xrfkey=c;else if(a.url){var b=-1===a.url.indexOf("?")?"?":"&";a.url+=b+"xrfkey="+c}return d.call(this,a)}}))}function d(){e=!1}var e=!1;return{getRandomString:b,setupXsrfPlugin:c,resetHasBeenSetup:d}})}(),define("general.services/content-api/content-api",["qvangular","core.utils/deferred","translator","xsrfplugin"],function(a,b,c,d){return a.service("$contentApi",["$http",function(e){function f(a){a.headers||(a.headers={})}function g(a){a.params||(a.params={})}function h(a){return a.headers["X-Qlik-XrfKey"]=m,a.params.xrfkey=m,a}function i(a){var b=require.toUrl(""),c=b.indexOf("/resources");return c>-1&&(b=b.substring(0,c)),a.url=b+a.url,a}function j(a){var b=c.language;return b&&(a.headers["Accept-Language"]="pseudo"!==b?b:"qps-ploc"),a}function k(b){return f(b),g(b),a.$rootScope.isPersonalMode||h(b),i(b),j(b),e(b)}function l(){var a=new b,c={method:"GET",url:"/qrs/extension/schema"};return k(c).then(function(b){var c=b.data;a.resolve(c)})["catch"](function(b){var c=b.data;a.reject(c)}),a.promise}var m=d.getRandomString(16);return{getExtensions:l,request:k}}])}),define("general.models/library/extension-list",["core.utils/deferred","general.services/content-api/content-api"],function(a,b){var c={},d=null;return c.getList=function(){return null===d&&(d=new a,b.getExtensions().then(function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push({id:c,data:a[c]});d.resolve(b)},function(){var a=[];d.resolve(a)})),d.promise},c}),define("qlikui/factory",["assets/qvangular/qvangular-core"],function(a){function b(b,c){if(!b)throw new Error("Name is undefined.");if(!c.template)throw new Error("Template is undefined.");var d={restrict:"E",replace:!0,transclude:null!=c.transclude?c.transclude:!0,template:c.template,requires:c.requires,scope:null!=c.scope?c.scope:"=",controller:c.controller||function(){},link:c.link||function(){}};return a.directive(b,function(){return d}),d}var c={component:b};return c}),define("text!assets/qlikui/components/qui-dialog-default/qui-dialog-default.html",[],function(){return'<div class="qui-delayedModal delayedModal qui-delayedmodal" ng-transclude>\r\n	<!-- This will be replaced by ng-transclude -->\r\n</div>'}),define("assets/qlikui/components/qui-dialog-default/qui-dialog-default",["qlikui/factory","text!assets/qlikui/components/qui-dialog-default/qui-dialog-default.html"],function(a,b){a.component("quiDialogDefault",{template:b})}),define("text!assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait.html",[],function(){return'<div>\r\n	<qui-dialog-default>\r\n		<header class="dm-header" q-translation="Common.PleaseWait">#Working#</header>\r\n		<main class="dm-main">\r\n			<p class="qui-pleasewaitdialog-loader-container"><img src="/resources/img/loader.svg"/></p>\r\n\r\n			<p class="qui-pleasewaitdialog-pleasewait" q-translation="Common.PleaseWait"></p>\r\n		</main>\r\n		<footer class="dm-footer">\r\n		</footer>\r\n	</qui-dialog-default>\r\n</div>'}),define("assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait",["qlikui/factory","text!assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait.html"],function(a,b){a.component("quiDialogPleasewait",{template:b})}),define("text!assets/qlikui/components/qui-dialog-alert/qui-dialog-alert.html",[],function(){return'<div>\r\n	<qui-dialog-default>\r\n		<header class="dm-header">\r\n			This is the header\r\n		</header>\r\n		<main class="dm-main">\r\n			This is a simple example of an alert box\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<button class="qui-button" ng-click="close()">Close me</button>\r\n		</footer>\r\n	</qui-dialog-default>\r\n</div>'}),define("assets/qlikui/components/qui-dialog-alert/qui-dialog-alert",["qlikui/factory","text!assets/qlikui/components/qui-dialog-alert/qui-dialog-alert.html"],function(a,b){a.component("quiDialogAlert",{template:b,scope:{onClose:"&"},controller:["$scope",function(a){a.close=function(){a.onClose()}}]})}),define("assets/qlikui/components/qui-input-number/numerical-interval-transformer",[],function(){function a(a){return Number(String(a).replace(/[^-\d]/g,""))}return{getNumerical:function(b,c,d){return b=a(b),c=Number(c),d=Number(d),c>b?c:0!==d&&b>d?d:b}}}),define("text!assets/qlikui/components/qui-input-number/qui-input-number.ng.html",[],function(){return'<span>\r\n	<input class="qui-button" type="button" value="-" qva-activate="onChange(-1)" ng-disabled="quiDisabled" ng-if="quiWithButtons"/>\r\n\r\n	<input type="tel" class="qui-input {{quiClass}}" title="{{quiTitle}}" ng-model="quiModel" ng-change="onChange()" ng-disabled="quiDisabled"/>\r\n\r\n	<input class="qui-button" type="button" value="+" qva-activate="onChange(1)" ng-disabled="quiDisabled" ng-if="quiWithButtons"/>\r\n</span>\r\n'}),define("assets/qlikui/components/qui-input-number/qui-input-number",["qlikui/factory","assets/qlikui/components/qui-input-number/numerical-interval-transformer","text!./qui-input-number.ng.html"],function(a,b,c){a.component("quiInputNumber",{template:c,scope:{quiModel:"=",quiDisabled:"=",quiTitle:"@",quiMin:"@",quiMax:"@",quiClass:"@",quiSelectTextOnFocus:"@",quiWithButtons:"@"},controller:["$scope","$element",function(a,c){a.quiSelectTextOnFocus&&(a.selected=!1,c.click(function(){a.selected===!1&&(c.select(),a.selected=!0)}),c.blur(function(){a.selected=!1})),a.onChange=function(d){var e=parseInt(d)||0;a.quiModel=b.getNumerical(parseInt(c.find(".qui-input").val())+e,a.quiMin,a.quiMax)}}]})}),define("text!assets/qlikui/components/qui-modal-default/qui-modal-default.html",[],function(){return'<div class="qui-modalbackground"></div>'}),define("assets/qlikui/components/qui-modal-default/qui-modal-default",["qlikui/factory","text!assets/qlikui/components/qui-modal-default/qui-modal-default.html"],function(a,b){a.component("quiModalDefault",{template:b})}),define("text!assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup.html",[],function(){return'<div>\r\n	<label class="qui-radiobutton" ng-repeat="option in options" ng-class="{ \'qui-checked\' : option.value === quiSelectedValue, \'qui-disabled\': quiDisabled }">\r\n		<input type="radio" name="{{quiGroupName}}" value="{{option.value}}" ng-disabled="quiDisabled">\r\n		<div class="radio-wrap" ng-click="selected(option.value)">\r\n			<span class="radio"></span>\r\n			<span class="radio-text">{{option.label}}</span>\r\n			<div></div>\r\n		</div>\r\n	</label>\r\n</div>'}),define("assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup",["qlikui/factory","text!assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup.html","translator"],function(a,b,c){a.component("quiRadiobuttongroup",{template:b,scope:{quiGroupName:"@",quiOptions:"@",quiTranslateKeys:"@",quiSelectedValue:"=",quiDisabled:"="},controller:["$scope",function(a){function b(){for(var b=JSON.parse(a.quiOptions),d=[],e=0;e<Object.keys(b).length;e++){var f=Object.keys(b)[e],g=b[f];d.push({label:a.quiTranslateKeys?c.get(f):f,value:g})}a.options=d}a.selected=function(b){a.quiSelectedValue=b},a.isChecked=function(b){return a.quiSelectedValue===b?"checked":""},b()}]})}),define("text!assets/qlikui/components/qui-checkbox/qui-checkbox.html",[],function(){return'<label class="qui-checkboxicon" title="{{quiTitle}}" ng-class="{ \'qui-hover\': hover }" ng-mouseenter="hover = true" ng-mouseleave="hover = false">\r\n	<input type="checkbox" ng-model="quiModel" ng-disabled="quiDisabled">\r\n		<div class="check-wrap">\r\n			<span class="check"></span>\r\n			<span class="check-text">{{quiLabel}}</span>\r\n		</div>\r\n</label>\r\n'}),define("assets/qlikui/components/qui-checkbox/qui-checkbox",["qlikui/factory","text!assets/qlikui/components/qui-checkbox/qui-checkbox.html"],function(a,b){a.component("quiCheckbox",{template:b,scope:{quiModel:"=",quiDisabled:"=",quiLabel:"@",quiTitle:"@"}})}),define("text!assets/qlikui/components/qui-radiobutton/qui-radiobutton.html",[],function(){return'<label class="qui-radiobutton" ng-class="{ \'qui-disabled\': quiDisabled, \'qui-hover\': hover }" title="{{quiTitle}}" qva-activate="focus()" ng-mouseenter="hover = true" ng-mouseleave="hover = false">\r\n    <input type="radio" value="{{quiValue}}" ng-model="quiModel" ng-disabled="quiDisabled" ng-change="quiChange" name="{{quiName}}">\r\n    <div class="radio-wrap" qva-tabindex="{{tabindex}}">\r\n        <span class="radio"></span>\r\n        <span class="radio-text">{{quiLabel}}</span>\r\n    </div>\r\n</label>\r\n'}),define("assets/qlikui/components/qui-radiobutton/qui-radiobutton-logic-factory",[],function(){function a(a){function b(){a.tabindex=a.quiDisabled?-1:a.quiTabindex}function c(b){a.quiDiasabled||32===b.keyCode&&(a.quiModel=a.quiValue,a.$apply())}return a.quiTabindex||(a.quiTabindex=0),b(),{select:c,updateTabindex:b}}return{createRadioButtonLogic:function(b){return new a(b)}}}),define("assets/qvangular/qvangular-tabindex/qvangular-tabindex-logic",[],function(){function a(a,b){0>a?b[0].removeAttribute("tabindex"):b[0].setAttribute("tabindex",a)}return{updateTabindex:a}}),define("assets/qvangular/qvangular-tabindex/qvangular-tabindex",["assets/qvangular/qvangular-core","assets/qvangular/qvangular-tabindex/qvangular-tabindex-logic"],function(a,b){a.directive("qvaTabindex",function(){return{restrict:"A",scope:{qvaTabindex:"@"},controller:["$scope","$element",function(a,c){a.$watch("qvaTabindex",function(a){b.updateTabindex(a,c)})}]}})}),define("assets/qlikui/components/qui-radiobutton/qui-radiobutton",["qlikui/factory","text!assets/qlikui/components/qui-radiobutton/qui-radiobutton.html","assets/qlikui/components/qui-radiobutton/qui-radiobutton-logic-factory","assets/qvangular/qvangular-tabindex/qvangular-tabindex","translator"],function(a,b,c){a.component("quiRadiobutton",{template:b,scope:{quiLabel:"@",quiTitle:"@",quiValue:"@",quiName:"@",quiTabindex:"@",quiModel:"=",quiDisabled:"=",quiChange:"="},controller:["$scope","$element","$timeout",function(a,b,d){d(function(){function d(a){e.select(a)}var e=c.createRadioButtonLogic(a);a.$watch("quiDisabled",e.updateTabindex),a.focus=function(){b[0].querySelector(".radio-wrap").focus()},b.on("keydown",d)})}]})}),define("text!assets/qlikui/components/qui-float/qui-float.html",[],function(){return'<div class="qui-float" ng-style="{top:top, left:left}" ng-show="visible" qva-reported-window-size="reportedWindowSize">\r\n	<div ng-transclude></div>\r\n</div>'}),define("assets/qlikui/components/qui-float/qui-float",["qlikui/factory","text!assets/qlikui/components/qui-float/qui-float.html"],function(a,b){a.component("quiFloat",{template:b,replace:!0,scope:{quiOffset:"=",quiResizeOnChange:"="},transclude:!0,controller:["$scope","$element","$timeout",function(a,b,c){function d(){a.quiOffset&&a.reportedSize&&a.reportedWindowSize?(a.left=a.quiOffset.left+a.reportedSize.width<a.reportedWindowSize.width?a.quiOffset.left:a.reportedWindowSize.width-a.reportedSize.width,a.top=a.quiOffset.top+a.reportedSize.height<a.reportedWindowSize.height?a.quiOffset.top:a.reportedWindowSize.height-a.reportedSize.height,a.visible=!0):a.visible=!1}function e(){c(function(){a.reportedSize={width:b.outerWidth(),height:b.outerHeight()}})}a.$watch("quiResizeOnChange",e,!0),a.$watch("[quiOffset, reportedSize, reportedWindowSize]",d,!0)}]})}),define("text!assets/qlikui/components/qui-button/qui-button.html",[],function(){return'<button class="{{className}}" ng-transclude></button>'}),define("assets/qlikui/components/qui-button/qui-button",["qlikui/factory","text!assets/qlikui/components/qui-button/qui-button.html"],function(a,b){function c(a,b){var c=["qui"];c.push(b?"outlinebutton":"button"),a.className=c.join("-")}var d=13;a.component("quiButton",{template:b,scope:{theme:"@"},controller:["$scope","$element","$attrs",function(a,b,e){c(a,e.hasOwnProperty("outline")),b.on("keypress",function(a){a.keyCode===d&&b.trigger("qv-activate")})}]})}),define("text!assets/qlikui/components/qui-popover-button/qui-popover-button.ng.html",[],function(){return'<button\r\n		class="qui-popover-button qui-dropdown"\r\n		tid="{{quiModel.tid}}"\r\n		data-ng-disabled="quiModel.isDisabled()"\r\n		data-ng-class="buttonClasses"\r\n		data-icon="{{quiModel.icon}}"\r\n		q-title-translation="{{currentTitle}}"\r\n		data-qva-activate="onClick()"></button>'}),define("text!assets/qlikui/components/qui-popover-button/qui-popover-button-menu.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" smallview="quiModel.menuOptions.smallview" position="quiModel.menuOptions.position" width="quiModel.menuOptions.width" top="quiModel.menuOptions.top" hidepointer="quiModel.menuOptions.hidepointer" on-close-view="onClose(event)">\r\n	<div qva-include-qui-popover-button component=\'quiList\' input="quiModel.menuOptions.content" data-destroy-component="closeFromContent()"></div>\r\n</immidiate-contextual>'
}),define("general.services/show-service/show-service",["jquery","qvangular","ng!$q"],function(a,b,c){function d(){if(!i){var b=a("<div id='show-service-popup-dialog'></div>");a("body").append(b),b.showComponent(k,{views:j}),i=!0}}function e(a,b){function e(){var a=j.indexOf(g);a>=0&&j.splice(a,1)}d();var f=c.defer(),g={component:a,input:b,deferredResult:f,exposedApi:{destroy:e,resultPromise:f.promise}};return j.push(g),g.exposedApi}function f(c,d){var e={$element:a("body"),input:d};for(var f in d)d.hasOwnProperty(f)&&(e[f]=d[f]);return b.$injector.invoke(c,{},e)}function g(a,b){return"function"==typeof a||Array.isArray(a)?f(a,b):e(a,b)}function h(){return j.length>0}var i,j=[];b.componentDirective("qvShowServiceView",{destroyComponent:"&",input:"=",deferredResult:"=",exposedApi:"="});var k={template:"<div><div ng-repeat='view in views' qv-show-service-view component='view.component' data-input='view.input' data-deferred-result='view.deferredResult' destroy-component='unshow(view)' data-exposed-api='view.exposedApi'></div></div>",controller:["$scope",function(a){a.unshow=function(b){var c=a.views.indexOf(b);c>=0&&a.views.splice(c,1)}}]},l={show:g,isViewShowing:h};return l}),define("text!assets/qlikui/components/qui-list/qui-list.ng.html",[],function(){return'<ul ng-class="menuClasses" tid="{{tid}}">\r\n	<li class="toolbar-menu-li" ng-repeat="menuItem in menuItems" data-icon="{{menuItem.icon}}" ng-disabled="menuItem.disable" q-title-translation="{{ menuItem.title || menuItem.text}}" qui-click=\'menuItem.fn()\' ng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}" ng-hide="menuItem.hide">\r\n		<span class="qui-textlist-text"\r\n			  tid="{{menuItem.tid}}"\r\n			  ng-class="{\'open-in-new-tab-text-optional\': menuItem.openInNewTab == \'optional\', \'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}"\r\n			  qva-activate="selectMenuItem(menuItem, $event)" q-translation="{{menuItem.text}}" ng-disabled="menuItem.disable">\r\n		</span>\r\n		<span ng-if="menuItem.openInNewTab" class="open-in-new-tab" ng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}" data-icon="stacked-windows" qva-activate="selectMenuItem(menuItem, $event, \'true\')" q-title-translation="{{menuItem.title || Tooltip.OpenInNewTab}}" ng-disabled="menuItem.disable"></span>\r\n	</li>\r\n</ul>'}),define("assets/qlikui/components/qui-list/qui-list",["qlikui/factory","text!assets/qlikui/components/qui-list/qui-list.ng.html"],function(a,b){return a.component("quiList",{scope:{tid:"=",menuClasses:"=",createMenuItems:"="},template:b,controller:["$scope",function(a){a.menuClasses=a.menuClasses?a.menuClasses:"qui-textlist",a.createMenuItems().then(function(b){a.menuItems=b}),a.selectMenuItem=function(b,c,d){c&&c.preventDefault&&c.preventDefault(),b.disable||(a.destroyComponent(),b.selected(c,d))}}]})}),define("pubsub",[],function(){function a(){this.topics={},this.wildcards=[]}return a.prototype.getTopics=function(a,b){var c=this.topics[a];return"undefined"==typeof c&&b&&(c=this.topics[a]=[]),c},a.prototype.createMatcher=function(a){return a=a.replace(/\$/g,"\\$"),new RegExp("^"+a.replace(/\*/g,".+?")+"$","i")},a.prototype.subscribe=function(a,b,c){if(a=a.toLowerCase().split("."),"function"!=typeof b)throw"pubsub: Invalid handler";var d={handler:b,topic:a[0],namespace:a[1],context:c||window};a[0].indexOf("*")>-1?(d.matcher=this.createMatcher(a[0]),this.wildcards.push(d)):this.getTopics(a[0],!0).push(d)},a.prototype.subscribeOnce=function(a,b,c){function d(){b.apply(this,arguments),e.unsubscribe(a,b)}var e=this;d.original=b,this.subscribe(a,d,c)},a.prototype.unsubscribe=function(a,b){a=a.toLowerCase(),this["."===a[0]?"unsubscribeNamespace":"unsubscribeTopic"](a,b)},a.prototype.unsubscribeNamespace=function(a){function b(b){return b.namespace!==a}a=a.substr(1);var c;this.wildcards=this.wildcards.filter(b);for(c in this.topics)this.topics[c]=this.topics[c].filter(b),this.topics[c].length||delete this.topics[c]},a.prototype.unsubscribeTopic=function(a,b){function c(c){var d=c.topic!==a[0];return!d&&b&&(d=c.handler.original?c.handler.original!==b:c.handler!==b),d}a=a.split(".");var d=this.getTopics(a[0]);this.wildcards=this.wildcards.filter(c),d&&(d=this.topics[a[0]]=d.filter(c),d.length||delete this.topics[a[0]])},a.prototype.publish=function(a,b){function c(c){(!c.matcher||c.matcher&&c.matcher.test(a[0]))&&c.handler.call(c.context,b,a[0])}a=a.toLowerCase().split(".");var d=this.getTopics(a[0]);this.wildcards.forEach(c),d&&d.forEach(c)},window.pubsub=new a,window.pubsub}),define("general.utils/android-keyboard-fix",[],function(){function a(a,b,c){this.lastHeight=null,this.document=c||document,this.window=b||window,this.viewport=a||this.document.querySelector("meta[name=viewport]"),this.viewportContent=this.viewport.getAttribute("content"),this.updateHeight()}return a.prototype.clearHeight=function(){this.viewport.setAttribute("content",this.viewportContent)},a.prototype.setHeight=function(a){this.viewport.setAttribute("content",this.viewportContent+", height="+a)},a.prototype.updateHeight=function(){var a=this.window.innerHeight;return this.lastHeight!==a?(this.lastHeight=a,this.setHeight(a),!0):!1},a.prototype.rotate=function(a){var b=function(){this.updateHeight()&&a()}.bind(this);this.document.activeElement&&this.document.activeElement.blur(),this.clearHeight(),this.window.setTimeout(b,500),this.window.setTimeout(b,1e3),this.window.setTimeout(b,1500)},a.isNeeded=function(){var a=navigator.userAgent.toLowerCase().indexOf("android")>-1;return a},a}),define("core.utils/resize",["touche","pubsub","general.utils/android-keyboard-fix"],function(a,b,c){function d(a){k=!0,f("/resize/start",a)}function e(a){f("/resize/end",a),k=!1}function f(a,c){b.publish(a,{width:window.innerWidth,height:window.innerHeight,element:c.target})}function g(a){(a.target===window||a.target===document)&&(k||d(a),clearTimeout(i),f("/resize/update",a),i=setTimeout(function(){e(a)},j))}function h(a){l?l.rotate(function(){d(a),e(a)}):(d(a),e(a))}var i,j=250,k=!1,l=c.isNeeded()?new c:null;return a.utils.touch&&"ondeviceorientation"in window?window.addEventListener("orientationchange",h,!1):window.addEventListener("resize",g,!1),{on:function(a,c){b.subscribe("/resize/"+a,c)},off:function(a,c){b.unsubscribe("/resize/"+a,c)},force:function(a){a=a||"end",b.publish("/resize/"+a)}}}),define("general.utils/window-positioner",["jquery","objects.utils/shapes/rect"],function(a,b){function c(c,d){var e,f,g=a("body").outerHeight();return e=d.y+d.height/2-c.height/2,e=0>e?0:e,g-e-c.height<0&&(e=g-c.height),f=d.x+d.width,new b(f,e,c.width,c.height)}function d(c,d){var e,f,g=a("body").outerWidth();return f=d.x+d.width/2-c.width/2,f=0>f?0:f,g-f-c.width<0&&(f=g-c.width),e=d.y+d.height,new b(f,e,c.width,c.height)}function e(c,d){var e,f,g=a("body").outerHeight();return e=d.y+d.height/2-c.height/2,e=0>e?0:e,g-e-c.height<0&&(e=g-c.height),f=d.x-c.width,new b(f,e,c.width,c.height)}function f(c,d){var e,f,g=a("body").outerWidth();return f=d.x+d.width/2-c.width/2,f=0>f?0:f,g-f-c.width<0&&(f=g-c.width),e=d.y-c.height,new b(f,e,c.width,c.height)}function g(a){var c=a[0]===window?{left:0,top:0}:a.offset();return new b(c.left,c.top,a.outerWidth(),a.outerHeight())}function h(a,b,g){var h,i={top:f,right:c,bottom:d,left:e};return h=i[g]||c,h.call({},a,b)}function i(a){var b="bottom,bottomLeft,bottomRight,centerLeft,center,centerRight,topLeft,top,topRight,topLeft".split(",");if(-1===b.indexOf(a))throw new Error("Not a valid docking position. Try "+b.join(" ,")+".")}function j(a,b,c){return"right"===a?b.getRight()-c.getRight():"left"===a?c.x-b.x:"top"===a?c.y-b.y:"bottom"===a?b.getBottom()-c.getBottom():0}function k(a){var b={top:"bottom",right:"left",bottom:"top",left:"right"};return b[a]}function l(a){return"flip"===a||"flipfit"===a}function m(a){return"fit"===a||"flipfit"===a}function n(a){var b={top:"vertical",right:"horizontal",bottom:"vertical",left:"horizontal"};return b[a]}function o(a){var b={vertical:["top","bottom"],horizontal:["left","right"]};return b[a]}function p(a){var b={horizontal:"vertical",vertical:"horizontal"};return b[a]}function q(a){var b=a.collision.split(" "),c={horizontal:b[0],vertical:b[1]||b[0]},d=n(a.position),e=p(d);return{flipPrimary:l(c[d]),fitPrimary:m(c[d]),fitSecondary:m(c[e])}}function r(a,b,c){var d,e;for(d=0;d<b.length;d++){if(e=b[d],"left"===e&&a.x<c.x){a.x=c.x;break}if("right"===e&&a.getRight()>c.getRight()){a.x=c.getRight()-a.width;break}if("top"===e&&a.y<window.y){a.y=window.y;break}if("bottom"===e&&a.getBottom()>c.getBottom()){a.y=c.getBottom()-a.height;break}}return a}var s={align:function(b,c,d){if(d=d||{position:"right",collision:"none"},d.position=d.position||"right",d.collision=d.collision||"none",b&&c){var e,f=g(a(window)),i=g(b),l=g(c),m=q(d),s=h(i,l,d.position);e=function(a){var b=h(i,l,k(d.position)),c=j(d.position,a,f),e=j(k(d.position),b,f);return c>e},m.flipPrimary&&j(d.position,s,f)>0&&e(s)&&(s=h(i,l,k(d.position)),d.position=k(d.position)),m.fitPrimary&&(s=r(s,[d.position],f)),m.fitSecondary&&(s=r(s,o(p(n(d.position))),f)),d.limits&&s.y<d.limits.top&&(s.y=d.limits.top),b.offset({top:s.y,left:s.x})}return d.position},alignToCoordinate:function(b,c,d,e){i(e);var f,g;e=e||"top",f=function(a,c,d){var e=c,f=d;switch(a){case"topRight":f=d-b.outerHeight();break;case"top":e=c-b.outerWidth()/2,f=d-b.outerHeight();break;case"topLeft":e=c-b.outerWidth(),f=d-b.outerHeight();break;case"centerRight":f=d-b.outerHeight()/2;break;case"center":e=c-b.outerWidth()/2,f=d-b.outerHeight()/2;break;case"centerLeft":e=c-b.outerWidth(),f=d-b.outerHeight()/2;break;case"bottom":e=c-b.outerWidth()/2;break;case"bottomLeft":e=c-b.outerWidth();break;case"bottomRight":e=c,f=d}return{x:e,y:f}},g=f(e,c,d);var h,j,k,l,m,n;return h=a(window),n=10,j=n,k=h.outerWidth()-b.outerWidth()-n,g.x=Math.max(j,Math.min(k,g.x)),l=n,m=h.outerHeight()-b.outerHeight()-n,g.y=Math.max(l,Math.min(m,g.y)),b.offset({left:g.x,top:g.y}),e}};return s}),define("general.utils/arrow-positioner",[],function(){function a(a){var b={left:"right",right:"left",top:"bottom",bottom:"top"};return b[a]}function b(b,c,d,e){var f,g,h=a(d),i={left:{width:0,height:.5},right:{width:1,height:.5},top:{width:.5,height:0},bottom:{width:.5,height:1}},j=i[h],k=b.outerWidth(),l=b.outerHeight(),m=e.outerWidth(),n=e.outerHeight();"left"===h||"right"===h?(f=j.width*(k-n),g=c.offset().top+c.outerHeight()*(1-j.height)-b.offset().top-m*(1-j.height)):(f=c.offset().left+c.outerWidth()*(1-j.width)-b.offset().left-m*(1-j.width),g=j.height*(l-n)),e.css({left:parseInt(f,10),top:parseInt(g,10)})}function c(b,c,d,f,g){var h,i,j=a(f),k={left:{width:0,height:.5,size:-1.5},right:{width:1,height:.5,size:.5},top:{width:.5,height:0,size:-1},bottom:{width:.5,height:1,size:1}},l=k[j],m=b.outerWidth(),n=b.outerHeight(),o=g.outerWidth(),p=g.outerHeight();"left"===j||"right"===j?(h=l.width*(m-p)+p*l.size,i=d-b.offset().top-p*(1-l.height)):(h=c-b.offset().left-o*(1-l.width),i=l.height*(n-p)+p*l.size),g.css({left:e(h),top:e(i)})}function d(b,c,d){var e,f,g=a(c),h={left:{width:0,height:.5},right:{width:1,height:.5},top:{width:.5,height:0},bottom:{width:.5,height:1}},i=h[g],j=b.outerWidth(),k=b.outerHeight(),l=d.outerWidth(),m=d.outerHeight();"left"===g||"right"===g?(e=i.width*(j-m),f=d.offset().top-l*(1-i.height)):(e=j*(1-i.width)-l*(1-i.width),f=i.height*(k-m)+m),d.css({left:e,top:f})}var e=Math.floor;return{align:b,alignToParent:d,alignToCoordinate:c}}),define("text!general.components/immidiate-contextual/immidiate-contextual.ng.html",[],function(){return"<div class='qui-immidiateContextual' qva-outside='onOutsidePopover($event)'>\r\n    <div class='immidiate-contextual-arrow' ng-hide='hidepointer'></div>\r\n    <div class='content' ng-transclude></div>\r\n</div>\r\n"}),define("text!general.components/immidiate-contextual/immidiate-contextual-small.ng.html",[],function(){return"<div class='qui-immidiateContextual-small' qva-activate='onOutsidePopover($event)'>\r\n    <div class='immidiate-contextual-arrow' ng-hide='hidepointer'></div>\r\n    <div class='content' ng-transclude></div>\r\n</div>\r\n"}),/*!
 * mqa.js
 * https://github.com/peol/mqa.js/
 * MIT/GPL Dual License, use whatever fits your project.
 * Copyright(C) Andre Hansson (@peolanha) 2013
 */
function(a,b){function c(a){return Array.prototype.slice.apply(a)}function d(a){return function(b){var c=i[a];c&&(g("Media query triggered for alias",a),c.forEach(function(a){a(b.matches)}))}}function e(a){var b=matchMedia(k[a]),c=j[a]=d(a);c.mql=b,g("Binding",a),b.addListener(c)}function f(a){var b=j[a];b&&(g("Unbinding",a),b.mql.removeListener(b)),delete i[a],delete j[a]}function g(){if(h){var a=c(arguments);a.unshift("[mqa.js]"),console.log.apply(console,a)}}var h=!1,i={},j={},k={},l=location.origin||location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),m={};m.add=function(a,b){g("Creating alias",a,"with query",b),k[a]=b},m.remove=function(a){g("Removing alias",a);var b=k.hasOwnProperty(a);return b&&(f(a),delete k[a]),b},m.parse=function(){g("Parsing CSS rules"),c(b.styleSheets).forEach(function(a){var b=a.href&&0!==a.href.indexOf("/")&&0!==a.href.indexOf(l);try{if(b||null===a.cssRules)return}catch(d){return}c(a.cssRules).forEach(function(a){if(a&&a instanceof CSSMediaRule){var b=/#-mqa-alias-(\w+)\s*?\{/.exec(a.cssText);b&&m.add(b[1],a.media.mediaText)}})})},m.on=function(a,b){var c=i[a];c||(c=[],e(a)),c.push(b),i[a]=c,g("Added new listener on",a,b)},m.off=function(a,b){var c=i[a];if(c){var d=c.indexOf(b);c.splice(d,1),c.length||f(a)}g("Removed listener from",a,b)},m.match=function(a){var b=k[a],c=!1;return b&&(c=matchMedia(b).matches),c},Object.defineProperty(m,"queries",{get:function(){return JSON.parse(JSON.stringify(k))}}),m.parse(),"function"==typeof define&&define.amd?define("mqa",m):a.mqa=m}(window,document),define("general.utils/responsive-state",["mqa","core.utils/notification"],function(a,b){var c,d,e={};return e.Orientation={portrait:"portrait",landscape:"landscape"},b.mixin(e),e.notification("ViewChanged"),e.notification("OrientationChanged"),c=a.match("smalldevice"),d=a.match("portrait")?e.Orientation.portrait:e.Orientation.landscape,a.on("smalldevice",function(a){c=a,e.ViewChanged.emit(c)}),"undefined"==typeof window.orientation?a.on("portrait",function(a){d=a?e.Orientation.portrait:e.Orientation.landscape,e.OrientationChanged.emit(d)}):window.onorientationchange=function(){d=e.Orientation.landscape,(0===window.orientation||180===window.orientation)&&(d=e.Orientation.portrait),e.OrientationChanged.emit(d),c&&d===e.Orientation.landscape&&window.scrollTo&&window.scrollTo(0,0)},Object.defineProperties(e,{isSmallDevice:{get:function(){return c}},orientation:{get:function(){return d}}}),e}),define("general.components/immidiate-contextual/immidiate-contextual",["jquery","general.utils/window-positioner","general.utils/arrow-positioner","text!general.components/immidiate-contextual/immidiate-contextual.ng.html","text!general.components/immidiate-contextual/immidiate-contextual-small.ng.html","assets/qvangular/qvangular-core","ng!$timeout","core.utils/resize","general.utils/dom-util","general.utils/responsive-state"],function(a,b,c,d,e,f,g,h,i,j){f.directive("immidiateContextual",function(){return{replace:!0,template:function(a,b){var c=d;return j.isSmallDevice&&b.smallview&&(c=e),c},transclude:!0,scope:{onCloseView:"&",hidepointer:"="},restrict:"E",link:function(d,e,f){var j,k,l=a(d.$parent.$eval(f.alignTo)),m=a(d.$parent.$eval(f.offset))[0],n=d.$parent.$eval(f.width),o=d.$parent.$eval(f.top),p=d.$parent.$eval(f.height),q=d.$parent.$eval(f.position),r=d.$parent.$eval(f.limits)||null,s=d.$parent.$eval(f.collision)||"none";"undefined"!=typeof p&&e.css("height",p||"100"),"undefined"!=typeof n&&e.css("width",n||"100"),d.onOutsidePopover=function(a){d.onCloseView({event:a})},a(document).on("keydown.immediateContextual",function(b){var c=i.isInput(document.activeElement);!a(".qui-immidiateContextual").length||c||9!==b.which&&32!==b.which||(b.preventDefault(),d.onCloseView({event:b}),d.$apply(),l.hasClass("qui-button")&&l.hasClass("qui-active")&&l.removeClass("qui-active"))}),d.positionMap=function(a){var b={topRight:"right",top:"top",topLeft:"left",centerRight:"right",center:"right",centerLeft:"left",bottom:"bottom",bottomLeft:"left",bottomRight:"right"};return b[a]},d.synchronAlign=function(){d.hidepointer?d.$parent.event&&(j=b.alignToCoordinate(e,d.$parent.event.pageX,d.$parent.event.pageY,f.position)):(m?(j=b.alignToCoordinate(e,m.x,m.y,q),j=d.positionMap(j)):j=b.align(e,l,{position:q,collision:s,limits:r}),e.find("div.immidiate-contextual-arrow").addClass(j),c.align(e,l,j,e.children("div.immidiate-contextual-arrow")))},d.align=function(){"undefined"!=typeof o&&e.css({top:parseInt(o,10)}),k=g(d.synchronAlign)},d.$on("recalculatePointer",function(){d.hidepointer||c.align(e,l,j,e.children("div.immidiate-contextual-arrow"))}),d.$on("$destroy",function(){g.cancel(k),h.off("end",d.align),a(document).off("keydown.immediateContextual")}),h.on("end",d.align),d.align()}}})}),define("assets/qlikui/components/qui-popover-button/qui-popover-button",["qvangular","qlikui/factory","text!assets/qlikui/components/qui-popover-button/qui-popover-button.ng.html","text!assets/qlikui/components/qui-popover-button/qui-popover-button-menu.ng.html","general.services/show-service/show-service","assets/qlikui/components/qui-list/qui-list","core.utils/resize","general.components/immidiate-contextual/immidiate-contextual"],function(a,b,c,d,e,f,g){a.componentDirective("qvaIncludeQuiPopoverButton",{ngModel:"=",destroyComponent:"&"});var h={template:d,scope:{quiModel:"=",alignTo:"=",shared:"="},controller:["$scope",function(a){a.quiList=f,a.onClose=function(){a.destroyComponent()},a.closeFromContent=function(){a.destroyComponent(),a.shared.pressed=!1},a.$on("$destroy",function(){g.off("start",a.onClose),a.shared.setToFalse()}),g.on("start",a.onClose)}]};b.component("quiPopoverButton",{template:c,transclude:!0,scope:{quiModel:"="},controller:["$scope","$element","$timeout",function(a,b,c){a.shared={},a.shared.pressed=!1,a.buttonClasses={"qui-active":a.shared.pressed},a.$watch("quiModel.buttonType",function(b){b&&(a.buttonClasses[b]=!0)}),a.$watch("shared.pressed",function(b){a.buttonClasses["qui-active"]=b,a.currentTitle=b&&a.quiModel.tooltipActive?a.quiModel.tooltipActive:a.quiModel.tooltipInactive}),a.shared.setToFalse=function(){c(function(){a.shared.pressed=!1},100)},a.onClick=function(){a.shared.pressed||(a.shared.pressed=!0,e.show(h,{quiModel:a.quiModel,alignTo:b,shared:a.shared}))}}]})}),define("text!assets/qlikui/components/qui-toggle-switch/qui-toggle-switch.ng.html",[],function(){return'<div class="switch qui-onoffswitch" ng-class="{ \'qui-focus\': focus, \'qui-checked\': value }" ng-disabled="readOnly">\r\n	<label class="onoffswitch-label" >\r\n		<input type="checkbox" ng-model="value" class="onoffswitch-checkbox" ng-disabled="readOnly || touch">\r\n		<span class="onoffswitch-span">\r\n			<div class="onoffswitch-inner"></div>\r\n			<div class="onoffswitch-switch" ></div>\r\n		</span>\r\n	</label>\r\n</div>'}),define("assets/qlikui/components/qui-toggle-switch/qui-toggle-switch",["qlikui/factory","text!assets/qlikui/components/qui-toggle-switch/qui-toggle-switch.ng.html","touche"],function(a,b){a.component("quiToggleSwitch",{scope:{readOnly:"=",value:"=",isFocused:"=?"},template:b,controller:["$scope","$element",function(a,b){Touche.utils.touch&&(a.touch=!0,Touche(b.find("label")[0]).swipe({options:{preventDefault:!0},end:function(b,c){a.readOnly||(("right"===c.swipe.direction&&a.value||"left"===c.swipe.direction&&!a.value)&&(a.value=!a.value,a.$apply()),Touche.preventGestures(this.gestureHandler))}}).tap({end:function(){a.readOnly||(a.value=!a.value,a.$apply(),Touche.preventGestures(this.gestureHandler))}}))}]})}),define("general.utils/support",["touche"],function(a){function b(){return!a.utils.msPointer||0!==window.navigator.msMaxTouchPoints&&0!==window.navigator.maxTouchPoints?a.utils.msPointer&&(window.navigator.msMaxTouchPoints>0||window.navigator.maxTouchPoints>0)?!1:!a.utils.touch:!0}function c(b){return a.utils.isMouse(b)}return{treatAsDesktop:b,isMouse:c}}),define("text!assets/qlikui/components/qui-search-field/qui-search-field.ng.html",[],function(){return'<div class="qui-searchfield"  ng-class="{ \'qui-focus\': focus }" ng-disabled="disabled">\r\n	<span class="magnifying-glass"></span>\r\n	<span q-title-translation="Common.Clear" class="clear-button" ng-show="query.length" qva-activate="clearSearch($event)"></span>\r\n	<input maxlength="{{maxlength || 255}}" q-placeholder="{{placeholder}}" ng-model="query" ng-disabled="disabled" ng-trim="false" type="text" qva-blur="blurred()"\r\n			qva-focus="autoFocus" qv-escape="escape($event)" qv-enter="enter($event)"/>\r\n</div>'}),define("assets/qlikui/components/qui-search-field/qui-search-field",["qlikui/factory","general.utils/support","text!assets/qlikui/components/qui-search-field/qui-search-field.ng.html"],function(a,b,c){a.component("quiSearchField",{scope:{query:"=",disabled:"=",placeholder:"@",autoFocus:"=?",isFocused:"=?",focuscallback:"&",maxlength:"=",onEscape:"&",onEnter:"&"},template:c,link:function(a,c){var d=c.find("span.clear-button"),e=c.find("input");a.focus=!1,e.on("focus.quiSearchField",function(){a.$root.$$phase?a.focused():a.$apply(function(){a.focused()})}),a.focused=function(){a.focuscallback(),a.focus=!0,a.isFocused=!0},a.blurred=function(){a.focus=!1,a.isFocused=!1},a.escape=function(b){a.onEscape&&a.onEscape({$event:b})},a.enter=function(b){a.onEnter&&a.onEnter({$event:b})},a.clearSearch=function(c){c.preventDefault(),a.query="",e[0]&&b.treatAsDesktop()&&e[0].focus()},a.$on("$destroy",function(){e.off(".quiSearchField"),d.off(".quiSearchField")})}})}),define("text!assets/qlikui/components/qui-filter/qui-filter.ng.html",[],function(){return'<div class="button-div qui-filter qui-buttongroup">\r\n    <button qva-activate="toggleAscDesc()"\r\n            class="qui-button asc-desc"\r\n            title="{{sortTitle | translate}}"\r\n            data-icon="{{isAscending ? \'ascending\' : \'descending\'}}"></button>\r\n\r\n    <button disabled="disabled"\r\n            ng-if="sections.length <= 1"\r\n            class="sort-filter qui-dropdown qui-button"\r\n            title="{{ sortOptTitle | translate }}">\r\n            {{ $parent.sections[0].text || "Common.SortByAlphabetical" | translate }}\r\n            </button>\r\n\r\n    <qui-select ng-if="sections.length > 1"\r\n            class="sort-filter"\r\n            qui-model="$parent.selectedFltr"\r\n            qui-options="option.value as option.text | translate for option in sections"\r\n            title="{{sortOptTitle | translate}}"></qui-select>\r\n</div>\r\n'}),define("assets/qlikui/components/qui-filter/qui-filter",["qlikui/factory","text!assets/qlikui/components/qui-filter/qui-filter.ng.html"],function(a,b){a.component("quiFilter",{restrict:"E",replace:!0,scope:{isAscending:"=",sections:"=",selectedFltr:"=",toggleAscDesc:"&",sortTitle:"@",sortOptTitle:"@"},template:b})}),define("text!assets/qlikui/components/qui-toolbar/qui-app-info.ng.html",[],function(){return'<section class="qv-app-info-holder">\r\n	<div class="app-info-click-area"\r\n		 qva-activate="quiModel.onButton()"\r\n		 q-title-translation="{{quiModel.tooltip()}}"\r\n		 ng-class="{\'has-app-details\': quiModel.hasAppDetails()}">\r\n		<span class="app-read-only" ng-if="quiModel.readOnly"><i data-icon="padlock" q-title-translation="Hub.App.ReadOnly"></i>&nbsp;</span>\r\n\r\n		<h1 class="app-title">{{quiModel.appTitle}}</h1>\r\n\r\n		<h1 class="app-info-icon" data-icon="info" ng-if="quiModel.hasAppDetails()"></h1>\r\n	</div>\r\n</section>'}),define("text!assets/qlikui/components/qui-toolbar/qui-toolbar-button.ng.html",[],function(){return'<button\r\n		tid="{{quiModel.tid}}"\r\n		qva-activate="onButton($event)"\r\n		qva-swipe="onButton($event, true)"\r\n		qva-outside-ignore-for="{{quiModel.name}}"\r\n		q-title-translation="{{(quiModel.pressed && quiModel.tooltipActive ? quiModel.tooltipActive : quiModel.tooltipInactive)}}"\r\n		ng-disabled="quiModel.isDisabled()"\r\n		ng-class="{\'qui-button\': !quiModel.qlikuiSmallIconButton, \'qui-smalliconbutton\': quiModel.qlikuiSmallIconButton,\'qui-active\': quiModel.pressed, \'noIcon\': !quiModel.icon, \'{{quiModel.hasStrongActiveColor}}\': true, \'iconToTheRight\': quiModel.iconToTheRight, \'active-border\':quiModel.activeBorder(), \'dyn-text\': quiModel.dynamicText }">\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && !quiModel.textOnly && !quiModel.iconToTheRight" data-icon="{{quiModel.icon}}" ng-class="{\'qui-dropdown\': quiModel.isDropdownButton}"></span>\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && quiModel.showText()" class="item-title">{{(quiModel.pressed && quiModel.textActive ? quiModel.textActive : quiModel.textInactive) | translate}}</span>\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && !quiModel.textOnly && quiModel.iconToTheRight" data-icon="{{quiModel.icon}}" ng-class="{\'qui-dropdown\': quiModel.isDropdownButton}"></span>\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="quiModel.dynamicText">{{ quiModel.dynamicText() }}</span>\r\n</button>'}),define("assets/qlikui/components/qui-toolbar/qui-toolbar",["jquery","qlikui/factory","text!assets/qlikui/components/qui-toolbar/qui-app-info.ng.html","text!assets/qlikui/components/qui-toolbar/qui-toolbar-button.ng.html"],function(a,b,c,d){b.component("quiToolbar",{template:"<div class='qui-toolbar' ng-transclude />"}),b.component("quiToolbarLeft",{template:"<div class='qui-buttonset-left' ng-transclude />"}),b.component("quiToolbarRight",{template:"<div class='qui-buttonset-right' ng-transclude />"}),b.component("quiToolbarButtonGroup",{template:"<div class='qui-buttongroup' ng-transclude />"}),b.component("quiToolbarAppInfo",{template:c,scope:{quiModel:"="}}),b.component("quiToolbarButton",{template:d,scope:{quiModel:"="},controller:["$scope","$timeout",function(b){b.onButton=function(c,d){d&&b.quiModel.isToggleButton&&!b.quiModel.pressed||(a.support.touch&&c.target.focus(),b.quiModel.isToggleButton&&(b.quiModel.pressed=!b.quiModel.pressed),b.quiModel.onButtonClicked(b.quiModel,c))}}]})}),define("text!assets/qlikui/components/qui-select/qui-select.html",[],function(){return'<div class="qui-select">\r\n	<select class="select" %attrs%>\r\n		%options%\r\n	</select>\r\n	<div class="arrow"></div>\r\n	<div class="border"></div>\r\n</div>\r\n'}),define("assets/qlikui/components/qui-select/qui-select",["qlikui/factory","text!assets/qlikui/components/qui-select/qui-select.html"],function(a,b){a.component("quiSelect",{transclude:!1,template:function(a,c){var d='ng-model="'+c.quiModel+'"';c.quiDisabled&&(d+=' ng-disabled="'+c.quiDisabled+'"'),c.quiOptions&&(d+=' ng-options="'+c.quiOptions+'"'),c.quiChange&&(d+=' ng-change="'+c.quiChange+'"'),c.quiTid&&(d+=' tid="'+c.quiTid+'"');var e=b.replace("%attrs%",d).replace("%options%",a.html());return e},link:function(a,b){var c=b.find(".select");c.on("mouseenter",function(){c.addClass("qui-hover")}),c.on("mouseleave",function(){c.removeClass("qui-hover")})},scope:!1})}),define("qlikui/components",["assets/qlikui/components/qui-dialog-default/qui-dialog-default","assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait","assets/qlikui/components/qui-dialog-alert/qui-dialog-alert","assets/qlikui/components/qui-input-number/qui-input-number","assets/qlikui/components/qui-modal-default/qui-modal-default","assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup","assets/qlikui/components/qui-checkbox/qui-checkbox","assets/qlikui/components/qui-radiobutton/qui-radiobutton","assets/qlikui/components/qui-float/qui-float","assets/qlikui/components/qui-button/qui-button","assets/qlikui/components/qui-popover-button/qui-popover-button","assets/qlikui/components/qui-list/qui-list","assets/qlikui/components/qui-toggle-switch/qui-toggle-switch","assets/qlikui/components/qui-search-field/qui-search-field","assets/qlikui/components/qui-filter/qui-filter","assets/qlikui/components/qui-toolbar/qui-toolbar","assets/qlikui/components/qui-select/qui-select"],function(){}),define("general.utils/qv-activate",["jquery","jqueryoutside","touche"],function(a){function b(b,c,d){return a.Event(b,{pageX:d.pagePoints[0].x,pageY:d.pagePoints[0].y,ctrlKey:c.ctrlKey,metaKey:c.metaKey,shiftKey:c.shiftKey,originalEvent:c,gestureData:d})}var c;Touche(document.body).tap({options:{preventDefault:!1},start:function(b){c=a(b.target)},end:function(a,d){var e=b("qv-activate",a,d);0===c.closest(":disabled").length&&c.trigger(e),c=null}});var d=Touche.Gesture.augment(function(a){function b(){a.apply(this,arguments)}return this.defaults={precedence:6},this.start=function(a,b){this.binder.start.call(this,a,b)},b});Touche.gestures.add("press",d),Touche(document.body).press({start:function(c,d){var e=b("qv-press",c,d);a(c.target).trigger(e)}}),a.addOutsideEvent("qv-press","qv-outside","touchstart","touchend")}),define("general.utils/qv-swipe",["jquery","touche"],function(a){function b(b,c,d){return a.Event(b,{pageX:d.pagePoints[0].x,pageY:d.pagePoints[0].y,ctrlKey:c.ctrlKey,shiftKey:c.shiftKey,originalEvent:c,gestureData:d})}var c;Touche(document.body).tap({options:{preventDefault:!1},start:function(b){c=a(b.target)}}),Touche(document.body).swipe({options:{preventDefault:!1,radiusThreshold:8},start:function(a,d){var e=b("qv-swipestart",a,d);c.trigger(e)},update:function(a,d){var e=b("qv-swipeupdate",a,d);c.trigger(e)},cancel:function(){var b=a.Event("qv-swipecancel");c.trigger(b)},end:function(a,d){var e=b("qv-swipe",a,d);c.trigger(e)}})}),define("general.utils/qv-longtapswipe",["jquery","touche"],function(a,b){var c=b.Gesture.augment(function(c){function d(){c.apply(this,arguments)}function e(){function a(){document.removeEventListener("mousedown",b,!0),document.removeEventListener("mousemove",c,!0),document.removeEventListener("mouseup",d,!0)}function b(a){a.preventDefault(),a.stopPropagation()}function c(a){a.preventDefault(),a.stopPropagation()}function d(b){b.preventDefault(),b.stopPropagation(),a(),clearTimeout(e)}var e;document.addEventListener("mousedown",b,!0),document.addEventListener("mousemove",c,!0),document.addEventListener("mouseup",d,!0),e=setTimeout(a,350)}var f=!1;return this.defaults={radiusThreshold:10,timeThreshold:510,touches:1,precedence:4,preventDefault:!1,which:1,interval:10},this.on=function(a){this.count=0,b(a).longtap({id:this.id,options:{precedence:this.options.precedence,preventDefault:this.options.preventDefault,touches:this.options.touches,which:this.options.which,areaThreshold:this.options.areaThreshold,timeThreshold:this.options.timeThreshold,interval:this.options.interval},start:this.longtapStart.bind(this),update:this.longtapUpdate.bind(this),cancel:this.longtapCancel.bind(this),end:this.longtapEnd.bind(this)}).swipe({id:this.id,options:{precedence:this.options.precedence+1,preventDefault:this.options.preventDefault,radiusThreshold:this.options.radiusThreshold,touches:this.options.touches},start:this.swipeStart.bind(this),update:this.swipeUpdate.bind(this),end:this.swipeEnd.bind(this),cancel:this.swipeCancel.bind(this)})},this.off=function(a){b(a).off("longtap",this.id),b(a).off("swipe",this.id)},this.longtapStart=function(){f=!1},this.longtapUpdate=function(a,b){100===b.percentage&&(f=!0)},this.longtapEnd=function(){this.binder.cancel()},this.longtapCancel=function(){f||this.binder.cancel()},this.swipeStart=function(b,c){var d=a(b.target).is("input, textarea");f&&!d?this.binder.start(b,c):f&&d&&(f=!1)},this.swipeUpdate=function(a,b){f&&this.binder.update(a,b)},this.swipeEnd=function(a,b){f&&(e(),this.binder.end(a,b))},this.swipeCancel=function(){f=!1,this.binder.cancel()},d});b.gestures.add("longtapswipe",c)}),define("general.utils/visualizations",[],function(){function a(a){return c[a]}function b(a,b){c[a]=b}var c={};return{getType:a,getRegisteredNames:function(){return Object.keys(c)},getLibraryInfo:function(a){return c[a]?c[a].getLibraryInfo():null},getTemplateIconClassName:function(a){return c[a]?c[a].getTemplateIconClassName():null},getIconChar:function(a){return c[a]?c[a].getIconChar():null},registerType:b}}),define("objects.utils/layout",[],function(){function a(a,b){var c;for(c=0;i>c;++c)if(a>=f[c][0]&&b>=f[c][1])return f[c][2];return e.SPARK}function b(a){var b;for(b=0;i>b;++b)if(a>=g[b][0])return g[b][1];return e.SPARK}function c(a){var b;for(b=0;i>b;++b)if(a>=h[b][0])return h[b][1];return e.SPARK}function d(a){var b=Object.keys(e).filter(function(b){return e[b]===a})[0];return b&&b.toLowerCase()||""}var e={SPARK:1,XSMALL:3,SMALL:7,MEDIUM:15,FULL:31},f=[[550,450,e.FULL],[400,220,e.MEDIUM],[300,150,e.SMALL],[150,75,e.XSMALL],[0,0,e.SPARK]],g=[[450,e.FULL],[220,e.MEDIUM],[150,e.SMALL],[75,e.XSMALL],[0,e.SPARK]],h=[[550,e.FULL],[400,e.MEDIUM],[300,e.SMALL],[150,e.XSMALL],[0,e.SPARK]],i=f.length;return{LayoutMode:e,getLayoutMode:a,getLayoutModeKey:d,getHorizontalLayoutMode:c,getVerticalLayoutMode:b}}),define("general.utils/property-resolver",[],function(){function a(a,b,c){var d,e=b.split("."),f=a,g=e[e.length-1];for(d=0;d<e.length-1;++d)"undefined"==typeof f[e[d]]&&(f[e[d]]=isNaN(e[d+1])?{}:[]),f=f[e[d]];"undefined"!=typeof c?f[g]=c:delete f[g]}function b(a,b,c){var d,e=b.split("."),f=a;for(d=0;d<e.length;++d){if("undefined"==typeof f[e[d]])return c;f=f[e[d]]}return f}function c(a,b,c){if("string"!=typeof b)return b;switch(a){case"integer":b=parseInt(b,10),isNaN(b)&&(b=c);break;case"number":b=parseFloat(b),isNaN(b)&&(b=c);break;case"boolean":b="true"===b}return b}function d(a,b){if("function"==typeof b.defaultValue)return b.defaultValue();if("undefined"!=typeof b.defaultValue)return b.defaultValue;if(Array.isArray(b.options))return b.options[0].value;switch(a){case"items":return{};case"array":return[];case"string":return"";case"integer":return 0;case"number":return 0;case"boolean":return!1;default:return null}}function e(a){return d(a.type,a)}function f(b){function c(b){var f,g,h;if(!b.schemaIgnore)if("items"===b.type)for(f=Object.keys(b.items),h=0;h<f.length;h++)g=b.items[f[h]],g&&c(g);else b.ref&&!b.schemaIgnore&&a(d,b.ref,e(b))}var d=e(b);return"array"===b.type&&b.items?(d={},c({type:"items",items:b.items})):c(b),d}var g={};return g.invertedBoolean={get:function(a){return!a("boolean")},set:function(a,b){b("boolean",!a)}},g.booleanToSortInteger={get:function(a){return!!a("integer")},set:function(a,b,c){var d;a?(d=c.defaultSort?c.defaultSort:1,b("integer",d)):b("integer",0)}},g.enumToSortInteger={get:function(a){switch(a("integer")){case-1:return"descending";case 1:return"ascending";default:return"disabled"}},set:function(a,b){switch(a){case"descending":b("integer",-1);break;case"ascending":b("integer",1);break;default:b("integer",void 0)}}},{getValue:b,setValue:a,getTypeValue:c,getDefaultValue:d,getDefaults:f,resolveFunctions:g}}),define("client.property-panel/default-sorting-properties",["general.utils/property-resolver"],function(a){var b=[{value:"ascending",translation:"properties.sorting.ascending"},{value:"descending",translation:"properties.sorting.descending"}];return{type:"array",component:"sorting",translation:"properties.sorting",sortIndexRef:"qHyperCubeDef.qInterColumnSortOrder",allowMove:!0,schemaIgnore:!0,items:{dimensions:{type:"items",component:"expandable-items",ref:"qHyperCubeDef.qDimensions",items:{autoSort:{ref:"qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(a,b){return a.qDef.autoSort?b.autoSortDimension(a).then(function(){}):void 0}},dimension:{component:"sorting-dimension",type:"items",ref:"",items:{dimensionDefinition:{type:"items",grouped:!0,items:{expression:{type:"items",items:{expressionToggled:{type:"boolean",ref:"qSortByExpression",translation:"properties.sorting.sortByExpression",resolveFunctions:"booleanToSortInteger"},expression:{type:"number",component:"expression",expressionType:"ValueExpr",ref:"qExpression",translation:"Common.Expression",defaultValue:"",show:function(b){return 0!==a.getValue(b,"qSortByExpression",0)}},expressionOrder:{type:"string",component:"dropdown",ref:"qSortByExpression",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortByExpression",0)}}}},frequency:{type:"items",show:!1,items:{frequencyToggled:{type:"boolean",ref:"qSortByFrequency",translation:"properties.sorting.sortByFrequency",resolveFunctions:"booleanToSortInteger"},frequencyOrder:{type:"string",component:"dropdown",ref:"qSortByFrequency",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortByFrequency",0)}}}},numeric:{type:"items",items:{numericToggled:{type:"boolean",ref:"qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qSortByNumeric",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortByNumeric",0)}}}},ascii:{type:"items",items:{asciiToggled:{type:"boolean",ref:"qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qSortByAscii",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortByAscii",0)}}}},defaultSortMessage:{component:"text",translation:"properties.sorting.defaultSortingMessage",show:function(a){return!(a.qSortByAscii||a.qSortByNumeric||a.qSortByExpression||a.qSortByFrequency)}}}}}}}},measures:{type:"items",component:"expandable-items",grouped:!0,ref:"qHyperCubeDef.qMeasures",items:{autoSort:{ref:"qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(a,b){return a.qDef.autoSort?b.autoSortMeasure(a).then(function(){}):void 0}},numeric:{type:"items",show:function(a){return!a.qDef.autoSort},items:{numericToggled:{type:"boolean",ref:"qSortBy.qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qSortBy.qSortByNumeric",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortBy.qSortByNumeric",0)}}}},ascii:{type:"items",show:function(a){return!a.qDef.autoSort},items:{asciiToggled:{type:"boolean",ref:"qSortBy.qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qSortBy.qSortByAscii",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortBy.qSortByAscii",0)}}}},defaultSortMessage:{component:"text",translation:"properties.sorting.defaultSortingMessage",show:function(b){var c;return b.qDef.autoSort?!1:(c=a.getValue(b,"qSortBy",{}),c.qSortByAscii||c.qSortByNumeric||c.qSortByFrequency?!1:!0)}}}}}}}),define("general.utils/number-formatting",["util"],function(a){function b(a,b,c,d,e){void 0===c&&(c=e.qDecimalSep),void 0===d&&(d=e.qThousandSep);var f,g,h,i,j="";if("F"===a)if(0===b)j="#"+d+"##0";else for(j="#"+d+"##0"+c,h=0;b>h;++h)j+="0";else{for(h=0;b>h;++h)j+="#";b>3&&(i=j.length,f=j.substring(0,i-3),g=j.substr(i-3),j=f+d+g)}return j}var c;return{setNumFmtPattern:function(a,b,d){var e,f={type:b.qType||"U",nDec:"qType"===a?("F"===b.qType,2):"R"===b.qType?b.qnDec||10:"number"==typeof b.qnDec?Math.max(0,b.qnDec):2,thousandSep:b.qThou,decimalSep:b.qDec};e=this._getSeparators(a,"M"===b.qType,f.decimalSep,f.thousandSep,d),e.decimal!==c&&(f.decimalSep=e.decimal),e.thousand!==c&&(f.thousandSep=e.thousand),b.qType=f.type,b.qnDec=f.nDec,b.qDec=f.decimalSep,b.qThou=f.thousandSep,b.qFmt=this._getPattern(f.type,f.nDec,f.decimalSep,f.thousandSep,d),["D","T","TS","IV"].indexOf(f.type)>=0&&(b.qDec="",b.qThou="")},_getSeparators:function(a,b,c,d,e){var f=c,g=d,h="q"+(b?"Money":"");return"qType"===a?(g=e[h+"ThousandSep"]||"",f=e[h+"DecimalSep"]||"."):"qThou"===a&&void 0===d?(g=e[h+"ThousandSep"]||"",f=c||"."):"qDec"!==a||void 0!==c&&""!==c||(f=e[h+"DecimalSep"]||".",g=d||""),{decimal:f||".",thousand:g||""}},_getPattern:function(b,c,d,e,f){var g;switch(b){case"U":return"";case"I":return"#"+e+"##0";case"R":case"F":return this.getNDecPattern("F",c,d,e,f);case"M":return g=f.qMoneyFmt,f.qMoneyDecimalSep&&(g=g.replace(new RegExp(a.escapeRegExp(f.qMoneyDecimalSep),"g"),d)),f.qMoneyThousandSep&&(g=g.replace(new RegExp(a.escapeRegExp(f.qMoneyThousandSep),"g"),e)),g;case"D":return f.qDateFmt;case"T":return f.qTimeFmt;case"TS":return f.qTimestampFmt;case"IV":return"h:mm:ss";default:return""}},getDefaultNumericFormat:function(a,c){return b("F",2,a.qDec,a.qThou||"",c)},getNDecPattern:b}}),define("core.utils/theme",["util","core.utils/notification","general.utils/property-resolver","text!themes/sense/theme.json"],function(a,b,c,d){function e(a){var b=document.createElement("link");return b.setAttribute("rel","stylesheet"),b.setAttribute("href",require.toUrl("themes/"+a+"/theme.css")),document.head.appendChild(b),b}function f(b,d){b=JSON.parse(b),a.extend(!0,o,i,b),d&&n.forEach(function(a){var d=c.getValue(b,a);void 0!==d&&c.setValue(o,a,d)}),m=b}function g(a){var b=e(a);return require(["text!themes/"+a+"/theme.json"],function(a){f(a,!0),o.ThemeChanged.emit()}),b}function h(){l.parentNode.removeChild(l),Object.keys(m).forEach(function(a){delete o[a]})}var i=JSON.parse(d),j="sense",k=null,l=null,m={},n=["palette","colorSchemes.qualitativeScales","colorSchemes.ordinalScales"],o={};return b.create(o,"ThemeChanged"),Object.defineProperty(o,"name",{iterable:!1,get:function(){return k||j}}),o.set=function(a){a.indexOf("/")>-1||a!==k&&(k&&h(),a&&(l=g(a),k=a))},e("sense"),f(d),o}),define("general.utils/string-limits",[],function(){var a={};return Object.defineProperties(a,{name:{value:255,writable:!1},description:{value:512,writable:!1},expression:{value:8192,writable:!1},script:{value:5e4,writable:!1},textImage:{value:12e3,writable:!1}}),a}),define("client.property-panel/default-properties",["general.utils/property-resolver","client.property-panel/default-sorting-properties","general.utils/number-formatting","translator","core.utils/theme","general.utils/string-limits","util"],function(a,b,c,d,e,f,g){function h(b){var c=a.getValue(b,"color.auto"),d=a.getValue(b,"color.mode"),e=a.getValue(b,"color.expressionIsColor"),f=a.getValue(b,"qHyperCubeDef.qDimensions.length"),g=a.getValue(b,"qHyperCubeDef.qMeasures.length");return c&&1===f&&1===g||!c&&"primary"===d||!c&&"byExpression"===d&&(e||void 0===e)}function i(b){return a.getValue(b,"color.reverseScheme")!==!0}function j(b){return"byExpression"===a.getValue(b,"color.mode")&&a.getValue(b,"color.expressionIsColor")===!1}function k(b){return"byExpression"===a.getValue(b,"color.mode")&&a.getValue(b,"color.expressionIsColor")===!0}function l(b,d){return a.getValue(b,"qDef.qNumFormat.qFmt")===c.getDefaultNumericFormat(b.qDef.qNumFormat,d?d.localeInfo:"")}function m(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return["R","M","IV"].contains(c)||"U"!==c&&a.getValue(b,"qDef.numFormatFromTemplate",!0)===!1}var n={sorting:b,"dimensions-sorting":b.items.dimensions,"measures-sorting":b.items.measures};return n.general={type:"items",translation:"properties.general",grouped:!0,items:{showTitles:{translation:"properties.showTitles",type:"boolean",ref:"showTitles",component:"switch",defaultValue:!0,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-showTitles"}},titles:{type:"items",show:function(a){return a.showTitles!==!1},items:{title:{translation:"Common.Title",type:"string",expression:"optional",ref:"title",defaultValue:""},subtitle:{translation:"properties.subtitle",type:"string",expression:"optional",ref:"subtitle",defaultValue:""},footnote:{translation:"properties.footnote",type:"string",expression:"optional",ref:"footnote",defaultValue:""}}}}},n.metadata={type:"items",translation:"properties.metadata",show:function(a){return"masterobject"===a.qInfo.qType
},grouped:!0,items:{name:{translation:"Common.Name",type:"string",ref:"metadata.name",show:function(a){return a.metadata},change:function(a,b,c,d){var e=(a.metadata.name||"").trim();return e?void 0:d.model.getProperties().then(function(b){return a.metadata.name=b.metadata.name,!1})}},description:{translation:"Common.Description",type:"string",component:"textarea",ref:"metadata.description",maxlength:f.description,show:function(a){return a.metadata}},tags:{translation:"Common.Tags",component:"tags",type:"array",ref:"metadata.tags",show:function(a){return a.metadata}}}},n.settings={type:"items",component:"expandable-items",translation:"Common.Appearance",items:{metadata:n.metadata,general:n.general}},n.addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{}},n.dimensions={type:"array",component:"dimensions",translation:"Common.Dimensions",ref:"qHyperCubeDef.qDimensions",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",min:1,allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.dimensions.add",grouped:!0,items:{libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qLibraryId",translation:"Common.Dimension",show:function(a){return a.qLibraryId}},inlineDimension:{component:"inline-dimension",show:function(a){return!a.qLibraryId}},autoSort:{ref:"qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qDef.cId",type:"string",show:!1},nullSuppression:{type:"boolean",ref:"qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0},dimensionLimits:{type:"items",items:{otherMode:{type:"string",component:"dropdown",ref:"qOtherTotalSpec.qOtherMode",translation:"properties.dimensionLimits.limitation",options:[{value:"OTHER_OFF",translation:"properties.dimensionLimits.none"},{value:"OTHER_COUNTED",translation:"properties.dimensionLimits.fixedNumber"},{value:"OTHER_ABS_LIMITED",translation:"properties.dimensionLimits.exactValue"},{value:"OTHER_REL_LIMITED",translation:"properties.dimensionLimits.relativeValue"}],defaultValue:"OTHER_OFF",change:function(b){var c,d=a.getValue(b,"qOtherTotalSpec.qOtherMode");"OTHER_REL_LIMITED"===d?(c=a.getValue(b,"qOtherTotalSpec.qOtherLimit.qv","0"),c.length&&"%"!==c[c.length-1]&&g.isNumeric(c)&&(b.qOtherTotalSpec.qOtherLimit||a.setValue(b,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),b.qOtherTotalSpec.qOtherLimit.qv=c+"%")):"OTHER_ABS_LIMITED"===d&&(c=a.getValue(b,"qOtherTotalSpec.qOtherLimit.qv","0"),c.length&&"%"===c[c.length-1]&&(b.qOtherTotalSpec.qOtherLimit||a.setValue(b,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),b.qOtherTotalSpec.qOtherLimit.qv=c.substr(0,c.length-1)))}},otherSortMode:{type:"string",component:"buttongroup",ref:"qOtherTotalSpec.qOtherSortMode",options:[{value:"OTHER_SORT_DESCENDING",translation:"Common.Top"},{value:"OTHER_SORT_ASCENDING",translation:"Common.Bottom"}],defaultValue:"OTHER_SORT_DESCENDING",show:function(b){return"OTHER_COUNTED"===a.getValue(b,"qOtherTotalSpec.qOtherMode")}},otherCounted:{component:"expression",expressionType:"ValueExpr",ref:"qOtherTotalSpec.qOtherCounted",defaultValue:{qv:"10"},show:function(b){return"OTHER_COUNTED"===a.getValue(b,"qOtherTotalSpec.qOtherMode")}},otherLimitMode:{type:"string",component:"buttongroup",ref:"qOtherTotalSpec.qOtherLimitMode",options:[{value:"OTHER_GE_LIMIT",label:">=",tooltipTranslation:"properties.greaterOrEqualTo"},{value:"OTHER_GT_LIMIT",label:">",tooltipTranslation:"properties.greaterThan"},{value:"OTHER_LT_LIMIT",label:"<",tooltipTranslation:"properties.lessThan"},{value:"OTHER_LE_LIMIT",label:"<=",tooltipTranslation:"properties.lessOrEqualTo"}],defaultValue:"OTHER_GE_LIMIT",icon:!0,smallIconFont:!0,show:function(b){var c=a.getValue(b,"qOtherTotalSpec.qOtherMode");return"OTHER_ABS_LIMITED"===c||"OTHER_REL_LIMITED"===c}},otherLimit:{component:"expression",expressionType:"ValueExpr",ref:"qOtherTotalSpec.qOtherLimit",defaultValue:{qv:"0"},show:function(b){var c=a.getValue(b,"qOtherTotalSpec.qOtherMode");return"OTHER_ABS_LIMITED"===c||"OTHER_REL_LIMITED"===c}},calculatedAgainstMessage:{component:"text",label:function(a,b){var c=b.getMeasureLayouts()[0];return c?d.get("Properties.DimensionLimits.CalculatedAgainst",c.qFallbackTitle):d.get("Properties.DimensionLimits.NoMeasure")},show:function(b){return"OTHER_OFF"!==a.getValue(b,"qOtherTotalSpec.qOtherMode")}}}},others:{type:"items",items:{suppressOther:{type:"boolean",ref:"qOtherTotalSpec.qSuppressOther",translation:"properties.dimensionLimits.showOthers",inverted:!0,defaultValue:!1,show:function(b){return"OTHER_OFF"!==a.getValue(b,"qOtherTotalSpec.qOtherMode")}},othersLabel:{type:"string",expression:"optional",ref:"qDef.othersLabel",translation:"properties.dimensionLimits.othersLabel",defaultValue:function(){return d.get("properties.dimensionLimits.others")},show:function(b){return!a.getValue(b,"qOtherTotalSpec.qSuppressOther")&&"OTHER_OFF"!==a.getValue(b,"qOtherTotalSpec.qOtherMode")}}}}}},n.measures={type:"array",component:"measures",translation:"Common.Measures",ref:"qHyperCubeDef.qMeasures",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",min:1,allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.measures.add",grouped:!0,items:{libraryId:{type:"string",component:"library-item",libraryItemType:"measure",ref:"qLibraryId",translation:"Common.Measure",show:function(a){return a.qLibraryId}},inlineMeasure:{component:"inline-measure",show:function(a){return!a.qLibraryId}},autoSort:{ref:"qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qDef.cId",type:"string",show:!1},numberFormatting:{type:"items",items:{numberFormattingType:{type:"string",component:"dropdown",ref:"qDef.qNumFormat.qType",translation:"properties.numberFormatting",defaultValue:"U",options:[{value:"U",translation:"Common.Auto"},{value:"F",translation:"properties.numberFormatting.types.number"},{value:"M",translation:"properties.numberFormatting.types.money"},{value:"D",translation:"properties.numberFormatting.types.date"},{value:"IV",translation:"properties.numberFormatting.types.duration"},{value:"R",translation:"Common.Custom"}],change:function(a,b,d,e){c.setNumFmtPattern("qType",a.qDef.qNumFormat,e.localeInfo)}},numberFormattingMode:{type:"boolean",component:"switch",ref:"qDef.numFormatFromTemplate",translation:"properties.numberFormatting.formatting",defaultValue:!0,options:[{value:!0,translation:"properties.numberFormatting.simple"},{value:!1,translation:"Common.Custom"}],show:function(b){return["F","D","TS","T"].contains(a.getValue(b,"qDef.qNumFormat.qType"))}},numberFormattingTemplates:{type:"string",component:"number-formatter-dropdown",ref:"qDef.qNumFormat.qFmt",defaultValue:"#,##0",show:function(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return["F","D","TS","T"].contains(c)&&a.getValue(b,"qDef.numFormatFromTemplate",!0)===!0}},numDecimals:{type:"integer",ref:"qDef.qNumFormat.qnDec",translation:"properties.numberFormatting.nDec",defaultValue:2,min:0,max:14,show:!1},numPrecisionDigits:{type:"integer",ref:"qDef.qNumFormat.qnDec",translation:"properties.numberFormatting.significantFigures",defaultValue:10,min:1,max:14,show:!1},decimalSep:{type:"string",ref:"qDef.qNumFormat.qDec",translation:"properties.numberFormatting.dec",defaultValue:".",show:function(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return"R"===c},change:function(a,b,d,e){c.setNumFmtPattern("qDec",a.qDef.qNumFormat,e.localeInfo)},invalid:function(b){return a.getValue(b,"qDef.qNumFormat.qDec")===a.getValue(b,"qDef.qNumFormat.qThou")},readOnly:function(a,b,c,d){return!l(a,d)}},thousandSep:{type:"string",ref:"qDef.qNumFormat.qThou",translation:"properties.numberFormatting.thousandSeparator",defaultValue:"",show:function(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return"R"===c},change:function(a,b,d,e){c.setNumFmtPattern("qThou",a.qDef.qNumFormat,e.localeInfo)},invalid:function(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return"I"===c?!1:a.getValue(b,"qDef.qNumFormat.qDec")===a.getValue(b,"qDef.qNumFormat.qThou")},readOnly:function(a,b,c,d){return!l(a,d)}},format:{type:"string",component:"number-formatter",ref:"qDef.qNumFormat.qFmt",resetTranslation:"properties.numberFormatting.resetPattern",translation:"properties.numberFormatting.formatPattern",defaultValue:"",show:function(a){return m(a)},invalid:function(a,b,c){if(["D","T","TS","IV"].contains(a.qDef.qNumFormat.qType))return!1;var d="R"===a.qDef.qNumFormat.qType?a.qDef.qNumFormat.qDec:c.localeInfo["q"+("M"===a.qDef.qNumFormat.qType?"Money":"")+"DecimalSep"],e=new RegExp("(0|#)"+g.escapeRegExp(d)+"0*#*"),f=(a.qDef.qNumFormat.qFmt||"").split(";"),h=f[0].match(e),i=h&&h[0]?h[0].length-2:0,j=f[1]?f[1].match(e):null,k=j&&j[0]?j[0].length-2:0;return i>15||k>15}}}}}},n.measureAxis={type:"items",label:d.get("properties.yAxis"),grouped:!0,items:{axis:{type:"items",items:{show:{type:"string",component:"dropdown",ref:"measureAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all"},dock:{type:"string",component:"dropdown",ref:"measureAxis.dock",translation:"Common.Position",defaultValue:"near",options:function(a){var b,c;return"horizontal"===a.orientation?(b="Common.Bottom",c="Common.Top"):(b="properties.dock.left",c="properties.dock.right"),[{value:"near",translation:b},{value:"far",translation:c}]},show:function(a){return a.measureAxis&&"none"!==a.measureAxis.show}},spacing:{ref:"measureAxis.spacing",translation:"properties.axis.scale",type:"number",component:"dropdown",defaultValue:1,options:[{value:2,translation:"properties.gridLine.wide"},{value:1,translation:"properties.gridLine.medium"},{value:.5,translation:"properties.gridLine.narrow"}],show:function(a){return a.measureAxis&&"none"!==a.measureAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"measureAxis.autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},minMax:{type:"string",component:"dropdown",ref:"measureAxis.minMax",options:[{translation:"properties.axis.min",value:"min"},{translation:"Common.Max",value:"max"},{translation:"properties.axis.minMax",value:"minMax"}],defaultValue:"min",show:function(a){return a.measureAxis&&!a.measureAxis.autoMinMax}},min:{ref:"measureAxis.min",translation:"properties.axis.min",expression:"optional",type:"number",show:function(a){return a.measureAxis&&["min","minMax"].contains(a.measureAxis.minMax)&&!a.measureAxis.autoMinMax},invalid:function(a){return a.measureAxis&&"minMax"===a.measureAxis.minMax?a.measureAxis.min>=a.measureAxis.max:!1}},max:{ref:"measureAxis.max",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(a){return a.measureAxis&&["max","minMax"].contains(a.measureAxis.minMax)&&!a.measureAxis.autoMinMax},invalid:function(a){return a.measureAxis&&"minMax"===a.measureAxis.minMax?a.measureAxis.min>=a.measureAxis.max:!1}}}}}},n.reflines={type:"array",ref:"refLine.refLines",translation:"properties.referenceLines",itemTitleRef:"label",allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.referenceLines.add",items:{show:{ref:"show",translation:"Common.Show",type:"boolean",defaultValue:!0},label:{ref:"label",translation:"Common.Label",type:"string"},color:{ref:"color",translation:"properties.color",type:"integer",component:"color-picker",defaultValue:2},expressionLabel:{ref:"refLineExpr.label",translation:"properties.referenceLines.expression",type:"string",expression:"optional",defaultValue:"0",change:function(a){var b=a.refLineExpr;b.value="object"==typeof b.label?{qValueExpression:{qExpr:b.label.qStringExpression.qExpr}}:Number(b.label)}},expressionValue:{ref:"refLineExpr.value",translation:"properties.referenceLines.expression",type:"number",expression:"optional",defaultValue:0,show:!1}}},n.dataHandling={type:"items",translation:"properties.dataHandling",items:{suppressZero:{ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",type:"boolean",inverted:!0},assign:{component:"assign"}}},n.colorsAndLegend={type:"items",translation:"properties.colorsAndLegend",grouped:!0,items:{colors:{type:"items",items:{autoColor:{ref:"color.auto",type:"boolean",translation:"properties.colors",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},colorMode:{ref:"color.mode",type:"string",component:"dropdown",options:function(a,b){var c=[{value:"primary",translation:"properties.colorMode.primary"}];return c.push(b.getMeasures().length>1?{value:"byDimension",translation:"properties.colorMode.multicolored"}:{value:"byDimension",translation:"properties.colorMode.byDimension"}),1===b.getMeasures().length&&c.push({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),b.getMeasures().length>=1&&c.push({value:"byExpression",translation:"properties.colorMode.byExpression"}),c},defaultValue:"primary",show:function(b){return!a.getValue(b,"color.auto")}},singleColor:{ref:"color.singleColor",translation:"properties.color",type:"integer",component:"color-picker",defaultValue:3,show:function(b){return!a.getValue(b,"color.auto")&&"primary"===a.getValue(b,"color.mode")}},persistentColors:{ref:"color.persistent",translation:"properties.colorPersistence",type:"boolean",defaultValue:!1,show:function(b){return!a.getValue(b,"color.auto")&&"byDimension"===a.getValue(b,"color.mode")},readOnly:function(b){return a.getValue(b,"qHyperCubeDef.qDimensions.length")>1}},attributeExpression:{type:"string",component:"expression",expressionType:"measure",schemaIgnore:!0,ref:"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0.qExpression",change:function(b){var c=a.getValue(b,"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=a.getValue(b,"color");c&&(c.type="colorByExpression",d&&(d.colorExpression=c.qExpression))},globalChange:function(b){var c,d,e,f=a.getValue(b,"qHyperCubeDef.qMeasures",[]),g=a.getValue(b,"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",[]),h=null,i=function(a,b){"colorByExpression"===a.type&&(d=b)};if(f.length+g.length>1){for(c=g.length-1;c>=0;--c)e=g[c].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);for(c=f.length-1;c>=0;--c)e=f[c].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);!f[0].qAttributeExpressions&&h&&(f[0].qAttributeExpressions=[]),h&&f[0].qAttributeExpressions.splice(0,0,h)}var j=a.getValue(b,"color.colorExpression");1!==f.length||f[0].qAttributeExpressions&&0!==f[0].qAttributeExpressions.length||!j||(f[0].qAttributeExpressions=[{qExpression:j,type:"colorByExpression"}])},translation:"Common.Expression",show:function(b,c){return!a.getValue(b,"color.auto")&&"byExpression"===a.getValue(b,"color.mode")&&c.getMeasures().length>0}},expressionIsColor:{ref:"color.expressionIsColor",translation:"properties.expressionIsColor",type:"boolean",defaultValue:!0,show:function(b,c){return!a.getValue(b,"color.auto")&&"byExpression"===a.getValue(b,"color.mode")&&c.getMeasures().length>0}},expressionLabel:{type:"string",ref:"color.expressionLabel",translation:"Common.Label",change:function(b){var c=a.getValue(b,"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=a.getValue(b,"color");c&&(c.label=a.getValue(b,"color.expressionLabel"),d&&(d.colorExpression=c.qExpression))},show:function(b,c){return!a.getValue(b,"color.auto")&&j(b)&&c.getMeasures().length>0}},colorSchemeMeasure:{ref:"color.measureScheme",type:"string",translation:"properties.colorScheme",component:"item-selection-list",defaultValue:"sg",items:[{colors:e.colorSchemes.ordinalScales[0].scale,type:"gradient",reverse:i,component:"color-scale",translation:e.colorSchemes.ordinalScales[0].translation||e.colorSchemes.ordinalScales[0].name,value:"sg"},{colors:e.colorSchemes.ordinalScales[1].scale[e.colorSchemes.ordinalScales[1].scale.length-1],type:"classes",reverse:i,component:"color-scale",translation:e.colorSchemes.ordinalScales[1].translation||e.colorSchemes.ordinalScales[1].name,value:"sc"},{colors:e.colorSchemes.ordinalScales[2].scale,type:"gradient",reverse:i,component:"color-scale",translation:e.colorSchemes.ordinalScales[2].translation||e.colorSchemes.ordinalScales[2].name,value:"dg"},{colors:e.colorSchemes.ordinalScales[3].scale[e.colorSchemes.ordinalScales[3].scale.length-1],type:"classes",reverse:i,component:"color-scale",translation:e.colorSchemes.ordinalScales[3].translation||e.colorSchemes.ordinalScales[3].name,value:"dc"}],show:function(b){return!a.getValue(b,"color.auto")&&("byMeasure"===a.getValue(b,"color.mode")||j(b))}},reverseScheme:{ref:"color.reverseScheme",translation:"properties.reverseColorScheme",type:"boolean",defaultValue:!1,show:function(b){return!a.getValue(b,"color.auto")&&("byMeasure"===a.getValue(b,"color.mode")||j(b))}},colorSchemeDimension:{ref:"color.dimensionScheme",type:"string",translation:"properties.colorScheme",component:"item-selection-list",defaultValue:"12",items:[{colors:e.colorSchemes.qualitativeScales[0].scale[e.colorSchemes.qualitativeScales[0].scale.length-1],type:"classes",component:"color-scale",translation:e.colorSchemes.qualitativeScales[0].translation||e.colorSchemes.qualitativeScales[0].name,value:"12"},{colors:e.colorSchemes.qualitativeScales[1].scale,type:"classes",component:"color-scale",translation:e.colorSchemes.qualitativeScales[1].translation||e.colorSchemes.qualitativeScales[1].name,value:"100"}],show:function(b){return!a.getValue(b,"color.auto")&&"byDimension"===a.getValue(b,"color.mode")}},customRange:{type:"items",items:{autoMinMax:{ref:"color.autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:function(b){return"byMeasure"===a.getValue(b,"color.mode")||j(b)}},min:{ref:"color.measureMin",translation:"properties.axis.min",expression:"optional",type:"number",show:function(b){return("byMeasure"===a.getValue(b,"color.mode")||j(b))&&a.getValue(b,"color.autoMinMax")===!1},invalid:function(b){return"minMax"===a.getValue(b,"color.minMax")?a.getValue(b,"color.measureMin")>=a.getValue(b,"color.measureMax"):!1}},max:{ref:"color.measureMax",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(b){return("byMeasure"===a.getValue(b,"color.mode")||j(b))&&a.getValue(b,"color.autoMinMax")===!1},invalid:function(b){return"minMax"===a.getValue(b,"color.minMax")?a.getValue(b,"color.measureMin")>=a.getValue(b,"color.measureMax"):!1}}}}}},legend:{type:"items",items:{show:{ref:"legend.show",type:"boolean",translation:"properties.legend.show",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(a){return!h(a)}},dock:{type:"string",component:"dropdown",ref:"legend.dock",translation:"properties.legend.position",options:[{value:"auto",translation:"Common.Auto"},{value:"right",translation:"properties.dock.right"},{value:"bottom",translation:"Common.Bottom"},{value:"left",translation:"properties.dock.left"},{value:"top",translation:"Common.Top"}],defaultValue:"auto",show:function(b){return a.getValue(b,"legend.show")&&!h(b)}},showTitle:{ref:"legend.showTitle",translation:"properties.legend.showTitle",type:"boolean",defaultValue:!0,show:function(b){return a.getValue(b,"legend.show")&&!h(b)&&!k(b)}}}}}},n.data={type:"array",component:"hypercube-data",translation:"Common.Data",addTranslation:"Properties.AddData",allowAdd:!0,items:{dimensions:{type:"items",component:"expandable-items",ref:"qHyperCubeDef.qDimensions",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",grouped:!0,items:n.dimensions.items},measures:{type:"items",component:"expandable-items",ref:"qHyperCubeDef.qMeasures",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",grouped:!0,items:n.measures.items}}},n}),define("general.utils/property-mapper",["client.property-panel/default-properties","general.utils/property-resolver","util"],function(a,b,c){function d(a,b,c){var e,f,g,h=null;if(a.ref===b)return a;if("items"===a.type&&a.items)for(e=Object.keys(a.items),g=0;g<e.length;++g){if(f=a.items[e[g]],f.ref===b){h=f;break}if(c&&(h=d(f,b,c),null!==h))break}return h}function e(b,d){var f,g,h;if(b||(b=j),d&&k[d])return k[d];if(b.uses){if(h=a[b.uses],!h)throw"No defaults found for: "+b.uses;b=c.extend(!0,{},h,b)}return"items"===b.type?(g={},Object.keys(b.items).forEach(function(a){b.items[a]&&(g[a]=e(b.items[a]))}),f=c.extend({},b,{items:g})):"array"===b.type&&b.items?(g={},Object.keys(b.items).forEach(function(a){b.items[a]&&(g[a]=e(b.items[a]))}),f=c.extend({},b,{items:g})):f=c.extend({},b),d&&!k[d]&&(k[d]=f),f}function f(a,d,f){var g=e(a,f);return d?c.extend(!0,b.getDefaults(g),d):b.getDefaults(g)}function g(a){function c(a){function d(a){return-1!==a.search(/\.\d/g)}function e(a){var c={type:a.type,defaultValue:b.getDefaultValue(a.type,a)};return a.maxlength&&(c.maxlength=a.maxlength),a.min&&(c.min=a.min),a.max&&(c.max=a.max),a.expression&&(c.expression=a.expression),a.options&&"boolean"!==a.type&&(c["enum"]=a.options.map(function(a){return a.value})),c}function f(a){var h,i,j,k,l,m;if("items"===a.type)for(h=Object.keys(a.items),l=0;l<h.length;l++)i=h[l],j=a.items[i],f(j);else a.ref&&"array"===a.type&&a.items?(k=c({type:"items",items:a.items}),m={type:"array",items:k},d(a.ref)||b.setValue(g,a.ref,m)):a.ref&&(m=e(a),d(a.ref)||b.setValue(g,a.ref,m))}var g={};return f(a),g}return c(a)}function h(a){function b(a){var d,e,f;if("items"===a.type&&a.items)for(d=Object.keys(a.items),f=0;f<d.length;++f)e=a.items[d[f]],e.snapshot&&c.push(e),b(e)}var c=[];return b(a),c}function i(a,b){function c(a){a.globalChange&&d.push(a.globalChange),"items"!==a.type&&"array"!==a.type||!a.items||Object.keys(a.items).forEach(function(b){a.items[b]&&c(a.items[b])})}if(b&&l[b])return l[b];var d=[];return c(a),b&&!l[b]&&(l[b]=d),d}var j,k={},l={};return j={type:"items",component:"accordion",items:{settings:{uses:"settings"}}},{findDefinition:d,findSnapshotProperties:h,findGlobalListeners:i,mapDefinition:e,mapProperties:f,getPropertyHierarchy:g}}),define("objects.backend-api/generic-api",["./backend-api"],function(a){function b(a,b){if(b){if(a[b]){if(a[b].qHyperCube)return b+".qHyperCube";if(a[b].qListObject)return b+".qListObject"}return-1!==b.indexOf("Def",b.length-3)?b.slice(0,b.length-3):b}return a.qHyperCube?"qHyperCube":"qListObject"}var c;return c=a.extend("GenericApi",{init:function(a,c){var d=b(a.layout,c);this._super(a,"/"+d+"Def"),this.isHyperCube=-1!==this.dataPath.indexOf("qHyperCube"),this.cacheCube.setMethodName(this.isHyperCube?"GetHyperCubeData":"GetListObjectData")},getBackendApi:function(a){return new c(this.model,a)},getProperties:function(){return this.model.getProperties()},setProperties:function(a){return this.model.setProperties(a)},applyPatches:function(a,b){return this.model.applyPatches(a,b)},clearSoftPatches:function(){return this.model.clearSoftPatches()},save:function(){return this.model.save()},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},updateCache:function(a){a&&a[this.dataPath]?(this.cacheCube.set(a[this.dataPath].qDataPages),this.cacheCube.setCubeSize(a[this.dataPath].qSize)):this.cacheCube.clear()},getData:function(a){var b=this.cacheCube.getData(a),c=this;return b.then(function(a){c.model.layout[c.dataPath].qDataPages.push(a[0])}),b},getDataRow:function(a){var b=this.model.layout[this.dataPath];if(b)for(var c=b.qDataPages.length,d=0;c>d;d++){var e=b.qDataPages[d];if(a>=e.qArea.qTop&&a<e.qArea.qTop+e.qArea.qHeight)return e.qMatrix[a-e.qArea.qTop]}return null},selectValues:function(a,b,c){return this.isHyperCube?this.model.rpc("SelectHyperCubeValues",null,[this.path,a,b,c]):this.model.rpc("SelectListObjectValues",null,[this.path,b,c])},select:function(a,b,c){return this.selectValues(b,a,c)},getReducedData:function(a,b,c){return this.isHyperCube?this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,a,b,c||"D1"]):null},selectRange:function(a,b,c){return b=!!b,c=c||[],this.model.rpc("RangeSelectHyperCubeValues",null,[this.path,a,c,b])},search:function(a){return this.isHyperCube?null:this.model.rpc("SearchListObjectFor",null,[this.path,a])},abortSearch:function(){return this.isHyperCube?null:this.model.rpc("AbortListObjectSearch",null,[this.path])},acceptSearch:function(a){return this.isHyperCube?null:this.model.rpc("AcceptListObjectSearch",null,[this.path,a])}})}),define("objects.utils/data-properties/data-property-handler",["core.utils/class","util"],function(a,b){var c,d;return d="Not supported in this object, need to implement in subclass.",c=a.extend({init:function(a,b,c,d){this.dimensionDefinition=a||{max:0},this.measureDefinition=b||{max:0},a&&(this.dimensionProperties=c||{}),b&&(this.measureProperties=d||{})},setProperties:function(a){this.properties=a},setLayout:function(a){this.layout=a},type:function(){throw"Must override this method"},getDimensions:function(){return[]},getDimension:function(a){var b=this.getDimensions(),c=0;for(c;c<b.length;++c)if(b[c].qDef.cId===a)return b[c];return null},minDimensions:function(){return"function"==typeof this.dimensionDefinition.min?this.dimensionDefinition.min.call(null,this.properties,this):this.dimensionDefinition.min||0},maxDimensions:function(){return"function"==typeof this.dimensionDefinition.max?this.dimensionDefinition.max.call(null,this.getMeasures().length):isNaN(this.dimensionDefinition.max)?1e4:this.dimensionDefinition.max},canAddDimension:function(){return this.getDimensions().length<this.maxDimensions()},minMeasures:function(){return"function"==typeof this.measureDefinition.min?this.measureDefinition.min.call(null,this.properties,this):this.measureDefinition.min||0},maxMeasures:function(){return"function"==typeof this.measureDefinition.max?this.measureDefinition.max.call(null,this.getDimensions().length):isNaN(this.measureDefinition.max)?1e4:this.measureDefinition.max},canAddMeasure:function(){return this.getMeasures().length<this.maxMeasures()},getMeasures:function(){return[]},getMeasure:function(a){var b=this.getMeasures(),c=0;for(c;c<b.length;++c)if(b[c].qDef.cId===a)return b[c];return null},addDimension:function(){throw d},getSorting:function(){throw d},addFieldDimension:function(a,b,c){var d=this.createFieldDimension(a,b,c);return this.addDimension(d)},addLibraryDimension:function(a,b){var c=this.createLibraryDimension(a,b);return this.addDimension(c)},addMeasure:function(){throw d},addExpressionMeasure:function(a,b,c){var d=this.createExpressionMeasure(a,b,c);return this.addMeasure(d)},addLibraryMeasure:function(a,b){var c=this.createLibraryMeasure(a,b);return this.addMeasure(c)},replaceDimension:function(){throw d},replaceMeasure:function(){throw d},autoSortDimension:function(){throw d},autoSortMeasure:function(){throw d},createFieldDimension:function(a,c,d){var e=b.extend(!0,{},this.dimensionProperties||{},d||{});return e.qDef||(e.qDef={}),e.qOtherTotalSpec||(e.qOtherTotalSpec={}),a?(e.qDef.qFieldDefs=[a],e.qDef.qFieldLabels=c?[c]:[""],e.qDef.qSortCriterias=[{qSortByLoadOrder:1}]):(e.qDef.qFieldDefs=[],e.qDef.qFieldLabels=[],e.qDef.qSortCriterias=[]),e.qDef.autoSort=!0,e},createLibraryDimension:function(a,c){var d=b.extend(!0,{},this.dimensionProperties||{},c||{});return d.qDef||(d.qDef={}),d.qOtherTotalSpec||(d.qOtherTotalSpec={}),d.qLibraryId=a,d.qDef.qSortCriterias=[{qSortByLoadOrder:1}],d.qDef.autoSort=!0,delete d.qDef.qFieldDefs,delete d.qDef.qFieldLabels,d},createExpressionMeasure:function(a,c,d){var e=b.extend(!0,{},this.measureProperties||{},d||{});return e.qDef||(e.qDef={}),e.qDef.qNumFormat||(e.qDef.qNumFormat={}),e.qDef.qDef=a,e.qDef.qLabel=c,e.qDef.autoSort=!0,e},createLibraryMeasure:function(a,c){var d=b.extend(!0,{},this.measureProperties||{},c||{});return d.qDef||(d.qDef={}),d.qDef.qNumFormat||(d.qDef.qNumFormat={}),d.qLibraryId=a,d.qDef.autoSort=!0,delete d.qDef.qDef,delete d.qDef.qLabel,d},getDimensionLayouts:function(){return this.layout&&this.layout.qHyperCube?this.layout.qHyperCube.qDimensionInfo:[]},getDimensionLayout:function(a){return this.getDimensionLayouts().filter(function(b){return a===b.cId})[0]},getMeasureLayouts:function(){return this.layout&&this.layout.qHyperCube?this.layout.qHyperCube.qMeasureInfo:[]},getMeasureLayout:function(a){return this.getMeasureLayouts().filter(function(b){return a===b.cId})[0]},removeDimension:function(){throw d},removeMeasure:function(){throw d},moveDimension:function(){throw d},moveMeasure:function(){throw d},changeSorting:function(){throw d}})}),define("general.utils/array-util",[],function(){function a(a){return a&&"[object Array]"===Object.prototype.toString.call(a)}function b(a){return a&&"function"==typeof a}function c(c,d){var e,f;if(!a(c))throw"No valid items were specified.";if(!b(d))throw"No valid action function was specified.";if(Array.prototype.forEach)c.forEach(d);else for(e in c)f=c[e],d(f)}function d(b,c){if(!a(b))throw"No valid items were specified.";if(Array.prototype.indexOf)return-1!==b.indexOf(c);for(var d=b.length;d--;)if(b[d]===c)return!0;return!1}function e(a,b){if(!(a&&b&&a.length&&b.length))return!1;var c,d=b.length;for(c=0;d>c;c++)if(a.indexOf(b[c])>-1)return!0;return!1}function f(a,b,c){if(c>=a.length)for(var d=c-a.length;d--+1;)a.push(void 0);a.splice(c,0,a.splice(b,1)[0])}function g(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function h(a,b){var c;for(c=0;c<a.length;++c)a[c]>=0&&a[c]>=b&&++a[c];a.push(b)}function i(a,b){var c,d=0;for(c=0;c<a.length;++c)a[c]>b?--a[c]:a[c]===b&&(d=c);a.splice(d,1)}function j(a,b){return a.length>b?a.slice(0,b):a}function k(a){if(!(a instanceof Array))throw new Error("Argument is not an Array.");return a.slice(0)}return{forEach:c,contains:d,move:f,swap:g,limit:j,indexAdded:h,indexRemoved:i,intersects:e,copy:k}}),define("general.models/library/dimension",["core.models/base-object","core.models/app"],function(a,b){var c;return c=a.extend("Dimension",{clone:function(){return this._super("CloneDimension")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])}},{listProperties:{qDimensionListDef:{qType:"dimension",qData:{title:"/title",tags:"/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}}}),c.get=function(a,c){function d(){return c.rpc("GetDimension","qReturn",[a])}return c=c||b.current,this.getModel(a,c.session,d)},c.create=function(b,d){return a.create.call(c,b,"CreateDimension",d)},c.remove=function(b,c){return a.remove(b,"DestroyDimension",c)},c}),define("general.models/library/measure",["core.models/base-object","core.models/app"],function(a,b){var c;return c=a.extend("Measure",{clone:function(){return this._super("CloneBookmark")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])}},{listProperties:{qMeasureListDef:{qType:"measure",qData:{title:"/title",tags:"/tags"}}}}),c.get=function(a,c){function d(){return c.rpc("GetMeasure","qReturn",[a])}return c=c||b.current,this.getModel(a,c.session,d)},c.create=function(b,d){return a.create.call(c,b,"CreateMeasure",d)},c.remove=function(b,c){return a.remove(b,"DestroyMeasure",c)},c}),define("objects.utils/data-properties/listobject-util",["util"],function(a){return{autoSortDimension:function(a,b){return a.qDef.qSortCriterias=[],a.qDef.autoSort=!0,b?b.forEach(function(b,c){a.qDef.qSortCriterias[c]={qSortByState:1,qSortByLoadOrder:1,qSortByNumeric:1,qSortByAscii:1}}):a.qDef.qSortCriterias[0]={qSortByState:1,qSortByLoadOrder:1,qSortByNumeric:1,qSortByAscii:1},a},createFieldDimension:function(a){return{qDef:{qFieldDefs:[a],qFieldLabels:[a],qSortCriterias:[]}}},createLibraryDimension:function(a){return{qLibraryId:a,qDef:{qSortCriterias:[]}}},createDefaultListBox:function(b,c){var d,e=a.extend(!0,{},b);
for(e.qShowAlternatives=!0,d=0;d<e.qDef.qSortCriterias.length;++d)e.qDef.qSortCriterias[d].qSortByState=1;return c=c||(b.qDef.qFieldLabels&&b.qDef.qFieldLabels.length?b.qDef.qFieldLabels[0]:""),{qInfo:{qType:"listbox"},qListObjectDef:e,title:c,visualization:"listbox"}}}}),define("client.assets/tab-contents/fields/assets-directdiscovery-service",[],function(){function a(a){return!!a.qTags&&-1!==a.qTags.indexOf("$dd_measure")}function b(a){return!!a.qTags&&-1!==a.qTags.indexOf("$dd_details")}function c(a){return!!a.qTags&&-1!==a.qTags.indexOf("$dd_dimension")}function d(a){return!!a.qTags&&-1!==a.qTags.indexOf("$directdiscovery")}function e(c){var d=c;return c&&(d=c.filter(function(c){return!a(c)&&!b(c)})),d}function f(d){var e="",f={qTags:d};return a(f)?e="DirectDiscovery.Measure":b(f)?e="DirectDiscovery.Details":c(f)&&(e="DirectDiscovery.Dimension"),e}return{isMeasure:a,isDetails:b,isDimension:c,removeMeasureAndDetailsFields:e,getTypeTranslationKey:f,isDirectDiscoveryField:d}}),define("client.assets/tab-contents/fields/assets-field-list-model",["objects.utils/data-properties/listobject-util","client.assets/tab-contents/fields/assets-directdiscovery-service"],function(a,b){function c(b){var c;return c=a.createFieldDimension(b.qName),a.autoSortDimension(c,[b]),{id:"newObject",args:{template:"filterpane",children:[a.createDefaultListBox(c,b.qName)],init:{}}}}function d(a){for(var b=[],c=0;c<a.length;++c){var d=a[c];if(b.push(d),d.qDerivedFieldData)for(var e=0;e<d.qDerivedFieldData.qDerivedFieldLists.length;++e)for(var f=d.qDerivedFieldData.qDerivedFieldLists[e],g=0;g<f.qFieldDefs.length;++g){var h=f.qFieldDefs[g];b.push({qName:h.qName,qSrcTables:d.qSrcTables,qTags:h.qTags,isDerived:!0,sourceField:d.qName,derivedDefinitionName:f.qDerivedDefinitionName})}}return b}var e={create:function(a){return a.map(function(a){return{id:a.qName,name:a.qName,type:"field",srcTables:a.qSrcTables,sourceField:a.sourceField,calendarTemplateName:a.derivedDefinitionName,getDropOption:c.curry(a),tags:a.qTags,icon:b.isDirectDiscoveryField(a)?"directdiscovery":"",iconTooltip:b.getTypeTranslationKey(a.qTags),derivedCalendars:a.qDerivedFieldData?a.qDerivedFieldData.qDerivedFieldLists.map(function(a){return a.qDerivedDefinitionName}):[]}})},expand:d,createFromArray:function(a,b){var d,e=[];for(d=0;d<a.length;d++)b&&(a[d].qName=a[d][b]),e.push({name:a[d].qName,type:"field",getDropOption:c.curry(a[d])});return e},getTables:function(a){var b,c,d,e=a;for(d=[],b=0;b<e.length;++b)for(c=0;c<e[b].qSrcTables.length;++c)-1===d.indexOf(e[b].qSrcTables[c])&&d.push(e[b].qSrcTables[c]);return d}};return e}),define("objects.utils/data-properties/library-utils",["general.utils/array-util","general.models/field","general.models/library/dimension","general.models/library/measure","client.assets/tab-contents/fields/assets-field-list-model"],function(a,b,c,d,e){function f(a){return b.getListLayout().then(function(b){var c,d;if(b)for(c=0;c<b.length;c++)if(d=b[c],d.qName===a)return d;return null})}function g(a){return d.getListLayout().then(function(b){var c,d;if(b)for(c=0;c<b.length;c++)if(d=b[c],d.qInfo.qId===a)return d;return null})}function h(a){return c.getListLayout().then(function(b){var c,d;if(b)for(c=0;c<b.length;c++)if(d=b[c],d.qInfo.qId===a)return d;return null})}function i(){return b.getListLayout().then(function(a){return e.expand(a).sort(function(a,b){return a.qName.toLowerCase().localeCompare(b.qName.toLowerCase())})})}function j(){return c.getListLayout().then(function(b){return a.copy(b).sort(function(a,b){return a.qData.title.toLowerCase().localeCompare(b.qData.title.toLowerCase())})})}function k(){return d.getListLayout().then(function(b){return a.copy(b).sort(function(a,b){return a.qData.title.toLowerCase().localeCompare(b.qData.title.toLowerCase())})})}return{findField:f,findLibraryDimension:h,findLibraryMeasure:g,getSortedFields:i,getSortedDimensions:j,getSortedMeasures:k}}),define("objects.utils/data-properties/hypercube-handler",["./data-property-handler","core.utils/deferred","objects.utils/data-properties/library-utils","general.utils/array-util","util"],function(a,b,c,d,e){var f,g=1e3,h=1e3;return f=a.extend({init:function(a,b,c,d){this._super(a,b,c,d)},setProperties:function(a){a.qHyperCubeDef&&(this._super(a),this.hcProperties=a.qHyperCubeDef,this.hcProperties.qDimensions||(this.hcProperties.qDimensions=[]),this.hcProperties.qMeasures||(this.hcProperties.qMeasures=[]),this.hcProperties.qInterColumnSortOrder||(this.hcProperties.qInterColumnSortOrder=[]),this.hcProperties.qLayoutExclude||(this.hcProperties.qLayoutExclude={}),this.hcProperties.qLayoutExclude.qHyperCubeDef||(this.hcProperties.qLayoutExclude.qHyperCubeDef={}),this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions||(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions=[]),this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures||(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures=[]),this.hcProperties.qDimensions.forEach(function(a){void 0!==a.autoSort&&(a.qDef.autoSort=a.autoSort,delete a.autoSort)}),this.hcProperties.qMeasures.forEach(function(a){void 0!==a.autoSort&&(a.qDef.autoSort=a.autoSort,delete a.autoSort)}))},getDimensions:function(){return this.hcProperties?this.hcProperties.qDimensions:[]},getMeasures:function(){return this.hcProperties?this.hcProperties.qMeasures:[]},getSorting:function(){return this.hcProperties.qInterColumnSortOrder},addDimension:function(a){var c=this.getDimensions(),f=this;return a.qDef.cId||(a.qDef.cId=e.generateId()),c.length<this.maxDimensions()?(c.push(a),this.autoSortDimension(a).then(function(){return d.indexAdded(f.hcProperties.qInterColumnSortOrder,c.length-1),"function"==typeof f.dimensionDefinition.add?b.when(f.dimensionDefinition.add.call(f,a,f.properties,f)).then(function(){return a}):a})):c.length<g?(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.push(a),b.resolve(a)):void 0},addMeasure:function(a){var c=this.getMeasures(),f=this;return a.qDef.cId||(a.qDef.cId=e.generateId()),delete a.qDef.qNumFormat,c.length<this.maxMeasures()?(c.push(a),this.autoSortMeasure(a).then(function(){return d.indexAdded(f.hcProperties.qInterColumnSortOrder,f.getDimensions().length+c.length-1),"function"==typeof f.measureDefinition.add?b.when(f.measureDefinition.add.call(null,a,f.properties,f)).then(function(){return a}):a})):c.length<h?(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.push(a),b.resolve(a)):void 0},replaceDimension:function(a,b){var c=this.getDimensions(),d=c[a],f=this;return this.autoSortDimension(b).then(function(){return b.qDef.cId=e.generateId(),c[a]=b,"function"==typeof f.dimensionDefinition.replace&&f.dimensionDefinition.replace.call(null,b,d,a,f.properties,f),b})},replaceMeasure:function(a,b){var c=this.getMeasures(),d=c[a],f=this;return this.autoSortMeasure(b).then(function(){return b.qDef.cId=e.generateId(),c[a]=b,"function"==typeof f.measureDefinition.replace&&f.measureDefinition.replace.call(null,b,d,a,f.properties,f),b})},autoSortDimension:function(a){function b(b){b.forEach(function(b,c){var e=b.qTags,f={qSortByLoadOrder:1};"function"==typeof d.dimensionDefinition.autoSort?d.dimensionDefinition.autoSort(a,d.properties,e,f,d):e&&(e.contains("$numeric")?f.qSortByNumeric=1:(e.contains("$text")||e.contains("$ascii"))&&(f.qSortByAscii=1)),a.qDef.qSortCriterias[c]=f})}var d=this;return a.qLibraryId?c.findLibraryDimension(a.qLibraryId).then(function(c){return c&&b(c.qData.info),a}):c.findField(a.qDef.qFieldDefs[0]).then(function(c){return c&&b([c]),a})},autoSortMeasure:function(a){return a.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},b.resolve(a)},removeDimension:function(a){var c,e=this.getDimensions();if(a<e.length){if(c=this.hcProperties.qDimensions.splice(a,1)[0],this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.length?e.push(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(0,1)[0]):d.indexRemoved(this.hcProperties.qInterColumnSortOrder,a),"function"==typeof this.dimensionDefinition.remove)return b.when(this.dimensionDefinition.remove.call(null,c,this.properties,this,a))}else c=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(a-e.length,1);return b.resolve(c)},removeMeasure:function(a){var c,e=this.getMeasures();if(a<e.length){if(c=this.hcProperties.qMeasures.splice(a,1)[0],this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length?e.push(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(0,1)[0]):d.indexRemoved(this.hcProperties.qInterColumnSortOrder,this.getDimensions().length+a),"function"==typeof this.measureDefinition.remove)return b.when(this.measureDefinition.remove.call(null,c,this.properties,this,a))}else c=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(a-e.length,1)[0];return b.resolve(c)},moveDimension:function(a,c){var e,f,g,h=this.getDimensions(),i=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions;return a<h.length&&c<h.length?d.move(h,a,c):a<h.length&&c>=h.length?(f=c-h.length,g=i.splice(0,1)[0],h.push(g),g=h.splice(a,1)[0],i.splice(f,0,g)):a>=h.length&&c<h.length?(e=a-h.length,g=h.splice(h.length-1,1)[0],i.splice(0,0,g),g=i.splice(e+1,1)[0],h.splice(c,0,g)):(e=a-h.length,f=c-h.length,d.move(i,e,f)),b.resolve(g)},moveMeasure:function(a,c){var e,f,g,h=this.getMeasures(),i=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures;return a<h.length&&c<h.length?d.move(h,a,c):a<h.length&&c>=h.length?(f=c-h.length,g=i.splice(0,1)[0],h.push(g),g=h.splice(a,1)[0],i.splice(f,0,g)):a>=h.length&&c<h.length?(e=a-h.length,g=h.splice(h.length-1,1)[0],i.splice(0,0,g),g=i.splice(e+1,1)[0],h.splice(c,0,g)):(e=a-h.length,f=c-h.length,d.move(i,e,f)),b.resolve(g)},changeSorting:function(a,b){d.move(this.hcProperties.qInterColumnSortOrder,a,b)},setSorting:function(a){a&&a.length===this.hcProperties.qInterColumnSortOrder.length&&(this.hcProperties.qInterColumnSortOrder=a)}})}),define("objects.utils/data-properties/listobject-handler",["core.utils/deferred","./data-property-handler","objects.utils/data-properties/listobject-util","objects.utils/data-properties/library-utils","util"],function(a,b,c,d,e){var f=b.extend({init:function(a,b){this._super(a,null,b,null)},setProperties:function(a){this._super(a),this.properties.qListObjectDef&&void 0!==this.properties.qListObjectDef.autoSort&&(this.properties.qListObjectDef.qDef.autoSort=this.properties.qListObjectDef.autoSort,delete this.properties.qListObjectDef.autoSort)},minDimensions:function(){return 1},maxDimensions:function(){return 1},minMeasures:function(){return 0},maxMeasures:function(){return 0},autoSortDimension:function(a){return c.autoSortDimension(a)},getDimensions:function(){var a=this.properties.qListObjectDef.qDef;return a&&a.qFieldDefs&&a.qFieldDefs.length||this.properties.qListObjectDef.qLibraryId?[this.properties.qListObjectDef]:[]},addDimension:function(a){function b(){f.properties.qListObjectDef=e.extend(!0,f.properties.qListObjectDef,a),"function"==typeof f.dimensionDefinition.add&&f.dimensionDefinition.add.call(null,a,f.properties,f)}var f=this;return a.qLibraryId?d.findLibraryDimension(a.qLibraryId).then(function(d){return d&&c.autoSortDimension(a,d.qData.info),b(),a}):d.findField(a.qDef.qFieldDefs[0]).then(function(d){return d&&c.autoSortDimension(a,[d]),b(),a})},replaceDimension:function(b,d){var f=this,g=e.extend(!0,this.properties.qListObjectDef,d);return c.autoSortDimension(d),d.qLibraryId?(delete g.qDef.qFieldDefs,delete g.qDef.qFieldLabels):delete g.qLibraryId,f.properties.qListObjectDef=g,a.resolve(d)},removeDimension:function(){},getDimensionLayout:function(){return this.layout&&this.layout.qListObject&&this.layout.qListObject.qDimensionInfo?this.layout.qListObject.qDimensionInfo:""},getMeasures:function(){return this.properties.qListObjectDef.qExpressions},getMeasureLayout:function(){return this.layout&&this.layout.qListObject&&this.layout.qListObject.qExpressions&&this.layout.qListObject.qExpressions[0]?this.layout.qListObject.qExpressions[0].qExpr:""}});return f}),define("text!objects.extension/default-template.ng.html",[],function(){return'<div qv-extension style="height: 100%; position: relative;"></div>\r\n'}),define("storytelling.utils/snapshot-helper",["jquery","util","qvangular","client.models/snapshot","core.utils/deferred"],function(a,b,c,d,e){function f(){var a=c.getService("$delayedModal"),d=b.extend(!0,{},{},{title:"Storytelling.Snapshot.MaxLimitReached.Title",html:'<p class="dm-p" q-translation="Storytelling.Snapshot.MaxLimitReached.Text"></p>'});a.open(d)}function g(a){var b=!l||l!==a;return b&&(l=a,setTimeout(function(){l=null},k)),b}function h(b,c,d){var e=c.layout,f=e.qInfo.qId;if(g(f)){var h=a(d.target).parents(".qv-object");i(e,c,!0).then(function(a){j(b,c,h,a)})}}function i(d,f,g){var h=new e,i=new Date,j=g?b.extend(!0,{},d):d;return j.snapshotData={object:{size:f.objectSize}},f.setSnapshotData(j).then(function(){if(g){delete j.qInfo,j.visualizationType=d.qInfo.qType,j.sourceObjectId=d.qInfo.qId,j.sheetId=c.$rootScope.State.model.id,j.timestamp=i.getTime(),j.isClone=!1,j.libraryTitle=d.title;var e=a(".qv-panel-sheet");j.snapshotData.parent={h:e.height(),w:e.width()}}else j.snapshotData.object.origDataPages=f.model.layout.snapshotData.object.origDataPages,j.snapshotData.content&&(j.snapshotData.content.chartData=b.extend(!0,{},f.model.layout.snapshotData.content.chartData));h.resolve(j)}),h.promise}function j(a,b,c,e){var g=b.ext.snapshot;d.Snapshot.create(e).then(function(b){b?(g.animate(c),a&&g.updateCount(a)):f()})}var k=1e3,l=null;return{createSnapshot:h,prepSnapshotData:i}}),define("objects.extension/export-format",[],function(){function a(a){a=void 0!==a?a:1,this.data=[];for(var b=0;a>b;++b)this.data.push({dimensions:[],measures:[]});this.properties={}}return a}),define("objects.extension/object-conversion",["util","objects.extension/export-format","general.utils/array-util","general.utils/property-resolver"],function(a,b,c,d){function e(a,b,c){b.hasOwnProperty(a)&&(c[a]=b[a])}function f(a,b,c,d){c[a]=b.hasOwnProperty(a)?b[a]:d}function g(a,b,c){a.qInfo.qType="masterobject"===b.properties.qInfo.qType?"masterobject":c.qInfo.qType,a.visualization=c.visualization,a.version=c.version}function h(a,b,c){var e=c.qProperty,f=c.qProperty.qLayoutExclude;return/boolean|number|string/.test(typeof b)?(f&&(f.changed||(f.changed={}),f.changed[a]={from:d.getValue(e,a),to:b}),void d.setValue(e,a,b)):void d.setValue(e,a,b)}function i(a,b,c){var e,f,g=b.properties,h=b.properties.qLayoutExclude,i=d.getValue(g,a);if(!/boolean|number|string/.test(typeof i))try{if(e=JSON.stringify(i),f=e.match(/:\{/g),f=f?f.length:0,f>2)return;i=JSON.parse(e)}catch(j){return}h||(b.properties.qLayoutExclude={quarantine:{}},h=b.properties.qLayoutExclude),h.quarantine||(h.quarantine={}),h.quarantine[c]||(h.quarantine[c]={}),h.quarantine[c][a]=i}function j(a,b){var c,e=a.qLayoutExclude?a.qLayoutExclude.quarantine:{};if(!e[b])return!1;e=e[b];for(c in e)d.setValue(a,c,e[c]);return delete a.qLayoutExclude.quarantine[b],!0}function k(a){for(var b in a.qLayoutExclude.changed)a.qLayoutExclude.changed[b].to===d.getValue(a,b)&&d.setValue(a,b,a.qLayoutExclude.changed[b].from)}var l,m,n,o,p,q;return l={exportProperties:function(c){var d,e,f,g=new b,h=c.qProperty,i=h.qHyperCubeDef,j=g.data[0];for(d=0;d<i.qDimensions.length;++d)j.dimensions.push(i.qDimensions[d]);if(i.qLayoutExclude&&i.qLayoutExclude.qHyperCubeDef&&i.qLayoutExclude.qHyperCubeDef.qDimensions)for(d=0;d<i.qLayoutExclude.qHyperCubeDef.qDimensions.length;++d)j.dimensions.push(i.qLayoutExclude.qHyperCubeDef.qDimensions[d]);for(d=0;d<i.qMeasures.length;++d)j.measures.push(i.qMeasures[d]);if(i.qLayoutExclude&&i.qLayoutExclude.qHyperCubeDef&&i.qLayoutExclude.qHyperCubeDef.qMeasures)for(d=0;d<i.qLayoutExclude.qHyperCubeDef.qMeasures.length;++d)j.measures.push(i.qLayoutExclude.qHyperCubeDef.qMeasures[d]);delete i.qLayoutExclude;for(e in h)g.properties[e]=h[e];if(h.qLayoutExclude||(h.qLayoutExclude={}),h.qLayoutExclude.disabled){for(e in h.qLayoutExclude.disabled)f=e,g.properties.hasOwnProperty(f)||(g.properties[f]=h.qLayoutExclude.disabled[e]);delete h.qLayoutExclude.disabled}return h.qLayoutExclude.changed&&(k(h),delete h.qLayoutExclude.changed),(!h.qLayoutExclude.quarantine||a.isEmpty(h.qLayoutExclude.quarantine))&&delete h.qLayoutExclude,g},importProperties:function(b,d,h){var i,j,k,l={qChildren:[]},m={},n=b.data[0],o=h.data&&h.data.measures;o||(o=h.definition&&h.definition.items&&h.definition.items.measures||{max:0});var p="function"==typeof o.max?o.max(n.dimensions.length):o.max,q=h.data&&h.data.dimensions;q||(q=h.definition&&h.definition.items&&h.definition.items.dimensions||{max:0});var r="function"==typeof q.max?q.max(p):q.max;m.qLayoutExclude||(m.qLayoutExclude={}),m.qLayoutExclude.disabled={},m.qLayoutExclude.quarantine={};for(i in b.properties)"qLayoutExclude"===i?b.properties[i].quarantine&&(m.qLayoutExclude.quarantine=a.extend(!0,{},b.properties[i].quarantine)):d.hasOwnProperty(i)||"qMetaDef"===i?m[i]=b.properties[i]:m.qLayoutExclude.disabled[i]=b.properties[i];for(m=a.extend(!0,{},d,m),m.qHyperCubeDef.qDimensions.length=0,m.qHyperCubeDef.qMeasures.length=0,(n.dimensions.length>r||n.measures.length>p)&&(m.qHyperCubeDef.qLayoutExclude||(m.qHyperCubeDef.qLayoutExclude={}),m.qHyperCubeDef.qLayoutExclude.qHyperCubeDef||(m.qHyperCubeDef.qLayoutExclude.qHyperCubeDef={}),n.dimensions.length>r&&(m.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions||(m.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions=[])),n.measures.length>p&&(m.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures||(m.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures=[]))),j=0;j<n.dimensions.length;++j)m.qHyperCubeDef.qDimensions.length<r?m.qHyperCubeDef.qDimensions.push(n.dimensions[j]):m.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(n.dimensions[j]);for(j=0;j<n.measures.length;++j)m.qHyperCubeDef.qMeasures.length<p?m.qHyperCubeDef.qMeasures.push(n.measures[j]):m.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(n.measures[j]);for(k=m.qHyperCubeDef.qDimensions.length+m.qHyperCubeDef.qMeasures.length,m.qHyperCubeDef.qInterColumnSortOrder||(m.qHyperCubeDef.qInterColumnSortOrder=[]),j=m.qHyperCubeDef.qInterColumnSortOrder.length;j!==k;)k>j?(c.indexAdded(m.qHyperCubeDef.qInterColumnSortOrder,j),++j):(--j,c.indexRemoved(m.qHyperCubeDef.qInterColumnSortOrder,j));return e("qAlwaysFullyExpanded",d.qHyperCubeDef,m.qHyperCubeDef),e("qMaxStackedCells",d.qHyperCubeDef,m.qHyperCubeDef),e("qSuppressZero",d.qHyperCubeDef,m.qHyperCubeDef),e("qSuppressMissing",d.qHyperCubeDef,m.qHyperCubeDef),e("qNoOfLeftDims",d.qHyperCubeDef,m.qHyperCubeDef),f("qInitialDataFetch",d.qHyperCubeDef,m.qHyperCubeDef,[{qTop:0,qLeft:0,qWidth:0,qHeight:0}]),f("qMode",d.qHyperCubeDef,m.qHyperCubeDef,"S"),f("qReductionMode",d.qHyperCubeDef,m.qHyperCubeDef,"N"),g(m,b,d),l.qProperty=m,l}},m={exportProperties:function(a){var c,d,e,f=new b,g=a.qProperty,h=g.qListObjectDef,i=f.data[0];if(i.dimensions.push({qLibraryId:h.qLibraryId,qDef:h.qDef,title:h.title}),h.qLayoutExclude&&h.qLayoutExclude.qHyperCubeDef&&h.qLayoutExclude.qHyperCubeDef.qDimensions)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qDimensions.length;++c)i.dimensions.push(h.qLayoutExclude.qHyperCubeDef.qDimensions[c]);if(h.qLayoutExclude&&h.qLayoutExclude.qHyperCubeDef&&h.qLayoutExclude.qHyperCubeDef.qMeasures)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qMeasures.length;++c)i.measures.push(h.qLayoutExclude.qHyperCubeDef.qMeasures[c]);delete h.qLayoutExclude;for(d in g)f.properties[d]=g[d];if(g.qLayoutExclude&&g.qLayoutExclude._disabled){for(d in g.qLayoutExclude._disabled)e="_"===d.substr(0,1)?d.substring(1):d,f.properties.hasOwnProperty(e)||(f.properties[e]=g.qLayoutExclude.disabled[d]);delete g.qLayoutExclude.disabled}for(c=0;c<i.dimensions[0].qDef.qSortCriterias.length;++c)i.dimensions[0].qDef.qSortCriterias[c].qSortByFrequency=0;return f},importProperties:function(b,c){var d,e,f={qChildren:[]},h={},i=b.data[0],j=1;h.qLayoutExclude||(h.qLayoutExclude={}),h.qLayoutExclude.disabled={};for(d in b.properties)"qLayoutExclude"===d?b.properties[d].quarantine&&(h.qLayoutExclude.quarantine=a.extend(!0,{},b.properties[d].quarantine)):c.hasOwnProperty(d)||"qMetaDef"===d?h[d]=b.properties[d]:h.qLayoutExclude.disabled[d]=b.properties[d];for(h=a.extend(!0,{},c,h),h.qListObjectDef.qLayoutExclude||(h.qListObjectDef.qLayoutExclude={}),h.qListObjectDef.qLayoutExclude.qHyperCubeDef||(h.qListObjectDef.qLayoutExclude.qHyperCubeDef={}),h.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions||(h.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions=[]),h.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures||(h.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures=[]),e=0;e<i.dimensions.length;++e)j>e?(h.qListObjectDef.qDef=i.dimensions[e].qDef,h.qListObjectDef.qLibraryId=i.dimensions[e].qLibraryId):h.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(i.dimensions[e]);for(e=0;e<i.measures.length;++e)h.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(i.measures[e]);return h.qListObjectDef.qInitialDataFetch=c.qListObjectDef.qInitialDataFetch,g(h,b,c),f.qProperty=h,f}},n={importProperties:function(a,b,c){var e=this.hypercube.importProperties(a,b,c),f=d.getValue(e,"qProperty.visualization"),g=d.getValue(e,"qProperty.qHyperCubeDef.qDimensions",[]),h=d.getValue(e,"qProperty.qHyperCubeDef.qMeasures",[]).length,i=d.getValue(e,"qProperty.qHyperCubeDef.qMeasures.0.qAttributeExpressions",[]),j=d.getValue(e,"qProperty.color.colorExpression",""),k=d.getValue(e,"qProperty.color.mode","");return h&&(i.splice(0,0,{qExpression:j,type:"colorByExpression"}),d.setValue(e,"qProperty.qHyperCubeDef.qMeasures.0.qAttributeExpressions",i)),("scatterplot"===f||h>1)&&"byMeasure"===k&&d.setValue(e,"qProperty.color.mode","primary"),g.forEach(function(a){"qTotalMode"in a.qOtherTotalSpec&&delete a.qOtherTotalSpec.qTotalMode,"qGlobalOtherGrouping"in a.qOtherTotalSpec&&delete a.qOtherTotalSpec.qGlobalOtherGrouping}),e},exportProperties:function(a){var b=this.hypercube.exportProperties(a),c=-1,e=d.getValue(b,"properties.qHyperCubeDef.qMeasures.0.qAttributeExpressions",[]);return e.every(function(a,b){"colorByExpression"===a.type&&(c=b)}),c>=0&&e.splice(c,1),b}},o={importProperties:function(b,c,d){var e,f,g=this.colorChart.importProperties.apply(this,[b,c,d]),h=g.qProperty;if(c.measureAxis&&"undefined"==typeof c.measureAxis.autoMinMax?j(h,"unsupportedAutoMinMax")||a.extend(h.measureAxis,c.measureAxis):j(h,"supportedAutoMinMax")||a.extend(h.measureAxis,c.measureAxis),b.properties.measureAxes&&!c.measureAxes&&c.measureAxis&&"undefined"!=typeof c.measureAxis.autoMinMax){var i=[];if(h.qHyperCubeDef.qMeasures.length>0&&h.qHyperCubeDef.qMeasures.forEach(function(a){a.qDef.series&&(i[a.qDef.series.axis]||(i[a.qDef.series.axis]={axis:a.qDef.series.axis,type:{line:0,marker:0,bar:0,total:0}}),["bar","marker","line"].contains(a.qDef.series.type)&&i[a.qDef.series.axis].type[a.qDef.series.type]++,i[a.qDef.series.axis].type.total++)}),i.length){var k="barchart"===c.visualization?"bar":"linechart"===c.visualization?"line":"";k&&(e=i.filter(function(a){return a.type[k]>0}).sort(function(a,b){return b.type[k]-a.type[k]})),e&&e.length||(e=i.sort(function(a,b){return b.type.total-a.type.total})),e&&e[0]&&a.extend(h.measureAxis,b.properties.measureAxes[e[0].axis])}else a.extend(h.measureAxis,b.properties.measureAxes[0])}return h.qHyperCubeDef.qDimensions.length>1&&(f=h.qHyperCubeDef.qInterColumnSortOrder.indexOf(0),0!==f&&(e=h.qHyperCubeDef.qInterColumnSortOrder[0],h.qHyperCubeDef.qInterColumnSortOrder[0]=0,h.qHyperCubeDef.qInterColumnSortOrder[f]=e)),g},exportProperties:function(a){var b=this.colorChart.exportProperties.apply(this,[a]);return"gauge"===b.properties.visualization?(i("measureAxis.min",b,"unsupportedAutoMinMax"),i("measureAxis.max",b,"unsupportedAutoMinMax")):(i("measureAxis.min",b,"supportedAutoMinMax"),i("measureAxis.max",b,"supportedAutoMinMax")),b}},p={importProperties:function(a,b,c){var e,f,g=this.hypercube.importProperties(a,b,c),h=d.getValue(g,"qProperty.qHyperCubeDef.qDimensions",[]),i=h.length,k=d.getValue(g,"qProperty.qHyperCubeDef.qMeasures",[]).length,l=d.getValue(g,"qProperty.qHyperCubeDef.qInterColumnSortOrder",[]),m=!0;i+k===l.length&&d.setValue(g,"qProperty.qLayoutExclude.quarantine.interColSortOrder",l);var n=d.getValue(g,"qProperty.qLayoutExclude.quarantine.pivotInterColSortOrder");if(n&&(l=n,f=n.slice(),d.setValue(g,"qProperty.qHyperCubeDef.qInterColumnSortOrder",l),delete g.qProperty.qLayoutExclude.quarantine.pivotInterColSortOrder),i>l.length)for(e=l.length;i>e;e++)l.indexOf(e)<0&&l.push(e);for(e=l.length-1;e>=0;e--)l[e]>=i&&l.splice(e,1);if(k>1&&l.indexOf(-1)<0?l.push(-1):2>k&&l.indexOf(-1)>-1&&l.splice(l.indexOf(-1),1),i>0&&-1===d.getValue(g,"qProperty.qHyperCubeDef.qNoOfLeftDims",-1)&&d.setValue(g,"qProperty.qHyperCubeDef.qNoOfLeftDims",i),f&&l&&f.length===l.length){for(e=0;e<f.length;e++)if(f[e]!==l[e]){m=!1;break}m&&j(g.qProperty,"noOfLeftDims")}return h.forEach(function(a){"qTotalMode"in a.qOtherTotalSpec||(a.qOtherTotalSpec.qTotalMode="TOTAL_EXPR")}),g},exportProperties:function(a){var b=this.hypercube.exportProperties(a),c=b.properties.qHyperCubeDef,e=c.qDimensions.length,f=c.qMeasures.length,g=c.qInterColumnSortOrder;d.setValue(b,"properties.qLayoutExclude.quarantine.pivotInterColSortOrder",g.slice(0)),i("qHyperCubeDef.qNoOfLeftDims",b,"noOfLeftDims");var h=d.getValue(b,"properties.qLayoutExclude.quarantine.interColSortOrder");h&&(g=h,d.setValue(b,"properties.qHyperCubeDef.qInterColumnSortOrder",g),delete b.properties.qLayoutExclude.quarantine.interColSortOrder);var j=g.indexOf(-1);j>-1&&g.splice(j,1);for(var k=e;e+f>k;k++)g.length<=k&&g.push(k);return b}},q={importProperties:function(b,c){var d,e={qChildren:[]},f={};f.qLayoutExclude||(f.qLayoutExclude={}),f.qLayoutExclude.disabled={};for(d in b.properties)"qLayoutExclude"!==d&&(c.hasOwnProperty(d)||"qMetaDef"===d?f[d]=b.properties[d]:f.qLayoutExclude.disabled[d]=b.properties[d]);return f=a.extend(!0,{},c,f),g(f,b,c),e.qProperty=f,e},exportProperties:function(a){var c,d,e=new b,f=a.qProperty;for(c in f)e.properties[c]=f[c];if(f.qLayoutExclude||(f.qLayoutExclude={}),f.qLayoutExclude.disabled)for(c in f.qLayoutExclude.disabled)d=c,e.properties.hasOwnProperty(d)||(e.properties[d]=f.qLayoutExclude.disabled[c]);return delete f.qLayoutExclude,e}},{importCommonProperties:g,hypercube:l,listbox:m,axisChart:o,colorChart:n,pivotChart:p,other:q,changeProperty:h}}),define("objects.extension/default-extension",["jquery","qvangular","core.utils/deferred","objects.backend-api/generic-api","general.utils/property-mapper","objects.utils/data-properties/hypercube-handler","objects.utils/data-properties/listobject-handler","text!./default-template.ng.html","client.models/snapshot","storytelling.utils/snapshot-helper","general.utils/visualizations","objects.utils/data-properties/library-utils","objects.extension/object-conversion"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){if(a.qHyperCube)return a.qHyperCube.qDimensionInfo||[];if(a.qChildList){var b=a.qChildList.qItems||[];return b.map(function(){return{}})}var c=!a.qListObject||!a.qListObject.qDimensionInfo||a.qListObject.qDimensionInfo.qError;return c?[]:[a.qListObject.qDimensionInfo]}function o(a){return a.qHyperCube?a.qHyperCube.qMeasureInfo||[]:[]}function p(a){var b,d,e,f,g=c(),h=[],i=[];for(b=0;b<a.data.length;++b){for(d=0;d<a.data[b].dimensions.length;++d)e=a.data[b].dimensions[d],e.qLibraryId&&(h.push(l.findLibraryDimension(e.qLibraryId)),i.push(e));for(d=0;d<a.data[b].measures.length;++d)f=a.data[b].measures[d],f.qLibraryId&&(h.push(l.findLibraryDimension(f.qLibraryId)),i.push(f))}return c.all(h).then(function(a){for(b=0;b<a.length;++b)a[b]&&(i[b].title=a[b].qData.title);g.resolve()}),g.promise}return{BackendApi:d,template:h,mapProperties:function(){this.mappedDefinition=e.mapDefinition(this.definition,this.type,this.globalChangeListeners),this.globalChangeListeners=e.findGlobalListeners(this.mappedDefinition);var a=this.data&&this.data.dimensions;a?(a.min="undefined"!=typeof a.min?a.min:1,a.max="undefined"!=typeof a.max?a.max:1e3):(a=e.findDefinition(this.mappedDefinition,"qHyperCubeDef.qDimensions",!0),a||(a=e.findDefinition(this.mappedDefinition,"qListObjectDef",!0)),a&&(a.obsolete=!0)),this.dimensionDefinition=a;var b=this.data&&this.data.measures;b?(b.min="undefined"!=typeof b.min?b.min:1,b.max="undefined"!=typeof b.max?b.max:1):(b=e.findDefinition(this.mappedDefinition,"qHyperCubeDef.qMeasures",!0),b&&(b.obsolete=!0)),this.measureDefinition=b},getCreatePropertyHandler:function(){var a,b,c=this,d=c.mappedDefinition;return c.propertyHandler||(this.model.layout.qListObject?(a=e.mapProperties(this.dimensionDefinition),c.propertyHandler=new g(this.dimensionDefinition,a)):(this.dimensionDefinition&&this.dimensionDefinition.obsolete?a=e.mapProperties(this.dimensionDefinition):this.dimensionDefinition&&(a=e.mapProperties(d.items.data.items.dimensions)),this.measureDefinition&&this.measureDefinition.obsolete?b=e.mapProperties(this.measureDefinition):this.measureDefinition&&(b=e.mapProperties(d.items.data.items.measures)),c.propertyHandler=new f(this.dimensionDefinition,this.measureDefinition,a,b))),c.propertyHandler},hasError:function(a){var b=a.layout;return b.qHyperCube?!!b.qHyperCube.qError:b.qListObject?!!b.qListObject.qError:!1},showRequirements:function(a){var b,c=a.ext.dimensionDefinition?a.ext.dimensionDefinition.min:0,d=a.ext.measureDefinition?a.ext.measureDefinition.min:0,e=n(a.layout),f=o(a.layout);if(c>0&&e.length<c)return!0;for(b=0;b<e.length;++b)if(e[b].qError)return!0;if(d>0&&f.length<d)return!0;for(b=0;b<f.length;++b)if(f[b].qError)return!0;return!1},addFieldDimension:function(a,c){return c.model.getProperties().then(function(d){var e=c.ext.getCreatePropertyHandler();return e.setProperties(d),e.addFieldDimension(a.value,"").then(function(a){b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)})})},addLibraryDimension:function(a,c){return c.model.getProperties().then(function(d){var e=c.ext.getCreatePropertyHandler();return e.setProperties(d),e.addLibraryDimension(a.libraryId).then(function(a){b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)})})},addLibraryMeasure:function(a,c){return c.model.getProperties().then(function(d){var e=c.ext.getCreatePropertyHandler();return e.setProperties(d),e.addLibraryMeasure(a.libraryId).then(function(a){b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)})})},addExpressionMeasure:function(a,c){return c.model.getProperties().then(function(d){var e=c.ext.getCreatePropertyHandler();return e.setProperties(d),e.addExpressionMeasure(a.value,"").then(function(a){b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)})})},getDropFieldOptions:function(a,b,c,d,e){a.Add(c,b,e),a.ReplaceDimensions(c,b,e),a.AddFieldAsMeasure(c,b,e),d()},getDropDimensionOptions:function(a,c,d,e,f){c.getDimensions().length<c.minDimensions()?c.addLibraryDimension(a.item.id).then(function(a){d.save(),b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)}):(a.Add(d,c,f),a.ReplaceDimensions(d,c,f),e())},getDropMeasureOptions:function(a,c,d,e,f){c.getMeasures().length<c.minMeasures()?"expression"===a.item.type?c.addExpressionMeasure(a.item.name,"").then(function(a){d.save(),b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)}):c.addLibraryMeasure(a.item.id).then(function(a){d.save(),b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)}):(a.Add(d,c,f),a.ReplaceMeasures(d,c,f),e())},getDropTemplateOptions:function(a,b,c,d,e){var f=this,g=k.getType(a.item.template),h=["contextMenu.convertTo",a.item.name];f.type!==g.type?g.getExtensionType().then(function(b){!e.isReadonly&&f.exportProperties&&b.importProperties&&a.menu.addItem({translation:h,tid:"convert",select:function(){f._convert(g,b)}}),d()},function(){d()}):d()},getDropOptions:function(a,b,c){var d,e,f,g=a.model,h=this;return e={field:"getDropFieldOptions",dimension:"getDropDimensionOptions",measure:"getDropMeasureOptions",template:"getDropTemplateOptions",expression:"getDropMeasureOptions"},d=b.item.type,(f=e[d])?g.getProperties().then(function(d){var e=h.getCreatePropertyHandler();
return e.setProperties(d),h[f](b,e,g,c,a)}):void c()},_convert:function(a,b){var d,e,f=this;c.all({initialProperties:a.getInitialProperties(),propertyTree:f.model.getFullPropertyTree()}).then(function(a){try{d=f.exportProperties(a.propertyTree),p(d).then(function(){e=b.importProperties(d,a.initialProperties,b),f.model.propertyTree=e,f.model.saveTree()})}catch(c){}})},exportProperties:function(a){return a.qProperty.qHyperCubeDef?m.hypercube.exportProperties(a):a.qProperty.qListObjectDef?m.listbox.exportProperties(a):m.other.exportProperties(a)},importProperties:function(a,b,c){return b.qHyperCubeDef?m.hypercube.importProperties(a,b,c):b.qListObjectDef?m.listbox.importProperties(a,b,c):m.other.importProperties(a,b,c)},snapshot:{canTakeSnapshot:!1,animate:function(b){b.append(a('<div class="qv-snapshot-tool-flash" />').bind("oanimationend animationend webkitAnimationEnd",function(){a(this).remove()}))},take:function(a,b,c){j.createSnapshot(a,b,c)},updateCount:function(a){return i.Snapshot.getSnapshotCount(a.options.id).then(function(b){return a.snapshotCount=b,b})}},options:{},controller:function(){}}}),define("objects.views/selections/cache-item",[],function(){function a(a,b,c,d,e,f,g){if(a instanceof Array&&!a[0].pointInside&&!a.pointInside)throw"The shape must implement a `pointInside` function";this.setShape(a),this.selected=!!b,this.value=c,this.parent=d,this.index=e,this.objectShapes={},f&&(this.parent=f.parent,this.node=f,this.rowIndex=f.data.rowIndex,this.label=f.data.qText,this.id=f.data.qElemNo),g&&a&&(this.objectShapes[g]=a instanceof Array?a:[a])}return a.prototype={getShapes:function(a){return(a||0===a)&&this.objectShapes&&this.objectShapes[a]?this.objectShapes[a]:this.shapes?this.shapes:[this.shape]},addShape:function(a,b){this.objectShapes[a]instanceof Array||(this.objectShapes[a]=[]),this.objectShapes[a].push(b),this.shapes.push(b)},setShape:function(a){this.shape=a instanceof Array?a[0]:a,this.shapes=a?a instanceof Array?a:[a]:[]},addValue:function(a){void 0===this.value&&(this.value=[]),this.value instanceof Array||(this.value=[this.value]),this.value.push(a)}},a}),define("objects.extension/default-selection-toolbar",["core.utils/class"],function(a){var b;return b=a.extend("SelectionToolbar",{menuButtons:[],init:function(a,b,c,d,e,f){this.backendApi=a,this.selectionsApi=b,this.showMenu=c,this.showLock=d,e=e||[],this.menuButtons=f||[],this.buttons=e.concat([{name:"Tooltip.clearSelection",tid:"selection-toolbar.clear",isIcon:!0,buttonClass:"clear",iconClass:"icon-toolbar-clearselections",action:function(){this.selectionsApi.clear()},isDisabled:function(){return!this.backendApi.hasSelections()}},{clazz:"sel-toolbar-separator",buttonClass:"sel-toolbar-icon-separator",isDisabled:function(){return!0}},{name:"Tooltip.CancelSelections",tid:"selection-toolbar.undo",isIcon:!1,iconClass:"icon-cancel",buttonClass:"sel-toolbar-cancel",action:function(){this.selectionsApi.cancel()}},{name:"Tooltip.ConfirmSelections",tid:"selection-toolbar.refresh",iconClass:"icon-tick",buttonClass:"sel-toolbar-confirm",action:function(){this.selectionsApi.confirm()},isDisabled:function(){return!this.selectionsApi.selectionsMade}}])},hasState:function(a){if(!a)return!0;for(var b=this.backendApi.getDimensionInfos(),c=0;c<b.length;++c)for(var d=0;d<a.length;++d)if(b[c].qStateCounts[a[d]]>0)return!0;return!1}})}),define("objects.extension/default-view",["core.utils/class","qvangular","objects.utils/shapes/rect","objects.views/selections/cache-item","objects.extension/default-selection-toolbar"],function(a,b,c,d,e){var f;return f=a.extend("DefaultView",{$scope:null,$element:null,containerRect:null,options:null,selections:null,backendApi:null,activeDimensions:[0],selectedShapes:[],init:function(a,b,c,d){this.$scope=a,this.$element=b,this.options=c,this.backendApi=d,this._toggleLasso=!1},on:function(){this.selections&&this.selections.on(),this.selectionsEnabled=!0},off:function(){this.selections&&this.selections.off(),this.selectionsEnabled=!1},prePaint:function(){},suppressOnPaint:function(a){return this.$scope.object._forcePaint?(this.$scope.object._forcePaint=!1,!1):a.qSelectionInfo&&a.qSelectionInfo.qInSelections},paint:function(){},updateData:function(){},resize:function(a,b){this.paint(a,b)},destroy:function(){},initialize:function(){this.initSelections()},setSelections:function(a){this.selections=a},initSelections:function(){this.selections&&(this.selections.types.dataArea.setComponent("dataArea",{rect:new c(0,0,this.$element.width(),this.$element.height())}),this.selections.Select.bind(function(a,b){this.onSelect(a,b)}.bind(this)),this.selections.ToggleShape.bind(function(a){var b=this.selectedShapes.indexOf(a);-1!==b?this.selectedShapes.splice(b,1):this.selectedShapes.push(a),this.onToggleShape(a)}.bind(this)),this.selections.Deactivated.bind(function(){this.selectedShapes=[]}.bind(this)),this.selections.Clear.bind(function(){this.selectedShapes=[]}.bind(this)))},refreshSelections:function(){this.selections&&(this.containerRect=this.$element[0].getBoundingClientRect(),this.selections.cache.clear())},onToggleShape:function(a){a.$element[this.isSelected(a.value)?"addClass":"removeClass"]("selected")},onSelect:function(a,b){if(a.length){var c=this.selectedShapes.map(function(a){return a.value});c.length>0&&this.activeDimensions.length>0?this.backendApi.select(c,this.activeDimensions,b):1!==a.length||a[0].selected||this.backendApi.clearSelections()}},onRangeSelect:function(){},addToSelectionCache:function(a,b){if(this.selections){var e=this.containerRect,f=a[0].getBoundingClientRect(),g=new d(new c(f.left-e.left,f.top-e.top,f.right-f.left,f.bottom-f.top),!1,b);g.$element=a,this.selections.cache.add(g)}},isSelected:function(a){return this.selectedShapes.filter(function(b){return b.value===a}).length},getContextMenu:function(){},setSnapshotData:function(){},toggleLasso:function(a){b.$apply(function(){this.selections&&(this._toggleLasso=a,this.options.lassoEnabled=a,this.selections.setLassoEnabled(a))}.bind(this))},isLassoing:function(){return this._toggleLasso},getSelectionToolbar:function(){var a=this;return new e(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[{name:"Tooltip.ToggleOnLassoSelection",tid:"selection-toolbar.toggleLasso",isIcon:!0,buttonClass:"sel-toolbar-icon-toggle",iconClass:"icon-toolbar-lasso",action:function(){a.toggleLasso(!a._toggleLasso)},isActive:function(){return this.name=a._toggleLasso?"Tooltip.ToggleOffLassoSelection":"Tooltip.ToggleOnLassoSelection",a._toggleLasso}}],[])},setBackendApi:function(a){this.backendApi=a},selectValues:function(a,c,d){if(this.selectionsEnabled){if(!this.backendApi.inSelections()){var e=this.$scope,f=this;e.selectionsApi.confirm=function(){e.backendApi.endSelections(!0).then(function(){e.selectionsApi.deactivated()})},e.selectionsApi.cancel=function(){e.backendApi.endSelections(!1),e.selectionsApi.deactivated()},e.selectionsApi.deactivate=function(){this.deactivated(),b.$rootScope.selectionObject=null},e.selectionsApi.clear=function(){f.clearSelectedValues(f.$element),e.backendApi.clearSelections(),f.selectedArrays={}},this.backendApi.beginSelections(),e.selectionsApi.activated(),e.selectionsApi.selectionsMade=!0,b.$rootScope.selectionObject=e.backendApi,this.selectedArrays={}}if(this.selectedArrays[a]||(this.selectedArrays[a]=[]),d)for(var g=0;g<c.length;g++){var h=this.selectedArrays[a].indexOf(c[g]);-1===h?this.selectedArrays[a].push(c[g]):this.selectedArrays[a].splice(h,1)}else this.selectedArrays[a]=this.selectedArrays[a].concat(c);this.backendApi.selectValues(a,this.selectedArrays[a],!1)}},clearSelectedValues:function(a){a.find(".selected").removeClass("selected")},onStateChanged:function(){},allowInteraction:function(a){var b=!1;return a.state!==a.States.analysis&&(a.state!==a.States.play||this.backendApi&&this.backendApi.isSnapshot)||(b=!0),b},setInteraction:function(){}})}),define("text!objects/inline-title-edit.ng.html",[],function(){return'<div ng-show="!editing && displayValue == \'\'" class="qv-inline-edit-button">\r\n    <span class="icon-add"></span>\r\n    <span class="add-text" q-translation="{{emptyTranslation}}"></span>\r\n</div>\r\n<div ng-show="!editing && displayValue != \'\'" class="qv-inline-edit-value">{{displayValue}}</div>\r\n<input ng-show="editing" class="qv-inline-edit-input" type="text" ng-model="titleValue" qv-inline-title-input maxlength="255"/>'}),define("objects/inline-title-edit",["qvangular","angular","core.models/rpc-base","general.utils/property-resolver","text!./inline-title-edit.ng.html"],function(a,b,c,d,e){function f(a){return"object"==typeof a&&(a=a.qStringExpression.qExpr,"="!==a[0]&&(a="="+a)),a}function g(a){return a&&0===a.indexOf("=")?{qStringExpression:{qExpr:a}}:a}a.directive("qvInlineTitleInput",[function(){return{priority:1,require:"ngModel",link:function(a,b,c,d){b.unbind("input keydown change compositionend"),b.bind("blur",function(){a.$apply(function(){d.$setViewValue(b.val()),a.doEdit()})}),b.bind("keydown",function(a){a.stopPropagation(),27===a.which?(b.val(d.$viewValue),b.trigger("blur")):13===a.which&&"textarea"!==b[0].nodeName.toLowerCase()&&b.trigger("blur")})}}}]),a.directive("qvInlineTitleEdit",["$timeout",function(a){return{template:e,restrict:"A",scope:{model:"=",propertyPath:"@",layoutPath:"@",emptyTranslation:"@"},priority:1,link:function(e,h){var i=h.children().first(),j=h.children().eq(1),k=h.children().eq(2);e.editing=!1,e.titleProperty="",e.titleValue="",c.bindLayout(e,"model",function(a){e.displayValue=d.getValue(a,e.layoutPath),e.editing=!1}),e.doEdit=function(){var a=g(e.titleValue);e.editing&&(b.equals(l,a)?e.editing=!1:e.model.getProperties().then(function(b){d.setValue(b,e.propertyPath,a),e.model.save(),l=a}))};var l;i.add(j).on("qv-activate",function(){e.editing||e.model.getProperties().then(function(b){var c,g=k.get(0);e.editing=!0,e.titleProperty=d.getValue(b,e.propertyPath),e.titleValue=f(e.titleProperty),l=e.titleProperty,g.scrollLeft=g.scrollWidth,c=f(e.titleProperty).length,g.selectionStart=c,g.selectionEnd=c,a(function(){g.focus(),g.setSelectionRange(c,c)})})})}}}])}),define("objects.extension/base-controller",["core.utils/class","objects.extension/default-selection-toolbar"],function(a,b){var c;return c=a.extend({$scope:null,init:function(a){this.$scope=a},onPaint:function(){},onResize:function(){},onStateChanged:function(){},setInteraction:function(){},setBackendApi:function(){},getContextMenu:function(){},getObjectMenu:function(){},getSelectionToolbar:function(){return new b(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1)},allowInteraction:function(a){var b=!1;return a.state!==a.States.analysis&&(a.state!==a.States.play||this.$scope.backendApi&&this.$scope.backendApi.isSnapshot)||(b=!0),b}}),c.$inject=["$scope"],c}),define("objects.utils/shapes/point",[],function(){function a(a,b){0===arguments.length?this.set(0,0):this.set(a,b)}return a.prototype={toString:function(){return this.x+" "+this.y},clone:function(){return new a(this.x,this.y)},set:function(a,b){this.x=a,this.y=b},equal:function(a){return this.x===a.x&&this.y===a.y},closeTo:function(a,b){return a?Math.abs(this.x-a.x)<b&&Math.abs(this.y-a.y)<b:!1},distanceTo:function(a){return a?Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2)):0/0}},a}),define("objects.utils/shapes/polygon",["objects.utils/shapes/rect","objects.utils/shapes/line"],function(a,b){function c(b){var c,d,e=Number.MAX_VALUE,f=-Number.MAX_VALUE,g=Number.MAX_VALUE,h=-Number.MAX_VALUE,i=b?b.length:0;if(!i)return null;for(d=0;i>d;d++)c=b[d],f=c.x>f?c.x:f,e=c.x<e?c.x:e,h=c.y>h?c.y:h,g=c.y<g?c.y:g;return new a(e,g,f-e,h-g)}function d(){this._numPoints=this.points?this.points.length:0,this._closedPolygon=this._numPoints>1&&this.points[0].x===this.points[this._numPoints-1].x&&this.points[0].y===this.points[this._numPoints-1].y,this._numLines=this._closedPolygon?this._numPoints-1:this._numPoints,this._pointsChanged=!0}function e(a){this.set(0===arguments.length?[]:a),this._pointsChanged=!0}return e.prototype={clone:function(){var a=this.points.map(function(a){return a.clone()});return new e(a)},set:function(a){this.points=a,d.call(this)},getPoints:function(){return this.points},getNumPoints:function(){return this.points?this.points.length:0},addPoint:function(a){this.points.push(a),d.call(this)},pointInside:function(a,b){if(this.calculateBounds(),!this._bounds)return!1;if(a<this._bounds.x||a>this._bounds.x+this._bounds.width||b<this._bounds.y||b>this._bounds.y+this._bounds.height)return!1;var c,d,e,f,g;for(c=!1,f=-1,d=this.points.length,e=d-1;++f<d;e=f){if(this.points[f].x===a&&this.points[f].y===b)return!0;if(this.points[f].y<=b&&b<=this.points[e].y||this.points[e].y<=b&&b<=this.points[f].y){if(g=(this.points[e].x-this.points[f].x)*(b-this.points[f].y)/(this.points[e].y-this.points[f].y)+this.points[f].x,a===g)return!0;g>a&&(c=!c)}}return c},intersectsLine:function(a){if(!a)return!1;if(this.pointInside(a.x1,a.y1)||this.pointInside(a.x2,a.y2))return!0;var c,d;if(0===this._numPoints)return!1;if(1===this._numPoints)return a.intersectsLine(new b(this.points[0].x,this.points[0].y,this.points[0].x,this.points[0].y))?!0:!1;for(d=this._numPoints-1,c=0;d>c;c++)if(a.intersectsLine(new b(this.points[c].x,this.points[c].y,this.points[c+1].x,this.points[c+1].y)))return!0;return!this._closedPolygon&&a.intersectsLine(new b(this.points[d].x,this.points[d].y,this.points[0].x,this.points[0].y))?!0:!1},intersectsLines:function(a){var b,c=a?a.length:0;for(b=0;c>b;b++)if(this.intersectsLine(a[b]))return!0;return!1},intersectsRect:function(a){if(!a)return!1;if(this.calculateBounds(),!this._bounds)return!1;if(a.rectInside(this._bounds))return!0;if(!this._bounds.intersectsWith(a))return!1;var c,d,e,f,g;return c=a.x,d=a.getRight(),e=a.y,f=a.getBottom(),this.pointInside(c,e)||this.pointInside(d,e)||this.pointInside(d,f)||this.pointInside(c,f)?!0:(g=[new b(c,e,d,e),new b(c,f,d,f),new b(c,e,c,f),new b(d,e,d,f)],this.intersectsLines(g))},calculateBounds:function(){return this._pointsChanged&&(this._bounds=c(this.points),this._pointsChanged=!1),this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var a,b="",c=this._numPoints-1;for(a=0;c>a;a++)b+=this.points[a].toString()+",";return b+=this.points[c].toString()}},e}),define("objects.views/charts/utils/tree-iterator",[],function(){var a={getLevel:function(){if(this&&this.parent!==this){for(var a=this.parent,b=0;a;)b+=1,a=a.parent;return b}},each:function(b){var c,d=this.children;if(d)for(c=0;c<d.length;c+=1){if(b&&b(d[c],c,d.length-1)===!1)return!1;if(a.each.call(d[c],b)===!1)return!1}},getLeaves:function(){if(!this.children||!this.children)return[];var b,c=[];for(b=0;b<this.children.length;b+=1)this.children[b]&&this.children[b].children&&this.children[b].children.length?c=c.concat(a.getLeaves.call(this.children[b])):c.push(this.children[b]);return c}};return a}),define("objects.views/charts/utils/cache-utils",[],function(){function a(b,c){return b.forEach(function(b){if(b.isCacheItem)c.push(b);else if(b.data.cacheItem)c.push(b.data.cacheItem);else if(b.cacheItem&&(c.push(b.cacheItem),b.cacheItem.isCacheItem))throw"Using new cache item before its time";b.children&&b.children.length>0&&a.apply(this,[b.children,c])}),c}var b={getCacheItems:function(){return this.children&&this.children?a.apply(this,[this.children,[]]):[]}};return b}),define("objects.views/selections/types/base",["core.utils/class","objects.utils/shapes/point","objects.views/charts/utils/tree-iterator","objects.views/charts/utils/cache-utils"],function(a,b,c,d){function e(a){return a?a.selectionIdentifier:null}function f(a){return-2===a.id||a.parent&&-2===a.parent.id}function g(a){var b=this.indexOf(a);b>=0&&this.splice(b,1)}var h;return h=a.extend({init:function(a,b){this._selectedShapes=[],this.handler=a,this.options=b,this.components=b.components||{},this.activeComponent=null},release:function(){this.components={},this._selectedShapes=[],this.handler=null},initComponent:function(){throw new Error("base.js: initComponent has to be implemented in subclass")},resetSelectedShapes:function(){this._selectedShapes.length=0},getSelectedShapes:function(){return this._selectedShapes},toggleSelectedShape:function(a){var b=this._selectedShapes.indexOf(a);-1!==b?this._selectedShapes.splice(b,1):this._selectedShapes.push(a)},setComponent:function(a,b){switch(a){case"x":case"y":case"dataArea":case"legend":this.components[a]=Array.isArray(b)?b:[b];break;default:throw"Key "+a+" not implemented"}},addComponent:function(a,b){switch(a){case"x":case"y":case"dataArea":case"legend":this.components[a]||(this.components[a]=[]),g.call(this.components[a],b),this.components[a].push(b);break;default:throw"Key "+a+" not implemented"}},removeComponent:function(a,b){switch(a){case"x":case"y":case"dataArea":case"legend":this.components[a]&&b&&g.call(this.components[a],b),b&&this.components[a]&&this.components[a].length||delete this.components[a];break;default:throw"Key "+a+" not implemented"}},getComponent:function(a,c){var d=new b(a-this.handler.containerRect.x,c-this.handler.containerRect.y);return Object.keys(this.components).map(function(a){return this.components[a]},this).reduce(function(a,b){return a.concat(b)}).filter(function(a){return this.getRect(a).pointInside(d.x,d.y)},this)[0]},getRect:function(a){return a.rect},getComponentKey:function(a){return Object.keys(this.components).filter(function(b){return this.components[b].indexOf(a)>=0},this)[0]},setActiveMode:function(a){this._activeMode=a},getActiveMode:function(){return this._activeMode},getActiveDimensions:function(){return this.activeComponent.getSelectionIndices()},toggle:function(){},toggleRect:function(){},start:function(){},update:function(){},end:function(){},cancel:function(){},move:function(){},leave:function(){},getTransformedPoint:function(a,c){var d=this.getRect(this.activeComponent||this.components.dataArea[0]);return new b(a-d.x-this.handler.containerRect.x,c-d.y-this.handler.containerRect.y)},getPagePoint:function(a,c,d){var e=this.getRect(d||this.activeComponent||this.components.dataArea[0]);return new b(a+e.x+this.handler.containerRect.x,c+e.y+this.handler.containerRect.y)},getInterpolatedPoints:function(a,c,d){d=d||this.options.interpolation.pixelPrecision||2;var e,f,g=a.distanceTo(c),h=1/(g/(d>0?d:g)),i=[];for(i.push(a),e=h;1-h>e;e+=h)f=new b(a.x+(c.x-a.x)*e,a.y+(c.y-a.y)*e),i.push(f);return i.push(c),i},shapeFromPoint:function(a){return this.shapesFromPoints([a])[0]},shapesFromPoints:function(a){var b,c,d,g,h,i,j,k,l=this.handler.cache.data,m=this.handler.cache.data.length,n=a.length,o=e(this.activeComponent),p=[];for(i=0;m>i;++i)if(h=l[i],!f(h)||this._allowNullSelect)for(j=0;n>j;++j)for(b=a[j],d=h.getShapes(e(this.activeComponent)),"dataArea"===o&&h.toggleShapes&&(d=d.concat(h.toggleShapes)),c=d.length,k=0;c>k;++k)if(g=d[k],g.pointInside(b.x,b.y)){p.push(h);break}return p},shapesFromLines:function(a){var b,c,d,g,h,i,j,k,l=this.handler.cache.data,m=this.handler.cache.data.length,n=a.length,o=[];for(i=0;m>i;++i)if(h=l[i],!f(h)||this._allowNullSelect)for(j=0;n>j;++j)for(b=a[j],d=h.getShapes(e(this.activeComponent)),c=d.length,k=0;c>k;++k)if(g=d[k],g.intersectsLine(b)){o.push(h);break}return o},shapesFromPolygon:function(a){var b,c,d,g,h,i,j,k,l,m,n=this.handler.cache.data,o=this.handler.cache.data.length,p=[];for(j=0;o>j;++j)if(i=n[j],!f(i)||this._allowNullSelect)for(m=!1,h=i.getShapes(e(this.activeComponent)),g=h.length,l=0;g>l&&!m;++l)for(b=h[l].getPoints(),d=b.length,k=0;d>k;++k)if(c=b[k],a.pointInside(c.x,c.y)){p.push(i),m=!0;break}return p},shapesFromRect:function(a,b){if(!a)return[];var c,d,g,h,i,j,k=this.handler.cache.data,l=this.handler.cache.data.length,m=[];for(i=0;l>i;++i)if(h=k[i],!f(h)||this._allowNullSelect)for(d=h.getShapes(b?b:e(this.activeComponent)),c=d.length,j=0;c>j;j++)if(g=d[j],"cx"in g){if(a.pointInside(g.cx,g.cy)){m.push(h);break}}else if(g.intersectsRect){if(g.intersectsRect(a)){m.push(h);break}}else if(a.intersectsWith(g)){m.push(h);break}return m},shapesFromRectForDirection:function(a,b,c){var d,g,h,i,j,k,l,m=this.handler.cache.data,n=this.handler.cache.data.length,o=[],p=0,q=0,r="";switch(b){case"x":p=a.x,q=a.getRight(),r="getRight";break;case"y":p=a.y,q=a.getBottom(),r="getBottom"}for(k=0;n>k;++k)if(d=m[k],!f(d)||this._allowNullSelect)for(h=d.getShapes(c?c:e(this.activeComponent)),g=h.length,l=0;g>l;++l)if(i=h[l],"cx"in i){if(i["c"+b]>=p&&i["c"+b]<=q){o.push(d);break}}else{if(j=i.getBoundingRect(),j[b]>=p&&j[b]<=q){o.push(d);break}if(j[r]()>=p&&j[r]()<=q){o.push(d);break}if(p>=j[b]&&q<=j[r]()){o.push(d);break}}return o},shapesFromRange:function(a,b,c,d){var e,g,h,i,j,k,l=Math.min(a,b),m=Math.max(a,b),n=this.handler.cache.data,o=this.handler.cache.data.length,p="function"==typeof this.activeComponent.getType?this.activeComponent.getType().indices:null,q=[];for(c=c!==!1,d=d!==!1,k=c&&d?function(a){return a>=l&&m>=a}:c?function(a){return a>=l&&m>a}:d?function(a){return a>l&&m>=a}:function(a){return a>l&&m>a},i=0;o>i;++i)if(e=n[i],!f(e)||this._allowNullSelect)for(g=e.values instanceof Array?e.values:e.value instanceof Array?e.value:[e.value],p&&p.length&&(g=g.filter(function(a,b){return p.indexOf(b)>=0})),j=0;j<g.length;j++)if(h=g[j],k(h)){q.push(e);break}return q},shapesFromDimensionValue:function(a){var b,c,d,e=this.handler.cache.data,g=this.handler.cache.data.length,h=[];for(c=0;g>c;++c)if(b=e[c],!f(b)||this._allowNullSelect)for(d=0;d<a.length;d++)if(b.id===a[d]){h.push(b);break}return h},groupedItemsFromShapes:function(a){var b,e,f,g,h=[];return b=void 0!==this.activeComponent.getSelectionIndices?this.activeComponent.getSelectionIndices():[0],e=b[b.length-1],a.forEach(function(b){g=b.parent,void 0!==g&&(f=c.getLevel.call(g)-(b.isCacheItem?0:1),f===e&&-1===h.indexOf(g)&&a&&h.push(g))}),h.length>0&&(a=[],h.forEach(function(b){a=a.concat(d.getCacheItems.call(b))})),a},shapesFromIndex:function(a,b){var c,d,e=Math.min(a,b),f=Math.max(a,b),g=this.handler.cache.data,h=this.handler.cache.data.length,i=[];for(d=0;h>d;++d)c=g[d],void 0!==c.index&&c.index>=e&&c.index<=f&&i.push(c);return i},ToggleFlag:{select:1,deselect:2,auto:4,replace:8,tooltip:16},toggleSelection:function(a,b){function c(c){var d=a.filter(c);d.forEach(function(a){a.selected=!a.selected,i(a),f.emit(a,b)}),d.length>0&&g.emit(a,b)}var d,e=this.ToggleFlag,f=this.handler.ToggleShape,g=this.handler.ToggleShapes,h=this.handler.ToggleTooltip,i=this.toggleSelectedShape.bind(this);b=b||e.auto,b&e.select?c(function(a){return!a.selected}):b&e.deselect?c(function(a){return a.selected}):b&e.auto?c(function(){return!0}):b&e.replace&&(d=a,a=this.handler.cache.data,c(function(a){return a.selected}),a=d,c(function(){return!0})),b&e.tooltip&&h.emit(a)},clearSelection:function(){var a=this.handler.Clear,b=this.handler.cache.data,c=this.ToggleFlag.deselect;this.toggleSelection(b,c),a.emit()}}),h.defaultOptions={},h}),define("general.components/framer/framer",["qvangular","general.services/show-service/show-service"],function(a,b){var c={template:'<div class ="qv-framer" ng-style="style"></div>',controller:["$scope",function(a){a.style={},a.style.top=a.top,a.style.left=a.left,a.style.height=a.height,a.style.width=a.width,a.closeComponent()}],scope:{top:"=",left:"=",height:"=",width:"=",closeComponent:"="}},d={flash:function(d,e){var f=a.getService("$timeout"),g=b.show(c,{top:Math.min(d.y,e.y)+"px",left:Math.min(d.x,e.x)+"px",height:Math.max(d.y,e.y)-Math.min(d.y,e.y)+"px",width:Math.max(d.x,e.x)-Math.min(d.x,e.x)+"px",closeComponent:function(){f(function(){g.destroy(),g=null},300)}})}};return d}),define("objects.views/selections/types/data-area",["jquery","objects.utils/shapes/point","objects.utils/shapes/polygon","objects.utils/shapes/rect","objects.utils/shapes/line","./base","general.components/framer/framer"],function(a,b,c,d,e,f,g){function h(){x.beginPath(),x.moveTo(n.x,n.y),x.fillStyle="rgba(77, 192, 78, 1)",x.arc(n.x,n.y,10,0,2*Math.PI,!0),x.fill()}function i(a,b,c){var d,e;!c||"x"!==c&&"y"!==c||(b[c]=n[c]),d=(a.x+b.x)/2,e=(a.y+b.y)/2,x.beginPath(),x.moveTo(a.x,a.y),x.quadraticCurveTo(d,e,b.x,b.y),x.stroke()}function j(a,b,c,d){d=d||[2,4];var e,f=d.length,g=c.x-b.x,h=c.y-b.y,i=Math.sqrt(g*g+h*h),j=i,k=0,l=!0,m=b.x,n=b.y;for(g/=i,h/=i,a.moveTo(m,n),k=0;j>=.1&&5e3>k;++k)e=d[k%f],0===e&&(e=.001),e>j&&(e=j),m+=e*g,n+=e*h,a[l?"lineTo":"moveTo"](m,n),j-=e,l=!l}function k(a,b){y.clearRect(0,0,u.width,u.height),y.beginPath(),j(y,a,b),y.stroke()}function l(){p.hide(),r.hide(),t.hide()}var m,n,o=document.body,p=a("<div />"),q=p[0],r=a("<canvas />"),s=r[0],t=a("<canvas />"),u=t[0],v=a("<canvas />"),w=v[0],x=s.getContext("2d"),y=u.getContext("2d"),z=w.getContext("2d"),A=[],B=!1,C=!1;return q.appendChild(s),q.appendChild(u),q.appendChild(w),q.className="selections-data-area-ui",p.hide(),o.appendChild(q),m=f.extend("DataAreaSelection",{init:function(a,b){this._super(a,b),this.setActiveMode("item"),this._startIndex=-1,this._endIndex=-1},initComponent:function(){this.activeComponent=this.components.dataArea[0]},refreshCanvas:function(){this.rect=this.components.dataArea[0].rect;var a={position:"absolute",left:this.handler.containerRect.x+this.rect.x+"px",top:this.handler.containerRect.y+this.rect.y+"px",width:this.rect.width+"px",height:this.rect.height+"px","z-index":20};x.canvas.width=this.rect.width,x.canvas.height=this.rect.height,x.lineWidth=2,x.lineCap="round",x.lineJoin="round",x.strokeStyle="rgba(102,102,102,1)",x.fillStyle="rgba(102,102,102,1)",r.css(a),y.canvas.width=this.rect.width,y.canvas.height=this.rect.height,y.lineWidth=2,y.lineCap="round",y.lineJoin="round",y.strokeStyle="rgba(102,102,102,1)",t.css(a),z.canvas.width=this.rect.width,z.canvas.height=this.rect.height,v.css(a)},toggle:function(a,b,c){c=void 0!==c?c:this.handler.getKeyAsToggleSelected(a),c||this.clearSelection(),this.resetSelectedShapes(),this.activeComponent=this.components.dataArea[0];var e,f=this.getTransformedPoint(b.x,b.y),g=this.options.toggle.callback||this.toggleSelection,h=this.options.indexSelection,i=this.ToggleFlag.auto|this.ToggleFlag.tooltip;return e=h?this.shapesFromRectForDirection(new d(f.x,f.y,0,0),"y"):this.shapesFromPoints([f]),e=this.groupedItemsFromShapes(e),e.forEach(function(a){a.selectionMode="dataArea"}),e.forEach(function(a){a.interactPosition=b}),g.call(this,e,i),e&&e.length>0},toggleRect:function(b,c,e){if(c&&e){var f,h,i,j,k,l,m,n,o,p,q,r=a(this.components.dataArea[0].container),s=r.offset(),t=function(a){return{x:Math.min(Math.max(a.x,s.left),s.left+r.width()),y:Math.min(Math.max(a.y,s.top),s.top+r.height())}};c=t(c),e=t(e),p=c,q=e,this.resetSelectedShapes(),c=this.getTransformedPoint(c.x,c.y),e=this.getTransformedPoint(e.x,e.y),f=Math.min(c.x,e.x),h=Math.min(c.y,e.y),i=Math.max(1,Math.abs(e.x-c.x)),j=Math.max(1,Math.abs(e.y-c.y)),k=new d(f,h,i,j),m=this.ToggleFlag.select,n=this.options.indexSelection,o=this.toggleSelection,this.activeComponent=this.components.dataArea[0],l=n?this.shapesFromRectForDirection(k,"y"):this.shapesFromRect(k),l=this.groupedItemsFromShapes(l),l.forEach(function(a){a.selectionMode="dataArea"}),o.call(this,l,m),this.getSelectedShapes().length>0&&this.handler.Select.emit(this.getSelectedShapes(),!0),g.flash(p,q)}},start:function(a,c){this.handler.getKeyAsToggleSelected(a)||this.clearSelection(),this.resetSelectedShapes(),this.activeComponent=this.components.dataArea[0];var e=this.getTransformedPoint(c.x,c.y),f=this.options.captureInput,g=this.options.indexSelection;if(f&&(r.show(),t.show(),p.show(),this.refreshCanvas()),A.length=0,A.push(e),n=new b(A[0].x,A[0].y),B=!1,C=!1,g){var i=this.shapesFromRectForDirection(new d(n.x,n.y,1,1),"y"),j=i.length&&i[0].index;void 0!==j&&j>=0&&(this._startIndex=j)}f&&h()},update:function(a,b){var c,f,g,h,j=this.getTransformedPoint(b.x,b.y),l=this.options,m=l.captureInput,o=l.lassoAutoCloseDistance,p=l.indexSelection,q=a.shiftKey&&l.shiftLockCapture?l.shiftLockAxis:"",r=this.ToggleFlag.select,s=-1,t=this.toggleSelection;c=A[A.length-1],A.push(j),m&&i(c,j,q),m&&(B||(B=A.length>2&&n.distanceTo(j)>=o),y.clearRect(0,0,u.width,u.height),B&&(n.distanceTo(j)<=o?(k(j,n),C=!0):C=!1)),p?(h=this.shapesFromRectForDirection(new d(j.x,j.y,1,1),"y"),s=h.length?h[0].index:-1,void 0!==s&&s>=0&&(this._endIndex=s),f=this.shapesFromIndex(this._startIndex,this._endIndex),g=this.getSelectedShapes().filter(function(a){return-1===f.indexOf(a)}),t.call(this,g,this.ToggleFlag.deselect),t.call(this,f,r)):(f=this.shapesFromLines([new e(c.x,c.y,j.x,j.y)]),f=this.groupedItemsFromShapes(f),f.forEach(function(a){a.selectionMode="dataArea"}),t.call(this,f,r))},end:function(a){var b,d,e=this.options.captureInput,f=this.options.indexSelection,g=this.ToggleFlag.select,h=this.toggleSelection;f&&(this._startIndex=-1,this._endIndex=-1),e&&l(),e&&C&&(d=new c(A),b=this.shapesFromPolygon(d),b=this.groupedItemsFromShapes(b),b.forEach(function(a){a.selectionMode="dataArea"}),h.call(this,b,g)),A.length=0,this.getSelectedShapes().length>0&&this.handler.Select.emit(this.getSelectedShapes(),this.handler.getKeyAsToggleSelected(a))},cancel:function(a){A.length&&l(),a&&this.clearSelection(),this.activeComponent=null}}),m.defaultOptions={captureInput:!0,indexSelection:!1,shiftLockCapture:!1,shiftLockAxis:"x",lassoAutoCloseDistance:50,autoConfirm:!1,toggle:{callback:null},interpolation:{pixelPrecision:2}},m}),define("text!objects.views/selections/types/range-template.ng.html",[],function(){return'<div class="qvt-range-selection">\r\n\r\n	<div ng-show="vertical" class="range-vertical"\r\n		 ng-class="{\'near\': vOptions.dock == \'left\', \'far\' : vOptions.dock == \'right\'}"\r\n		 ng-style="vRangeStyle">\r\n		<div class="range">\r\n			<div class="axis-cover" ng-style="vRelevantSize" tid="range-vertical-cover" ng-class="{\'active\' : activeOptions.y.cover}"></div>\r\n		</div>\r\n		<div class="far-edge" tid="range-vertical-far" ng-class="{\'active\' : activeOptions.y.far}">\r\n		</div>\r\n		<div class="near-edge" tid="range-vertical-near" ng-class="{\'active\' : activeOptions.y.near}">\r\n		</div>\r\n		<div class="outer-bubble-wrapper" ng-style="vWrappperSize">\r\n			<div class="far bubble-wrapper">\r\n				<div class="bubble" ng-class="{\'active\' : activeOptions.y.far}">{{vValues.start.text}}</div>\r\n			</div>\r\n			<div class="near bubble-wrapper">\r\n				<div class="bubble" ng-class="{\'active\' : activeOptions.y.near}">{{vValues.end.text}}</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n\r\n	<div ng-show="horizontal" class="range-horizontal"\r\n		 ng-class="{\'near\': hOptions.dock == \'bottom\', \'far\' : hOptions.dock == \'top\'}"\r\n		 ng-style="hRangeStyle">\r\n	    <div class="range">\r\n			<div class="axis-cover" ng-style="hRelevantSize" tid="range-horizontal-cover" ng-class="{\'active\' : activeOptions.x.cover}"></div>\r\n	    </div>\r\n	   \r\n	    <div class="far-edge" tid="range-horizontal-far" ng-class="{\'active\' : activeOptions.x.far}">\r\n	    </div>\r\n		<div class="near-edge" tid="range-horizontal-near" ng-class="{\'active\' : activeOptions.x.near}">\r\n		</div>\r\n		<div class="outer-bubble-wrapper" ng-style="hWrappperSize">\r\n			<div class="far bubble-wrapper">\r\n				<div class="bubble" ng-class="{\'active\' : activeOptions.x.far}">{{hValues.end.text}}</div>\r\n			</div>\r\n			<div class="near bubble-wrapper">\r\n				<div class="bubble" ng-class="{\'active\' : activeOptions.x.near}">{{hValues.start.text}}</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("objects.views/selections/types/range-directive",["touche","qvangular","objects.utils/shapes/point","text!./range-template.ng.html"],function(a,b,c,d){function e(a,b,d,e){var f=[];return"y"===d?(f[b]=new c(a[b].x,a[b].y+e),f[1^b]=a[1^b]):(f[b]=new c(a[b].x+e,a[b].y),f[1^b]=a[1^b]),f}function f(a){a.$emit("rangeStart")}function g(a,b,c){a.$emit("rangeUpdate",b,c)}function h(a,b){a.$emit("rangeEnd",b)}function i(a,b,c){return b?a[0][c]>a[1][c]?0:1:a[0][c]<a[1][c]?0:1}function j(b,c,d,j){var k,l,m,n=d?"hHandlePoints":"vHandlePoints",o=d?"x":"y";a(c).tap({id:w,options:{preventDefault:!0},start:function(){a.preventGestures(this.gestureHandler)
}}).swipe({id:w,options:{radiusThreshold:0},start:function(){l=i(b[n],j,o),k=b[n],a.preventGestures(this.gestureHandler),f(b)},update:function(a,c){b[n]=e(k,l,o,d?c.swipe.deltaX:c.swipe.deltaY),b.$apply(),b.activeOptions[o].near=b.activeOptions[o].far=!1,m=i(b[n],j,o)^!d?"far":"near",b.activeOptions[o][m]=!0,g(b,b[n],o)},end:function(){h(b,b[n]),b.activeOptions[o].near=b.activeOptions[o].far=!1}})}function k(b){if(!x){x=!0;var c="hey";a(m).tap({id:w,options:{preventDefault:!0},start:function(){a.preventGestures(this.gestureHandler)}}).swipe({id:w,options:{preventDefault:!0},start:function(){c=b.vHandlePoints,a.preventGestures(this.gestureHandler),f(b),b.activeOptions.y.cover=!0},update:function(a,d){b.vHandlePoints=[{x:c[0].x,y:c[0].y+d.swipe.deltaY},{x:c[1].x,y:c[1].y+d.swipe.deltaY}],b.$apply(),g(b,b.vHandlePoints,"y")},end:function(){h(b,b.vHandlePoints),b.activeOptions.y.cover=!1}}),a(n).tap({id:w,options:{preventDefault:!0},start:function(){a.preventGestures(this.gestureHandler)}}).swipe({id:w,options:{preventDefault:!0},start:function(){c=b.hHandlePoints,a.preventGestures(this.gestureHandler),f(b),b.activeOptions.x.cover=!0},update:function(a,d){b.hHandlePoints=[{x:c[0].x+d.swipe.deltaX,y:c[0].y},{x:c[1].x+d.swipe.deltaX,y:c[1].y}],b.$apply(),g(b,b.hHandlePoints,"x")},end:function(){h(b,b.hHandlePoints),b.activeOptions.x.cover=!1}}),j(b,o,!1,!1,"far"),j(b,p,!1,!0,"near"),j(b,q,!0,!0,"far"),j(b,r,!0,!1,"near"),a.utils.touch||(j(b,s,!1,!1,"far"),j(b,t,!1,!0,"near"),j(b,u,!0,!0,"far"),j(b,v,!0,!1,"near"))}}function l(){a(m).off("*",w),a(n).off("*",w),a(o).off("*",w),a(p).off("*",w),a(q).off("*",w),a(r).off("*",w),a(s).off("*",w),a(t).off("*",w),a(u).off("*",w),a(v).off("*",w),x=!1}var m,n,o,p,q,r,s,t,u,v,w=".rangeselection",x=!1;b.directive("qvaRangeSelection",function(){return{template:d,replace:!0,scope:{vertical:"=",horizontal:"=",vOptions:"=",hOptions:"=",vHandlePoints:"=",hHandlePoints:"=",vValues:"=",hValues:"="},link:function(a,b){a.vRangeStyle={},a.hRangeStyle={},a.vRelevantSize=0,a.hRelevantSize=0,a.activeOptions={y:{far:!1,near:!1,cover:!1},x:{far:!1,near:!1,cover:!1}},a.setRangeStyle=function(b,c,d){if(!c||2!==c.length||!d)return{};var e=c[0],f=c[1];"y"===b?a.vRangeStyle={height:Math.abs(e[b]-f[b]),top:Math.min(e[b],f[b])+d.rect.y-d.containerRect.y-d.padding.top}:a.hRangeStyle={width:Math.abs(e[b]-f[b]),left:Math.min(e[b],f[b])+d.rect.x-d.containerRect.x-d.padding.left}},a.$watchCollection("[vHandlePoints, vOptions]",function(b){a.setRangeStyle("y",b[0],b[1])}),a.$watchCollection("[hHandlePoints, hOptions]",function(b){a.setRangeStyle("x",b[0],b[1])}),a.$watch("hOptions",function(b){b&&a.setRelevantSize("x",b.rect.height)}),a.$watch("vOptions",function(b){b&&a.setRelevantSize("y",b.rect.width)}),a.setRelevantSize=function(b,c){"x"===b?(a.hRelevantSize={height:c+"px"},a.hWrappperSize={height:"calc(100% - "+c+"px)"}):(a.vRelevantSize={width:c+"px"},a.vWrappperSize={width:"calc(100% - "+c+"px)"})},m=b.find(".range-vertical .axis-cover")[0],n=b.find(".range-horizontal .axis-cover")[0],o=b.find(".range-vertical .far.bubble-wrapper .bubble")[0],p=b.find(".range-vertical .near.bubble-wrapper .bubble")[0],q=b.find(".range-horizontal .far.bubble-wrapper .bubble")[0],r=b.find(".range-horizontal .near.bubble-wrapper .bubble")[0],s=b.find(".range-vertical .far-edge")[0],t=b.find(".range-vertical .near-edge")[0],u=b.find(".range-horizontal .far-edge")[0],v=b.find(".range-horizontal .near-edge")[0],k.call(this,a),a.$on("on",function(){k.call(this,a)}),a.$on("off",function(){l.call(this)}),a.$on("$destroy",function(){l.call(this)})}}})}),define("objects.views/selections/types/range-angular",["jquery","qvangular","./base","objects.utils/shapes/point","objects.utils/shapes/rect","./range-directive"],function(a,b,c,d,e){function f(a){if(a.isCacheItem){var b=a.getDimensions();return b[b.length-1]}return a.parent&&a.parent.data&&a.parent.data.qText?a.parent.data.qText:a.label}function g(a,b,c){var d,e,g,h=this.activeComponent.rect,i=this.getRect(this.activeComponent),j=this.components.dataArea[0].rect,k=a.x-b.x,l=a.y-b.y,m=i.y-h.y,n=i.x-h.x,o=0,p=0,q=0,t=0,u=0;switch(this.activeComponent.dock){case"top":case"bottom":o=0>=k?i.width-a.x:a.x,0>k&&(o+=n),b.x<n&&(k-=n-b.x),p=r(i.width+n,s(n,r(a.x,b.x))),t=s(p,r(n+i.width,s(a.x,b.x))),q=0,u=j.height,c.rect.set(p,q,t-p,u-q),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?(d=this.shapesFromRectForDirection(c.rect,"x","dataArea"),d.length?(e=d[0],g=d[d.length-1],c.startVal=f(e),c.updateVal=f(g)):(c.startVal="-",c.updateVal="-")):(c.startVal=this.activeComponent.getValueOfPosition(p),c.updateVal=this.activeComponent.getValueOfPosition(t));break;case"left":case"right":o=0>=l?i.height-a.y:a.y,0>l&&(o+=m),b.y<m&&(l-=m-b.y),p=0,t=j.width,q=r(i.height+m,s(m,r(a.y,b.y))),u=s(q,r(m+i.height,s(a.y,b.y))),c.rect.set(p,q,t-p,u-q),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?(d=this.shapesFromRectForDirection(c.rect,"y","dataArea"),d.length?(e=d[0],g=d[d.length-1],c.startVal=f(e),c.updateVal=f(g)):(c.startVal="-",c.updateVal="-")):(c.startVal=this.activeComponent.getValueOfPosition(q),c.updateVal=this.activeComponent.getValueOfPosition(u))}}function h(){return this.components.x&&this.components.y&&!this.components.x[0].isDiscrete()&&!this.components.y[0].isDiscrete()}function i(){q.y=!1,q.x=!1,this._rangeEventWatchers&&(this._rangeEventWatchers.forEach(function(a){a()}),this._rangeEventWatchers=null),t.hide(),x={x:[],y:[]}}function j(a,b){a||(a="x"),b||(b=0);var c=x[a][b];return c||(c={rect:new e(0,0,0,0),startVal:0,endVal:0},x[a][b]=c),c}function k(a,b,c){var d,e=[],f=this._previousShapes?this._previousShapes.slice():[],g=j(a),i=x["y"===a?"x":"y"];this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?(e=this.shapesFromRectForDirection(g.rect,a,"dataArea"),e=this.groupedItemsFromShapes(e),e.forEach(function(a){var b=f.indexOf(a);b>=0&&f.splice(b,1),a.selectionMode="range.dimension"}),this.checkActiveMode(["range.dimension","item"],!0),b.call(this,e,c),this._clearPrev&&b.call(this,f,this.ToggleFlag.deselect),this._shapes=e):(h.call(this)?(d=i.length?g.rect.intersection(i[0].rect):g.rect,e=this.shapesFromRect(d,"dataArea")):e=this.shapesFromRange(g.startVal,g.updateVal),e.forEach(function(a){a.selectionMode="range.measure"}),this.checkActiveMode(["range.measure"],!0),b.call(this,e,c),this._shapes=e)}function l(a){var b,c,e=this.getComponentKey(this.activeComponent),f=j(e),h=a,i=this.ToggleFlag.select,l=this.toggleSelection;g.call(this,n,h,f),b=new d(f.rect.x,f.rect.y),c=new d(f.rect.x+f.rect.width,f.rect.y+f.rect.height),"y"===e?(q.vHandlePoints=[b,c],q.vValues={start:{text:this.activeComponent.getFormatter().format(f.startVal),value:f.startVal},end:{text:this.activeComponent.getFormatter().format(f.updateVal),value:f.updateVal}}):(q.hHandlePoints=[b,c],q.hValues={start:{text:this.activeComponent.getFormatter().format(f.startVal),value:f.startVal},end:{text:this.activeComponent.getFormatter().format(f.updateVal),value:f.updateVal}}),q.$apply(),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?this._shapes&&l.call(this,this._shapes,this.ToggleFlag.deselect):this.clearSelection(!0),k.call(this,e,l,i)}var m,n,o=b.getService("$compile"),p=b.getService("$rootScope"),q=p.$new(),r=Math.min,s=Math.max,t=a("<div />"),u=t[0],v=new e(0,0,0,0),w=a('<div qva-range-selection v-handle-points="vHandlePoints" h-handle-points="hHandlePoints" horizontal="x" vertical="y" h-options="hOptions" v-options="vOptions" h-values="hValues" v-values="vValues"/>'),x={x:[],y:[]};return u.className="selections-range-ui",t.append(w),t.hide(),o(u)(q),m=c.extend("RangeSelection",{init:function(a,b){this._super(a,b),this._shapes=null,this.setActiveMode("item")},initComponent:function(a){this.previousComponent=this.activeComponent,this.activeComponent=this.getComponent(a.x,a.y)},refreshContainer:function(){var a=this.components.dataArea[0].rect,b=[];["x","y"].forEach(function(a){this.components[a]&&!this.components[a].contains(this.activeComponent)&&(b=b.concat(this.components[a]))}.bind(this)),this.activeComponent&&b.push(this.activeComponent),b.forEach(function(b){a=a.combineWith(b.rect)},this),v=a,t.css({left:a.x,top:a.y,width:a.width,height:a.height})},resetSelectedShapes:function(){this._previousSelectedShapes=this._selectedShapes.concat(),this._super()},getRect:function(a,b){return a?(b=b||!1,a.hasOwnProperty("innerRect")&&!b?a.innerRect:a.rect):new e(0,0,0,0)},getExtendedRect:function(a){return a?a.hasOwnProperty("extendedRect")?a.extendedRect:this.getRect(a):new e(0,0,0,0)},getTransformedPoint:function(a,b){var c=this.getRect(this.activeComponent||this.components.dataArea[0],!0);return new d(a-c.x-this.handler.containerRect.x,b-c.y-this.handler.containerRect.y)},getComponent:function(a,b){var c=new d(a-this.handler.containerRect.x,b-this.handler.containerRect.y);return Object.keys(this.components).map(function(a){return this.components[a]},this).reduce(function(a,b){return a.concat(b)}).filter(function(a){return this.getExtendedRect(a).pointInside(c.x,c.y)},this)[0]},checkActiveMode:function(a,b){a.contains(this.handler.getActiveMode())||this.clearSelection(b),this.setActiveMode(a[0])},toggleRect:function(a,b,c){this.start(a,b),this.update(a,c),this.end(a)},toggle:function(a,b,c){if(c=void 0!==c?c:this.handler.getKeyAsToggleSelected(a),c||this.clearSelection(),this.resetSelectedShapes(),this.cancel(),!this.activeComponent||!this.activeComponent.isDiscrete())return!1;var d=this.getTransformedPoint(b.x,b.y),e=this.shapesFromPoints([d]),f=this.options.toggle.callback||this.toggleSelection,g=this.ToggleFlag.auto|this.ToggleFlag.tooltip;return e=this.groupedItemsFromShapes(e),e.forEach(function(a){a.selectionMode="dataArea"}),this.checkActiveMode(["item"]),f.call(this,e,g),e&&e.length>0},start:function(a,b){var c,d,e,f;if(this.resetSelectedShapes(),this.refreshContainer(),c=this.getComponentKey(this.previousComponent),d=this.getComponentKey(this.activeComponent),c&&c!==d&&this.previousComponent&&this.previousComponent!==this.activeComponent&&!h.call(this)&&c in this.components&&(q[c]=!1,f=j(c),f.rect.set(0,0,0,0)),this.handler.container[0].appendChild(u),!this._rangeEventWatchers){var g=this;this._rangeEventWatchers=[],this._rangeEventWatchers.push(q.$on("rangeStart",function(){g.resetSelectedShapes(),g._shapes=g._previousShapes,g._clearPrev=!0})),this._rangeEventWatchers.push(q.$on("rangeUpdate",function(a,b,c){n=b[0],g.components[c].indexOf(g.activeComponent)<0&&(g.activeComponent=g.components[c][0]),l.call(g,b[1]),g._clearPrev=!1})),this._rangeEventWatchers.push(q.$on("rangeEnd",function(){g.end(),g._clearPrev=!1}))}n=this.getTransformedPoint(b.x,b.y),q[d]=!0,e=this.getRect(this.activeComponent),"y"===d?(q.vOptions={rect:e.clone(),containerRect:v,padding:this.activeComponent.getPadding(),dock:this.activeComponent.dock},q.vHandlePoints=[n,n]):(q.hOptions={rect:e.clone(),containerRect:v,padding:this.activeComponent.getPadding(),dock:this.activeComponent.dock},q.hHandlePoints=[n,n]),t.show()},update:function(a,b){l.call(this,this.getTransformedPoint(b.x,b.y))},updateShapesState:function(){var a=this.getComponentKey(this.activeComponent),b=j(a),c=this.ToggleFlag.select,d=[],e=this.toggleSelection;this.clearSelection(!0),this.activeComponent.isDiscrete&&!this.activeComponent.isDiscrete()&&(d=this.shapesFromRange(b.startVal,b.updateVal),d.forEach(function(a){a.selectionMode="range.measure"}),e.call(this,d,c)),this._shapes=d},end:function(a){this.selectRange(a),this._previousShapes=this._shapes,this._shapes=null},cancel:function(){"range.dimension"===this.getActiveMode()&&this.setActiveMode("item"),this._shapes=null,i.call(this)},clearSelection:function(a){a=a||!1,this._shapes=null,a?this._super():(this._super(),i.call(this)),this.setActiveMode("item")},selectRange:function(){var a,b=this.handler.SelectRange,c=this.getComponentKey(this.activeComponent),d=[],e=!1;if(this.activeComponent){if("dimension"===this.activeComponent.getType().type){var f=this._previousSelectedShapes,g=this.getSelectedShapes().concat();return f.forEach(function(a){var b=g.indexOf(a);-1===b&&g.push(a)}),void(g.length>0&&this.handler.Select.emit(g))}if(h.call(this))Object.keys(x).filter(function(a){return x[a][0]&&void 0!==x[a][0].startVal&&void 0!==x[a][0].updateVal}).forEach(function(b){var c=this.components[b][0].getType().current[0];a=x[b][0],d.push({measure:c,range:{min:Math.min(a.startVal,a.updateVal),max:Math.max(a.startVal,a.updateVal)}})},this);else{if(a=x[c][0],!a)return;this.activeComponent.getType().current.forEach(function(b){d.push({measure:b,range:{min:Math.min(a.startVal,a.updateVal),max:Math.max(a.startVal,a.updateVal)}})}),e=!0}d.length&&b.emit(d,e)}},on:function(){q.$broadcast("on")},off:function(){q.$broadcast("off"),this.activeComponent=null}}),m.defaultOptions={toggle:{callback:null}},m}),define("objects.utils/animation-frame",[],function(){var a=function(a){return window.setTimeout(a,1e3/60)},b=function(a){return window.clearTimeout(a)},c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||a,d=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.msCancelAnimationFrame||b;return{request:c===a?a:c.bind(window),cancel:d===b?b:d.bind(window)}}),define("objects.views/charts/utils/matrix",["core.utils/class"],function(a){var b;return b=a.extend({init:function(){this._elements=[[1,0,0],[0,1,0],[0,0,1]],this._stack=[]},clone:function(){var a=new b;return a.multiply(this._elements)},set:function(a){return this._elements=a,this},save:function(){return this._stack.push(this.elements),this},restore:function(){return this._stack.length&&(this._elements=this._stack.pop()),this},add:function(a){var b,c;for(b=0;b<this._elements.length;b++)for(c=0;c<this._elements[b].length;c++)this._elements[b][c]+=a;return this},translate:function(a,b){return this.multiply([[1,0,a],[0,1,b],[0,0,1]]),this},rotate:function(a){var b=Math.cos(-a),c=Math.sin(-a);return this.multiply([[b,c,0],[-c,b,0],[0,0,1]]),this},skew:function(a,b){var c=Math.tan(a),d=Math.tan(b);return this.multiply([[1,c,0],[d,1,0],[0,0,1]]),this},multiply:function(a){var c,d,e,f;if(a instanceof b&&(a=a._elements),Array.isArray(a)){for(e=[[0,0,0],[0,0,0],[0,0,0]],c=0;c<this._elements.length;c++)for(d=0;d<this._elements[c].length;d++)for(f=0;3>f;f++)e[c][d]+=this._elements[c][f]*a[f][d];this._elements=e}else for(c=0;c<this._elements.length;c++)for(d=0;d<this._elements[c].length;d++)this._elements[c][d]*=a;return this},scale:function(a,b){return(arguments.length<2||"undefined"==typeof b)&&(b=a),this.multiply([[a,0,0],[0,b,0],[0,0,1]]),this},determinant:function(){var a=this._elements[0][0],b=this._elements[0][1],c=this._elements[0][2],d=this._elements[1][0],e=this._elements[1][1],f=this._elements[1][2],g=this._elements[2][0],h=this._elements[2][1],i=this._elements[2][2],j=0;return j=a*e*i+b*f*g+c*d*h-c*e*g-b*d*i-a*f*h},invert:function(){var a=this.determinant(),b=this._elements[0][0],c=this._elements[0][1],d=this._elements[0][2],e=this._elements[1][0],f=this._elements[1][1],g=this._elements[1][2],h=this._elements[2][0],i=this._elements[2][1],j=this._elements[2][2];return this._elements=[[f*j-g*i,d*i-c*j,c*g-d*f],[g*h-e*j,b*j-d*h,d*e-b*g],[e*i-f*h,h*c-b*i,b*f-c*e]],this.multiply(1/a),this},transpose:function(){var a=Object.create(this._elements);return this._elements=[[a[0][0],a[1][0],a[2][0]],[a[0][1],a[1][1],a[2][1]],[a[0][2],a[1][2],a[2][2]]],this},identity:function(){return this._elements=[[1,0,0],[0,1,0],[0,0,1]],this},transformPoint:function(a){var b,c,d=[a.x,a.y,1],e=this._elements,f=[0,0,0];for(b=0;b<this._elements.length;b++)for(c=0;c<this._elements[b].length;c++)f[b]+=d[c]*e[b][c];return{x:f[0],y:f[1]}},transformPoints:function(a){var b,c,d,e,f,g=this._elements,h=[];for(e=0;e<a.length;e++){for(b=[a[e].x,a[e].y,1],f=[0,0,0],c=0;c<this._elements.length;c++)for(d=0;d<this._elements[c].length;d++)f[c]+=b[d]*g[c][d];h.push({x:f[0],y:f[1]})}return h},toString:function(){var a="";return this._elements.forEach(function(b,c,d){a+=b.join("	")+(c<d.length?"\n":"")}),a}}),Object.defineProperties(b.prototype,{elements:{get:function(){var a=this._elements;return[[a[0][0],a[0][1],a[0][2]],[a[1][0],a[1][1],a[1][2]],[a[2][0],a[2][1],a[2][2]]]}}}),b}),define("objects.views/charts/utils/canvas-renderer",["core.utils/class","objects.utils/shapes/rect","objects.utils/animation-frame","jquery","./matrix"],function(a,b,c,d,e){function f(a,b){y.length>100&&delete x[y.shift()],y.push(a),x[a]=b}function g(a){if(a.font in x)return x[a.font];var b=1.5*a.measureText("m").width;return f(a.font,b),b}function h(a,b,c,d,e){var f,g,h=b.shape.points,i=h?h.length:0;if(a.beginPath(),f=h[0]){for(a.moveTo(f.x,f.y),g=1;i>g;g+=1)f=h[g],a.lineTo(f.x,f.y);e&&a.closePath(),c&&a.fill(),d&&a.stroke()}}function i(a,b,c){var d,e,f,g=a?a.replace(/^\s*|\s*$/,"").split(" "):[],h=[],i=g[0];if(!i)return[];for(d=1;d<g.length;d++)e=i+" "+g[d],f=t.measureText(e).width,f>b&&c>h.length?(h.push(i),i=g[d]):i=e;return h.length<c?h.push(i):h[Math.max(0,h.length-1)]?h[Math.max(0,h.length-1)]+=" "+i:h[Math.max(0,h.length-1)]=" "+i,h}function j(a,b,c){if(void 0!==a){var d,e,f,g,h,i,j,k,l="",m=t.measureText("i").width;for(d=0;d<a.length;d++){if(e=a[d],j=Math.ceil(Math.max(0,b/m))+1,j<e.length?(g=e.slice(j),e=e.slice(0,j)):g="",f=e,e&&e.length>1&&t.measureText(e).width>b){for(h=!1,i=e.length;i>0;i--)if(f=f.substring(0,f.length-1),k=f+(c>d+1?"-":l),t.measureText(k).width<b){g=e.substring(i-1),e=k,h=!0;break}h||(g=e.substring(1),e=e.substring(0,1)),h||i||(g="",e=l)}a[d]=String(e).trim(),g&&d<a.length-1?a[d+1]=g+" "+a[d+1]:g&&a.length<c&&a.push(g)}}}function k(a,b,c){var d,e=c.maxWidth;return isNaN(e)?[a]:(d=b>1?i(a,e,b):[a],j(d,e,b),d)}function l(a,b,c){var d,e,f=b.text,h=(b.lineHeight||1)*g(a),i="maxWidth"in b?b.maxWidth:b.width,j="maxHeight"in b?b.maxHeight:b.height,l=b.width,m=b.height,n=b.maxNumLines,o=b.x||0,p=b.y||0;if(t.font=a.font,isNaN(n)&&(n=j?Math.max(1,Math.floor(j/h)):1),d=k(f,n,{maxWidth:i,maxHeight:j}),c){for(l=0,e=0;e<d.length;e++)l=Math.max(l,a.measureText(d[e]).width);return{lines:d,numLines:d.length,width:l,height:d.length*h,truncated:Array.isArray(/$/.exec(d[d.length-1]))}}for("middle"===a.textBaseline?"undefined"!=typeof m?p+=m/2:d.length&&(p-=(d.length-1)*h/2):"bottom"===a.textBaseline&&("undefined"!=typeof m?p+=m:p-=(d.length-1)*h),"center"===a.textAlign&&l?o+=l/2:"right"===a.textAlign&&l&&(o+=l),e=0;e<d.length;e++)a.fillText(d[e],o,p),p+=h}function m(a,b,c,d,e,f){var g,h,i,j,k,l,n;for(g=0;g<c.length;g+=1)if(j=c[g]){if(a.save(),i=j.transform,i&&(b.save(),b.multiply(i)),"opacity"in j&&(a.globalAlpha=j.opacity),j.fill)if(j.fill.gradient){if(n=j.fill.gradient,isNaN(n.x0)||isNaN(n.y0)||isNaN(n.x1)||isNaN(n.y1))return;for(l=a.createLinearGradient(n.x0,n.y0,n.x1,n.y1),h=0;h<n.limits.length;h++)l.addColorStop(n.limits[h],n.colors[h]);a.fillStyle=l}else a.fillStyle=j.fill;if(j.stroke&&0!==j.strokeWidth){if(j.stroke.gradient){for(n=j.stroke.gradient,l=a.createLinearGradient(n.x0,n.y0,n.x1,n.y1),h=0;h<n.limits.length;h++)l.addColorStop(n.limits[h],n.colors[h]);a.strokeStyle=l}else a.strokeStyle=j.stroke;a.lineWidth=j.strokeWidth||1,d>1&&"polygon"!==j.type&&(a.lineWidth/=d)}j.lineJoin&&(a.lineJoin=j.lineJoin),j.lineCap&&(a.lineCap=j.lineCap),k=b.elements,"group"===j.type?(b.save(),j.clip&&(a.beginPath(),a.setTransform(k[0][0],k[1][0],k[0][1],k[1][1],k[0][2],k[1][2]),a.rect(j.clip.rect.x,j.clip.rect.y,j.clip.rect.width,j.clip.rect.height),a.clip()),m(a,b,j.children,void 0,!!j.fill||!!e,!!j.stroke&&0!==j.strokeWidth||!!f),b.restore()):j.type in q&&(a.setTransform(k[0][0],k[1][0],k[0][1],k[1][1],k[0][2],k[1][2]),q[j.type](a,j,!!j.fill||!!e,!!j.stroke&&0!==j.strokeWidth||!!f)),a.globalAlpha=1,i&&b.restore(),a.restore()}}function n(a,b,c){if(c){var d=b.elements;switch(c.type){case"clip":a.save(),a.setTransform(d[0][0],d[1][0],d[0][1],d[1][1],d[0][2],d[1][2]),a.beginPath(),a.rect(c.rect.x,c.rect.y,c.rect.width,c.rect.height),a.clip();break;case"slice":}}}function o(a,b){b&&a.restore()}var p,q,r=window.devicePixelRatio||1,s=document.createElement("canvas"),t=s.getContext("2d"),u=document.createElement("span"),v=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,w=r/v,x={},y=[];u.innerText="Wj",q={rect:function(a,b,c,d){c&&a.fillRect(b.shape.x||0,b.shape.y||0,b.shape.width||0,b.shape.height||0),d&&a.strokeRect(b.shape.x||0,b.shape.y||0,b.shape.width||0,b.shape.height||0)},roundRect:function(a,b,c,d){a.beginPath(),a.moveTo(b.shape.x+b.shape.radius,b.shape.y),a.lineTo(b.shape.x+b.shape.width-b.shape.radius,b.shape.y),a.quadraticCurveTo(b.shape.x+b.shape.width,b.shape.y,b.shape.x+b.shape.width,b.shape.y+b.shape.radius),a.lineTo(b.shape.x+b.shape.width,b.shape.y+b.shape.height-b.shape.radius),a.quadraticCurveTo(b.shape.x+b.shape.width,b.shape.y+b.shape.height,b.shape.x+b.shape.width-b.shape.radius,b.shape.y+b.shape.height),a.lineTo(b.shape.x+b.shape.radius,b.shape.y+b.shape.height),a.quadraticCurveTo(b.shape.x,b.shape.y+b.shape.height,b.shape.x,b.shape.y+b.shape.height-b.shape.radius),a.lineTo(b.shape.x,b.shape.y+b.shape.radius),a.quadraticCurveTo(b.shape.x,b.shape.y,b.shape.x+b.shape.radius,b.shape.y),a.closePath(),c&&a.fill(),d&&a.stroke()},circle:function(a,b,c,d){if(b.shape&&b.shape.r&&!b.shape.radius&&(b.shape.radius=b.shape.r),!(isNaN(b.shape.cx)||isNaN(b.shape.cy)||isNaN(b.shape.radius)||b.shape.radius<=0)){var e=.551784;a.save(),a.translate(b.shape.cx,b.shape.cy),a.scale(b.shape.radius,b.shape.radius),a.beginPath(),a.moveTo(1,0),a.bezierCurveTo(1,-e,e,-1,0,-1),a.bezierCurveTo(-e,-1,-1,-e,-1,0),a.bezierCurveTo(-1,e,-e,1,0,1),a.bezierCurveTo(e,1,1,e,1,0),a.closePath(),a.restore(),c&&a.fill(),d&&a.stroke()}},line:function(a,b,c,d){d&&(a.beginPath(),a.moveTo(b.shape.x1,b.shape.y1),a.lineTo(b.shape.x2,b.shape.y2),a.stroke())},polygon:function(a,b,c,d){h(a,b,c,d,!0)},polyline:function(a,b,c,d){h(a,b,c,d)},polygons:function(a,b,c,d){var e,f,g,h,i,j,k=b.shape.polygons,l=k?k.length:0;for(a.beginPath(),i=0;l>i;i++)if(e=k[i],f=e.points,g=f?f.length:0,0!==g&&(h=f[0]))for(a.moveTo(h.x,h.y),j=1;g>j;j+=1)h=f[j],a.lineTo(h.x,h.y);c&&a.fill(),d&&a.stroke()},multipolygon:function(a,b,c,d){var e,f,g,h,i,j,k,l,m=b.shape.geopolygons,n=m?m.length:0;for(a.beginPath(),j=0;n>j;j++)for(e=m[j].getPolygons(),f=e?e.length:0,k=0;f>k;k++)if(g=e[k].points,h=g?g.length:0,0!==h&&(i=g[0]))for(a.moveTo(i.x,i.y),l=1;h>l;l+=1)i=g[l],a.lineTo(i.x,i.y);c&&a.fill(),d&&a.stroke()},arc:function(a,b,c,d){var e=b.shape;a.beginPath(),e.end-e.start===2*Math.PI?(a.arc(e.cx,e.cy,e.radius,e.start+e.radianOffset,e.end+e.radianOffset,!1),a.moveTo(e.cx+e.innerRadius*Math.cos(e.radianOffset+e.start),e.cy+e.innerRadius*Math.sin(e.radianOffset+e.start)),a.arc(e.cx,e.cy,e.innerRadius,e.end+e.radianOffset,e.start+e.radianOffset,!0)):(a.arc(e.cx,e.cy,e.radius,e.start+e.radianOffset,e.end+e.radianOffset,!1),isNaN(e.innerRadius)||e.innerRadius===e.radius||(a.lineTo(e.innerRadius*Math.cos(e.end+e.radianOffset)+e.cx,e.innerRadius*Math.sin(e.end+e.radianOffset)+e.cy),e.innerRadius>0&&a.arc(e.cx,e.cy,e.innerRadius,e.end+e.radianOffset,e.start+e.radianOffset,!0),a.lineTo(e.radius*Math.cos(e.start+e.radianOffset)+e.cx,e.radius*Math.sin(e.start+e.radianOffset)+e.cy))),a.closePath(),c&&a.fill(),d&&a.stroke()},text:function(a,b){b.shape&&b.shape.text&&b.fill&&(b.shape.font&&(a.font=b.shape.font),b.shape.align&&(a.textAlign=b.shape.align),b.shape.baseline&&(a.textBaseline=b.shape.baseline),l(a,b.shape))}},p=a.extend({init:function(a,c){var f=d.extend(!0,{storeObjects:!1},c);this._container=a,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.width=0,this._canvas.height=0,f.name&&this._canvas.setAttribute("name",f.name),this.storeRenderedObjects=f.storeObjects===!0,this.scaling={x:1,y:1},this._container&&this._container.appendChild(this._canvas),this.rect=new b(0,0,0,0),this.shapes=[],this._matrix=new e},setDimensions:function(a,b,c,d){this.rect.set(a,b,c,d)},setDimensionsToContainerRatio:function(a,b){this.scaling={x:a,y:b},this.ratios={x:a,y:b}},show:function(){this._canvas.style.display=""},hide:function(){this._canvas.style.display="none"},clear:function(a){if(a){if(!this._clearTimer){var b=this;this._clearTimer=c.request(function(){b._clearTimer&&(b._canvas.width=0,b._clearTimer=0)})}}else c.cancel(this._clearTimer),this._clearTimer=0,this._canvas.width=0,this._canvas.height=0,d(this._canvas).data("shapes",null),this.shapes=[]},render:function(){c.cancel(this._clearTimer),this._clearTimer=0,r=window.devicePixelRatio||1,v=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,w=r/v;var a,b,e=this._canvas,f=e.getContext("2d"),g=w,h=this._matrix,i=0,j=0;b=this.rect.height*this.scaling.y,a=this.rect.width*this.scaling.x,this.edgeBleed&&(i=this.edgeBleed.left*this.scaling.x,j=this.edgeBleed.top*this.scaling.y,b+=this.edgeBleed.top*this.scaling.y+this.edgeBleed.bottom*this.scaling.y,a+=this.edgeBleed.left*this.scaling.x+this.edgeBleed.right*this.scaling.x),b=Math.round(b),a=Math.round(a),this._canvas.style.left=-i+"px",this._canvas.style.top=-j+"px",e.width!==a||e.height!==b?(e.width=g*a,e.height=g*b,this._canvas.style.width=a+"px",this._canvas.style.height=b+"px"):f.clearRect(0,0,e.width,e.height),f.save(),h.save(),h.scale(g*this.scaling.x,g*this.scaling.y),h.translate(i/this.scaling.x,j/this.scaling.y),n(f,h,this.viewBox),m(f,h,this.shapes,this.scaling.x),o(f,this.viewBox),f.restore(),h.restore(),this.storeRenderedObjects&&d(this._canvas).data("shapes",this.shapes)},setFont:function(a){this._canvas.getContext("2d").font=a},getFontHeight:function(a){if("string"!=typeof a)throw new Error("CanvasRenderer.getFontHeight(): Input font is not a string");if(a in x)return x[a];var b,c=this._canvas.getContext("2d");return c.font!==a?(c.save(),c.font=a,b=1.5*c.measureText("m").width,c.restore()):b=1.5*c.measureText("m").width,f(a,b),b},getTextWidth:function(a,b){var c,d=this._canvas.getContext("2d");return d.save(),d.font=b,c=void 0!==a?Math.ceil(d.measureText(a).width):0,d.restore(),c},getEMFontWidth:function(a){var b,c="m",d=this._canvas.getContext("2d");return d.save(),d.font=a,b=d.measureText(c).width,d.restore(),b},getAverageLetterWidth:function(a){var b,c="eeeaaaiinnoorsstldumcph";return t.font=a||this._canvas.getContext("2d").font,b=t.measureText(c).width,b/c.length},release:function(){d(this._canvas).data("shapes",null),this.shapes=[],this._container&&(this._container.removeChild(this._canvas),this._container=null)},applyTransform:function(){var a;for(a=0;a<this.shapes.length;a+=1)this.shapes[a].type in z&&z[this.shapes[a].type](this.shapes[a].shape,this.ratios)}});var z={rect:function(a,b){a.x*=b.x,a.y*=b.y,a.width*=b.x,a.height*=b.y},line:function(a,b){a.x1*=b.x,a.y1*=b.y,a.x2*=b.x,a.y2*=b.y},circle:function(a,b){a.cx*=b.x,a.cy*=b.y,a.r*=Math.min(b.x,b.y)},polygon:function(a,b){var c,d;for(c=0;c<a.points.length;c++)d=a.points[c],d.x*=b.x,d.y*=b.y},text:function(a,b){a.x*=b.x,a.y*=b.y,a.width*=b.x,a.height*=b.y}};return p.getTextWidth=function(a){return Math.ceil(t.measureText(a).width)},p.setFont=function(a){t.font=a},p.measureText=function(a,b){var c,d,e,g=t;return b&&g.font!==b&&(g.save(),g.font=b),d=g.measureText(a).width,b in x?c=x[b]:(c=1.5*g.measureText("m").width,f(b,c)),b&&g.restore(),e=void 0!==a?{width:d,height:c}:{width:0,height:0}},p.measureTextObject=function(a){return a.shape.font&&(t.font=a.shape.font),a.shape.align&&(t.textAlign=a.shape.align),a.shape.baseline&&(t.textBaseline=a.shape.baseline),l(t,a.shape,!0)},p.getFontHeight=function(a){var b,c=t;return a in x?x[a]:(a&&(c.save(),c.font=a),b=1.5*c.measureText("m").width,f(a,b),a&&c.restore(),b)},p.getDevicePixelToBackingStoreRatio=function(){return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)},p}),define("objects.views/selections/types/legend",["jquery","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","objects.utils/shapes/rect","./base"],function(a,b,c,d,e){function f(a,b,d){var e,f,g,h,m,s,t,u=this.getRect(this.activeComponent),v=[],w=a.x-b.x,x=a.y-b.y,y=0,z=0,A=0,B=0,C=0,D=this._renderItems.lineStart,E=this._renderItems.lineEnd,F=this._renderItems.rectHighlight,G=this._renderItems.labelStart,H=this._renderItems.labelEnd,I=this._renderer.getFontHeight(i.text.font),J=r(I/2),K=this._renderItems.arrowStart,L=this._renderItems.arrowEnd;switch(this.activeComponent.dock){case"top":case"bottom":y=0>=w?u.width-a.x:a.x,z=p(k,o(a.x+k,b.x+k)),A=0,B=o(u.width-z+k,o(y,n(w))),C=u.height,d.startVal=this.activeComponent.getValueOfPosition(z-k),d.updateVal=this.activeComponent.getValueOfPosition(z+B-k),D.shape={x1:z-.5,x2:z-.5,y1:A,y2:A+C},E.shape={x1:z+B-.5,x2:z+B-.5,y1:A,y2:A+C},e=this.activeComponent.getFormatter().format(d.startVal),f=this.activeComponent.getFormatter().format(d.updateVal),g=Math.ceil(this._renderer.getTextWidth(e,i.text.font)),h=p(2*-j-g,-k)+.5,K.shape.points=[{x:0,y:0},{x:-j,y:-J},{x:h,y:-J},{x:h,y:J},{x:-j,y:J},{x:0,y:0}],G.shape.x=z-j,G.shape.y=A+C/2,G.shape.baseline="middle",G.shape.align="right",G.shape.maxWidth=k-j,g=this._renderer.getTextWidth(f,i.text.font),h=o(2*j+g,k)+.5,L.shape.points=[{x:0,y:0},{x:j,y:-J},{x:h,y:-J},{x:h,y:J},{x:j,y:J},{x:0,y:0}],H.shape.x=z+B+j,H.shape.y=A+C/2,H.shape.baseline="middle",H.shape.align="left",H.shape.maxWidth=k-j,s=new c,s.translate(z,A+C/2),t=new c,t.translate(z+B,A+C/2);break;case"left":case"right":y=0>=x?u.height-a.y:a.y,z=l,A=p(k,o(a.y+k,b.y+k)),B=u.width,C=o(u.height-A+k,o(y,n(x))),d.startVal=this.activeComponent.getValueOfPosition(A-k),d.updateVal=this.activeComponent.getValueOfPosition(A+C-k),D.shape={x1:z,x2:z+B,y1:A-.5,y2:A-.5},E.shape={x1:z,x2:z+B,y1:A+C-.5,y2:A+C-.5},e=this.activeComponent.getFormatter().format(d.startVal),f=this.activeComponent.getFormatter().format(d.updateVal),g=Math.ceil(this._renderer.getTextWidth(e,i.text.font)),h=r(p(g+4,B)/2),m=o(u.width-1,(g>2*h?2*I:I)+j)+.5,K.shape.points=[{x:0,y:0},{x:-j,y:-h},{x:-m,y:-h},{x:-m,y:h},{x:-j,y:h},{x:0,y:0}],G.shape.x=z+B/2,G.shape.y=A-j,G.shape.baseline="bottom",G.shape.align="center",G.shape.maxWidth=2*h-4,g=this._renderer.getTextWidth(f,i.text.font),h=r(p(g+4,B)/2),m=(g>2*h?2*I:I)+j+.5,L.shape.points=[{x:0,y:0},{x:j,y:-h},{x:m,y:-h},{x:m,y:h},{x:j,y:h},{x:0,y:0}],H.shape.x=z+B/2,H.shape.y=A+C+j,H.shape.baseline="top",H.shape.align="center",H.shape.maxHeight=k,s=new c,s.translate(z+B/2,A),s.rotate(q/2),t=new c,t.translate(z+B/2,A+C),t.rotate(q/2)}K.transform=s.elements,L.transform=t.elements,G.shape.text=e,H.shape.text=f,F.shape={height:C,width:B,x:z,y:A},v=[F,D,E,K,L,G,H],this._renderer.shapes=v,this._renderer.render()}var g,h,i={text:{font:"10px 'QlikView Sans'",textColor:"#333"},arrow:{fill:"rgba(255, 255, 255, 0.8)",stroke:"rgba(0, 0, 0, 0.6)"},range:{fill:"rgba(188, 235, 188, 0.6)",stroke:"rgba(0, 0, 0, 0.6)"}},j=5,k=80,l=30,m=[],n=Math.abs,o=Math.min,p=Math.max,q=Math.PI,r=Math.round,s="dimension",t=a("<div />"),u=t[0],v={startVal:0,updateVal:0};return u.className="selections-legend-range-ui",t.hide(),g=e.extend({init:function(a,c){this._super(a,c),this._renderer=new b(u,{name:"legendRange",storeObjects:!0}),this._renderItems={lineStart:{type:"line",stroke:i.range.stroke,shape:{}},lineEnd:{type:"line",stroke:i.range.stroke,shape:{}},rectHighlight:{type:"rect",fill:i.range.fill,shape:{}},labelStart:{type:"text",fill:i.text.textColor,shape:{font:i.text.font,maxNumLines:2}},labelEnd:{type:"text",fill:i.text.textColor,shape:{font:i.text.font,maxNumLines:2}},arrowStart:{type:"polygon",fill:i.arrow.fill,stroke:i.arrow.stroke,shape:{points:[{x:0,y:0},{x:-j,y:-7},{x:-k,y:-7},{x:-k,y:7},{x:-j,y:7},{x:0,y:0}]}},arrowEnd:{type:"polygon",fill:i.arrow.fill,stroke:i.arrow.stroke,shape:{points:[{x:0,y:0},{x:j,y:-7},{x:k,y:-7},{x:k,y:7},{x:j,y:7},{x:0,y:0}]}}}
},release:function(){this._renderer.release()},initComponent:function(a){this.activeComponent=this.getComponent(a.x,a.y),this.activeComponent&&this.setActiveMode(["scale","range"].contains(this.activeComponent.getSelectionMode())?"range":"item")},getRect:function(a){return a?a.hasOwnProperty("innerRect")?a.innerRect:a.rect:new d(0,0,0,0)},refreshCanvas:function(){var a,b,c,d,e,f=this.getRect(this.activeComponent);this.activeComponent.isVertical()?(a=f.width+2*l,b=f.height+2*k,c=f.x-l,d=f.y-k):(a=f.width+2*k,b=f.height,c=f.x-k,d=f.y+1),this._renderer.setDimensions(0,0,a,b),e={position:"absolute",left:c+"px",top:d+"px",width:a+"px",height:b+"px"},t.css(e)},start:function(a,b){var c=this.activeComponent;return c&&"scale"===c.getSelectionMode()?(this.resetSelectedShapes(),s="range",this.setActiveMode("range"),this.handler.container[0].appendChild(u),h=this.getTransformedPoint(b.x,b.y),t.show(),this._renderer.clear(),this._renderer.show(),void this.refreshCanvas()):void(s="cancel")},update:function(a,b){if("range"===s){var c,d=v,e=this.getTransformedPoint(b.x,b.y),g=this.ToggleFlag.select,i=this.toggleSelection;f.call(this,h,e,d),this.clearSelection(!0),c=this.shapesFromRange(d.startVal,d.updateVal),c.forEach(function(a){a.selectionMode="range.measure"}),this.setActiveMode("range"),i.call(this,c,g)}},updateShapesState:function(){var a,b=this.getComponentKey(this.activeComponent),c=v[b],d=this.ToggleFlag.select,e=this.toggleSelection;this.clearSelection(!0),this.activeComponent.isDiscrete&&!this.activeComponent.isDiscrete()&&(a=this.shapesFromRange(c.startVal,c.updateVal),a.forEach(function(a){a.selectionMode="range.measure"}),e.call(this,a,d)),this._shapes=a},end:function(){"range"===s&&this.selectRange()},toggle:function(a,b){var c,d,e,f,g,h,i,j,k=b;switch(this.resetSelectedShapes(),d=[],f=this.activeComponent,c=this.getTransformedPoint(k.x,k.y),j=f.getSelectionMode()){case"range":if(g=f.checkHitItems(c.x,c.y),g.id.contains(-3))return;if(i=g.replace?8:4,m=[],g){for(h=0;h<g.id.length;h+=2)d=d.concat(this.shapesFromRange(g.id[h],g.id[h+1],!0,g.isMax)),m.push({startVal:g.id[h],updateVal:g.id[h+1],isMax:g.isMax});s="class",this.setActiveMode("range")}break;case"dimension":this._allowNullSelect=!0,d=this.shapesFromPoints([c]),this._allowNullSelect=!1,s="dimension",this.setActiveMode("item");break;default:return}for(h=0;h<d.length;h++)d[h].selectionMode="legend";return e=this.options.toggle.callback||this.toggleSelection,e.call(this,d,i),d&&d.length>0},cancel:function(){this.activeComponent&&this.activeComponent.clearSelectedRange(),t.hide(),this._renderer.hide()},clearSelection:function(a){this._super(),this.activeComponent&&(this.activeComponent.clearSelectedRange(),m=[]),a=a||!1,a?this._super():(this._super(),this._renderer.hide(),v.startVal=0,v.updateVal=0,s="cancel")},selectRange:function(){if("cancel"!==s){var a,b,c=this.handler.SelectRange,d=[];if("dimension"!==s){if("class"===s)for(a=0;a<m.length;a++)b=m[a],d.push({measure:0,range:{min:Math.min(b.startVal,b.updateVal),max:Math.max(b.startVal,b.updateVal),minInclEq:!0,maxInclEq:b.isMax}});else"range"===s&&(b=v,d.push({measure:0,range:{min:Math.min(b.startVal,b.updateVal),max:Math.max(b.startVal,b.updateVal),minInclEq:!0,maxInclEq:!0}}));c.emit(d,"class"===s)}}}}),g.defaultOptions={captureInput:!0,toggle:{callback:null}},g}),define("text!objects.views/charts/tooltip/chart-tooltip.ng.html",[],function(){return'<div ng-switch on="template">\r\n\r\n	<div ng-switch-when="generic" class="qv-tooltip qvt-generic-tooltip" >\r\n		<div class="header">\r\n			<strong>{{header}}</strong>\r\n		</div>\r\n		<table>\r\n			<tr ng-repeat="row in rows" class="row">\r\n				<td class=\'item\'>\r\n					<div class="rowContent fade-out">{{row.content}}</div>\r\n				</td>\r\n			</tr>\r\n		</table>\r\n	</div>\r\n\r\n	<div ng-switch-default class="qv-tooltip qvt-chart-tooltip" qva-press="onTap($event)" tid="qv-chart-tooltip">\r\n		<div class="immidiate-contextual-arrow"></div>\r\n		<div class="qv-chart-tooltip-content">\r\n			<div class=\'header\'>\r\n				<strong>{{header}}</strong>\r\n			</div>\r\n			<table>\r\n				<tr ng-repeat="row in rows" class="row">\r\n					<td class=\'item\'>\r\n						<div class="rowPart">{{row.label + \':&nbsp;\'}}</div>\r\n					</td>\r\n					<td class=\'value\'>\r\n						<div class="rowPart">{{row.value}}</div>\r\n					</td>\r\n				</tr>\r\n			</table>\r\n		</div>\r\n	</div>\r\n\r\n</div>'}),define("objects.views/charts/tooltip/chart-tooltip-directive",["touche","qvangular","ng!$timeout","general.utils/arrow-positioner","general.utils/window-positioner","text!./chart-tooltip.ng.html"],function(a,b,c,d,e,f){b.directive("qvaChartTooltip",function(){return{template:f,replace:!0,scope:{content:"=",position:"=",visible:"=",direction:"=",template:"="},link:function(b,f){var g,h,i=!1;g=function(a){var b=a?"block":"none";f.css("display",b)},b.synchronAlign=function(){var a=f.find(".qv-tooltip"),c=f.find(".immidiate-contextual-arrow");g(b.visible);var h=b.direction,j=Math.round(b.position.x),k=Math.round(b.position.y);switch(h){case"right":h="centerRight",j+=9;break;case"left":h="centerLeft",j-=9;break;case"bottom":k+=9;break;default:k-=9}e.alignToCoordinate(a,j,k,h),c.removeClass().addClass("immidiate-contextual-arrow").addClass(b.direction),d.alignToCoordinate(a,j,k,b.direction,c),i=!1},b.align=function(){h=c(b.synchronAlign)},b.$watch("position",function(a){a&&a.x&&a.y&&(i=!0,b.align())}),b.$watch("visible",function(a){i||g(a)}),b.$watch("content",function(a){a?(b.header=a.label,b.rows=a.rows):b.visible=!1}),b.onTap=function(c){b.visible=!1,c.stopPropagation(),c.preventDefault(),a.preventGestures()},b.$on("$destroy",function(){c.cancel(h)})}}})}),define("objects.views/charts/tooltip/chart-tooltip-component",["./chart-tooltip-directive"],function(){var a;return a={transclude:!0,template:'<div qva-chart-tooltip position="position" content="content" direction="direction" visible="visible" template="template"></div>',controller:["$scope",function(a){a.visible=!1,this.hide=function(){a.visible=!1},this.show=function(b){a.content=b.content,a.position=b.position,a.direction=b.direction,a.template=b.template,a.visible=!0}}]}}),define("objects.views/charts/tooltip/chart-tooltip-service",["qvangular","core.utils/notification","./chart-tooltip-component","angular"],function(a,b,c){return a.service("qvChartTooltipService",["$document",function(a){var d,e,f=a.find("body"),g=angular.element("<div>").appendTo(f);return d={open:function(a){if(!e){var b=a.position;a.position=void 0,e=g.showComponent(c,a),a.position=b}e.show(a)},close:function(){this.Closed.emit(),e&&e.hide()}},b.create(d,"Closed"),d}])}),define("objects.views/selections/types/tooltip",["jquery","./base","qvangular","objects.utils/shapes/rect","objects.views/charts/utils/canvas-renderer","objects.views/charts/tooltip/chart-tooltip-service"],function(a,b,c,d,e){function f(a){var b=a.getBoundingRect();return isNaN(b.x+b.y+b.width+b.height)}function g(a){var b=a.isCacheItem?a.getDimensions().join(", "):a.label,c=e.measureTextObject({shape:{text:b,width:u.headerWidth,font:u.font,maxNumLines:3}});return c.lines.join(" ")}function h(a,b){var c,d,e,h,j,k,l,m,n=[],o=null;this._positionAtMouse?(c=b||a.interactPosition,d=this.getTransformedPoint(c.x,c.y),j=a.getShapes(),n=j.filter(function(a){return a.pointInside(d.x,d.y)}),l=n.length?n[0]:j[0],m="top"):a.calculateTooltipPosition&&a.tooltipShape?(e=a.getTooltipPosition(a.tooltipShapeComponent),e&&(o=this.components[a.tooltipShapeComponent]?this.components[a.tooltipShapeComponent][0]:void 0,c=this.getPagePoint(e.x,e.y,o),m=e.direction)):a.tooltipPosition?(e=a.tooltipPosition,c=this.getPagePoint(e.x,e.y,null),m=e.direction):(j=a.getShapes(),a.tooltipShape&&!f(a.tooltipShape)?(n=[a.tooltipShape],o=this.components[a.tooltipShapeComponent]?this.components[a.tooltipShapeComponent][0]:void 0):b&&(d=this.getTransformedPoint(b.x,b.y),n=j.filter(function(a){return a.pointInside(d.x,d.y)})),l=n.length?n[0]:j[0],l.getRelevantPosition?(h=l.getRelevantPosition(),h.pos&&(c=this.getPagePoint(h.pos.x,h.pos.y,o)),m=h.direction):(h=l.getBoundingRect(),c=this.getPagePoint(h.x+h.width/2,h.y,o),m="top")),k={label:g(a)},k.rows=i.apply(this,[a,l]),c&&(w.open({position:c,content:k,direction:m}),t=a)}function i(a,b){var c,d,e,f,g,h,i=[],j=0,k=this.measureFormatters||[];if(a.isCacheItem)for(g=a.getMeasures(),h=a.getMeasuresIndecies(b),d=h.length,j;d>j;++j){var l=h[j];e=a.getValue(l),f=a.getPreformattedLabel(l),k[h[j]]&&(e="U"!==k[l].type&&f?f:k[l].format(e)),g[l]&&void 0!==e&&i.push({label:g[l],value:e})}else for(d=a.node.children.length,j;d>j;++j)e=a.node.children[j].children[0].data.qNum||a.node.children[j].children[0].data.qValue,f=a.node.children[j].children[0].data.qText,k[j]&&(e="U"!==k[j].type&&f?f:k[j].format(e)),i.push({label:a.node.children[j].data.qText,value:e});return this.colorMap&&(c=this.colorMap.getTooltipContent(a.getCombinedElementID?a.getCombinedElementID():a.id),c&&i.push(c)),i}function j(a){var b=this.getTransformedPoint(a.x,a.y);return this.shapeFromPoint(b)}function k(a){var b=this;this.activeComponent=this.getComponent(a.x,a.y);var c=j.call(b,a);n(),c&&(b._positionAtMouse="MapArea"===b.activeComponent.className,r=x(function(){m(),h.apply(b,[c,a]),r=null},500))}function l(a){var b=this;r=x(function(){a&&(b._positionAtMouse="MapArea"===b.activeComponent.className,h.apply(b,[a])),r=null},300)}function m(){s=x(function(){p()},5e3)}function n(){x.cancel(s),s=null}function o(){x.cancel(r),r=null,this.prevPoint=null}function p(){t&&(t=null,x(function(){w.close()})),r=null,n()}var q,r,s,t,u={font:"bold 13px 'QlikView Sans'",headerWidth:338},v=!0,w=c.getService("qvChartTooltipService"),x=c.getService("$timeout");return q=b.extend("ChartTooltip",{init:function(b,c){this._super(b,c),t=null,this._positionAtMouse=!1,r=null,this.name="tooltip",v=1===a(".touch-on").length,v&&b.ToggleTooltip.bind(this.updateHighlightedShape.bind(this)),this.enabled=!0,this._allowNullSelect=!0},initComponent:function(a){this.activeComponent=this.getComponent(a.x,a.y)},updateHighlightedShape:function(a){if(1===a.length){var b=a[0];v&&(b.selected?t||r?b!==t&&(o.call(this),n(),p.call(this),l.call(this,b)):l.call(this,b):(o.call(this),n(),p.call(this)))}},getRect:function(a){return a?a.hasOwnProperty("innerRect")?a.innerRect:a.rect:new d(0,0,0,0)},move:function(a,b){!v&&this.enabled&&(null!==r?(!this.prevPoint||b.distanceTo(this.prevPoint)>5)&&(o.call(this),k.call(this,b)):(this.prevPoint=b,t?j.call(this,b)!==t?(p.call(this),k.call(this,b)):(n(),m()):k.call(this,b)))},leave:function(b){var c=b.toElement||b.relatedTarget;a(c).hasClass("qvt-chart-tooltip")||a(c).parents(".qvt-chart-tooltip").length||(o.call(this),p.call(this))},cancel:function(){o.call(this),p.call(this)},clearSelection:function(){o.call(this),p.call(this)}}),q.defaultOptions={},q}),define("objects.views/selections/handler",["jquery","core.utils/notification","client.utils/state","core.utils/class","./types/data-area","./types/range-angular","./types/legend","./types/tooltip","objects.utils/shapes/rect","objects.utils/shapes/point","general.utils/support"],function(a,b,c,d,e,f,g,h,i,j,k){function l(b){Object.keys(b).forEach(function(c){c in s&&(this.types[c]=new s[c](this,a.extend(!0,{},s[c].defaultOptions,b[c])))},this)}function m(a,b){var c;for(c=0;c<b.length;c++)if(a.contains(b[c]))return!0;for(c=0;c<a.length;c++)if(b.contains(a[c]))return!0;return!1}var n,o,p=a(document),q=0,r=function(){return".selections-"+ ++q},s={dataArea:e,range:f,legend:g,tooltip:h};return n=d.extend({init:function(c,d,e){b.mixin(this),this.notification("Activated"),this.notification("Deactivated"),this.notification("ToggleShape"),this.notification("ToggleShapes"),this.notification("ToggleTooltip"),this.notification("SelectWhileLocked"),this.notification("Pan"),this.notification("Lasso"),this.notification("Confirm"),this.notification("Cancel"),this.notification("Select"),this.notification("SelectRange"),this.notification("Clear"),this.notification("ResetSelections"),this._active=!1,this._autoActivated=!1,this._isListening=!1,this._isScrolling=!1,this._isLocked=!1,this._shiftPressed=!1,this._lassoEnabled=!1,this.container=c,this.options=a.extend(!0,{},{getSelectionType:function(a,b){var c=this.containerRect,d=b||!1,e=new j(a.x-c.x,a.y-c.y);return Object.keys(this.types).map(function(a){return this.types[a]},this).filter(function(a){return Object.keys(a.components).map(function(b){return a.components[b]}).filter(function(b){return b.filter(function(b){var f=a.getExtendedRect?a.getExtendedRect(b):a.getRect(b);return f===c&&(e.x+=c.x,e.y+=c.y),d?"tooltip"===a.name&&("function"==typeof b.isVisible?b.isVisible():!0)&&f.pointInside(e.x,e.y):"tooltip"!==a.name?("function"==typeof b.isVisible?b.isVisible():!0)&&f.pointInside(e.x,e.y):void 0}).length>0})[0]},this)[0]},toggle:!0,toggleRect:!0,swipe:!0,autoSwipe:!1,ctrlKeyAsToggleSelected:!1},d),this.cache=e,this.containerRect=new i(0,0,0,0),this.eventNS=r(),this.types={},this._keyboard=!0,l.call(this,this.options)},setContainer:function(a){this.off(),this.container=a,this.on()},refreshContainerRect:function(){var a=this.offset=this.container.offset(),b=this.container.width(),c=this.container.height();this.containerRect.set(a.left,a.top,b,c)},on:function(){function a(a){o=a,n.refreshContainerRect(),i=q.getSelectionType.call(n,a),i&&i.initComponent(a),l=q.getSelectionType.call(n,a,!0),l&&l.initComponent(a)}function b(){if(n._activeType&&n._activeType!==i){var a=n._activeType.getActiveDimensions();n._activeType.cancel(),n._activeType.getActiveMode()===i.getActiveMode()&&m(a,i.getActiveDimensions())||(n._activeType.clearSelection(),n.ResetSelections.emit())}n._activeType=i,n._tooltipType=l=n.types.tooltip}function d(){b(),n.activate()}function e(){return(c.state===c.States.analysis||c.state===c.States.play)&&!n._isScrolling}function f(){return n._active&&!c.isInEditMode()}function g(){return i&&q.swipe&&e()}function h(a){return k.isMouse(a)}if(!this._isListening){this._isListening=!0;var i,l,n=this,q=this.options;this._reset=function(){i=null,l=null},this.getActiveType=function(){return n._activeType},this.getActiveTooltip=function(){return n._tooltipType},this.getActiveMode=function(){return n._activeType?n._activeType.getActiveMode():null},this._setTypeOnAutoActivate=function(){i=n.types.dataArea},p.off(n.eventNS),p.on("mouseup"+n.eventNS,function(a){1===a.which&&!n._shiftPressed&&n._drawingLassoWithShift&&n.Lasso.emit(!1)}),p.on("keydown"+n.eventNS,function(a){n._keyboard&&16===a.which&&(!n._shiftPressed&&n._active&&n.Lasso.emit(!n._lassoEnabled),n._shiftPressed=!0)}),p.on("keyup"+n.eventNS,function(a){n._keyboard&&(16===a.which&&(n._shiftPressed&&n._active&&!n._drawingLassoWithShift&&n.Lasso.emit(n._lassoEnabled),n._shiftPressed=!1),f()&&(27===a.which?n.cancel():13===a.which&&n.confirm()))}),this._onMouseMove=function(a){var b=new j(a.pageX,a.pageY),c=l;n.refreshContainerRect(),l=q.getSelectionType.call(n,b,!0),c&&c!==l&&c.cancel(),l&&(l.move.call(l,a,b),n._tooltipType=l)},this._onMouseLeave=function(a){l&&l.leave(a)},this.types.tooltip&&(this.container.on("mousemove",this._onMouseMove),this.container.on("mouseleave",this._onMouseLeave),p.on("mouseleave"+n.eventNS,this._onMouseLeave)),this.types.range&&this.types.range.on&&this.types.range.on();var r=!1;Touche(this.container[0]).tap({id:this.eventNS,options:{preventDefault:q.swipe},start:function(b,c){e()&&(q.autoSwipe&&h(b)&&(q.swipe=!0),a(c.pagePoints[0]))},end:function(a,b){if(e()&&i&&q.toggle){if(n._isLocked)return void n.SelectWhileLocked.emit();d(),Touche.preventGestures(this.gestureHandler),i.toggle.call(i,a,b.pagePoints[0]),"range"===i.getActiveMode()?i.selectRange():i.getSelectedShapes().length>0&&n.Select.emit(i.getSelectedShapes(),n.getKeyAsToggleSelected(a))}}}).tap({id:this.eventNS,options:{touches:2,preventDefault:q.swipe},end:function(b,c){return e()&&(a(c.pagePoints[0]),i&&q.toggle)?(d(),n._isLocked?void n.SelectWhileLocked.emit():void i.toggleRect.call(i,b,c.pagePoints[0],c.pagePoints[1])):void 0}}).swipe({id:this.eventNS,options:{preventDefault:q.swipe,useMomentum:!0,inertia:.5,radiusThreshold:6},start:function(a,b){if(g()){if(this.options.useMomentum=!0,l&&l.cancel(),n._shiftPressed&&!n._active&&n.Lasso.emit(!n._lassoEnabled),!n._lassoEnabled&&i.activeComponent&&"dataArea"===i.activeComponent.selectionIdentifier)return n.Pan.emit("start",a,b),void(this._isPanning=!0);if(n._lassoEnabled||!i.activeComponent||"legend"!==i.activeComponent.selectionIdentifier||"dimension"!==i.activeComponent.getSelectionMode())return r=!0,n._isLocked?void n.SelectWhileLocked.emit():(d(),n._drawingLassoWithShift=n._shiftPressed,this.options.useMomentum=!1,i.start.call(i,a,o),void 0)}},update:function(a,b){if(g())if(this._isPanning)n.Pan.emit("update",a,b);else if(r){if(n._isLocked)return void n.SelectWhileLocked.emit();i.update.call(i,a,b.pagePoints[0])}},end:function(a,b){if(g())if(this._isPanning)n.Pan.emit("end",a,b),this._isPanning=!1;else if(r){if(r=!1,n._isLocked)return void n.SelectWhileLocked.emit();n._drawingLassoWithShift=!1,i.end.call(i,a,b)}},cancel:function(){i&&r&&(i.cancel.call(i,!0),l&&l.cancel.call(l,!0))}})}},off:function(){this.container.off(this.eventNS),this.container.off("mousemove",this._onMouseMove),this.container.off("mouseleave",this._onMouseLeave),Touche(this.container[0]).off("*",this.eventNS),p.off(this.eventNS),this.types.range&&this.types.range.off&&this.types.range.off(),this._isListening=!1},autoActivate:function(){!this._autoActivated&&this._isListening&&(this._autoActivated=!0,this._setTypeOnAutoActivate(),this._activeType=this.types.dataArea,this._activeType.initComponent(),this.activate())},activate:function(){this._active||(this.Activated.emit(),this._active=!0)},deactivate:function(a){this._active&&(this._active=!1,this._autoActivated=!1,a||this.clearSelection(),this._activeType&&(this._activeType.cancel(),this._activeType=void 0),this._tooltipType&&(this._tooltipType.cancel(),this._tooltipType=void 0),this.Deactivated.emit(),this._reset())},confirm:function(){this._activeType&&this.deactivate(!0),this.Confirm.emit()},cancel:function(){this.deactivate(),this.Cancel.emit()},clearSelection:function(){this._activeType&&this._activeType.clearSelection(),this.types.tooltip&&this.types.tooltip.cancel()},toggleKeyboardAccelerators:function(a){this._keyboard=a},getKeyAsToggleSelected:function(a){return!(a.metaKey||a.ctrlKey)},release:function(){this.off(),b.release(this),Object.keys(this.types).forEach(function(a){this.types[a].release()},this)},toggleScrolling:function(a){a=a||!1,this._isScrolling=a},setLocked:function(a){this._isLocked=a},setLassoEnabled:function(a){this._lassoEnabled=a}})}),define("objects.views/selections/cache-item-base",["core.utils/class"],function(a){function b(a){var b=a.getBoundingRect();return isNaN(b.x+b.y+b.width+b.height)}var c=a.extend({init:function(a,b,c,d,e,f,g){if(a&&!(a instanceof Array)||b&&!(b instanceof Array)||c&&!(b instanceof Array)||d&&!(c instanceof Array))throw"The dimensions, measures and values input must be undefined or arrays";this.selected=!1,this.highlighted=!1,this.values=c||[],this.labels=d||[],this.row=e,this.col=f,this.id=g,this.parent=void 0,this.children=[],this._dimensions=a||[],this._measures=b||[],this._objectShapes={},this._shapes=[],this._tooltipShape=void 0,this._tooltipShapeComponent=void 0},get siblings(){return this._parent?this._parent.children:[]},clearShapes:function(a){a&&this._objectShapes[a]&&(this._objectShapes[a]=[]),this._shapes=[];for(var b in this._objectShapes)this._shapes=this._shapes.concat(this._objectShapes[b])},getShapes:function(a){return a?this._objectShapes[a]||(this._objectShapes[a]=[]):this._shapes},setTooltipPosition:function(a,b,c,d){d=d||"top",this._tooltipPosition={x:b,y:c,direction:d},this._tooltipShapeComponent=a},getTooltipPosition:function(a){if(this._calculateTooltipPosition&&a){var c=this.getShapes(a),d=c.map(function(a){return a.getBoundingRect()});if(d=d.filter(function(a){return!b(a)}),d.length){var e=d.reduce(function(a,b){return a.combineWith(b)},d[0]);return{x:e.x+e.width/2,y:e.y,direction:"top"}}return null}return this._tooltipPositon},addShape:function(a,b,c){if(b instanceof Array&&(!b[0].pointInside||!b[0].getBoundingRect)||!b.pointInside||!b.getBoundingRect)throw"The shape must implement a `pointInside` function";this._objectShapes[a]instanceof Array||(this._objectShapes[a]=[]),this._objectShapes[a].push(b),this._shapes.push(b),c&&(this._tooltipShape=b,this._tooltipShapeComponent=a)},addMeasure:function(a,b,c){this.values.push(b),this.labels.push(c),this._measures.push(a)},getMeasures:function(){return this._measures},getMeasuresIndecies:function(){return this._measures.map(function(a,b){return b})},addDimension:function(a){this._dimensions.push(a)},getDimensions:function(){return this._dimensions},getValue:function(a){return a=a||0,this.values[a]},getPreformattedLabel:function(a){return a=a||0,this.labels[a]},getCombinedElementID:function(){for(var a=this,b=[a.id];a.parent;)a=a.parent,b.push(a.id);return b.reverse(),b.join(",")}});return c.prototype.isCacheItem=!0,Object.defineProperties(c.prototype,{tooltipShape:{get:function(){return this._tooltipShape}},calculateTooltipPosition:{set:function(a){this._calculateTooltipPosition=a},get:function(){return this._calculateTooltipPosition}},interactPosition:{set:function(a){this._interactPosition=a},get:function(){return this._interactPosition}},tooltipPosition:{get:function(){return this._tooltipPosition}},tooltipShapeComponent:{get:function(){return this._tooltipShapeComponent}},label:{get:function(){throw new Error("CacheItem: label: Removed functionality")}},shape:{get:function(){throw new Error("CacheItem: shape: Removed functionality")}},value:{get:function(){throw new Error("CacheItem: value: Removed functionality")}}}),c}),define("objects.views/selections/cache",["./cache-item","./cache-item-base"],function(a,b){function c(){this.data=[]}return Object.defineProperties(c.prototype,{has:{value:function(a){return-1!==this.data.indexOf(a)}},add:{value:function(c){if(!(c instanceof a||c instanceof b))throw"Invalid cache item!";this.has(c)||this.data.push(c)}},remove:{value:function(a){var b=this.data.indexOf(a);-1!==b&&this.data.splice(b,1)}},clear:{value:function(){this.data.length=0}}}),c}),define("objects.extension/default-view-selection-service",["qvangular","objects.views/selections/handler","objects.views/selections/cache"],function(a,b,c){return a.service("qvDefaultViewSelectionService",[function(){return{createSelections:function(d,e,f){var g,h;if(f&&f.dataArea)return f.isPopover=d.options.isPopover,f.selectionsDisabled=d.options.selectionsDisabled||!1,g=new b(e,f,new c),g.Activated.bind(function(){d.selectionsApi.activated()}),g.Deactivated.bind(function(){d.selectionsApi.deactivateSearch&&d.selectionsApi.deactivateSearch()}),g.Cancel.bind(function(){d.selectionsApi.cancel()}),g.Select.bind(function(){d.selectionsApi.selectionsMade=!0}),g.SelectRange.bind(function(){d.selectionsApi.selectionsMade=!0}),g.Confirm.bind(function(){d.backendApi.endSelections(!0),d.selectionsApi.deactivated(),a.$rootScope.selectionObject=null}),g.ResetSelections.bind(function(){d.backendApi.clearSelections()}),d.selectionsApi.confirm=function(){g&&g.confirm()},h=d.selectionsApi.deactivated.bind(d.selectionsApi),d.selectionsApi.deactivated=function(){g&&g.deactivate(),h()},d.selectionsApi.deactivate=function(){g&&(g.deactivate(),this.deactivated())},d.selectionsApi.clear=function(){g.clearSelection(),d.backendApi.clearSelections(),d.selectionsApi.selectionsMade=!0},d.selectionsApi.toggleKeyboardAccelerators=function(a){g.toggleKeyboardAccelerators(a)},d.selectionsApi.getKeyAsToggleSelected=function(a){return g.getKeyAsToggleSelected(a)},d.selectionsApi.toggleSearch=function(){d.options.search.toggle()},d.selectionsApi.activate=function(){g.autoActivate()},d.selectionsApi.on=function(){g.on()},d.selectionsApi.off=function(){g.off()},d.$on("$destroy",function(){g&&(g.release(),g=null)}),g}}}])}),define("objects.extension/controller",["objects.extension/base-controller","objects.extension/default-view-selection-service"],function(a){var b;return b=a.extend({$scope:null,$element:null,api:null,view:null,create:function(a,b,c,d,e,f){var g=this.createView(a,b,c,d,f);return this.createSelections(g,a,b,e),g},createView:function(a,b,c,d,e){return new c(a,b,d,e)},createSelections:function(a,b,c,d){var e=this.selectionService.createSelections(b,c,d);return a.setSelections(e),e},init:function(a,b,c){this.$scope=a,this.$element=b,this.selectionService=c;var d=this,e=this.view=this.create(a,b,a.ext.View,a.options,a.ext.options.selections,a.backendApi);e.initialize(),this.handleSpecialCaseForSyntaxSugarInExtension(e),a.$on("$destroy",function(){e&&(e.destroy(e),d.$scope.options=null,d.view=null,e=null)})},handleSpecialCaseForSyntaxSugarInExtension:function(a){var b,c=this.$scope.object.ext;for(b in c)"View"!==b&&"constructor"!==b&&"options"!==b&&a[b]&&(a[b]=c[b])},onPaint:function(a){this.view&&(this.view.suppressOnPaint(this.$scope.layout)||(this.view.refreshSelections(),a?(this.view.prePaint(this.$scope.layout),this.view.updateData(this.$scope.layout),this.view.paint(this.view.$element,this.$scope.layout)):this.view.updateData(this.$scope.layout)))},onResize:function(){this.view.refreshSelections(),this.view.resize(this.view.$element,this.$scope.layout)},onStateChanged:function(a){this.view.allowInteraction(a)?this.view.on():this.view.off(),this.view.onStateChanged(a)},setBackendApi:function(a){this.view.setBackendApi(a)},setSnapshotData:function(a){return this.view.setSnapshotData(a)},getContextMenu:function(a,b){return this.view.getContextMenu(a,b)},getSelectionToolbar:function(){return this.view.getSelectionToolbar()},allowInteraction:function(a){return this.view.allowInteraction(a)},setInteraction:function(a){this.view.setInteraction(a)}}),b.$inject=["$scope","$element","qvDefaultViewSelectionService"],b}),define("objects.extension/qv-extension",["qvangular","objects.extension/controller"],function(a,b){a.directive("qvExtension",function(){return{require:["qvExtension","^qvObject"],controller:b,link:function(a,b,c,d){var e=d[0],f=d[1];f.addChildController(e)}}})}),define("objects.extension/extension-type",["jquery","core.utils/class","general.utils/property-mapper","objects.extension/default-extension","util","qvangular","core.utils/deferred","objects.models/visualization-object","objects.extension/default-view","objects/inline-title-edit","objects.extension/qv-extension"],function(a,b,c,d,e,f,g,h,i){function j(a,b){var c=e.extend(!0,{},d,b);return c.libraryInfo=a.getLibraryInfo(),c}function k(a){var b,c=a.path;return s[c]||(b=g(),require([c],function(c){f.$rootScope.$apply(function(){b.resolve(j(a,c))})},function(a){b.reject(a)}),s[c]=b.promise),s[c]}function l(a){return"[object Object]"===Object.prototype.toString.call(a)}function m(a){var b="";switch(a.toLowerCase()){case"listbox":b="Object.Listbox";break;case"barchart":b="Object.BarChart";break;case"combochart":b="Object.ComboChart";break;case"filterpane":b="Object.FilterPane";break;case"gauge":b="Object.Gauge";break;case"kpi":b="Object.Kpi";break;case"linechart":b="Object.LineChart";break;case"piechart":b="Object.PieChart";break;case"pivot-table":b="Object.PivotTable";break;case"scatterplot":b="Object.ScatterPlot";break;case"table":b="Object.Table";break;case"treemap":b="Object.Treemap";break;case"text-image":b="Object.TextImage";break;case"sheet":b="Common.Sheet";break;case"objectlibrary":b="Object.ObjectLibrary";break;case"libraryobject":b="Object.LibraryObject";break;case"map":b="Object.Map";break;default:b=""}return b}function n(a){switch(a.toLowerCase()){case"barchart":return"bar-chart-vertical";case"linechart":return"line-chart";case"table":return"table";case"pivot-table":return"pivot-table";case"components":return"components";case"piechart":return"pie-chart";case"filterpane":return"filterpane";case"listbox":return"list";case"gauge":return"gauge-chart";case"kpi":return"kpi";case"scatterplot":return"scatter-chart";case"text-image":return"text-image";case"treemap":return"treemap";case"map":return"map";case"combochart":return"combo-chart";default:return"extension"}}function o(a){return"icon-"+n(a)}function p(a){if(!a)return"icon-extension";switch(a.toLowerCase()){case"bar-chart-vertical":return"icon-bar-chart-vertical";case"line-chart":return"icon-line-chart";case"table":return"icon-table";case"pivot-table":return"icon-pivot-table";case"components":return"icon-components";case"pie-chart":return"icon-pie-chart";case"filterpane":return"icon-filterpane";case"list":return"icon-list";case"gauge-chart":return"icon-gauge-chart";case"kpi":return"icon-kpi";case"scatter-chart":return"icon-scatter-chart";case"text-image":return"icon-text-image";case"text":return"icon-titletext";case"map":return"icon-map";case"combo-chart":return"icon-combo-chart";default:return"icon-extension"}}function q(a){var b=0!==a.indexOf("listbox");return{name:a,descriptionKey:"Template.preview.description."+a,translationKey:m(a),template:a,templateIconClassName:o(a),icon:n(a),isLibraryItem:b}}var r,s={};f.componentDirective("qvaIncludeObject",{model:"=",ext:"=",options:"="});var t={"bar-chart-vertical":"!","line-chart":"%","pie-chart":"&",list:"-",table:"'","pivot-table":"(",filterpane:".","scatter-chart":"+","text-image":"/","gauge-chart":")",kpi:"1",treemap:"",map:",","combo-chart":"","":"E"};return r=b.extend("ExtensionType",{init:function(a,b,c){this.type=b,this.path=a,this.libraryInfo=c||q(b),this.libraryInfo.templateIconClassName||(this.libraryInfo.templateIconClassName=p(this.libraryInfo.icon))},getLibraryInfo:function(){return this.libraryInfo},getTemplateIconClassName:function(){return this.libraryInfo.templateIconClassName},getIconChar:function(){return t[this.libraryInfo.icon]?t[this.libraryInfo.icon]:"g"},getModelCtor:function(){return k(this).then(function(a){return a.Model})},getInitialProperties:function(a){var b=this;return k(b).then(function(d){var f=e.extend(!0,{qInfo:{qType:b.type},visualization:b.type},d.initialProperties,a);return c.mapProperties(d.definition,f,b.type)})["catch"](function(){return{qInfo:{qType:b.type},visualization:b.type}})},load:function(){return k(this).then(function(a){var b;if(a.View)for(b in i)i.hasOwnProperty(b);return l(a.view)&&(a.View=i.extend(a.view)),void 0===a.View&&(a.View=i),e.extend(!0,{},a)})},getExtensionType:function(){return k(this)}}),r.addObject=function(b,c,d){var e=new g;return require(["objects/object"],function(){var g=a(b);g.html('<qv-object model="model" options="options"></qv-object>');var i=f.$rootScope.$new(),j=h.get(c,d);j.then(function(a){i.model=a,i.options={};var b=f.getService("$compile");b(g.contents())(i),f.$apply(i),e.resolve(j)},function(a){e.reject(a)})}),e.promise},r}),define("objects.utils/type-loader",["core.utils/deferred","general.utils/visualizations","objects.extension/extension-type","general.models/library/extension-list"],function(a,b,c,d){function e(a,b){return b=b||{},b.previewIconURL||b.preview&&b.preview.indexOf(".png")>0&&(b.previewIconURL="../extensions/"+a+"/"+b.preview),b.icon=b.icon||"extension",b.description=b.description||b.name,b.template=b.template||a,b.isLibraryItem=b.isLibraryItem||!0,b.name=b.name||b.template||a,b}function f(){return null===g&&(g=new a,b.registerType("listbox",new c("extensions.qliktech/listbox/listbox","listbox")),b.registerType("filterpane",new c("extensions.qliktech/filterpane/filterpane","filterpane")),b.registerType("gauge",new c("extensions.qliktech/gauge/gauge","gauge")),b.registerType("kpi",new c("extensions.qliktech/kpi/kpi","kpi")),b.registerType("table",new c("extensions.qliktech/straight-table/straight-table","table")),b.registerType("pivot-table",new c("extensions.qliktech/pivot-table/pivot-table","pivot-table")),b.registerType("barchart",new c("extensions.qliktech/barchart/barchart","barchart")),b.registerType("piechart",new c("extensions.qliktech/piechart/piechart","piechart")),b.registerType("scatterplot",new c("extensions.qliktech/scatterplot/scatterplot","scatterplot")),b.registerType("linechart",new c("extensions.qliktech/linechart/linechart","linechart")),b.registerType("combochart",new c("extensions.qliktech/combochart/combochart","combochart")),b.registerType("treemap",new c("extensions.qliktech/treemap/treemap","treemap")),b.registerType("map",new c("extensions.qliktech/map/map","map")),b.registerType("text-image",new c("extensions.qliktech/text-image/text-image","text-image")),d.getList().then(function(a){a.forEach(function(a){a.data&&"visualization"===a.data.type&&b.registerType(a.id,new c("extensions/"+a.id+"/"+a.id,a.id,e(a.id,a.data)))
}),g.resolve()})),g.promise}var g=null;return{load:f}}),define("text!objects/object.ng.html",[],function(){return'<article class="qv-object qvt-visualization" ng-class="classList" qva-activate="takeSnapshot($event)" tid="{{objectClass}}">\r\n\r\n	<qv-rain ng-if="object.throbberApi.isVisible" show="object.throbberApi.isVisible" resize="object.throbberApi.watchResize"></qv-rain>\r\n\r\n	<div class="retry-overlay" ng-if="object.throbberApi.isQueryCanceled">\r\n		<ul class="cancelled-list">\r\n			<li>\r\n				<div class="retry-text" q-translation="Object.Cancelled"></div>\r\n			</li>\r\n			<li>\r\n				<button class="retry-button qui-outlinebutton"  qva-activate="retry()" q-translation="Dialog.Button.Retry" tid="retry-calculations"></button>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n	<div class="cancel-overlay" ng-if="object.throbberApi.isLongRunningQuery">\r\n		<button class="cancel-button qui-outlinebutton" ng-if="!object.throbberApi.isQueryCanceled" qva-activate="cancel()"\r\n				q-translation="Common.Cancel" tid="cancel-calculations"></button>\r\n	</div>\r\n\r\n	<button ng-if="showSnapshotCount" class="snapshotcounter qui-iconbt" qva-activate="openSnapshotLibrary($event, \'snapshot\')">\r\n		<i class="icon-snapshot"></i><span>{{snapshotCount}}</span>\r\n	</button>\r\n\r\n	<header ng-show="object.hasFrame && object.showTitles">\r\n		<h1 ng-attr-title="{{layout.title}}" class="qv-object-title qvt-visualization-title" qva-activate="titleClicked();">\r\n			<a ng-if="!editmode && options.showSearch && !inlineEdit" q-title-translation="Common.Search" class="qv-object-search icon-magnifying-glass"\r\n				qva-activate="options.showSearch && options.search.toggle()"></a>\r\n			<span ng-if="!inlineEdit" qve-highlight text="{{layout.title}}" query="options.highlightQuery"></span>\r\n			<span ng-if="options.showDisclaimerStar && !!layout.title && !inlineEdit">*</span>\r\n			<div ng-if="inlineEdit" qv-inline-title-edit x-model="model" x-property-path="title" x-layout-path="title"\r\n				 x-empty-translation="Object.AddTitle"></div>\r\n		</h1>\r\n\r\n		<h2 ng-show="!!layout.subtitle" class="qv-object-subtitle qvt-visualization-subtitle">{{layout.subtitle}}</h2>\r\n	</header>\r\n	<div class="qv-object-content-container">\r\n		<div class="qv-object-content" qv-object-content component="object.content" options="options" object="object" backend-api="object.backendApi" layout="layout"\r\n			 ext="object.ext" selections-api="object.selectionsApi" throbber-api="object.throbberApi">\r\n		</div>\r\n	</div>\r\n	<footer ng-show="object.hasFrame && object.showTitles && !!layout.footnote" class="qv-object-footnote qvt-visualization-footnote">{{layout.footnote}}</footer>\r\n</article>\r\n'}),define("text!objects.requirements/requirements.ng.html",[],function(){return'<div qv-requirements class="requirements-wrapper" ng-show="show" ng-class="{\'incomplete\': !showAdd}">\r\n	<div class="requirements">\r\n		<h2 class="header">\r\n			<i class="object-icon" ng-class="iconClass"></i>\r\n		</h2>\r\n	<p class="incomplete-text" ng-if="!showAdd" q-translation="Visualization.Requirements.IncompleteVisualization"></p>\r\n		<!-- finished dimensions -->\r\n	<ul ng-if="showAdd && finishedDimensions.length">\r\n		<li ng-repeat="dimension in finishedDimensions" class="item" ng-class="{ finished: !dimension.invalid, invalid: dimension.invalid }"\r\n			tid="{{ dimension.invalid ? \'invalid-dimension\' : \'added-dimension\'}}">\r\n			<span class="text" title="{{dimension.title}}">{{dimension.title}}</span>\r\n			<i class="icon-cancel" qva-activate="removeDimension($index)" q-title-translation="Common.Delete"></i>\r\n			</li>\r\n		</ul>\r\n		<!-- unfinished dimensions -->\r\n	<ul ng-if="showAdd && unfinishedDimensions.length">\r\n		<li ng-repeat="d in unfinishedDimensions" class="item missing" tid="missing-dimension">\r\n			<button class="add-button qui-outlinebutton" ng-class="{ \'qui-active\': d.active }" qva-activate="showAddDimension($event,d)"\r\n					q-translation="Visualization.Requirements.AddDimension" tid="add-dimension"></button>\r\n			</li>\r\n		</ul>\r\n		<!-- finished measures -->\r\n	<ul ng-if="showAdd && finishedMeasures.length">\r\n		<li ng-repeat="measure in finishedMeasures" class="item" ng-class="{ finished: !measure.invalid, invalid: measure.invalid }"\r\n			tid="{{ measure.invalid ? \'invalid-measure\' : \'added-measure\'}}">\r\n			<span class="text" title="{{measure.title}}">{{measure.title}}</span>\r\n			<i class="icon-cancel" qva-activate="removeMeasure($index)" q-title-translation="Common.Delete"></i>\r\n			</li>\r\n		</ul>\r\n		<!-- unfinished measures -->\r\n	<ul ng-if="showAdd && unfinishedMeasures.length">\r\n		<li ng-repeat="m in unfinishedMeasures" class="item missing" tid="missing-measure">\r\n			<button class="add-button qui-outlinebutton" ng-class="{ \'qui-active\': m.active }" qva-activate="showAddMeasure($event,m)"\r\n					q-translation="Visualization.Requirements.AddMeasure" tid="add-measure"></button>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n</div>\r\n'}),define("objects.error-handling/error-translation",["autogenerated/qix/engine-enums","translator"],function(a,b){function c(a,b){switch(a){case d.LOCERR_CALC_INVALID_DEF:return b?"Object.ErrorMessage.InvalidDimension":"Object.ErrorMessage.InvalidMeasure";case d.LOCERR_CALC_NOT_IN_LIB:return b?"Object.ErrorMessage.MissingDimension":"Object.ErrorMessage.MissingMeasure";case d.LOCERR_CALC_HEAP_ERROR:return"Object.ErrorMessage.HeapError";case d.LOCERR_CALC_TOO_LARGE:return"Object.ErrorMessage.CalcTooLarge";case d.LOCERR_CALC_TIMEOUT:return"Object.ErrorMessage.CalcTimeout";case d.LOCERR_DIRECT_DISCOVERY_LINKED_EXPRESSION_FAIL:return"Object.ErrorMessage.DirectDiscoveryLinkedExpressionFail";case d.LOCERR_DIRECT_DISCOVERY_ROWCOUNT_OVERFLOW:return"Object.ErrorMessage.DirectDiscoveryRowcountOverflow";case d.LOCERR_DIRECT_DISCOVERY_EMPTY_RESULT:return"Object.ErrorMessage.DirectDiscoveryEmptyResult";case d.LOCERR_DIRECT_DISCOVERY_DB_CONNECTION_FAILED:return"Object.ErrorMessage.DirectDiscoveryBDConnectionFailed";case d.LOCERR_DIRECT_DISCOVERY_MEASURE_NOT_ALLOWED:return"Object.ErrorMessage.DirectDiscoveryMeasureNotAllowed";case d.LOCERR_DIRECT_DISCOVERY_DETAIL_NOT_ALLOWED:return"Object.ErrorMessage.DirectDiscoveryDetailNotAllowed";case d.LOCERR_CALC_PIVOT_DIMENSIONS_ALREADY_EXISTS:return"Object.ErrorMessage.DimensionExists";case d.LOCERR_GENERIC_UNKNOWN:return"Object.ErrorMessage.Unknown";default:return"Object.ErrorMessage.Unknown"}}var d=a.NxLocalizedErrorCode;return{getDimensionError:function(a,d){var e=c(a,!0);return d?b.get(e):e},getMeasureError:function(a,d){var e=c(a);return d?b.get(e):e},getHyperCubeError:function(a,d){var e=c(a);return d?b.get(e):e},getListObjectError:function(a,d){var e=c(a);return d?b.get(e):e},get:function(a){return b.get(a)}}}),define("text!objects.add-popovers/add-dimension-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)">\r\n	<object-add-typeahead>\r\n		<div class="object-add-popover-header">\r\n			<div class="qui-inputwithicon">\r\n				<input type="text" name="new-dimension" autocomplete="off" ng-model="search.term" tid="add-dimension-input" qva-focus="autoFocus"\r\n					   object-add-typeahead-input on-escape="onEscape($event)" on-enter="onEnter($event)" maxlength="255"/>\r\n				<i class="icon-expression edit-expression" q-title-translation="Tooltip.AddExpression" qva-activate="closeAddPopover()"\r\n				   pp-expression-editor="search.term" pp-expression-editor-on-apply="addFieldDimension({value:value})" expression-type="dimension"></i>\r\n			</div>\r\n		</div>\r\n		<div class="object-add-popover-content" object-add-typeahead-menu>\r\n			<div class="object-add-popover-list-header" ng-if="dimensions.length" q-translation="Common.Dimensions"></div>\r\n			<ul class="object-add-popover-list qui-list">\r\n				<li class="object-add-popover-list-item qui-list-item" ng-repeat="dimension in dimensions"  tid="dimension-item"\r\n						object-add-typeahead-item="dimension" on-select="addLibraryDimension(dimension)">\r\n					<span qve-highlight text="{{dimension.label}}" query="search.term" class="list-item-text"></span>\r\n				</li>\r\n			</ul>\r\n			<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Common.Fields"></div>\r\n			<ul class="object-add-popover-list qui-list">\r\n			    <li class="object-add-popover-list-item qui-list-item" ng-repeat="field in fields" tid="field-item"\r\n			        object-add-typeahead-item="field" on-select="addFieldDimension(field)">\r\n                    <i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery icon" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\r\n                    <span qve-highlight text="{{field.label}}" query="search.term" ng-class="{ \'name-with-icon\': isDirectDiscoveryField( field ) }" class="list-item-text"></span>\r\n			    </li>\r\n			</ul>\r\n			<div class="object-add-popover-nohits" ng-if="!dimensions.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\r\n		</div>\r\n	</object-add-typeahead>\r\n</immidiate-contextual>'}),define("text!objects.add-popovers/object-add-typeahead.ng.html",[],function(){return"<div ng-transclude></div>"}),define("general.services/aligner/aligner",[],function(){function a(a){this.container=a.container,this.body=a.body,this.alignAgainst=a.alignAgainst}return a.prototype.showTranscluded=function(a){a(function(a){this.container.appendTo(this.body).append(a)}.bind(this))},a.prototype.showContent=function(a){this.container.appendTo(this.body).append(a)},a.prototype.update=function(){var a=this.alignAgainst.offset();this.container.css({top:a.top,left:a.left,width:this.alignAgainst.width(),height:this.alignAgainst.height(),zIndex:1021})},a.prototype.hide=function(){this.container.remove()},a}),define("objects.add-popovers/object-add-typeahead",["qvangular","text!./object-add-typeahead.ng.html","general.services/aligner/aligner"],function(a,b){a.directive("objectAddTypeahead",[function(){return{template:b,scope:{},transclude:!0,replace:!0,restrict:"E",controller:["$scope",function(a){function b(){var b=a.menu;if(a.activeItem){var c=a.activeItem,d=c.getPosition();d.top<0?b.setScrollTop(c.getOffsetTop()):d.top+c.getHeight()>b.getHeight()&&c.scrollIntoView(!1)}else b.setScrollTop(0)}var c=this;a.items=[],this.activate=function(b){a.activeItem=b},this.nextItem=function(d){var e=a.items.indexOf(a.activeItem);"undefined"!=typeof d&&(e=(e+d)%a.items.length),c.activate(e===a.items.length-1?null:-1===e?a.items[0]:a.items[e+1]),b()},this.prevItem=function(d){var e=a.items.indexOf(a.activeItem);"undefined"!=typeof d&&(e=(e-d+a.items.length)%a.items.length),c.activate(0===e?null:-1===e?a.items[a.items.length-1]:a.items[e-1]),b()},this.getActiveItem=function(){return a.activeItem},this.selectActiveItem=function(){a.activeItem&&a.activeItem.select()},this.select=function(b){a.select({item:b}),a.activeItem=null},this.setMenu=function(b){a.menu=b},this.addItem=function(b){a.items.push(b)},this.removeItem=function(b){var c=a.items.indexOf(b);c>=0&&a.items.splice(c,1)}}]}}]),a.directive("objectAddTypeaheadInput",[function(){return{require:["^objectAddTypeahead","ngModel"],link:function(a,b,c,d){var e=d[0],f=d[1];b.on("keydown",function(b){b.stopPropagation(),13===b.which||9===b.which?(b.preventDefault(),a.$apply(e.getActiveItem()?function(){e.selectActiveItem()}:function(){a.$eval(c.onEnter,{$event:b})})):33===b.which?(b.preventDefault(),a.$apply(function(){e.prevItem(10)})):34===b.which?(b.preventDefault(),a.$apply(function(){e.nextItem(10)})):40===b.which?(b.preventDefault(),a.$apply(function(){e.nextItem()})):38===b.which?(b.preventDefault(),a.$apply(function(){e.prevItem()})):27===b.which&&(b.preventDefault(),a.$apply(function(){a.$eval(c.onEscape,{$event:b})}))}),a.$watch(e.getActiveItem,function(a){a?a.item.label&&b.val(a.item.label):b.val(f.$modelValue)}),a.$watch(f.$modelValue,function(a){a||e.activate(null)})}}}]),a.directive("objectAddTypeaheadMenu",[function(){return{require:"^objectAddTypeahead",link:function(a,b,c,d){a.controller=d,d.setMenu({getHeight:function(){return b.height()},setScrollTop:function(a){b[0].scrollTop=a}})}}}]),a.directive("objectAddTypeaheadItem",[function(){return{require:"^objectAddTypeahead",link:function(a,b,c,d){function e(){a.$eval(c.onSelect,{item:f})}var f=a.$eval(c.objectAddTypeaheadItem),g={item:f,getOffsetTop:function(){return b[0].offsetTop},scrollIntoView:function(a){b[0].scrollIntoView(a)},getPosition:function(){return b.position()},getHeight:function(){return b.height()},select:function(){e()}};d.addItem(g),a.$on("$destroy",function(){d.removeItem(g)}),a.$watch(function(){var a=d.getActiveItem();return a?a.item===f:!1},function(a){a?b.addClass("object-add-typeahead-active"):b.removeClass("object-add-typeahead-active")}),b.on("mouseenter",function(){b.addClass("object-add-typeahead-hover")}),b.on("mouseleave",function(){b.removeClass("object-add-typeahead-hover")}),b.on("qv-activate",function(b){b.preventDefault(),a.$apply(function(){e()})})}}}])}),define("objects.add-popovers/add-dimension-popover",["core.utils/deferred","general.utils/string-normalization","general.utils/array-util","general.utils/support","objects.utils/data-properties/library-utils","text!objects.add-popovers/add-dimension-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(a,b,c,d,e,f,g){function h(a,c){return""===c?a:a.filter(function(a){return"undefined"==typeof a.value?!1:b.string(a.value.toLowerCase()).indexOf(b.string(c.toLowerCase()))>-1})}var i=100,j={template:f,controller:["$scope",function(b){b.search={term:""},b.isDirectDiscoveryField=g.isDirectDiscoveryField,b.getDirectDiscoveryTypeTranslationKey=g.getTypeTranslationKey,b.autoFocus=d.treatAsDesktop(),b.position||(b.position="right"),b.onEscape=function(a){""!==b.search.term?(a.stopPropagation(),b.search.term=""):b.closeAddPopover()},b.onEnter=function(a){""!==b.search.term?(a.stopPropagation(),b.addFieldDimension({value:b.search.term})):b.closeAddPopover()};var f=null;b.$watch("search.term",function(d){function g(){var a=h(f.fields,d),e=h(f.dimensions,d);e.length>i?(e=c.limit(e,i),a=[]):a.length+e.length>i&&(a=c.limit(a,i-e.length)),b.fields=a,b.dimensions=e}f?g():a.all({fields:e.getSortedFields(),dimensions:e.getSortedDimensions()}).then(function(a){var b=a.fields.map(function(a){return{label:a.qName,value:a.qName,qTags:a.qTags}}),c=a.dimensions.map(function(a){return{label:a.qData.title,value:a.qData.title,libraryId:a.qInfo.qId}});f={fields:b,dimensions:c},g()})})}],scope:{alignTo:"=",addFieldDimension:"=",addLibraryDimension:"=",closeAddPopover:"=",position:"="}};return j}),define("text!objects.add-popovers/add-measure-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)">\r\n	<div class="object-add-popover" ng-show="!step2">\r\n		<object-add-typeahead>\r\n			<div class="object-add-popover-header">\r\n				<div class="qui-inputwithicon">\r\n					<input type="text" name="new-measure" autocomplete="off" ng-model="search.term" tid="add-measure-input" qva-focus="autoFocus"\r\n						maxlength="255" object-add-typeahead-input on-escape="onEscape($event)" on-enter="onEnter($event)"/>\r\n					<i class="icon-expression edit-expression" q-title-translation="Tooltip.AddExpression" qva-activate="closeAddPopover()"\r\n					   pp-expression-editor="search.term" pp-expression-editor-on-apply="addExpressionMeasure({value:value})" expression-type="measure"></i>\r\n				</div>\r\n			</div>\r\n			<div class="object-add-popover-content" object-add-typeahead-menu>\r\n				<div class="object-add-popover-list-header" ng-if="measures.length" q-translation="Common.Measures"></div>\r\n				<ul class="object-add-popover-list qui-list">\r\n					<li class="object-add-popover-list-item qui-list-item" ng-repeat="measure in measures" tid="measure-item"\r\n							object-add-typeahead-item="measure" on-select="addLibraryMeasure(measure)">\r\n						<span qve-highlight text="{{measure.value}}" query="search.term" class="list-item-text"></span>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Visualization.Requirements.FromField"></div>\r\n				<ul class="object-add-popover-list qui-list">\r\n				    <li class="object-add-popover-list-item qui-list-item steppable" ng-repeat="field in fields" tid="field-item"\r\n				        object-add-typeahead-item="field" on-select="showFromField(field)">\r\n                        <i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery icon" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\r\n                        <span qve-highlight text="{{field.value}}" query="search.term" ng-class="{ \'name-with-icon\': isDirectDiscoveryField( field ) }" class="list-item-text"></span>\r\n				        <i class="toggle-step2 icon-triangle-right"></i>\r\n				    </li>\r\n				</ul>\r\n				<div class="object-add-popover-nohits" ng-if="!measures.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\r\n			</div>\r\n		</object-add-typeahead>\r\n	</div>\r\n	<div class="object-add-popover back" ng-show="step2">\r\n		<div class="object-add-popover-header">\r\n			<div qva-activate="goBack($event);">\r\n				<i class="icon-triangle-left"></i>\r\n				<span q-translation="Visualization.Requirements.Back"></span>\r\n			</div>\r\n		</div>\r\n		<div class="object-add-popover-content">\r\n			<div class="object-add-popover-list-header" q-translation="Visualization.Requirements.Aggregation"></div>\r\n            <ul class="object-add-popover-list qui-list">\r\n                <li class="object-add-popover-list-item qui-list-item" ng-repeat="suggestion in fieldSuggestions" qva-activate="addFromField(suggestion)" tid="from-field-item">\r\n                    <span class="list-item-text">{{suggestion.aggregation}}({{suggestion.field}})</span>\r\n                </li>\r\n            </ul>\r\n		</div>\r\n	</div>\r\n</immidiate-contextual>'}),define("objects.add-popovers/add-measure-popover",["core.utils/deferred","general.utils/string-normalization","util","general.utils/array-util","general.utils/support","objects.utils/data-properties/library-utils","text!objects.add-popovers/add-measure-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(a,b,c,d,e,f,g,h){function i(a,c){return""===c?a:a.filter(function(a){return"undefined"==typeof a.value?!1:b.string(a.value.toLowerCase()).indexOf(b.string(c.toLowerCase()))>-1})}var j=100,k={template:g,controller:["$scope",function(b){b.search={term:""},b.isDirectDiscoveryField=h.isDirectDiscoveryField,b.getDirectDiscoveryTypeTranslationKey=h.getTypeTranslationKey,b.autoFocus=e.treatAsDesktop(),b.position||(b.position="right"),b.onEscape=function(a){""!==b.search.term?(a.stopPropagation(),b.search.term=""):b.closeAddPopover()},b.onEnter=function(a){""!==b.search.term?(a.stopPropagation(),b.addExpressionMeasure({value:b.search.term})):b.closeAddPopover()},b.showFromField=function(a){b.currentField=a,b.step2=!0},b.goBack=function(a){a.preventDefault(),b.currentField=null,b.step2=!1},b.$watch("currentField",function(a){b.fieldSuggestions=a?["Sum","Count","Avg","Min","Max"].map(function(a){var d=c.escapeField(b.currentField.value);return{aggregation:a,field:d}}):[]}),b.addFromField=function(a){var c=a.aggregation+"("+a.field+")";b.addExpressionMeasure({value:c})};var g=null;b.$watch("search.term",function(c){function e(){var a=i(g.measures,c),e=i(g.fields,c);a.length>j?(a=d.limit(a,j),e=[]):a.length+e.length>j&&(e=d.limit(e,j-a.length)),b.fields=e,b.measures=a}g?e():a.all({fields:f.getSortedFields(),measures:f.getSortedMeasures()}).then(function(a){var b=a.fields.map(function(a){return{value:a.qName,label:a.qName,field:a.qName,qTags:a.qTags}}),c=a.measures.map(function(a){return{value:a.qData.title,label:a.qData.title,libraryId:a.qInfo.qId}});g={fields:b,measures:c},e()})})}],scope:{alignTo:"=",addExpressionMeasure:"=",addLibraryMeasure:"=",closeAddPopover:"=",position:"="}};return k}),define("objects.requirements/requirements",["jquery","qvangular","text!./requirements.ng.html","client.utils/state","general.services/show-service/show-service","objects.extension/base-controller","objects.error-handling/error-translation","core.utils/resize","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover"],function(a,b,c,d,e,f,g,h,i,j){function k(a){var b,c=new Array(a);for(b=0;a>b;++b)c[b]={index:b};return c}function l(a){if(a.qHyperCube)return a.qHyperCube.qDimensionInfo||[];if(a.qChildList){var b=a.qChildList.qItems||[];return b.map(function(){return{}})}var c=!a.qListObject||!a.qListObject.qDimensionInfo||a.qListObject.qDimensionInfo.qError;return c?[]:[a.qListObject.qDimensionInfo]}function m(a){return a.qHyperCube?a.qHyperCube.qMeasureInfo||[]:[]}function n(a){a.showAdd=d.isInEditMode()&&!a.object.isReadonly}var o,p=null;return o=f.extend({$scope:null,init:function(b){function c(){n(b)}function f(a){return b.object.ext.addFieldDimension(a,b.object).then(function(){b.object.model.save(),m()})}function g(a){return b.object.ext.addLibraryDimension(a,b.object).then(function(){b.object.model.save(),m()})}function k(a){return b.object.ext.addLibraryMeasure(a,b.object).then(function(){b.object.model.save(),m()})}function l(a){return b.object.ext.addExpressionMeasure(a,b.object).then(function(){b.object.model.save(),m()})}function m(b){o&&(o.destroy(),o=null),p&&(p.active=!1),b&&!a(b.target).hasClass("add-button")&&(p=null)}this.$scope=b,d.StateChanged.bind(c),b.$on("$destroy",function(){d.StateChanged.unbind(c)}),c(),b.removeDimension=function(a){b.object.model.getProperties().then(function(c){var d=b.ext.getCreatePropertyHandler();d.setProperties(c),d.removeDimension(a).then(function(){b.object.model.save()})})},b.removeMeasure=function(a){b.object.model.getProperties().then(function(c){var d=b.ext.getCreatePropertyHandler();d.setProperties(c),d.removeMeasure(a).then(function(){b.object.model.save()})})};var o;b.showAddDimension=function(c,d){if(p&&p===d)return void(p=null);var h=b.ext.addDimensionPopoverComponent||i;o=e.show(h,{alignTo:a(c.target),closeAddPopover:m,addFieldDimension:f,addLibraryDimension:g}),d.active=!0,p=d},b.showAddMeasure=function(c,d){if(p&&p===d)return void(p=null);var f=b.ext.addMeasurePopoverComponent||j;o=e.show(f,{alignTo:a(c.target),closeAddPopover:m,addLibraryMeasure:k,addExpressionMeasure:l}),d.active=!0,p=d},h.on("start",m),b.$on("$destroy",function(){h.off("start",m),m()})},onPaint:function(){var a,b,c=this.$scope,d=c.layout,e=c.ext.dimensionDefinition?c.ext.dimensionDefinition.min:0,f=c.ext.dimensionDefinition?c.ext.dimensionDefinition.max:0,h=c.ext.measureDefinition?c.ext.measureDefinition.min:0,i=c.ext.measureDefinition?c.ext.measureDefinition.max:0;n(c),c.iconClass=c.object.ext.libraryInfo.templateIconClassName,c.minDimensions=e,c.minMeasures=h,c.maxDimensions=f,c.maxMeasures=i,c.headerStr=e!==f||h!==i?"Visualization.Requirements.AddAtLeast":"Visualization.Requirements.Add",a=l(d).map(function(a){var b,c=a.qError&&a.qError.qErrorCode;return b=c?g.getDimensionError(c,!0):a.title||a.qFallbackTitle,{invalid:!!c,title:b}}),b=m(d).map(function(a){var b,c=a.qError&&a.qError.qErrorCode;return b=c?g.getMeasureError(c,!0):a.qFallbackTitle,{invalid:!!c,title:b}}),c.finishedDimensions=a,c.finishedMeasures=b,c.unfinishedDimensions=k(Math.max(0,c.minDimensions-c.finishedDimensions.length)),c.unfinishedMeasures=k(Math.max(0,c.minMeasures-c.finishedMeasures.length)),c.show=!0}}),o.$inject=["$scope"],b.directive("qvRequirements",function(){return{controller:o,require:["qvRequirements","^qvObject"],link:function(a,b,c,d){var e=d[0],f=d[1];f.addChildController(e)}}}),{template:c,controller:o}}),define("text!objects.error-handling/error-info-popup.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" width="150" position="\'top\'" collision="\'collision\'" class="qui-immidiateContextual" on-close-view="onClose(event)">\r\n	<div class="object-error-popup">\r\n		<span q-translation="{{errorMessage}}"></span>\r\n	</div>\r\n</immidiate-contextual>'}),define("objects.error-handling/error-info-popup",["text!objects.error-handling/error-info-popup.ng.html","core.utils/resize"],function(a,b){return{template:a,controller:["$scope",function(a){function c(){a.onClose()}a.$on("$destroy",function(){b.off("start",c)}),b.on("start",c)}]}}),define("text!objects.error-handling/error.ng.html",[],function(){return'<div qv-errorhandler class="object-error">\r\n	<div class="object-error-content">\r\n		<div class="object-error-title">\r\n			<span q-translation="Object.Error"></span>\r\n			<i class="object-error-more icon-info" qva-activate="showMore($event)"></i>\r\n		</div>\r\n		<div class="object-error-message" q-translation="{{errorMessage}}"></div>\r\n	</div>\r\n</div>\r\n'}),define("objects.error-handling/error-handler",["qvangular","angular","touche","./error-info-popup","text!./error.ng.html","objects.extension/base-controller","objects.error-handling/error-translation"],function(a,b,c,d,e,f,g){var h=f.extend({$scope:null,init:function(a){this.$scope=a,a.showMore=function(e){var f=b.element("<div>").appendTo("body");f.showComponent(d,{alignTo:b.element(e.target),errorMessage:a.errorMessage,onClose:function(){f.remove(),c.preventGestures()}})}},onPaint:function(){var a=this.$scope;if(a.object.errorMessage)return void(a.errorMessage=a.object.errorMessage);var b=a.layout;b.qHyperCube?b.qHyperCube.qError&&(a.errorMessage=g.getHyperCubeError(b.qHyperCube.qError.qErrorCode)):b.qListObject&&(b.qListObject.qError?a.errorMessage=g.getListObjectError(b.qListObject.qError.qErrorCode):b.qListObject.qDimensionInfo&&b.qListObject.qDimensionInfo.qError.qErrorCode&&(a.errorMessage=g.getDimensionError(b.qListObject.qDimensionInfo.qError.qErrorCode)))}});return h.$inject=["$scope"],a.directive("qvErrorhandler",function(){return{controller:h,require:["qvErrorhandler","^qvObject"],link:function(a,b,c,d){var e=d[0],f=d[1];f.addChildController(e)}}}),{template:e,controller:h}}),define("text!storytelling.views/library/library.ng.html",[],function(){return'<immidiate-contextual class="story-library-popover"\r\n					  ng-class="{snapshot: snapshots}"\r\n					  ng-if="currentLibrary"\r\n					  ng-show="showLib"\r\n					  width="230"\r\n					  align-to="libraryButton"\r\n					  position="libraryPosition()"\r\n					  limits="limits"\r\n					  on-close-view="closePopover(event)">\r\n\r\n	<div class="qv-story-library-header" q-translation="{{currentLibrary.translation}}"></div>\r\n	<div story-library-draggable class="qv-story-library-content"\r\n		 ng-class="{\'story-mini-library\': showMiniLibrary,\r\n					\'qv-snapshot-library\': snapshots,\r\n					\'qv-text-library\': texts,\r\n					\'qv-shape-library\': shapes,\r\n					\'qv-effect-library\': effects,\r\n					\'qv-medias-library\': mediaTypes}">\r\n\r\n		<!-- SNPSHOTS UDING CATEGORIES -->\r\n		<div ng-if="snapshots">\r\n			<ul class="qv-expandable-list">\r\n				<li ng-repeat="category in categories | orderBy:\'rank\'" class="expandable-item ng-scope" ng-class="{ \'empty\': category.isEmpty }">\r\n\r\n					<div class="qv-expandable-list-header"\r\n						 qva-activate="expandClicked(category)"\r\n						 ng-if="!category.isEmpty"\r\n						 ng-class="{ \'expanded\': category.expanded }">\r\n							 <i ng-class="{ \'icon-triangle-right\' : !category.expanded, \'icon-triangle-bottom\': category.expanded }"></i>\r\n							 <div class="text ng-binding" q-translation="{{ category.translate }}"></div>\r\n					</div>\r\n\r\n						<ul class="qui-icontextlist"\r\n							ng-if="category.expanded"\r\n							ng-class="{ \'expanded\': category.expanded }">\r\n\r\n							<li ng-repeat="snapshot in snapshots | orderBy:\'qData.timestamp\':true | filterDate:this"\r\n								ng-class="{ \'qv-draggable\': !inEdit && !showMiniLibrary, \'edit\': inEdit }"\r\n								class="qv-story-library-item snapshot">\r\n\r\n									<div ng-show="isEmpty" class="snapshot-empty" q-translation="Storytelling.library.noSnapshots"></div>\r\n\r\n									<!-- CHECKBOX TO TIC SNAPSHOT FOR REMOVE -->\r\n									<label ng-if="inEdit"\r\n										ng-disabled="!snapshot.permissions.remove"\r\n										class="snapshot-checkbox qui-checkboxicon">\r\n											<input type="checkbox"\r\n											ng-disabled="!snapshot.permissions.remove"\r\n											ng-model="checkboxTicked"\r\n											ng-change="onCheckboxClick()" />\r\n												<div class="check-wrap">\r\n											<span class="check"></span>\r\n										</div>\r\n									</label>\r\n									<span\r\n										class="snapshot-icon icon-{{ getIconClass( snapshot.qData.visualizationType ) }}">\r\n									</span>\r\n									<story-items-library-snapshot edit="inEdit" snapshot="snapshot" />\r\n							</li>\r\n						</ul>\r\n\r\n				</li>\r\n			</ul>\r\n		</div>\r\n\r\n\r\n		<ul class="qui-icontextlist">\r\n			<li ng-repeat="text in texts" ng-class="text.textType" class="qv-story-library-item qv-draggable">\r\n				<span\r\n					class="text-{{text.textType}}"\r\n					q-translation="{{text.title}}">\r\n				</span>\r\n			</li>\r\n\r\n			<li ng-repeat="shape in shapes" class="qv-story-library-item shape qv-draggable">\r\n				<img\r\n					onmousedown="if (event.preventDefault) event.preventDefault()"\r\n					draggable="false"\r\n					ng-src="{{shape.src}}" />\r\n			</li>\r\n\r\n			<li ng-repeat="effect in effects" class="qv-story-library-item qv-story-library-effect qv-draggable">\r\n				<span class="effect-icon {{effect.iconClass}}">\r\n				</span>\r\n				<p\r\n					class="effect-title"\r\n					q-translation="{{effect.title}}">\r\n				</p>\r\n			</li>\r\n\r\n			<li ng-repeat="media in mediaTypes" class="qv-story-library-item media qv-draggable">\r\n				<span class="media-icon {{media.iconClass}}"></span>\r\n				<p class="media-title" q-translation="{{media.title}}"></p>\r\n			</li>\r\n		</ul>\r\n\r\n\r\n		<div ng-show="empty" class="snapshot-empty" q-translation="Storytelling.library.noSnapshots"></div>\r\n\r\n	</div>\r\n\r\n	<!-- LIBRARY FOOTER -->\r\n	<div class="qv-story-library-footer">\r\n		<div ng-hide="snapshots.length < 1 || inEdit">\r\n			<button\r\n				ng-show="editable"\r\n				class="qv-story-library-footer-edit qui-iconbt"\r\n				data-icon="toolbar-edit"\r\n				qva-activate="enterEdit()"\r\n				q-title-translation="Common.Edit">\r\n			</button>\r\n		</div>\r\n		<div ng-if="inEdit && !empty">\r\n			<button\r\n				ng-show="isAnyTicked"\r\n				class="delete qv-story-library-delete-btn qui-button"\r\n				data-icon="bin"\r\n				qva-activate="deleteSnapshots()"\r\n				q-title-translation="Common.Delete">\r\n			</button>\r\n			<button\r\n				class="done qv-story-library-done-btn qui-button"\r\n				qva-activate="leaveEdit()"\r\n				q-title-translation="Common.Done">\r\n				<span q-translation="Common.Done"></span>\r\n			</button>\r\n		</div>\r\n	</div>\r\n</immidiate-contextual>'}),define("text!storytelling.views/library/library-snapshot-info.ng.html",[],function(){return'<div class="snapshot-info">\r\n	<p class="snapshot-title"\r\n		ng-class="{ \'edit\': edit }"\r\n		ng-show="!editingTitle"\r\n		qva-activate="enterEdit( snapshot.permissions.update ) && edit"\r\n		q-translation="{{snapshot.qData.libraryTitle.length > 0 ? snapshot.qData.libraryTitle : \'Storytelling.snapshot.Untitled\'}}">\r\n	</p>\r\n	<p class="snapshot-title"\r\n		ng-if="editingTitle"\r\n		ng-class="{ \'editing-title\': editingTitle }">\r\n		<input type="text" qva-outside="leaveEdit()" qva-focus="editingTitle" class="snapshot-title-input" maxlength="255" rows="1" ng-model="snapshot.qData.libraryTitle"/>\r\n	</p>\r\n	<p class="snapshot-date">{{ formattedTimestamp }}</p>\r\n</div>'
}),define("storytelling.utils/storytelling-data",["jquery"],function(){var a={},b=[{title:"Storytelling.library.effect.highlightMax",supportedVisualizations:["piechart","linechart","barchart"],effectPath:"/effects/maxmin",iconClass:"effect-max",effectProperties:{max:!0,min:!1},restraints:{}},{title:"Storytelling.library.effect.highlightMin",supportedVisualizations:["piechart","linechart","barchart"],effectPath:"/effects/maxmin",iconClass:"effect-min",effectProperties:{max:!1,min:!0},restraints:{}},{title:"Storytelling.library.effect.highlightValue",supportedVisualizations:["piechart","linechart","barchart"],effectPath:"/effects/highlight-value",iconClass:"effect-highlight",effectProperties:{selectedIndex:0},restraints:{}}],c=[{title:"Common.Title",cssClass:"qv-story-library-text-title",textType:"title",drag:"disable",maintainRatio:!0},{title:"Storytelling.library.paragraph",cssClass:"qv-story-library-text-paragraph",textType:"paragraph",drag:"enable",maintainRatio:!1}],d=[{shape:"square",src:"../resources/img/storytelling/shapes/square.svg",maintainRatio:!1},{shape:"square_rounded",src:"../resources/img/storytelling/shapes/square_rounded.svg",maintainRatio:!1},{shape:"circle",src:"../resources/img/storytelling/shapes/circle.svg",maintainRatio:!1},{shape:"disc",src:"../resources/img/storytelling/shapes/disc.svg",maintainRatio:!1},{shape:"arrow_d",src:"../resources/img/storytelling/shapes/arrow_d.svg",maintainRatio:!1},{shape:"arrow_l",src:"../resources/img/storytelling/shapes/arrow_l.svg",maintainRatio:!1},{shape:"arrow_r",src:"../resources/img/storytelling/shapes/arrow_r.svg",maintainRatio:!1},{shape:"arrow_u",src:"../resources/img/storytelling/shapes/arrow_u.svg",maintainRatio:!1},{shape:"pullout_b",src:"../resources/img/storytelling/shapes/pullout_b.svg",maintainRatio:!1},{shape:"pullout_l",src:"../resources/img/storytelling/shapes/pullout_l.svg",maintainRatio:!1},{shape:"pullout_r",src:"../resources/img/storytelling/shapes/pullout_r.svg",maintainRatio:!1},{shape:"pullout_t",src:"../resources/img/storytelling/shapes/pullout_t.svg",maintainRatio:!1},{shape:"tri1",src:"../resources/img/storytelling/shapes/tri1.svg",maintainRatio:!1},{shape:"tri2",src:"../resources/img/storytelling/shapes/tri2.svg",maintainRatio:!1},{shape:"tri3",src:"../resources/img/storytelling/shapes/tri3.svg",maintainRatio:!1},{shape:"tri4",src:"../resources/img/storytelling/shapes/tri4.svg",maintainRatio:!1},{shape:"2lines_h",src:"../resources/img/storytelling/shapes/2lines_h.svg",maintainRatio:!1},{shape:"2lines_v",src:"../resources/img/storytelling/shapes/2lines_v.svg",maintainRatio:!1},{shape:"plane",src:"../resources/img/storytelling/shapes/plane.svg",maintainRatio:!0},{shape:"bus",src:"../resources/img/storytelling/shapes/bus.svg",maintainRatio:!0},{shape:"car",src:"../resources/img/storytelling/shapes/car.svg",maintainRatio:!0},{shape:"train",src:"../resources/img/storytelling/shapes/train.svg",maintainRatio:!0},{shape:"dollar",src:"../resources/img/storytelling/shapes/dollar.svg",maintainRatio:!0},{shape:"euro",src:"../resources/img/storytelling/shapes/euro.svg",maintainRatio:!0},{shape:"pound",src:"../resources/img/storytelling/shapes/pound.svg",maintainRatio:!0},{shape:"yen",src:"../resources/img/storytelling/shapes/yen.svg",maintainRatio:!0},{shape:"flag",src:"../resources/img/storytelling/shapes/flag.svg",maintainRatio:!0},{shape:"globe",src:"../resources/img/storytelling/shapes/globe.svg",maintainRatio:!0},{shape:"tree",src:"../resources/img/storytelling/shapes/tree.svg",maintainRatio:!0},{shape:"cloud",src:"../resources/img/storytelling/shapes/cloud.svg",maintainRatio:!0},{shape:"lightbulb",src:"../resources/img/storytelling/shapes/lightbulb.svg",maintainRatio:!0},{shape:"clock",src:"../resources/img/storytelling/shapes/clock.svg",maintainRatio:!0},{shape:"man",src:"../resources/img/storytelling/shapes/man.svg",maintainRatio:!0},{shape:"woman",src:"../resources/img/storytelling/shapes/woman.svg",maintainRatio:!0},{shape:"running_man",src:"../resources/img/storytelling/shapes/running_man.svg",maintainRatio:!0},{shape:"star",src:"../resources/img/storytelling/shapes/star.svg",maintainRatio:!0},{shape:"tick",src:"../resources/img/storytelling/shapes/tick.svg",maintainRatio:!0},{shape:"cross",src:"../resources/img/storytelling/shapes/cross.svg",maintainRatio:!0},{shape:"banned",src:"../resources/img/storytelling/shapes/banned.svg",maintainRatio:!0}],e=[{title:"Common.Image",cssClass:"image-icon",iconClass:"image-icon",src:null,maintainRatio:!0}],f=[{expanded:!0,name:"today",translate:"Storytelling.library.category.today",isEmpty:!1,rank:1},{expanded:!0,name:"thisweek",translate:"Storytelling.library.category.thisweek",isEmpty:!1,rank:2},{expanded:!0,name:"older",translate:"Storytelling.library.category.older",isEmpty:!1,rank:3}];return{currentStory:a,textTemplates:c,effectTemplates:b,shapeTemplates:d,mediaTemplates:e,timeCategories:f}}),//! moment.js
//! version : 2.4.0
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
function(a){function b(a,b){return function(c){return i(a.call(this,c),b)}}function c(a,b){return function(c){return this.lang().ordinal(a.call(this,c),b)}}function d(){}function e(a){u(a),g(this,a)}function f(a){var b=o(a),c=b.year||0,d=b.month||0,e=b.week||0,f=b.day||0,g=b.hour||0,h=b.minute||0,i=b.second||0,j=b.millisecond||0;this._input=a,this._milliseconds=+j+1e3*i+6e4*h+36e5*g,this._days=+f+7*e,this._months=+d+12*c,this._data={},this._bubble()}function g(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return b.hasOwnProperty("toString")&&(a.toString=b.toString),b.hasOwnProperty("valueOf")&&(a.valueOf=b.valueOf),a}function h(a){return 0>a?Math.ceil(a):Math.floor(a)}function i(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}function j(a,b,c,d){var e,f,g=b._milliseconds,h=b._days,i=b._months;g&&a._d.setTime(+a._d+g*c),(h||i)&&(e=a.minute(),f=a.hour()),h&&a.date(a.date()+h*c),i&&a.month(a.month()+i*c),g&&!d&&bb.updateOffset(a),(h||i)&&(a.minute(e),a.hour(f))}function k(a){return"[object Array]"===Object.prototype.toString.call(a)}function l(a){return"[object Date]"===Object.prototype.toString.call(a)||a instanceof Date}function m(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&q(a[d])!==q(b[d]))&&g++;return g+f}function n(a){if(a){var b=a.toLowerCase().replace(/(.)s$/,"$1");a=Kb[a]||Lb[b]||b}return a}function o(a){var b,c,d={};for(c in a)a.hasOwnProperty(c)&&(b=n(c),b&&(d[b]=a[c]));return d}function p(b){var c,d;if(0===b.indexOf("week"))c=7,d="day";else{if(0!==b.indexOf("month"))return;c=12,d="month"}bb[b]=function(e,f){var g,h,i=bb.fn._lang[b],j=[];if("number"==typeof e&&(f=e,e=a),h=function(a){var b=bb().utc().set(d,a);return i.call(bb.fn._lang,b,e||"")},null!=f)return h(f);for(g=0;c>g;g++)j.push(h(g));return j}}function q(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=b>=0?Math.floor(b):Math.ceil(b)),c}function r(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function s(a){return t(a)?366:365}function t(a){return a%4===0&&a%100!==0||a%400===0}function u(a){var b;a._a&&-2===a._pf.overflow&&(b=a._a[gb]<0||a._a[gb]>11?gb:a._a[hb]<1||a._a[hb]>r(a._a[fb],a._a[gb])?hb:a._a[ib]<0||a._a[ib]>23?ib:a._a[jb]<0||a._a[jb]>59?jb:a._a[kb]<0||a._a[kb]>59?kb:a._a[lb]<0||a._a[lb]>999?lb:-1,a._pf._overflowDayOfYear&&(fb>b||b>hb)&&(b=hb),a._pf.overflow=b)}function v(a){a._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function w(a){return null==a._isValid&&(a._isValid=!isNaN(a._d.getTime())&&a._pf.overflow<0&&!a._pf.empty&&!a._pf.invalidMonth&&!a._pf.nullInput&&!a._pf.invalidFormat&&!a._pf.userInvalidated,a._strict&&(a._isValid=a._isValid&&0===a._pf.charsLeftOver&&0===a._pf.unusedTokens.length)),a._isValid}function x(a){return a?a.toLowerCase().replace("_","-"):a}function y(a,b){return b.abbr=a,mb[a]||(mb[a]=new d),mb[a].set(b),mb[a]}function z(a){delete mb[a]}function A(a){var b,c,d,e,f=0,g=function(a){if(!mb[a]&&nb)try{require("./lang/"+a)}catch(b){}return mb[a]};if(!a)return bb.fn._lang;if(!k(a)){if(c=g(a))return c;a=[a]}for(;f<a.length;){for(e=x(a[f]).split("-"),b=e.length,d=x(a[f+1]),d=d?d.split("-"):null;b>0;){if(c=g(e.slice(0,b).join("-")))return c;if(d&&d.length>=b&&m(e,d,!0)>=b-1)break;b--}f++}return bb.fn._lang}function B(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function C(a){var b,c,d=a.match(rb);for(b=0,c=d.length;c>b;b++)d[b]=Pb[d[b]]?Pb[d[b]]:B(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function D(a,b){return a.isValid()?(b=E(b,a.lang()),Mb[b]||(Mb[b]=C(b)),Mb[b](a)):a.lang().invalidDate()}function E(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(sb.lastIndex=0;d>=0&&sb.test(a);)a=a.replace(sb,c),sb.lastIndex=0,d-=1;return a}function F(a,b){var c;switch(a){case"DDDD":return vb;case"YYYY":case"GGGG":case"gggg":return wb;case"YYYYY":case"GGGGG":case"ggggg":return xb;case"S":case"SS":case"SSS":case"DDD":return ub;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return zb;case"a":case"A":return A(b._l)._meridiemParse;case"X":return Cb;case"Z":case"ZZ":return Ab;case"T":return Bb;case"SSSS":return yb;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"ww":case"W":case"WW":case"e":case"E":return tb;default:return c=new RegExp(N(M(a.replace("\\","")),"i"))}}function G(a){var b=(Ab.exec(a)||[])[0],c=(b+"").match(Hb)||["-",0,0],d=+(60*c[1])+q(c[2]);return"+"===c[0]?-d:d}function H(a,b,c){var d,e=c._a;switch(a){case"M":case"MM":null!=b&&(e[gb]=q(b)-1);break;case"MMM":case"MMMM":d=A(c._l).monthsParse(b),null!=d?e[gb]=d:c._pf.invalidMonth=b;break;case"D":case"DD":null!=b&&(e[hb]=q(b));break;case"DDD":case"DDDD":null!=b&&(c._dayOfYear=q(b));break;case"YY":e[fb]=q(b)+(q(b)>68?1900:2e3);break;case"YYYY":case"YYYYY":e[fb]=q(b);break;case"a":case"A":c._isPm=A(c._l).isPM(b);break;case"H":case"HH":case"h":case"hh":e[ib]=q(b);break;case"m":case"mm":e[jb]=q(b);break;case"s":case"ss":e[kb]=q(b);break;case"S":case"SS":case"SSS":case"SSSS":e[lb]=q(1e3*("0."+b));break;case"X":c._d=new Date(1e3*parseFloat(b));break;case"Z":case"ZZ":c._useUTC=!0,c._tzm=G(b);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":a=a.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":a=a.substr(0,2),b&&(c._w=c._w||{},c._w[a]=b)}}function I(a){var b,c,d,e,f,g,h,i,j,k,l=[];if(!a._d){for(d=K(a),a._w&&null==a._a[hb]&&null==a._a[gb]&&(f=function(b){return b?b.length<3?parseInt(b,10)>68?"19"+b:"20"+b:b:null==a._a[fb]?bb().weekYear():a._a[fb]},g=a._w,null!=g.GG||null!=g.W||null!=g.E?h=X(f(g.GG),g.W||1,g.E,4,1):(i=A(a._l),j=null!=g.d?T(g.d,i):null!=g.e?parseInt(g.e,10)+i._week.dow:0,k=parseInt(g.w,10)||1,null!=g.d&&j<i._week.dow&&k++,h=X(f(g.gg),k,j,i._week.doy,i._week.dow)),a._a[fb]=h.year,a._dayOfYear=h.dayOfYear),a._dayOfYear&&(e=null==a._a[fb]?d[fb]:a._a[fb],a._dayOfYear>s(e)&&(a._pf._overflowDayOfYear=!0),c=S(e,0,a._dayOfYear),a._a[gb]=c.getUTCMonth(),a._a[hb]=c.getUTCDate()),b=0;3>b&&null==a._a[b];++b)a._a[b]=l[b]=d[b];for(;7>b;b++)a._a[b]=l[b]=null==a._a[b]?2===b?1:0:a._a[b];l[ib]+=q((a._tzm||0)/60),l[jb]+=q((a._tzm||0)%60),a._d=(a._useUTC?S:R).apply(null,l)}}function J(a){var b;a._d||(b=o(a._i),a._a=[b.year,b.month,b.day,b.hour,b.minute,b.second,b.millisecond],I(a))}function K(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function L(a){a._a=[],a._pf.empty=!0;var b,c,d,e,f,g=A(a._l),h=""+a._i,i=h.length,j=0;for(d=E(a._f,g).match(rb)||[],b=0;b<d.length;b++)e=d[b],c=(F(e,a).exec(h)||[])[0],c&&(f=h.substr(0,h.indexOf(c)),f.length>0&&a._pf.unusedInput.push(f),h=h.slice(h.indexOf(c)+c.length),j+=c.length),Pb[e]?(c?a._pf.empty=!1:a._pf.unusedTokens.push(e),H(e,c,a)):a._strict&&!c&&a._pf.unusedTokens.push(e);a._pf.charsLeftOver=i-j,h.length>0&&a._pf.unusedInput.push(h),a._isPm&&a._a[ib]<12&&(a._a[ib]+=12),a._isPm===!1&&12===a._a[ib]&&(a._a[ib]=0),I(a),u(a)}function M(a){return a.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e})}function N(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function O(a){var b,c,d,e,f;if(0===a._f.length)return a._pf.invalidFormat=!0,void(a._d=new Date(0/0));for(e=0;e<a._f.length;e++)f=0,b=g({},a),v(b),b._f=a._f[e],L(b),w(b)&&(f+=b._pf.charsLeftOver,f+=10*b._pf.unusedTokens.length,b._pf.score=f,(null==d||d>f)&&(d=f,c=b));g(a,c||b)}function P(a){var b,c=a._i,d=Db.exec(c);if(d){for(a._pf.iso=!0,b=4;b>0;b--)if(d[b]){a._f=Fb[b-1]+(d[6]||" ");break}for(b=0;4>b;b++)if(Gb[b][1].exec(c)){a._f+=Gb[b][0];break}Ab.exec(c)&&(a._f+="Z"),L(a)}else a._d=new Date(c)}function Q(b){var c=b._i,d=ob.exec(c);c===a?b._d=new Date:d?b._d=new Date(+d[1]):"string"==typeof c?P(b):k(c)?(b._a=c.slice(0),I(b)):l(c)?b._d=new Date(+c):"object"==typeof c?J(b):b._d=new Date(c)}function R(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function S(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function T(a,b){if("string"==typeof a)if(isNaN(a)){if(a=b.weekdaysParse(a),"number"!=typeof a)return null}else a=parseInt(a,10);return a}function U(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function V(a,b,c){var d=eb(Math.abs(a)/1e3),e=eb(d/60),f=eb(e/60),g=eb(f/24),h=eb(g/365),i=45>d&&["s",d]||1===e&&["m"]||45>e&&["mm",e]||1===f&&["h"]||22>f&&["hh",f]||1===g&&["d"]||25>=g&&["dd",g]||45>=g&&["M"]||345>g&&["MM",eb(g/30)]||1===h&&["y"]||["yy",h];return i[2]=b,i[3]=a>0,i[4]=c,U.apply({},i)}function W(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=bb(a).add("d",f),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function X(a,b,c,d,e){var f,g,h=new Date(Date.UTC(a,0)).getUTCDay();return c=null!=c?c:e,f=e-h+(h>d?7:0),g=7*(b-1)+(c-e)+f+1,{year:g>0?a:a-1,dayOfYear:g>0?g:s(a-1)+g}}function Y(a){var b=a._i,c=a._f;return"undefined"==typeof a._pf&&v(a),null===b?bb.invalid({nullInput:!0}):("string"==typeof b&&(a._i=b=A().preparse(b)),bb.isMoment(b)?(a=g({},b),a._d=new Date(+b._d)):c?k(c)?O(a):L(a):Q(a),new e(a))}function Z(a,b){bb.fn[a]=bb.fn[a+"s"]=function(a){var c=this._isUTC?"UTC":"";return null!=a?(this._d["set"+c+b](a),bb.updateOffset(this),this):this._d["get"+c+b]()}}function $(a){bb.duration.fn[a]=function(){return this._data[a]}}function _(a,b){bb.duration.fn["as"+a]=function(){return+this/b}}function ab(a){var b=!1,c=bb;"undefined"==typeof ender&&(this.moment=a?function(){return!b&&console&&console.warn&&(b=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),c.apply(null,arguments)}:bb)}for(var bb,cb,db="2.4.0",eb=Math.round,fb=0,gb=1,hb=2,ib=3,jb=4,kb=5,lb=6,mb={},nb="undefined"!=typeof module&&module.exports,ob=/^\/?Date\((\-?\d+)/i,pb=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,qb=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,rb=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,sb=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,tb=/\d\d?/,ub=/\d{1,3}/,vb=/\d{3}/,wb=/\d{1,4}/,xb=/[+\-]?\d{1,6}/,yb=/\d+/,zb=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Ab=/Z|[\+\-]\d\d:?\d\d/i,Bb=/T/i,Cb=/[\+\-]?\d+(\.\d{1,3})?/,Db=/^\s*\d{4}-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d:?\d\d|Z)?)?$/,Eb="YYYY-MM-DDTHH:mm:ssZ",Fb=["YYYY-MM-DD","GGGG-[W]WW","GGGG-[W]WW-E","YYYY-DDD"],Gb=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Hb=/([\+\-]|\d\d)/gi,Ib="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),Jb={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},Kb={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},Lb={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},Mb={},Nb="DDD w W M D d".split(" "),Ob="M D H h m s w W".split(" "),Pb={M:function(){return this.month()+1},MMM:function(a){return this.lang().monthsShort(this,a)},MMMM:function(a){return this.lang().months(this,a)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a){return this.lang().weekdaysMin(this,a)},ddd:function(a){return this.lang().weekdaysShort(this,a)},dddd:function(a){return this.lang().weekdays(this,a)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return i(this.year()%100,2)},YYYY:function(){return i(this.year(),4)},YYYYY:function(){return i(this.year(),5)},gg:function(){return i(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return i(this.weekYear(),5)},GG:function(){return i(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return i(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return q(this.milliseconds()/100)},SS:function(){return i(q(this.milliseconds()/10),2)},SSS:function(){return i(this.milliseconds(),3)},SSSS:function(){return i(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+i(q(a/60),2)+":"+i(q(a)%60,2)},ZZ:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+i(q(10*a/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}},Qb=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];Nb.length;)cb=Nb.pop(),Pb[cb+"o"]=c(Pb[cb],cb);for(;Ob.length;)cb=Ob.pop(),Pb[cb+cb]=b(Pb[cb],2);for(Pb.DDDD=b(Pb.DDD,3),g(d.prototype,{set:function(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(a){return this._months[a.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(a){return this._monthsShort[a.month()]},monthsParse:function(a){var b,c,d;for(this._monthsParse||(this._monthsParse=[]),b=0;12>b;b++)if(this._monthsParse[b]||(c=bb.utc([2e3,b]),d="^"+this.months(c,"")+"|^"+this.monthsShort(c,""),this._monthsParse[b]=new RegExp(d.replace(".",""),"i")),this._monthsParse[b].test(a))return b},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(a){return this._weekdays[a.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(a){return this._weekdaysShort[a.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(a){return this._weekdaysMin[a.day()]},weekdaysParse:function(a){var b,c,d;for(this._weekdaysParse||(this._weekdaysParse=[]),b=0;7>b;b++)if(this._weekdaysParse[b]||(c=bb([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(a){var b=this._longDateFormat[a];return!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a]=b),b},isPM:function(a){return"p"===(a+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(a,b){var c=this._calendar[a];return"function"==typeof c?c.apply(b):c},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)},pastFuture:function(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)},ordinal:function(a){return this._ordinal.replace("%d",a)},_ordinal:"%d",preparse:function(a){return a},postformat:function(a){return a},week:function(a){return W(a,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),bb=function(b,c,d,e){return"boolean"==typeof d&&(e=d,d=a),Y({_i:b,_f:c,_l:d,_strict:e,_isUTC:!1})},bb.utc=function(b,c,d,e){var f;return"boolean"==typeof d&&(e=d,d=a),f=Y({_useUTC:!0,_isUTC:!0,_l:d,_i:b,_f:c,_strict:e}).utc()},bb.unix=function(a){return bb(1e3*a)},bb.duration=function(a,b){var c,d,e,g=bb.isDuration(a),h="number"==typeof a,i=g?a._input:h?{}:a,j=null;return h?b?i[b]=a:i.milliseconds=a:(j=pb.exec(a))?(c="-"===j[1]?-1:1,i={y:0,d:q(j[hb])*c,h:q(j[ib])*c,m:q(j[jb])*c,s:q(j[kb])*c,ms:q(j[lb])*c}):(j=qb.exec(a))&&(c="-"===j[1]?-1:1,e=function(a){var b=a&&parseFloat(a.replace(",","."));return(isNaN(b)?0:b)*c},i={y:e(j[2]),M:e(j[3]),d:e(j[4]),h:e(j[5]),m:e(j[6]),s:e(j[7]),w:e(j[8])}),d=new f(i),g&&a.hasOwnProperty("_lang")&&(d._lang=a._lang),d},bb.version=db,bb.defaultFormat=Eb,bb.updateOffset=function(){},bb.lang=function(a,b){var c;return a?(b?y(x(a),b):null===b?(z(a),a="en"):mb[a]||A(a),c=bb.duration.fn._lang=bb.fn._lang=A(a),c._abbr):bb.fn._lang._abbr},bb.langData=function(a){return a&&a._lang&&a._lang._abbr&&(a=a._lang._abbr),A(a)},bb.isMoment=function(a){return a instanceof e},bb.isDuration=function(a){return a instanceof f},cb=Qb.length-1;cb>=0;--cb)p(Qb[cb]);for(bb.normalizeUnits=function(a){return n(a)},bb.invalid=function(a){var b=bb.utc(0/0);return null!=a?g(b._pf,a):b._pf.userInvalidated=!0,b},bb.parseZone=function(a){return bb(a).parseZone()},g(bb.fn=e.prototype,{clone:function(){return bb(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return D(bb(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds()]},isValid:function(){return w(this)},isDSTShifted:function(){return this._a?this.isValid()&&m(this._a,(this._isUTC?bb.utc(this._a):bb(this._a)).toArray())>0:!1},parsingFlags:function(){return g({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(a){var b=D(this,a||bb.defaultFormat);return this.lang().postformat(b)},add:function(a,b){var c;return c="string"==typeof a?bb.duration(+b,a):bb.duration(a,b),j(this,c,1),this},subtract:function(a,b){var c;return c="string"==typeof a?bb.duration(+b,a):bb.duration(a,b),j(this,c,-1),this},diff:function(a,b,c){var d,e,f=this._isUTC?bb(a).zone(this._offset||0):bb(a).local(),g=6e4*(this.zone()-f.zone());return b=n(b),"year"===b||"month"===b?(d=432e5*(this.daysInMonth()+f.daysInMonth()),e=12*(this.year()-f.year())+(this.month()-f.month()),e+=(this-bb(this).startOf("month")-(f-bb(f).startOf("month")))/d,e-=6e4*(this.zone()-bb(this).startOf("month").zone()-(f.zone()-bb(f).startOf("month").zone()))/d,"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:h(e)},from:function(a,b){return bb.duration(this.diff(a)).lang(this.lang()._abbr).humanize(!b)},fromNow:function(a){return this.from(bb(),a)},calendar:function(){var a=this.diff(bb().zone(this.zone()).startOf("day"),"days",!0),b=-6>a?"sameElse":-1>a?"lastWeek":0>a?"lastDay":1>a?"sameDay":2>a?"nextDay":7>a?"nextWeek":"sameElse";return this.format(this.lang().calendar(b,this))},isLeapYear:function(){return t(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=T(a,this.lang()),this.add({d:a-b})):b},month:function(a){var b,c=this._isUTC?"UTC":"";return null!=a?"string"==typeof a&&(a=this.lang().monthsParse(a),"number"!=typeof a)?this:(b=this.date(),this.date(1),this._d["set"+c+"Month"](a),this.date(Math.min(b,this.daysInMonth())),bb.updateOffset(this),this):this._d["get"+c+"Month"]()},startOf:function(a){switch(a=n(a)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a?this.weekday(0):"isoWeek"===a&&this.isoWeekday(1),this},endOf:function(a){return a=n(a),this.startOf(a).add("isoWeek"===a?"week":a,1).subtract("ms",1)},isAfter:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)>+bb(a).startOf(b)},isBefore:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)<+bb(a).startOf(b)},isSame:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)===+bb(a).startOf(b)},min:function(a){return a=bb.apply(null,arguments),this>a?this:a},max:function(a){return a=bb.apply(null,arguments),a>this?this:a},zone:function(a){var b=this._offset||0;return null==a?this._isUTC?b:this._d.getTimezoneOffset():("string"==typeof a&&(a=G(a)),Math.abs(a)<16&&(a=60*a),this._offset=a,this._isUTC=!0,b!==a&&j(this,bb.duration(b-a,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(a){return a=a?bb(a).zone():0,(this.zone()-a)%60===0},daysInMonth:function(){return r(this.year(),this.month())},dayOfYear:function(a){var b=eb((bb(this).startOf("day")-bb(this).startOf("year"))/864e5)+1;return null==a?b:this.add("d",a-b)},weekYear:function(a){var b=W(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==a?b:this.add("y",a-b)},isoWeekYear:function(a){var b=W(this,1,4).year;return null==a?b:this.add("y",a-b)},week:function(a){var b=this.lang().week(this);return null==a?b:this.add("d",7*(a-b))},isoWeek:function(a){var b=W(this,1,4).week;return null==a?b:this.add("d",7*(a-b))},weekday:function(a){var b=(this.day()+7-this.lang()._week.dow)%7;return null==a?b:this.add("d",a-b)},isoWeekday:function(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)},get:function(a){return a=n(a),this[a]()},set:function(a,b){return a=n(a),"function"==typeof this[a]&&this[a](b),this},lang:function(b){return b===a?this._lang:(this._lang=A(b),this)}}),cb=0;cb<Ib.length;cb++)Z(Ib[cb].toLowerCase().replace(/s$/,""),Ib[cb]);Z("year","FullYear"),bb.fn.days=bb.fn.day,bb.fn.months=bb.fn.month,bb.fn.weeks=bb.fn.week,bb.fn.isoWeeks=bb.fn.isoWeek,bb.fn.toJSON=bb.fn.toISOString,g(bb.duration.fn=f.prototype,{_bubble:function(){var a,b,c,d,e=this._milliseconds,f=this._days,g=this._months,i=this._data;i.milliseconds=e%1e3,a=h(e/1e3),i.seconds=a%60,b=h(a/60),i.minutes=b%60,c=h(b/60),i.hours=c%24,f+=h(c/24),i.days=f%30,g+=h(f/30),i.months=g%12,d=h(g/12),i.years=d},weeks:function(){return h(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*q(this._months/12)},humanize:function(a){var b=+this,c=V(b,!a,this.lang());return a&&(c=this.lang().pastFuture(b,c)),this.lang().postformat(c)},add:function(a,b){var c=bb.duration(a,b);return this._milliseconds+=c._milliseconds,this._days+=c._days,this._months+=c._months,this._bubble(),this},subtract:function(a,b){var c=bb.duration(a,b);return this._milliseconds-=c._milliseconds,this._days-=c._days,this._months-=c._months,this._bubble(),this},get:function(a){return a=n(a),this[a.toLowerCase()+"s"]()},as:function(a){return a=n(a),this["as"+a.charAt(0).toUpperCase()+a.slice(1)+"s"]()},lang:bb.fn.lang,toIsoString:function(){var a=Math.abs(this.years()),b=Math.abs(this.months()),c=Math.abs(this.days()),d=Math.abs(this.hours()),e=Math.abs(this.minutes()),f=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(a?a+"Y":"")+(b?b+"M":"")+(c?c+"D":"")+(d||e||f?"T":"")+(d?d+"H":"")+(e?e+"M":"")+(f?f+"S":""):"P0D"}});for(cb in Jb)Jb.hasOwnProperty(cb)&&(_(cb,Jb[cb]),$(cb.toLowerCase()));_("Weeks",6048e5),bb.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},bb.lang("en",{ordinal:function(a){var b=a%10,c=1===q(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),function(a){a(bb)}(function(a){return a.lang("ar-ma",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}),function(a){a(bb)}(function(a){return a.lang("ar",{months:"/  _/ _/ _/ _/ _/ _/ _/ _/ _/  _/  _/  ".split("_"),monthsShort:"/  _/ _/ _/ _/ _/ _/ _/ _/ _/  _/  _/  ".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}),function(a){a(bb)}(function(a){return a.lang("bg",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"H:mm",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:case 5:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinal:function(a){var b=a%10,c=a%100;return 0===a?a+"-":0===c?a+"-":c>10&&20>c?a+"-":1===b?a+"-":2===b?a+"-":7===b||8===b?a+"-":a+"-"},week:{dow:1,doy:7}})}),function(a){a(bb)}(function(b){function c(a,b,c){var d={mm:"munutenn",MM:"miz",dd:"devezh"};return a+" "+f(d[c],a)}function d(a){switch(e(a)){case 1:case 3:case 4:case 5:case 9:return a+" bloaz";default:return a+" vloaz"}}function e(a){return a>9?e(a%10):a}function f(a,b){return 2===b?g(a):a}function g(b){var c={m:"v",b:"v",d:"z"};return c[b.charAt(0)]===a?b:c[b.charAt(0)]+b.substring(1)}return b.lang("br",{months:"Genver_C'hwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),monthsShort:"Gen_C'hwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),weekdays:"Sul_Lun_Meurzh_Merc'her_Yaou_Gwener_Sadorn".split("_"),weekdaysShort:"Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),weekdaysMin:"Su_Lu_Me_Mer_Ya_Gw_Sa".split("_"),longDateFormat:{LT:"h[e]mm A",L:"DD/MM/YYYY",LL:"D [a viz] MMMM YYYY",LLL:"D [a viz] MMMM YYYY LT",LLLL:"dddd, D [a viz] MMMM YYYY LT"},calendar:{sameDay:"[Hiziv da] LT",nextDay:"[Warc'hoazh da] LT",nextWeek:"dddd [da] LT",lastDay:"[Dec'h da] LT",lastWeek:"dddd [paset da] LT",sameElse:"L"},relativeTime:{future:"a-benn %s",past:"%s 'zo",s:"un nebeud segondenno",m:"ur vunutenn",mm:c,h:"un eur",hh:"%d eur",d:"un devezh",dd:c,M:"ur miz",MM:c,y:"ur bloaz",yy:d},ordinal:function(a){var b=1===a?"a":"vet";return a+b},week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){function b(a,b,c){var d=a+" ";switch(c){case"m":return b?"jedna minuta":"jedne minute";case"mm":return d+=1===a?"minuta":2===a||3===a||4===a?"minute":"minuta";case"h":return b?"jedan sat":"jednog sata";case"hh":return d+=1===a?"sat":2===a||3===a||4===a?"sata":"sati";case"dd":return d+=1===a?"dan":"dana";case"MM":return d+=1===a?"mjesec":2===a||3===a||4===a?"mjeseca":"mjeseci";case"yy":return d+=1===a?"godina":2===a||3===a||4===a?"godine":"godina"}}return a.lang("bs",{months:"januar_februar_mart_april_maj_juni_juli_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",m:b,mm:b,h:b,hh:b,d:"dan",dd:b,M:"mjesec",MM:b,y:"godinu",yy:b},ordinal:"%d.",week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){return a.lang("ca",{months:"Gener_Febrer_Mar_Abril_Maig_Juny_Juliol_Agost_Setembre_Octubre_Novembre_Desembre".split("_"),monthsShort:"Gen._Febr._Mar._Abr._Mai._Jun._Jul._Ag._Set._Oct._Nov._Des.".split("_"),weekdays:"Diumenge_Dilluns_Dimarts_Dimecres_Dijous_Divendres_Dissabte".split("_"),weekdaysShort:"Dg._Dl._Dt._Dc._Dj._Dv._Ds.".split("_"),weekdaysMin:"Dg_Dl_Dt_Dc_Dj_Dv_Ds".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:function(){return"[avui a "+(1!==this.hours()?"les":"la")+"] LT"},nextDay:function(){return"[dem a "+(1!==this.hours()?"les":"la")+"] LT"},nextWeek:function(){return"dddd [a "+(1!==this.hours()?"les":"la")+"] LT"},lastDay:function(){return"[ahir a "+(1!==this.hours()?"les":"la")+"] LT"},lastWeek:function(){return"[el] dddd [passat a "+(1!==this.hours()?"les":"la")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"fa %s",s:"uns segons",m:"un minut",mm:"%d minuts",h:"una hora",hh:"%d hores",d:"un dia",dd:"%d dies",M:"un mes",MM:"%d mesos",y:"un any",yy:"%d anys"},ordinal:"%d",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){function b(a){return a>1&&5>a&&1!==~~(a/10)}function c(a,c,d,e){var f=a+" ";switch(d){case"s":return c||e?"pr vtein":"pr vteinami";case"m":return c?"minuta":e?"minutu":"minutou";case"mm":return c||e?f+(b(a)?"minuty":"minut"):f+"minutami";
case"h":return c?"hodina":e?"hodinu":"hodinou";case"hh":return c||e?f+(b(a)?"hodiny":"hodin"):f+"hodinami";case"d":return c||e?"den":"dnem";case"dd":return c||e?f+(b(a)?"dny":"dn"):f+"dny";case"M":return c||e?"msc":"mscem";case"MM":return c||e?f+(b(a)?"msce":"msc"):f+"msci";case"y":return c||e?"rok":"rokem";case"yy":return c||e?f+(b(a)?"roky":"let"):f+"lety"}}var d="leden_nor_bezen_duben_kvten_erven_ervenec_srpen_z_jen_listopad_prosinec".split("_"),e="led_no_be_dub_kv_vn_vc_srp_z_j_lis_pro".split("_");return a.lang("cs",{months:d,monthsShort:e,monthsParse:function(a,b){var c,d=[];for(c=0;12>c;c++)d[c]=new RegExp("^"+a[c]+"$|^"+b[c]+"$","i");return d}(d,e),weekdays:"nedle_pondl_ter_steda_tvrtek_ptek_sobota".split("_"),weekdaysShort:"ne_po_t_st_t_p_so".split("_"),weekdaysMin:"ne_po_t_st_t_p_so".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd D. MMMM YYYY LT"},calendar:{sameDay:"[dnes v] LT",nextDay:"[ztra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve stedu v] LT";case 4:return"[ve tvrtek v] LT";case 5:return"[v ptek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[vera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou nedli v] LT";case 1:case 2:return"[minul] dddd [v] LT";case 3:return"[minulou stedu v] LT";case 4:case 5:return"[minul] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"ped %s",s:c,m:c,mm:c,h:c,hh:c,d:c,dd:c,M:c,MM:c,y:c,yy:c},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("cv",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD-MM-YYYY",LL:"YYYY [] MMMM [] D[-]",LLL:"YYYY [] MMMM [] D[-], LT",LLLL:"dddd, YYYY [] MMMM [] D[-], LT"},calendar:{sameDay:"[] LT []",nextDay:"[] LT []",lastDay:"[] LT []",nextWeek:"[] dddd LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:function(a){var b=/$/i.exec(a)?"":/$/i.exec(a)?"":"";return a+b},past:"%s ",s:"- ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinal:"%d-",week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){return a.lang("cy",{months:"Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),monthsShort:"Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),weekdays:"Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),weekdaysShort:"Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),weekdaysMin:"Su_Ll_Ma_Me_Ia_Gw_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Heddiw am] LT",nextDay:"[Yfory am] LT",nextWeek:"dddd [am] LT",lastDay:"[Ddoe am] LT",lastWeek:"dddd [diwethaf am] LT",sameElse:"L"},relativeTime:{future:"mewn %s",past:"%s yn &#244;l",s:"ychydig eiliadau",m:"munud",mm:"%d munud",h:"awr",hh:"%d awr",d:"diwrnod",dd:"%d diwrnod",M:"mis",MM:"%d mis",y:"blwyddyn",yy:"%d flynedd"},ordinal:function(a){var b=a,c="",d=["","af","il","ydd","ydd","ed","ed","ed","fed","fed","fed","eg","fed","eg","eg","fed","eg","eg","fed","eg","fed"];return b>20?c=40===b||50===b||60===b||80===b||100===b?"fed":"ain":b>0&&(c=d[b]),a+c},week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_man_tir_ons_tor_fre_lr".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D. MMMM, YYYY LT"},calendar:{sameDay:"[I dag kl.] LT",nextDay:"[I morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[I gr kl.] LT",lastWeek:"[sidste] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"f sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en mned",MM:"%d mneder",y:"et r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){function b(a,b,c){var d={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[a+" Tage",a+" Tagen"],M:["ein Monat","einem Monat"],MM:[a+" Monate",a+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[a+" Jahre",a+" Jahren"]};return b?d[c][0]:d[c][1]}return a.lang("de",{months:"Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"H:mm [Uhr]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT",sameElse:"L",nextDay:"[Morgen um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gestern um] LT",lastWeek:"[letzten] dddd [um] LT"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:b,mm:"%d Minuten",h:b,hh:"%d Stunden",d:b,dd:b,M:b,MM:b,y:b,yy:b},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("el",{monthsNominativeEl:"___________".split("_"),monthsGenitiveEl:"___________".split("_"),months:function(a,b){return/D/.test(b.substring(0,b.indexOf("MMMM")))?this._monthsGenitiveEl[a.month()]:this._monthsNominativeEl[a.month()]},monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),meridiem:function(a,b,c){return a>11?c?"":"":c?"":""},longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendarEl:{sameDay:"[ {}] LT",nextDay:"[ {}] LT",nextWeek:"dddd [{}] LT",lastDay:"[ {}] LT",lastWeek:"[ ] dddd [{}] LT",sameElse:"L"},calendar:function(a,b){var c=this._calendarEl[a],d=b&&b.hours();return c.replace("{}",d%12===1?"":"")},relativeTime:{future:" %s",past:"%s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},ordinal:function(a){return a+""},week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10,c=1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c},week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"YYYY-MM-DD",LL:"D MMMM, YYYY",LLL:"D MMMM, YYYY LT",LLLL:"dddd, D MMMM, YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10,c=1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}})}),function(a){a(bb)}(function(a){return a.lang("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10,c=1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c},week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("eo",{months:"januaro_februaro_marto_aprilo_majo_junio_julio_agusto_septembro_oktobro_novembro_decembro".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_ag_sep_okt_nov_dec".split("_"),weekdays:"Dimano_Lundo_Mardo_Merkredo_ado_Vendredo_Sabato".split("_"),weekdaysShort:"Dim_Lun_Mard_Merk_a_Ven_Sab".split("_"),weekdaysMin:"Di_Lu_Ma_Me_a_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D[-an de] MMMM, YYYY",LLL:"D[-an de] MMMM, YYYY LT",LLLL:"dddd, [la] D[-an de] MMMM, YYYY LT"},meridiem:function(a,b,c){return a>11?c?"p.t.m.":"P.T.M.":c?"a.t.m.":"A.T.M."},calendar:{sameDay:"[Hodia je] LT",nextDay:"[Morga je] LT",nextWeek:"dddd [je] LT",lastDay:"[Hiera je] LT",lastWeek:"[pasinta] dddd [je] LT",sameElse:"L"},relativeTime:{future:"je %s",past:"anta %s",s:"sekundoj",m:"minuto",mm:"%d minutoj",h:"horo",hh:"%d horoj",d:"tago",dd:"%d tagoj",M:"monato",MM:"%d monatoj",y:"jaro",yy:"%d jaroj"},ordinal:"%da",week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){return a.lang("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:"ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"Do_Lu_Ma_Mi_Ju_Vi_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},ordinal:"%d",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){function b(a,b,c,d){return d||b?"paari sekundi":"paar sekundit"}return a.lang("et",{months:"jaanuar_veebruar_mrts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_mrts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"phapev_esmaspev_teisipev_kolmapev_neljapev_reede_laupev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Tna,] LT",nextDay:"[Homme,] LT",nextWeek:"[Jrgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s prast",past:"%s tagasi",s:b,m:"minut",mm:"%d minutit",h:"tund",hh:"%d tundi",d:"pev",dd:"%d peva",M:"kuu",MM:"%d kuud",y:"aasta",yy:"%d aastat"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("eu",{months:"urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),monthsShort:"urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),weekdays:"igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),weekdaysShort:"ig._al._ar._az._og._ol._lr.".split("_"),weekdaysMin:"ig_al_ar_az_og_ol_lr".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"YYYY[ko] MMMM[ren] D[a]",LLL:"YYYY[ko] MMMM[ren] D[a] LT",LLLL:"dddd, YYYY[ko] MMMM[ren] D[a] LT",l:"YYYY-M-D",ll:"YYYY[ko] MMM D[a]",lll:"YYYY[ko] MMM D[a] LT",llll:"ddd, YYYY[ko] MMM D[a] LT"},calendar:{sameDay:"[gaur] LT[etan]",nextDay:"[bihar] LT[etan]",nextWeek:"dddd LT[etan]",lastDay:"[atzo] LT[etan]",lastWeek:"[aurreko] dddd LT[etan]",sameElse:"L"},relativeTime:{future:"%s barru",past:"duela %s",s:"segundo batzuk",m:"minutu bat",mm:"%d minutu",h:"ordu bat",hh:"%d ordu",d:"egun bat",dd:"%d egun",M:"hilabete bat",MM:"%d hilabete",y:"urte bat",yy:"%d urte"},ordinal:"%d.",week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){var b={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},c={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return a.lang("fa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},meridiem:function(a){return 12>a?"  ":"  "},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(a){return a.replace(/[-]/g,function(a){return c[a]}).replace(//g,",")},postformat:function(a){return a.replace(/\d/g,function(a){return b[a]}).replace(/,/g,"")},ordinal:"%d",week:{dow:6,doy:12}})}),function(a){a(bb)}(function(a){function b(a,b,d,e){var f="";switch(d){case"s":return e?"muutaman sekunnin":"muutama sekunti";case"m":return e?"minuutin":"minuutti";case"mm":f=e?"minuutin":"minuuttia";break;case"h":return e?"tunnin":"tunti";case"hh":f=e?"tunnin":"tuntia";break;case"d":return e?"pivn":"piv";case"dd":f=e?"pivn":"piv";break;case"M":return e?"kuukauden":"kuukausi";case"MM":f=e?"kuukauden":"kuukautta";break;case"y":return e?"vuoden":"vuosi";case"yy":f=e?"vuoden":"vuotta"}return f=c(a,e)+" "+f}function c(a,b){return 10>a?b?e[a]:d[a]:a}var d="nolla yksi kaksi kolme nelj viisi kuusi seitsemn kahdeksan yhdeksn".split(" "),e=["nolla","yhden","kahden","kolmen","neljn","viiden","kuuden",d[7],d[8],d[9]];return a.lang("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_keskuu_heinkuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kes_hein_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] LT",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] LT",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] LT",llll:"ddd, Do MMM YYYY, [klo] LT"},calendar:{sameDay:"[tnn] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s pst",past:"%s sitten",s:b,m:b,mm:b,h:b,hh:b,d:b,dd:b,M:b,MM:b,y:b,yy:b},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("fo",{months:"januar_februar_mars_aprl_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sunnudagur_mnadagur_tsdagur_mikudagur_hsdagur_frggjadagur_leygardagur".split("_"),weekdaysShort:"sun_mn_ts_mik_hs_fr_ley".split("_"),weekdaysMin:"su_m_t_mi_h_fr_le".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D. MMMM, YYYY LT"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgin kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gjr kl.] LT",lastWeek:"[sstu] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"um %s",past:"%s sani",s:"f sekund",m:"ein minutt",mm:"%d minuttir",h:"ein tmi",hh:"%d tmar",d:"ein dagur",dd:"%d dagar",M:"ein mnai",MM:"%d mnair",y:"eitt r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("fr-ca",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinal:function(a){return a+(1===a?"er":"")}})}),function(a){a(bb)}(function(a){return a.lang("fr",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinal:function(a){return a+(1===a?"er":"")},week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("gl",{months:"Xaneiro_Febreiro_Marzo_Abril_Maio_Xuo_Xullo_Agosto_Setembro_Outubro_Novembro_Decembro".split("_"),monthsShort:"Xan._Feb._Mar._Abr._Mai._Xu._Xul._Ago._Set._Out._Nov._Dec.".split("_"),weekdays:"Domingo_Luns_Martes_Mrcores_Xoves_Venres_Sbado".split("_"),weekdaysShort:"Dom._Lun._Mar._Mr._Xov._Ven._Sb.".split("_"),weekdaysMin:"Do_Lu_Ma_M_Xo_Ve_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:function(){return"[hoxe "+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma "+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd ["+(1!==this.hours()?"s":"a")+"] LT"},lastDay:function(){return"[onte "+(1!==this.hours()?"":"a")+"] LT"},lastWeek:function(){return"[o] dddd [pasado "+(1!==this.hours()?"s":"a")+"] LT"},sameElse:"L"},relativeTime:{future:function(a){return"uns segundos"===a?"nuns segundos":"en "+a},past:"hai %s",s:"uns segundos",m:"un minuto",mm:"%d minutos",h:"unha hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ano",yy:"%d anos"},ordinal:"%d",week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){return a.lang("he",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D []MMMM YYYY",LLL:"D []MMMM YYYY LT",LLLL:"dddd, D []MMMM YYYY LT",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY LT",llll:"ddd, D MMM YYYY LT"},calendar:{sameDay:"[ ]LT",nextDay:"[ ]LT",nextWeek:"dddd [] LT",lastDay:"[ ]LT",lastWeek:"[] dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",m:"",mm:"%d ",h:"",hh:function(a){return 2===a?"":a+" "},d:"",dd:function(a){return 2===a?"":a+" "},M:"",MM:function(a){return 2===a?"":a+" "},y:"",yy:function(a){return 2===a?"":a+" "}}})}),function(a){a(bb)}(function(a){var b={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},c={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return a.lang("hi",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(a){return a.replace(/[]/g,function(a){return c[a]})},postformat:function(a){return a.replace(/\d/g,function(a){return b[a]})},meridiem:function(a){return 4>a?"":10>a?"":17>a?"":20>a?"":""},week:{dow:0,doy:6}})}),function(a){a(bb)}(function(a){function b(a,b,c){var d=a+" ";switch(c){case"m":return b?"jedna minuta":"jedne minute";case"mm":return d+=1===a?"minuta":2===a||3===a||4===a?"minute":"minuta";case"h":return b?"jedan sat":"jednog sata";case"hh":return d+=1===a?"sat":2===a||3===a||4===a?"sata":"sati";case"dd":return d+=1===a?"dan":"dana";case"MM":return d+=1===a?"mjesec":2===a||3===a||4===a?"mjeseca":"mjeseci";case"yy":return d+=1===a?"godina":2===a||3===a||4===a?"godine":"godina"}}return a.lang("hr",{months:"sjeanj_veljaa_oujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_"),monthsShort:"sje._vel._ou._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",m:b,mm:b,h:b,hh:b,d:"dan",dd:b,M:"mjesec",MM:b,y:"godinu",yy:b},ordinal:"%d.",week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){function b(a,b,c,d){var e=a;switch(c){case"s":return d||b?"nhny msodperc":"nhny msodperce";case"m":return"egy"+(d||b?" perc":" perce");case"mm":return e+(d||b?" perc":" perce");case"h":return"egy"+(d||b?" ra":" rja");case"hh":return e+(d||b?" ra":" rja");case"d":return"egy"+(d||b?" nap":" napja");case"dd":return e+(d||b?" nap":" napja");case"M":return"egy"+(d||b?" hnap":" hnapja");case"MM":return e+(d||b?" hnap":" hnapja");case"y":return"egy"+(d||b?" v":" ve");case"yy":return e+(d||b?" v":" ve")}return""}function c(a){return(a?"":"[mlt] ")+"["+d[this.day()]+"] LT[-kor]"}var d="vasrnap htfn kedden szerdn cstrtkn pnteken szombaton".split(" ");return a.lang("hu",{months:"janur_februr_mrcius_prilis_mjus_jnius_jlius_augusztus_szeptember_oktber_november_december".split("_"),monthsShort:"jan_feb_mrc_pr_mj_jn_jl_aug_szept_okt_nov_dec".split("_"),weekdays:"vasrnap_htf_kedd_szerda_cstrtk_pntek_szombat".split("_"),weekdaysShort:"vas_ht_kedd_sze_cst_pn_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D., LT",LLLL:"YYYY. MMMM D., dddd LT"},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return c.call(this,!0)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return c.call(this,!1)},sameElse:"L"},relativeTime:{future:"%s mlva",past:"%s",s:b,m:b,mm:b,h:b,hh:b,d:b,dd:b,M:b,MM:b,y:b,yy:b},ordinal:"%d.",week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){return a.lang("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiem:function(a){return 11>a?"pagi":15>a?"siang":19>a?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){function b(a){return a%100===11?!0:a%10===1?!1:!0}function c(a,c,d,e){var f=a+" ";switch(d){case"s":return c||e?"nokkrar sekndur":"nokkrum sekndum";case"m":return c?"mnta":"mntu";case"mm":return b(a)?f+(c||e?"mntur":"mntum"):c?f+"mnta":f+"mntu";case"hh":return b(a)?f+(c||e?"klukkustundir":"klukkustundum"):f+"klukkustund";case"d":return c?"dagur":e?"dag":"degi";case"dd":return b(a)?c?f+"dagar":f+(e?"daga":"dgum"):c?f+"dagur":f+(e?"dag":"degi");case"M":return c?"mnuur":e?"mnu":"mnui";case"MM":return b(a)?c?f+"mnuir":f+(e?"mnui":"mnuum"):c?f+"mnuur":f+(e?"mnu":"mnui");case"y":return c||e?"r":"ri";case"yy":return b(a)?f+(c||e?"r":"rum"):f+(c||e?"r":"ri")}}return a.lang("is",{months:"janar_febrar_mars_aprl_ma_jn_jl_gst_september_oktber_nvember_desember".split("_"),monthsShort:"jan_feb_mar_apr_ma_jn_jl_g_sep_okt_nv_des".split("_"),weekdays:"sunnudagur_mnudagur_rijudagur_mivikudagur_fimmtudagur_fstudagur_laugardagur".split("_"),weekdaysShort:"sun_mn_ri_mi_fim_fs_lau".split("_"),weekdaysMin:"Su_M_r_Mi_Fi_F_La".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] LT",LLLL:"dddd, D. MMMM YYYY [kl.] LT"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgun kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gr kl.] LT",lastWeek:"[sasta] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"eftir %s",past:"fyrir %s san",s:c,m:c,mm:c,h:"klukkustund",hh:c,d:c,dd:c,M:c,MM:c,y:c,yy:c},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("it",{months:"Gennaio_Febbraio_Marzo_Aprile_Maggio_Giugno_Luglio_Agosto_Settembre_Ottobre_Novembre_Dicembre".split("_"),monthsShort:"Gen_Feb_Mar_Apr_Mag_Giu_Lug_Ago_Set_Ott_Nov_Dic".split("_"),weekdays:"Domenica_Luned_Marted_Mercoled_Gioved_Venerd_Sabato".split("_"),weekdaysShort:"Dom_Lun_Mar_Mer_Gio_Ven_Sab".split("_"),weekdaysMin:"D_L_Ma_Me_G_V_S".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:"[lo scorso] dddd [alle] LT",sameElse:"L"},relativeTime:{future:function(a){return(/^[0-9].+$/.test(a)?"tra":"in")+" "+a},past:"%s fa",s:"secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},ordinal:"%d",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("ja",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahm",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMDLT",LLLL:"YYYYMDLT dddd"},meridiem:function(a){return 12>a?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd LT",lastDay:"[] LT",lastWeek:"[]dddd LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:"",m:"1",mm:"%d",h:"1",hh:"%d",d:"1",dd:"%d",M:"1",MM:"%d",y:"1",yy:"%d"}})}),function(a){a(bb)}(function(a){function b(a,b){var c={nominative:"___________".split("_"),accusative:"___________".split("_")},d=/D[oD] *MMMM?/.test(b)?"accusative":"nominative";return c[d][a.month()]}function c(a,b){var c={nominative:"______".split("_"),accusative:"______".split("_")},d=/(|)/.test(b)?"accusative":"nominative";return c[d][a.day()]}return a.lang("ka",{months:b,monthsShort:"___________".split("_"),weekdays:c,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"h:mm A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[] LT[-]",nextDay:"[] LT[-]",lastDay:"[] LT[-]",nextWeek:"[] dddd LT[-]",lastWeek:"[] dddd LT-",sameElse:"L"},relativeTime:{future:function(a){return/(|||)/.test(a)?a.replace(/$/,""):a+""
},past:function(a){return/(||||)/.test(a)?a.replace(/(|)$/," ")://.test(a)?a.replace(/$/," "):void 0},s:" ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},ordinal:function(a){return 0===a?a:1===a?a+"-":20>a||100>=a&&a%20===0||a%100===0?"-"+a:a+"-"},week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){return a.lang("ko",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h mm",L:"YYYY.MM.DD",LL:"YYYY MMMM D",LLL:"YYYY MMMM D LT",LLLL:"YYYY MMMM D dddd LT"},meridiem:function(a){return 12>a?"":""},calendar:{sameDay:" LT",nextDay:" LT",nextWeek:"dddd LT",lastDay:" LT",lastWeek:" dddd LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",ss:"%d",m:"",mm:"%d",h:"",hh:"%d",d:"",dd:"%d",M:"",MM:"%d",y:"",yy:"%d"},ordinal:"%d"})}),function(a){a(bb)}(function(a){function b(a,b,c,d){return b?"kelios sekunds":d?"keli sekundi":"kelias sekundes"}function c(a,b,c,d){return b?e(c)[0]:d?e(c)[1]:e(c)[2]}function d(a){return a%10===0||a>10&&20>a}function e(a){return h[a].split("_")}function f(a,b,f,g){var h=a+" ";return 1===a?h+c(a,b,f[0],g):b?h+(d(a)?e(f)[1]:e(f)[0]):g?h+e(f)[1]:h+(d(a)?e(f)[1]:e(f)[2])}function g(a,b){var c=-1===b.indexOf("dddd LT"),d=i[a.weekday()];return c?d:d.substring(0,d.length-2)+""}var h={m:"minut_minuts_minut",mm:"minuts_minui_minutes",h:"valanda_valandos_valand",hh:"valandos_valand_valandas",d:"diena_dienos_dien",dd:"dienos_dien_dienas",M:"mnuo_mnesio_mnes",MM:"mnesiai_mnesi_mnesius",y:"metai_met_metus",yy:"metai_met_metus"},i="pirmadienis_antradienis_treiadienis_ketvirtadienis_penktadienis_etadienis_sekmadienis".split("_");return a.lang("lt",{months:"sausio_vasario_kovo_balandio_gegus_birlio_liepos_rugpjio_rugsjo_spalio_lapkriio_gruodio".split("_"),monthsShort:"sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),weekdays:g,weekdaysShort:"Sek_Pir_Ant_Tre_Ket_Pen_e".split("_"),weekdaysMin:"S_P_A_T_K_Pn_".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"YYYY [m.] MMMM D [d.]",LLL:"YYYY [m.] MMMM D [d.], LT [val.]",LLLL:"YYYY [m.] MMMM D [d.], dddd, LT [val.]",l:"YYYY-MM-DD",ll:"YYYY [m.] MMMM D [d.]",lll:"YYYY [m.] MMMM D [d.], LT [val.]",llll:"YYYY [m.] MMMM D [d.], ddd, LT [val.]"},calendar:{sameDay:"[iandien] LT",nextDay:"[Rytoj] LT",nextWeek:"dddd LT",lastDay:"[Vakar] LT",lastWeek:"[Prajus] dddd LT",sameElse:"L"},relativeTime:{future:"po %s",past:"prie %s",s:b,m:c,mm:f,h:c,hh:f,d:c,dd:f,M:c,MM:f,y:c,yy:f},ordinal:function(a){return a+"-oji"},week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){function b(a,b,c){var d=a.split("_");return c?b%10===1&&11!==b?d[2]:d[3]:b%10===1&&11!==b?d[0]:d[1]}function c(a,c,e){return a+" "+b(d[e],a,c)}var d={mm:"minti_mintes_minte_mintes",hh:"stundu_stundas_stunda_stundas",dd:"dienu_dienas_diena_dienas",MM:"mnesi_mneus_mnesis_mnei",yy:"gadu_gadus_gads_gadi"};return a.lang("lv",{months:"janvris_februris_marts_aprlis_maijs_jnijs_jlijs_augusts_septembris_oktobris_novembris_decembris".split("_"),monthsShort:"jan_feb_mar_apr_mai_jn_jl_aug_sep_okt_nov_dec".split("_"),weekdays:"svtdiena_pirmdiena_otrdiena_trediena_ceturtdiena_piektdiena_sestdiena".split("_"),weekdaysShort:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysMin:"Sv_P_O_T_C_Pk_S".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"YYYY. [gada] D. MMMM",LLL:"YYYY. [gada] D. MMMM, LT",LLLL:"YYYY. [gada] D. MMMM, dddd, LT"},calendar:{sameDay:"[odien pulksten] LT",nextDay:"[Rt pulksten] LT",nextWeek:"dddd [pulksten] LT",lastDay:"[Vakar pulksten] LT",lastWeek:"[Pagju] dddd [pulksten] LT",sameElse:"L"},relativeTime:{future:"%s vlk",past:"%s agrk",s:"daas sekundes",m:"minti",mm:c,h:"stundu",hh:c,d:"dienu",dd:c,M:"mnesi",MM:c,y:"gadu",yy:c},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("ml",{months:"___________".split("_"),monthsShort:"._._._.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm -",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},meridiem:function(a){return 4>a?"":12>a?"":17>a?" ":20>a?"":""}})}),function(a){a(bb)}(function(a){var b={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},c={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return a.lang("mr",{months:"___________".split("_"),monthsShort:"._._._._._._._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(a){return a.replace(/[]/g,function(a){return c[a]})},postformat:function(a){return a.replace(/\d/g,function(a){return b[a]})},meridiem:function(a){return 4>a?"":10>a?"":17>a?"":20>a?"":""},week:{dow:0,doy:6}})}),function(a){a(bb)}(function(a){return a.lang("ms-my",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiem:function(a){return 11>a?"pagi":15>a?"tengahari":19>a?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){return a.lang("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_april_mai_juni_juli_aug._sep._okt._nov._des.".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"s._ma._ti._on._to._fr._l.".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"H.mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] LT",LLLL:"dddd D. MMMM YYYY [kl.] LT"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i gr kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"for %s siden",s:"noen sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",M:"en mned",MM:"%d mneder",y:"ett r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){var b={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},c={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};return a.lang("ne",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"._.__._._._.".split("_"),longDateFormat:{LT:"A h:mm ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},preparse:function(a){return a.replace(/[]/g,function(a){return c[a]})},postformat:function(a){return a.replace(/\d/g,function(a){return b[a]})},meridiem:function(a){return 3>a?"":10>a?"":15>a?"":18>a?"":20>a?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd[,] LT",lastDay:"[] LT",lastWeek:"[] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){var b="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),c="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_");return a.lang("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(a,d){return/-MMM-/.test(d)?c[a.month()]:b[a.month()]},weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"Zo_Ma_Di_Wo_Do_Vr_Za".split("_"),longDateFormat:{LT:"HH:mm",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",m:"n minuut",mm:"%d minuten",h:"n uur",hh:"%d uur",d:"n dag",dd:"%d dagen",M:"n maand",MM:"%d maanden",y:"n jaar",yy:"%d jaar"},ordinal:function(a){return a+(1===a||8===a||a>=20?"ste":"de")},week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("nn",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sundag_mndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),weekdaysShort:"sun_mn_tys_ons_tor_fre_lau".split("_"),weekdaysMin:"su_m_ty_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[I dag klokka] LT",nextDay:"[I morgon klokka] LT",nextWeek:"dddd [klokka] LT",lastDay:"[I gr klokka] LT",lastWeek:"[Fregende] dddd [klokka] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"for %s siden",s:"noen sekund",m:"ett minutt",mm:"%d minutt",h:"en time",hh:"%d timar",d:"en dag",dd:"%d dagar",M:"en mnad",MM:"%d mnader",y:"ett r",yy:"%d r"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){function b(a){return 5>a%10&&a%10>1&&1!==~~(a/10)}function c(a,c,d){var e=a+" ";switch(d){case"m":return c?"minuta":"minut";case"mm":return e+(b(a)?"minuty":"minut");case"h":return c?"godzina":"godzin";case"hh":return e+(b(a)?"godziny":"godzin");case"MM":return e+(b(a)?"miesice":"miesicy");case"yy":return e+(b(a)?"lata":"lat")}}var d="stycze_luty_marzec_kwiecie_maj_czerwiec_lipiec_sierpie_wrzesie_padziernik_listopad_grudzie".split("_"),e="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_wrzenia_padziernika_listopada_grudnia".split("_");return a.lang("pl",{months:function(a,b){return/D MMMM/.test(b)?e[a.month()]:d[a.month()]},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_pa_lis_gru".split("_"),weekdays:"niedziela_poniedziaek_wtorek_roda_czwartek_pitek_sobota".split("_"),weekdaysShort:"nie_pon_wt_r_czw_pt_sb".split("_"),weekdaysMin:"N_Pn_Wt_r_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Dzi o] LT",nextDay:"[Jutro o] LT",nextWeek:"[W] dddd [o] LT",lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zesz niedziel o] LT";case 3:return"[W zesz rod o] LT";case 6:return"[W zesz sobot o] LT";default:return"[W zeszy] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",m:c,mm:c,h:c,hh:c,d:"1 dzie",dd:"%d dni",M:"miesic",MM:c,y:"rok",yy:c},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("pt-br",{months:"Janeiro_Fevereiro_Maro_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-feira_Tera-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sbado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sb".split("_"),weekdaysMin:"Dom_2_3_4_5_6_Sb".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"%s atrs",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinal:"%d"})}),function(a){a(bb)}(function(a){return a.lang("pt",{months:"Janeiro_Fevereiro_Maro_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-feira_Tera-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sbado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sb".split("_"),weekdaysMin:"Dom_2_3_4_5_6_Sb".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"%s atrs",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinal:"%d",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("ro",{months:"Ianuarie_Februarie_Martie_Aprilie_Mai_Iunie_Iulie_August_Septembrie_Octombrie_Noiembrie_Decembrie".split("_"),monthsShort:"Ian_Feb_Mar_Apr_Mai_Iun_Iul_Aug_Sep_Oct_Noi_Dec".split("_"),weekdays:"Duminic_Luni_Mari_Miercuri_Joi_Vineri_Smbt".split("_"),weekdaysShort:"Dum_Lun_Mar_Mie_Joi_Vin_Sm".split("_"),weekdaysMin:"Du_Lu_Ma_Mi_Jo_Vi_S".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[azi la] LT",nextDay:"[mine la] LT",nextWeek:"dddd [la] LT",lastDay:"[ieri la] LT",lastWeek:"[fosta] dddd [la] LT",sameElse:"L"},relativeTime:{future:"peste %s",past:"%s n urm",s:"cteva secunde",m:"un minut",mm:"%d minute",h:"o or",hh:"%d ore",d:"o zi",dd:"%d zile",M:"o lun",MM:"%d luni",y:"un an",yy:"%d ani"},week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){function b(a,b){var c=a.split("_");return b%10===1&&b%100!==11?c[0]:b%10>=2&&4>=b%10&&(10>b%100||b%100>=20)?c[1]:c[2]}function c(a,c,d){var e={mm:"__",hh:"__",dd:"__",MM:"__",yy:"__"};return"m"===d?c?"":"":a+" "+b(e[d],+a)}function d(a,b){var c={nominative:"___________".split("_"),accusative:"___________".split("_")},d=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(b)?"accusative":"nominative";return c[d][a.month()]}function e(a,b){var c={nominative:"___________".split("_"),accusative:"___________".split("_")},d=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(b)?"accusative":"nominative";return c[d][a.month()]}function f(a,b){var c={nominative:"______".split("_"),accusative:"______".split("_")},d=/\[ ?[] ?(?:|)? ?\] ?dddd/.test(b)?"accusative":"nominative";return c[d][a.day()]}return a.lang("ru",{months:d,monthsShort:e,weekdays:f,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),monthsParse:[/^/i,/^/i,/^/i,/^/i,/^[|]/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i],longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:function(){return 2===this.day()?"[] dddd [] LT":"[] dddd [] LT"},lastWeek:function(){switch(this.day()){case 0:return"[ ] dddd [] LT";case 1:case 2:case 4:return"[ ] dddd [] LT";case 3:case 5:case 6:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:c,mm:c,h:"",hh:c,d:"",dd:c,M:"",MM:c,y:"",yy:c},meridiem:function(a){return 4>a?"":12>a?"":17>a?"":""},ordinal:function(a,b){switch(b){case"M":case"d":case"DDD":return a+"-";case"D":return a+"-";case"w":case"W":return a+"-";default:return a}},week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){function b(a){return a>1&&5>a}function c(a,c,d,e){var f=a+" ";switch(d){case"s":return c||e?"pr seknd":"pr sekundami";case"m":return c?"minta":e?"mintu":"mintou";case"mm":return c||e?f+(b(a)?"minty":"mint"):f+"mintami";case"h":return c?"hodina":e?"hodinu":"hodinou";case"hh":return c||e?f+(b(a)?"hodiny":"hodn"):f+"hodinami";case"d":return c||e?"de":"dom";case"dd":return c||e?f+(b(a)?"dni":"dn"):f+"dami";case"M":return c||e?"mesiac":"mesiacom";case"MM":return c||e?f+(b(a)?"mesiace":"mesiacov"):f+"mesiacmi";case"y":return c||e?"rok":"rokom";case"yy":return c||e?f+(b(a)?"roky":"rokov"):f+"rokmi"}}var d="janur_februr_marec_aprl_mj_jn_jl_august_september_oktber_november_december".split("_"),e="jan_feb_mar_apr_mj_jn_jl_aug_sep_okt_nov_dec".split("_");return a.lang("sk",{months:d,monthsShort:e,monthsParse:function(a,b){var c,d=[];for(c=0;12>c;c++)d[c]=new RegExp("^"+a[c]+"$|^"+b[c]+"$","i");return d}(d,e),weekdays:"nedea_pondelok_utorok_streda_tvrtok_piatok_sobota".split("_"),weekdaysShort:"ne_po_ut_st_t_pi_so".split("_"),weekdaysMin:"ne_po_ut_st_t_pi_so".split("_"),longDateFormat:{LT:"H:mm",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd D. MMMM YYYY LT"},calendar:{sameDay:"[dnes o] LT",nextDay:"[zajtra o] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedeu o] LT";case 1:case 2:return"[v] dddd [o] LT";case 3:return"[v stredu o] LT";case 4:return"[vo tvrtok o] LT";case 5:return"[v piatok o] LT";case 6:return"[v sobotu o] LT"}},lastDay:"[vera o] LT",lastWeek:function(){switch(this.day()){case 0:return"[minul nedeu o] LT";case 1:case 2:return"[minul] dddd [o] LT";case 3:return"[minul stredu o] LT";case 4:case 5:return"[minul] dddd [o] LT";case 6:return"[minul sobotu o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pred %s",s:c,m:c,mm:c,h:c,hh:c,d:c,dd:c,M:c,MM:c,y:c,yy:c},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){function b(a,b,c){var d=a+" ";switch(c){case"m":return b?"ena minuta":"eno minuto";case"mm":return d+=1===a?"minuta":2===a?"minuti":3===a||4===a?"minute":"minut";case"h":return b?"ena ura":"eno uro";case"hh":return d+=1===a?"ura":2===a?"uri":3===a||4===a?"ure":"ur";case"dd":return d+=1===a?"dan":"dni";case"MM":return d+=1===a?"mesec":2===a?"meseca":3===a||4===a?"mesece":"mesecev";case"yy":return d+=1===a?"leto":2===a?"leti":3===a||4===a?"leta":"let"}}return a.lang("sl",{months:"januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),weekdays:"nedelja_ponedeljek_torek_sreda_etrtek_petek_sobota".split("_"),weekdaysShort:"ned._pon._tor._sre._et._pet._sob.".split("_"),weekdaysMin:"ne_po_to_sr_e_pe_so".split("_"),longDateFormat:{LT:"H:mm",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danes ob] LT",nextDay:"[jutri ob] LT",nextWeek:function(){switch(this.day()){case 0:return"[v] [nedeljo] [ob] LT";case 3:return"[v] [sredo] [ob] LT";case 6:return"[v] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[v] dddd [ob] LT"}},lastDay:"[veraj ob] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[prejnja] dddd [ob] LT";case 1:case 2:case 4:case 5:return"[prejnji] dddd [ob] LT"}},sameElse:"L"},relativeTime:{future:"ez %s",past:"%s nazaj",s:"nekaj sekund",m:b,mm:b,h:b,hh:b,d:"en dan",dd:b,M:"en mesec",MM:b,y:"eno leto",yy:b},ordinal:"%d.",week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){return a.lang("sq",{months:"Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_Nntor_Dhjetor".split("_"),monthsShort:"Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_Nn_Dhj".split("_"),weekdays:"E Diel_E Hn_E Marte_E Mrkure_E Enjte_E Premte_E Shtun".split("_"),weekdaysShort:"Die_Hn_Mar_Mr_Enj_Pre_Sht".split("_"),weekdaysMin:"D_H_Ma_M_E_P_Sh".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Sot n] LT",nextDay:"[Neser n] LT",nextWeek:"dddd [n] LT",lastDay:"[Dje n] LT",lastWeek:"dddd [e kaluar n] LT",sameElse:"L"},relativeTime:{future:"n %s",past:"%s me par",s:"disa seconda",m:"nj minut",mm:"%d minutea",h:"nj or",hh:"%d or",d:"nj dit",dd:"%d dit",M:"nj muaj",MM:"%d muaj",y:"nj vit",yy:"%d vite"},ordinal:"%d.",week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mndag_tisdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_mn_tis_ons_tor_fre_lr".split("_"),weekdaysMin:"s_m_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Igr] LT",nextWeek:"dddd LT",lastWeek:"[Frra] dddd[en] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"fr %s sedan",s:"ngra sekunder",m:"en minut",mm:"%d minuter",h:"en timme",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en mnad",MM:"%d mnader",y:"ett r",yy:"%d r"},ordinal:function(a){var b=a%10,c=1===~~(a%100/10)?"e":1===b?"a":2===b?"a":"e";return a+c},week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("th",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"._._._._._._.".split("_"),longDateFormat:{LT:"H  m ",L:"YYYY/MM/DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY  LT",LLLL:"dddd D MMMM YYYY  LT"},meridiem:function(a){return 12>a?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd[ ] LT",lastDay:"[ ] LT",lastWeek:"[]dddd[ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:"",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}),function(a){a(bb)}(function(a){return a.lang("tl-ph",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM DD, YYYY LT"},calendar:{sameDay:"[Ngayon sa] LT",nextDay:"[Bukas sa] LT",nextWeek:"dddd [sa] LT",lastDay:"[Kahapon sa] LT",lastWeek:"dddd [huling linggo] LT",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},ordinal:function(a){return a},week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){var b={1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'nc",4:"'nc",100:"'nc",6:"'nc",9:"'uncu",10:"'uncu",30:"'uncu",60:"'nc",90:"'nc"};return a.lang("tr",{months:"Ocak_ubat_Mart_Nisan_Mays_Haziran_Temmuz_Austos_Eyll_Ekim_Kasm_Aralk".split("_"),monthsShort:"Oca_ub_Mar_Nis_May_Haz_Tem_Au_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Sal_aramba_Perembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pts_Sal_ar_Per_Cum_Cts".split("_"),weekdaysMin:"Pz_Pt_Sa_a_Pe_Cu_Ct".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[yarn saat] LT",nextWeek:"[haftaya] dddd [saat] LT",lastDay:"[dn] LT",lastWeek:"[geen hafta] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s nce",s:"birka saniye",m:"bir dakika",mm:"%d dakika",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir yl",yy:"%d yl"},ordinal:function(a){if(0===a)return a+"'nc";var c=a%10,d=a%100-c,e=a>=100?100:null;return a+(b[c]||b[d]||b[e])},week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){return a.lang("tzm-la",{months:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),monthsShort:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),weekdays:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysShort:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysMin:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[asdkh g] LT",nextDay:"[aska g] LT",nextWeek:"dddd [g] LT",lastDay:"[assant g] LT",lastWeek:"dddd [g] LT",sameElse:"L"},relativeTime:{future:"dadkh s yan %s",past:"yan %s",s:"imik",m:"minu",mm:"%d minu",h:"saa",hh:"%d tassain",d:"ass",dd:"%d ossan",M:"ayowr",MM:"%d iyyirn",y:"asgas",yy:"%d isgasn"},week:{dow:6,doy:12}})}),function(a){a(bb)}(function(a){return a.lang("tzm",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] LT",sameElse:"L"},relativeTime:{future:"   %s",past:" %s",s:"",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d o",M:"o",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}),function(a){a(bb)}(function(a){function b(a,b){var c=a.split("_");return b%10===1&&b%100!==11?c[0]:b%10>=2&&4>=b%10&&(10>b%100||b%100>=20)?c[1]:c[2]}function c(a,c,d){var e={mm:"__",hh:"__",dd:"__",MM:"__",yy:"__"};return"m"===d?c?"":"":"h"===d?c?"":"":a+" "+b(e[d],+a)}function d(a,b){var c={nominative:"___________".split("_"),accusative:"___________".split("_")},d=/D[oD]? *MMMM?/.test(b)?"accusative":"nominative";return c[d][a.month()]}function e(a,b){var c={nominative:"______".split("_"),accusative:"______".split("_"),genitive:"______".split("_")},d=/(\[[]\]) ?dddd/.test(b)?"accusative":/\[?(?:|)? ?\] ?dddd/.test(b)?"genitive":"nominative";return c[d][a.day()]}function f(a){return function(){return a+""+(11===this.hours()?"":"")+"] LT"}}return a.lang("uk",{months:d,monthsShort:"___________".split("_"),weekdays:e,weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., LT",LLLL:"dddd, D MMMM YYYY ., LT"},calendar:{sameDay:f("[ "),nextDay:f("[ "),lastDay:f("[ "),nextWeek:f("[] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return f("[] dddd [").call(this);case 1:case 2:case 4:return f("[] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:c,mm:c,h:"",hh:c,d:"",dd:c,M:"",MM:c,y:"",yy:c},meridiem:function(a){return 4>a?"":12>a?"":17>a?"":""},ordinal:function(a,b){switch(b){case"M":case"d":case"DDD":case"w":case"W":return a+"-";case"D":return a+"-";default:return a}},week:{dow:1,doy:7}})}),function(a){a(bb)}(function(a){return a.lang("uz",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"D MMMM YYYY, dddd LT"},calendar:{sameDay:"[ ] LT []",nextDay:"[] LT []",nextWeek:"dddd [ ] LT []",lastDay:"[ ] LT []",lastWeek:"[] dddd [ ] LT []",sameElse:"L"},relativeTime:{future:" %s ",past:"  %s ",s:"",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}})
}),function(a){a(bb)}(function(a){return a.lang("vn",{months:"thng 1_thng 2_thng 3_thng 4_thng 5_thng 6_thng 7_thng 8_thng 9_thng 10_thng 11_thng 12".split("_"),monthsShort:"Th01_Th02_Th03_Th04_Th05_Th06_Th07_Th08_Th09_Th10_Th11_Th12".split("_"),weekdays:"ch nht_th hai_th ba_th t_th nm_th su_th by".split("_"),weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM [nm] YYYY",LLL:"D MMMM [nm] YYYY LT",LLLL:"dddd, D MMMM [nm] YYYY LT",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY LT",llll:"ddd, D MMM YYYY LT"},calendar:{sameDay:"[Hm nay lc] LT",nextDay:"[Ngy mai lc] LT",nextWeek:"dddd [tun ti lc] LT",lastDay:"[Hm qua lc] LT",lastWeek:"dddd [tun ri lc] LT",sameElse:"L"},relativeTime:{future:"%s ti",past:"%s trc",s:"vi giy",m:"mt pht",mm:"%d pht",h:"mt gi",hh:"%d gi",d:"mt ngy",dd:"%d ngy",M:"mt thng",MM:"%d thng",y:"mt nm",yy:"%d nm"},ordinal:function(a){return a},week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("zh-cn",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahmm",L:"YYYYMMMD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYYMMMD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"},meridiem:function(a,b){var c=100*a+b;return 600>c?"":900>c?"":1130>c?"":1230>c?"":1800>c?"":""},calendar:{sameDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},nextDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},lastDay:function(){return 0===this.minutes()?"[]Ah[]":"[]LT"},nextWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()-b.unix()>=604800?"[]":"[]",0===this.minutes()?c+"dddAh":c+"dddAhmm"},lastWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()<b.unix()?"[]":"[]",0===this.minutes()?c+"dddAh":c+"dddAhmm"},sameElse:"L"},ordinal:function(a,b){switch(b){case"d":case"D":case"DDD":return a+"";case"M":return a+"";case"w":case"W":return a+"";default:return a}},relativeTime:{future:"%s",past:"%s",s:"",m:"1",mm:"%d",h:"1",hh:"%d",d:"1",dd:"%d",M:"1",MM:"%d",y:"1",yy:"%d"},week:{dow:1,doy:4}})}),function(a){a(bb)}(function(a){return a.lang("zh-tw",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"Ahmm",L:"YYYYMMMD",LL:"YYYYMMMD",LLL:"YYYYMMMDLT",LLLL:"YYYYMMMDddddLT",l:"YYYYMMMD",ll:"YYYYMMMD",lll:"YYYYMMMDLT",llll:"YYYYMMMDddddLT"},meridiem:function(a,b){var c=100*a+b;return 900>c?"":1130>c?"":1230>c?"":1800>c?"":""},calendar:{sameDay:"[]LT",nextDay:"[]LT",nextWeek:"[]ddddLT",lastDay:"[]LT",lastWeek:"[]ddddLT",sameElse:"L"},ordinal:function(a,b){switch(b){case"d":case"D":case"DDD":return a+"";case"M":return a+"";case"w":case"W":return a+"";default:return a}},relativeTime:{future:"%s",past:"%s",s:"",m:"",mm:"%d",h:"",hh:"%d",d:"",dd:"%d",M:"",MM:"%d",y:"",yy:"%d"}})}),bb.lang("en"),nb?(module.exports=bb,ab(!0)):"function"==typeof define&&define.amd?define("moment",["require","exports","module"],function(b,c,d){return d.config().noGlobal!==!0&&ab(d.config().noGlobal===a),bb}):ab()}.call(this),define("general.utils/qv-moment",["translator","moment","qvangular","general.utils/responsive-state"],function(a,b,c,d){function e(a){var b,c=g;switch(c.toLowerCase()){case"en":b="YY-MM-DD";break;case"en-us":b="M/D/YY";break;case"en-gb":b="DD/MM/YY";break;case"de-de":case"de":b="DD.MM.YY";break;case"es-es":case"es":b="DD/MM/YY";break;case"fr-fr":case"fr":b="DD/MM/YY";break;case"it-it":case"it":b="DD/MM/YY";break;case"ja-jp":case"ja":b="YY/MM/DD";break;case"nl-nl":case"nl":b="D-M-YY";break;case"pt":g="pt-br",b="DD/MM/YY";break;case"pt-br":b="DD/MM/YY";break;case"pt-pt":b="DD-MM-YY";break;case"ru-ru":case"ru":b="DD.MM.YY";break;case"sv-fi":b="D.M.YY";break;case"sv-se":case"sv":b="YY-MM-DD";break;case"zh":g="zh-cn",b="YY/M/D";break;case"zh-tw":case"zh-cn":b="YY/M/D";break;default:a&&(!b&&window.console.warn&&window.console.warn("Locale '"+c+"' not supported, falling back to ISO with English day/month names'"),g="en",b=e()),g=g.slice(0,2),!b&&window.console.warn&&window.console.warn("Locale '"+c+"' not supported, falling back to '"+g+"'"),b=e(!0)}if(!h)switch(c.toLowerCase()){case"en":b="YYYY-MM-DD HH:mm";break;case"en-us":b="M/D/YYYY LT";break;case"ja":case"ja-jp":b="LL H:mm";break;case"zh-tw":case"zh-cn":b="LL H:mm";break;default:b="L LT"}return b}function f(c,d,f){return!f&&a.localeDetected.length>=a.language.length&&(f=a.localeDetected),g=f||a.languageCode,b(c).lang(g).format(d||e())}var g,h=d.isSmallDevice,i={restrict:"E",replace:!0,scope:{date:"=",format:"@",customLangCode:"@"},template:'<span class="qv-moment">{{dateToShow}}</span>',link:function(a){a.dateToShow=f(a.date,a.format||"",a.customLangCode||"")}};return c.directive("qveFormateDate",function(){return i}),c.filter("formateDate",function(){return f}),{formatDate:f,directive:i}}),define("storytelling.utils/storytelling-helper",["jquery","qvangular"],function(a,b){function c(b,c){var d=a(".qv-grid-story"),e=d.offset().left+1*c.width-b.outerWidth(),f=d.outerWidth()+d.offset().left-1*c.width,g=d.offset().top+1*c.height-b.outerHeight(),h=d.offset().top+d.outerHeight()-1*c.height;return[e,g,f,h]}function d(a,b,c){var d,e=a.outerHeight(),f=a.outerWidth(),g=a.offset(),h=b.offset(),i=b.outerHeight(),j=b.outerWidth();g.left+f<h.left+1*c.width&&(d=h.left+1*c.width-(g.left+f),a.css("left","+="+d)),g.top+e<h.top+1*c.height&&(d=h.top+1*c.height-(g.top+e),a.css("top","+="+d)),g.left+1*c.width>h.left+j&&(d=g.left+1*c.width-(h.left+j),a.css("left","-="+d)),g.top+1*c.height>h.top+i&&(d=g.top+1*c.width-(h.top+i),a.css("top","-="+d))}function e(a,b){for(;a%b!==0&&a>b;)a--;return b>a?b:a}function f(a,b){for(;a%b!==0&&a>0;)a++;return a}function g(a,b){var c,d,e,f,g,h,i,j,k;return b.snapGrid?(c=Math.round(a.position().top/b.cellSize.height)*b.cellSize.height,d=Math.round(a.position().left/b.cellSize.width)*b.cellSize.width,e=Math.round(parseInt(a.css("width"),10)/b.cellSize.width)*b.cellSize.width,f=Math.round(parseInt(a.css("height"),10)/b.cellSize.height)*b.cellSize.height):(c=a.position().top,d=a.position().left,e=a.outerWidth(),f=a.outerHeight()),g=(100*c/a.offsetParent().height()).toFixed(2)+"%",h=(100*d/a.offsetParent().width()).toFixed(2)+"%",i=(100*e/a.offsetParent().width()).toFixed(2)+"%",j=(100*f/a.offsetParent().height()).toFixed(2)+"%",k={top:g,left:h,width:i,height:j,"z-index":parseInt(a.css("z-index"),10)},a.css(k),k}function h(b){var c,d,e,f,g,h,i,j,k,l=a("#qv-storytelling .qv-grid-story");return c=b.offset().top-l.offset().top,d=b.offset().left-l.offset().left,g=parseInt(b.css("width"),10),h=parseInt(b.css("height"),10),e=(c/l.height()*100).toFixed(2)+"%",f=(d/l.width()*100).toFixed(2)+"%",i=(g/l.width()*100).toFixed(2)+"%",j=(h/l.height()*100).toFixed(2)+"%",k={top:e,left:f,width:i,height:j,"z-index":parseInt(b.css("z-index"),10)}}function i(){return q}function j(a){q=a}function k(a){r=a}function l(){return r}function m(a){v=a,angular.element(".qv-storytelling-edit-toolbar").scope().$broadcast(a?"slideItemSelected":"slideItemDeselected")}function n(){return v}function o(a){function b(a,b){return a.qData.rank<b.qData.rank?-1:a.qData.rank>b.qData.rank?1:0}return Array.isArray(a)&&a.length>0?a.sort(b):a}function p(a,c){var d=b.getService("$compile"),e=b.getService("$rootScope"),f="<div storytelling-thumbnail />",g=e.$new();g.slide={qInfo:{qId:c}},a.empty(),a.append(d(f)(g))}var q={},r=!1,s=!1,t=null,u=null,v=null,w={wide:{w:16,h:9},regular:{w:4,h:3}},x={id:"",slide:"",action:""},y={id:null},z=0,A=199,B={},C={};return{getContainmentOnElement:c,slideItemOutsideSlide:d,decreaseValueUntilEvenSplit:e,increaseValueUntilEvenSplit:f,getElementPosition:g,getHelperPosition:h,getGridOptions:i,setGridOptions:j,setPublishState:k,getPublishState:l,sortSlidesByRank:o,setSelectedSlideItemElem:m,getSelectedSlideItemElem:n,currentStoryId:t,currentSlideId:u,createSlideThumbnail:p,availableRatios:w,pasteOffset:z,prevStoryState:B,lastObjPasted:x,lastObjAdded:y,isViewingSource:s,maxNumberOfSlideItems:A,selectionState:C}}),define("general.utils/drag-and-drop-service",["jquery","util","qvangular"],function(a,b,c){function d(a,b,c){this.offsetX=a,this.offsetY=b,this.elem=c}function e(a,b,c,d){return a[c]&&a[c][b.type]?a[c][b.type].call(null,d):"function"==typeof a[c]?a[c].call(null,d):void 0}function f(a,b,c){this.info=a,this.handle=b,this.targets=c,this.rects=[];var d=this.docRect=document.body.getBoundingClientRect(),e=this.canvas=document.createElement("canvas");e.style.position="absolute",e.style.left=(window.pageXOffset||0)+"px",e.style.top=(window.pageYOffset||0)+"px",e.style.zIndex=999,e.width=d.width,e.height=d.height,document.body.appendChild(e),this.context=e.getContext("2d")}function g(a,b,c,d){if(a.setLineDash)a.setLineDash(d),a.moveTo(h(b.x),h(b.y)),a.lineTo(h(c.x),h(c.y)),a.stroke();else{d=d||[2,4];var e,f=d.length,g=c.x-b.x,i=c.y-b.y,j=Math.sqrt(g*g+i*i),k=j,l=0,m=!0,n=b.x,o=b.y;for(g/=j,i/=j,a.moveTo(h(n),h(o)),l=0;k>=.1&&5e3>l;++l)e=d[l%f],0===e&&(e=.001),e>k&&(e=k),n+=e*g,o+=e*i,a[m?"lineTo":"moveTo"](h(n),h(o)),k-=e,m=!m}}function h(a){return Math.round(a)}function i(a,b,c){if(c=c||[5],a.setLineDash)a.setLineDash(c),a.strokeRect(h(b.left),h(b.top),h(b.right-b.left),h(b.bottom-b.top));else{var d=a.lineWidth/2;a.beginPath();var e={x:b.left+d,y:b.top+d},f={x:b.right-d,y:b.top+d},i={x:b.right-d,y:b.bottom-d},j={x:b.left+d,y:b.bottom-d};g(a,e,f,c),g(a,f,i,c),g(a,i,j,c),g(a,j,e,c),a.stroke()}}function j(a,b){var c=a.lineWidth+4;a.beginPath(),a.rect(b.left+c,b.top+c,b.right-b.left-2*c,b.bottom-b.top-2*c),a.fillStyle="rgba(0,0,0,0.05)",a.fill()}var k=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;d.prototype.update=function(a,b){var c=a+this.offsetX,d=b+this.offsetY,e=this.elem;k?(e.style.left=c+"px",e.style.top=d+"px"):e.style.transform=e.style.webkitTransform=e.style.mozTransform=e.style.msTransform="translate3d("+c+"px, "+d+"px, 0)"},d.prototype.end=function(){a(this.elem).remove()},f.prototype.start=function(){for(var a=this.targets,d=this.info,f=0;f<a.length;++f)e(a[f],d,"start",this);this.rects.sort(function(a,c){return b.compare(c.prio,a.prio)}),c.$rootScope.$apply()},f.prototype.update=function(a){a.preventDefault();var b=a.pageX,c=a.pageY;this.handle.update(b,c);for(var d=this.rects,f=null,g=0;g<d.length;++g){var h=d[g].targetRect,k=h.left<=b&&b<=h.right&&h.top<=c&&c<=h.bottom;if(k){f=d[g];break}}if(f!==this.activeRect){this.activeRect&&e(this.activeRect,this.info,"leave",this.info);var l=this.context,m=this.docRect;if(l.clearRect(0,0,m.width,m.height),f){l.strokeStyle="#F7A24D",l.lineWidth=2;var n=f.drawRect;n&&(i(l,f.cellRect||n,[5]),j(l,n)),e(f,this.info,"enter",this.info)}}this.activeRect=f},f.prototype.registerDropRect=function(a){a.prio=a.prio||0,this.rects.push(a)},f.prototype._end=function(){for(var a=0;a<this.targets.length;++a)e(this.targets[a],this.info,"end",this);document.body.removeChild(this.canvas),this.handle.end(),c.$rootScope.$apply()},f.prototype.end=function(){this.activeRect&&e(this.activeRect,this.info,"drop",this.info),this._end()},f.prototype.cancel=function(){this._end()};var l=[];return{registerDropTarget:function(a){var b=l.indexOf(a);-1===b&&l.push(a)},unregisterDropTarget:function(a){var b=l.indexOf(a);-1!==b&&l.splice(b,1)},startDrag:function(a,b){a.style.position="absolute",a.style.left="0",a.style.top="0",a.style.zIndex=9999,document.body.appendChild(a);var c=a.getBoundingClientRect(),g=new d(-c.width/2,-c.height/2,a),h=l.filter(function(a){return e(a,b,"accept",b)}),i=new f(b,g,h);try{return i.start(),i}catch(j){return i.cancel(),!1}}}}),define("general.utils/drag-and-drop-helper",["jquery","general.utils/drag-and-drop-service","touche"],function(a,b,c){function d(d,e,f){function g(b){return"string"==typeof f.elem?a(f.elem)[0]:"function"==typeof f.elem?f.elem(b):f.elem}function h(b){return"function"==typeof f.info?f.info(a(b.currentTarget).scope(),b):f.info}var i=!1,j=null,k=f.cond||function(){return!0},l=f.onStart||function(){},m=f.onStop||function(){},n=f.isEnabled||function(){return!0};d.on("qv-press",e,function(a){i=null;var b=h(a);return n(b,a)?void(f.allowScroll||c.utils.touch||a.preventDefault()):void(i=!1)}),d.on("qv-swipe",e,function(a){i!==!1&&(i===!0?(clearTimeout(j),j=null):i&&(i.update(a),i.end(a),m(a,!1)),i=!1)}),d.on("qv-swipecancel",e,function(a){i!==!1&&(i===!0?(clearTimeout(j),j=null):i&&(i.cancel(),m(a,!0)),i=!1)}),d.on("qv-swipestart qv-swipeupdate",e,function(a){if(i!==!1){if(!i){var c=k(a.gestureData.swipe);c?(i=!0,j=setTimeout(function(){j=null,l(a);var c=g(a),d=h(a);i=b.startDrag(c,d),i&&i.update(a)},0)):c===!1&&(i=!1)}i&&(a.preventDefault(),i!==!0&&i.update(a))}})}return{addDrag:d}}),define("storytelling.views/library/directives/draggable",["jquery","qvangular","storytelling.utils/storytelling-helper","general.utils/drag-and-drop-helper","touche"],function(a,b,c,d){function e(b,c){d.addDrag(c,".qv-story-library-item",{allowScroll:!0,isEnabled:function(){return!b.inEdit},cond:function(a){return!Touche.utils.touch||"right"===a.direction&&a.distance>7},onStart:function(b){var c=a(b.currentTarget),d=c.scope();d.validHelperDrop=!1,a(b.currentTarget).css("opacity",.5)},onStop:function(c){var d=a(c.currentTarget).scope();d.effect&&a(".qv-grid-story").scope().$broadcast("dropEffect",a.extend(!0,{},d.effect)),b.closePopover()},info:function(a){return{type:"storyitem",item:a}},elem:function(c){var d=c.currentTarget,e=a(d).scope(),g=d.cloneNode(!0);return f(b,a(g),e),g.className+=" ui-draggable-dragging",b.$apply(function(){b.$parent.showLib=!1}),g}})}function f(b,d,e){var f=c.getGridOptions().cellSize,i=f.height*b.helperSize.height,j=f.width*b.helperSize.width,k=-1,l=-1;if(e.text&&"title"===e.text.textType)i=4*f.height,j=25*f.width+10,k=.5*i,l=i;else if(e.text&&"paragraph"===e.text.textType)k=.1*i,l=.2*i;else if(e.effect)i=20*b.helperSize.height,j=20*b.helperSize.width,a(".qv-grid-story").scope().$broadcast("draggingEffect",e.effect);else if(e.snapshot){var m=e.snapshot.qData.snapshotData;if(m){var n;n=m.parent?g(m):h(m,f),i=n.rows,j=n.cols}else i=b.helperSize.height,j=b.helperSize.width;i=f.height*i*.95,j=f.width*j*.95,k=.8*Math.min(i,j),l=k}d.css({height:Math.round(i),width:Math.round(j),"font-size":k>0?Math.round(k)+"px":"inherit","line-height":l>0?Math.round(l)+"px":"inherit"})}function g(a){var b,d,e,f,g=a.object.size.w/a.object.size.h;return a.parent.w>a.parent.h?(b=a.object.size.h/a.parent.h,e=c.getGridOptions().rows*b,f=e*g,f>c.getGridOptions().columns&&(f=c.getGridOptions().columns,e=f/g)):(d=a.object.size.w/a.parent.w,f=c.getGridOptions().columns*d,e=f/g,e>c.getGridOptions().rows&&(e=c.getGridOptions().rows,f=e*g)),{rows:e,cols:f}}function h(a,b){var c,d,e,f,g=a.object.size||a.content.size;return e=Math.floor(g.w/b.width),f=Math.floor(g.h/b.height),25!==e&&(c=e-25,d=c/e,e=25,f=Math.ceil(f*(1-d))),f>25&&(c=f-25,d=c/f,f-=c,e=Math.ceil(e*(1-d))),{rows:f,cols:e}}b.directive("storyLibraryDraggable",[function(){return{restrict:"A",link:function(a,b){a.showMiniLibrary||e(a,b)}}}])}),define("storytelling.views/library/filters/date",["qvangular","jquery"],function(a,b){a.filter("filterDate",function(){return function(a,c){var d,e,f=[],g=(new Date).toDateString();switch(e=new Date,d=(e.getDay()+6)%7,e=new Date(e-24*d*60*60*1e3),c.category.name){case"today":b.each(a,function(a,b){new Date(b.qData.timestamp).toDateString()===g&&f.push(b)});break;case"thisweek":b.each(a,function(a,b){b.qData.timestamp>e.getTime()&&new Date(b.qData.timestamp).toDateString()!==g&&f.push(b)});break;case"older":b.each(a,function(a,b){new Date(b.qData.timestamp).toDateString()!==g&&b.qData.timestamp<e.getTime()&&f.push(b)});break;default:return a}return f.length<1&&(c.category.isEmpty=!0),f}})}),define("storytelling.views/library/library",["jquery","qvangular","core.utils/resize","text!storytelling.views/library/library.ng.html","text!storytelling.views/library/library-snapshot-info.ng.html","storytelling.utils/storytelling-data","general.utils/visualizations","client.models/snapshot","client.utils/state","objects.utils/type-loader","general.utils/qv-moment","storytelling.views/library/directives/draggable","storytelling.views/library/filters/date"],function(a,b,c,d,e,f,g,h,i,j,k){function l(a){a.snapshots=null,a.texts=null,a.shapes=null,a.effects=null,a.mediaTypes=null}function m(b,c){h.Snapshot.get(b).then(function(b){b.getProperties().then(function(d){var e={};e=a.extend(!0,d,c),b.setProperties(e)})})}function n(a,b){function c(){h.Snapshot.getLibraryContent(b,c).then(function(b){a.snapshots=b,a.empty=a.snapshots.length<1,a.helperSize={height:20,width:28},a.editable=!0,a.showMiniLibrary&&((a.empty||a.afterRemoveLength&&a.snapshots.length===a.afterRemoveLength)&&(d.$parent.ext.snapshot.updateCount(d.$parent),a.afterRemoveLength=null),a.empty&&a.closePopover())})}var d=a.libraryButton.scope();l(a),c()}function o(a){l(a),a.texts=f.textTemplates,a.helperSize={height:16,width:16},a.empty=!1}function p(a){l(a),a.shapes=f.shapeTemplates,a.helperSize={height:8,width:8},a.empty=!1}function q(b){l(b),b.effects=a.extend(!0,{},f.effectTemplates),b.helperSize={height:2.5,width:11},b.empty=!1}function r(a){l(a),a.mediaTypes=f.mediaTemplates,a.helperSize={height:20,width:30},a.empty=!1}function s(b){var c=a(".qv-story-library-item.snapshot"),d=[];c.each(function(){a(this).find("input").prop("checked")&&d.push(a(this).scope().snapshot.qInfo.qId)}),b.afterRemoveLength=b.snapshots.length-d.length,d.forEach(function(a){h.Snapshot.remove(a)}),b.isAnyTicked=!1}function t(c,d,e,g){var h=b.getService("$timeout");c.isAnyTicked=!1,c.currentLibrary&&(c.currentLibrary=null),c.categories=a.extend(!0,c.categories,f.timeCategories),c.libraryButton&&d.currentTarget===c.libraryButton[0]?c.libraryButton=null:h(function(){switch(c.libraryButton=a(d.currentTarget),c.editable=!1,e){case"snapshot":n(c,g),c.currentLibrary=v.snapshot;break;case"text":o(c),c.currentLibrary=v.text;break;case"shapes":p(c),c.currentLibrary=v.shapes;break;case"effects":q(c),c.currentLibrary=v.effects;break;case"media":r(c),c.currentLibrary=v.media}})}function u(){j.load()}var v={snapshot:{translation:"Storytelling.library.snapshot"},text:{translation:"Storytelling.library.text"},shapes:{translation:"Storytelling.library.shape"},effects:{translation:"Storytelling.library.effect"},media:{translation:"Storytelling.library.media"}};b.service("storyItemsLibrary",function(){return{openLibrary:function(b){u(),t(a("#storyLibraryContainer").scope(),b.event,b.library,b.objectId)}}}),b.directive("storyItemsLibrary",function(){return{template:d,link:function(b,d,e){b.limits=b.$eval(e.libraryLimits),b.libraryPosition=function(){return b.libraryButton.offset().left<document.documentElement.clientWidth/2?"right":"left"},b.showMiniLibrary=i.state!==i.States.editstory,b.expandClicked=function(a){a.expanded=a.expanded?!1:!0},b.currentLibrary=null,b.helperSize=null,b.editable=!1,b.inEdit=!1,b.empty=!1,b.getIconClass=function(a){var b=g.getLibraryInfo(a);return b?b.icon:"extension"},b.enterEdit=function(){b.inEdit=!0},b.leaveEdit=function(){b.inEdit=!1,b.isAnyTicked=!1},b.deleteSnapshots=function(){s(b)},b.showLib=!0,b.onCheckboxClick=function(){var c=a(".qv-story-library-content ul");b.isAnyTicked=!1,c.children().each(function(){a(this).find("input").prop("checked")&&(b.isAnyTicked=!0)})},b.closePopover=function(c){c&&a(c.target).parents(".qv-panel-story-right, .snapshotcounter").length||(b.currentLibrary=null,b.libraryButton=null,b.inEdit=!1)},c.on("start.storytellingLibrary",b.closePopover),b.$on("$destroy",function(){c.off("start",b.closePopover),h.Snapshot.unbindList()})}}}),b.directive("storyItemsLibrarySnapshot",function(){return{restrict:"E",replace:!0,scope:{edit:"=",snapshot:"="},template:e,link:function(a,b){a.editingTitle=!1,a.formattedTimestamp=k.formatDate(a.snapshot.qData.timestamp),a.id=a.snapshot.qInfo.qId,a.enterEdit=function(c){a.edit&&c&&(a.editingTitle=!0,b.on("keypress",function(b){var c=b.keyCode||b.which;13===c&&a.$apply(function(){a.leaveEdit()})}))},a.leaveEdit=function(){a.edit&&a.editingTitle&&(b.find(".snapshot-title-input").blur(),a.editingTitle=!1,m(a.id,{libraryTitle:a.snapshot.qData.libraryTitle}),b.off())}}}})}),define("objects.utils/data-properties/empty-handler",["./data-property-handler","util"],function(a){var b=a.extend({getDimensions:function(){return[]},getMeasures:function(){return[]}});return b}),define("text!objects.error-handling/invalid-type.ng.html",[],function(){return'<div qv-extension class="object-error">\r\n	<div class="object-error-content">\r\n		<div class="object-error-title">\r\n			<span q-translation="Object.Invalid.Title"></span>\r\n			<i class="object-error-more icon-info" qva-activate="showMore($event)"></i>\r\n		</div>\r\n		<div class="object-error-message" q-translation="{{errorMessage}}"></div>\r\n		<button class="qui-button object-error-remove" qva-activate="remove($event)" q-translation="Common.Delete"></button>\r\n	</div>\r\n</div>\r\n'}),define("objects.error-handling/invalid-type",["qvangular","angular","touche","objects.utils/data-properties/empty-handler","./error-info-popup","text!objects.error-handling/invalid-type.ng.html"],function(a,b,c,d,e,f){return{type:"invalid",template:f,definition:{type:"items",items:{}},snapshot:{canTakeSnapshot:!1},getContextMenu:function(){},hasError:function(){return!1},showRequirements:function(){return!1},getCreatePropertyHandler:function(){return new d},getDropFieldOptions:function(){},getDropDimensionOptions:function(){},getDropMeasureOptions:function(){},controller:["$scope",function(d){d.errorMessage=d.object.errorMessage,d.remove=function(b){var c=d.layout.qInfo.qId,e=a.$rootScope.State.model,f=e.getObjectById(c);e.removeObject({row:f.row,col:f.col}),b.stopPropagation()},d.showMore=function(a){var f=b.element("<div>").appendTo("body");f.showComponent(e,{alignTo:b.element(a.target),errorMessage:d.errorMessage,onClose:function(){f.remove(),c.preventGestures()}})}}]}}),define("objects.utils/resize",["pubsub"],function(a){function b(b){b=b||{},a.publish("/ui/object/resize",b)}["/resize/end","/ui/panel/toggle","/ui/grid/cellswap","/ui/grid/cellresize","/ui/grid/cellsplitting","/ui/grid/zoom/activated","/ui/grid/zoom/deactivated"].forEach(function(c){a.subscribe(c,b)})}),define("text!client.views/selection-toolbar/selection-toolbar.ng.html",[],function(){return'<div class="qv-selection-toolbar qvt-selection-toolbar"\r\n	 ng-style="toolbar.style"\r\n	 ng-class="{ \'sel-toolbar-card\': !options.isPopover, \'sel-toolbar-popover\': options.isPopover, \'sel-toolbar-click-to-unlock-bg\': locked, \'sel-toolbar-menu-item\': locked }"\r\n	 qva-activate="locked && toggleLock($event);">\r\n	<div class="sel-toolbar-list-wrapper">\r\n		<table class="sel-toolbar-list">\r\n			<tr>\r\n				<td class="sel-toolbar-list-item" ng-class="{ \'sel-toolbar-list-item-hide-more\': filteredMenuButtons.length === 0 }">\r\n					<button tid="selection-toolbar.toggleShowMenu"\r\n							class="sel-toolbar-btn sel-toolbar-icon sel-toolbar-icon-toggle"\r\n							ng-class="{ \'menu-active\': toolbar.showMenu }"\r\n							q-title-translation="{{toolbar.showMenu ? \'Tooltip.CloseSelectionMenu\' : \'Tooltip.SelectionMenu\'}}"\r\n							qva-activate="toggleShowMenu($event)">\r\n						<span class="sel-toolbar-span-icon selections-more"></span>\r\n					</button>\r\n				</td>\r\n				<td ng-if="toolbar.showLock || locked" class="sel-toolbar-list-item sel-toolbar-list-item-lockunlock">\r\n					<button tid="selection-toolbar.lock"\r\n							class="sel-toolbar-btn sel-toolbar-icon"\r\n							q-title-translation="{{\'DataModelViewer.RightMenu.Tooltip.ClickTo\' + (locked ? \'Unlock\' : \'Lock\')}}"\r\n							ng-disabled="locked ? false : !toolbar.backendApi.hasSelections()"\r\n							qva-activate="!locked && toggleLock($event);">\r\n						<span class="sel-toolbar-span-icon" ng-class="!locked ? \'icon-toolbar-unlocked\':\'icon-toolbar-locked sel-toolbar-menu-span-icon\'"></span>\r\n					</button>\r\n				</td>\r\n				<td ng-show="locked" class="sel-toolbar-list-item-locked">\r\n					<p class="sel-toolbar-menu-text" q-translation="SelectionToolbar.ClickToUnlock"></p>\r\n				</td>\r\n				<td ng-show="!locked" ng-repeat="button in filteredButtons" class="sel-toolbar-list-item" ng-class="button.clazz">\r\n					<button tid="{{button.tid}}"\r\n							qva-activate="buttonAction($event, button)"\r\n							q-title-translation="{{button.name}}"\r\n							ng-disabled="buttonIsDisabled(button)"\r\n							class="sel-toolbar-btn"\r\n							ng-class="[button.buttonClass, button.isIcon ? \'sel-toolbar-icon\' : \'\', button.isActive(this) ? \'menu-active\' : \'\']">\r\n						<span class="sel-toolbar-span-icon" ng-class="button.iconClass"></span>\r\n					</button>\r\n				</td>\r\n			</tr>\r\n		</table>\r\n\r\n	</div>\r\n	<div ng-if="toolbar.showMenu" class="sel-toolbar-menu" ng-style="toolbar.menuStyle"\r\n		 qva-delegated-activate="div:not(.disabled)#menuAction($event);">\r\n		<div ng-repeat="button in filteredMenuButtons" class="sel-toolbar-menu-item"\r\n			 tid="{{button.tid}}"\r\n			 q-title-translation="{{button.name}}"\r\n			 ng-class="{\'disabled\': buttonIsDisabled(button) }">\r\n			<table class="sel-toolbar-menu-table" ng-class="{ \'selection-toolbar-menu-table-align-center\': filteredButtons.length === 0 }">\r\n				<tr>\r\n					<td><span class="sel-toolbar-menu-span-icon" ng-class="button.iconClass"></span></td>\r\n					<td ng-if="filteredButtons.length !== 0"><p class="sel-toolbar-menu-text" q-translation="{{button.name}}"></p></td>\r\n				</tr>\r\n			</table>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("client.views/selection-toolbar/selection-toolbar",["jquery","qvangular","text!./selection-toolbar.ng.html","core.utils/deferred"],function(a,b,c,d){var e,f,g=44,h=1,i=8,j=2;return b.componentDirective("qvaIncludeSelectionToolbar",{toolbar:"=",options:"="}),f={width:0,buttons:[],haveButtons:function(){return this.buttons.length>0},reset:function(a){this.width=a,this.buttons.length=0},freeWidth:function(){var a,b=0;for(a=0;a<this.buttons.length;a++)b+=this.buttons[a];return this.width-b}},e={template:c,controller:["$scope",function(b){function c(a,c,d){var e,k,l=0;for(f.reset(a-(i+2*j)),k=c.length-1;k>=0&&(e="sel-toolbar-icon-separator"!==c[k].buttonClass?g+i:h+i,e<=f.freeWidth());k--)f.buttons.push(e);for((b.toolbar.showLock||b.locked)&&(l+=g+i),(d.length>0||c.length>f.buttons.length)&&(l+=g+i);f.haveButtons()&&f.freeWidth()<l;)f.buttons.pop();return f.buttons.length}function e(){var a,d,e=[].concat(b.toolbar.buttons),f=[].concat(b.toolbar.menuButtons),g=c(b.toolbar.style.width,e,f);for(b.filteredButtons=[],b.filteredMenuButtons=[],a=0;g>a&&e.length;++a)b.filteredButtons.push(e.pop());for(b.filteredButtons.reverse();e.length;)d=e.pop(),"sel-toolbar-icon-separator"!==d.buttonClass&&b.filteredMenuButtons.push(d);for(;f.length;)b.filteredMenuButtons.push(f.shift())}function k(a){b.locked=a,b.toolbar.showMenu=!1,m.then(function(){e()})}var l=d(),m=l.promise;b.filteredButtons=[],b.filteredMenuButtons=[],b.selectionInfo={show:!1,selected:0,total:0},b.lassoEnabled=!1,this.confirm=function(){b.selectionsApi.confirm()},this.close=function(){b.destroyComponent()},b.buttonAction=function(a,c){a.originalEvent.preventDefault(),c.action.call(b.toolbar)},b.buttonIsDisabled=function(a){return"function"==typeof a.isDisabled?a.isDisabled.call(b.toolbar):!1},b.menuAction=function(c){var d=a(c.target).scope();c.originalEvent.preventDefault(),d.button.action.call(b.toolbar),b.toolbar.showMenu=!b.toolbar.showMenu},b.toggleShowMenu=function(a){a.originalEvent.preventDefault(),b.toolbar.showMenu=!b.toolbar.showMenu},b.toggleLasso=function(){b.lassoEnabled=!b.lassoEnabled,b.toolbar.toggleLasso(b.lassoEnabled)},b.toggleLock=function(a){a.originalEvent.preventDefault(),b.toolbar.backendApi.isLocked()?(b.toolbar.selectionsApi.selectionsMade=!0,b.toolbar.backendApi.unlock()):b.toolbar.backendApi.lock()},b.$watch("toolbar.backendApi.isLocked()",function(a){void 0!==a&&k(a?!0:!1)}),b.$watch("toolbar.position",function(a){a&&(b.toolbar.style=a,l.resolve(),k(b.toolbar.backendApi.isLocked?b.toolbar.backendApi.isLocked():!1))}),b.$watch("toolbar.menuMaxHeight",function(a){a&&(b.toolbar.menuStyle={maxHeight:a})}),b.$watch("options.lassoEnabled",function(a){b.lassoEnabled=a})}]}}),define("client.views/selection-toolbar/selection-toolbar-service",["qvangular","client.views/selection-toolbar/selection-toolbar","util","core.utils/notification","angular"],function(a,b,c,d){return a.service("qvSelectionToolbarService",["$document",function(a){function e(a){var b,c,d,e,f=a[0].getBoundingClientRect();return a.is("th, td")&&(c=a.closest("table")[0].getBoundingClientRect(),b=a.prevAll(),d=b.length?b.last():a,e=d[0].getBoundingClientRect(),e.left-c.left===1)?{top:f.top,left:f.left-1,width:f.width}:f}var f,g,h,i=a.find("body");return f={open:function(d,f){var j=e(d);f.toolbar=c.extend(!0,f.toolbar,{position:{top:j.top-40,left:j.left,width:j.width+(f.offsetWidth||0)}}),g=a.find(".qv-selection-toolbar"),0===g.length&&(g=angular.element("<div>")),h=g.showComponent(b,f),g.appendTo(i)},close:function(){this.Closed.emit(),h&&(h.close(),h=void 0),g&&g.remove()},confirm:function(){h&&(h.confirm(),h=void 0),this.close()}},d.create(f,"Closed"),f}])}),define("text!objects/throbber/throbber.ng.html",[],function(){return'<div ng-show="progress" class="qv-animate progress ng-hide">\r\n	<div class="progress-loader" style="width:20%;height:20%;position:absolute;top:40%;left:40%"></div>\r\n</div>\r\n'}),define("objects/throbber/throbber",["qvangular","text!./throbber.ng.html"],function(a,b){a.directive("qvThrobber",["$timeout",function(a){return{replace:!0,template:b,restrict:"E",scope:{model:"=",progress:"=",delay:"=",disabled:"="},link:function(b){var c;b.$watch("model.isValidating",function(d){return b.disabled===!0?void(b.progress=!1):void(b.model&&void 0===b.model.state?b.progress=!0:d?(c&&a.cancel(c),c=a(function(){b.model&&b.model.isValidating&&(b.progress=!0)},b.delay||1e3)):b.progress=!1)})}}}])}),define("text!general.services/loader/rain/rain.ng.html",[],function(){return'<div class="rain progress" ng-class="{\'qv-fade-out\': fadeOut}">\r\n	<div class="rain-progress" ng-style="rainStyle">\r\n		<div class="progress-div rotating" ng-class="ngClasses">\r\n		</div>\r\n	</div>\r\n	<div class="qv-loader-text" ng-if="messageObj" ng-class="ngClasses">\r\n		<div ng-show="messageObj.task" q-translation="{{messageObj.task}}"></div>\r\n		<div ng-show="messageObj.message" q-translation="{{messageObj.message}}"></div>\r\n	</div>\r\n</div>\r\n'}),define("general.services/loader/rain/rain",["qvangular","text!../rain/rain.ng.html"],function(a,b){a.directive("qvRain",[function(){return{replace:!0,template:b,restrict:"E",scope:{show:"=",resize:"="},link:function(a,b){function c(){var c=b[0].getBoundingClientRect(),d=Math.min(c.width,c.height);d=.3*d,a.rainStyle.height=d+"px",a.rainStyle.width=d+"px",a.rainStyle.top=(c.height-d)/2,a.rainStyle.left=(c.width-d)/2}a.rainStyle={},a.$watch("show",function(a){void 0!==a&&a&&c()}),a.resize&&a.resize(c),c()}}}])}),define("objects/object",["jquery","qvangular","core.utils/deferred","general.utils/visualizations","objects.models/visualization-object","objects.utils/layout","objects.utils/type-loader","text!./object.ng.html","pubsub","client.utils/state","objects.extension/extension-type","util","objects.requirements/requirements","objects.error-handling/error-handler","core.utils/resize","objects.extension/base-controller","storytelling.views/library/library","objects.error-handling/invalid-type","objects.utils/resize","client.views/selection-toolbar/selection-toolbar-service","objects/throbber/throbber","general.services/loader/rain/rain"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a){a.selectionsApi&&a.selectionsApi.active&&a.selectionsApi.confirm()
}function r(a,c){function d(){return!a.options||a.options.isVisible!==!1}function e(){q(c)}function f(){d()&&(b.$apply(a,function(){c.resize()}),c.throbberApi.resize())}function g(){h||(h=setTimeout(function(){f(),clearTimeout(h),h=null},100))}var h;a.$on("resizeCell",function(){g()}),i.subscribe("/ui/object/resize."+a.$id,function(){g()}),o.on("start."+a.$id,e),a.$on("$destroy",function(){clearTimeout(h),i.unsubscribe("."+a.$id),o.off("start."+a.$id,e)})}function s(a,b){function c(c){a.layout=c,b.setLayout(c,a.options)}function d(a){b.setModel(a)}var f;a.object._forcePaint=!0,f=e.bindLayout(a,"model",c,d),a.$on("$destroy",function(){f&&f()})}function t(a,b,c,d){function e(){return!a.options||a.options.isVisible!==!1}var g,h,i,k,l;b.setObjectClass=function(d){(d||void 0===k)&&(k=c[0].clientWidth),(d||void 0===l)&&(l=c[0].clientHeight);var e=f.getLayoutMode(k,l),g=b.type&&b.type.type,h=[];if(a.ext&&j.state===j.States.snapshot){var i=b.canTakeSnapshot()?"qv-snapshot-enabled":"qv-snapshot-disabled";h.push(i)}b.selectionsApi&&b.selectionsApi.active&&h.push("qv-selections-active"),b.objectSize={w:k,h:l},a.options.layoutMode=e,a.inlineEdit=e>=f.LayoutMode.XSMALL&&a.editmode&&!b.isReadonly;var m="qv-layout-"+f.getLayoutModeKey(e);h.push(m),a.objectClass="qv-object-"+g,h.push(a.objectClass),b.selectionClass&&h.push(b.selectionClass),a.classList=h},b.update=function(){this.valid&&(this.loadContent(),g=x(function(){b.setObjectClass(),b.backendApi&&b.backendApi.updateCache(a.layout);var c=d.childLoaded();a.rpcId=c.rpcId,c.then(function(a){try{a.onPaint(e())}catch(c){throw b.errorMessage="Object.ErrorMessage.RenderingFailed",b.content=n,d.resetChildController(),h=x(function(){d.childLoaded().then(function(a){a.onPaint(!0)})}),c}})}))},b.resize=function(){e()&&(i=x(function(){b.setObjectClass(!0),d.childLoaded().then(function(a){a.onResize()})}))},b.onResize=function(){d.childLoaded().then(function(a){a.onResize()})},a.$on("$destroy",function(){x.cancel(g),x.cancel(h),x.cancel(i)})}function u(a,e,f,g){function h(){var b={options:a.options,object:f,layout:a.layout,ext:f.ext};return f.ext.showRequirements(b)?m:f.ext.hasError(b)?n:f.ext}var i=c();f.loaded=i.promise,f.valid=!1,f.loadContent=function(){var a=h();this.content!==a&&(void 0!==this.content&&(g.resetChildController(),g.childLoaded().then(function(a){a.onStateChanged(j)})),this.content=a)},f.reset=function(){this.valid&&(a.options=l.extend({},a.resetOptions),i=c(),this.loaded=i.promise,this.valid=!1)},f.validate=function(){this.valid||this.layout&&this.type&&this.ext&&(this.valid=!0,i.resolve())},f.setExtension=function(b){this.ext=b,a.ext=b,"invalid"!==b.type&&(b.mapProperties(),this.setBackendApi(),this.updateSnapshot()),this.validate(),this.update(),this.ext.model=this.model},f.setBackendApi=function(){var b=a.options.APIType||this.ext.BackendApi,c=this.backendApi=new b(this.model);g.childLoaded().then(function(a){a.setBackendApi(c)})},f.setType=function(c,d){this.backendApi&&this.backendApi.destroy(),this.ext=null,this.backendApi=null,this.hasContent=!1,this.type=c,c.load().then(function(h){f.type===c&&(c!==y&&(f.errorMessage=null),f.setExtension(h),v(a,e,f,g),d&&b.$rootScope.$broadcast("refreshPropertyPanel"))},function(){f.setType(y),f.errorMessage="Object.ErrorMessage.NotFound",f.isInvalid=!0})},f.setModel=function(a){this.model=a,this.ext&&(this.ext.model=a,this.setBackendApi())},f.setLayout=function(a){this.layout=a;var b=a.visualization||a.qInfo.qType,c=d.getType(b);a.qError&&(c=y,this.errorMessage="Object.Invalid.Info"),c||(c=y,this.errorMessage="Object.ErrorMessage.NotFound"),this.type!==c&&(this.reset(),this.setType(c,!!this.type)),this.isInvalid=c===y,this.isLink=!this.isInvalid&&!!a.qExtendsId,this.showTitles=a.showTitles!==!1,this.validate(),this.update()}}function v(c,d,e,f){function g(b){var c=a(b.target);e.selectionsApi.ignoreOnOutside(c)||(e.selectionsApi.getDockToElement().off(".object"),e.selectionsApi.confirm())}e.activateSelections=function(){"undefined"!=typeof e.ext.options.selections&&f.childLoaded().then(function(a){a.allowInteraction(j)&&e.selectionsApi.activate()})},e.selectionsApi&&"function"==typeof e.selectionsApi.destroy&&e.selectionsApi.destroy(),e.selectionsApi={destroy:function(){this._activatedCallbacks=[],this._deactivatedCallbacks=[]},active:!1,selectionsMade:!1,_activatedCallbacks:[],_deactivatedCallbacks:[],on:function(){},off:function(){},ignoreOnOutside:function(a){return!(!a.closest(".qv-selection-toolbar").length&&!a.closest(".selections-data-area-ui").length)},getDockToElement:function(){return d},getMenuMaxHeight:function(){return e.selectionsApi.getDockToElement().outerHeight()},getSelectionToolbarWidthOffset:function(){return 0},watchActivated:function(a){return this._activatedCallbacks.push(a),function(){var b=this._activatedCallbacks.indexOf(a);this._activatedCallbacks.splice(b,1)}.bind(this)},activated:function(a){this.active=!0,a||e.backendApi.beginSelections(),b.$rootScope.selectionObject=e.backendApi,c.options.isPopover||(this.getDockToElement().on("qv-outside.object",g),b.$apply(c,function(){e.setObjectClass(),e.getSelectionToolbar().then(function(a){z.open(e.selectionsApi.getDockToElement(),{toolbar:a,selectionsApi:e.selectionsApi,options:c.options,menuMaxHeight:e.selectionsApi.getMenuMaxHeight(),offsetWidth:e.selectionsApi.getSelectionToolbarWidthOffset()})})})),this._activatedCallbacks.forEach(function(a){a.call(this)},this)},watchDeactivated:function(a){return this._deactivatedCallbacks.push(a),function(){var b=this._deactivatedCallbacks.indexOf(a);this._deactivatedCallbacks.splice(b,1)}.bind(this)},deactivated:function(){this.active=!1,this.selectionsMade=!1,c.options.isPopover||(e.selectionsApi.getDockToElement().off(".object"),b.$apply(c,function(){e.setObjectClass(),z.close()})),this._deactivatedCallbacks.forEach(function(a){a.call(this)},this)},confirm:function(){e.selectionsApi.deactivateSearch&&e.selectionsApi.deactivateSearch(),e.backendApi.endSelections(!0),this.deactivated(),b.$rootScope.selectionObject=null},cancel:function(){e.selectionsApi.deactivateSearch&&e.selectionsApi.deactivateSearch(),e.backendApi.endSelections(!1),this.deactivated(),b.$rootScope.selectionObject=null},clear:function(){e.backendApi.clearSelections()},toggleKeyboardAccelerators:function(){},getKeyAsToggleSelected:function(a){return!(a.metaKey||a.ctrlKey)},search:function(){},confirmSearch:function(){},cancelSearch:function(){},activate:function(){this.active||this.activated()}}}function w(a,b){function c(c,d){b.selectionsApi&&b.selectionsApi.active?b.throbberApi.hide():a.model&&void 0===a.model.state?b.throbberApi.show():c?(x.cancel(e),e=x(function(){a.model&&a.model.isValidating&&b.throbberApi.show()},d)):(b.throbberApi.hide(),b.throbberApi.isLongRunningQuery=!1),x.cancel(f),f=x(function(){b.throbberApi.isVisible===!0&&(b.throbberApi.isLongRunningQuery=!0,b.throbberApi.isQueryCanceled=!1)},8e3)}var d,e,f;b.throbberApi&&"function"==typeof b.throbberApi.destroy&&b.throbberApi.destroy(),b.throbberApi={resizeCallbacks:[],isVisible:!1,isLongRunningQuery:!1,isQueryCanceled:!1,initialize:function(){d=a.$watch("model.isValidating",function(a){c(a,1e3)})},reset:function(a){c(a,0)},show:function(){b.throbberApi.isVisible=!0},hide:function(){b.throbberApi.isVisible=!1,b.throbberApi.isLongRunningQuery=!1},off:function(){d(),x.cancel(e),x.cancel(f)},destroy:function(){b.throbberApi.off(),b.throbberApi.resizeCallbacks.length=0},resize:function(){b.throbberApi.resizeCallbacks.forEach(function(a){a()})},watchResize:function(a){b.throbberApi.resizeCallbacks.push(a)}},b.throbberApi.initialize()}var x=b.getService("$timeout"),y=new k("objects.error-handling/invalid-type","invalid"),z=b.getService("qvSelectionToolbarService"),A=b.getService("storyItemsLibrary");b.componentDirective("qvObjectContent",{object:"=",backendApi:"=",ext:"=",options:"=",layout:"=",selectionsApi:"=",throbberApi:"="}),b.directive("qvObject",function(){return{restrict:"E",replace:!0,template:h,scope:{options:"=",model:"=",object:"=?",zoomOnCell:"&"},controller:function(){var a=c();this.addChildController=function(b,c){b instanceof p||(b=new(p.extend(b)),b.$scope=c),a.resolve(b)},this.resetChildController=function(){a=c()},this.childLoaded=function(){return a.promise}},link:function(b,c,d,e){var f,h=b.object={};b.resetOptions=l.extend({},b.options),b.options||(b.options={}),b.$on("objectTrigger",function(a,c){switch(c){case"zoomOnCell":b.zoomOnCell&&b.zoomOnCell()}a.stopPropagation()}),Object.defineProperties(h,{hasFrame:{get:function(){return!b.options.isPopover&&!h.isInvalid}},isReadonly:{get:function(){return h.isLink||h.isInvalid||b.options.isReadonly}},haveTitleArea:{get:function(){var a=this.layout;return this.showTitles&&(""!==a.title||""!==a.subtitle||j.state===j.States.edit&&!this.isReadonly)}}}),h.getPropertyPanelContent=function(){return h.loaded.then(function(){var a=h.ext.getCreatePropertyHandler(),b=h.ext.mappedDefinition||h.ext.definition,c=h.ext.globalChangeListeners;return{definition:b,globalChangeListeners:c,type:h.type.type,backendApi:h.backendApi,handler:a,iconClass:h.ext.libraryInfo.templateIconClassName,titleRef:"title",ext:h.ext}})},h.setSnapshotData=function(a){return e.childLoaded().then(function(b){return b.setSnapshotData(a)})},h.getDropOptions=function(a,b){return h.ext.getDropOptions(h,a,b)},h.getContextMenu=function(a){return e.childLoaded().then(function(b){return b.getContextMenu(h,a)})},h.getObjectMenu=function(a){return e.childLoaded().then(function(b){return b.getObjectMenu(h,a)})},h.getSelectionToolbar=function(){return h.loaded.then(function(){return e.childLoaded().then(function(a){return a.getSelectionToolbar()})})},h.reloadContent=function(){b.ext=h.ext=a.extend({},h.ext),h.loadContent()},h.canTakeSnapshot=function(){return this.content!==m&&this.content!==n&&b.model.isValid?"function"==typeof b.ext.snapshot.canTakeSnapshot?b.ext.snapshot.canTakeSnapshot.call(null,h):"boolean"==typeof b.ext.snapshot.canTakeSnapshot?b.ext.snapshot.canTakeSnapshot:!1:void 0},h.updateSnapshot=function(){var a=j.state===j.States.snapshot;h.ext&&a?h.ext.snapshot.updateCount(b).then(function(a){b.showSnapshotCount=h.canTakeSnapshot()&&a>0}):b.showSnapshotCount=!1},h.setInteraction=function(a){e.childLoaded().then(function(b){b.setInteraction(a)})},b.$watch(function(){return j.state},function(a){var c=e.childLoaded();b.rpcId=c.rpcId,c.then(function(c){b.editmode=a===j.States.edit,b.editmode&&q(h),h.updateSnapshot(),c.onStateChanged(j),x.cancel(f),f=x(function(){h.setObjectClass()})})}),u(b,c,h,e),r(b,h),t(b,h,c,e),g.load().then(function(){s(b,h)}),h.loaded.then(function(){b.cancelled=b.model.isCancelled}),b.$watch("options",function(a){a&&a.setController&&e.childLoaded().then(function(){a.setController(h)})}),b.$on("childSelectionActive",function(a,b){h.childInSelection=b,a.preventDefault()}),b.takeSnapshot=function(a){j.state===j.States.snapshot&&h.canTakeSnapshot()&&(b.ext.snapshot.take(this,h,a),b.showSnapshotCount=!0)},b.openSnapshotLibrary=function(a){a.stopImmediatePropagation(),A.openLibrary({event:a,library:"snapshot",objectId:this.layout.qInfo.qId})},b.titleClicked=function(){b.editmode||h.activateSelections()},b.cancel=function(){b.model.__layoutRPCId&&(b.model.cancelRequest(b.model.__layoutRPCId),delete b.model.__layoutRPCId,h.throbberApi.hide(),h.throbberApi.isQueryCanceled=!0)},b.retry=function(){h.throbberApi.hide(),h.throbberApi.isQueryCanceled=!1,h.throbberApi.reset(!0),b.model.markAsInvalid(),b.model.getLayout().then(function(a){b.layout=a,h.setLayout(a)})},w(b,h,e),b.$on("$destroy",function(){x.cancel(f),h&&(q(h),h.selectionsApi&&"function"==typeof h.selectionsApi.destroy&&h.selectionsApi.destroy(),h.backendApi&&(h.backendApi.destroy(),h.backendApi=null),h.throbberApi&&h.throbberApi.destroy(),h=null,b.object=null)})}}})}),define("text!client.views/current-selections/current-selections.ng.html",[],function(){return'<div class="qv-panel-subtoolbar qv-panel-current-selections" ng-class="{smallDevice: isSmallDevice}">\r\n	<div ng-if="!isSmallDevice">\r\n		<div class="qv-pager">\r\n\r\n			<div class="buttons borderbox">\r\n\r\n				<button class="qv-subtoolbar-button borderbox" qva-activate="back()" ng-disabled="disable.back" q-title-translation="Tooltip.NavigateBack">\r\n					<i class="icon-toolbar-navigation-back"></i>\r\n				</button>\r\n\r\n				<button class="qv-subtoolbar-button borderbox" qva-activate="forward()" ng-disabled="disable.forward" q-title-translation="Tooltip.NavigateForward">\r\n					<i class="icon-toolbar-navigation-forward"></i>\r\n				</button>\r\n\r\n				<button id="clearselections" class="qv-subtoolbar-button borderbox" ng-disabled="disable.clear" qva-activate="clearAllFields()" q-title-translation="Tooltip.ClearSelections">\r\n					<i class="icon-toolbar-clearselections"></i>\r\n				</button>\r\n\r\n			</div>\r\n			<div class="selections-shadow" ng-if="showShadow"></div>\r\n			<div class="wrap borderbox" style="height: 100%;" qv-pager>\r\n				<ul class="list" ng-show="items.length > 0 && !isGlobalSelectionsActive" qva-delegated-activate=".item#showPopover($event)" qva-outside-ignore-for="currentSelectionsItems">\r\n					<li ng-repeat="item in items track by item.qField" data-csid="{{item.qField}}">\r\n						<div class="item" ng-mousemove="openTooltip($event, item)" ng-mouseleave="closeTooltip()" ng-class="{\r\n				\'active\' : item.qField === activeFieldName,\r\n				\'dim\' : $parent.itemSelected && !item.active,\r\n				\'item-locked\' : item.qLocked,\r\n				\'locked-feedback item-animate-in\' : item.feedbackActive && item.qLocked,\r\n				\'item-animate-out\' : !item.feedbackActive && item.qLocked }">\r\n							<div ng-class="{locked:item.qLocked}" class="text">\r\n								<div class="text-wrap">\r\n									<span ng-class="{ \'icon-toolbar-locked\': item.qLocked }"></span><span class="name">{{item.qField}}</span>\r\n								</div>\r\n								<span class="values">{{item.translation}}</span>\r\n							</div>\r\n						<span ng-class="{\r\n						\'icon-toolbar-locked\': item.qLocked,\r\n						\'item-animate-in\' : item.feedbackActive,\r\n						\'item-animate-out\' : !item.feedbackActive,\r\n						\'icon-locked-feedback\' : item.feedbackActive && item.qLocked }">\r\n						</span>\r\n							<div class="options">\r\n								<a ng-if="!item.qLocked" qva-activate="clear(item.qField)" class="remove" q-title-translation="CurrentSelections.Remove">\r\n									<i class="icon-cancel"></i>\r\n								</a>\r\n							</div>\r\n\r\n							<qv-state-count-bar cardinal="item.qTotal" state-counts="item.qStateCounts"></qv-state-count-bar>\r\n						</div>\r\n					</li>\r\n				</ul>\r\n\r\n				<div ng-if="!items.length" class="empty-text no-selection" q-translation="CurrentSelections.NoSelections"></div>\r\n				<a class="qv-pager-nav qv-pager-previous" qva-activate="prevPage()" q-title-translation="Tooltip.Previous"><i class="icon-hub-previous"></i></a>\r\n				<a class="qv-pager-nav qv-pager-next" qva-activate="nextPage()" q-title-translation="Tooltip.Next"><i class="icon-hub-next"></i></a>\r\n			</div>\r\n			<div class="buttons-end borderbox">\r\n				<button tid="toggleGlobalSearchButton" class="qv-subtoolbar-button global-search-button borderbox" ng-class="{active: isGlobalSearchActive}" qva-activate="toggleGlobalSearch()" q-title-translation="{{isGlobalSearchActive ? \'Tooltip.CloseGlobalSearch\' : \'Tooltip.GlobalSearch\'}}">\r\n					<i class="icon-toolbox-search-magnifier"></i>\r\n				</button>\r\n\r\n				<button class="qv-subtoolbar-button borderbox" ng-class="{active: isGlobalSelectionsActive}" qva-activate="toggleGlobalSelection($event)"\r\n					q-title-translation="{{isGlobalSelectionsActive ? \'Tooltip.CloseGlobalSelector\' : \'Tooltip.GlobalSelector\'}}" tid="currentSelections.toggleGlobalSelections">\r\n					<i class="icon-toolbar-currentselections"></i>\r\n				</button>\r\n			</div>\r\n\r\n		</div>\r\n	</div>\r\n	<div ng-if="isSmallDevice && mobileIndicatorShow && !inSelection " qva-activate="toggleGlobalSelection($event)" class="qv-current-selections-mobile-wrapper" tid="currentSelections.toggleMobileSelections" q-title-translation="GlobalSelections.CurrentSelections">\r\n		<div class="qv-current-selections-mobile-background">\r\n			<p class="qv-current-selections-mobile-nbr" ng-class="{selections: nbrSelections > 0}">{{nbrSelections}}</p>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("objects.models/listbox",["objects.models/visualization-object","general.utils/visualizations","objects.utils/data-properties/listobject-util","util","objects.utils/type-loader"],function(a,b,c,d,e){var f,g=[];return f=a.extend("Listbox",{}),f.createTransient=function(c,d,f){var h,i,j,k=-1,l=g.length;for(h={that:c,app:d,props:f},i=0;l>i;i++)if(angular.equals(g[i].askFor,h)){k=i;break}return k>=0?g[k].result:(j=e.load().then(function(){return b.getType("listbox").getInitialProperties(f).then(function(b){return a.createTransient.call(c,b,d)})}),g.push({askFor:h,result:j}),j)},f.createTransientField=function(a,b,e){var f={};return f.qListObjectDef=c.createFieldDimension(b),d.extend(!0,f,e||{}),this.createTransient(this,a,f)},f.createTransientDimension=function(a,b,e){var f={};return f.qListObjectDef=c.createLibraryDimension(b),d.extend(!0,f,e||{}),this.createTransient(this,a,f)},f}),define("objects/listbox-popover/listbox-popover",["core.utils/deferred","core.utils/resize"],function(a,b){var c={template:null,controller:["$scope","$element","$timeout",function(c,d,e){function f(){e(function(){c.destroyComponent(),d.remove()}),b.off("start.listbox-popover-error",f)}function g(){return e(function(){return d.find(".toolbar-wrapper").outerWidth()})}var h=this;h.selectionsActivated=function(){},h.selectionsDeactivated=function(){},h.close=function(){f()},a.all({object:c.getVisualization(),width:g()}).then(function(a){var d=a.object,e=a.width;d.getSelectionToolbar().then(function(a){c.toolbar=a,c.toolbar.showLock=c.options.showLock,c.toolbar.position={width:e},d.activateSelections()}),d.loaded.then(function(){d.ext.hasError({layout:d.model.layout})&&b.on("start.listbox-popover-error",f)}),d.selectionsApi.watchActivated(function(){h.selectionsActivated()}),d.selectionsApi.watchDeactivated(function(){h.selectionsDeactivated(),f()}),c.closeView=function(a){d.selectionsApi.confirm(),c.onPopoverClose(a),f()}})}]};return c}),define("text!objects/listbox-popover/listbox-popover.ng.html",[],function(){return'<immidiate-contextual\r\n		class="qv-listbox-popover"\r\n		align-to="$alignToElement"\r\n		position="popupPosition"\r\n		collision="collision"\r\n		width="234"\r\n		height="332"\r\n		on-close-view="closeView(event)"\r\n		qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\r\n	<div class="toolbar-wrapper"\r\n		qva-include-selection-toolbar\r\n		component="selectionToolbarComponent"\r\n		toolbar="toolbar"\r\n		options="options"></div>\r\n	<div class="listbox-wrapper" >\r\n		<qv-object object="object" model="model" options="options"></qv-object>\r\n	</div>\r\n</immidiate-contextual>\r\n'}),define("text!objects/listbox-popover/listbox-popover-small-device.ng.html",[],function(){return'<div\r\n	class="qv-listbox-popover-small-device">\r\n	<div class="toolbar-wrapper"\r\n		qva-include-selection-toolbar\r\n		component="selectionToolbarComponent"\r\n		toolbar="toolbar"\r\n		options="options">\r\n	</div>\r\n	<h1 class="qvt-visualization-title">{{model.layout.title || model.layout.qListObject.qDimensionInfo.qFallbackTitle}}</h1>\r\n	<div class="listbox-wrapper">\r\n		<qv-object object="object" model="model" options="options"></qv-object>\r\n	</div>\r\n</div>\r\n'}),define("objects/listbox-popover/listbox-popover-service",["qvangular","util","core.models/app","core.utils/deferred","objects.models/listbox","client.views/selection-toolbar/selection-toolbar","objects/listbox-popover/listbox-popover","general.utils/responsive-state","text!./listbox-popover.ng.html","text!./listbox-popover-small-device.ng.html","objects/object","general.components/immidiate-contextual/immidiate-contextual"],function(a,b,c,d,e,f,g,h,i,j){return a.service("qvListboxPopoverService",["$document",function(a){var k,l,m,n=a.find("body");return l={show:function(a,c,e,l){var o=d(),p={$alignToElement:c.$alignToElement,popupPosition:c.position||"bottom",collision:c.collision||"none",qvaOutsideIgnoreFor:c.qvaOutsideIgnoreFor,getVisualization:function(){return o.promise},model:a,onPopoverClose:this.onPopoverClose,options:{setController:o.resolve,isPopover:!0,showLock:c.showLock,search:c.search||{}},selectionToolbarComponent:f};return m&&(m.selectionsActivated=function(){},m.selectionsDeactivated=function(){},m.close()),k=angular.element("<div>"),n.append(k),g.template=h.isSmallDevice?j:i,m=k.showComponent(g,p),m.selectionsActivated=function(){b.isFunction(l)&&l()},m.selectionsDeactivated=function(){b.isFunction(e)&&e(),e=null,l=null},m},showField:function(a,b,f,g,h){return e.createTransientField(c.current,a,f).then(function(a){return d.resolve(this.show(a,b,g,h))}.bind(this))},showDimension:function(a,b,d,f,g){e.createTransientDimension(c.current,a,d).then(function(a){this.show(a,b,f,g)}.bind(this))},close:function(){m&&m.close()},onPopoverClose:function(){}}}])}),define("widget.pager",["jquery","jqueryui"],function(a){return a.widget("qv.pager",{options:{itemSelector:">li",orientation:"horizontal",pageSize:"auto",startPage:1,animationDuration:300},_create:function(){var b=this.options;a.extend(this,{positionProperty:"horizontal"===b.orientation?"left":"top",sizeProperty:"horizontal"===b.orientation?"outerWidth":"outerHeight"}),this.refresh(),this.goToPage(b.startPage)},isItemInsidePage:function(b){var c=a(b),d=c.position()[this.positionProperty]+c[this.sizeProperty](),e=Math.abs(parseFloat(c.parent().css("margin-"+this.positionProperty))),f=e+this.containerSize;return d>e&&f>d},calculatePageSize:function(){return Math.floor(this.containerSize/this.calculateItemSize())},calculateItemSize:function(){return this.element.find(this.options.itemSelector).eq(0)[this.sizeProperty]()},refresh:function(){var a=this.currentPage||1;this.containerSize=this.element.parent()[this.sizeProperty](),this.pageSize="auto"===this.options.pageSize?this.calculatePageSize():this.options.pageSize,this.itemSize=this.calculateItemSize(),this.maxPages=Math.ceil(this.element.find(this.options.itemSelector).length/this.pageSize||1),this.currentPage=Math.min(a,this.maxPages),this.goToPage(this.currentPage)},goToPage:function(a){this.currentPage=Math.min(Math.max(1,a),this.maxPages);var b=(this.currentPage-1)*this.itemSize*this.pageSize,c={};c[this.positionProperty]=-b+"px",this.element.stop(!0).animate(c,this.options.animationDuration)},goToPreviousPage:function(){this.goToPage(this.currentPage-1)},goToNextPage:function(){this.goToPage(this.currentPage+1)},goToPageContaining:function(a){var b=Math.ceil(this.element.find(a).index()+1/this.pageSize);this.goToPage(b)},_destroy:function(){this.element.off(this.eventNamespace)}}),a}),define("text!client.views/global-selections/global-selections.ng.html",[],function(){return'<div class="qv-global-selections" ng-style="{paddingTop: toolbarHeight}">\r\n\r\n	<section class="qv-gs-section qv-gs-top" tid="globalSelections.topSection">\r\n		<header class="qv-gs-header">\r\n			<h2 q-translation="GlobalSelections.CurrentSelections"></h2>\r\n		</header>\r\n		<div qv-global-select-section="{ itemSize: 220, itemSpacing: 20, type: \'fields\' }" all-items="selectedFields"></div>\r\n	</section>\r\n\r\n	<section class="qv-gs-section" tid="globalSelections.bottomSection">\r\n		<header class="qv-gs-header">\r\n			<h2 q-translation="GlobalSelections.AppDimensions"></h2>\r\n			<qui-checkbox qui-model="showFields" qui-label="{{\'GlobalSelections.ShowFields\'|translate}}" qui-title="{{\'GlobalSelections.ShowFields\'|translate}}" tid="globalSelections.showFields"></qui-checkbox>\r\n			<qui-search-field class="qv-gs-searchfield" placeholder="GlobalSelections.FilterDimensionsAndFields" query="filter" maxlength="255"\r\n							 tid="globalSelections.searchField" on-escape="filter = \'\';" auto-focus="autoFocus" on-enter="onEnter($event)"></qui-search-field>\r\n		</header>\r\n\r\n		<div class="qv-gs-info" ng-if="!dimAvailable && !showFields">\r\n			<h2 q-translation="GlobalSelections.DimensionsWarning"></h2>\r\n		</div>\r\n		<div qv-global-select-section="{ itemSize: 220, itemSpacing: 20, type: \'dimensions\'}" all-items="dimensionsFields" filter="filter"></div>\r\n	</section>\r\n</div>\r\n'}),define("text!assets/client/dialogs/confirm-dialog/confirm-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="confirm-dialog" qv-cancel="cancel()" qv-confirm="confirm()">\r\n	<main class="dm-main">\r\n		<div class="qv-mvc-dialog-content">\r\n			<div class="qv-mvc-dialog-icon icon-{{icon}}" ng-show="icon"></div>\r\n			<p><span q-translation="{{text}}"></span></p>\r\n		</div>\r\n	</main>\r\n	<qv-confirm-cancel-footer qv-confirm="confirm()" qv-cancel="cancel()" qv-confirm-label="{{$parent.confirmLabel}}"></qv-confirm-cancel-footer>\r\n</qv-modal-dialog>\r\n'}),define("general.utils/tabbable-elements",["jquery","jqueryui"],function(a){var b=[];return{preventTabbing:function(c){var d={id:b.length,elements:c.find(":tabbable")};b.push(d),d.elements.each(function(){var b=a(this);b.data("tabbable-elements-tabindex",b.attr("tabindex"))}),d.elements.attr("tabindex","-1")},restoreTabbing:function(){var c=b.pop();c.elements.each(function(){var b=a(this),c=b.data("tabbable-elements-tabindex");c?b.attr("tabindex",c):b.removeAttr("tabindex")})}}}),define("assets/client/dialogs/directives/tabbable-container",["qvangular","general.utils/tabbable-elements","jquery"],function(a,b,c){a.directive("qvTabbableContainer",function(){return{restrict:"A",controller:["$scope","$element",function(a,d){var e=d[0].nextSibling,f=d[0].parentNode;f.removeChild(d[0]),b.preventTabbing(c(document.body)),document.activeElement&&document.activeElement.blur(),f.insertBefore(d[0],e),a.$on("$destroy",function(){b.restoreTabbing()})}]}})}),define("general.utils/keyboard-event-dispatcher",["jquery"],function(a){function b(a){Object.keys(f).forEach(function(b){f[b]=f[b].filter(function(b){return b.jackId!==a})})}function c(a){var b=Array.prototype.slice.call(arguments,1);f[a].forEach(function(a){a.jackId===g[g.length-1]&&a.handler.apply(null,b)})}function d(a,b,d){f[b]||(e.on(b,c.bind(null,b)),f[b]=[]),f[b].push({jackId:a.id,handler:d})}var e,f={},g=[],h={on:function(a,b){d(this,a,b)},release:function(){var a=this.id;b(a),g.splice(g.indexOf(a),1)}};return{hijack:function(){e||(e=a(document.body));var b=Object.create(h,{id:{value:g.length}});return g.push(b.id),b}}}),define("assets/client/dialogs/directives/escape",["qvangular","general.utils/keyboard-event-dispatcher"],function(a,b){a.directive("qvDialogEscape",["$parse",function(a){return{restrict:"A",controller:["$scope",function(a){var c=this.hijack=b.hijack();a.$on("$destroy",function(){c.release()})}],link:function(b,c,d,e){var f=a(d.qvDialogEscape);e.hijack.on("keydown",function(a){27===a.keyCode&&(a.preventDefault(),setTimeout(function(){b.$apply(function(){f(b,{$event:a})})}))})}}}])}),define("text!assets/client/dialogs/directives/modal-dialog.ng.html",[],function(){return'<div class="modal-container qui-modalbackground-centered" qv-tabbable-container>\r\n	<div id="{{id}}"\r\n		 class="modal-frame qui-delayedModal"\r\n		 ng-transclude></div>\r\n</div>\r\n'}),define("assets/client/dialogs/directives/modal-dialog",["qvangular","text!assets/client/dialogs/directives/modal-dialog.ng.html","general.utils/keyboard-event-dispatcher"],function(a,b,c){a.directive("qvModalDialog",function(){return{scope:{id:"@qvId",confirm:"&qvConfirm",cancel:"&qvCancel"},restrict:"E",transclude:!0,replace:!0,template:b,link:function(a){var b=c.hijack();a.$on("$destroy",function(){b.release()}),b.on("keydown",function(b){if(27===b.keyCode&&(b.preventDefault(),setTimeout(function(){a.$apply(function(){a.cancel()})})),13===b.keyCode){if("TEXTAREA"===b.target.tagName)return;if("BUTTON"===b.target.tagName)return;setTimeout(function(){a.$apply(function(){a.confirm()})})}})}}})}),define("text!assets/client/dialogs/directives/confirm-cancel-footer.ng.html",[],function(){return'<footer class="dm-footer">\r\n    <qui-button qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Cancel" tid="2f2a4f"></qui-button>\r\n    <qui-button qva-activate="$event.preventDefault(); confirm()" name="confirm" autofocus q-translation="{{confirmLabel}}" tid="2f2a56" ng-disabled="confirmDisabled" qva-focus="true"></qui-button>\r\n</footer>\r\n'}),define("assets/client/dialogs/directives/confirm-cancel-footer",["qvangular","text!assets/client/dialogs/directives/confirm-cancel-footer.ng.html"],function(a,b){a.directive("qvConfirmCancelFooter",function(){return{scope:{confirmLabel:"@qvConfirmLabel",confirm:"&qvConfirm",confirmDisabled:"=qvConfirmDisabled",cancel:"&qvCancel"},restrict:"E",replace:!0,template:b}})}),define("assets/client/dialogs/directives/dialog-directives",["assets/client/dialogs/directives/tabbable-container","assets/client/dialogs/directives/escape","assets/client/dialogs/directives/modal-dialog","assets/client/dialogs/directives/confirm-cancel-footer"],function(){}),define("assets/client/dialogs/confirm-dialog/confirm-dialog",["general.services/show-service/show-service","text!assets/client/dialogs/confirm-dialog/confirm-dialog.ng.html","assets/client/dialogs/directives/dialog-directives"],function(a,b){function c(b){var c=b.text,e=void 0!==b.icon?b.icon:"cogwheel",f=b.confirm||"Common.OK",g={text:c,icon:e,confirmLabel:f};return a.show(d,g).resultPromise}var d={template:b,scope:{text:"=",icon:"=",confirmLabel:"="},controller:["$scope",function(a){a.confirm=function(){a.destroyComponent(),a.deferredResult.resolve()},a.cancel=function(){a.destroyComponent(),a.deferredResult.reject()}}]};return{show:c}}),define("client.controllers/grid-controller",["core.utils/deferred","client.utils/state","objects.models/visualization-object"],function(a,b,c){function d(a,b){for(var c=[],d=0;b>d;d++){c[d]=[];for(var e=0;a>e;e++)c[d][e]=1}return c}function e(a,b){var c,d,e=b.row+b.rowspan,f=b.col+b.colspan;for(c=b.row;e>c;c++)for(d=b.col;f>d;d++)a[c][d]=0}function f(a,b){var c=a.rectFor(b);return{width:"calc( "+c.width+"% - "+2*c.margin+"px )",height:"calc( "+c.height+"% - "+2*c.margin+"px )",left:"calc( "+c.left+"% + "+c.margin+"px )",top:"calc( "+c.top+"% + "+c.margin+"px )"}}function g(a,c,d){var e=b.isInEditMode(),f=e?4:0,g=100,h=100,i=g/c,j=h/d;a.rectFor=function(a){var b=a.colspan*i,c=a.rowspan*j,d=a.col*i,e=a.row*j;return{left:d,top:e,width:b,height:c,margin:f}};var k,l=[],m=[];for(k=0;c-1>k;++k){var n=(k+1)*i;m.push({left:n+"%"})}for(k=0;d-1>k;++k){var o=(k+1)*j;l.push({top:o+"%"})}a.cols=c,a.rows=d,a.horizontalLines=l,a.verticalLines=m}function h(a,c){var d=c.qInfo.qId!==a.lastSheetId,e=!d&&b.isInEditMode()&&!a.zoomCell&&c.permissions.update;a.lastSheetId=c.qInfo.qId,a.hasUpdatePermission=c.permissions.update,a.isSheet=!0,a.isMaster=!1,a.sheetTitle=c.qMeta&&c.qMeta.title||"",a.isDraft=c.qMeta&&c.qMeta.sourceObject&&c.qMeta.sourceObject.length,a.isDraftOwner=c.qMeta&&c.qMeta.draftObject&&c.qMeta.draftObject.length,(d||!a.hasUpdatePermission)&&(a.activeCell=null),d&&(a.cells=[]),j(a,c.cells.slice(),e)}function i(a,b){var c;if(!b)return null;for(c=0;c<b.length;++c)if(b[c].id===a)return b[c];return null}function j(b,f,g){function h(a){e(q,a);var c={},d={col:a.col,row:a.row,colspan:a.colspan,rowspan:a.rowspan};b.setCellSize(c,d),c.isEmpty=!0,p.push(c)}function j(d){e(q,d);var f=i(d.name,b.cells);if(!f){f={},f.id=d.name;var h=a();f.options={setController:h.resolve,id:d.name,isVisible:!0,isOnGrid:!0,isZoomed:!1},c.get(d.name).then(function(a){f.model=a,g&&b.toggleActive(f)}),f.getVisualization=function(){return h.promise}}var j={col:d.col,row:d.row,colspan:d.colspan,rowspan:d.rowspan};b.setCellSize(f,j),f.isEmpty=!1,p.push(f)}function k(){function a(a,b,c){for(var g=a;d.length>0;){var h=d[d.length-1];
if(h.rowSpan===c)return;if(h.rowSpan<c)break;d.pop(),g=h.col;var i=a-h.col,j=h.rowSpan*i;j>e&&(e=j,f={col:h.col,row:b,colspan:i,rowspan:h.rowSpan})}c>0&&d.push({col:g,rowSpan:c})}for(var b,c,d,e,f,g=n,h=[];g--;)for(c=0,b=o,h[g]=[];b--;)q[b][g]?h[g][b]=++c:(c=0,h[g][b]=null);for(f=null,e=0,d=[],b=0;o>b;++b){for(g=0;n>g;++g)null!==h[g][b]?a(g,b,h[g][b]):a(g,b,0);a(g,b,0)}return f}function l(){for(var a,b=1;;){if(a=k(),!a)break;a.priority=b++,f.push(a),h(a)}}function m(a){a.sort(function(a,b){return a=a.pos,b=b.pos,a.row-b.row}).sort(function(a,b){return a=a.pos,b=b.pos,a.row===b.row?a.col-b.col:a.row-b.row})}var n=b.cols,o=b.rows,p=[],q=d(n,o);f.forEach(j),m(p),l(),b.cells=p}function k(){}return k.prototype.setCellSize=function(a,b){a.pos=b,a.style=f(this,b)},k.prototype.updateActiveCell=function(){function a(a,b){b>=0&&j[a]>b&&(j[a]=b)}function c(a,b){0===j[a]&&1>=b||p.push({dir:a,expand:j[a],contract:b-1})}var d=this;if(d.activeCell&&b.isInEditMode()){for(var e=d.activeCell.pos,f=e.col,g=f+e.colspan,h=e.row,i=h+e.rowspan,j={left:f,right:d.cols-g,top:h,bottom:d.rows-i},k=0;k<d.cells.length;++k)if(d.cells[k]!==d.activeCell&&!d.cells[k].isEmpty){var l=d.cells[k].pos.col,m=l+d.cells[k].pos.colspan,n=d.cells[k].pos.row,o=n+d.cells[k].pos.rowspan;i>n&&o>h&&(a("left",f-m),a("right",l-g)),g>l&&m>f&&(a("top",h-o),a("bottom",n-i))}var p=[];c("left",e.colspan),c("right",e.colspan),c("top",e.rowspan),c("bottom",e.rowspan),d.activeCell.resize=p,d.activeCell.updating=!1}},k.prototype.removeResizeHandles=function(){var a=this;a.activeCell&&delete a.activeCell.resize},k.prototype.clearActiveCell=function(){var a=this;a.removeResizeHandles(),a.activeCell=null},k.prototype.toggleActive=function(a){var c=this;b.isInEditMode()&&(!a||c.zoomCell||a.isEmpty?c.clearActiveCell():(c.clearActiveCell(),c.hasUpdatePermission&&(c.activeCell=a),c.updateActiveCell()))},k.prototype.setEditMaster=function(a,b){var c=this,d=[{name:a,type:b,col:0,row:0,colspan:1,rowspan:1}];c.lastSheetId=null,c.isSheet=!1,c.isMaster=!0,g(c,1,1),c.activeCell=null,j(c,d,!1),c.zoom(c.cells[0])},k.prototype.update=function(a){if(a){var b=this;b.layout=a,g(b,a.columns||12,a.rows||7),h(b,a),b.activeCell&&-1===b.cells.indexOf(b.activeCell)&&b.clearActiveCell(),b.zoomCell&&-1===b.cells.indexOf(b.zoomCell)&&(b.zoomCell=null),b.updateActiveCell()}},k.prototype.zoom=function(a){var b=this;b.cells&&(b.cells.forEach(function(b){b.options&&(b.options.isVisible=b===a||!a,b.options.isZoomed=b===a&&!!a)}),a?(b.clearActiveCell(),b.zoomCell=a,a.object&&(a.object.expanded=!!a)):b.zoomCell&&(b.zoomCell.object&&(b.zoomCell.object.expanded=!1),b.clearActiveCell(),b.hasUpdatePermission&&(b.activeCell=b.zoomCell),b.zoomCell=null,b.updateActiveCell()))},k.prototype.getOptimalCell=function(){var a=this,b=a.cells.slice();b.sort(function(a,b){if(a.isEmpty&&!b.isEmpty)return-1;if(b.isEmpty&&!a.isEmpty)return 1;var c=a.pos.colspan*a.pos.rowspan,d=b.pos.colspan*b.pos.rowspan;return c>d?-1:d>c?1:0});var c=b[0]||null;if(c&&!c.isEmpty)if(c.pos.colspan>1||c.pos.rowspan>1){var d=c.pos.colspan>c.pos.rowspan?"right":"bottom";c={isEmpty:!0,pos:{pos:c.pos,split:d}}}else c=null;return c},k}),define("client.services/grid-service",["qvangular","core.models/rpc-base","client.controllers/grid-controller","client.utils/state","jquery","general.services/delayed-modal/delayed-modal"],function(a,b,c,d,e){function f(){var b=a.getService("$delayedModal"),c=e.extend(!0,{},{},{title:"Ui.Warning.GridFull.Title",content:"Ui.Warning.GridFull"});b.open(c)}function g(a,b){d.setView(a);var c=e(document.body);c.toggleClass("qv-view-sheet",!b),c.toggleClass("qv-view-object",b),c.toggleClass("qv-gridzoom",b)}function h(e){var f;p||(p=a.$rootScope.$new(!0),p.grid=new c,p.model=e,b.bindLayout(p,"model",function(a){p.grid.update(a)}),p.$watch(d.isInEditMode,function(a){f=a,p.grid.update(p.grid.layout),f?p.grid.updateActiveCell():(p.grid.removeResizeHandles(),n())}),p.$watch("grid.zoomCell",function(a){if(!(m()||d.view===d.Views.story&&d.state!==d.States.analysis)){var b=a?d.Views.object:d.Views.sheet;g(b,!!a)}}),d.SheetChanged.bind(i))}function i(a){p&&(p.model=a)}function j(){p&&(p.$destroy(),p=null,d.SheetChanged.unbind(i))}function k(){var a=p&&p.grid.getOptimalCell();return a||f(),a}function l(a){p&&p.model.removeObject(a.pos)}function m(){return p&&p.grid&&!p.model}function n(){m()&&(i(d.model),g(d.Views.sheet,!1))}function o(a,b){p&&(p.model=null,p.grid.setEditMaster(a,b),g(d.Views.masterObject,!0))}var p=null;return{start:h,stop:j,goToEditMode:function(){d.setState(d.States.edit)},getOptimalCell:k,removeCell:l,isActive:function(){return!!p},getGrid:function(){return p&&p.grid},getModel:function(){return p&&p.model},getActiveCell:function(){return p&&(p.grid.activeCell||p.grid.zoomCell)},activateCell:function(a){p&&p.grid.toggleActive(a)},deactivateCell:function(){p&&p.grid.toggleActive(null)},getZoomCell:function(){return p&&p.grid.zoomCell},zoomOut:function(){p&&p.grid.zoom(null)},isEditMaster:m,closeEditMaster:n,editMaster:o}}),define("client.assets/assets-utils",["jquery","util","assets/client/dialogs/confirm-dialog/confirm-dialog","pubsub","client.utils/state","client.services/grid-service"],function(a,b,c,d,e,f){function g(a,b){c.show({text:a}).then(b)}function h(a){if(!j)throw new TypeError("Permissions are not available yet. Make sure you have initialized this module with init().");switch(a){case"measure":return j.createMeasure;case"dimension":return j.createDimension;case"visualization":return j.createMasterobject;default:throw new TypeError("'"+a+"' is an unknown type.")}}var i,j,k={init:function(b,c){i=b,c&&(j=a.extend({},c))},getContextMenuAddToText:function(){var a=f.getActiveCell();return a?"contextMenu.addToVisualization":"contextMenu.addToSheet"},getAddToOptions:function(){var a=f.getActiveCell(),b=null;return e.isInEditMode()&&(b={},a?b.object=!0:b.sheet=!0),b},getAddToText:function(){var a=f.getActiveCell();return e.isInEditMode()?a?"library.addtoVisualization":"library.addtosheet":null},addItemToSheetOrVisualization:function(a){if(this.isAddToMode()){var b=f.getActiveCell(),c={item:a};b&&(c.cell=b),d.publish("/ui/library/addToSheet",c)}},isPublishedApp:function(){return i},librarySearchFn:function(a,c,d){return c&&""!==c?(d=d?d:function(a,c){return b.match([a.name],c)})(a,c.toLowerCase()):!0},libraryMultiSearch:function(a,c,d){if(a.match={},!c||""===c)return!0;c=c.toLowerCase();for(var e=!1,f=0;f<d.length;++f){var g=d[f];b.match(a[g],c)&&(e=!0,a.match[g]=!0)}return e},itemDblClickHandler:function(a){this.isAddToSheetMode()&&d.publish("/ui/library/addToSheet",{item:a})},removeDialog:g,editDialog:g,hasLinks:function(a,b){return b.get(a).then(function(a){return a.getLinkedObjects().then(function(a){return 0!==a.length})})},toggleSelection:function(b,c){var d=a(c.currentTarget);return b.selected=!b.selected,b.selected?(d.on("qv-outside",function(c){var e=a(c.target);1!==e.closest("#library-preview").length&&1!==e.closest(".qv-contextmenu").length&&(b.selected=!1,d.off("qv-outside"))}),!0):(d.off("qv-outside"),!1)},removeSelection:function(b){a.each(b,function(a,b){b.selected=!1})},localeOrderBy:function(a,b){if(a){var c=function(a,b){return a.localeCompare(b)};b&&b instanceof Function&&(c=function(a,c){return b(a).localeCompare(b(c))}),a.sort(c)}return a},isAddToSheetMode:function(){return e.isInEditMode()&&e.view===e.Views.sheet&&e.model.layout.permissions.update},isAddToVisualizationMode:function(){return e.isInEditMode()&&(e.view===e.Views.object&&e.model.layout.permissions.update||e.view===e.Views.masterObject)},isAddToMode:function(){return this.isAddToSheetMode()||this.isAddToVisualizationMode()},permissionToCreate:h};return k}),define("text!client.views/global-selections/directives/scroll/scroll.ng.html",[],function(){return'<div class="qv-gs-scroll-area">\r\n	<div ng-style="{width: itemsWrapperWidth}" class="qv-gs-items-wrapper">\r\n		<div ng-repeat="item in items" class="qv-gs-listbox">\r\n			<p ng-if="item.qField" q-title-translation="Common.Field" tid="globalSelections.fieldIndicator" class="qv-gs-field-indicator">-</p>\r\n			<qv-gs-badge></qv-gs-badge>\r\n			<qv-object ng-if="item.visible" model="item.model" options="item.options" object="item.object" class="qv-object-listbox"></qv-object>\r\n			<div ng-if="!item.visible" class="qv-object qv-object-listbox qv-gs-placeholder">\r\n				<h1 class="qv-object-title">{{item.title}}</h1>\r\n				<div class="progress">\r\n					<qv-rain></qv-rain>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("general.scroll/scroll-area-service",["qvangular"],function(a){return a.service("qvScrollAreaService",function(){return{createScrollbar:function(){return{vLength:0,vViewportLength:0,vPos:0,vPage:0,thumb:{},style:{},classList:[],enabled:!1,getScrollDelta:function(a){var b=0,c=0;if(!this.enabled)return[0,0];switch(this.direction){case"vertical":c=a.swipe.curDeltaY*(1/this.scaleFactor);break;case"horizontal":b=a.swipe.curDeltaX*(1/this.scaleFactor);break;default:throw"not implemented"}return[b,c]},active:!1}},setScrollbarData:function(a,b,c,d,e,f){var g,h=3;switch(b){case"vertical":g=f.height;break;case"horizontal":g=f.width;break;default:throw"not implemented"}if(a.enabled=d>e&&g>0,a.enabled)switch(g-=2*h,a.uiOffset=h,a.direction=b,a.vLength=d,a.vViewportLength=e,a.vPos=0,a.vPage=g,a.length=g,a.trackSize=c,a.scaleFactor=g/d,a.thumb.pos=0,a.thumb.size=0,a.thumb.vPos=0,a.showMinAffordance=!1,a.showMaxAffordance=!0,a.direction){case"vertical":a.style.top=f.top+a.uiOffset+"px",a.style.width=c+"px",a.style.left=f.left+f.width-c-a.uiOffset+"px",a.style.height=f.height-2*a.uiOffset+"px";break;case"horizontal":a.style.height=c+"px",a.style.top=f.top+f.height-c-a.uiOffset+"px",a.style.left=f.left+a.uiOffset+"px",a.style.width=f.width-2*a.uiOffset+"px";break;default:throw"not implemented"}},setVirtualScrollPos:function(a,b,c){var d=0,e=b.vLength-b.vViewportLength,f=0,g=b.thumb.vPos;return b.enabled?(b.vPos+=a,b.showMinAffordance=!1,b.showMaxAffordance=!1,b.vPos<d?(g=d,b.vPos=c?b.vPos:d,b.showMaxAffordance=!0):b.vPos>e?(g=e,b.vPos=c?b.vPos:e,b.showMinAffordance=!0):(b.vPos!==d&&(b.showMinAffordance=!0),b.vPos!==e&&(b.showMaxAffordance=!0),g=b.vPos),f=g-b.thumb.vPos,b.thumb.vPos=g,f):0},setThumbStyle:function(a,b){var c=b.thumb,d=12,e=b.scaleFactor,f=Math.round(c.vPos*e),g=Math.round(b.vViewportLength*e);switch(d>g&&(f-=Math.round((d-g)/2),g=d),f=Math.max(f,0),f+g>b.length&&(f=b.length-g),c.size=g,c.pos=f,b.direction){case"vertical":a.top=f+"px",a.height=g+"px";break;case"horizontal":a.left=f+"px",a.width=g+"px";break;default:throw"not implemented"}},setTrackHitAreaStyle:function(a,b,c){"vertical"===b.direction?(a.right=-b.uiOffset+"px",a.width=c+b.uiOffset+"px"):(a.bottom=-b.uiOffset+"px",a.height=c+b.uiOffset+"px")}}})}),define("general.scroll/scroll-area-controller",["qvangular","general.scroll/scroll-area-service"],function(){var a=["$scope","$element","$timeout","qvScrollAreaService",function(a,b,c,d){var e,f,g,h=[],i=[],j=[];a.interactive=!1,a.virtualSize={width:0,height:0},a.virtualViewport={width:0,height:0},a.scrollbarX=d.createScrollbar(),a.scrollbarY=d.createScrollbar(),a.viewportRect={top:0,left:0,width:0,height:0},a.hover=!1,a.isMouse=!0,this.setMouse=function(b){a.isMouse=b},this.getScrollAreaRect=function(){var a=b[0].getBoundingClientRect();return{top:0,left:0,width:Math.ceil(a.width),height:Math.ceil(a.height)}},this.addScrollbarXCtrl=function(a){e=a},this.addScrollbarYCtrl=function(a){f=a},this.allowFade=function(){return(void 0===e||e.allowFade())&&(void 0===f||f.allowFade())},this.toggleFadeScrollbars=function(a){clearTimeout(g),(a||this.allowFade())&&(g=setTimeout(function(){var b=a?"fadeIn":"fadeOut";e&&e[b](),f&&f[b]()},a?0:800))},this.fadeInScrollbars=function(){this.toggleFadeScrollbars(!0)},this.fadeOutScrollbars=function(b){b&&a.hover||this.toggleFadeScrollbars(!1)},this.setNonMouseTrackSize=function(){"object"==typeof a.nonMouseViewportScrolling&&(b.addClass(a.nonMouseViewportScrolling.className),this.setTrackSize(a.nonMouseViewportScrolling.scrollbarSize))},this.setMouseTrackSize=function(){"object"==typeof a.nonMouseViewportScrolling&&b.removeClass(a.nonMouseViewportScrolling.className),this.setTrackSize(a.scrollbarSize)},this.setTrackSize=function(b){var c=this.getVirtualPosition();this.setVirtualSize(a.virtualSize,a.virtualViewport,a.viewportRect,b),this.setVirtualScrollPos(c.vPosX,c.vPosY)},this.setupScrollbars=function(b){b=b||8,d.setScrollbarData(a.scrollbarY,"vertical",b,a.virtualSize.height,a.virtualViewport.height,a.viewportRect),d.setScrollbarData(a.scrollbarX,"horizontal",b,a.virtualSize.width,a.virtualViewport.width,a.viewportRect),a.scrollbarX.enabled&&a.scrollbarY.enabled&&(a.scrollbarX.length-=b,a.scrollbarX.scaleFactor=a.scrollbarX.length/a.virtualSize.width,a.scrollbarX.style.width=a.viewportRect.width-b-2*a.scrollbarX.uiOffset+"px",a.scrollbarY.length-=b,a.scrollbarY.scaleFactor=a.scrollbarY.length/a.virtualSize.height,a.scrollbarY.style.height=a.viewportRect.height-b-2*a.scrollbarY.uiOffset+"px")},this.setVirtualSize=function(b,c,d,e){a.viewportRect=d,a.virtualSize.width=b.width,a.virtualSize.height=b.height,a.virtualViewport.width=c.width,a.virtualViewport.height=c.height,this.setupScrollbars(e)},this.setVirtualViewport=function(b){a.virtualViewport.width=b.width,a.virtualViewport.height=b.height,a.scrollbarX.vViewportLength=b.width,a.scrollbarY.vViewportLength=b.height},this.getVirtualSize=function(){return{width:a.virtualSize.width,height:a.virtualSize.height}},this.getVirtualPosition=function(){var b=0,c=this.getMaxPosition();return{vPosX:Math.max(b,Math.min(c.vPosX,a.scrollbarX.vPos)),vPosY:Math.max(b,Math.min(c.vPosY,a.scrollbarY.vPos))}},this.getMaxPosition=function(){var b=0,c=Math.max(b,a.scrollbarX.vLength-a.scrollbarX.vViewportLength),d=Math.max(b,a.scrollbarY.vLength-a.scrollbarY.vViewportLength);return{vPosX:c,vPosY:d}},this.isMouseOver=function(){return a.hover},this.resetScroll=function(){void 0!==a.scrollbarX.vPos&&void 0!==a.scrollbarY.vPos&&(0!==a.scrollbarX.vPos||0!==a.scrollbarY.vPos)&&this.scroll(-a.scrollbarX.vPos,-a.scrollbarY.vPos,!0,!1)},this.setVirtualScrollPos=function(b,c,e){d.setVirtualScrollPos(b,a.scrollbarX,e),d.setVirtualScrollPos(c,a.scrollbarY,e)},this.scroll=function(b,c,e,f){var g,i;g=d.setVirtualScrollPos(b,a.scrollbarX,f),i=d.setVirtualScrollPos(c,a.scrollbarY,f),(0!==g||0!==i||e)&&h.forEach(function(a){a(g,i)})},this.getScrollAmount=function(a,b,c){switch(c){default:return{deltaX:a,deltaY:b}}},this.scrollStart=function(){i.forEach(function(a){a()})},this.scrollEnd=function(){j.forEach(function(a){a()})},this.onScroll=function(a){h.push(a)},this.onScrollStart=function(a){i.push(a)},this.onScrollEnd=function(a){j.push(a)},this.on=function(){a.off=a.on(),a.interactive=!0},this.off=function(){a.off&&(a.off(),a.interactive=!1)},this.isVerticalScrollEnabled=function(){return a.scrollbarY.enabled}}];return a}),define("text!general.scroll/scroll-area.ng.html",[],function(){return'<div>\r\n	<div class="scroll-content" ng-transclude></div>\r\n	<qv-scroll-area-affordance x-show="scrollbarY.showMinAffordance" x-direction="\'vertical\'" x-dock="\'min\'" ng-if="scrollbarY.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n	<qv-scroll-area-affordance x-show="scrollbarX.showMinAffordance" x-direction="\'horizontal\'" x-dock="\'min\'" ng-if="scrollbarX.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n	<qv-scrollbar x-data="scrollbarY" x-interactive="interactive" x-viewport-rect="viewportRect" ng-if="scrollbarY.enabled"></qv-scrollbar>\r\n	<qv-scrollbar x-data="scrollbarX" x-interactive="interactive" x-viewport-rect="viewportRect" ng-if="scrollbarX.enabled"></qv-scrollbar>\r\n	<qv-scroll-area-affordance x-show="scrollbarY.showMaxAffordance" x-direction="\'vertical\'" x-dock="\'max\'" ng-if="scrollbarY.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n	<qv-scroll-area-affordance x-show="scrollbarX.showMaxAffordance" x-direction="\'horizontal\'" x-dock="\'max\'" ng-if="scrollbarX.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n</div>\r\n'}),define("text!general.scroll/scrollbar.ng.html",[],function(){return'<div class="scrollbar-animation scrollbar-track qv-animate"\r\n	ng-class="data.classList"\r\n	ng-style="data.style">\r\n	<qv-scrollbar-track-hit-area ng-style="trackHitAreaStyle" class="scrollbar-hitarea"></qv-scrollbar-track-hit-area>\r\n	<qv-scrollbar-thumb ng-class="{ active: data.active }" class="scrollbar-thumb" ng-style="thumbStyle"></qv-scrollbar-thumb>\r\n</div>\r\n'}),define("general.scroll/mouse-wheel-service",["qvangular"],function(a){var b="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";return a.service("qvMouseWheelService",function(){return{getEventName:function(){return b},getMouseWheelData:function(a){var c=1,d=0,e=0,f=0,g=40;return"wheel"===b?a:("MozMousePixelScroll"===a.type&&(c=0),a.wheelDelta&&(d=-a.wheelDelta/g),a.detail&&(d=-a.detail/3),f=d,void 0!==a.axis&&a.axis===a.HORIZONTAL_AXIS&&(f=0,e=-1*d),void 0!==a.wheelDeltaY&&(f=-1*a.wheelDeltaY/g),void 0!==a.wheelDeltaX&&(e=-1*a.wheelDeltaX/g),{deltaMode:c,delta:d,deltaX:e,deltaY:f,x:a.pageX,y:a.pageY})}}})}),define("general.scroll/scroll-area-affordance",["qvangular"],function(a){a.directive("qvScrollAreaAffordance",function(){return{restrict:"E",template:'<div ng-show="show" class="scroll-affordance" ng-class="[dock,direction]" ng-style="style"></div>',replace:!0,require:"^qvScrollArea",scope:{viewportRect:"=",direction:"=",dock:"=",size:"=?",show:"="},link:function(a){a.size=a.size||18,a.style={},a.updateAffordance=function(){switch(a.direction){case"vertical":switch(a.style.width=a.viewportRect.width+"px",a.style.height=a.size+"px",a.dock){case"min":a.style.left=a.viewportRect.left+"px",a.style.top=a.viewportRect.top+"px";break;case"max":a.style.left=a.viewportRect.left+"px",a.style.top=a.viewportRect.top+a.viewportRect.height-a.size+"px";break;default:throw"Dock "+a.dock+" not supported"}break;case"horizontal":switch(a.style.width=a.size+"px",a.style.height=a.viewportRect.height+"px",a.dock){case"min":a.style.left=a.viewportRect.left+"px",a.style.top=a.viewportRect.top+"px";break;case"max":a.style.left=a.viewportRect.left+a.viewportRect.width-a.size+"px",a.style.top=a.viewportRect.top+"px";break;default:throw"Dock "+a.dock+" not supported"}break;default:throw"Direction "+a.direction+" not supported"}},a.$watch("viewportRect",a.updateAffordance,!0)}}})}),define("general.scroll/scroll-area",["jquery","qvangular","general.scroll/scroll-area-controller","text!./scroll-area.ng.html","text!./scrollbar.ng.html","touche","general.utils/support","general.scroll/scroll-area-service","general.scroll/mouse-wheel-service","general.scroll/scroll-area-affordance"],function(a,b,c,d,e,f,g){b.directive("qvScrollArea",["$document","$timeout","qvScrollAreaService","qvMouseWheelService",function(b,e,h,i){return{restrict:"E",transclude:!0,template:d,replace:!0,scope:{scrollbarSize:"=?",nonMouseViewportScrolling:"=?"},require:"qvScrollArea",controller:c,link:function(c,d,e,h){function j(a,b){var d=c.viewportRect.left,e=c.viewportRect.top,f=c.viewportRect.left+c.viewportRect.width,g=c.viewportRect.top+c.viewportRect.height;return a>=d&&f>=a&&b>=e&&g>=b}function k(){d.off(c.namespace),b.off(c.namespace),f(d[0]).off("*",c.namespace)}"number"!=typeof c.scrollbarSize&&(c.scrollbarSize=8),c.$watch("scrollbarX.enabled",function(a){a===!0&&d.css("overflow-x","hidden")}),c.$watch("scrollbarY.enabled",function(a){a===!0&&d.css("overflow-y","hidden")}),c.namespace=".scroll-area-"+c.$id,c.on=function(){return d.on(i.getEventName()+c.namespace,function(a){var b,d=i.getMouseWheelData(a.originalEvent);b=h.getScrollAmount(d.deltaX,d.deltaY,d.deltaMode),c.$apply(function(){h.scroll(b.deltaX,b.deltaY,!1,!1)})}),b.on("keydown"+c.namespace,function(b){var d,e,f=0,g=0,i=a(b.target),j=i.is("input")||i.is("textarea");if(c.hover&&!j){switch(b.keyCode){case 33:g=1,d=2;break;case 34:g=-1,d=2;break;case 36:g=1,d=10;break;case 35:g=-1,d=10;break;case 38:g=1,d=1;break;case 40:g=-1,d=1;break;case 39:f=-1,d=1;break;case 37:f=1,d=1;break;default:return}e=h.getScrollAmount(f,g,d),c.$apply(function(){h.scroll(-e.deltaX,-e.deltaY,!1,!1)})}}),d.on((g.treatAsDesktop()?"mouseenter":"pointerenter")+c.namespace,function(a){c.isMouse=g.isMouse(a.originalEvent),c.isMouse?(c.hover=!0,h.setMouseTrackSize(),h.fadeInScrollbars(),c.$apply()):a.preventDefault()}),d.on((g.treatAsDesktop()?"mouseleave":"pointerleave")+c.namespace,function(a){c.isMouse=g.isMouse(a.originalEvent),c.isMouse&&(c.hover=!1,h.fadeOutScrollbars(c.isMouse))}),"object"==typeof c.nonMouseViewportScrolling&&("number"!=typeof c.nonMouseViewportScrolling.scrollbarSize&&(c.nonMouseViewportScrolling.scrollbarSize=36),"string"!=typeof c.nonMouseViewportScrolling.className&&(c.nonMouseViewportScrolling.className="show-non-mouse-scrollbars"),f(d[0]).swipe({options:{radiusThreshold:0,useMomentum:!0,inertia:.7},start:function(a,b){return g.isMouse(a)?void this.cancel():j(b.pagePoints[0].x-this.rect.x,b.pagePoints[0].y-this.rect.y)?(h.setMouse(!1),h.setNonMouseTrackSize(),h.scrollStart(),h.fadeInScrollbars(),void c.$apply()):void this.cancel()},update:function(a,b){var d=c.scrollbarX.getScrollDelta(b)[0],e=c.scrollbarY.getScrollDelta(b)[1];h.scroll(-1*d,-1*e,!1,!0),c.$apply()},end:function(){h.scrollEnd(),h.fadeOutScrollbars(),c.$apply()}})),k},c.$on("$destroy",function(){k()})}}}]),b.directive("qvScrollbar",["qvScrollAreaService",function(a){return{restrict:"E",require:["^qvScrollArea","qvScrollbar"],scope:{data:"=",interactive:"=",viewportRect:"="},template:e,replace:!0,controller:function(){},link:function(b,c,d,e){function f(a){c[a?"addClass":"removeClass"]("fade")}var g=e[0],h=e[1];"vertical"===b.data.direction?(b.data.classList.push("vertical"),g.addScrollbarYCtrl(h)):(b.data.classList.push("horizontal"),g.addScrollbarXCtrl(h)),h.allowFade=function(){return!b.data.active},h.fadeIn=function(){return f(!0)},h.fadeOut=function(){return f(!1)},b.$on("$destroy",function(){c.removeClass("qv-animate")}),b.thumbStyle={},b.$watch("data.thumb",function(){a.setThumbStyle(b.thumbStyle,b.data)},!0),b.$watch("data.vPage",function(){a.setThumbStyle(b.thumbStyle,b.data)}),b.$watch("data.vLength",function(){a.setThumbStyle(b.thumbStyle,b.data)}),b.$watch("data.enabled",function(a){g.isMouseOver()&&a&&h.fadeIn()}),b.setThumbStyle=a.setThumbStyle.bind(null,b.thumbStyle,b.data),b.trackHitAreaStyle={},b.$watch("data.trackSize",function(c){void 0!==c&&a.setTrackHitAreaStyle(b.trackHitAreaStyle,b.data,c)}),b.start=function(a){g.setMouse(a),b.data.active||a||(g.setNonMouseTrackSize(),g.fadeInScrollbars()),b.data.active=!0,g.scrollStart()},b.update=function(a,b){g.scroll(a,b,!1,!0)},b.end=function(a){var c=b.data,d=0,e=c.vLength-c.vViewportLength;c.vPos<d?c.vPos=d:c.vPos>e&&(c.vPos=e),b.data.active=!1,g.scrollEnd(),g.fadeOutScrollbars(a)},b.on=function(){return b.hitAreaOff=b.hitAreaOn(),b.thumbOff=b.thumbOn(),function(){b.hitAreaOff(),b.thumbOff()}},b.$watch("interactive",function(a){a?b.off=b.on():b.off&&b.off()})}}}]),b.directive("qvScrollbarThumb",[function(){return{restrict:"E",template:"<div></div>",replace:!0,link:function(a,b){a.thumbOn=function(){return f(b[0]).tap({start:function(b){f.preventGestures(this.gestureHandler),a.start(g.isMouse(b)),a.$apply()}}).swipe({options:{radiusThreshold:0},update:function(b,c){a.update.apply(a,a.data.getScrollDelta(c)),a.$apply()},end:function(b){a.end(g.isMouse(b)),a.$apply()}}),function(){f(b[0]).off()}},a.$on("$destroy",function(){f(b[0]).off()})}}}]),b.directive("qvScrollbarTrackHitArea",[function(){return{restrict:"E",replace:!0,template:"<div></div>",require:"^qvScrollArea",link:function(a,b,c,d){function e(b,c){var e,f,g,h,i,j=a.data.thumb.size,k=a.data.thumb.pos,l=0,m=0;switch(a.data.direction){case"vertical":f=b.pagePoints[0].y-c.y<k,g=b.pagePoints[0].y-c.y>k+j,g?(e=d.getScrollAmount(-1,-1,2),l=0,m=-e.deltaY):f&&(e=d.getScrollAmount(1,1,2),l=0,m=-e.deltaY);break;case"horizontal":h=b.pagePoints[0].x-c.x<k,i=b.pagePoints[0].x-c.x>k+j,h?(e=d.getScrollAmount(1,1,2),l=-e.deltaX,m=0):i&&(e=d.getScrollAmount(-1,-1,2),l=-e.deltaX,m=0)}d.scroll(l,m)}function h(b,c){switch(a.data.direction){case"vertical":a.update(0,(b.pagePoints[0].y-c.y-(a.data.thumb.pos+a.data.thumb.size/2))*(1/a.data.scaleFactor));break;case"horizontal":a.update((b.pagePoints[0].x-c.x-(a.data.thumb.pos+a.data.thumb.size/2))*(1/a.data.scaleFactor),0);break;default:throw"not implemented"}}a.hitAreaOn=function(){return f(b[0]).tap({start:function(b,c){f.preventGestures(this.gestureHandler),a.start(g.isMouse(b)),a.setThumbStyle(),g.isMouse(b)?e(c,this.rect):h(c,this.rect),a.$apply()},end:function(){a.end(),a.$apply()}}).swipe({options:{radiusThreshold:0},start:function(b,c){return g.isMouse(b)?void this.cancel():(a.update.apply(a,a.data.getScrollDelta(c)),void a.$apply())},update:function(b,c){a.update.apply(a,a.data.getScrollDelta(c)),a.$apply()},end:function(){a.end(!1),a.$apply()}}),function(){f(b[0]).off()}},a.$on("$destroy",function(){f(b[0]).off()})}}}])}),define("client.views/global-selections/directives/scroll/scroll",["qvangular","text!./scroll.ng.html","core.utils/class","objects.models/listbox","core.models/app","objects.utils/data-properties/listobject-util","pubsub","client.views/selection-toolbar/selection-toolbar-service","general.scroll/scroll-area"],function(a,b,c,d,e,f,g){function h(a,b){for(;a.length>b;)a.pop()}var i=c.extend({size:{width:0,height:0},itemSize:0,itemSpacing:0,$element:void 0,init:function(a,b,c){this.$scope=a,this.$timeout=b,this.selectionToolbarService=c,this.$scope.items=[]},initialize:function(a,b,c){this.setSize(b),this.setItemSize(c.itemSize),this.setItemSpacing(c.itemSpacing),this.setElement(a),this.setWrapperWidth(),this.setItems()},updateVisible:function(){var a,b,c,d=this.offsetX,e=this.visibleItemsCount,f=this.$scope.items.length;for(a=0;f>a;a++)b=this.$scope.items[a],c=a>=d&&d+e>a,!b.visible&&c&&(b.options={isPopOver:!1}),c&&!b.model&&this.getModel(b).then(function(a,b){a.model=b}.bind(null,b)),b.visible=c},getModel:function(a){var b,c=this.getInitProps(a.title);return a.qField?b=d.createTransientField(e.current,a.qField,c):a.qId&&(b=d.createTransientDimension(e.current,a.qId,c)),b},onScroll:function(){this.selectionToolbarService.confirm(),this.$timeout.cancel(this.scrollTimeout),this.scrollTimeout=this.$timeout(function(){this.updateVisible()}.bind(this),100)},onResize:function(a){this.setSize(a),this.updateVisible()},updateHighlights:function(){var a,b=this.totalItemsCount;for(a=0;b>a;a++)this.$scope.items[a]&&(this.$scope.items[a].options.highlightQuery=this.$scope.filter)},setItems:function(){var a,b,c,d=this.$scope,e=this.totalItemsCount;for(d.items.length!==e&&h(d.items,e),a=0;e>a;a++)b=d.items[a]||{},c=d.allItems[a],c.enableBadge&&(b.enableBadge=c.enableBadge),b.model||(b.options={isPopOver:!1}),c.qField?(delete b.qId,b.model&&b.qField===c.qField||(b.visible&&(delete b.$$hashKey,delete b.options.search),b.title=c.title,b.qField=c.qField,delete b.model)):c.qId&&(delete b.qField,b.model&&b.qId===c.qId||(b.visible&&(delete b.$$hashKey,delete b.options.search),b.title=c.title,b.qId=c.qId,delete b.model)),d.items[a]||(d.items[a]=b);this.updateVisible()},getInitProps:function(a){var b={title:a,qListObjectDef:{qDef:{}}};return f.autoSortDimension(b.qListObjectDef),b},getWidthOf:function(a){return this.totalItemSize*a-this.itemSpacing},setItemSize:function(a){this.itemSize=a||220},setItemSpacing:function(a){this.itemSpacing=a||20},setSize:function(a){this.size=a},setWrapperWidth:function(){this.$scope.itemsWrapperWidth=this.getWidthOf(this.totalItemsCount)},setElement:function(a){this.$element=a,this.$element.on("scroll",this.onScroll.bind(this))}});Object.defineProperties(i.prototype,{vPosX:{get:function(){return this.$element.scrollLeft()}},totalItemSize:{get:function(){return this.itemSize+this.itemSpacing}},pageSize:{get:function(){return Math.ceil(this.size.width/this.totalItemSize)}},visibleItemsCount:{get:function(){var a=Math.ceil((this.vPosX%this.totalItemSize+this.size.width)/this.totalItemSize);return Math.min(a,this.totalItemsCount)}},totalItemsCount:{get:function(){return(this.$scope.allItems||[]).length}},offsetX:{get:function(){return Math.floor(this.vPosX/this.totalItemSize)}}}),i.$inject=["$scope","$timeout","qvSelectionToolbarService"],a.directive("qvGlobalSelectSection",["$parse","$timeout",function(a,c){return{controller:i,require:["qvGlobalSelectSection","^qvGlobalSelections"],template:b,replace:!0,scope:{allItems:"=",filter:"="},link:function(b,d,e,f){var h=f[0],i=f[1],j=a(e.qvGlobalSelectSection)(),k={},l=null;c(function(){k.width=d.innerWidth(),k.height=d.innerHeight(),h.initialize(d,k,j)}),g.subscribe("/ui/object/resize."+b.$id,function(){k.width=d.innerWidth(),k.height=d.innerHeight(),h.onResize(k)}),b.$on("$destroy",function(){clearTimeout(l),g.unsubscribe("."+b.$id)}),i.addCallback(j.type,function(){h.$timeout(function(){h.setWrapperWidth(),h.setItems()})}),i.addCallback(j.type,function(){h.$timeout(function(){h.updateHighlights()})})}}}])}),define("text!client.views/global-selections/directives/badge/badge.ng.html",[],function(){return'<div class="qv-gs-badge" ng-if="item.showBadge" q-title-translation="Tooltip.clearSelection" tid="globalSelections.badge">\r\n	<q qva-activate="badgeClick(item)"></q>\r\n</div>\r\n'}),define("objects.backend-api/listbox-api",["./backend-api"],function(a){var b;return b=a.extend("Listbox",{init:function(a){this._super(a,"/qListObjectDef"),this.cacheCube.setMethodName("GetListObjectData")},select:function(a,b,c){return this.model.rpc("SelectListObjectValues","qReturn",[this.path,b,c])},selectAll:function(){return this.model.rpc("SelectListObjectAll",null,[this.path])},selectPossible:function(){return this.model.rpc("SelectListObjectPossible",null,[this.path])},selectAlternative:function(){return this.model.rpc("SelectListObjectAlternative",null,[this.path])},selectExcluded:function(){return this.model.rpc("SelectListObjectExcluded",null,[this.path])},search:function(a){return this.model.rpc("SearchListObjectFor","qSuccess",[this.path,a])},abortSearch:function(){return this.model.rpc("AbortListObjectSearch",null,[this.path])},confirmSearch:function(a){return this.model.rpc("AcceptListObjectSearch",null,[this.path,a])},updateCache:function(a){this.cacheCube.set(a.qListObject.qDataPages),this.cacheCube.setCubeSize(a.qListObject.qSize)},setInitialData:function(a){this.cacheCube.set(a.qListObject.qDataPages)},getData:function(a){return this.cacheCube.getData(a)},getDataPage:function(a){return this.getData([a]).then(function(a){return a[0]})},getSize:function(){return this.model.layout.qListObject.qSize},lock:function(){return this.model.rpc("Lock",null,[this.path])},unlock:function(){return this.model.rpc("Unlock",null,[this.path])},isLocked:function(){return this.model.layout&&this.model.layout.qListObject&&this.model.layout.qListObject.qDimensionInfo.qLocked?!0:!1},getDimensionInfos:function(){return this.model.layout&&this.model.layout.qListObject?[this.model.layout.qListObject.qDimensionInfo]:[]}})}),define("client.views/global-selections/directives/badge/badge",["qvangular","text!./badge.ng.html","objects.backend-api/listbox-api"],function(a,b,c){a.directive("qvGsBadge",function(){return{restrict:"E",template:b,replace:!0,link:function(b){b.item.enableBadge&&(b.item.object||(b.item.object={}),b.$watchCollection("[item.model.layout.qListObject.qDimensionInfo.qLocked, item.object.selectionsApi.active]",function(c){a.$apply(function(){b.item.showBadge=(void 0===c[0]||c[0]===!1)&&c[1]===!1})}),b.badgeClick=function(a){var b=new c(a.model);b.beginSelections(),b.clearSelections(),b.endSelections(!0)})}}})}),define("client.views/global-selections/global-selections",["jquery","qvangular","text!./global-selections.ng.html","client.models/current-selections","general.models/library/dimension","general.utils/support","client.assets/assets-utils","core.utils/class","general.models/field","client.assets/tab-contents/fields/assets-field-list-model","core.utils/deferred","core.models/app","core.utils/resize","client.assets/tab-contents/fields/assets-directdiscovery-service","client.views/selection-toolbar/selection-toolbar-service","client.views/global-selections/directives/scroll/scroll","client.views/global-selections/directives/badge/badge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=".globalSelections",p=h.extend({init:function(b,c){var d=this,e=c.find(".qv-panel-current-selections");
this.$scope=b,this.$document=c,this.callbacks=[],this.ignoreUpdates=!1,this.hasLoaded=!1,b.toolbarHeight=e.outerHeight(),b.dimensions=[],b.dimensionsFields=[],b.selectedFields=[],b.fields=[],b.dimAvailable=!1,b.showFields=!1,b.showFieldsCheckbox=!0,b.filter="",b.autoFocus=f.treatAsDesktop(),k.all({fields:this.getFields(),selections:this.bindCurrentSelections(),dimensions:this.getLibraryDimensions()}).then(function(){d.hasLoaded=!0,d.setupUi(d),b.$watchCollection("[filter, showFields]",function(){d.filterShown(d,d.$scope)}),a(".qv-gs-section .qv-gs-header")[1].style.display="none",a(".qv-gs-section .qv-gs-header")[1].offsetHeight,a(".qv-gs-section .qv-gs-header")[1].style.display="block"})},getFields:function(){var a=this.$scope,b=new k;return i.getListLayout().then(function(c){a.fields=j.expand(c).map(function(a){return{title:a.qName,qField:a.qName,qTags:a.qTags}}),b.resolve()}),b.promise},_updateCurrentSelectionFields:function(a){var b=this,c=this.$scope;c.selectedFields=a.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex}).map(function(a){return{title:a.qField,qField:a.qField,enableBadge:!0}}),b.hasLoaded&&b.filterShown(b,c)},handleCurrentSelectionFields:function(){var a=this;this.$scope.currentSelectionsModel.getLayout().then(function(b){a._updateCurrentSelectionFields(b)})},bindCurrentSelections:function(){var a=this.$scope,b=this;return d.get().then(function(c){return a.currentSelectionsModel=c,d.bindLayout(a,"currentSelectionsModel",function(a){l.current.isModal()||b._updateCurrentSelectionFields(a)})})},getLibraryDimensions:function(){var a=this.isCalculatedField,b=this.$scope,c=new k;return e.getList().then(function(d){d.getLayout().then(function(d){b.dimensions=d.filter(function(b){return b.qData.info.length>0&&(b.qData.info.some(a)?!1:!0)&&"H"!==b.qData.grouping}).map(function(a){return{title:a.qData.title,fieldName:a.qData.info[0].qName,qId:a.qInfo.qId}}),c.resolve()})}),c.promise},setupUi:function(a){var b=a.$scope;b.showFieldsCheckbox=b.fields.length>0,b.dimAvailable=b.dimensions.length>0,!b.dimAvailable&&b.showFieldsCheckbox&&(b.showFields=!0)},isCalculatedField:function(a){return"="===a.qName[0]},filterShown:function(a,c){var d="",e=[];c.dimensionsFields=c.dimensions.filter(function(a){return!c.selectedFields.some(function(b){return a.fieldName===b.qField})}),c.showFields&&(e=c.fields.filter(function(a){return!c.selectedFields.some(function(b){return b.qField===a.qField})}),e=n.removeMeasureAndDetailsFields(e),c.dimensionsFields=c.dimensionsFields.concat(e.filter(function(a){return!c.dimensions.some(function(b){return a.qField===b.fieldName})}))),c.filter.length>0&&(d=c.filter.toLowerCase(),e=c.dimensionsFields.filter(function(a){return-1!==a.title.toLowerCase().indexOf(d)}),c.dimensionsFields=e),g.localeOrderBy(c.dimensionsFields,function(a){return a.title}),b.$apply(c,function(){a.notifyCallbacks(a)})},addCallback:function(a,b){this.callbacks.push({type:a,fn:b})},notifyCallbacks:function(a){a.hasLoaded&&(a.ignoreUpdates||a.callbacks.forEach(function(a){("fields"===a.type||"dimensions"===a.type)&&a.fn()}))},setIgnoreUpdates:function(a){this.ignoreUpdates=a}});return p.$inject=["$scope","$document"],b.directive("qvGlobalSelections",["$document","qvSelectionToolbarService","$timeout",function(b,d,e){return{restrict:"E",template:c,controller:p,require:["qvGlobalSelections"],scope:{},replace:!0,link:function(c,f,g,h){var i=h[0],j=!1,k=function(){j=!1},l=function(){e(function(){i.setIgnoreUpdates(j),i.handleCurrentSelectionFields(),j=!1})};d.Closed.bind(l),b.on("keyup"+o,function(a){27===a.which?j=!1:13===a.which&&(j=!1)}),Touche(b[0].body).tap({id:o,options:{preventDefault:!1},start:function(b){var c=a(b.target).closest(".qv-gs-badge").length>0,d=a(b.target).closest(".qv-gs-listbox").length>0;j=d&&!c}}),m.on("start",k),c.$on("$destroy",function(){i.callbacks=[],d.Closed.unbind(l),Touche(b[0].body).off("*",o),b.off(o),m.off("start",k)}),c.onEnter=function(a){a.stopPropagation(),a.target.blur()}}}}]),"<qv-global-selections></qv-global-selections>"}),define("text!client.views/mobile-selections/mobile-selections.ng.html",[],function(){return'<div class="qv-mobile-selections" tid="{{\'mobileSelections.showFields.\' + filter.showFields}}">\r\n		<div class="qv-ms-toolbar">\r\n		<p qva-activate="selectionsBack()" ng-class="{\'qv-ms-button-disabled\' : disable.back, \'qv-ms-button-enabled\': !disable.back}" class="qv-ms-toolbar-buttons" tid="mobileSelections.back" q-title-translation="Tooltip.NavigateBack"><</p>\r\n		<p qva-activate="selectionsForward()" ng-class="{\'qv-ms-button-disabled\' : disable.forward, \'qv-ms-button-enabled\': !disable.forward}" class="qv-ms-toolbar-buttons" tid="mobileSelections.forward" q-title-translation="Tooltip.NavigateForward">=</p>\r\n		<p qva-activate="selectionsClear()" ng-class="{\'qv-ms-button-disabled\' : disable.clear, \'qv-ms-button-enabled\': !disable.clear}" class="qv-ms-toolbar-buttons" tid="mobileSelections.clear" q-title-translation="Tooltip.ClearSelections">:</p>\r\n		<p qva-activate="toggleMenu()" ng-class="{\'qv-ms-button-disabled\' : !enableMenu, \'qv-ms-button-enabled\': enableMenu, \'qv-ms-button-menu-active\': menuActive }" class="qv-ms-toolbar-buttons" id="mobileSelectionsMenu" tid="mobileSelections.showMenu" qva-outside-ignore-for="allOutside" q-title-translation="Toolbar.Menu"></p>\r\n\r\n		<qui-button qva-activate="close($event)" name="close" class="qv-ms-toolbar-close" tid="mobileSelections.close">\r\n			<span q-translation="Common.Close" class="qv-ms-toolbar-close-text"></span>\r\n		</qui-button>\r\n		</div>\r\n		<header class="qv-ms-header">\r\n				<h2 q-translation="GlobalSelections.CurrentSelections"></h2>\r\n		</header>\r\n	<qui-search-field placeholder="GlobalSelections.FilterDimensionsAndFields" query="filter.filter" maxlength="255"\r\n		on-enter="filter.onEnter($event)" class="qv-ms-searchbox" tid="mobileSelections.searchfield">\r\n		</qui-search-field>\r\n		<div class="qv-ms-scroll-area">\r\n			<qv-ms-selected ng-repeat="item in selectedFields"></qv-ms-selected>\r\n			<qv-ms-selectable ng-repeat="item in selectables"></qv-ms-selectable>\r\n		</div>\r\n</div>\r\n'}),define("text!client.views/mobile-selections/menu/mobile-selections-menu.ng.html",[],function(){return'<immidiate-contextual align-to=" \'#mobileSelectionsMenu\' " position="\'bottom\'" on-close-view="closeView()" smallview="true">\r\n	<ul class="qui-icontextlist">\r\n		<li>\r\n			<p class="qui-textlist-text" qva-activate="toggleFields($event)" q-translation="{{fieldsLabel}}"></p>\r\n		</li>\r\n	</ul>\r\n</immidiate-contextual>\r\n'}),define("client.views/mobile-selections/menu/mobile-selections-menu",["text!./mobile-selections-menu.ng.html"],function(a){var b={scope:{menuItem:"=",closeMenu:"="},template:a,controller:["$scope",function(a){a.fieldsLabel=a.menuItem.model.showFields?"GlobalSelections.HideFields":"GlobalSelections.ShowFields",a.toggleFields=function(b){b.preventDefault(),a.menuItem.model.showFields=!a.menuItem.model.showFields,a.closeMenu()},a.closeView=function(){a.closeMenu()}}]};return b}),define("text!client.views/mobile-selections/directives/selectable/selectable.ng.html",[],function(){return'<div qva-activate="showSelectable()" ng-class="{\'qv-ms-touch-flash\' : item.flash}" class="qv-ms-selectable" tid="mobileSelections.selectable">\r\n	<p ng-if="item.qField" class="qv-ms-is-field"></p>\r\n	<div class="qv-ms-highlight">\r\n		<span qve-highlight text="{{item.title}}" query="filter.filter"></span>\r\n	</div>\r\n</div>\r\n'}),define("client.views/mobile-selections/directives/selectable/selectable",["qvangular","text!./selectable.ng.html","core.utils/class"],function(a,b,c){var d=c.extend({init:function(a){this.$scope=a}});d.$inject=["$scope"],a.directive("qvMsSelectable",["$timeout",function(a){return{controller:d,restrict:"E",replace:!0,template:b,link:function(b){b.showSelectable=function(){b.item.flash=!0,a(function(){b.$emit("showListbox",b.item),b.item.flash=!1},20)}}}}])}),define("text!client.views/mobile-selections/directives/selected/selected.ng.html",[],function(){return'<div class="qv-ms-selected" tid="mobileSelections.selected">\r\n	<div class="qv-ms-selected-icon">\r\n		<a ng-show="!item.qLocked" qva-activate="clear(item.qField)">\r\n			<i class="icon-cancel"></i>\r\n		</a>\r\n		<a ng-show="item.qLocked" qva-activate="showSelected(item.qField)">\r\n			<i class="icon-toolbar-locked"></i>\r\n		</a>\r\n	</div>\r\n	<div qva-activate="showSelected(item.qField)" class="qv-ms-selected-info">\r\n		<h1 class="qv-object-title">{{item.qField}}</h1>\r\n		<span>{{item.translation}}</span>\r\n		<qv-state-count-bar cardinal="item.qTotal" state-counts="item.qStateCounts"></qv-state-count-bar>\r\n	</div>\r\n</div>\r\n'}),define("client.views/mobile-selections/directives/selected/selected",["qvangular","text!./selected.ng.html","core.utils/class"],function(a,b,c){var d=c.extend({init:function(a){this.$scope=a}});d.$inject=["$scope"],a.directive("qvMsSelected",function(){return{controller:d,restrict:"E",replace:!0,template:b,link:function(a){a.showSelected=function(){a.$emit("showListbox",a.item)},a.clear=function(b){a.currentSelectionsModel.clearField(b)}}}})}),define("client.views/current-selections/current-selections-service",["qvangular","translator"],function(a,b){return a.service("qvCurrentSelectionsService",[function(){return{translate:function(a){var c,d=a.qSelectionThreshold,e=a.qStateCounts.qSelected+a.qStateCounts.qSelectedExcluded+a.qStateCounts.qLocked+a.qStateCounts.qLockedExcluded,f=a.qTotal;return c=f===e&&f>d?b.get("CurrentSelections.All"):d>=f-e&&f>d&&e>d?b.get("CurrentSelections.Not",a.qNotSelectedFieldSelectionInfo.map(function(a){return a.qName}).join(", ").toString()):e>d&&f>d?b.get("CurrentSelections.Of",[e,f]):a.qSelectedFieldSelectionInfo.map(function(a){return a.qName}).join(", ").toString()}}}])}),define("client.views/mobile-selections/mobile-selections",["qvangular","text!./mobile-selections.ng.html","client.models/current-selections","general.models/library/dimension","general.models/field","client.assets/assets-utils","core.utils/class","core.utils/deferred","core.models/app","objects.models/listbox","general.services/show-service/show-service","client.views/mobile-selections/menu/mobile-selections-menu","client.assets/tab-contents/fields/assets-directdiscovery-service","client.views/global-selections/global-selections-service","client.views/mobile-selections/directives/selectable/selectable","client.views/mobile-selections/directives/selected/selected","objects/listbox-popover/listbox-popover-service","client.views/current-selections/current-selections-service"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=g.extend({init:function(a,b){var c=this;c.$scope=a,c.$document=b,c.hasLoaded=!1,a.dimensions=[],a.fields=[],a.selectedFields=[],a.filter={filter:"",showFields:!1,onEnter:function(a){a.stopPropagation(),a.target.blur()}},a.selectables=[],a.dimAvailable=!1,a.enableMenu=!0,a.disable={clear:!1,back:!1,forward:!1},h.all({selections:this.bindCurrentSelections(c),dimensions:this.getLibraryDimensions(),fields:this.getFields()}).then(function(){c.hasLoaded=!0,a.enableMenu=a.fields.length>0,a.dimAvailable=a.dimensions.length>0,!a.dimAvailable&&a.enableMenu&&(a.filter.showFields=!0),a.$watch("filter",function(){c.filterSelectables(c)},!0)})},filterSelectables:function(b){var c=b.$scope,d="",e=[];c.selectables=c.dimensions.filter(function(a){return!c.selectedFields.some(function(b){return a.fieldName===b.qField})}),c.filter.showFields===!0&&(e=c.fields.filter(function(a){return!c.selectedFields.some(function(b){return b.qField===a.qField})}),e=m.removeMeasureAndDetailsFields(e),c.selectables=c.selectables.concat(e.filter(function(a){return!c.dimensions.some(function(b){return a.qField===b.fieldName})}))),c.filter.filter.length>0&&(d=c.filter.filter.toLowerCase(),e=c.selectables.filter(function(a){return-1!==a.title.toLowerCase().indexOf(d)}),c.selectables=e),f.localeOrderBy(c.selectables,function(a){return a.title}),a.$apply(c)},bindCurrentSelections:function(b){var d=b.$scope,e=new h,f=a.getService("qvCurrentSelectionsService");return c.get().then(function(a){d.currentSelectionsModel=a,c.bindLayout(d,"currentSelectionsModel",function(a){d.disable={clear:0===a.qSelectionObject.qSelections.length,back:0===a.qSelectionObject.qBackCount,forward:0===a.qSelectionObject.qForwardCount},d.selectedFields=a.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex}),d.selectedFields.forEach(function(a){a.translation=f.translate(a)}),b.hasLoaded&&b.filterSelectables(b)}),e.resolve()}),e.promise},getLibraryDimensions:function(){var a=this.isCalculatedField,b=this.$scope,c=new h;return d.getList().then(function(d){d.getLayout().then(function(d){b.dimensions=d.filter(function(b){return b.qData.info.length>0&&(b.qData.info.some(a)?!1:!0)&&"H"!==b.qData.grouping}).map(function(a){return{title:a.qData.title,fieldName:a.qData.info[0].qName,qId:a.qInfo.qId}}),c.resolve()})}),c.promise},getFields:function(){var a=this.$scope,b=new h;return e.getListLayout().then(function(c){a.fields=c.map(function(a){return{title:a.qName,qField:a.qName,qTags:a.qTags}}),b.resolve()}),b.promise},isCalculatedField:function(a){return"="===a.qName[0]}});return n.$inject=["$scope","$document"],a.directive("qvMobileSelections",["$document","qvGlobalSelectionsService","qvListboxPopoverService",function(a,c,d){return{restrict:"E",template:b,controller:n,replace:!0,require:["qvMobileSelections"],scope:{},link:function(a){var b=null,e=function(){b.destroy(),b=null,a.menuActive=!1};a.close=function(a){a.preventDefault(),c.off()},a.selectionsBack=function(){a.currentSelectionsModel.back()},a.selectionsForward=function(){a.currentSelectionsModel.forward()},a.selectionsClear=function(){a.currentSelectionsModel.clearAll()},a.toggleMenu=function(){b?e():a.enableMenu&&(a.menuActive=!0,b=k.show(l,{menuItem:{model:a.filter},closeMenu:e}))},a.$on("showListbox",function(a,b){var c={title:b.title,qListObjectDef:{qDef:{}}},e=function(a){d.show(a,{})};b.qField?j.createTransientField(i.current,b.qField,c).then(e):j.createTransientDimension(i.current,b.qId,c).then(e)}),a.$on("$destroy",function(){b&&(b.destroy(),b=null)})}}}]),"<qv-mobile-selections></qv-mobile-selections>"}),define("text!client.views/global-selections-deactivate/global-selections-deactivate.ng.html",[],function(){return'<div class="qv-global-selections-deactivate" qva-activate="deactivateGlobalSelection()" ng-style="{height: height}">\r\n	\r\n</div>'}),define("client.views/global-selections-deactivate/global-selections-deactivate",["text!./global-selections-deactivate.ng.html","ng!$timeout","client.views/global-selections/global-selections-service"],function(a,b){return{template:a,controller:["$scope","$document","qvGlobalSelectionsService",function(a,c,d){b(function(){a.height=c.find(".qui-toolbar").outerHeight(),a.height||(a.height=c.find(".qv-panel-current-selections").outerHeight())}),a.deactivateGlobalSelection=function(){d.off()}}]}}),define("text!client.views/global-search/global-search.ng.html",[],function(){return'<div class="qv-global-search" ng-style="{paddingTop: toolbarHeight}" tid="globalSearch">\r\n	<div class="qv-global-search-dimmer">\r\n		<qv-global-search-input class="qv-global-search-input"></qv-global-search-input>\r\n		<qv-global-search-suggest class="qv-global-search-suggest"></qv-global-search-suggest>\r\n\r\n		<div class="qv-global-search-space-top" ng-class="{ border: displayResult }"><div></div></div>\r\n		<qv-global-search-result class="qv-global-search-result" tid="globalSearch.ResultList" ng-class="{ \'qv-global-search-result-loader-open\': resultLoaderOpen }"></qv-global-search-result>\r\n		<div class="qv-global-search-border-bottom"></div>\r\n		<div class="qv-global-search-gap-filler" qva-activate="close();"></div>\r\n	</div>\r\n	<div class="qv-global-search-overlay" qva-activate="close();"></div>\r\n</div>\r\n'}),define("general.utils/qv-keyboard-shortcuts",["jquery","general.utils/dom-util"],function(a,b){function c(){this.groups=[],this.shortcuts=[],this.timer={id:null},this.isReleased=!0,this.currentEvent=void 0}var d,e={a:65,alt:18,b:66,backspace:8,c:67,ctrl:17,d:68,del:46,down:40,e:69,f:70,enter:13,esc:27,g:71,h:72,home:36,i:73,j:74,k:75,l:76,left:37,m:77,n:78,o:79,p:80,q:81,r:82,right:39,s:83,shift:16,space:32,t:84,tab:9,u:85,up:38,v:86,w:87,win:224,x:88,y:89,z:90,cmd:91},f="qvKeyboardShortcuts",g=!1;return c.prototype.createGroup=function(a,b){var c,d,e=this;for(d=0;d<this.groups.length;d++)if(this.groups[d].name===a){c=this.groups[d];break}if(c)throw"Keyboard shortcut group already exist: "+a;return c={name:a,priority:b,active:!1,shortcuts:[]},this.groups.push(c),this.groups.sort(function(a,b){return a.priority-b.priority}),{registerKeys:function(a,b,d){e.registerKeys(c,a,b,d)},on:function(){e.activateGroup(c)},off:function(){e.deactivateGroup(c)},"delete":function(){e.deactivateGroup(c),e.deleteGroup(c)}}},c.prototype.activateGroup=function(b){var c=this;b.active=!0,g||(g=!0,a(document).on("keydown."+f,function(a){c.handleEvent(a)}))},c.prototype.deactivateGroup=function(b){var c;b.active=!1,c=this.groups.reduce(function(a,b){return b.active&&a++,a},0),0===c&&g&&(g=!1,a(document).off("keydown."+f))},c.prototype.deleteGroup=function(a){this.groups=this.groups.filter(function(b){return b!==a})},c.prototype.registerKeys=function(a,b,c,d){var f=b.toLowerCase().split("+"),g={ctrlKey:!1,shiftKey:!1,keyCode:null,name:"",callback:null,allowInAllContexts:d&&"allowInInput"in d?d.allowInInput:!1,preventDefault:d&&"preventDefault"in d?d.preventDefault:!0,delay:d&&"delay"in d?d.delay:250};for(var h in e)for(var i=0;i<f.length;i++)g.name=b.toLowerCase(),g.callback=c,("ctrl"===f[i]||"cmd"===f[i])&&(g.ctrlKey=!0),"shift"===f[i]&&(g.shiftKey=!0),f[i]===h&&17!==e[h]&&16!==e[h]&&91!==e[h]&&(g.keyCode=e[h]);a.shortcuts.push(g)},c.prototype.preventDefault=function(){this.currentEvent&&this.currentEvent.preventDefault()},c.prototype.handleEvent=function(a){function c(a,b,c){for(var d,e,f=0;f<h.groups.length;f++)if(d=h.groups[f],d.active)for(var g=0;g<d.shortcuts.length;g++)if(e=d.shortcuts[g],e.ctrlKey===a&&e.shiftKey===b&&e.keyCode===c)return e}function d(a,c){var d=b.isInput(document.activeElement);(!d||c.allowInAllContexts)&&e(a,c)}function e(a,b){b.preventDefault&&a.preventDefault(),"number"!=typeof h.timer.id&&(b.callback(b),b.delay>0?h.timer.id=setTimeout(function(){f()},b.delay):f())}function f(){clearTimeout(h.timer.id),delete h.timer.id}var g,h=this;this.currentEvent=a,a.shiftKey?a.shiftKey&&(a.ctrlKey||a.metaKey)&&(g=c(!0,!0,a.which),g&&d(a,g)):a.ctrlKey||a.metaKey?(g=c(!0,!1,a.which),g&&d(a,g)):(g=c(!1,!1,a.which),g&&d(a,g))},d=new c}),define("client.views/global-search/global-search-keyboard-shortcuts",["qvangular","general.utils/qv-keyboard-shortcuts"],function(a,b){function c(c,e,f){function g(){return"INPUT"===t[0].activeElement.tagName}function h(){return e.displaySuggestions}function i(){return e.displayResult&&!e.resultLoaderOpen}function j(){b.preventDefault(),a.$rootScope.$apply()}function k(a){var b,c,d;return document.selection&&document.selection.createRange?(b=document.selection.createRange(),c=b.getBookmark(),d=c.charCodeAt(2)-2):a.setSelectionRange&&(d=a.selectionStart),d===a.value.length}function l(){g()?h()?f.hideSuggestions():e.query?e.query="":e.close():e.close(),j()}function m(){h()?(e.activeSuggestionIx=Math.max(e.activeSuggestionIx-1,0),j()):i()&&(f.moveActiveResult(-1),j())}function n(){h()?(e.activeSuggestionIx=Math.min(e.activeSuggestionIx+1,e.suggestions.length-1),j()):i()&&(f.moveActiveResult(1),j())}function o(a){h()?-1===e.activeSuggestionIx?(f.hideSuggestions(),j()):p(a,!0):i()&&(f.select(e.searchTerms,e.activeSelectIx),j())}function p(a,b){h()&&(b||k(s))&&(e.activeSuggestionIx=-1===e.activeSuggestionIx?0:e.activeSuggestionIx,e.onSuggestSelect(),j())}var q,r,s=c.find("input")[0],t=a.getService("$document");q={preventDefault:!1,allowInInput:!0,delay:0},r={preventDefault:!1,allowInInput:!0,delay:75},d=b.createGroup("global-search",1),d.registerKeys("esc",l,q),d.registerKeys("up",m,r),d.registerKeys("down",n,r),d.registerKeys("enter",o,q),d.registerKeys("tab",p,q),d.registerKeys("right",p,q),d.on()}var d;return c.prototype.on=function(){d.on()},c.prototype.off=function(){d.off()},c.prototype["delete"]=function(){d["delete"]()},c}),define("text!client.views/global-search/directives/input/input.ng.html",[],function(){return'<div class="qv-search-input">\r\n	<div class="search-field-area">\r\n		<qui-search-field class="search-field" query="query" placeholder="GlobalSearch.SearchData" auto-focus="autoFocus" is-focused="isInputFocused" tid="globalSearch.searchField" />\r\n	</div>\r\n	<div class="search-underlines">\r\n		<span ng-repeat="underline in underlines" class="underline" ng-class="underline.isWhitespace ? \'term-space\' : \'term\' + underline.colorIx">{{underline.string}}</span>\r\n		<qv-global-search-input-hint></qv-global-search-input-hint>\r\n	</div>\r\n</div>'}),define("text!client.views/global-search/directives/input/input-hint.ng.html",[],function(){return'<span ng-show="displaySuggestions" class="search-suggest" tid="globalSearch.suggestionString">{{hintString}}</span>\r\n'}),define("client.views/global-search/global-search-data-service",["qvangular"],function(a){function b(a,b,d,e){var g;0!==b.length&&(a[d]||(a[d]={}),g=a[d],g.string=b,g.isWhitespace=e||b.length<2&&!c(b)||'"'===b,g.colorIx=g.isWhitespace?-1:f,f=g.isWhitespace?f:(f+1)%10)}function c(a){return a.match(/[\u3040-\u9FBF]/)||a.match(/[\uFF65-\uFF9F]/)}function d(a,b,d,e){b.length<2&&!c(b)||a.push({string:b,startQuote:d,endQuote:e})}function e(a,b,c,d){var e,f,g,h,i,j;for(i=a.qCharPos,j=i+a.qCharCount,e=0;e<b.length;++e)if(g=b[e],!(i>=g.end)){for(f=e;f<b.length;++f)h=b[f],!(j>h.end);f--,f-e>1&&b.splice(e+1,f-e-1),e===f?b.splice(e+1,0,{start:j,end:h.end,highlight:h.highlight,term:h.term}):h.start=j,g.end=i,b.splice(e+1,0,{start:i,end:j,highlight:!0,term:c});break}for(e=b.length-1;e>=0;--e)b[e].start===b[e].end?b.splice(e,1):b[e].substring=d.substring(b[e].start,b[e].end)}var f=0;return a.service("qvGlobalSearchService",function(){this.transformResult=function(a,b,c,d,f){var g,h,i,j,k,l,m,n,o,p,q,r,s=b.qResults;for(a.searchTermGroups=a.searchTermGroups||[],g=0;g<s.qSearchTermsMatched.length;++g){for(a.searchTermGroups[c+g]=a.searchTermGroups[c+g]||[],l=a.searchTermGroups[c+g],h=0;h<s.qSearchTermsMatched[g].length;++h){for(l[d+h]=l[d+h]||{},m=l[d+h],m.selectIx=s.qSearchTermsMatched[g][h].qId,m.groupBaseRowIx=f,m.matches=m.matches||[],m.nbrMatches=0,i=0;i<s.qSearchTermsMatched[g][h].qFieldMatches.length;++i){for(p=s.qSearchTermsMatched[g][h].qFieldMatches[i],m.matches[i]=m.matches[i]||{},n=m.matches[i],n.fieldName=s.qFieldNames[p.qField],n.hits=n.hits||[],r=p.qValues.length,n.rowIndex=m.selectIx,n.fieldMatchIndex=i,n.nDisplayValues=r,n.moreHits=p.qNoOfMatches-r,m.nbrMatches+=p.qTerms.length,j=0;r>j;++j)for(n.hits[j]=n.hits[j]||{},o=n.hits[j],q=s.qFieldDictionaries[p.qField].qResult[p.qValues[j]],o.ranges=[{start:0,end:q.qText.length,highlight:!1,term:-1}],k=0;k<q.qRanges.length;++k)e(q.qRanges[k],o.ranges,q.qRanges[k].qTerm%10,q.qText);n.hits.splice(j,n.hits.length-j)}m.matches.splice(i,m.matches.length-i)}l.splice(d+h,l.length-(d+h)),f+=l.length,a.nbrLoadedRows=f,d=0}for(a.searchTermGroups.splice(c+g,a.searchTermGroups.length-(c+g)),this.setHeaders(a),a.displayResult=!1,g=0;g<a.searchTermGroups.length;++g)if(a.searchTermGroups[g].length>0){a.displayResult=!0;break}},this.showMore=function(a,b){var c=a.qResults;if(1===c.qSearchTermsMatched.length){var d,f,g,h,i=c.qSearchTermsMatched[0][0].qFieldMatches[b.fieldMatchIndex],j=i.qValues.length;for(b.nDisplayValues=j,b.moreHits=i.qNoOfMatches-j,g=0;j>g;++g)if(!b.hits[g])for(b.hits[g]={},f=b.hits[g],d=c.qFieldDictionaries[i.qField].qResult[i.qValues[g]],f.ranges=[{start:0,end:d.qText.length,highlight:!1,term:-1}],h=0;h<d.qRanges.length;++h)e(d.qRanges[h],f.ranges,d.qRanges[h].qTerm%10,d.qText)}},this.setHeaders=function(a){var b,c,d,e=0;for(c=0;c<a.searchTermGroups.length;c++)for(d=0;d<a.searchTermGroups[c].length;d++)b=a.searchTermGroups[c][d],b.matches.length>e&&(e=b.matches.length);for(a.columnCount=e,a.columnWidth=Math.floor(100/e)+"%",a.shadowHeaders=a.shadowHeaders||[],a.shadowHeaders.splice(0,a.shadowHeaders.length-e),c=a.shadowHeaders.length;e>c;c++)a.shadowHeaders[c]={}},this.transformSuggest=function(a,b,c){var d,e,f=0,g=[];for(this.getUnderlinersAndSearchTerms(a.query,g,[]),c=void 0!==c?c:25,c=Math.min(c,b.qResult.qSuggestions.length),d=0;c>d;++d)e={value:b.qResult.qSuggestions[d].qValue,term:b.qResult.qSuggestions[d].qTerm},a.query!==this.getResultingQueryFromSuggestion(g,e)&&(a.suggestions[f]=e,f++);a.suggestions.splice(f,a.suggestions.length-f)},this._whitespaces=[" ","	","\n","\r","\r\n",""],this.isWhiteSpaceAt=function(a,b){var c,d=this._whitespaces,e=a.charAt(b);for(c=0;c<d.length;++c)if(e===d[c])return!0;return!1},this.getUnderlinersAndSearchTerms=function(a,c,e){function g(a,b){var c,d,e;for(d=0;d<o.length;++d)c=a.indexOf(o[d],b),c>=0&&(!e||e>c)&&(e=c);return e||-1}function h(a,b){var c;do c=a.indexOf('"',b),b=c+1;while(c>=0&&m>b&&!p.isWhiteSpaceAt(a,b));return c}function i(){for(;m>l&&p.isWhiteSpaceAt(a,l);)l++;l>k&&b(c,a.substring(k,l),n++,!0),k=l}var j,k=0,l=0,m=a.length,n=0,o=this._whitespaces,p=this;for(e.length=0,f=0,i();m>k;)if('"'!==a.charAt(k)){if(l=g(a,k),j=l>=0?a.substring(k,l):a.substring(k),b(c,j,n++),d(e,j,!1,!1),0>l)break;k=l,i()}else{if(b(c,a.substring(k,k+1),n++),l=h(a,++k),j=l>=0?a.substring(k,l):a.substring(k),b(c,j,n++),d(e,j,!0,l>0),0>l)break;b(c,a.substring(l,l+1),n++),k=l+=1,i()}c.splice(n,c.length-n)},this.getSuggestTerms=function(a,b){function c(a){var b,c,d;if(a=a.trim(),0===a.length)return null;for(b=a.length,c=b-1,d=-1;c>-1;){if(h.isWhiteSpaceAt(a,c)){d=c+1;break}c--}return d=Math.max(d,0),a.substring(d,b)}var d,e,f,g,h=this;return d=b.lastElement,f=c(a),e=b.map(function(a){return a.string}),f&&(g=d?d.startQuote&&!d.endQuote:!1,2===f.length&&'"'===f.charAt(0)?e.push(f.charAt(1)):1!==f.length||g||e.push(f)),e},this.getUnderlineLengthFromTermIx=function(a,b){for(var c,d=0,e=0;d<a.length&&(c=a[d],b>e||c.isWhitespace)&&(d!==a.length-1||1!==c.string.length||this.isWhiteSpaceAt(c.string,0)||'"'===c.string);)c.isWhitespace||e++,d++;return d>0?d:0},this.getResultingQueryFromSuggestion=function(a,b){var c,d,e,f,g=this.getUnderlineLengthFromTermIx(a,b.term);return c=a.slice(0,g).reduce(function(a,b){return a+b.string},""),d='"'===c.charAt(c.length-1),e=d?!1:b.value.indexOf(" ")>=0,f=e||d,c+(e?'"':"")+b.value+(f?'"':"")}})}),define("client.views/global-search/directives/input/input",["qvangular","util","text!./input.ng.html","text!./input-hint.ng.html","client.views/global-search/global-search-data-service"],function(a,b,c,d){function e(a,b){var c;if(a.length!==b.length)return!1;for(c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}var f=null;a.directive("qvGlobalSearchInput",["$timeout","qvGlobalSearchService",function(a,d){return{restrict:"E",replace:!0,template:c,require:"^qvGlobalSearch",link:function(c,g,h,i){var j=g.find("input"),k=[];j.on("keydown",function(){c.ignoreQueryChange=!1}),c.autoFocus=!b.isIos(),c.$watch("query",function(b){var g,h,j=[];return a.cancel(f),c.ignoreQueryChange||i.hideSuggestions(),b&&0!==b.length?(d.getUnderlinersAndSearchTerms(b,c.underlines,j),c.ignoreQueryChange?void(c.ignoreQueryChange=!1):(i.abortSuggest(),void(f=a(function(){var a=j.length>0?j.lastElement.string.indexOf(" ")>=0:!1;a||!d.isWhiteSpaceAt(b,b.length-1)&&'"'!==b.charAt(b.length-1)?(h=d.getSuggestTerms(b,j),i.suggest(h)):i.hideSuggestions(),g=j.map(function(a){return a.string}),j.length>0&&!e(g,k)?i.search(g):b.length<2&&i.emptyResult(),k=g,f=null},200)))):(i.emptyResult(),i.abortSuggest(),i.abortSearch(),c.underlines.length=0,void(k=[]))}),c.$on("focusInput",function(){j.focus()}),c.$on("$destroy",function(){j.off()})}}}]),a.directive("qvGlobalSearchInputHint",["qvGlobalSearchService",function(a){return{restrict:"E",replace:!0,template:d,require:"^qvGlobalSearch",link:function(b){function c(){var c,d,e,f,g,h=b.suggestions[-1===b.activeSuggestionIx?0:b.activeSuggestionIx],i=[],j=[];a.getUnderlinersAndSearchTerms(b.query,i,j),c=a.getSuggestTerms(b.query,j),!b.displaySuggestions||b.suggestions.length<=0||0===c.length||(d=a.getUnderlineLengthFromTermIx(i,h.term),e=i.slice(0,d).reduce(function(a,b){return a+b.string},""),f=i.slice(d).reduce(function(a,b){return a+(b.isWhitespace?" ":b.string)},""),f=h.value.slice(0,f.length),g=h.value.slice(f.length),b.ignoreQueryChange=!0,b.hintString=g,b.query=e+f)}b.$watch("activeSuggestionIx",function(){c()}),b.$watchCollection("suggestions",function(){c()}),b.$watch("displaySuggestions",function(){c()})}}}])}),define("text!client.views/global-search/directives/result/result.ng.html",[],function(){return'<div>\r\n	<div ng-show="displayResult" class="qv-global-search-result-groups">\r\n		<div ng-repeat="searchTermGroup in searchTermGroups" ng-if="searchTermGroup.length > 0">\r\n			<table>\r\n				<caption q-translation="GlobalSearch.MatchedSearchTerms,{{searchTermGroup.0.nbrMatches}}"></caption>\r\n				<tr>\r\n					<th ng-repeat="header in shadowHeaders" ng-style="{width: columnWidth}"></th>\r\n				</tr>\r\n				<tr ng-repeat="combination in searchTermGroup" qv-scroll-to-active="{{combination.groupBaseRowIx + $index === activeSelectIx}}" qva-activate="select( combination, $index )" tid="globalSearch.resultGroup">\r\n					<td ng-repeat="match in combination.matches" tid="globalSearch.resultField">\r\n						<strong class="field-name" tid="globalSearch.resultField.Name">{{match.fieldName}}</strong><br />\r\n						<span ng-repeat="hit in match.hits" tid="globalSearch.resultField.Hit">\r\n							<span ng-repeat="range in hit.ranges track by $index" ng-class="range.highlight ? \'highlighted\' + range.term : \'\'">{{range.substring}}</span>\r\n							<span>{{$last ? \'\' : \', \'}}</span>\r\n						</span>\r\n						<span tid="globalSearch.resultField.MoreHits" ng-if="$last && match.moreHits > 0" qva-activate="onShowMoreHits($event, match)" ng-class="match.disableShowMore?\'more-hits-disabled\':\'more-hits\'" q-translation="GlobalSearch.MoreResults,{{match.moreHits}}"></span>\r\n					</td>\r\n					<td ng-if="combination.matches.length < columnCount" colspan="{{columnCount - combination.matches.length}}"></td>\r\n				</tr>\r\n			</table>\r\n			<hr ng-if="!$last" />\r\n		</div>\r\n	</div>\r\n	<div class="qv-global-search-result-expander"></div>\r\n	<div class="qv-global-search-result-message" ng-show="emptyMessageEnabled && searchTerms.length > 0 && !displayResult && !error.show && !resultLoaderOpen" q-translation="Common.NoMatchesForCurrentSearch"></div>\r\n	<div class="qv-global-search-result-error" ng-show="error.show">\r\n		<h1>{{error.message}}</h1>\r\n		<p>{{error.description}}</p>\r\n	</div>\r\n	<qv-global-search-throbber></qv-global-search-throbber>\r\n</div>\r\n'}),define("client.views/global-search/directives/result/result",["qvangular","text!./result.ng.html","touche"],function(a,b){a.directive("qvGlobalSearchResult",["$timeout",function(a){return{restrict:"E",template:b,replace:!0,require:["^qvGlobalSearch","qvGlobalSearchResult"],controller:function(){this.getElement=function(){}},link:function(b,c,d,e){var f=e[0],g=e[1];b.resultLoaderOpen=!1,b.emptyMessageEnabled=!1,b.select=function(c,d){Touche.utils.touch?(b.activeResultIx=d,a(function(){f.select(b.searchTerms,c.selectIx)},100)):f.select(b.searchTerms,c.selectIx)},b.loadNextPage=function(){f.loadNextPage()},c.on("scroll",function(){var a=c[0].scrollTop,d=c[0].scrollHeight,e=c.height();a+e>=d&&b.paging.lastRowIx<b.paging.totalRows&&f.loadNextPage()}),g.getElement=function(){return c}}}}]),a.directive("qvScrollToActive",function(){return{restrict:"A",require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(a,b,c,d){function e(a){a[0].scrollTop=b[0].offsetParent.offsetTop+b[0].offsetTop
}function f(){b[0].scrollIntoView(!1)}var g=d[1];c.$observe("qvScrollToActive",function(a){if(a=a+""=="true",b.toggleClass("active",a),a){var c=g.getElement(),d=b.position();d.top<0?e(c):d.top+b.height()>c.height()&&f()}})}}})}),define("text!client.views/global-search/directives/suggest/suggest.ng.html",[],function(){return'<div class="qv-search-suggest-wrapper" ng-show="displaySuggestions" tid="globalSearch.suggestions">\r\n	<span class="hidden">{{query}}</span>\r\n	<ul class="suggest-popup">\r\n		<li ng-repeat="suggest in suggestions track by $index" ng-class="{active: $index == activeSuggestionIx}" qva-activate="onSuggestSelect($index)" tid="globalSearch.suggestion">\r\n			{{suggest.value}}\r\n		</li>\r\n	</ul>\r\n</div>\r\n'}),define("client.views/global-search/directives/suggest/suggest",["qvangular","text!./suggest.ng.html"],function(a,b){var c=null;a.directive("qvGlobalSearchSuggest",["$timeout",function(a){return{restrict:"E",template:b,replace:!0,require:"^qvGlobalSearch",link:function(b,d,e,f){function g(){c&&a.cancel(c),c=a(function(){f.hideSuggestions(),c=null},4e3)}d.find(".suggest-popup").on("mousemove",function(){g()}),b.$on("suggestShow",function(){b.displaySuggestions&&g()}),b.$watch("activeSuggestionIx",function(){b.displaySuggestions&&g()})}}}])}),define("text!client.views/global-search/directives/throbber/throbber.ng.html",[],function(){return'<div ng-show="resultLoaderOpen" class="qv-animate progress ng-hide">\r\n	<div class="progress-loader"></div>\r\n</div>'}),define("client.views/global-search/directives/throbber/throbber",["qvangular","text!./throbber.ng.html"],function(a,b){a.directive("qvGlobalSearchThrobber",["$timeout",function(a){return{replace:!0,template:b,restrict:"E",require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(b,c,d,e){function f(a){a&&(h.getElement()[0].scrollTop=0)}var g,h=e[1];b.$on("resultLoader",function(c,d,e){d?(a.cancel(g),g=a(function(){f(e),b.resultLoaderOpen=!0,b.emptyMessageEnabled=!1},1e3)):(a.cancel(g),f(e),b.resultLoaderOpen=!1,b.emptyMessageEnabled=b.searchTerms.length>0)})}}}])}),define("client.views/global-search/global-search",["qvangular","text!./global-search.ng.html","core.models/app","./global-search-keyboard-shortcuts","autogenerated/qix/engine-enums","client.controllers/error-handler-controller","client.views/global-search/directives/input/input","client.views/global-search/directives/result/result","client.views/global-search/directives/suggest/suggest","client.views/global-search/directives/throbber/throbber","client.views/global-search/global-search-data-service","client.views/global-selections/global-selections-service"],function(a,b,c,d,e,f){var g={idle:0,pending:1,aborting:2};return a.directive("qvGlobalSearch",function(){return{restrict:"E",template:b,controller:["$scope","$document","$element",function(b,h,i){function j(a){var c,d,e=b.searchTermGroups.length-1;return d=a.qSearchTermsMatched[0][0].qFieldMatches.reduce(function(a,b){return a+b.qTerms.length},0),c=b.searchTermGroups[e][0].nbrMatches===d?e:e+1}function k(a){var c=0;return b.searchTermGroups[a]&&(c=b.searchTermGroups[a].length),c}function l(a){var c,d,e=b.searchTermGroups;return e[a]?(d=e[a],c=d[0].groupBaseRowIx):(d=e[a-1],c=d[0].groupBaseRowIx+d.length),c}var m=a.getService("qvGlobalSearchService"),n=a.getService("$timeout"),o=a.getService("qvGlobalSelectionsService"),p=new d(i,b,this),q=h.find(".qv-panel-current-selections"),r={search:{idCounter:0,state:g.idle,searchTerms:""},result:{state:g.idle},suggest:{state:g.idle,suggestTerms:""}},s=this,t=b.$watch(o.isSelectActive,function(){n(function(){b.toolbarHeight=q.outerHeight()+q.offset().top})});b.input="input goes here",b.result="result goes here",b.toolbarHeight=q.outerHeight()+q.offset().top,b.$on("$destroy",function(){p["delete"](),t()}),b.underlines=[],b.query="",b.searchTerms=[],b.searchTermGroups=[],b.displayResult=!1,b.activeSelectIx=-1,b.error={show:!1,message:"",description:""},b.paging={lastRowIx:0,totalRows:0},b.onShowMoreHits=function(a,c){if(a.stopPropagation(),!c.disableShowMore){c.disableShowMore=!0;var d={qOffset:c.rowIndex,qCount:1,qMaxNbrFieldMatches:c.nDisplayValues+15};s.callSearch(b.searchTerms,d).then(function(a){m.showMore(a,c)})["finally"](function(){c.disableShowMore=!1})}},b.close=function(){o.toggleGlobalSearch()},b.suggestions=[],b.displaySuggestions=!1,b.activeSuggestionIx=-1,b.ignoreQueryChange=!1,b.onSuggestSelect=function(a){var c,d,e,g=[];a=void 0!==a?a:b.activeSuggestionIx,e=b.suggestions[a],m.getUnderlinersAndSearchTerms(b.query,g,[]),c=m.getResultingQueryFromSuggestion(g,e),c.length>255?(p.off(),f.showDialog({message:"ErrorDialog.SearchStringTooLong"}),d=b.$on("errorHandlerClosed",function(){p.on(),d()})):(b.query=c,b.ignoreQueryChange=!1),s.hideSuggestions(),b.$broadcast("focusInput")},this.hideSuggestions=function(){b.displaySuggestions&&(b.displaySuggestions=!1,b.activeSuggestionIx=-1,b.activeSelectIx=0)},this.showSuggestions=function(){b.displaySuggestions=!0,b.activeSuggestionIx=-1,b.activeSelectIx=-1},this.showError=function(a){b.displayResult=!1,b.error.show=!0,b.error.message=a.error.message,b.error.description=a.error.parameter,a.isHandled=!0},this.toogleSuggestions=function(a){a?this.showSuggestions():this.hideSuggestions()},this.emptyResult=function(){b.displayResult=!1,b.activeSelectIx=-1,b.error.show=!1,b.searchTerms=[],b.$broadcast("resultLoader",!1),this.hideSuggestions()},this.moveActiveResult=function(a){0!==a&&(a>0?(b.activeSelectIx=Math.min(b.activeSelectIx+1,b.nbrLoadedRows-1),b.activeSelectIx===b.nbrLoadedRows-1&&b.nbrLoadedRows<b.paging.totalRows&&this.loadNextPage()):0>a&&(b.activeSelectIx=Math.max(b.activeSelectIx-1,0)))},this.search=function(a){function c(c){return r.search.state===g.aborting?(r.search.state=g.idle,void h.search(r.search.searchTerms)):void(f===r.search.idCounter&&(r.search.state=g.idle,r.search.searchTerms="",b.searchTerms=a,b.$broadcast("resultLoader",!1),m.transformResult(b,c,0,0,0),b.activeSelectIx=0,b.paging.lastRowIx=b.searchTermGroups.reduce(function(a,b){return a+b.length},0),b.paging.totalRows=c.qResults.qTotalSearchResults))}function d(a){return a.error.code===e.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&h.showError(a),r.search.state===g.aborting?(r.search.state=g.idle,void h.search(r.search.searchTerms)):(r.search.state=g.idle,r.search.searchTerms="",b.$broadcast("resultLoader",!1),void(b.displayResult=!1))}if(0!==a.length){var f=++r.search.idCounter,h=this,i={qOffset:0,qCount:15,qMaxNbrFieldMatches:5};if(r.search.state===g.idle)r.search.state=g.pending,r.search.searchTerms=a,b.$broadcast("resultLoader",!0,!0);else if(r.search.state===g.pending||r.search.state===g.aborting)return r.search.state=g.aborting,r.search.searchTerms=a,void b.$broadcast("resultLoader",!0);b.error.show=!1,this.callSearch(a,i).then(c,d)}},this.loadNextPage=function(){var a={qOffset:b.paging.lastRowIx,qCount:15,qMaxNbrFieldMatches:5};r.result.state===g.idle&&(r.result.state=g.pending,this.callSearch(b.searchTerms,a).then(function(a){var c=j(a.qResults),d=k(c),e=l(c);m.transformResult(b,a,c,d,e),b.paging.lastRowIx=b.searchTermGroups.reduce(function(a,b){return a+b.length},0)})["finally"](function(){r.result.state=g.idle}))},this.callSearch=function(a,b){return c.current.rpc("SearchAssociations",null,[{},a,b])},this.suggest=function(a){function d(a){return r.suggest.state===g.aborting?(r.suggest.state=g.idle,void h.suggest(r.suggest.suggestTerms)):(r.suggest.state=g.idle,r.suggest.suggestTerms="",void(m.isWhiteSpaceAt(b.query,b.query.length-1)||'"'===b.query.charAt(b.query.length-1)||(m.transformSuggest(b,a,10),h.toogleSuggestions(b.suggestions.length>0),b.$broadcast("suggestShow",!0,!0))))}function f(a){return a.error.code===e.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(a.isHandled=!0),r.suggest.state===g.aborting?(r.suggest.state=g.idle,void h.suggest(r.suggest.suggestTerms)):(r.suggest.state=g.idle,void(r.suggest.suggestTerms=""))}if(0!==a.length){var h=this;if(r.suggest.state===g.idle)r.suggest.state=g.pending,r.suggest.suggestTerms=a;else if(r.suggest.state===g.pending||r.suggest.state===g.aborting)return r.suggest.state=g.aborting,void(r.suggest.suggestTerms=a);c.current.rpc("SearchSuggest",null,[{},a]).then(d,f)}},this.abortSuggest=function(){(r.suggest.state===g.pending||r.suggest.state===g.aborting)&&(r.suggest.state=g.aborting,r.suggest.suggestTerms="")},this.abortSearch=function(){(r.search.state===g.pending||r.search.state===g.aborting)&&(r.search.state=g.aborting,r.search.searchTerms="")},this.select=function(a,d){0!==a.length&&(0>d&&(d=b.activeSelectIx=0),c.current.rpc("SelectAssociations",null,[{},a,d]),o.toggleGlobalSearch())}}],require:["qvGlobalSearch"],scope:{},replace:!0,link:function(){}}}),"<qv-global-search></qv-global-search>"}),define("client.views/global-selections/global-selections-service",["jquery","qvangular","client.views/global-selections/global-selections","client.views/mobile-selections/mobile-selections","client.views/global-selections-deactivate/global-selections-deactivate","client.views/global-search/global-search","client.utils/state","general.utils/responsive-state","core.models/app","client.views/selection-toolbar/selection-toolbar-service"],function(a,b,c,d,e,f,g,h,i){return b.service("qvGlobalSelectionsService",["$document","qvSelectionToolbarService",function(b,j){function k(){var a=Object.keys(t),b=0;return a.forEach(function(a){t[a].$container&&b++}),b}function l(){g.state!==g.States.analysis&&o(t.search)}function m(){o(t.select),n(t.select)}function n(a){a.$container=angular.element("<div>"),b.find("body").append(a.$container),a.$container.showComponent(a.getComponent()),r||h.isSmallDevice||(r=angular.element("<div>"),b.find("body").append(r),r.showComponent(e)),a.setup()}function o(a){a.$container&&(a.$container.remove(),a.$container=void 0),r&&0===k()&&(r.remove(),r=void 0),a.destroy()}function p(a){return a.$container?!0:!1}function q(b){p(b)?(o(b),a("body").removeClass("qv-global-selections-enabled")):(g.state===g.States.snapshot&&g.setState(g.States.analysis),a("body").addClass("qv-global-selections-enabled"),n(b))}var r,s,t={select:{$container:void 0,getComponent:function(){return h.isSmallDevice?d:c},setup:function(){h.ViewChanged.bind(m)},destroy:function(){h.ViewChanged.unbind(m)}},search:{$container:void 0,getComponent:function(){return f},setup:function(){g.StateChanged.bind(l),i.current.isModal()&&j.confirm()},destroy:function(){g.StateChanged.unbind(l)}}},u=null,v=0;return s={toggleGlobalSelection:function(){q(t.select)},toggleGlobalSearch:function(){q(t.search)},openGlobalSearch:function(){p(t.search)||q(t.search)},off:function(){var a=Object.keys(t);a.forEach(function(a){var b=t[a];o(b)})},isSelectActive:function(){return void 0!==t.select.$container},isSearchActive:function(){return void 0!==t.search.$container},setCsShowCallback:function(a){u=a},setCsShow:function(a){u&&u(a)},setSelectionCount:function(a){v=a},getSelectionCount:function(){return v}}}])}),define("text!client.views/state-count-bar/state-count-bar.ng.html",[],function(){return'<div class="qv-state-count-bar" tid="stateCount">\r\n	<div class="state selected" ng-style="{\'width\': percents.qSelected + \'%\'}"></div>\r\n	<div class="state locked" ng-style="{\'width\': percents.qLocked + \'%\'}"></div>\r\n	<div class="state optional" ng-style="{\'width\':  percents.qOption + \'%\'}"></div>\r\n	<div class="state alternative" ng-style="{\'width\':  percents.qAlternative + \'%\'}"></div>\r\n</div>'}),define("client.views/state-count-bar/state-count-bar",["qvangular","text!./state-count-bar.ng.html"],function(a,b){a.directive("qvStateCountBar",function(){return{restrict:"E",template:b,scope:{cardinal:"=",stateCounts:"="},link:function(a){function b(){var b,e=a.cardinal,f=a.stateCounts;void 0!==e&&void 0!==f&&(b=c(e,f),a.percents=d(b))}function c(a,b){var c={};return["qSelected","qLocked","qOption","qAlternative"].forEach(function(d){var e=b[d]||0,f=Math.round(e/a*100);e>0&&0===f&&(f=1),c[d]=f}),c}function d(a){var b,c,d={},e=0;for(b in a)d[b]=a[b],(!c||a[b]>a[c])&&(c=b),e+=a[b];return e>100&&(d[c]=a[c]-(e-100)),d}a.percents=[],a.$watch("cardinal",function(){b()}),a.$watchCollection("stateCounts",function(){b()})}}})}),define("client.views/current-selections/current-selections",["qvangular","text!./current-selections.ng.html","client.models/current-selections","objects/listbox-popover/listbox-popover-service","core.utils/resize","general.utils/responsive-state","client.utils/state","widget.pager","client.views/global-selections/global-selections-service","client.views/state-count-bar/state-count-bar","objects.views/charts/tooltip/chart-tooltip-service","client.views/current-selections/current-selections-service"],function(a,b,c,d,e,f,g){a.directive("qvPager",["qvGlobalSelectionsService","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function f(){c.refreshPager()}var g;"ontouchstart"in window&&d.css("overflow-x","auto"),g=c.$watch(a.isSelectActive,function(a){c.$emit("globalSelectionActive",a),b(function(){c.refreshPager(!1)})}),c.pagerData=d.find("ul").pager().data("qv-pager"),c.nextPage=function(){b(function(){c.pagerData.goToNextPage(),c.refreshPager(!0)})},c.prevPage=function(){b(function(){c.pagerData.goToPreviousPage(),c.refreshPager(!0)})},c.goToPage=function(a){c.pagerData.goToPage(a),c.refreshPager(!0)},c.refreshPager=function(a){var b="";a||c.pagerData.refresh(),d.removeClass("qv-pager-back qv-pager-forward"),1!==c.pagerData.currentPage?(c.showShadow=!0,b+="qv-pager-back "):c.showShadow=!1,c.pagerData.currentPage!==c.pagerData.maxPages&&(b+="qv-pager-forward "),d.addClass(b)},e.on("end",f),c.$on("refreshPager",f),c.$on("$destroy",function(){e.off("end",f),g()})}}}]);var h={template:b,replace:!0,restrict:"E",scope:{},link:function(b){var c,d=a.getService("$timeout"),e=a.getService("qvGlobalSelectionsService"),g=function(){d(function(){b.isSmallDevice=f.isSmallDevice})};b.isSmallDevice=f.isSmallDevice,f.ViewChanged.bind(g),b.mobileIndicatorTop=!1,b.mobileIndicatorShow=!1,e.setCsShowCallback(function(a){b.mobileIndicatorShow=a}),b.$on("globalSelectionActive",function(a,c){b.isGlobalSelectionsActive=c}),c=a.$rootScope.$watch("selectionObject",function(a){b.inSelection=a?!0:!1}),b.$watch(e.isSearchActive,function(a){b.isGlobalSearchActive=a}),b.toggleGlobalSelection=function(a){a.preventDefault(),e.toggleGlobalSelection()},b.toggleGlobalSearch=function(){e.toggleGlobalSearch()},b.$on("$destroy",function(){f.ViewChanged.unbind(g),e.setCsShowCallback(null),c()})},controller:["$scope","$timeout","qvChartTooltipService","qvGlobalSelectionsService","qvCurrentSelectionsService",function(b,e,h,i,j){function k(){i.setCsShow(f.isSmallDevice&&b.items.length>0&&g.view!==g.Views.object)}var l,m,n=!1;b.items=[],c.get().then(function(a){b.model=a}),c.bindLayout(b,"model",function(a){b.disable={clear:0===a.qSelectionObject.qSelections.length,back:0===a.qSelectionObject.qBackCount,forward:0===a.qSelectionObject.qForwardCount},b.items=a.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex}),b.items.forEach(function(a){a.translation=j.translate(a)}),b.nbrSelections=b.items.length,i.setSelectionCount(b.items.length),k(),e(function(){b.$broadcast("refreshPager")})}),b.$watch(g.inObjectView,k),b.$watch("isSmallDevice",k),b.clear=function(a){b.$parent.itemSelected&&(b.$parent.itemSelected=!1),b.model.clearField(a)},b.clearAllFields=function(){b.model.clearAll()},b.back=function(){b.model.back()},b.forward=function(){b.model.forward()},b.showPopover=function(a){var c=angular.element(a.target).closest(".item"),f=c.scope().item.qField,g={qvaOutsideIgnoreFor:"currentSelectionsItems",$alignToElement:c,showLock:!0};return b.isClearSelectionIcon(a.target)?void(b.activeFieldName&&(d.close(),b.activeFieldName="")):f===b.activeFieldName?(d.close(),void(b.activeFieldName="")):(e(function(){b.closeTooltip()},100),b.activeFieldName=f,void d.showField(f,g,{},function(){b.activeFieldName="",e(function(){b.closeTooltip()},100)}))},b.openTooltip=function(a,c){return b.isClearSelectionIcon(a.target)?void b.closeTooltip():void(n||Touche.utils.touch||(b.cancelTooltip(),l=e(function(){var b=c.qStateCounts.qSelected+c.qStateCounts.qSelectedExcluded+c.qStateCounts.qLocked;n=!0,h.open({content:{label:c.qField+" ("+b+"/"+c.qTotal+")",rows:[{content:c.translation}]},position:{x:a.clientX,y:a.clientY},direction:"bottom",template:"generic"})},500)))},b.closeTooltip=function(){n=!1,b.cancelTooltip(),h.close()},b.cancelTooltip=function(){e.cancel(l)},b.isClearSelectionIcon=function(a){return angular.element(a).closest(".remove").is(".remove")},m=a.$rootScope.$on("locked-feedback",function(c,d){b.items.forEach(function(c){-1!==d[0].indexOf(c.qField)&&(c.feedbackActive=d[1]?!1:!0,a.$apply(b))})}),b.$on("$destroy",function(){m()})}]};return a.directive("qvStageCurrentSelections",function(){return h}),h}),define("objects.views/charts/events/event-launcher",["core.utils/class"],function(a){return a.extend({init:function(){this._listeners={}},listen:function(a,b,c){return"function"!=typeof b?this:(this._listeners[a]||(this._listeners[a]=[]),this._listeners[a].push({callback:b,scope:c}),this)},stopListen:function(a,b,c){var d,e=this._listeners[a];if(e)for(d=e.length-1;d>=0;d-=1)b?(c&&c===e[d].scope&&e[d].callback===b||!c&&e[d].callback===b)&&e.splice(d,1):e.splice(d,1);return this},fire:function(a,b){var c,d,e=a;if("string"!=typeof e&&(e=a.getType()),c=this._listeners[e])for(d=c.length-1;d>=0;--d)"string"==typeof a?c[d].callback.apply(c[d].scope?c[d].scope:this,b||[]):c[d].callback.apply(c[d].scope?c[d].scope:this,[a]);return this},hasListener:function(a){var b=a;return"string"!=typeof b&&(b=a.getType()),this._listeners&&this._listeners[b]&&this._listeners[b].length}})}),define("objects.views/charts/invalidatable",["./events/event-launcher","objects.utils/animation-frame"],function(a,b){function c(a){this._validating=!0,this._invalidatedProperties&&(!a||a&&a.contains("properties"))&&e.call(this),this._invalidatedDisplay&&(!a||a&&a.contains("display"))&&d.call(this),this._validating=!1,this._invalidated=this._invalidatedDisplay||this._invalidatedProperties}function d(){this._updateDisplay(),this._invalidatedDisplay=!1,this.__invalidators.display=[]}function e(){this._updateProperties(),this._invalidatedProperties=!1,this.__invalidators.properties=[]}function f(){if(!this._invalidated&&!this._validating&&!this._released){var a=this;this._invalidated=!0,this._invalidatedAt=Date.now(),this._timer=b.request(function(){c.call(a,null)},this._element)}}return a.extend({init:function(){this._super(),this.__invalidations=[]},invalidate:function(){return f.call(this),this},invalidateProperties:function(a){return this._invalidatedProperties||(this._invalidatedProperties=!0,f.call(this)),this.__invalidators.properties.push(a),this},invalidateDisplay:function(a){return this._invalidatedDisplay||(this._invalidatedDisplay=!0,f.call(this)),this.__invalidators.display.push(a),this},validateNow:function(){return this.__invalidated=!0,this.updateNow(),this},updateNow:function(a){if(this._forced=!0,this._invalidated&&!this._validating){var d=a&&a.contains("display")===this._invalidatedDisplay,e=a&&a.contains("properties")===this._invalidatedProperties;(!a||d&&e)&&(b.cancel(this._timer),this._timer=null),c.call(this,a)}return this._forced=!1,this},_update:function(){return this},_updateDisplay:function(){},_updateProperties:function(){},cancel:function(){b.cancel(this._timer),this._invalidatedProperties=!1,this.__invalidators.properties=[],this._invalidatedDisplay=!1,this.__invalidators.display=[],this._invalidated=!1},release:function(){this._released=!0,this.cancel()}})}),define("objects.views/charts/utils/transition-helper",["jquery","core.utils/class"],function(a,b){function c(b,c,f){e.apply(this,[b,c]);var h,i,j,k,l,m=!0,n=!1,o=this;m=g.checkEqual(b,f);for(h in f)void 0===b[h]&&(n=!0);return m?void(o._endCallback&&o._endCallback.call(o._scope)):n?(a.extend(c,f),a.extend(b,f),void(o._endCallback&&o._endCallback.call(o._scope))):(i=this._transitionTime,j=Date.now(),this._inAnimation=!0,this._initiateAnimation=!1,this._transitionProgress=0,a.extend(c,d(b,c,f,0)),void(this._animationCallback=setInterval(function(){if(k=(Date.now()-j)/i,k>1)clearInterval(o._animationCallback),a.extend(c,d(b,c,f,1)),o._updateCallback&&o._updateCallback.call(o._scope),o._inAnimation=!1,o._lastFrame=!0,o._transitionProgress=1;else{switch(o._transitionCurve){case"linear":l=k;break;case"easeout":l=Math.sin(Math.PI*k/2);break;case"easein":l=1-Math.cos(Math.PI*k/2);break;default:l=(1+Math.cos(Math.PI*(1+k)))/2}o._transitionProgress=l,a.extend(c,d(b,c,f,l)),o._updateCallback&&o._updateCallback.call(o._scope)}k>1&&(c=a.extend({},f),o._endCallback.call(o._scope))},15)))}function d(b,c,e,f){var g=function(b,c){a.extend(b,d(b,e[i][c],f))},h=function(a,b,c){b[i]=d(a[i],b[i],c[i],f)};if(0>=f)return b;if(f>=1)return e;for(var i in b)b||!e?!b||e?(b[i]instanceof Array?b[i].forEach(g):isNaN(b[i])&&b[i]instanceof Object&&h(b,c,e),b[i]&&!e[i]&&(c[i]=e[i]),null===b[i]||null===e[i]||isNaN(b[i])||isNaN(e[i])||(c[i]=b[i]*(1-f)+e[i]*f)):void 0!==b.opacity&&(c.opacity=1-f):(void 0!==e.opacity&&(c.opacity=f),c=a.extend(c,e));return c}function e(b,c){a.extend(b,c),clearInterval(this._animationCallback),this._inAnimation=!1,this._lastFrame=!1}function f(a,b,d){(this._inAnimation||this._initiateAnimation&&this._transitionEnabled)&&c.call(this,a,b,d)}var g;return g=b.extend("TransitionHelper",{namespace:".transitionhelper",init:function(a,b,c,d){this._updateCallback=a,this._endCallback=b,this._transitionTime=c?c:500,this._scope=d,this._inAnimation=!1,this._transitionProgress=0,this._lastFrame=!1,this._animationCallback=function(){return null},this._initiateAnimation=!0,this._transitionEnabled=!0,this._transitionDelay=0,this._transitionCurve=""},transition:function(a,b,c,d,g,h){var i=this;this._oldValues=a,this._currentValues=b,this._newValues=c,this._updateCallback=g,this._endCallback=d,this._scope=h,e.apply(this,[a,b]),this._initiateAnimation=!0,this._inAnimation||this._lastFrame||(this._transitionDelay>0?this._trantisionTimeout=setTimeout(function(){f.apply(i,[a,b,c])},this._transitionDelay):f.apply(this,[a,b,c]))},clear:function(){clearInterval(this._animationCallback),clearTimeout(this._trantisionTimeout),this._inAnimation=!1,this._lastFrame=!0,this._transitionProgress=1},setTransitionTime:function(a){this._transitionTime=a},setDelay:function(a){this._transitionDelay=a},setTransitionCurve:function(a){this._transitionCurve=a}}),g.checkEqual=function(a,b){var c;for(c in b){if(!(c in a))return!1;if(typeof b[c]!=typeof a[c])return!1;if(Array.isArray(b[c])){if(!g.checkEqual(a[c],b[c]))return!1}else if(!(b[c]===a[c]||void 0===a[c]||"number"==typeof b[c]&&"number"==typeof a[c]&&isNaN(b[c])&&isNaN(a[c])))return!1}return!0},g}),define("objects.utils/shapes/circle",["./rect"],function(a){function b(a,b,c){0===arguments.length?this.set(0,0,0):this.set(a,b,c)}return b.prototype={toString:function(){return this.cx+" "+this.cy+" "+this.r},clone:function(){return new b(this.cx,this.cy,this.r)},set:function(a,b,c){this.cx=a,this.cy=b,this.r=c,this.radius=c},setPosition:function(a,b){this.cx=a,this.cy=b},setRadius:function(a){this.radius=a},combineWith:function(){},intersectsWith:function(a){return a.pointInside(this.cx,this.cy)},intersectsLine:function(a){if(this.pointInside(a.x1,a.y1)||this.pointInside(a.x2,a.y2))return!0;var b,c,d,e,f,g,h,i;if(b=Math.sqrt(Math.pow(a.x2-a.x1,2)+Math.pow(a.y2-a.y1,2)),c=(a.x2-a.x1)/b,d=(a.y2-a.y1)/b,e=c*(this.cx-a.x1)+d*(this.cy-a.y1),f=c*(this.cx-a.x2)+d*(this.cy-a.y2),e>=0&&1>=f){if(g=e*c+a.x1,h=e*d+a.y1,i=Math.sqrt(Math.pow(g-this.cx,2)+Math.pow(h-this.cy,2)),i<=this.r)return!0}else if(f>=0&&1>=f&&(g=f*c+a.x2,h=f*d+a.y2,i=Math.sqrt(Math.pow(g-this.cx,2)+Math.pow(h-this.cy,2)),i<=this.r))return!0;return!1},pointInside:function(a,b){var c=Math.sqrt(Math.pow(this.cx-a,2)+Math.pow(this.cy-b,2));return c<=this.r},getPoints:function(){return[{x:this.cx,y:this.cy}]},getBoundingRect:function(){return new a(this.cx-this.r,this.cy-this.r,2*this.r,2*this.r)}},b}),define("objects.views/charts/utils/vector",["core.utils/class"],function(a){var b;return b=a.extend({init:function(a,b){this.x=a||0,this.y=b||0},clone:function(){return new b(this.x,this.y)},add:function(a){this.x+=a.x,this.y+=a.y},dot:function(a){return this.x*a.x+this.y*a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}),b.add=function(a,b){return a.clone().add(b)},b}),define("objects.utils/shapes/arc",["./line","./circle","./rect","objects.views/charts/utils/vector"],function(a,b,c,d){function e(a){a+=Math.PI/4,0>a&&(a+=2*Math.PI),a%=2*Math.PI;var b=3;return a>=1.5*Math.PI?b=0:a>=Math.PI?b=1:a>=Math.PI/2&&(b=2),g[b]}function f(a,b,c,d,e,f,g){this.cx=a,this.cy=b,this.innerRadius=c,this.radius=d,this.radianOffset=(0>g?g+2*Math.PI:g)%(2*Math.PI),this.start=e,this.start-=this.start>Math.PI?2*Math.PI:0,this.end=f,this.end-=this.end>Math.PI?2*Math.PI:0,this.arcCenter=(e+f)/2%(2*Math.PI),this.x1=a+d*Math.cos(this.start+this.radianOffset),this.y1=b+d*Math.sin(this.start+this.radianOffset),this.x2=a+d*Math.cos(this.end+this.radianOffset),this.y2=b+d*Math.sin(this.end+this.radianOffset),this.x3=a+c*Math.cos(this.start+this.radianOffset),this.y3=b+c*Math.sin(this.start+this.radianOffset),this.x4=a+c*Math.cos(this.end+this.radianOffset),this.y4=b+c*Math.sin(this.end+this.radianOffset)}var g=["top","left","bottom","right"];return f.prototype={getDistance:function(a,b,c,d){var e=Math.abs(a-c),f=Math.abs(b-d),g=Math.sqrt(Math.pow(e,2)+Math.pow(f,2));return g},getAngle:function(a,b,c,d){var e=a-c,f=b-d,g=Math.atan2(f,e)-this.radianOffset;return g=0>g?g+2*Math.PI:g,g=g>Math.PI?g-2*Math.PI:g},pointInside:function(a,b){var c=this.getAngle(a,b,this.cx,this.cy),d=this.getDistance(a,b,this.cx,this.cy),e=this.start,f=this.end;return d>this.radius||d<this.innerRadius?!1:c>=e&&f>=c?!0:e>f&&(f>=c||c>=e)?!0:!1},getPoints:function(){var a=[];return a.push({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},{x:this.x3,y:this.y3},{x:this.x4,y:this.y4}),a},getBoundingRect:function(){var a=Math.min(Math.min(this.x1,this.x2),Math.min(this.x3,this.x4)),b=Math.min(Math.min(this.y1,this.y2),Math.min(this.y3,this.y4)),d=Math.max(Math.max(this.x1,this.x2),Math.max(this.x3,this.x4))-a,e=Math.max(Math.max(this.y1,this.y2),Math.max(this.y3,this.y4))-b;return new c(a,b,d,e)},getRelevantPosition:function(){var a=this.cx+this.radius*Math.cos(this.arcCenter+this.radianOffset),b=this.cy+this.radius*Math.sin(this.arcCenter+this.radianOffset);return{pos:{x:a,y:b},direction:e(this.arcCenter+this.radianOffset)}},intersectsWith:function(){return!0},intersectsLine:function(c){if(this.pointInside(c.x1,c.y1)||this.pointInside(c.x2,c.y2))return!0;if(c.intersectsLine(new a(this.x1,this.y1,this.x4,this.y4))||c.intersectsLine(new a(this.x3,this.y3,this.x2,this.y2)))return!0;var e=new b(this.cx,this.cy,this.innerRadius);if(this.innerRadius>0&&e.pointInside(c.x1,c.y1)&&e.pointInside(c.x2,c.y2))return!1;var f,g,h,i,j=new d(c.x2-c.x1,c.y2-c.y1),k=new d(c.x1-this.cx,c.y2-this.cy),l=j.dot(j),m=2*k.dot(j),n=k.dot(k)-this.radius*this.radius,o=m*m-4*l*n,p=[];if(0>o)return!1;if(o=Math.sqrt(o),g=(-m-o)/(2*l),h=(-m+o)/(2*l),g>=0&&1>=g&&p.push({x:c.x1+g*j.x,y:c.y1+g*j.y}),h>=0&&1>=h&&p.push({x:c.x1+h*j.x,y:c.y1+h*j.y}),!p.length)return!1;for(f=0;f<p.length;f++){if(i=this.getAngle(p[f].x,p[f].y,this.cx,this.cy),i>=this.start&&i<=this.end)return!0;if(this.start>this.end&&(i<=this.end||i>=this.start))return!0}return!1}},f}),define("objects.views/charts/components/chart-component",["../invalidatable","objects.views/charts/utils/transition-helper","objects.utils/shapes/rect","objects.utils/shapes/arc","objects.utils/layout","jquery"],function(a,b,c,d,e,f){function g(a){if(this._$renderAreaWrap){this.containerRect=new c(this.rect.x*this.layoutToContainerRatios.x||1,this.rect.y*this.layoutToContainerRatios.y||1,this.rect.width*this.layoutToContainerRatios.x||1,this.rect.height*this.layoutToContainerRatios.y||1),this.container.style.left=this.containerRect.x+"px",this.container.style.top=this.containerRect.y+"px",this.container.style.width=this.containerRect.width+"px",this.container.style.height=this.containerRect.height+"px";var b=this.isVisible(a)&&0!==this.rect.width&&0!==this.rect.height?"block":"none";this.container.style.display!==b&&(this.container.style.display=b)}}function h(a,c){return b.checkEqual(a,c)}function i(a){return a?(a=a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()}),a.replace(/^\-/,"")):""}var j;return j=a.extend({init:function(a,d,e){this._super(),this.testId=e,this.options=f.extend(!0,{},{dock:"center",show:!0,relevantSize:0,showFlag:this.ShowFlags.SPARK,components:{}},d),this._invalidations=[],this.rect=new c,this._transitionHelper=new b,this._transitionHelper.setTransitionCurve("easein"),this._oldProperties={},this._currentProperties={},this._transitionProperties={},this._useTransition=!1,this.outerRect=new c,this.containerRect=new c,this.layoutToContainerRatios={x:1,y:1},this.renderers={},this.dock=this.options.dock,this.show=this.options.show,this.isMini=this.options.isMini,this.relevantSize=this.options.relevantSize,this.showFlag=this.options.showFlag,this.layoutOrder=this.options.order||1,this.reductionOrder=this.options.reductionOrder,this.parentContainer=a,this.components=this.options.components,this.selectionIdentifier=this.options.label,this._selectionIndices=[0],this.chartFormatter=null,this.measureFormatters=[],this._globalAlpha=1,this._hasValidData=!1,this._createRenderArea();try{var g=d&&d.tcl?d.tcl:i(this.constructor.name);g&&this._$renderAreaWrap[0].setAttribute("tcl",g)}catch(h){}this.chartScale=1,this.__invalidators={size:[],display:[],properties:[]},this._edgeBleed={top:0,bottom:0,left:0,right:0}},ShowFlags:{SPARK:1,XSMALL:2,SMALL:4,MEDIUM:8,FULL:16},setData:function(a){this._data=a,this.invalidateProperties("ChartComponent.setData")},getTransformedShape:function(a){var b,e=this.layoutToContainerRatios.x||1,f=this.layoutToContainerRatios.y||1;return a instanceof c?b=new c(a.x*e,a.y*f,a.width*e,a.height*f):a instanceof d&&(b=new d(a.cx*e,a.cy*f,Math.min(e,f)*a.innerRadius,Math.min(e,f)*a.radius,a.start,a.end,a.radianOffset)),b},getTransformedPoint:function(a,b){return{x:a*this.layoutToContainerRatios.x||1,y:b*this.layoutToContainerRatios.y||1}},getOriginalPoint:function(a,b){return{x:a/this.layoutToContainerRatios.x||1,y:b/this.layoutToContainerRatios.y||1}},setLayoutMode:function(a){if(this._layoutMode!==a){this._layoutMode=a;var b=/\s*qv-layout-\S+\s*/g,c=this._layoutMode?" qv-layout-"+e.getLayoutModeKey(a):"";this.container.className.match(b)?this.container.className=this.container.className.replace(/\s*qv-layout-\S+\s*/g,c):this.container.className+=c,this.invalidateDisplay("ChartComponent.setLayoutMode")}},getLayoutMode:function(){return this._layoutMode},setVerticalLayoutMode:function(a){this._verticalLayoutMode=a},setHorizontalLayoutMode:function(a){this._horizontalLayoutMode=a},setSelectableShapes:function(a){this._selectableShapes=a},getSelectableShapes:function(){return this._selectableShapes||[]},getSelectedCacheItems:function(){var a,b=this._selectableShapes?this._selectableShapes.length:0,c=[];for(a=0;b>a;a++)this._selectableShapes[a].selected&&c.push(this._selectableShapes[a]);return c},getRect:function(){return this.rect},setRect:function(a,b,c,d){this.rect.set(a,b,c,d)},setUseTransition:function(a){this._useTransition=a},getTransitionHelper:function(){return this._transitionHelper},setOuterRect:function(a,b,c,d){this.outerRect.set(a,b,c,d)},setLayoutToContainerRatios:function(a,b){this.layoutToContainerRatios={x:a,y:b}},setContainerRect:function(a,b,c,d){this.containerRect.set(a,b,c,d)},setSelectionIndices:function(a){if(!(a&&a instanceof Array))throw"invalid input, selectionsIndices has to be an Array";this._selectionIndices=a},getSelectionIndices:function(){return this._selectionIndices},setDock:function(a){switch(a){case"left":case"top":case"right":case"bottom":case"center":break;
default:throw a+" invalid parameter"}this.options.dock=a,this.dock=a},getOppositeDock:function(){var a=this.options.dock;switch(a){case"left":return"right";case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"center":return"center";default:throw a+" invalid parameter"}},isHorizontal:function(){var a=this.options.dock;switch(a){case"top":case"bottom":return!0;default:return!1}},isVertical:function(){var a=this.options.dock;switch(a){case"left":case"right":return!0;default:return!1}},showComponent:function(){if(this.show=!0,this.renderers)for(var a in this.renderers)this.renderers[a].show()},hideComponent:function(){if(this.show=!1,this.renderers)for(var a in this.renderers)this.renderers[a].hide()},getFormatter:function(){return this._formatter||this.measureFormatters[0]||{format:function(a){return a.toString()}}},isVisible:function(a){void 0===a&&(a=this._layoutMode);var b=this.showFlag,c=a;return"object"==typeof b&&("whenVertical"in b&&(b=this.isVertical()?b.whenVertical:b.whenHorizontal),"vertical"in b)?this.show&&!!(b.vertical&this._verticalLayoutMode)&&!!(b.horizontal&this._horizontalLayoutMode):this.show&&!!(b&c)},setHasValidData:function(a){this._hasValidData=a},hasValidData:function(){return this._hasValidData},calculateRelevantSize:function(){this.relevantSize=this.options.relevantSize},reduceLayoutRect:function(a){switch(this.dock){case"top":a.y+=this.relevantSize,a.height-=this.relevantSize;break;case"bottom":a.height-=this.relevantSize;break;case"left":a.x+=this.relevantSize,a.width-=this.relevantSize;break;case"right":a.width-=this.relevantSize}},insertAdjacentTo:function(a,b){switch(this.dock){case"top":this.rect.x=a.x,this.rect.y=a.y-this.relevantSize,this.rect.width=a.width,this.rect.height=this.isVisible(this._layoutMode)?this.relevantSize:0,b&&(a.y-=this.relevantSize,a.height+=this.relevantSize);break;case"bottom":this.rect.x=a.x,this.rect.y=a.getBottom(),this.rect.width=a.width,this.rect.height=this.isVisible(this._layoutMode)?this.relevantSize:0,b&&(a.height+=this.relevantSize);break;case"left":this.rect.x=a.x-this.relevantSize,this.rect.y=a.y,this.rect.width=this.isVisible(this._layoutMode)?this.relevantSize:0,this.rect.height=a.height,b&&(a.x-=this.relevantSize,a.width+=this.relevantSize);break;case"right":this.rect.x=a.getRight(),this.rect.y=a.y,this.rect.width=this.isVisible(this._layoutMode)?this.relevantSize:0,this.rect.height=a.height,b&&(a.width+=this.relevantSize);break;case"center":this.rect.x=a.x,this.rect.y=a.y,this.rect.width=a.width,this.rect.height=a.height}},_updateProperties:function(){this._transition()},_updateDisplay:function(){this.hasValidData()&&this.isVisible(this._layoutMode)&&this.rect.width>0&&this.rect.height>0&&this.paint(this._layoutMode,this._data)},updateSize:function(){g.call(this,this._layoutMode);for(var a in this.renderers)this.renderers[a].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[a].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1)},_transition:function(){this._useTransition?h(this._currentProperties,this._transitionProperties)?this._onAnimatitonEnd():(this._inTransition=!0,this._transitionHelper.transition(this._oldProperties,this._currentProperties,this._transitionProperties,this._onAnimatitonEnd,this._updateDisplay,this)):(f.extend(this._currentProperties,this._transitionProperties),f.extend(this._oldProperties,this._transitionProperties),this.invalidateDisplay("onAnimatitonEnd"))},paint:function(){},setGlobalOpacity:function(a,b){this._globalAlpha=a,b||this.invalidateDisplay("ChartComponent.setGlobalOpacity")},_createRenderArea:function(){this.parentContainer&&(this.container=document.createElement("div"),this._$renderAreaWrap=f(this.container),this._$renderAreaWrap.attr("tid",this.testId),this._$renderAreaWrap.css({position:"absolute"}).addClass("qv-chart-component"),this.parentContainer.appendChild(this.container))},_onAnimatitonEnd:function(){this._inTransition=!1,this._oldProperties=f.extend(!0,{},this._transitionProperties),this.invalidateDisplay("onAnimatitonEnd")},release:function(){if(this._super(),this.renderers)for(var a in this.renderers)this.renderers[a].release()},clear:function(){if(this.renderers)for(var a in this.renderers)this.renderers[a].clear();this.cancel()},on:function(){},off:function(){}})}),define("objects.views/charts/utils/node",["core.utils/class"],function(a){var b;return b=a.extend("Node",{init:function(){this._parent=null,this._children=[],this._ancestors=null,this.data={}},detach:function(){return this._parent&&this._parent.removeChild(this),this},each:function(a,b){if("function"!=typeof a||!this._children||!this._children.length)return this;var c,d=this._children.length;for(c=0;d>c;c++)a.call(b,this._children[c],c),this._children[c].isBranch&&this._children[c].each(a,b);return this}}),Object.defineProperties(b.prototype,{parent:{get:function(){return this._parent}},isBranch:{get:function(){return this._children&&this._children.length}},children:{get:function(){return this._children}},siblings:{get:function(){if(!this._parent)return[];var a=this._parent._children.slice();return a.splice(a.indexOf(this),1),a}},ancestors:{get:function(){if(!this._ancestors){var a=this._parent;this._ancestors=a?[a].concat(a.ancestors):[]}return this._ancestors}},descendants:{get:function(){var a,b,c,d=[];for(a=0,b=this._children.length;b>a;a++)c=this._children[a],d.push(c),c._children.length&&(d=d.concat(c.descendants));return d}},leaves:{get:function(){var a,b,c=[],d=this._children.length;for(b=0;d>b;b++)a=this._children[b],a._children&&a._children.length?c=c.concat(a.leaves):c.push(a);return c}}}),b}),define("objects.views/charts/utils/node-selector",["general.utils/property-resolver"],function(a){var b={className:/^\w[\w-]+/,attr:/^\[\w(?:[\w\._-]+)?(?:[!]?=['\"][\w\s*#_-]*['\"])?\]/},c={className:function(a,b){return b.filter(function(b){var c=b.constructor.name;if(c){var d=a.replace(/(\-[a-z])/g,function(a){return a[1].toUpperCase()});return d=d[0].toUpperCase()+d.slice(1),c===a||c===d}})},attr:function(b,c,d,e){return e.filter(function(e){var f=a.getValue(e,b);if(!c)return"undefined"!=typeof f;if("undefined"==typeof f)return!1;switch(c){case"=":return d===String(f);case"!=":return d!==String(f)}return!1})}},d={find:function(a,b){var c,d,e=[],f=[];return b.isBranch&&(c=this._tokenize(a),d=b.descendants,c.forEach(function(a){var b=d.slice(),c=[],e=!1;a.reverse().forEach(function(a){return" "===a.type?(c.push(b),b=d.slice(),void(e=!1)):(b=this._filter(a,b),void(e=!0))},this),e&&c.push(b);var g=c[0].filter(function(a){var b,d,e=a.parent;for(b=1;b<c.length;b++){for(;e&&(d=c[b].indexOf(e))<0;)e=e.parent;if(0>d)return!1}return!0});f.push(g)},this),f.forEach(function(a){a.forEach(function(a){e.indexOf(a)<0&&e.push(a)})})),e||[]},_filter:function(a,b){if(!b||!b.length||!a||"function"!=typeof c[a.type])return[];switch(a.type){case"className":return c[a.type](a.value,b);case"attr":return c[a.type](a.attribute,a.operator,a.attributeValue,b)}return[]},_tokenize:function(a){var c,d,e,f,g=[];return a.split(/\s*,\s*/).forEach(function(a){for(a=a.trim(),c=[];a;){f=!1,e=a.match(/^\s*([>+~]|\s)\s*/),e&&(f=!0,c.push({type:" ",value:e[0]}),a=a.slice(e[0].length));for(var h in b)e=a.match(b[h]),e&&(f=!0,a=a.slice(e[0].length),d={type:h,value:e[0]},"attr"===h&&(e=e[0].match(/\[(\w[\w\._-]+)?(?:([!]?=)['\"]([\w\s#_-]*)['\"])?\]/),d.attribute=e[1],d.operator=e[2],d.attributeValue=e[3]),c.push(d));if(c&&c.length&&g.indexOf(c)<0&&g.push(c),!f)break}}),g}};return d}),define("objects.views/charts/shapes/display-object",["objects.views/charts/utils/node","objects.views/charts/utils/matrix","objects.utils/shapes/rect","objects.views/charts/utils/node-selector"],function(a,b,c,d){function e(){this.matrix=new b,this.scale=g.scale,this.rotate=g.rotate,this.translate=g.translate,this._dirtyBounds=!0}var f,g={translate:function(a,b){return this.matrix.translate(a,b),this._dirtyBounds=!0,this.invalidate(),this},rotate:function(a){return this.matrix.rotate(a),this._dirtyBounds=!0,this.invalidate(),this},scale:function(a,b){return this.matrix.scale(a,b),this._dirtyBounds=!0,this.invalidate(),this}};return f=a.extend("DisplayObject",{init:function(){this._super(),this._dirtyBounds=!0,this._bounds=new c(0,0,0,0),this._vmBounds=new c(0,0,0,0),this._visualBounds=new c(0,0,0,0),this._stage=null,this.rData={inherited:{}},this._modelView=null,this._inverseModelView=null,this._inheritedProps={}},find:function(a){return d.find(a,this)},translate:function(a,b){return 0===a&&0===b?this:(e.call(this),g.translate.call(this,a,b))},rotate:function(a){return isNaN(a)||0===a?this:(e.call(this),g.rotate.call(this,a))},scale:function(a,b){return 1===a?this:(e.call(this),g.scale.call(this,a,b))},invalidate:function(){var a=this._stage||this.stage;return a&&a.invalidateObject(this),this._inheritedProps={},this},attr:function(a){return"undefined"!=typeof this[a]?this[a]:"undefined"!=typeof this.rData.inherited[a]?this.rData.inherited[a]:void 0},attrs:function(a){for(var b in a)this[b]=a[b];return this},getBoundingRect:function(){return this._dirtyBounds&&this._calculateBounds(),this._vmBounds},getVisualBounds:function(){return this._dirtyBounds&&this._calculateBounds(),this._visualBounds},getVisualExpansion:function(){var a,b=this.attr("stroke");return b?(a=this.attr("strokeWidth"),a?a/2:0):0},pointInside:function(a,b){var c,d=this.getInverseModelView();return d?(c=d.transformPoint({x:a,y:b}),this.containsPoint(c.x,c.y)):this.containsPoint(a,b)},intersectsLine:function(a){var b,c,d=this.getInverseModelView();return d?(b=d.transformPoint({x:a.x1,y:a.y1}),c=d.transformPoint({x:a.x2,y:a.y2}),a=a.clone(),a.set(b.x,b.y,c.x,c.y),this.intersectsLocalLine(a)):this.intersectsLocalLine(a)},getPoints:function(){var a,b,c,d=this.getModelView();if(d){for(a=this.getLocalPoints(),b=0,c=a?a.length:0;c>b;b++)a[b]=d.transformPoint(a[b]);return a}return this.getLocalPoints()},getLocalPoints:function(){return[]},intersectsLocalLine:function(){return!1},containsPoint:function(){return!1},getLocalBoundingRect:function(){return this._dirtyBounds&&this._calculateBounds(),this._bounds},invalidateBounds:function(){return this._dirtyBounds=!0,this},clearModelView:function(){this._modelView=null,this._inverseModelView=null,this._isModelViewCalculated=!1,this._dirtyBounds=!0},getModelView:function(){return this._modelView||this._isModelViewCalculated||this._calculateModelView(),this._modelView},getInverseModelView:function(){return this._inverseModelView||this._isModelViewCalculated||this._calculateModelView(),this._inverseModelView},destroy:function(){this._stage=null},_calculateBounds:function(){var a,b=this._bounds,c=this.getLocalBoundingRect(),d=this.getModelView(),e=this.getVisualExpansion();c?(b.set(c.x,c.y,c.width,c.height),d?(a=this._getTransformedBoundsOfRect(d,b),this._vmBounds.set(a.x,a.y,a.width,a.height),a=this._getTransformedBoundsOfRect(d,{x:b.x-e,y:b.y-e,width:b.width+2*e,height:b.height+2*e}),this._visualBounds.set(a.x,a.y,a.width,a.height)):(this._vmBounds.set(c.x,c.y,c.width,c.height),this._visualBounds.set(c.x-e,c.y-e,c.width+2*e,c.height+2*e))):(b.set(0/0,0/0,0/0,0/0),this._vmBounds.set(0/0,0/0,0/0,0/0),this._visualBounds.set(0/0,0/0,0/0,0/0)),this._dirtyBounds=!1},_getTransformedBoundsOfRect:function(a,b){var c,d,e,f,g,h,i;return c=a.transformPoints([{x:b.x,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x+b.width,y:b.y+b.height},{x:b.x,y:b.y+b.height}]),d=c.map(function(a){return a.x}),e=c.map(function(a){return a.y}),f=Math.min.apply(null,d),h=Math.max.apply(null,d),g=Math.min.apply(null,e),i=Math.max.apply(null,e),{x:f,y:g,width:h-f,height:i-g}},_calculateModelView:function(){for(var a=this;a&&!a.rData.vmTransform;)a=a._parent;return this._isModelViewCalculated=!0,a?(a._modelView||(a._modelView=new b,a._inverseModelView=new b),a.rData.dirtyVMTransform&&(a._modelView.set(a.rData.vmTransform),a._inverseModelView.set(a.rData.vmTransform).invert(),delete a.rData.dirtyVMTransform),this._modelView=a._modelView,this._inverseModelView=a._inverseModelView,!0):!1}}),Object.defineProperties(f.prototype,{stage:{get:function(){return this._parent&&!this._stage?this._stage=this._parent.stage:this._parent||this._stage===this||(this._stage=null),this._stage}}}),f}),define("objects.views/charts/shapes/polygon",["objects.views/charts/shapes/display-object","objects.utils/shapes/polygon"],function(a,b){var c;return c=a.extend("Polygon",{init:function(a){this._super(),a?this.set(a):this._polygons=[]},getLocalBoundingRect:function(){var a;return this._polygons&&this._polygons.length?(a=this._polygons.reduce(function(a,b){return a.combineWith(b.getBoundingRect())},this._polygons[0].getBoundingRect()),{x:a.x,y:a.y,width:a.width,height:a.height}):void 0},getLocalPoints:function(){return this._polygons&&this._polygons[0]?this._polygons[0].points:[]},set:function(a){var c=a&&a[0]&&Array.isArray(a[0])?a:[a];this._polygons=c.map(function(a){return new b(a)}),this.invalidateBounds()},intersectsLocalLine:function(a){return this._polygons.some(function(b){return b.intersectsLine(a)})},containsPoint:function(a,b){return this._polygons.some(function(c){return c.pointInside(a,b)})}})}),define("objects.views/charts/utils/tree-node",["objects.views/charts/utils/node"],function(a){var b,c;return b=a.extend("TreeNode",{addChild:function(b){if(!(b&&b instanceof a))throw new TypeError("Expecting a Node as argument, but got "+b);if(b===this)throw"Can not add itself as child!";if(b._children&&b._children.length&&this.ancestors.indexOf(b)>=0)throw"Can not add an ancestor as child!";return b._parent&&b._parent!==this&&b._parent.removeChild(b),c=this._children.indexOf(b),c>=0&&this._children.splice(c,1),this._children.push(b),b._parent=this,b._ancestors=null,this},addChildren:function(a){var b,c=a?a.length:0;for(b=0;c>b;b++)this.addChild(a[b]);return this},removeChild:function(a){return c=this._children.indexOf(a),c>=0&&(this._children.splice(c,1),a._parent=null,a._ancestors=null),this},removeChildren:function(a){var b,c;if(!this._children)return this;if(a)for(c=a.length,b=0;c>b;b++)this.removeChild(a[b]);else for(;this._children.length;)this.removeChild(this._children[0]);return this}})}),define("objects.views/charts/shapes/container",["objects.views/charts/shapes/display-object","objects.views/charts/utils/tree-node"],function(a,b){var c,d;return c=a.extend("Container",{init:function(){this._super()},addChild:function(a){b.prototype.addChild.call(this,a),this.doInvalidate&&a.invalidate()},addChildren:b.prototype.addChildren,removeChild:function(a){this.doInvalidate&&a.invalidate(),a._stage=null;var c,d=a.descendants,e=d?d.length:0;for(c=0;e>c;c++)d[c]._stage=null;return b.prototype.removeChild.call(this,a),this},removeChildren:function(a){var b,c,d,e,f;if(!this._children)return this;if(a)for(d=a.length,b=0;d>b;b++)this.removeChild(a[b]);else{for(d=this._children.length,b=0;d>b;b++)for(this._children[b]._parent=null,this._children[b]._ancestors=null,this._children[b]._stage=null,e=this._children[b].descendants,f=e?e.length:0,c=0;f>c;c++)e[c]._stage=null;this._children.length=0}return this},pointInside:function(a,b){if(this._children&&this._children.length)for(var c=0,d=this._children.length;d>c;c++)if(this._children[c].pointInside(a,b))return!0;return!1},getLocalBoundingRect:function(){var a,b,c,e,f,g,h,i=!1;if(this._children&&this._children.length){for(g=0,h=this._children.length;h>g;g++)f=this._children[g].getLocalBoundingRect(),f&&!isNaN(f.width+f.height)&&(i?(a=Math.min(a,f.x),c=Math.max(c,f.x+f.width),b=Math.min(b,f.y),e=Math.max(e,f.y+f.height)):(a=f.x,c=f.x+f.width,b=f.y,e=f.y+f.height,i=!0));return i?{x:a,y:b,width:c-a,height:e-b}:d}return d}})}),define("objects.views/charts/renderers/stage",["objects.views/charts/shapes/container","objects.utils/shapes/rect","core.utils/notification"],function(a,b,c){var d;return d=a.extend("Stage",{init:function(){this._super(),this._stage=this,this._dimensions=new b(0,0,0,0),c.create(this,"Invalid")},invalidateObject:function(a){return this.Invalid.emit(a),this},destroy:function(){this._super(),c.release(this)}})}),define("objects.views/charts/renderers/renderer",["core.utils/class","objects.views/charts/renderers/stage","objects.utils/shapes/rect","objects.views/charts/utils/node-selector"],function(a,b,c,d){var e;return e=a.extend("Renderer",{init:function(){this._stage=new b,this._stageBinding=function(a){this.invalidateObject(a)}.bind(this),this._stage.Invalid.bind(this._stageBinding),this.scaling={x:1,y:1},this._size=new c,this._extendedSize=new c},find:function(a){return d.find(a,this._stage)},setDimensions:function(a,b,c,d){this._size.set(a,b,c,d)},setDimensionsToContainerRatio:function(a,b){this.scaling={x:a,y:b}},release:function(){this._stage&&this._stage.Invalid&&this._stage.Invalid.unbind(this._stageBinding),this._stage.destroy(),this._stageBinding=null},render:function(){},clear:function(){},invalidateObject:function(){}}),Object.defineProperties(e.prototype,{stage:{get:function(){return this._stage}}}),e}),define("objects.views/charts/shapes/rect",["objects.views/charts/shapes/display-object","objects.utils/shapes/rect"],function(a,b){var c;return c=a.extend("Rect",{init:function(a,c,d,e,f){this._super(),this._radius=f||0,b.apply(this,[a,c,d,e])},containsPoint:b.prototype.pointInside,intersectsLocalLine:b.prototype.intersectsLine,getLocalBoundingRect:b.prototype.getBoundingRect,getLocalPoints:b.prototype.getPoints,set:function(a,c,d,e,f){b.prototype.set.apply(this,[a,c,d,e]),f>=0&&(this._radius=f),this.invalidateBounds()}}),Object.keys(b.prototype).forEach(function(a){!c.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints"].indexOf(a)<0&&(c.prototype[a]=b.prototype[a])}),c}),define("objects.views/charts/renderers/canvas/rect",["objects.views/charts/shapes/rect"],function(a){return{displayObject:a,render:function(a,b,c){if(this._radius){var d=this.x,e=this.y,f=this.width,g=this.height,h=Math.min(this._radius,f/2,g/2),i=d+f,j=e+g;a.beginPath(),a.moveTo(d+h,e),a.quadraticCurveTo(d,e,d,e+h),a.lineTo(d,j-h),a.quadraticCurveTo(d,j,d+h,j),a.lineTo(i-h,j),a.quadraticCurveTo(i,j,i,j-h),a.lineTo(i,e+h),a.quadraticCurveTo(i,e,i-h,e),a.lineTo(d+h,e),a.closePath(),b&&a.fill(),c&&a.stroke()}else b&&a.fillRect(this.x,this.y,this.width,this.height),c&&a.strokeRect(this.x,this.y,this.width,this.height)}}}),define("objects.views/charts/shapes/circle",["objects.views/charts/shapes/display-object","objects.utils/shapes/circle"],function(a,b){var c;return c=a.extend("Circle",{init:function(a,c,d){this._super(),b.apply(this,[a,c,d])},containsPoint:b.prototype.pointInside,intersectsLocalLine:b.prototype.intersectsLine,getLocalPoints:b.prototype.getPoints,getLocalBoundingRect:function(){return{x:this.cx-this.r,y:this.cy-this.r,width:2*this.r,height:2*this.r}},set:function(){b.prototype.set.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(b.prototype).forEach(function(a){!c.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints"].indexOf(a)<0&&(c.prototype[a]=b.prototype[a])}),c}),define("objects.views/charts/renderers/canvas/circle",["objects.views/charts/shapes/circle"],function(a){return{displayObject:a,render:function(a,b,c){a.beginPath(),a.moveTo(this.cx+this.r,this.cy),a.arc(this.cx,this.cy,this.r,0,2*Math.PI,!1),b&&a.fill(),c&&a.stroke()}}}),define("objects.views/charts/shapes/line",["objects.views/charts/shapes/display-object","objects.utils/shapes/line"],function(a,b){var c;return c=a.extend("Line",{init:function(a,c,d,e){this._super(),b.apply(this,[a,c,d,e])},containsPoint:b.prototype.pointInside,intersectsLocalLine:b.prototype.intersectsLine,getLocalPoints:b.prototype.getPoints,getLocalBoundingRect:function(){var a=Math.min(this.x1,this.x2),b=Math.max(this.x1,this.x2),c=Math.min(this.y1,this.y2),d=Math.max(this.y1,this.y2);return{x:a,y:c,width:b-a,height:d-c}},set:function(){b.prototype.set.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(b.prototype).forEach(function(a){!b.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints"].indexOf(a)<0&&(c.prototype[a]=b.prototype[a])}),c}),define("objects.views/charts/renderers/canvas/line",["objects.views/charts/shapes/line"],function(a){return{displayObject:a,render:function(a,b,c){c&&(a.beginPath(),a.moveTo(this.x1,this.y1),a.lineTo(this.x2,this.y2),a.stroke())}}}),define("objects.views/charts/renderers/canvas/polygon",["objects.views/charts/shapes/polygon"],function(a){return{displayObject:a,render:function(a,b,c){var d,e,f,g,h,i;for(a.beginPath(),h=0;h<this._polygons.length;h++){if(d=this._polygons[h].points,e=d?d.length:0,f=d[0],!f)return;for(i=f,a.moveTo(f.x,f.y),g=1;e>g;g+=1)f=d[g],a.lineTo(f.x,f.y);this.close===!1||!c||i.x===f.x&&i.y===f.y||a.lineTo(i.x,i.y)}this.close!==!1&&a.closePath(),b&&a.fill(),c&&a.stroke()}}}),define("objects.views/charts/shapes/arc",["objects.views/charts/shapes/display-object","objects.utils/shapes/arc"],function(a,b){var c;return c=a.extend("Arc",{init:function(a,c,d,e,f,g,h){this._super(),b.apply(this,[a,c,d,e,f,g,h])},containsPoint:b.prototype.pointInside,intersectsLocalLine:b.prototype.intersectsLine,getLocalPoints:b.prototype.getPoints,getLocalBoundingRect:function(){var a=Math.min.apply(null,[this.x1,this.x2,this.x3,this.x4]),b=Math.min.apply(null,[this.y1,this.y2,this.y3,this.y4]);return{x:a,y:b,width:Math.max.apply(null,[this.x1,this.x2,this.x3,this.x4])-a,height:Math.max.apply(null,[this.y1,this.y2,this.y3,this.y4])-b}},set:function(){b.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(b.prototype).forEach(function(a){!c.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints"].indexOf(a)<0&&(c.prototype[a]=b.prototype[a])}),c}),define("objects.views/charts/renderers/canvas/arc",["objects.views/charts/shapes/arc"],function(a){return{displayObject:a,render:function(a,b,c){0===this.innerRadius&&(this.innerRadius+=.01),a.beginPath(),a.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),a.lineTo(this.innerRadius*Math.cos(this.end+this.radianOffset)+this.cx,this.innerRadius*Math.sin(this.end+this.radianOffset)+this.cy),a.arc(this.cx,this.cy,this.innerRadius,this.end+this.radianOffset,this.start+this.radianOffset,!0),a.lineTo(this.radius*Math.cos(this.start+this.radianOffset)+this.cx,this.radius*Math.sin(this.start+this.radianOffset)+this.cy),a.closePath(),b&&a.fill(),c&&a.stroke()}}}),define("objects.views/charts/shapes/text-helper",[],function(){function a(a,b,c,d){var e,f,g,i,j,k,l=a?a.split(/\n+|\r+|\r\n/):[],m=[],n=a?a.split(/\s+/):[],o=l[0];if("number"!=typeof b||0>=b)return[a];if("number"==typeof d&&l.length>=d)return l.slice(0,d);for(c&&(h.font=c),f=0;f<l.length;f++){for(k=l[f]||"",n=k.split(/\s+/),o=n[0],j="",e=1;e<n.length;e++)if(g=o+" "+n[e],i=h.measureText(g).width,i>b&&("number"!=typeof d||d>m.length)?(m.push(o),o=n[e]):o=g,"number"==typeof d&&m.length>=d){j=n.slice(e+1).join(" ");break}"number"!=typeof d||m.length<d?m.push(o):m[Math.max(0,m.length-1)]=(m[Math.max(0,m.length-1)]||"")+" "+o+" "+j}return m}function b(a,b,d,e){if(!a||!a.length)return[];d&&(h.font=d);var g,i,j,k,l=[],m=a.slice();if(m.filter(function(a){return!!a}),"number"!=typeof b||0>b)return a.slice();for(k=0;k<m.length;k++)j=m[k],i=null,j&&(j.length<=1||h.measureText(j).width<=b?l.push(j):(g=f(j,b,void 0,e-l.length),g.length<=1?l.push(g[0]):(i=g.pop(),l=l.concat(g),m[k+1]?m[k+1]=i+m[k+1]:m.push(i))));return l.forEach(function(a,b,c){c[b]=a?a.trim():a}),l.length>e?(l=l.splice(0,e),l[l.length-1]=c(l[l.length-1],b).text):(j=l[l.length-1],j&&j.length>1&&h.measureText(j).width>b&&(l[l.length-1]=c(j,b).text)),l}function c(a,b,c){var d,e,f,g,j=a,k=h.measureText("i").width,l=Math.ceil(b/k);if(c&&(h.font=c),a&&b){if(h.measureText(j).width>b){for(d=Math.min(l,j.length);d>0;d--)if(e=j.substring(0,d-1),f=e.trim()+i,h.measureText(f).width<=b){g=j.substring(d-1),j=f;break}d||(g=j,j=i)}}else g=void 0;return{text:j,rest:g}}function d(a){return"number"==typeof a&&isFinite(a)}function e(a,b,c,f){var g,i=a,j="",k=[];if(d(c)&&1>=c)return[a];var l=Math.ceil(b/f),m=Math.min(a.length,l);for(g=m;g>0&&(i=a.substring(0,g),j=a.substring(g),!(h.measureText(i).width<=b));g--);return g||i||(i=a.substring(0,1),j=a.substring(1)),k.push(i),j?(h.measureText(j).width>b?(j=e(j,b,c-1,f),k=k.concat(j)):k.push(j),k):k}function f(a,b,c,d){return a&&b?(c&&(h.font=c),e(a,b,d,Math.max(1,h.measureText("i").width))):[]}function g(c,d,e,f){var g;return isNaN(d)?[c]:(g=f>1?a(c,d,e,f):[c],g=b(g,d,e,f))}var h=document.createElement("canvas").getContext("2d"),i="";return{lineWrap:a,wordWrap:b,splitWord:f,wrap:g,truncate:c}}),define("objects.views/charts/shapes/text",["objects.views/charts/shapes/display-object","objects.views/charts/shapes/text-helper"],function(a,b){function c(a){return 1.5*a.measureText("m").width}function d(a){f.font=this.font;var d,e=c(f),g=(this.lineHeightMultiplicator||1)*e,h="maxWidth"in this?this.maxWidth:this.width,i="maxHeight"in this?this.maxHeight:this.height,j=this.maxNumLines,k=[],l=0,m=[];return this.lineHeight=g,e>i?[]:(d=i?Math.max(1,Math.floor(i/g)):1,Array.isArray(j)?(j.forEach(function(a){l+=isNaN(a)||0>=a?0:a}),j.forEach(function(a){k.push(isNaN(a)||0>=a?d-l:a)})):k=[isNaN(j)||0>=j?d:Math.min(d,j)],Array.isArray(a)?a.forEach(function(a,c){m.length<d&&(m=m.concat(b.wrap(a,h,this.font,k[c])))},this):(isNaN(j)&&(j=i?Math.max(1,Math.floor(i/g)):1),m=b.wrap(a,h,this.font,k[0])),m)}var e,f=document.createElement("canvas").getContext("2d");return e=a.extend("Text",{init:function(){this._super(),this.options={},this.x=0,this.y=0,this.lineHeightMultiplicator=1},setText:function(a){return this.text=a,this.invalidateBounds(),this},tokenize:function(){return this.lines=d.apply(this,[this.text]),this},measure:function(){this.preRender();var a,b=0,c=this.lines;for(f.font=this.font,a=0;a<c.length;a++)b=Math.max(b,f.measureText(c[a]).width);return{numLines:c.length,width:b,height:c.length*this.lineHeight}},getHorizontalAnchor:function(){var a,b=this.x||0;if(this.width>0){if(a=this.attr("align"),"center"===a)return b+this.width/2;if("right"===a)return b+this.width}return b},getVerticalAnchor:function(){var a,b=this.y||0,c=this.attr("baseline");return"middle"===c?(a=this.attr("lineHeight"),b-=(this.lines.length-1)*a/2,this.height>0&&(b+=this.height/2)):"bottom"===c&&(a=this.attr("lineHeight"),b-=(this.lines.length-1)*a,this.height>0&&(b+=this.height)),b},preRender:function(){var a,b="";Array.isArray(this.text)?this.text.forEach(function(a){b+=a+"__"}):b=this.text,a=this.attr("font"),this.font=a;var c=b+a+this.maxWidth;return c!==this._renderedID&&(this.tokenize(),this.invalidateBounds(),this._renderedID=c),this},getLocalBoundingRect:function(){var a=this.measure(),b=this.getHorizontalAnchor(),c=this.getVerticalAnchor(),d=this.attr("align")||"left",e=this.attr("baseline")||"top";return"middle"===e?c-=a.height/2:"bottom"===e&&(c-=a.height),"center"===d?b-=a.width/2:"right"===d&&(b-=a.width),{x:b,y:c,width:a.width,height:a.height}}})}),define("objects.views/charts/renderers/canvas/text",["objects.views/charts/shapes/text"],function(a){return{displayObject:a,render:function(a,b,c){var d,e=this.x||0,f=this.y||0,g=this.lines||[],h=g.length,i=[],j=this.lineHeight;if(e=this.getHorizontalAnchor(),f=this.getVerticalAnchor(),b&&i.push("fillText"),c&&(this.strokeFirst?i.unshift("strokeText"):i.push("strokeText")),i.length)for(d=0;h>d;d++)a[i[0]](g[d],e,f),i[1]&&a[i[1]](g[d],e,f),f+=j}}}),define("objects.views/charts/renderers/canvas-renderer",["jquery","objects.views/charts/renderers/renderer","objects.views/charts/utils/matrix","objects.utils/animation-frame","objects.utils/shapes/rect","objects.views/charts/renderers/canvas/rect","objects.views/charts/renderers/canvas/circle","objects.views/charts/renderers/canvas/line","objects.views/charts/renderers/canvas/polygon","objects.views/charts/renderers/canvas/arc","objects.views/charts/renderers/canvas/text"],function(a,b,c,d,e){function f(a,b){s.length>100&&delete r[s.shift()],s.push(a),r[a]=b}var g,h=1,i=[].slice.call(arguments,5),j={},k=i.length,l=document.createElement("canvas"),m=l.getContext("2d"),n=["fill","stroke","strokeWidth","opacity","font","align","baseline","lineJoin","lineCap"],o=new RegExp(n.join("|")),p=n.length,q={fill:"fillStyle",stroke:"strokeStyle",strokeWidth:"lineWidth",opacity:"globalAlpha",align:"textAlign",baseline:"textBaseline"},r={},s=[];return g=b.extend("CanvasRenderer",{init:function(b,d){this._super(),this._canvas=document.createElement("canvas"),this._canvas.width=this._size.width,this._canvas.height=this._size.height,this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0",this._bufferCanvas=document.createElement("canvas"),this._bufferCanvas.width=this._canvas.width,this._bufferCanvas.height=this._canvas.height,this._mvMatrix=new c,this._wrapper=document.createElement("div"),this._wrapper.style.position="relative",this._wrapper.style.left="0",this._wrapper.style.top="0",this._wrapper.appendChild(this._canvas),d&&d.name&&a(this._wrapper).attr({tid:d.name}),a(this._wrapper).attr({tcl:"renderer"}).data("_renderer",this),this.container=b,this.container.appendChild(this._wrapper),this._isCompositingEnabled=!0,this._invalidObjects=[],this._t={x:0,y:0,dx:0,dy:0}},setDimensions:function(a,b,c,d){this._super(a,b,c,d),this._wrapper.style.left=a+"px",this._wrapper.style.top=b+"px"},render:function(a){this._rendering||(this._resetImage(),a?this._invalidate(!0,!1):this._render())},clear:function(a){this._rendering||(a?this._invalidate(!1,!0):this._clear())},release:function(){this._super(),this._clearSchedule(),a(this._wrapper).removeData(),this._bufferCanvas=null,this._canvas=null,this.container&&(this.container.removeChild(this._wrapper),this.container=null)},invalidateObject:function(a){this._isCompositingEnabled&&this._invalidObjects.indexOf(a)<0&&this._invalidObjects.push(a),this.render(!0)},translateScene:function(a,b){return this._t.dx+=a,this._t.dy+=b,this._t.x+=a,this._t.y+=b,this._invalidate(!0,!1),this},getTextWidth:function(a,b){return g.getTextWidth(a,b,this._canvas.getContext("2d"))},getFontHeight:function(a){return g.getFontHeight(a,this._canvas.getContext("2d"))},_render:function(){if(this._clearSchedule(),this._canvas){this._rendering=!0;var a,b=this._canvas,c=b.getContext("2d"),d=this._mvMatrix,e=[],f=this._isCompositingEnabled&&(0!==this._t.dx||0!==this._t.dy),h=g.getDevicePixelToBackingStoreRatio();f&&this._storeImage(),this._updateSize()||(this._isCompositingEnabled&&(e=this._getInvalidViews().filter(function(a){return!a.hasNaN()}),e.length&&f?e=[]:f&&(c.clearRect(0,0,b.width,b.height),e=e.concat(this._getInvalidImageParts()).filter(function(a){return!a.hasNaN()}))),e.length||c.clearRect(0,0,b.width,b.height)),c.save(),d.save(),d.scale(h*this.scaling.x,h*this.scaling.y),d.translate(-this._extendedSize.x,-this._extendedSize.y),this.stage.matrix&&this.stage.matrix.identity(),this.stage.translate(this._t.x,this._t.y),a=d.elements,c.setTransform(a[0][0],a[1][0],a[0][1],a[1][1],a[0][2],a[1][2]),e.length&&(f&&(this._patchImage(),this._t.dx=0,this._t.dy=0),c.beginPath(),e.forEach(function(a){c.rect(a.x,a.y,a.width,a.height)}),c.clip(),c.clearRect(0,0,b.width,b.height)),e.length||e.push(this._extendedSize),g._updateTransforms([this.stage],d,{}),g._renderDisplayObjects(c,[this.stage],e),d.restore(),c.restore(),this._invalidObjects=[],this._rendering=!1}},_updateSize:function(){var a,b,c,d=this._canvas,f=g.getDevicePixelToBackingStoreRatio(),h=this._extendedSize;return this.edgeBleed?h.set(-this.edgeBleed.left,-this.edgeBleed.top,this._size.width+this.edgeBleed.left+this.edgeBleed.right,this._size.height+this.edgeBleed.top+this.edgeBleed.bottom):h.set(this._size.x,this._size.y,this._size.width,this._size.height),c=new e(Math.round(h.x*this.scaling.x),Math.round(h.y*this.scaling.y),Math.round(h.width*this.scaling.x),Math.round(h.height*this.scaling.y)),a=Math.round(f*c.width),b=Math.round(f*c.height),this._canvas.style.left=c.x+"px",this._canvas.style.top=c.y+"px",d.width!==a||d.height!==b?(d.width=a,d.height=b,d.style.width=c.width+"px",d.style.height=c.height+"px",this._bufferCanvas.width=a,this._bufferCanvas.height=b,!0):!1
},_invalidate:function(a,b){if(this._doRender=a||this._doRender,this._doClear=b||this._doClear,!this._invalidated){var c=this;this._invalidated=!0,this._timer=d.request(function(){c._validate()},this._canvas)}},_validate:function(){this._doClear&&!this._doRender?this._clear():this._doRender?this._render():this._clearSchedule()},_clear:function(){this._clearSchedule(),this._canvas.width=this._canvas.width},_clearSchedule:function(){this._timer&&(d.cancel(this._timer),this._timer=null),this._doRender=!1,this._doClear=!1,this._invalidated=!1},_getInvalidViews_:function(){var a,b,c,d,f,g,h,i,j,k,l,m=this._invalidObjects?this._invalidObjects.length:0,n=new e,o=new e;for(m&&(b=this._invalidObjects[0].getVisualBounds(),c=this._invalidObjects[0].rData.oldVisualBounds,d=b.x,g=b.x+b.width,f=b.y,h=b.y+b.height,i=c.x,k=c.x+c.width,j=c.y,l=c.y+c.height),a=1;m>a;a++)b=this._invalidObjects[a].getVisualBounds(),c=this._invalidObjects[a].rData.oldVisualBounds,d=Math.min(d,b.x),g=Math.max(g,b.x+b.width),f=Math.min(f,b.y),h=Math.max(h,b.y+b.height),c&&(i=Math.min(i,c.x),k=Math.max(k,c.x+c.width),j=Math.min(j,c.y),l=Math.max(l,c.y+c.height));return n.set(Math.floor(d)-1,Math.floor(f)-1,Math.ceil(g-d)+2,Math.ceil(h-f)+2),o.set(Math.floor(i)-1,Math.floor(j)-1,Math.ceil(k-i)+2,Math.ceil(l-j)+2),n.x!==o.x||n.y!==o.y||n.width!==o.width||n.height!==o.height?[n,o]:[n]},_getInvalidViews:function(){var a,b,c,d,f,g,h,i,j,k,l,m=this._invalidObjects?this._invalidObjects.length:0,n=new e,o=!1,p=!1,q=new e;for(a=0;m>a;a++)b=this._invalidObjects[a].getVisualBounds(),c=this._invalidObjects[a].rData.oldVisualBounds,!o&&b?(d=b.x,g=b.x+b.width,f=b.y,h=b.y+b.height,o=!0):b&&(d=Math.min(d,b.x),g=Math.max(g,b.x+b.width),f=Math.min(f,b.y),h=Math.max(h,b.y+b.height)),!p&&c?(i=c.x,k=c.x+c.width,j=c.y,l=c.y+c.height,p=!0):c&&(i=Math.min(i,c.x),k=Math.max(k,c.x+c.width),j=Math.min(j,c.y),l=Math.max(l,c.y+c.height));return n.set(Math.floor(d)-1,Math.floor(f)-1,Math.ceil(g-d)+2,Math.ceil(h-f)+2),q.set(Math.floor(i)-1,Math.floor(j)-1,Math.ceil(k-i)+2,Math.ceil(l-j)+2),n.x!==q.x||n.y!==q.y||n.width!==q.width||n.height!==q.height?[n,q]:[n]},_getInvalidImageParts:function(){var a=[];return 0!==this._t.dx&&this._size.width>Math.abs(this._t.dx)&&a.push(new e(this._t.dx>0?0:this._size.width+this._t.dx,0,Math.abs(this._t.dx),this._size.height)),0!==this._t.dy&&this._size.height>Math.abs(this._t.dy)&&a.push(new e(0,this._t.dy>0?0:this._size.height+this._t.dy,this._size.width,Math.abs(this._t.dy))),a},_storeImage:function(){var a=this._bufferCanvas.getContext("2d");a.clearRect(0,0,this._bufferCanvas.width,this._bufferCanvas.height),a.drawImage(this._canvas,0,0)},_patchImage:function(){var a=this._t.dx,b=this._t.dy;this._canvas.getContext("2d").drawImage(this._bufferCanvas,a,b)},_resetImage:function(){this._t.dx=0,this._t.dy=0,this._t.x=0,this._t.y=0}}),g.getFontHeightOfContext=function(a){return 1.5*a.measureText("m").width},g.getFontHeight=function(a,b){if("string"!=typeof a)throw new Error("CanvasRenderer.getFontHeight(): Input font is not a string");if(a in r)return r[a];var c;return b=b||m,b.font!==a?(b.save(),b.font=a,c=1.5*b.measureText("m").width,b.restore()):c=1.5*b.measureText("m").width,f(a,c),c},g.getTextWidth=function(a,b,c){var d;return c=c||m,c.save(),c.font=b,d=void 0!==a?Math.ceil(c.measureText(a).width):0,c.restore(),d},g.getDevicePixelToBackingStoreRatio=function(){return(window.devicePixelRatio||1)/(m.webkitBackingStorePixelRatio||m.mozBackingStorePixelRatio||m.msBackingStorePixelRatio||m.oBackingStorePixelRatio||m.backingStorePixelRatio||1)},g._renderDisplayObjects=function(a,b,c){var d,e,f,h,i,j,k=c?c.length:0,l=[],m=!0,n=[];for(e=b?b.length:0,d=0;e>d;d++)if(f=b[d],f.visible!==!1&&f.data.isVisible!==!1){if(k){for(m=!1,i=0;k>i;i++)if(c[i].intersectsWith(f.getVisualBounds())){m=!0;break}if(!m)continue}h=g._getRenderFn(b[d]),j=f.children.length>0,("function"==typeof h||j)&&(f.zIndex>0?(l[f.zIndex]||(l[f.zIndex]={index:f.zIndex,objects:[]}),l[f.zIndex].objects.push({object:f,renderFn:h,hasChildren:j})):g._renderObject(a,f,h,j,c))}for(l=l.filter(function(a){return a&&a.objects.length}).sort(function(a,b){return a.index-b.index}),d=0;d<l.length;d++)for(n=l[d].objects,e=n.length,i=0;e>i;i++)g._renderObject(a,n[i].object,n[i].renderFn,n[i].hasChildren,c)},g._renderObject=function(a,b,c,d,e){var f,h,i,j,k;"function"==typeof c&&(h=b.attr("strokeWidth"),"undefined"==typeof h&&(h=1),i=!!b.attr("fill"),j=!!b.attr("stroke")&&h>0),k=b.getVisualBounds(),a.save(),b.rData.stroke=j,b.rData.strokeWidth=h,b.rData.oldVisualBounds={x:k.x,y:k.y,width:k.width,height:k.height},g._applyAttributes(a,b),b.rData.vmTransform&&(f=b.rData.vmTransform,a.setTransform(f[0][0],f[1][0],f[0][1],f[1][1],f[0][2],f[1][2])),b.clip&&(a.beginPath(),a.rect(b.clip.x,b.clip.y,b.clip.width,b.clip.height),a.clip()),(i||j)&&(b.preRender&&b.preRender(),c.apply(b,[a,i,j])),d&&g._renderDisplayObjects(a,b.children,e),a.restore()},g._registerRenderFn=function(a,b){var c;if("function"!=typeof a)throw new TypeError("First parameter must be a function");c="function"!=typeof b&&"function"==typeof b.constructor?b.constructor:b,c.__renderFnId="_"+h++,j[c.__renderFnId]=a},g._getRenderFn=function(a){var b=a.__renderFnId||(a.constructor?a.constructor.__renderFnId:void 0);if(b)return j[b];for(var c=0;k>c;c++)if(i[c].displayObject===a.constructor)return g._registerRenderFn(i[c].render,a),i[c].render;for(c=0;k>c;c++)if(a instanceof i[c].displayObject)return g._registerRenderFn(i[c].render,a),i[c].render;a.constructor.__renderFnId="does not exist"},g._updateTransforms=function(a,b,c){var d,e,f,h,i,j={},k=a?a.length:0;for(i in c)o.test(i)&&(j[i]=c[i]);for(d=0;k>d;d++){e=a[d],e.clearModelView(),e.matrix&&(b.save(),b.multiply(e.matrix),e.rData.vmTransform=b.elements,e.rData.dirtyVMTransform=!0),e.rData.inherited={};for(i in j)e.rData.inherited[i]=j[i];if(h=e.children,h&&h.length){for(f=0;p>f;f++)e.hasOwnProperty(n[f])&&(j[i]=e[i]);g._updateTransforms(h,b,j)}e.matrix&&b.restore()}},g._applyAttributes=function(a,b){var c,d;for(d=0;p>d;d++)c=n[d],c in b&&(("fill"===c||"stroke"===c)&&b[c]&&b[c].gradient?a[q[c]]=g._createLinearGradient(a,b[c].gradient)||"#000000":a[q[c]||c]=b[c])},g._createLinearGradient=function(a,b){var c,d,e;if(!(isNaN(b.x0)||isNaN(b.y0)||isNaN(b.x1)||isNaN(b.y1))){for(c=a.createLinearGradient(b.x0,b.y0,b.x1,b.y1),e=b.limits.length,d=0;e>d;d++)c.addColorStop(b.limits[d],b.colors[d]);return c}},g.registerRenderObject=function(a){i.push(a),k=i.length},g}),define("extensions.qliktech/barchart/layers/bar-helpers",["objects.views/charts/shapes/rect"],function(a){function b(a,b,c,d,e,f,g){var h,i;return f?(h=b,i=c,c=e,b=d,e=h,d=i,b>c&&(h=c,c=b,b=h),b=Math.max(g.x,Math.min(g.x+g.width,b)),c=Math.max(g.x,Math.min(g.x+g.width,c))):(e>d&&(h=e,e=d,d=h),d=Math.max(g.y,Math.min(g.y+g.height,d)),e=Math.max(g.y,Math.min(g.y+g.height,e))),a.set(b,e,c-b,d-e),a}function c(a,b,c,d){var e=[{x:a.x,y:a.y},{x:a.x,y:a.y+a.height},{x:a.x+a.width,y:a.y+a.height},{x:a.x+a.width,y:a.y}];switch(b){case"left":d?e[0].x-=c:e[1].x+=c;break;case"right":d?e[2].x+=c:e[3].x-=c;break;case"top":d?e[3].y-=c:e[0].y+=c;break;case"bottom":d?e[1].y+=c:e[2].y-=c}return e}function d(b,d,e){var f,g=e.pad,h=e.gap,i=e.sharpness,j=b.clone(),k=c,l=[];return"right"===d?(f=new a(j.x+j.width+h,j.y,g-h,j.height),l.push(k(j,"right",i,!0)),l.push(k(f,"left",i,!1,!0)),b.width+=f.width+h):"left"===d?(f=new a(0,j.y,g-h,j.height),l.push(k(j,"left",i,!0)),l.push(k(f,"right",i,!1,!0)),b.x=f.x,b.width+=f.width+h):"down"===d?(f=new a(j.x,j.y+j.height+h,j.width,g-h),l.push(k(j,"bottom",i,!0)),l.push(k(f,"top",i,!1,!0)),b.height+=f.height+h):"up"===d&&(f=new a(j.x,0,j.width,g-h),l.push(k(j,"top",i,!0)),l.push(k(f,"bottom",i,!1,!0)),b.y=f.y,b.height+=f.height+h),l}function e(a,b,c){a.set(d(a.data.hitRect,b,c))}function f(a,b,c){a.set(h(a.data.hitRect,b,c))}function g(a,b,c,d,e){var f=[];return"left"===e?(f.push({x:a,y:b+c/2}),f.push({x:a,y:b-c/2}),f.push({x:a-d,y:b})):"right"===e?(f.push({x:a,y:b+c/2}),f.push({x:a,y:b-c/2}),f.push({x:a+d,y:b})):"up"===e?(f.push({x:a-c/2,y:b}),f.push({x:a+c/2,y:b}),f.push({x:a,y:b-d})):"down"===e&&(f.push({x:a-c/2,y:b}),f.push({x:a+c/2,y:b}),f.push({x:a,y:b+d})),f}function h(a,b,c){var d,e,f;return f=Math.min(a[["left","right"].contains(b)?"height":"width"]/2,8),e=Math.min(f,8),"left"===b?(d=g(c.x+e,a.y+a.height/2,f,e,b),a.width+=e):"right"===b?(d=g(c.x+c.width-e-1,a.y+a.height/2,f,e,b),a.width+=e,a.x-=e):"up"===b?(d=g(a.x+a.width/2,c.y+e,f,e,b),a.height+=e):"down"===b&&(d=g(a.x+a.width/2,c.y+c.height-e-1,f,e,b),a.height+=e,a.y-=e),d}return{updateRectangle:b,getSpike:d,getSlicedPolygon:c,getHint:h,updateSpike:e,updateHint:f}}),define("extensions.qliktech/barchart/layers/bar-layer",["core.utils/class","objects.utils/shapes/rect","objects.views/charts/shapes/polygon","objects.views/charts/renderers/canvas-renderer","general.utils/property-resolver","extensions.qliktech/barchart/layers/bar-helpers"],function(a,b,c,d,e,f){function g(){var a,d,e,g,h,i,j,k,l,m,n,o,p=this.style.shape,q=new b(0,0,0,0),r=this.widthRatio,s=this.isSpikingEnabled,t=this.isHintingEnabled,u=[],v=this.majorAxis.isDiscrete(),w=this.majorAxis.getDiscreteSpacing()*r,x=this.minorAxis.getPlotMax(),y=this.minorAxis.getPlotMin(),z=!this.majorAxis.isVertical(),A=this.minorAxis.getPadding(),B=this.minorAxis.getPositionOfValue(0)-1,C={pad:z?A.top:A.right},D={pad:z?A.bottom:A.left},E=new b;C.gap=.3*C.pad,C.sharpness=.3*C.pad,D.gap=.3*D.pad,D.sharpness=.3*D.pad,E.set(A.left,A.top,this.rect.width-A.left-A.right,this.rect.height-A.top-A.bottom),this._bounds=E;var F=0,G=z?this.rect.width:this.rect.height,H=-1,I=z?this.rect.height:this.rect.width;for(k=this.shapes?this.shapes.length:0,l=0;k>l;l++)if(i=this.shapes[l],o=i instanceof c||"Polygon"===i.type,j=this.majorAxis.getPositionOfId(i.data.axisId),h=v?w:this.majorAxis.getWidthOfId(i.data.axisId)*r,i.data.isNaN||isNaN(i.data.value)?(i.data.isNaN=!0,e=g=B):(e=this.minorAxis.getPositionOfValue(i.data.start)-1,g=this.minorAxis.getPositionOfValue(i.data.end)-1),a=j-h/2,d=j+h/2,f.updateRectangle(i.data.hitRect,a,d,e,g,!z,E),delete i.data.labelRect,delete i.data.isCutOff,delete i.data.hintDirection,F>d||a>G)i.data.isVisible=!1;else{i.data.isVisible=!0,o?i.set(i.data.hitRect.getPoints()):i.set(i.data.hitRect.x,i.data.hitRect.y,i.data.hitRect.width,i.data.hitRect.height),q.set(i.data.hitRect.x,i.data.hitRect.y,i.data.hitRect.width,i.data.hitRect.height),u.push(i),m=i.data.cacheItem;var J=m.selected;if(i.data.isFakeOtherCell&&i.data.highlightOnGroupSelect&&m.children[0].selected){J=!0;for(var K=0;K<m.children.length;K++)if(!m.children[K].selected){J=!1;break}}n=J?p.selected:{border:{color:0,width:0}},i.stroke=n.border.color,i.fill=i.data.isFakeOtherCell?this.othersFillPattern:i.data.fill,i.strokeWidth=n.border.width,i.opacity=J?1:this._globalAlpha;var L=t?this._getHint(e,g,E,z):!1,M=o&&!L&&s?this._getSpike(i.data.end,e,g,E,z,y,x):!1;M?(i.data.labelRect=q.clone(),f.updateSpike(i,z?i.data.end>=0?"up":"down":i.data.end>=0?"right":"left",i.data.end>=0?C:D),i.data.isCutOff=!0):L?(i.fill="#999999",f.updateHint(i,L,E),i.data.hintDirection=L):(H>e&&H>g||e>I&&g>I)&&(i.data.isVisible=!1)}this.nodesInView=u}var h;return h=a.extend("BarLayer",{init:function(a){this.renderer=new d(a,{name:"bar-layer"}),this.widthRatio=.7,this.isSpikingEnabled=!1,this.isHintingEnabled=!1,this.shapes=[],this._globalAlpha=1},release:function(){this.renderer.release(),this.shapes=null,this.minorAxis=null,this.majorAxis=null},update:function(){g.call(this)},render:function(){this.renderer.render()},_getStyle:function(a){return{selected:{border:{color:e.getValue(a,"shape.selected.border.color","rgba(0,0,0,0.25)"),width:e.getValue(a,"shape.selected.border.width",1)}}}},_getHint:function(a,b,c,d){if(d){if(b+1<c.y&&a+1<=c.y)return"up";if(b+1>c.y+c.height&&a+1>=c.y+c.height)return"down"}else{if(b+1<c.x&&a+1<=c.x)return"left";if(b+1>c.x+c.width&&a+1>=c.x+c.width)return"right"}return!1},_getSpike:function(a,b,c,d,e,f,g){var h=a>g,i=f>a;return e?(h=h&&c<d.y&&b>d.y,i=i&&c>d.y+d.height&&b<d.y+d.height):(h=h&&c>d.x+d.width&&b<d.x+d.width,i=i&&c<d.x&&b>d.x),h||i}})}),define("general.utils/css-colors",[],function(){var a={aliceblue:{r:240,g:248,b:255},antiquewhite:{r:250,g:235,b:215},aqua:{r:0,g:255,b:255},aquamarine:{r:127,g:255,b:212},azure:{r:240,g:255,b:255},beige:{r:245,g:245,b:220},bisque:{r:255,g:228,b:196},black:{r:0,g:0,b:0},blanchedalmond:{r:255,g:235,b:205},blue:{r:0,g:0,b:255},blueviolet:{r:138,g:43,b:226},brown:{r:165,g:42,b:42},burlywood:{r:222,g:184,b:135},cadetblue:{r:95,g:158,b:160},chartreuse:{r:127,g:255,b:0},chocolate:{r:210,g:105,b:30},coral:{r:255,g:127,b:80},cornflowerblue:{r:100,g:149,b:237},cornsilk:{r:255,g:248,b:220},crimson:{r:220,g:20,b:60},cyan:{r:0,g:255,b:255},darkblue:{r:0,g:0,b:139},darkcyan:{r:0,g:139,b:139},darkgoldenrod:{r:184,g:134,b:11},darkgray:{r:169,g:169,b:169},darkgreen:{r:0,g:100,b:0},darkgrey:{r:169,g:169,b:169},darkkhaki:{r:189,g:183,b:107},darkmagenta:{r:139,g:0,b:139},darkolivegreen:{r:85,g:107,b:47},darkorange:{r:255,g:140,b:0},darkorchid:{r:153,g:50,b:204},darkred:{r:139,g:0,b:0},darksalmon:{r:233,g:150,b:122},darkseagreen:{r:143,g:188,b:143},darkslateblue:{r:72,g:61,b:139},darkslategray:{r:47,g:79,b:79},darkslategrey:{r:47,g:79,b:79},darkturquoise:{r:0,g:206,b:209},darkviolet:{r:148,g:0,b:211},deeppink:{r:255,g:20,b:147},deepskyblue:{r:0,g:191,b:255},dimgray:{r:105,g:105,b:105},dimgrey:{r:105,g:105,b:105},dodgerblue:{r:30,g:144,b:255},firebrick:{r:178,g:34,b:34},floralwhite:{r:255,g:250,b:240},forestgreen:{r:34,g:139,b:34},fuchsia:{r:255,g:0,b:255},gainsboro:{r:220,g:220,b:220},ghostwhite:{r:248,g:248,b:255},gold:{r:255,g:215,b:0},goldenrod:{r:218,g:165,b:32},gray:{r:128,g:128,b:128},green:{r:0,g:128,b:0},greenyellow:{r:173,g:255,b:47},grey:{r:128,g:128,b:128},honeydew:{r:240,g:255,b:240},hotpink:{r:255,g:105,b:180},indianred:{r:205,g:92,b:92},indigo:{r:75,g:0,b:130},ivory:{r:255,g:255,b:240},khaki:{r:240,g:230,b:140},lavender:{r:230,g:230,b:250},lavenderblush:{r:255,g:240,b:245},lawngreen:{r:124,g:252,b:0},lemonchiffon:{r:255,g:250,b:205},lightblue:{r:173,g:216,b:230},lightcoral:{r:240,g:128,b:128},lightcyan:{r:224,g:255,b:255},lightgoldenrodyellow:{r:250,g:250,b:210},lightgray:{r:211,g:211,b:211},lightgreen:{r:144,g:238,b:144},lightgrey:{r:211,g:211,b:211},lightpink:{r:255,g:182,b:193},lightsalmon:{r:255,g:160,b:122},lightseagreen:{r:32,g:178,b:170},lightskyblue:{r:135,g:206,b:250},lightslategray:{r:119,g:136,b:153},lightslategrey:{r:119,g:136,b:153},lightsteelblue:{r:176,g:196,b:222},lightyellow:{r:255,g:255,b:224},lime:{r:0,g:255,b:0},limegreen:{r:50,g:205,b:50},linen:{r:250,g:240,b:230},magenta:{r:255,g:0,b:255},maroon:{r:128,g:0,b:0},mediumaquamarine:{r:102,g:205,b:170},mediumblue:{r:0,g:0,b:205},mediumorchid:{r:186,g:85,b:211},mediumpurple:{r:147,g:112,b:219},mediumseagreen:{r:60,g:179,b:113},mediumslateblue:{r:123,g:104,b:238},mediumspringgreen:{r:0,g:250,b:154},mediumturquoise:{r:72,g:209,b:204},mediumvioletred:{r:199,g:21,b:133},midnightblue:{r:25,g:25,b:112},mintcream:{r:245,g:255,b:250},mistyrose:{r:255,g:228,b:225},moccasin:{r:255,g:228,b:181},navajowhite:{r:255,g:222,b:173},navy:{r:0,g:0,b:128},oldlace:{r:253,g:245,b:230},olive:{r:128,g:128,b:0},olivedrab:{r:107,g:142,b:35},orange:{r:255,g:165,b:0},orangered:{r:255,g:69,b:0},orchid:{r:218,g:112,b:214},palegoldenrod:{r:238,g:232,b:170},palegreen:{r:152,g:251,b:152},paleturquoise:{r:175,g:238,b:238},palevioletred:{r:219,g:112,b:147},papayawhip:{r:255,g:239,b:213},peachpuff:{r:255,g:218,b:185},peru:{r:205,g:133,b:63},pink:{r:255,g:192,b:203},plum:{r:221,g:160,b:221},powderblue:{r:176,g:224,b:230},purple:{r:128,g:0,b:128},red:{r:255,g:0,b:0},rosybrown:{r:188,g:143,b:143},royalblue:{r:65,g:105,b:225},saddlebrown:{r:139,g:69,b:19},salmon:{r:250,g:128,b:114},sandybrown:{r:244,g:164,b:96},seagreen:{r:46,g:139,b:87},seashell:{r:255,g:245,b:238},sienna:{r:160,g:82,b:45},silver:{r:192,g:192,b:192},skyblue:{r:135,g:206,b:235},slateblue:{r:106,g:90,b:205},slategray:{r:112,g:128,b:144},slategrey:{r:112,g:128,b:144},snow:{r:255,g:250,b:250},springgreen:{r:0,g:255,b:127},steelblue:{r:70,g:130,b:180},tan:{r:210,g:180,b:140},teal:{r:0,g:128,b:128},thistle:{r:216,g:191,b:216},tomato:{r:255,g:99,b:71},turquoise:{r:64,g:224,b:208},violet:{r:238,g:130,b:238},wheat:{r:245,g:222,b:179},white:{r:255,g:255,b:255},whitesmoke:{r:245,g:245,b:245},yellow:{r:255,g:255,b:0},yellowgreen:{r:154,g:205,b:50}};return a}),define("general.utils/color",["core.utils/class","./css-colors"],function(a,b){var c,d=/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/i,e=/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d+)?)\)$/i,f=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i,g=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i,h=/^hsl\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*\)$/i,i=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i,j=Math.floor,k=Math.round;return c=a.extend({init:function(){var a,d,e,f,g,h,i,l,m,n,o,p=0,q=0,r=0,s=1;if(arguments[0]instanceof c)p=arguments[0]._r,q=arguments[0]._g,r=arguments[0]._b,s=arguments[0]._a;else if(arguments.length<3)if("string"==typeof arguments[0])if(o=arguments[0],n=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i.exec(o))p=parseInt(n[1],10),q=parseInt(n[2],10),r=parseInt(n[3],10);else if(n=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d(\.\d+)?)\s*\)$/i.exec(o))p=parseInt(n[1],10),q=parseInt(n[2],10),r=parseInt(n[3],10),s=parseFloat(n[4]);else if(n=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i.exec(o))p=parseInt(n[1],16),q=parseInt(n[2],16),r=parseInt(n[3],16),s=1;else if(n=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i.exec(o))p=parseInt(n[1]+n[1],16),q=parseInt(n[2]+n[2],16),r=parseInt(n[3]+n[3],16),s=1;else if(n=/^hsl\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*\)$/i.exec(o)){switch(a=parseFloat(n[1]),d=parseFloat(n[3]),f=parseFloat(n[5]),a%=360,d/=100,f/=100,a=0>a?0:a>360?360:a,d=0>d?0:d>1?1:d,f=0>f?0:f>1?1:f,g=.5>=f?2*f*d:(2-2*f)*d,h=a/60,i=g*(1-Math.abs(h%2-1)),l=[],h=Math.floor(h)){case 0:l=[g,i,0];break;case 1:l=[i,g,0];break;case 2:l=[0,g,i];break;case 3:l=[0,i,g];break;case 4:l=[i,0,g];break;case 5:l=[g,0,i];break;default:l=[0,0,0]}m=f-.5*g,p=l[0]+m,q=l[1]+m,r=l[2]+m,p=k(255*p),q=k(255*q),r=k(255*r),s=1}else if(n=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i.exec(o)){switch(a=parseFloat(n[1]),d=parseFloat(n[3]),f=parseFloat(n[5]),s=parseFloat(n[7]),a%=360,d/=100,f/=100,a=0>a?0:a>360?360:a,d=0>d?0:d>1?1:d,f=0>f?0:f>1?1:f,g=.5>=f?2*f*d:(2-2*f)*d,h=a/60,i=g*(1-Math.abs(h%2-1)),l=[],h=Math.floor(h)){case 0:l=[g,i,0];break;case 1:l=[i,g,0];break;case 2:l=[0,g,i];break;case 3:l=[0,i,g];break;case 4:l=[i,0,g];break;case 5:l=[g,0,i];break;default:l=[0,0,0]}m=f-.5*g,p=l[0]+m,q=l[1]+m,r=l[2]+m,p=k(255*p),q=k(255*q),r=k(255*r)}else b[o.toLowerCase()]?(e=o.toLowerCase(),p=b[e].r,q=b[e].g,r=b[e].b,s=1):this._invalid=!0;else"number"==typeof arguments[0]&&arguments[0]>=0&&"argb"===arguments[1]?(s=(4278190080&arguments[0])>>>24,s/=255,p=(16711680&arguments[0])>>16,q=(65280&arguments[0])>>8,r=255&arguments[0]):"number"==typeof arguments[0]&&arguments[0]>=0?(p=(16711680&arguments[0])>>16,q=(65280&arguments[0])>>8,r=255&arguments[0]):this._invalid=!0;else arguments.length>=3?(p=arguments[0],q=arguments[1],r=arguments[2],s=arguments.length>=4?arguments[3]:1):this._invalid=!0;this._r=j(p),this._g=j(q),this._b=j(r),this._a=s,this._spaces={}},isInvalid:function(){return this._invalid},setAlpha:function(a){this._a=a,this._spaces={}},toRGB:function(){return this._spaces.rgb||(this._spaces.rgb=c.toRGB(this)),this._spaces.rgb},toRGBA:function(){return this._spaces.rgba||(this._spaces.rgba=c.toRGBA(this)),this._spaces.rgba},toString:function(){return this._spaces.rgb||(this._spaces.rgb=c.toRGB(this)),this._spaces.rgb},toHex:function(){return this._spaces.hex||(this._spaces.hex=c.toHex(this)),this._spaces.hex},toHSL:function(a){return this._spaces.hsl||(this._spaces.hsl=c.toHSL(this,a)),this._spaces.hsl},toHSLA:function(a){return this._spaces.hsla||(this._spaces.hsla=c.toHSLA(this,a)),this._spaces.hsla},toNumber:function(){return this._spaces.num||(this._spaces.num=c.toNumber(this)),this._spaces.num},isDark:function(){return this.getLuminance()<125},getLuminance:function(){return"undefined"==typeof this._lumi&&(this._lumi=.299*this._r+.587*this._g+.114*this._b),this._lumi},shiftLuminance:function(a){var b,c,d,e,f,g=this.toHSLA();return f=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i.exec(g),b=parseFloat(f[1]),c=parseFloat(f[3]),d=parseFloat(f[5]),e=parseFloat(f[7]),d+=a,d=Math.max(0,Math.min(d,100)),"hsla("+b+","+c+","+d+","+e+")"},isEqual:function(a){return a instanceof c?this._r===a._r&&this._g===a._g&&this._b===a._b:(a=new c(a),this._r===a._r&&this._g===a._g&&this._b===a._b)},blend:function(a,b){var c=j(this._r+(a._r-this._r)*b),d=j(this._g+(a._g-this._g)*b),e=j(this._b+(a._b-this._b)*b),f=j(this._a+(a._a-this._a)*b);return"rgba("+[c,d,e,f].join(",")+")"},createShiftedColor:function(a){(void 0===a||isNaN(a))&&(a=1);var b=this.getLuminance(),d=this._g<126?1:1+this._g/512,e=this.shiftLuminance(20*(220>b*d?.8+4*(1/(b+1)):-(.8+1*(b/255)))*a);return new c(e)}}),c.toRGB=function(a){if(a instanceof c)return"rgb("+[a._r,a._g,a._b].join(",")+")";"string"==typeof a&&(a=c.toNumber(a));var b=(16711680&a)>>16,d=(65280&a)>>8,e=255&a;return"rgb("+b+","+d+","+e+")"},c.toRGBA=function(a,b){if(a instanceof c)return"rgba("+[a._r,a._g,a._b,"undefined"!=typeof b?b:a._a].join(",")+")";"string"==typeof a&&(a=c.toNumber(a));var d=(16711680&a)>>16,e=(65280&a)>>8,f=255&a;return"rgba("+d+","+e+","+f+","+("undefined"!=typeof b?b:a._a)+")"},c.toHex=function(a){var b,d,e;return a instanceof c?(b=a._r.toString(16),d=a._g.toString(16),e=a._b.toString(16),1===b.length&&(b="0"+b),1===d.length&&(d="0"+d),1===e.length&&(e="0"+e),"#"+[b,d,e].join("")):("string"==typeof a&&(a=c.toNumber(a)),b=((16711680&a)>>16).toString(16),d=((65280&a)>>8).toString(16),e=(255&a).toString(16),1===b.length&&(b="0"+b),1===d.length&&(d="0"+d),1===e.length&&(e="0"+e),"#"+b+d+e)},c.toHSL=function(a,b){var d,e,f,g,h,i,j,k,l=0;if("string"==typeof a&&(a=new c(a)),d=a._r/255,e=a._g/255,f=a._b/255,i=Math.max(d,e,f),j=Math.min(d,e,f),h=b?.21*d+.72*e+.07*f:(i+j)/2,i===j)l=g=0;else{switch(k=i-j,g=h>.5?k/(2-i-j):k/(i+j),i){case d:l=(e-f)/k+(f>e?6:0);break;case e:l=(f-d)/k+2;break;case f:l=(d-e)/k+4}l/=6}return"hsl("+360*l+","+100*g+","+100*h+")"},c.toHSLA=function(a,b){var d,e,f,g,h,i,j,k,l,m=0;if("string"==typeof a&&(a=new c(a)),d=a._r/255,e=a._g/255,f=a._b/255,g=a._a,j=Math.max(d,e,f),k=Math.min(d,e,f),i=b?.21*d+.72*e+.07*f:(j+k)/2,j===k)m=h=0;else{switch(l=j-k,h=i>.5?l/(2-j-k):l/(j+k),j){case d:m=(e-f)/l+(f>e?6:0);break;case e:m=(f-d)/l+2;break;case f:m=(d-e)/l+4}m/=6}return"hsla("+360*m+","+100*h+","+100*i+","+g+")"},c.toNumber=function(){if(1===arguments.length&&arguments[0]instanceof c)return(arguments[0]._r<<16)+(arguments[0]._g<<8)+arguments[0]._b;var a,b,d=0,e=0,f=0;return 1===arguments.length&&"string"==typeof arguments[0]&&(b=arguments[0],(a=/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/i.exec(b))?(d=parseInt(a[1],10),e=parseInt(a[2],10),f=parseInt(a[3],10)):(a=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i.exec(b))?(d=parseInt(a[1],16),e=parseInt(a[2],16),f=parseInt(a[3],16)):(a=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i.exec(b))&&(d=parseInt(a[1]+a[1],16),e=parseInt(a[2]+a[2],16),f=parseInt(a[3]+a[3],16))),(d<<16)+(e<<8)+f},c.blend=function(a,b,d){a=c.toNumber(a),b=c.toNumber(b);var e=(16711680&a)>>16,f=(65280&a)>>8,g=255&a,h=(16711680&b)>>16,i=(65280&b)>>8,j=255&b,k=e+(h-e)*d,l=f+(i-f)*d,m=g+(j-g)*d;return(k<<16)+(l<<8)+m},c.getBlend=function(a,b,d){var e=a._r+(b._r-a._r)*d,f=a._g+(b._g-a._g)*d,g=a._b+(b._b-a._b)*d,h=a._a+(b._a-a._a)*d;return new c(e,f,g,h)},c.isCSSColor=function(a){return arguments.length>1||"string"!=typeof a?!1:d.test(a)||e.test(a)||f.test(a)||g.test(a)||h.test(a)||i.test(a)||b[a.toLowerCase()]},c.getBestContrast=function(a,b,c){var d=a.getLuminance();return Math.abs(d-b.getLuminance())>Math.abs(d-c.getLuminance())?b:c},c.getContrast=function(a,b){if(a&&b){var c=a.getLuminance()/100,d=b.getLuminance()/100;return c>d?(c+.05)/(d+.05):(d+.05)/(c+.05)}},c.isDark=function(){var a={getLuminance:c.prototype.getLuminance};return c.prototype.init.apply(a,[].slice.call(arguments)),c.prototype.isDark.call(a)},c.useDarkLabel=function(a,b){return a._a>.5?!a.isDark():!b},c}),define("extensions.qliktech/barchart/layers/label-layer",["core.utils/class","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","general.utils/color","objects.views/charts/utils/tree-iterator"],function(a,b,c,d){function e(a,b){return a?d.useDarkLabel(b,t)?q.label.dark.color:q.label.light.color:t?q.label.light.color:q.label.dark.color}function f(a,b,c,d,e,f,g){return{type:"text",fill:q.label.dark.color,opacity:d||1,data:{value:b,rect:c,labelRect:f,hintDirection:g,color:e},shape:{text:a,maxNumLines:1,align:"center",baseline:"middle"}}}function g(a){var b,c,d,e;return b=a.descendants.filter(function(a){return!a.isBranch&&a.data.isVisible!==!1}),c=b.map(function(a){return a.data.hitRect}),c.length?(d=c[0],c.length>1&&(d=d.combineWith(c.slice(-1)[0])),e=f(a.data.valueLabel,a.data.sum,d,b[b.length-1].opacity,b[b.length-1].data.color,null,null),e.data.isFillPattern=window.CanvasPattern&&b[b.length-1].fill instanceof window.CanvasPattern,e.data.lastRect=c[c.length-1],e):void 0}function h(a,b){var c,d;a.forEach(function(a){c=a.children,a.data.isStack?(d=g(a),d&&(d.data.isStack=!0,b.push(d))):c&&c.length?h(c,b):a.data.isVisible!==!1&&b.push(f(a.data.valueLabel,a.data.value,a.data.hitRect,a.opacity,a.data.color,a.data.labelRect,a.data.hintDirection))})}function i(a,b){Object.keys(b).forEach(function(c){a[c]=b[c]})}function j(){var a,c,d,e,f=[],g=this.minorAxis.getPlotMin(),i=this.minorAxis.getPlotMax(),j=q.label.font,m=this.bounds;h(this._shapes,f),b.setFont(j),this.renderer.setFont(j),f=f.filter(function(a){return"NaN"===a.data.value?!0:a.data.labelRect||a.data.showHintLabel?!0:a.data.value>=0&&i>=a.data.value&&g<=a.data.value?!0:a.data.value<0&&g<=a.data.value&&i>=a.data.value?!0:a.data.rect.width&&a.data.rect.height&&m.intersectsWith(a.data.rect)?!0:!1});var o,p,s;for(this._shapes&&this._shapes.length?(p=this._shapes[0].descendants.filter(function(a){return!a.isBranch})[0],s=p?p.data.hitRect.width:this.majorAxis._discreteSpacing):s=0,o=0,a=f?f.length:0,d=0;a>d;d++)c=f[d],c.shape&&(c.shape.font=j,c.data.labelWidth=b.getTextWidth(c.shape.text),o=Math.max(o,c.data.labelWidth));this._longestLabel=o,e=this._longestLabel<s;var u;for(u=this.minorAxis.isVertical()?e?k:l:n,d=0;a>d;d++)u.call(this,f[d],s);f.slice().forEach(function(a){a.fill&&a.backdrop&&(f.unshift({opacity:a.opacity||1,type:"roundRect",fill:r,shape:a.backdrop}),a.fill=t?q.label.light.color:q.label.dark.color)}),this.renderer.shapes=f,this.renderer.render()}function k(a,b){for(var c,d=this.renderer.getFontHeight(q.label.font),f=m.apply(this,[a,!1,b]),g=0;g<f.length;g++)if(i(a.shape,f[g].rect),d<f[g].rect.height){c=f[g];break}if(c){var h=c.rect.width-a.data.labelWidth;i(a.shape,c.rect),a.shape.baseline=c.baseline,a.shape.align=c.align,a.data.isStack&&c.inline&&(a.data.lastRect.height<20||a.data.isFillPattern)?a.backdrop={x:c.rect.x+Math.min(h/2,4),y:"top"===c.baseline?c.rect.y:c.rect.y+c.rect.height-16,width:Math.max(c.rect.width-Math.min(h,8)),height:16,radius:4}:(a.fill=e(c.inline,a.data.color),a.backdrop=!1)}else a.fill=!1}function l(a,d){var f,g,h,j=m.apply(this,[a,!0,d]);f="labelWidth"in a.data?a.data.labelWidth:b.getTextWidth(a.shape.text);for(g=0;g<j.length;g++)if(j[g].rect.height>=f){h=j[g];break}if(h||(j.sort(function(a,b){return.8*b.rect.height-a.rect.height}),j[0].rect.height>=8&&(h=j[0])),h){var k=new c;k.translate(h.rect.x,h.rect.y+h.rect.height),k.rotate(-Math.PI/2),i(a.shape,{width:h.rect.height,height:h.rect.width,baseline:h.baseline,align:h.align,x:0,y:0}),a.transform=k.elements,a.data.isStack&&h.inline&&(a.data.lastRect.height<f+4||a.data.isFillPattern)?a.backdrop={radius:4,x:h.rect.x+h.rect.width/2-8,y:"right"===h.align?h.rect.y-4:h.rect.y+h.rect.height-f-4,width:16,height:f+8}:(a.fill=e(h.inline,a.data.color),a.backdrop=!1)}else a.fill=!1}function m(a,b,c){var d,e,f,g,h=b&&a.data.isStack?8:4,i=[];return d=a.data.rect.width,e=a.data.rect.height,f=a.data.rect.x,g=a.data.rect.y,"up"!==a.data.hintDirection&&a.data.value>=0||"down"===a.data.hintDirection?(g-this.bounds.y-2*h>4&&i.push({align:b?"left":"center",baseline:b?"middle":"bottom",rect:{x:f-.5*(c-d),y:this.bounds.y+h,width:c,height:g-this.bounds.y-2*h}}),a.data.labelRect&&(d=a.data.labelRect.width,e=a.data.labelRect.height,f=a.data.labelRect.x,g=a.data.labelRect.y),a.data.hintDirection||i.push({align:b?"right":"center",baseline:b?"middle":"top",inline:!0,rect:{x:f,y:g+h,width:d,height:e-2*h}})):(this.bounds.height-g-e-2*h>0&&i.push({align:b?"right":"center",baseline:b?"middle":"top",rect:{x:f-.5*(c-d),y:g+e+h,width:c,height:this.bounds.height-g-e-2*h}}),a.data.labelRect&&(d=a.data.labelRect.width,e=a.data.labelRect.height,f=a.data.labelRect.x,g=a.data.labelRect.y),a.data.hintDirection||i.push({align:b?"left":"center",baseline:b?"middle":"bottom",inline:!0,rect:{x:f,y:g+h,width:d,height:e-2*h}})),i}function n(a,c){var d,f,g,h;g=o.apply(this,[a,c]),d="labelWidth"in a.data?a.data.labelWidth:b.getTextWidth(a.shape.text);for(f=0;f<g.length;f++)if(g[f].rect.width>=d){h=g[f];break}!h&&g.length&&(g.sort(function(a,b){return.8*b.rect.width-a.rect.width}),g[0].rect.width>=8&&(h=g[0])),h?(a.shape.baseline="middle",a.shape.align=h.align,i(a.shape,h.rect),a.data.isStack&&h.inline&&(a.data.lastRect.width<d+8||a.data.isFillPattern)?a.backdrop={y:h.rect.y+h.rect.height/2-8,height:16,x:("right"===h.align?h.rect.x+h.rect.width-d:h.rect.x)-4,width:d+8,radius:4}:(a.fill=e(h.inline,a.data.color),a.backdrop=!1)):a.fill=!1}function o(a){var b,c,d,e,f=a.data.isStack?8:4,g=[];return b=a.data.rect.width,c=a.data.rect.height,d=a.data.rect.x,e=a.data.rect.y,"right"!==a.data.hintDirection&&a.data.value>=0||"left"===a.data.hintDirection?(this.bounds.width-d-b-2*f>0&&g.push({align:"left",rect:{x:d+b+f,y:e,width:this.bounds.width-d-b-2*f,height:c}}),a.data.labelRect&&(b=a.data.labelRect.width,c=a.data.labelRect.height,d=a.data.labelRect.x,e=a.data.labelRect.y),a.data.hintDirection||g.push({align:"right",inline:!0,rect:{x:d+f,y:e,width:b-2*f,height:c}})):(d-this.bounds.x-2*f&&g.push({align:"right",rect:{x:this.bounds.x+f,y:e,width:d-this.bounds.x-2*f,height:c}}),a.data.labelRect&&(b=a.data.labelRect.width,c=a.data.labelRect.height,d=a.data.labelRect.x,e=a.data.labelRect.y),a.data.hintDirection||g.push({align:"left",inline:!0,rect:{x:d+f,y:e,width:b-2*f,height:c}})),g}var p,q,r,s,t;return p=a.extend("LabelLayer",{init:function(a){this.renderer=new b(a)},setData:function(a){this._data=a},setMeasureIndices:function(){},setBarData:function(a){this._barData=a},setShapes:function(a){this._shapes=a},show:function(){this.renderer.show()},hide:function(){this.renderer.hide()},release:function(){this.renderer.release()},render:function(){q=this.style.dataPoints,s=new d(this.style.backgroundColor),t=s.isDark(),r=d.toRGBA(s,.75),j.call(this)}})}),define("objects.views/charts/style",[],function(){return{shape:{selected:{border:{color:"rgba(255, 0, 0, 0.8)",width:2}},unselected:{opacity:.5}}}}),define("objects.views/charts/chart-style-service",["core.utils/class","core.utils/theme","./style"],function(a,b){function c(a,b){if("string"==typeof a&&"@"===a[0]){var d=a.substring(1);return b[d]?c(b[d],b):a}return a}function d(a,b,c,d,f){var g,h=b.split("."),i=a,j=f;for(void 0!==i[c]&&(j=i[c]),g=0;g<h.length;++g){if(void 0===i[h[g]])return j;i=i[h[g]],void 0!==i[c]&&(j=i[c])}return void 0!==i[c]&&(j=i[c]),["string","number","boolean","array"].contains(typeof j)?j:j?void 0!==j["default"]||void 0!==d?e(j,d,f):f:null}function e(a,b){var c,d,e=a,f=a["default"];if(!b)return f;for(c=b.split("."),d=0;d<c.length;++d){if(void 0===e[c[d]])return f;
e=e[c[d]],f=e}return f}function f(a){a=a||{};var b=a;return b}var g,h;return g=a.extend("ChartStyleService",{init:function(){this._baseStyle=b,this._chartStyles=b,this._fontCache={},this._variables=f(b._variables);var a=this;b.ThemeChanged.bind(function(){a._variables=f(b._variables)})},getValue:function(a,b,e,f,g){return a=a||"",""===a||this._chartStyles[a]?(""!==a&&(a+="."),b&&(a+=b),c(d(this._chartStyles,a,e,f,g),this._variables)):g},getFont:function(a,b,c,e,f){if(a=a||"",""===a||this._chartStyles[a]){""!==a&&(a+="."),b&&(a+=b);var g=c?a+"."+c:a;if(this._fontCache[g])return this._fontCache[g];var h=[d(this._chartStyles,a,"fontStyle",c,e)||"",d(this._chartStyles,a,"fontVariant",c,e)||"",d(this._chartStyles,a,"fontWeight",c,e)||"",d(this._chartStyles,a,"fontStretch",c,e)||"",void 0!==f?f+"px":d(this._chartStyles,a,"fontSize",c,e)||"12px",d(this._chartStyles,a,"lineHeight",c,e)||"",d(this._chartStyles,a,"fontFamily",c,e)||"'Qlikview Sans'"];return h=h.filter(function(a){return""!==a}),this._fontCache[a+"."+c]=h.join(" "),this._fontCache[a+"."+c]}return e}}),h=new g,h.layoutMap={1:"spark",3:"xsmall",7:"small",15:"medium",31:"full"},{getInstance:function(){return h}}}),define("extensions.qliktech/barchart/style",[],function(){return{dataPoint:{label:{dark:{color:"#666"},light:{color:"#eee"},font:"11px 'QlikView Sans'"}},shape:{selected:{border:{color:"#333",width:2}},unselected:{opacity:.5},highlighted:{border:{dark:{color:"rgba( 26, 26, 26, 0.75 )"},light:{color:"rgba( 230, 230, 230, 0.75)"},width:1}}}}}),define("extensions.qliktech/barchart/bararea",["objects.views/charts/components/chart-component","./layers/bar-layer","./layers/label-layer","general.utils/color","objects.utils/shapes/rect","objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect","objects.views/charts/chart-style-service","./style"],function(a,b,c,d,e,f,g,h,i){function j(a){var b=1;return p.width=5*b,p.height=5*b,q.save(),q.fillStyle=d.toRGBA(a,.8),q.scale(b,b),q.fillRect(0,0,1,1),q.fillRect(0,1,1,1),q.fillRect(1,0,1,1),q.fillRect(4,1,1,1),q.fillRect(4,2,1,1),q.fillRect(3,2,1,1),q.fillRect(3,3,1,1),q.fillRect(2,3,1,1),q.fillRect(2,4,1,1),q.fillRect(1,4,1,1),q.restore(),q.createPattern(p,"repeat")}function k(a,b){var c=a.layoutMap[b]||"medium",d={shape:{selected:{border:{color:a.getValue(m,"shape.border","color","selected"),width:a.getValue(m,"shape.border","width","selected")}}},dataPoints:{label:{font:a.getFont(m,"value",c),dark:{color:a.getValue(m,"value","color","dark")},light:{color:a.getValue(m,"value","color","light")}}},backgroundColor:a.getValue(m,null,"backgroundColor")};return d}var l,m="barChart",n="stacked",o="grouped",p=document.createElement("canvas"),q=p.getContext("2d");return l=a.extend("BarArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._barData=[],this._showDataPoints=!0,this._colorMap=null,this._groupingMode=o,this._globalAlpha=1,this._styleService=i.getInstance(),this._barLayer=new b(this.container),this._barLayer.isMini=this.isMini,this.layers=[this._barLayer],this.isMini||(this._labelLayer=new c(this.container),this.layers.push(this._labelLayer))},beforeBarsAddedToRenderer:function(){},barsAddedToRenderer:function(){},labelAddedToRenderer:function(){},afterPaint:function(){},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setShowDataPoints:function(a){this._showDataPoints=a,this.invalidateDisplay("BarArea.setShowDataPoints")},getShowDataPoints:function(){return this._showDataPoints},getMeasureIndices:function(){return this._measureIndices},setMeasureIndices:function(a){this._measureIndices=a},setMajorAxis:function(a){this._majorAxis=a,this._majorAxis.listen("changed",function(){this.invalidateDisplay("BarArea.setMajorAxis")},this)},setMinorAxis:function(a){this._minorAxis=a,this._minorAxis.listen("changed",function(){this._localFormatting&&(this._areLabelsFormatted=!1),this.invalidateDisplay("BarArea.setMinorAxis")},this)},setDimensionTree:function(a){this._tree=a,this.invalidateProperties("BarArea.setDimensionTree"),this.invalidateDisplay("BarArea.setDimensionTree")},setGroupingMode:function(a){this._groupingMode=a,this.invalidateProperties("BarArea.setGroupingMode"),this.invalidateDisplay("BarArea.setGroupingMode")},_updateSize:function(){this.invalidateDisplay("BarArea._updateSize")},insertAdjacentTo:function(a,b){if(this._super(a,b),this._minorAxis&&this._minorAxis.isHorizontal())switch(this._minorAxis.dock){case"bottom":this.rect.height-=1}},getMajorAxisData:function(){return this._majorAxisData},getMinorAxisData:function(){return this._minorAxisData},setCacheItems:function(a){this._cacheItems=a},getCacheItems:function(){return this._cacheItems},createAxisData:function(a,b,c,d){d||(this._cacheIndex=0);var e,f=b.stackLevel===d+1,g=a.children;return"measure"===b.types[d]&&this._measureIndices&&(g=g.filter(function(a,b){return this._measureIndices.indexOf(b)>=0},this)),g.map(function(a){var g;if("dimension"===b.types[d]){if(g={label:a.data.qText,group:"dimension"===b.types[d+1]||"measure"===b.types[d+1]&&b.numMeasures>1,id:a.data.id,cacheIndex:[]},"measure"===b.types[d+1])for(e=0;e<b.numMeasures;e++)g.cacheIndex.push(this._cacheIndex++);!f&&("dimension"===b.types[d+1]||"measure"===b.types[d+1]&&b.numMeasures>1)&&(g.children=this.createAxisData(a,b,c,d+1))}else"measure"===b.types[d]&&(g={label:a.data.qText,id:a.data.id});return g}.bind(this))},_createMeasureDisplayNode:function(a,b){if(a.isBranch){var c=this.isMini===!0||this._isStacked?new h:new g,d=a.children,f=d[0].data,i=a.parent.cacheItem,j=new e(0,0,0,0),k=this.measureFormatters[b],l="undefined"!=typeof f.qValue?f.qValue:f.qNum,m=a.ancestors.filter(function(a){return"qElemNo"in a.data}).map(function(a){return a.data.qElemNo}).reverse();return c.data={qText:a.data.qText,measureIndex:b,value:l,start:0,end:l,valueLabel:a.children[0].data.qText,formatted:!k||"U"!==k.type,hitRect:j,cacheItem:i,color:this._colorMap.getColor(m,l,b,a.data.rowIndex)},i.addShape("dataArea",j,!0),i.calculateTooltipPosition=!0,c.data.fill=c.data.color.toRGBA(),c.fill=c.data.fill,c.data.isFillColorDark=c.data.color.isDark(),c}},_createDimensionDisplayNode:function(a){var b=new f;return b.data={qText:a.data.qText,qElemNo:a.data.qElemNo,qMaxPos:a.data.qMaxPos,qMinNeg:a.data.qMinNeg,qType:a.data.qType},b},_createStackNode:function(){var a=new f;return a.data={stack:!0},a},_createOtherNode:function(a,b){var c=new h,d=new e(0,0,0,0),f=this.measureFormatters[0];return c.data={measureIndex:0,value:b-a,start:a,end:b,isFakeOtherCell:!0,highlightOnGroupSelect:0===this._selectionIndices[0],valueLabel:"valueLabel",formatted:!f||"U"!==f.type,hitRect:d,cacheItem:{},color:this._colorMap.getColor([-3],b-a,0,0)},c.data.fill=c.data.color.toRGBA(),c.fill=c.data.fill,c.data.isFillColorDark=c.data.color.isDark(),c},_addOtherNode:function(a,b,c){var d=this._createDimensionDisplayNode({data:{qMaxPos:0,qMinNeg:0,qElemNo:-3,qType:"O"}}),e=this._createOtherNode(a.data.sum,b);return e.data.axisId=c.data.id,e.data.cacheItem=c.cacheItem,d.addChild(e),a.data.sum=b,a.addChild(d),e},_stackNodes:function(a,b,c,d){var e,f,g,h,i,j=this._createStackNode(),k=this._createStackNode(),l=!1,m=!1,n=0,o=0;j.data.isStack=!0,k.data.isStack=!0,a.forEach(function(a){e=b,g=a.children&&a.children[0]?a.children[0].data:a.data,g.value>=0?(e=j,g.start=n,n+=g.value,g.end=n,f=n,h=!0,e.addChild(a),"O"===a.data.qType&&(l=!0)):isNaN(g.value)||(e=k,g.start=o,o+=g.value,g.end=o,f=o,i=!0,e.addChild(a),"O"===a.data.qType&&(m=!0)),e.data.sum=f}),"undefined"==typeof b.data.qMaxPos||l||n===b.data.qMaxPos||(d.push(this._addOtherNode(j,b.data.qMaxPos,c)),n=j.data.sum,h=n>0),"undefined"==typeof b.data.qMinNeg||m||o===b.data.qMinNeg||(d.push(this._addOtherNode(k,b.data.qMinNeg,c)),o=k.data.sum,i=0>o),h&&(j.data.valueLabel=this.combinedMeasuresFormatter?this.combinedMeasuresFormatter.formatValue(j.data.sum):j.data.sum+"",b.addChild(j)),i&&(k.data.valueLabel=this.combinedMeasuresFormatter?this.combinedMeasuresFormatter.formatValue(k.data.sum):k.data.sum+"",b.addChild(k)),b.data.sum={positive:n,negative:o}},getRenderTree:function(a,b,c,d){var e,f,g,h,i,j,k,l=b.stackLevel===d+1,m=[];for(g=a.children,"measure"===b.types[d]&&this._measureIndices&&(g=g.filter(function(a,b){return this._measureIndices.indexOf(b)>=0},this)),i=g.length,h=0;i>h;h++)if(k=g[h],"dimension"===b.types[d])j=this._createDimensionDisplayNode(k),f=this.getRenderTree(k,b,c,d+1),l?(this._stackNodes(f,j,k,c.otherShapes),c.globalPositiveSum=Math.max(c.globalPositiveSum,j.data.sum.positive),c.globalNegativeSum=Math.min(c.globalNegativeSum,j.data.sum.negative)):j.addChildren(f),j.isBranch&&m.push(j);else if("measure"===b.types[d]){if(j=this._createMeasureDisplayNode(k,this._measureIndices?this._measureIndices[h]:h),!j)continue;e=k,b.numMeasures<=1&&(e=e.parent),b.stackLevel===d&&(e=e.parent),j.data.axisId=e.data.id,c.shapes.push(j),m.push(j)}return m},_applyIds:function(a,b,c,d){var e;a.children.forEach(function(f,g){e=a.data.id?a.data.id+";"||"":"","dimension"===c[d]?(f.data.id=e+b[d]+":"+f.data.qElemNo,this._applyIds(f,b,c,d+1)):"measure"===c[d]&&(f.data.id=e+b[d+g])}.bind(this))},_updateProperties:function(){if(this._data&&this._tree){this._barLayer.renderer.stage.removeChildren();var a=this._data.qHyperCube.qDimensionInfo.length,b=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,c=this._groupingMode===n&&(a>1||b>1),d=a+1,e=-2,f=new Array(a).join(",").split(",").map(function(){return"dimension"}),g=this._data.qHyperCube.qDimensionInfo.concat(this._data.qHyperCube.qMeasureInfo).map(function(a){return a.cId}),h=this._data.qHyperCube.qDimensionInfo.map(function(a){return a.qApprMaxGlyphCount});f.push("measure"),h.push(this._data.qHyperCube.qMeasureInfo.reduce(function(a,b){return Math.max(a,b.qApprMaxGlyphCount)},0)),c&&(e=b>1?a:a-1),this._isStacked=c;var i={columns:[],shapes:[],shapesToLabel:[],otherShapes:[],globalPositiveSum:0,globalNegativeSum:0},j={colIds:g,types:f,numLevels:d,numMeasures:b,stackLevel:e};a>1&&this._allowInnerSelection&&!this._data.qHyperCube.qDimensionInfo[1].qLocked?(this.setSelectionIndices([1]),this._majorAxis.setSelectionIndices([1]),this._majorAxis.setCurrentDataIndices([1])):(this.setSelectionIndices([0]),this._majorAxis.setSelectionIndices([0]),this._majorAxis.setCurrentDataIndices([0])),this._applyIds(this._tree,g,f,0);var k=this.getRenderTree(this._tree,j,i,0);this._objects=k,this._formatted=this._isStacked||this.measureFormatters.every(function(a,b){var c=this._measureIndices?this._measureIndices.indexOf(b)>=0:!0;return c?"U"!==a.type:!0},this),this._shapes=i.shapes;var l=i.shapes.map(function(a){return a.data.cacheItem});this._shapes=this._shapes.concat(i.otherShapes),k.forEach(function(a){this._barLayer.renderer.stage.addChild(a)}.bind(this));var m=this.createAxisData(this._tree,j,i,0),o=f.map(function(a,b){return{qApprMaxGlyphCount:h[b],show:b<f.length-1}});this._majorAxisData={data:m,info:o,groupSize:c?null:b},this._numDimensions=a,this._numMeasures=b,this._minorAxisData=c?{min:i.globalNegativeSum,max:i.globalPositiveSum}:null,this.setSelectableShapes(l)}},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data&&this._tree&&(this._data.qHyperCube.qStackedDataPages.length>0||this._data.qHyperCube.qDataPages.length>0)},updateSize:function(){this._super(),this.layers.forEach(function(a){a.rect=this.rect,a.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y),a.renderer.setDimensions(0,0,this.rect.width,this.rect.height)},this)},paint:function(){this._super(this._layoutMode,this._data),this._majorAxis.updateNow(),this._minorAxis.updateNow();var a=this._minorAxis.getPadding(),b=new e;this._style=k(this._styleService,this._layoutMode),b.set(a.left,a.top,this.rect.width-a.left-a.right,this.rect.height-a.top-a.bottom),this.layers.forEach(function(a){a.minorAxis=this._minorAxis,a.majorAxis=this._majorAxis,a.shapes=this._shapes,a.othersFillPattern=j(this._colorMap.getColor([-3])),a.groupingMode=this._groupingMode,a.widthRatio=this._numDimensions<=1&&this._numMeasures<=1||this._groupingMode===n?.7:.95,a.isSpikingEnabled=!(this.isMini||this._groupingMode===n&&(this._numDimensions>1||this._numMeasures>1)),a.isHintingEnabled=!this.isMini&&(this._groupingMode===o||this._groupingMode===n&&this._numDimensions+this._numMeasures<=2),a.style=this._style,a._globalAlpha=this._globalAlpha},this),this._barLayer.colorMap=this._colorMap,this._barLayer.update(),this.nodesInView=this._barLayer.nodesInView,this.barsAddedToRenderer(),this._barLayer.render(),this._labelLayer&&(this._labelLayer.setShapes(this._objects),this._labelLayer.bounds=b,this._labelLayer._longestLabel=20,this._layoutMode>this.ShowFlags.XSMALL&&this._showDataPoints?(this._formatLabels(),this._labelLayer.show(),this._labelLayer.render()):this._labelLayer.hide()),this.afterPaint()},_formatLabels:function(){if(!this._isStacked&&!this._formatted){var a,b,c=this.nodesInView?this.nodesInView.length:0;for(a=0;c>a;a++)b=this.nodesInView[a].data,b.formatted||(b.formatted=!0,b.valueLabel=this.measureFormatters[b.measureIndex]?this.measureFormatters[b.measureIndex].formatValue(b.value):b.valueLabel)}},release:function(){this.layers.forEach(function(a){a.release()}),this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this)}})}),define("extensions.qliktech/barchart/barchart-properties",["translator","general.utils/property-resolver"],function(a,b){function c(a,c){var d=b.getValue(a,"color.auto"),e=b.getValue(a,"color.mode"),f=c.getDimensions();return f.length>1&&!d&&"byDimension"===e}function d(a,b){return b?b.getMeasureLayouts():a.qHyperCubeDef.qMeasures.map(function(a){return a.qDef})}function e(a,b){return b?b.getDimensionLayouts():a.qHyperCubeDef.qDimensions.map(function(a){return a.qDef})}var f,g,h;f={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",defaultValue:"grouped",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(a){var b=a.qHyperCubeDef.qMeasures.length,c=a.qHyperCubeDef.qDimensions.length;return b+c>2},change:function(a,b){b.getDimensions().length>1&&"stacked"===a.barGrouping.grouping?(a.qHyperCubeDef.qMode="K",a.qHyperCubeDef.qAlwaysFullyExpanded=!0):a.qHyperCubeDef.qMode="S"}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"vertical",horizontal:!0,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridLine.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(a){return a.gridLine&&!a.gridLine.auto}}}},showLabels:{ref:"dataPoint.showLabels",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-dataPoints"}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-dropdown",translation:"properties.colorDimensionId",show:function(a,b){return c(a,b)}}}},legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{type:"items",label:function(b,c){var d,f="y",g=e(b,c).map(function(a){return a.qFallbackTitle||""}).join(", ");return"vertical"===b.orientation&&(f="x"),d=g?a.get("properties."+f+"AxisWithInfo",[g]):a.get("properties."+f+"Axis")},items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all",snapshot:{title:"properties.xAxis",group:!1,tid:"property-xAxis"}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(a){return"vertical"===a.orientation&&a.dimensionAxis&&["all","labels"].contains(a.dimensionAxis.show)}},dock:{ref:"dimensionAxis.dock",translation:"Common.Position",type:"string",component:"dropdown",defaultValue:"near",options:function(){var a,b;return"vertical"===i.orientation?(a="Common.Bottom",b="Common.Top"):(a="properties.dock.left",b="properties.dock.right"),[{value:"near",translation:a},{value:"far",translation:b}]},show:function(a){return a.dimensionAxis&&"none"!==a.dimensionAxis.show}}}},measureAxis:{uses:"measureAxis",label:function(b,c){var e,f="x",g=d(b,c).map(function(a){return a.qFallbackTitle}).join(", ");return"vertical"===b.orientation&&(f="y"),e=g?a.get("properties."+f+"AxisWithInfo",[g]):a.get("properties."+f+"Axis")},items:{axis:{type:"items",items:{show:{snapshot:{title:"properties.yAxis",group:!1,tid:"property-yAxis"}}}}}}}},g={uses:"sorting",items:{dimensions:{locked:function(a,b,c){return 1===c.getMeasures().length&&2===c.getDimensions().length?0===a:!1}}}},h={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"},refLines:{uses:"reflines"}}};var i={uses:"data",items:{dimensions:{}}};return{type:"items",component:"accordion",items:{data:i,sorting:g,addons:h,settings:f}}}),define("extensions.qliktech/barchart/barchart-data",["core.utils/deferred","general.utils/array-util","general.utils/property-resolver","objects.utils/data-properties/library-utils","general.models/library/dimension"],function(a,b,c,d,e){function f(b){function c(a){a>10?1!==b.getSorting()[0]&&b.changeSorting(1,0):0!==b.getSorting()[0]&&b.changeSorting(1,0)}var f,g=b.getDimensions(),h=b.getMeasures();if(1===g.length&&1===h.length){var i=g[0];return i.qLibraryId?e.getLayout(i.qLibraryId).then(function(a){if(a&&a.qDimInfos&&a.qDimInfos[0]){var b=a.qDimInfos[0].qCardinal;c(b)}return i}):d.findField(i.qDef.qFieldDefs[0]).then(function(a){if(a){var b=a.qCardinal;c(b)}return i})}return g.length>1&&1===h.length&&(f=b.getSorting().indexOf(0),0!==f&&b.changeSorting(f,0)),a.resolve()}function g(a,b){var d=b.getDimensions(),e=b.getMeasures(),f=c.getValue(a,"color.mode");d.length>1&&a.color&&(a.color.persistent=!0),"byMeasure"===f&&e.length>1?c.setValue(a,"color.mode","byDimension"):"byExpression"===f&&0===e.length&&c.setValue(a,"color.mode","primary")}function h(a){return a>=2?1:15}var i={measures:{min:1,max:h,add:function(a,b,c){return f(c).then(function(){return a.qSortBy.qSortByNumeric=-1,g(b,c),a})},remove:function(a,c,d){var e=d.getDimensions(),f=d.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions;1===e.length&&f&&f.length&&(e.push(f.splice(0,1)[0]),b.indexAdded(d.hcProperties.qInterColumnSortOrder,e.length-1)),g(c,d),e.length>1&&"stacked"===c.barGrouping.grouping?(c.qHyperCubeDef.qMode="K",c.qHyperCubeDef.qAlwaysFullyExpanded=!0):1===e.length&&(c.qHyperCubeDef.qMode="S")}},dimensions:{min:1,max:function(a){return a>=2?1:2},add:function(a,b,c){return c.getDimensions().length>1&&"stacked"===b.barGrouping.grouping&&(b.qHyperCubeDef.qMode="K",b.qHyperCubeDef.qAlwaysFullyExpanded=!0),f(c).then(function(){return g(b,c),a})},remove:function(a,b,c){var d=c.getDimensions(),e=c.getMeasures(),f=h(d.length),i=c.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures;1===e.length&&i&&i.length&&i.splice(0,f-1).forEach(function(a){e.push(a),c.hcProperties.qInterColumnSortOrder.push(d.length+e.length-1)}),g(b,c),1===d.length&&(b.qHyperCubeDef.qMode="S")}}};return i}),define("objects.views/charts/layout-engine",["objects.utils/shapes/rect"],function(a){function b(){this._layoutComponents=[],this._componentSizes=[]}function c(a){var b=this._componentSizes.filter(function(b){return b.component===a})[0];b||(b={component:a},this._componentSizes.push(b)),b.rect=a.rect.clone()}function d(a){return this._componentSizes.filter(function(b){return b.component===a})[0]}function e(a,b,c,d){var e,f=this._layoutComponents.slice(),g=[{fn:"_reduceComponentRectBySpacingV",dock:["left","right"]},{fn:"_reduceComponentRectBySpacingH",dock:["top","bottom"]}];for("vertical"===d&&g.reverse(),f.sort(function(a,b){return(a.reductionOrder||1e3)-(b.reductionOrder||1e3)}),e=0;e<f.length;e++)f[e].perpendicularlyRelevantSpacing={top:0,left:0,right:0,bottom:0},f[e].preRelevantSizeCalculation&&f[e].preRelevantSizeCalculation();var h=a.clone();g.forEach(function(a){this._reducePreliminaryLayoutRectForComponents(f,h,b,c,function(b){return b&&a.dock.indexOf(b.dock)>=0}),this[a.fn](h,b,f,c)},this),g.forEach(function(d){this._reduceLayoutRectForComponents(f,a,b,h,c,function(a){return a&&d.dock.indexOf(a.dock)>=0}),this[d.fn](a,b,f,c)},this)}return b.prototype={addComponent:function(a){var b;b=this._layoutComponents,this.removeComponent(a),b.push(a)},removeComponent:function(a){var b,c;for(c=this._layoutComponents,b=0;b<c.length;++b)if(c[b]===a)return void c.splice(b,1)},_reduceLayoutRectForComponents:function(a,b,c,d,e,f){var g;for(g=0;g<a.length;++g)a[g]&&["left","right","bottom","top"].contains(a[g].dock)&&f(a[g])&&(a[g].calculateRelevantSize(b,c,d),a[g].isVisible(e)&&a[g].reduceLayoutRect(b))},_reducePreliminaryLayoutRectForComponents:function(a,b,c,d,e){var f;for(f=0;f<a.length;++f)a[f]&&["left","right","bottom","top"].contains(a[f].dock)&&e(a[f])&&(a[f].calculatePreliminaryRelevantSize?a[f].calculatePreliminaryRelevantSize(b,c):a[f].calculateRelevantSize(b,c),a[f].isVisible(d)&&a[f].reduceLayoutRect(b))},_reduceComponentRectBySpacingH:function(a,b,c,d){var e,f;for(e=0;e<c.length;++e)f=c[e].perpendicularlyRelevantSpacing,f&&c[e].isVisible(d)&&(f.left>a.x&&a.x>=0&&(a.width-=f.left-a.x,a.x=f.left),f.right>b.width-a.x-a.width&&(a.width-=f.right-(b.width-a.x-a.width-b.x)))},_reduceComponentRectBySpacingV:function(a,b,c,d){var e,f;for(e=0;e<c.length;++e)f=c[e].perpendicularlyRelevantSpacing,f&&c[e].isVisible(d)&&(f.top>a.y&&a.y>=0&&(a.height-=f.top-a.y,a.y=f.top),f.bottom>b.height-a.y-a.height&&(a.height-=f.bottom-(b.height-a.y-a.height-b.y)))},_layoutComponent:function(a,b,c,d){a&&a.insertAdjacentTo(a.dock&&"center"!==a.dock?a.isVertical()?c.x:c.y:d,a.isVisible(b))},layout:function(b,f,g,h){var i=2;b=new a(b.x,b.y,b.width,b.height),g=new a(g.x,g.y,g.width,g.height);var j,k,l,m,n,o=g.width/b.width,p=g.height/b.height;for(k=this._layoutComponents,k.sort(function(a,b){return"center"===a.dock?"center"===b.dock?0:-1:"center"===b.dock?1:a.layoutOrder-b.layoutOrder}),b=new a(b.x,b.y,b.width-2*i,b.height-2*i),l=new a(b.x,b.y,b.width,b.height),m={x:new a,y:new a},e.apply(this,[l,b,f,h]),l.x+=i,l.y+=i,m.x.set(l.x,l.y,l.width,l.height),m.y.set(l.x,l.y,l.width,l.height),j=0;j<k.length;++j)k[j].setLayoutToContainerRatios(o,p),this._layoutComponent(k[j],f,m,l),n=d.call(this,k[j]),k[j].updateSize(!n||n.rect.width!==k[j].rect.width||n.rect.height!==k[j].rect.height),c.call(this,k[j])}},b}),define("objects.views/charts/components/data-area",["./chart-component"],function(a){var b;return b=a.extend({paint:function(a){this._super(a)}})}),define("objects.views/charts/components/grid",["./chart-component","objects.views/charts/utils/canvas-renderer","objects.views/charts/chart-style-service"],function(a,b,c){function d(a,b,c,d,e,f,g){var h,i,j,k;return g?(h=0,i=d,j=a,k=a):(h=a,i=a,j=0,k=e),{type:"line",opacity:c,strokeWidth:f,shape:{x1:h,x2:i,y1:j,y2:k},stroke:b}}function e(a,b){var c,e,f,g,i=a.ticks,j=a.minorTicks,k=i?i.length:0,l=j?j.length:0,m=a.getSpacingMode()===h.DENSE,n=a.getSpacingMode()===h.SPARSE?2:1,o=b.rect.height,p=b.rect.width,q=b.style,r=[];if(a.getSpacingMode()===h.NONE||!i)return[];for(g=0;k>g;g+=1)e=i[g].position,c=i[g].value,f=i[g].opacity,(g%n===0||0===c)&&r.push(0===c?d(e,q.zero.color,f,p,o,q.zero.width,a.isVertical()):d(e,q.major.color,f,p,o,q.major.width,a.isVertical()));if(m&&j)for(g=0;l>g;g+=1)e=j[g].position,r.push(d(e,q.minor.color,1,p,o,q.minor.width,a.isVertical()));return r}function f(a,b){var c="",d=a.layoutMap[b]||"medium",e={ticks:{major:{color:a.getValue(c,"axis.grid.major","color",d),width:a.getValue(c,"axis.grid.major","width",d)},minor:{color:a.getValue(c,"axis.grid.minor","color",d),width:a.getValue(c,"axis.grid.major","width",d)},zero:{color:a.getValue(c,"axis.grid.zero","color",d),width:a.getValue(c,"axis.grid.major","width",d)}}};return e}var g,h;return h={NONE:0,SPARSE:1,NORMAL:1,DENSE:3},g=a.extend("Grid",{init:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this._styleService=c.getInstance(),this._style=f(this._styleService,this._layoutMode),this._renderer=new b(this.container),this._renderer.edgeBleed={top:1,left:1,bottom:0,right:0},this._$renderAreaWrap.addClass("qv-chart-component-grid"),this.renderers={gridlines:this._renderer}},afterRenderLines:function(){},setAxes:function(a,b){this._primaryHorizontalAxis!==a&&(this._primaryHorizontalAxis&&this._primaryHorizontalAxis.stopListen("changed",null,this),this._primaryHorizontalAxis=a,this._primaryHorizontalAxis.listen("changed",function(){this.invalidateDisplay("Grid.setAxes")},this)),this._primaryVerticalAxis!==b&&(this._primaryVerticalAxis&&this._primaryVerticalAxis.stopListen("changed",null,this),this._primaryVerticalAxis=b,this._primaryVerticalAxis.listen("changed",function(){this.invalidateDisplay("Grid.setAxes")},this))},hasValidData:function(){return this._super()&&this._primaryVerticalAxis&&this._primaryHorizontalAxis},paint:function(a,b){this._super(a,b);var c;return this._primaryVerticalAxis.updateNow(),this._primaryHorizontalAxis.updateNow(),c=e(this._primaryVerticalAxis,{rect:this.rect,style:this._style.ticks}),c=c.concat(e(this._primaryHorizontalAxis,{rect:this.rect,style:this._style.ticks})),this.afterRenderLines(c),this._renderer.shapes=c,this._renderer.render(),this},release:function(){this._super(),this._primaryHorizontalAxis&&this._primaryHorizontalAxis.stopListen("changed",null,this),this._primaryVerticalAxis&&this._primaryVerticalAxis.stopListen("changed",null,this)}})}),define("objects.views/charts/components/axis/radial-axis-helper",["objects.views/charts/utils/matrix","objects.utils/shapes/rect"],function(a){function b(b,e,j){var k,l,m,n,o,p,q,r,s=b.length>0?b[0].positions:[],t=e._style,u=e._radialOptions,v=new a,w=t.tick.length*j,x=t.label.offset*j*20,y=1,z="far"===e.getAlignment()?"left":"right",A=[],B=Math.min(e.rect.height,e.rect.width),C=0,D=[],E=e._radius;if(m="left"===z?1:-1,w=m*w,k=m>0?0:e.rect.width,l=0,k+=m*y/2,l+=e._padding.top,e.getShowLine()&&A.push({stroke:t.line.color,shape:{cx:e._centerPoint.x,cy:e._centerPoint.y,radius:E,radianOffset:0,start:u.start,end:u.end},type:"arc"}),e.getShowLabels())for(r=0;r<s.length;r++)n=(s[r]-C)/(B-C),p=g(n,e),q=h(p),q.r=q.r+x,q=i(q,e._centerPoint),o=f(n,e),q.angle=o,D.push(q),v.save(),v.translate(p.x+e._centerPoint.x,p.y+e._centerPoint.y),v.rotate(o),A.push({stroke:t.tick.color,opacity:e.ticks[r].opacity,transform:v.elements,shape:{x1:0,x2:-w,y1:0,y2:0},type:"line"}),v.restore();if(k+=t.tick.length*m,e._showLabels&&e._layoutMode>1)for(r=0;r<b.length;r++)A=A.concat(c(b[r],D,k,e)),k+=b[r].labelSpace*m;e._showTitle&&e._layoutMode>1&&(A=A.concat(d(e,t))),e._renderer.shapes=A,e._renderer.render()}function c(a,b,c,d){var e,f,g,h,i,j,k=a.labels,l=b,m=a.opacities,n=[],o=d._style;if(k){for(i=0;i<k.length;i++)e=d._renderer.getTextWidth(k[i],o.label.font),h=l[i],g=h.angle,f=g-.1<3*Math.PI/2&&g+.1>3*Math.PI/2?"center":g<Math.PI/2||g>3*Math.PI/2?"left":"right",n.push({type:"text",fill:o.label.color,opacity:m?m[i]:1,shape:{text:k[i],x:h.x,y:h.y,maxWidth:h.x-e<0?h.x:h.x+e>d.rect.width?d.rect.width-h.x:e,height:j,maxNumLines:1,font:o.label.font,align:f,baseline:"middle"}});return n}}function d(a,b){var c=[],d=Math.min(a.rect.width,a.rect.height),f=e(a);return c.push({type:"text",fill:b.label.color,opacity:1,shape:{text:a._title,x:f.x,y:f.y+d*(.06+.04*(Math.min(d-300,0)/-300)),maxWidth:1.4*a._radius,maxNumLines:1,font:b.label.font,align:"center",baseline:"middle"}}),c}function e(a){var b={x:a.rect.width/2,y:a.rect.height/2};return b}function f(a,b){var c=b._radialOptions,d=Math.max(Math.min(a,1),0)*(c.end-c.start)+c.start;return d}function g(a,b,c){var d=b._radialOptions,e=a*(d.end-d.start)+d.start,f=b._radius;return i({a:e,r:f},c)}function h(a){return{r:Math.sqrt(a.x*a.x+a.y*a.y),a:Math.atan2(a.y,a.x)}}function i(a,b){return b||(b={x:0,y:0}),{x:b.x+a.r*Math.cos(a.a),y:b.y+a.r*Math.sin(a.a)}}return{renderRadial:b,getPointOfValue:g,getPolPos:h,getCartPos:i,getAngleOfNormalizedValue:f}}),define("objects.views/charts/components/axis/axis",["jquery","../chart-component","objects.views/charts/components/axis/radial-axis-helper","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","objects.utils/shapes/rect","objects.utils/shapes/polygon","objects.views/charts/chart-style-service"],function(a,b,c,d,e,f,g,h){function i(){var a,b=this;return a=this.getLabels()||[],a.length||this._showTitle_internal?(this._cacheItems&&this._cacheItems.length&&this._cacheItems.forEach(this._cacheItems[0].objectShapes?function(a){a.objectShapes[b.selectionIdentifier]=null}:function(a){a.clearShapes(b.selectionIdentifier)}),void(this.isRadial()?c.renderRadial(a,this,this._windowSizeMultiplier):this.isVertical()?m.apply(this,[a]):n.apply(this,[a]))):void this._renderer.clear()}function j(a,b,c,d,f){var h,i,j,k,l,m,n,p,q,r,s=a.labels,t=a.positions,u=Math.abs(this._fontHeight*Math.sin(c)),v=a.labelSpace,w=Math.abs(v/Math.sin(c)),x=Math.cos(c),y=(new e).skew(1.57079632679-c,0).scale(this._discreteSpacing*(this._groupSize||1)/this._fontHeight,1).translate(0,-d*this._fontHeight/2).rotate(-1.57079632679),z=[],A=0>c?"right":"left";for(r="middle","near"===this.getAlignment()&&"center"!==A&&(A="left"===A?"right":"left"),q=0;q<s.length;q++)h=t[q],0>h||h>this.rect.width||(n=new e,n.translate(t[q],b+d*u/2),p=n.clone(),n.rotate(c),m="right"===A?Math.min((h+this._edgeBleed.left)/x,w):Math.min((this.rect.width-h+this._edgeBleed.right)/x,w),m-=2*u,z.push({type:"text",fill:this._style.label.color,opacity:a.opacities[q],transform:n.elements,shape:{text:s[q]||"",font:this._style.label.font,maxWidth:m,align:A,baseline:r}}),o(this._cacheItems,this.isDiscrete(),a.indecies,q)&&f&&(i="left"===A?0:-Math.abs(v),j=this._fontHeight/2,k=[{x:i,y:-j},{x:i+v,y:-j},{x:i+v,y:j},{x:i,y:j}],p.multiply(y),l=new g(p.transformPoints(k)),this._cacheItems[a.indecies[q]].addShape(this.selectionIdentifier,l)));return z}function k(a,b,c,e){var g,h,i,j,k,l="near"===this.getAlignment()?"bottom":"top",m="center",n=a.labels,p=a.positions,q=a.opacities,s=a.labelMode,t=this._style,u=a.widths,v=[];for(g=0;g<n.length;g++)h=p[g],-.5>h||h>this.rect.width+.5||(this.isDiscrete()||0!==g&&g!==n.length-1?!this.isDiscrete()||s!==r||0!==g&&g!==n.length-1?m="center":(i=d.measureTextObject({type:"text",shape:{text:n[g]||"",x:h,y:b,maxWidth:u[g]-4,font:this._style.label.font,align:m,baseline:l}}).width,0===g&&i/2>h?h+=i/2-h:g===n.length-1&&i/2>this._plotSize-h&&(h-=i/2-(this._plotSize-h))):(i=d.measureTextObject({type:"text",shape:{text:n[g]||"",x:h,y:b+(s===r?0:1.5*this._fontHeight*(g%2)*c),maxWidth:u[g]-4,font:this._style.label.font,align:m,baseline:l}}).width,0===g&&i/2>h?h+=i/2-h:g===n.length-1&&i/2>this._plotSize-h+this._padding.left&&(h-=i/2-(this._plotSize-h+this._padding.left))),k=b+(s===r?0:1.5*this._fontHeight*(g%2)*c),o(this._cacheItems,this.isDiscrete(),a.indecies,g)&&e&&(j=new f(h-(u[g]-4)/2,k-("bottom"===l?this._fontHeight*t.label.lineHeight:0),u[g]-4,this._fontHeight*t.label.lineHeight),this._cacheItems[a.indecies[g]].addShape(this.selectionIdentifier,j)),v.push({type:"text",fill:this._style.label.color,opacity:q?q[g]:1,shape:{text:n[g]||"",x:h,y:k,maxWidth:u[g]-4,font:this._style.label.font,align:m,baseline:l}}));
return v}function l(a,b,c,d){var e,g,h,i,j,k=a.labels,l=a.positions,m=a.opacities,n=a.labelSpace,p=[],q=this._style;for(e=this._renderer.getFontHeight(q.label.font),i=l.length>1?Math.abs(l[0]-l[1]):this.rect.height,this.isDiscrete()||(i=0),h=0;h<k.length;h++)g=l[h],g=Math.max(e/2,Math.min(this._padding.top+this._plotSize-e/2,g)),0>g-.5||g+.5>this.rect.height||(o(this._cacheItems,this.isDiscrete(),a.indecies,h)&&d&&(j=new f(b-("right"===c?n:0),g-i/2,n,i),this._cacheItems[a.indecies[h]].addShape(this.selectionIdentifier,j)),p.push({type:"text",fill:q.label.color,opacity:m?m[h]:1,shape:{text:k[h],x:b,y:g-i/2,maxWidth:n,height:i,maxNumLines:1,font:q.label.font,align:c,baseline:"middle"}}));return p}function m(a){var b,c,d,f,g=a[0]?a[0].positions:[],h=a[0]?a[0].opacities:[],i=this._style,j=this.isDiscrete()?0:i.tick.length,k=1,m=new e,n="far"===this.getAlignment()?"left":"right",o=[];if(d="left"===n?1:-1,j=d*j,b=d>0?0:this.rect.width,c=0,b+=d*k/2,c+=this._padding.top,!this.isDiscrete()&&this._showLabels_internal){if(this._showLabels_internal)for(f=0;f<g.length;f++)o.push({stroke:i.tick.color,opacity:h[f],shape:{x1:b,x2:b+j,y1:g[f],y2:g[f]},type:"line"});this._showLine_internal&&o.push({stroke:i.line.color,shape:{x1:b,x2:b,y1:c-1,y2:c+this._plotSize},type:"line"}),b+=i.tick.length*d}if(this._showLabels_internal){for(b+=i.label.margin*d,a.reverse(),f=0;f<a.length;f++)a[f].labelMode!==q&&(o=o.concat(l.apply(this,[a[f],b,n,0===f])),b+=a[f].labelSpace*d);a.reverse()}this._showTitle_internal&&(m=new e,m.translate((d>0?b:0)+(d>0?this.rect.width-b:b)/2,this._padding.top+this._plotSize/2),m.rotate(.5*Math.PI*("right"===n?-1:1)),o.push({type:"text",fill:i.title.color,transform:m.elements,shape:{text:this._title||"",maxWidth:this._plotSize,font:i.title.font,align:"center",baseline:"middle"}})),this._renderer.shapes=o,this._renderer.render()}function n(a){var b,c,d,e=a[0]?a[0].positions:[],f=a[0]?a[0].opacities:[],g=this._style.tick.length,h=1,i="far"===this.getAlignment()?1:-1,l=[];if(g*=i,b=this._padding.left||0,c="near"===this.getAlignment()?this.rect.height-1:0,c+=h/2*i,!this.isDiscrete()&&this._showLabels_internal){for(this._showLine_internal&&l.push({stroke:this._style.line.color,shape:{x1:b-1,x2:b+this._plotSize,y1:c,y2:c},type:"line"}),c+=h*i/2,d=0;d<e.length;d++)l.push({stroke:this._style.tick.color,opacity:f[d],shape:{x1:e[d],x2:e[d],y1:c,y2:c+g},type:"line"});c+=g}if(this._showLabels_internal)for(c+=this._style.label.margin*i,d=0;d<a.length;d++)a[d].labelMode!==q&&(l=l.concat(a[d].labelMode===s?j.apply(this,[a[d],c,a[d].radians,i,d===a.length-1]):k.apply(this,[a[d],c,i,d===a.length-1])),a[d].labelSpace&&(c+=a[d].labelSpace*i));this._showTitle_internal&&l.push({type:"text",fill:this._style.title.color,shape:{x:b,y:i>0?c:0,width:this._plotSize,height:i>0?this.rect.height-c:c,text:this._title||"",font:this._style.title.font,align:"center",baseline:"middle"}}),this._renderer.shapes=l,this._renderer.render()}function o(a,b,c,d){return b&&a&&c&&a[c[d]]}var p,q=0,r=1,s=3;return p=b.extend("Axis",{init:function(b,c,e){this._super.apply(this,[b,a.extend(!0,{},{components:{title:{show:!0,showFlag:c.showFlag},labels:{show:!1,showFlag:c.showFlag}}},c),e]),this._fontHeight=20,this._titleShowFlag=c.titleShowFlag||null,this._showLabels=!0,this._showLabels_internal=!0,this._showLine=!0,this._showLine_internal=!0,this._showTitle=!1,this._dataIndex=0,this._radial=!1,this._relevantAngle=0,this._cacheItems=null,this._styleService=h.getInstance(),this._style=this._getStyleObject(this._styleService),this._padding={top:0,bottom:0,left:0,right:0},this._renderer=new d(this.container),this._$renderAreaWrap&&this._$renderAreaWrap.addClass("qv-chart-component-axis"),this.innerRect=new f(0,0,0,0),this.renderers={axis:this._renderer}},getLabels:function(){return[]},setSelectableShapes:function(a){this._cacheItems=a},calculateValuePositionMappingInfo:function(){},_calculatePlotSize:function(a){var b,c,d=0;this.isRadial()?(b=Math.min(a.height,a.width),c=.4*b,this._relevantAngle=this._radialOptions.end-this._radialOptions.start,d=Math.tan(-this._relevantAngle/4+Math.PI/2)*b*.02,this._radius=c+d,this._centerPoint={x:a.width/2,y:a.height/2+4*d}):b=this.isVertical()?a.height-this._padding.top-this._padding.bottom:a.width-this._padding.left-this._padding.right,this._plotSize=0===this._plotSize&&0!==b?b:b},_calculateEdgeBleedAndPlotSize:function(a){this._edgeBleed={top:this.isVertical()?1:0,bottom:this.isVertical()?1:0,left:this.isVertical()?1:Math.max(a.x,1),right:this.isVertical()?0:Math.max(0,this.outerRect.width-a.width-a.x)},this._calculatePlotSize(a)},preRelevantSizeCalculation:function(){this._isSizing=!0,this.updateNow(["properties"]),this._isVertical=this.isVertical(),this._style=this._getStyleObject(this._styleService,this._layoutMode,this.isDiscrete()),this._fontHeight=Math.ceil(this._renderer.getFontHeight(this._style.label.font));var a=this._isVertical;this._showTitle_internal=b.prototype.isVisible.call({show:this._showTitle&&!!this._title,_verticalLayoutMode:this._verticalLayoutMode,_horizontalLayoutMode:this._horizontalLayoutMode,isVertical:function(){return a},showFlag:null!==this._titleShowFlag?this._titleShowFlag:this.showFlag<<1},this._layoutMode),this._showTitle_internal&&(this._titleFontHeight=this._renderer.getFontHeight(this._style.title.font),this.relevantSize+=this._titleFontHeight*this._style.title.lineHeight)},calculatePreliminaryRelevantSize:function(a,b){var c,d=0,e=0,f=a[this.isVertical()?"height":"width"];this._isSizing=!0,this.relevantSize=0,this.preliminaryRelevantSize=0,this._preliminaryStatics=0,0>=f||(c=this.calculatePreliminaryLabelSpace(a,b),d=c.relevantLabelSize||0,e=c.relevantSpacing||0,this.isDiscrete()||(this._preliminaryStatics+=this._style.tick.length),d&&(this.preliminaryRelevantSize+=d,this.preliminaryRelevantSize+=this._style.label.margin),this._showTitle_internal&&(this._preliminaryStatics+=this._titleFontHeight*this._style.title.lineHeight),this.preliminaryRelevantSize+=this._preliminaryStatics,this.preliminaryRelevantSize=Math.ceil(this.preliminaryRelevantSize),this.perpendicularlyRelevantSpacing={top:0,left:"far"===this.getAlignment()?e:0,right:"near"===this.getAlignment()?e:0,bottom:0},this.relevantSize=this.preliminaryRelevantSize)},calculateRelevantSize:function(a,b,c){this._isSizing=!0,this._isVertical=this.isVertical(),this.relevantSize=0;var d=c?c:a,e=0,f=0;if(this.rect.set(d.x,d.y,d.width,d.height),this._calculationSize=d[this.isVertical()?"height":"width"],this._plotSize=this._calculationSize,0!==d.width){var g=this.calculateLabelSpace(a,b,c);return e=g.relevantLabelSize||0,f=g.relevantSpacing||0,e&&(this.relevantSize+=e,this.relevantSize+=this._style.label.margin),this.relevantSize+=this._preliminaryStatics,this.relevantSize=Math.ceil(this.relevantSize),this.perpendicularlyRelevantSpacing={top:0,left:"far"===this.getAlignment()?f:0,right:"near"===this.getAlignment()?f:0,bottom:0},this._isSizing=!1,this}},insertAdjacentTo:function(a,b){if(this._super(a,b),!this.isDiscrete())switch(this.dock){case"top":this.rect.y+=1;break;case"bottom":this.rect.y-=1}},_getStyleObject:function(a,b,c){var d="",e=a.layoutMap[b]||"medium",f=c?".discrete":"";return{backgroundColor:a.getValue(d,null,"backgroundColor"),label:{lineHeight:1.4,color:a.getValue(d,"axis.label","color"),margin:a.getValue(d,"axis.label","margin"),offset:1,font:a.getFont(d,"axis.label"+f,e)},tick:{color:a.getValue(d,"axis.tick","color"),length:a.getValue(d,"axis.tick","length")},line:{color:a.getValue(d,"axis.line","color")},title:{lineHeight:1.4,font:a.getFont(d,"axis.title",e),color:a.getValue(d,"axis.title","color")}}},isVisible:function(){return this._super.apply(this,[].slice.call(arguments))&&this._showSubcomponents},setShowLabels:function(a){this._showLabels_internal=a,this._showLabels=a},getShowLabels:function(){return this._showLabels},getSpacingMode:function(){return void 0},setShowLine:function(a){this._showLine_internal=a,this._showLine=a},getShowLine:function(){return this._showLine},setShowStrategy:function(a){this._showSubcomponents="none"!==a,this._showTitle=["all","title"].contains(a),this._showTitle_internal=this._showTitle,this.components.title.show=this._showSubcomponents&&["all","title"].contains(a),this._showLabels=["all","labels"].contains(a),this._showLabels_internal=this._showLabels,this.components.labels.show=this._showSubcomponents&&["all","labels"].contains(a)},getShowStrategy:function(){return this._showSubcomponents},setTitle:function(a){this._title=a},setLabelMode:function(a){this._explicitLabelMode=a},setCurrentDataIndices:function(a){this._currentDataIndices=Array.isArray(a)?a:[a]},setDataIndices:function(a){this._dataIndices=Array.isArray(a)?a:[a]},setDataRange:function(){},setOffset:function(){},setInnerOffset:function(){},getInnerOffset:function(){},getNumDiscreteUnits:function(){},setNumDiscreteUnits:function(){},getNumDiscreteUnitsInView:function(){},setMaxDiscreteUnitSize:function(){},setMinDiscreteUnitSize:function(){},setUnitAlignment:function(){},_updateProperties:function(){var a=this.getType().indices;return this._formatter=1===a.length&&this.measureFormatters.length?this.measureFormatters[a[0]]:this.combinedMeasuresFormatter||this._defaultFormatter,this.container.setAttribute("data-type",this.isDiscrete()?"discrete":"continuous"),this},updateSize:function(){this._super(),this._calculateEdgeBleedAndPlotSize(this.rect),this._renderer.edgeBleed=this._edgeBleed,this.innerRect=new f(this.rect.x+this._padding.left,this.rect.y+this._padding.top,this.rect.width-this._padding.left-this._padding.right,this.rect.height-this._padding.top-this._padding.bottom),this._isVertical=this.isVertical()},paint:function(){return i.apply(this,[]),this.fire("rendered"),this},isDiscrete:function(){return!1},getPositionOfValue:function(){},getAngleOfValue:function(){},getValueOfPosition:function(){},getType:function(){return{type:this.isDiscrete()?"dimension":"measure",indices:this._dataIndices||[0],current:this._currentDataIndices||[0]}},setPadding:function(a,b,c,d){this._padding={top:a>0?a:0,right:b>0?b:0,bottom:c>0?c:0,left:d>0?d:0}},getPadding:function(){return this._padding},isVertical:function(){var a=this.options.dock;switch(a){case"left":case"right":return!0;case"center":return"vertical"===this._orientation;default:return!1}},setOrientation:function(a){this._orientation=a},setAlignment:function(a){this._align=a},getAlignment:function(){var a=this.options.dock;switch(a){case"left":case"top":return"near";case"center":return this._align;default:return"far"}},setRadial:function(a,b){this._radial=a,this._radialOptions=b},isRadial:function(){return this._radial}})}),define("objects.views/charts/components/axis/discrete-axis",["./axis","objects.utils/shapes/rect"],function(a,b){function c(a){var b=this._cacheItems;return b&&a&&a.some(function(a){return b[a]&&b[a].selected})?1:this._globalAlpha}function d(a,b,d,e){var f,g,h=this.isHorizontal(),i=[],j=[],k=[],l=[],m=[];for(f=0;f<a.length;f+=1)g={center:this.getPositionOfValue(f,b),width:this.getWidthOfValue(f,b)},g.width>=2*this._discreteSpacing&&(g.center-this._discreteSpacing+g.width/2<0||g.center+this._discreteSpacing-g.width/2>e)||g.width<2*this._discreteSpacing&&(g.center<0||g.center>e)||(i.push(h&&g.center+g.width/2>e?Math.min(e,e-(g.center-g.width/2)):h&&g.center-g.width/2<0?Math.min(e,g.width/2+g.center):Math.min(e,g.width)),j.push(g.width>this._discreteSpacing?Math.max(1,Math.min(g.center,e-1)):g.center),k.push(a[f].label),l.push(a[f].cacheIndex?a[f].cacheIndex[0]:0),m.push(d?c.apply(this,[a[f].cacheIndex]):1));return{labels:k,widths:i,positions:j,indecies:l,opacities:m}}function e(a){var b=a.match(/[\u4E00-\u9FFF]/g);return b=b?b.length:0,{latin:a.length-b,cjk:b}}function f(a,b,c,d,g,h){if(!a||!a.length)return[];var i,j,k,l,m,n,o=[];for(i=0;i<a.length;i++)j=a[i],k={},l="",m=null,"object"==typeof j?(l=j.label,m=j.children?f(j.children,b,c+1,k,g,h):null,k.cacheIndex="cacheIndex"in a[i]?a[i].cacheIndex:[],k.group=j.group===!0,j.id&&(h[j.id]=k)):l=j,k.label=l||"",k.parent=d,n=e(k.label),m&&m.length&&(k.children=m),o.push(k),b[c]||(b[c]={data:[]},b[c].show=!(g&&g[c]&&g[c].show===!1||b[c].silo),b[c].qApprMaxGlyphCount=g&&g[c]&&g[c].qApprMaxGlyphCount||10,b[c].characterRatios={latin:0,cjk:0}),b[c].data.push(k),b[c].characterRatios.latin+=n.latin,b[c].characterRatios.cjk+=n.cjk;return o}function g(a){for(var b=a.parent,c=[];b;)b.collapseChildren||c.push(b),b=b.parent;return c}function h(a,b){var c,d,e,f,h,i,j,k,l=a[a.length-1].data;for(l[0].distanceFrom=b/2,l[0].distanceTo=l[0].distanceFrom+1,c=g(l[0]),j=c.filter(function(a){return a.group})[0],f=1;f<l.length;f++){if(i=l[f-1].distanceTo,d=g(l[f]),k=d.filter(function(a){return a.group})[0],k!==j){for(h=0;h<d.length&&(d[h]!==c[h]||!(d[h]<0||d[h].group));h++);i+=b*h,j=k,c=d}l[f].distanceFrom=i,l[f].distanceTo=l[f].distanceFrom+1}if(a.length>1)for(f=a.length-2;f>=0;f--)for(e=a[f].data,h=0;h<e.length;h++)e[h].distanceFrom=e[h].children[0].distanceFrom,e[h].distanceTo=e[h].children[e[h].children.length-1].distanceTo}function i(a,b,c,d){var e=b.getTextWidth("",c),f=24>=a?b.getTextWidth("m",c):b.getAverageLetterWidth(c);return d?a*(e*d.cjk+f*d.latin):a*f}var j,k=0,l=1,m=3;return j=a.extend("DiscreteAxis",{init:function(){this._super.apply(this,[].slice.call(arguments)),this._unitsOffset=0,this._innerOffset=0,this._shrinkToFitThreshold=arguments[1]&&null!==arguments[1].shrinkToFitThreshold?arguments[1].shrinkToFitThreshold:.85,this._maxDiscreteUnitSize=null,this._minDiscreteUnitSize=null,this._alignmentOffset=0,this._unitAlignment="center"},updateSize:function(){this._super(),1===this._numDiscrete?this._discreteSpacing=Math.min(this._discreteSpacing,this._plotSize/this._numDiscrete):this._discreteSpacing-=(this._preliminarySize-this._plotSize)/(this._numUnitsInView||1),this._alignmentOffset=this._getAlignmentOffset(this._unitAlignment,this._plotSize),this.extendedRect=new b(this.rect.x-this._edgeBleed.left,this.rect.y-this._edgeBleed.top,this.rect.width+this._edgeBleed.left+this._edgeBleed.right,this.rect.height+this._edgeBleed.top+this._edgeBleed.bottom)},updateLevels:function(){var a=this._oldLevels;this._levels.forEach(function(b,c){b.labelSpace=a[c].labelSpace,b.labelMode=a[c].labelMode,b.radians=a[c].radians})},_getPerpendicularExtensionForTiltedLabels:function(a,b,c,d){var e,f=-40*Math.PI/180,g=Math.abs(Math.sin(f))*a.longestLabelWidth,h=0;return g=Math.min(d,g),e=Math.abs(Math.cos(f))*g,e=Math.max(e-this._discreteSpacing/2,0),"bottom"===this.dock?(e=Math.max(e-this._alignmentOffset,0),e>b.x&&(h=e-b.x)):"top"===this.dock&&(e=Math.max(e-("center"===this._unitAlignment?this._alignmentOffset:this._getAlignmentOffset("far"===this._unitAlignment?"near":"far")),0),e>c.width-b.x-b.width&&(h=e-(c.width-c.x-b.x-b.width))),h},_getLabelMode:function(a,b,c){var d,e=a.qApprMaxGlyphCount;return this._showLabels&&"none"!==this._explicitLabelMode?this._explicitLabelMode&&"auto"!==this._explicitLabelMode?"none"===this._explicitLabelMode?k:"tilted"===this._explicitLabelMode?m:l:b&&this.isHorizontal()&&a.data&&a.data.length&&(d=i(e,this._renderer,this._style.label.font,a.characterRatios),this._groupSize&&(c*=this._groupSize),d>c)?m:l:k},preRelevantSizeCalculation:function(){this._super();var a,b=this._levels?this._levels.filter(function(a){return a.show!==!1}):[],c=b.length,d=this.outerRect[this.isVertical()?"width":"height"]/4,e=0,f=0;if(this.isVisible()){for(a=0;c>a;a++)b[a].longestLabelWidth=i(b[a].qApprMaxGlyphCount,this._renderer,this._style.label.font,b[a].characterRatios),e+=b[a].longestLabelWidth;for(a=0;c>a;a++)b[a].labelSizeRatio=Math.min(1/c,b[a].longestLabelWidth/Math.min(e,d)),f+=b[a].labelSizeRatio;1>f&&c>1?b[0].labelSizeRatio===1/c?b[0].labelSizeRatio+=1-f:b[1].labelSizeRatio===1/c&&(b[1].labelSizeRatio+=1-f):1===c&&(b[0].labelSizeRatio=1)}},calculatePreliminaryLabelSpace:function(a,b){var c,d=this._levels?this._levels.filter(function(a){return a.show!==!1}):[],e=d.length,f=this.outerRect[this._isVertical?"width":"height"]/4,g=this._fontHeight*this._style.label.lineHeight,h=0,i=0;if(this._preliminarySize=a[this._isVertical?"height":"width"],this._calculateDiscreteUnits(this._preliminarySize),this.isVisible())for(c=0;e>c;c++){d[c].labelMode=this._getLabelMode(d[c],c===d.length-1,this._discreteSpacing);var j=0;switch(d[c].labelMode){case l:d[c].labelSpace=this.isHorizontal()?g:d[c].longestLabelWidth,d[c].labelSpace=Math.min(d[c].labelSizeRatio*f,d[c].labelSpace);break;case m:d[c].radians=-40*Math.PI/180,j=this._getPerpendicularExtensionForTiltedLabels(d[c],a,b,f*d[c].labelSizeRatio),j>a.width/5&&(d[c].radians=-90*Math.PI/180),d[c].labelSpace=Math.abs(Math.sin(d[c].radians))*d[c].longestLabelWidth+Math.abs(this._fontHeight*Math.sin(d[c].radians)*2),d[c].labelSpace=Math.min(d[c].labelSizeRatio*f+Math.abs(this._fontHeight*Math.sin(d[c].radians)/2),d[c].labelSpace);break;default:d[c].labelSpace=0}d[c].labelMode===m&&(h=Math.max(h,Math.min(a.width/3,Math.ceil(Math.cos(d[c].radians)*d[c].labelSpace))),h=Math.max(h-this._discreteSpacing/2,0),"bottom"===this.dock?h=Math.max(h-this._alignmentOffset,0):"top"===this.dock&&(h=Math.max(h-("center"===this._unitAlignment?this._alignmentOffset:this._getAlignmentOffset("far"===this._unitAlignment?"near":"far")),0)),h=Math.ceil(h)),i+=d[c].labelSpace}return h>0&&("bottom"===this.dock&&h>a.x?this._preliminarySize=this._preliminarySize-(h-a.x):"top"===this.dock&&h>b.width-a.x-a.width&&(this._preliminarySize=this._preliminarySize-(h-(b.width-b.x-a.x-a.width))),this._calculateDiscreteUnits(this._preliminarySize)),this.fire("numDiscreteUnitsChanged"),this.fire("numDiscreteUnitsInViewChanged"),this._showLabels_internal=this._showLabels&&d&&d.some(function(a){return a.labelMode!==k}),this._preliminaryRelevantSize={relevantLabelSize:i,relevantSpacing:h},this._preliminaryRelevantSize},calculateLabelSpace:function(){return this.updateNow(["properties"]),this._preliminaryRelevantSize},setDataRange:function(a,b){var c,d,e,g;if(this._levels&&this._levels.length&&(this._oldLevels=this._levels.map(function(a){return{labelMode:a.labelMode,labelSpace:a.labelSpace,radians:a.radians}})),this._levels=[],this._labelIds={},f(a,this._levels,0,-1,b,this._labelIds),e=this._levels.length>1?1:0,this._levels&&this._levels.length){h(this._levels,e);for(var i=0;i<this._levels.length;i++)this._levels[i].characterRatios&&(g=this._levels[i].characterRatios.latin+this._levels[i].characterRatios.cjk||1,this._levels[i].characterRatios.latin=this._levels[i].characterRatios.latin/g,this._levels[i].characterRatios.cjk=this._levels[i].characterRatios.cjk/g);c=this._levels[this._levels.length-1].data,d=c[c.length-1].distanceTo+e/2,this._numDiscrete=c.length,this._numDiscrete=d||0,this._explicitNumDiscrete&&(this._numDiscrete=this._explicitNumDiscrete,this._numDiscrete=this._explicitNumDiscrete)}return this.invalidateProperties(),this.invalidateDisplay("setDataRange"),this},setOffset:function(a){return this._unitsOffset!==a?(this._unitsOffset=a,this.invalidateProperties(),this.invalidateDisplay("setOffset"),this.fire("changed"),this):void 0},getOffset:function(){return this._unitsOffset},setGroupSize:function(a){this._groupSize=a},setInnerOffset:function(a){this._innerOffset=a},getInnerOffset:function(){return this._innerOffset||0},getNumDiscreteUnits:function(){return this._numDiscrete},setNumDiscreteUnits:function(a){this._explicitNumDiscrete=a},getNumDiscreteUnitsInView:function(){return this._numUnitsInView},setMaxDiscreteUnitSize:function(a){this._maxDiscreteUnitSize=a},setMinDiscreteUnitSize:function(a){this._minDiscreteUnitSize=a},setUnitAlignment:function(a){this._unitAlignment=a},isDiscrete:function(){return!0},setLockedInfo:function(a){this._lockedInfo=a},getLabels:function(){var a,b,c=[];if(this._levels&&this._levels.length)for(b=0;b<this._levels.length;b++)this._levels[b].show&&(a=d.call(this,this._levels[b].data,b,b===this._levels.length-1,this._plotSize),a.labelMode=this._levels[b].labelMode,a.labelSpace=this._levels[b].labelSpace,a.radians=this._levels[b].radians,c.push(a));return c},calculateValuePositionMappingInfo:function(){this._calculateDiscreteUnits(this._plotSize)},getDiscreteSpacing:function(){return this._discreteSpacing},getPositionOfValue:function(a,b){var c,d,e=this._levels.length-1;"undefined"!=typeof b&&(e=Math.min(this._levels.length-1,Math.max(0,b))),c=this._levels[e].data,d=c[a];var f=d.distanceFrom+.5*(d.distanceTo-d.distanceFrom)+this._innerOffset-this._unitsOffset;return f*this._discreteSpacing+this._alignmentOffset},getWidthOfValue:function(a,b){var c,d=this._levels.length-1;return"undefined"!=typeof b&&(d=Math.min(this._levels.length-1,Math.max(0,b))),c=this._levels[d].data,(c[a].distanceTo-c[a].distanceFrom)*this._discreteSpacing},getPositionOfId:function(a){var b=this._labelIds[a]||this._labelIds[a.split(";").reverse().slice(-1).reverse().join(";")];if(!b)return 0;var c=b.distanceFrom+.5*(b.distanceTo-b.distanceFrom)+this._innerOffset-this._unitsOffset;return c*this._discreteSpacing+this._alignmentOffset},getWidthOfId:function(a){var b=this._labelIds[a]||this._labelIds[a.split(";").reverse().slice(-1).reverse().join(";")];return b?(b.distanceTo-b.distanceFrom)*this._discreteSpacing:0},getValueOfPosition:function(a){var b,c,d,e,f=this._levels[0].data,g=f.length;for(d=0;g>d;d+=1)if(e=f[d],b=(e.distanceFrom+this._innerOffset-this._unitsOffset)*this._discreteSpacing,c=b+(e.distanceTo-e.distanceFrom)*this._discreteSpacing,a>=b&&c>=a)return e.label;return""},_calculateDiscreteUnits:function(a){this._discreteSpacing=Math.max(null!==this._minDiscreteUnitSize?this._minDiscreteUnitSize:0,a/this._numDiscrete),null!==this._maxDiscreteUnitSize&&(this._discreteSpacing=Math.min(this._maxDiscreteUnitSize,this._discreteSpacing)),(1===this._numDiscrete||this._numDiscrete*this._discreteSpacing>a&&this._numDiscrete*this._discreteSpacing*this._shrinkToFitThreshold<a)&&(this._discreteSpacing=Math.min(this._discreteSpacing,a/this._numDiscrete)),this._alignmentOffset=this._getAlignmentOffset(this._unitAlignment,a),this._numUnitsInView=Math.min(this._numDiscrete,Number((a/this._discreteSpacing).toFixed(5)))},_getAlignmentOffset:function(a,b){var c=null!==this._maxDiscreteUnitSize&&this._discreteSpacing<b/this._numDiscrete?.5*(b-this._numDiscrete*this._discreteSpacing):0;return"near"===a?0:"far"===a?2*c:c}})}),define("objects.views/charts/utils/axis-utils",[],function(){function a(){var a,b,c,d;a=0===this.explicitPlotMax?1:y.getMagnitude(this.explicitPlotMax),b=this.explicitPlotMax,c=this.maxNumIntervals<2?b-a:b-2*a,c=Math.ceil(c/a)*a,d=b-c,this.tickDataSpacing=d/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(a/10,y.getNiceNumber(this.tickDataSpacing)),this.plotMax=b,this.plotMin=c,this.plotRange=d,this.maxNumIntervals<1&&(this.tickBaseValue=this.plotMin)}function b(){var a,b,c,d;a=0===this.explicitPlotMin?1:y.getMagnitude(this.explicitPlotMin),c=this.explicitPlotMin,b=this.maxNumIntervals<2?c+a:c+2*a,b=Math.floor(b/a)*a,d=b-c,this.tickDataSpacing=d/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(a/10,y.getNiceNumber(this.tickDataSpacing)),this.plotMax=b,this.plotMin=c,this.plotRange=d,this.maxNumIntervals<1&&(this.tickBaseValue=this.plotMax-this.tickDataSpacingNN)}function c(){null!==this.explicitPlotMax&&this.explicitPlotMax<this.usedDataMin?a.call(this):null!==this.explicitPlotMin&&this.explicitPlotMin>this.usedDataMax&&b.call(this)}function d(){this.plotMax=this.plotMin=this.tickBaseValue=this.usedDataMin,this.plotRange=0,this.tickDataSpacing=this.tickDataSpacingNN=0===this.usedDataMin?1:Math.abs(this.usedDataMin),this.tickMaxIndex=this.tickMinIndex=0}function e(){if(0===this.usedDataMax)this.maxNumIntervals<2?(this.plotMin=0,this.plotMax=1):(this.plotMin=-1,this.plotMax=1),this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacing=this.plotRange/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(.1,y.getNiceNumber(this.tickDataSpacing)),this.tickMinIndex=Math.ceil(this.plotMin/this.tickDataSpacingNN),this.tickMaxIndex=Math.floor(this.plotMax/this.tickDataSpacingNN);else{var a=h(Math.abs(this.usedDataMax),this.maxNumIntervals);this.usedDataMax>0?(this.plotMax=a.max,this.plotMin=a.min,this.tickBaseValue=a.tickBaseValue):(this.plotMax=-a.min,this.plotMin=-a.max,this.tickBaseValue=-a.tickBaseValue),this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacing=this.plotRange/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(a.magnitude/10,y.getNiceNumber(this.tickDataSpacing)),this.tickMinIndex=Math.floor((this.plotMin-this.tickBaseValue)/this.tickDataSpacingNN),this.tickMaxIndex=Math.floor((this.plotMax-this.tickBaseValue)/this.tickDataSpacingNN)}}function f(){0===this.explicitPlotMax?(this.plotMax=0,this.plotMin=-1,this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacingNN=Math.max(.1,y.getNiceNumber(this.plotRange/this.maxNumIntervals))):a.call(this)}function g(){0===this.explicitPlotMin?(this.plotMax=1,this.plotMin=0,this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacingNN=Math.max(.1,y.getNiceNumber(this.plotRange/this.maxNumIntervals))):b.call(this)}function h(a,b){var c,d,e=y.getMagnitude(a),f=a/e,g=Math.floor(f),h=Math.round(f),i=0;return 2>b?(c=g*e,d=(g+1)*e,1>b&&(i=c)):(c=(h-1)*e,d=(h+1)*e),{min:c,max:d,tickBaseValue:i,magnitude:e}}function i(){null!==this.explicitPlotMin&&null!==this.explicitPlotMax?d.call(this):null===this.explicitPlotMin&&null===this.explicitPlotMax?e.call(this):null===this.explicitPlotMin&&null!==this.explicitPlotMax?f.call(this):g.call(this)}function j(a,b,c){void 0===a&&(a=null!==this.explicitPlotMin),void 0===b&&(b=null!==this.explicitPlotMax),this.tickDataSpacingNN=c?y.getGoodNumber(this.tickDataSpacing):y.getNiceNumber(this.tickDataSpacing),u.apply(this,[a,b])}function k(){var a,b,c,d;if(j.call(this),a=this.tickMaxIndex-this.tickMinIndex,b=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=b/this.plotRange,d=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,d&&this.maxNumIntervals>=5){for(c=0;this.tickDataSpacing<=this.absMax&&d;)this.tickDataSpacing=1.1*this.tickDataSpacingNN,j.call(this),b=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=b/this.plotRange,d=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,c++;if(!d)return}for(this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,(d||2>=a&&this.maxNumIntervals>=2*a)&&j.apply(this,[void 0,void 0,!0]),b=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=b/this.plotRange,d=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,c=0;this.tickDataSpacing<=this.absMax&&d;)this.tickDataSpacing=1.1*this.tickDataSpacingNN,j.apply(this,[void 0,void 0,!0]),b=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=b/this.plotRange,d=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,c++}function l(a){a?(this.tickDataSpacingNN=y.getGoodNumber(this.absMax),this.tickBaseValue=-this.tickDataSpacingNN,this.plotMin=null===this.explicitPlotMin?-this.tickDataSpacingNN:this.explicitPlotMin,this.plotMax=null===this.explicitPlotMax?this.tickDataSpacingNN:this.explicitPlotMax,this.tickMinIndex=null===this.explicitPlotMin?0:1,this.tickMaxIndex=(null===this.explicitPlotMax,1),this.tickDataSpacingNN=2*this.tickDataSpacingNN):(this.plotMax=this.usedDataMax,this.plotMin=this.usedDataMin,this.plotRange=this.plotMax-this.plotMin,this.tickMinIndex=0,this.tickMaxIndex=0,this.tickDataSpacingNN=y.getNiceNumber(this.absMax),this.tickDataSpacingNN===this.absMax&&(this.tickDataSpacingNN=y.getNiceNumber(1.1*this.absMax)))}function m(){var a;this.tickDataSpacingNN=y.getNiceNumber(this.tickDataSpacing),this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,this.plotRange=this.plotMax-this.plotMin,this.tickMinIndex=0,this.tickMaxIndex=0,(this.usedDataMax<0||this.usedDataMin>0)&&(a=y.getSmallNiceNumber(this.plotRange),this.tickBaseValue=Math.ceil(this.plotMin/a)*a)}function n(){var a,b,c,d,e,f;for(c=this.usedDataMax>=-this.usedDataMin,a=c||null!==this.explicitPlotMin,b=!c||null!==this.explicitPlotMax,j.apply(this,[a,b,!0]),e=0,f=(this.absMax+(1-this.spaceUseLimit)*this.absMin)/this.spaceUseLimit*1.0001;this.tickDataSpacing<=f&&this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel;)this.tickDataSpacing=1.1*this.tickDataSpacingNN,j.apply(this,[a,b,!0]),e++;d=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=d/this.plotRange,this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit&&l.call(this)}function o(){k.call(this);var a=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin);this.spaceUseFactor=a/this.plotRange,this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit&&(this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,n.call(this))}function p(){var a,b,c,d,e,f,g,h,i,j=y.getNiceNumber(this.tickDataSpacingNN);this.tickDataSpacingNN!==j&&0===this.tickBaseValue&&(a=this.tickDataSpacingNN,d=this.tickMinIndex,e=this.tickMaxIndex,f=e-d,b=this.plotMin,c=this.plotMax,this.tickDataSpacingNN=j,u.apply(this,[null!==this.explicitPlotMin,null!==this.explicitPlotMax]),g=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=g/this.plotRange,h=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,i=this.tickMaxIndex-this.tickMinIndex,(h||!(i===f||i>=10||i>=3&&1.5*i>=f))&&(this.tickDataSpacingNN=a,this.tickMinIndex=d,this.tickMaxIndex=e,this.plotMin=b,this.plotMax=c,this.plotRange=this.plotMax-this.plotMin))}function q(){this.niceNumberEnabled&&this.plotMax!==this.plotMin&&0!==this.plotSize?(this.minTickValue=this.tickBaseValue+this.tickMinIndex*this.tickDataSpacingNN,this.maxTickValue=this.tickBaseValue+this.tickMaxIndex*this.tickDataSpacingNN):(this.minTickValue=this.plotMin,this.maxTickValue=this.plotMax)}function r(){var a,b,c;if(this.mainTickValues=[],this.secondaryTickValues=[],q.call(this),0!==this.plotSize)if(this.niceNumberEnabled){if(a=this.tickBaseValue,c=this.tickMaxIndex-this.tickMinIndex,!(c>100||1>c)){for(b=0;c>=b;b++)this.mainTickValues.push(a+(b+this.tickMinIndex)*this.tickDataSpacingNN);for(a=this.tickBaseValue+this.tickDataSpacingNN/2,b=0;c>b;b++)this.secondaryTickValues.push(a+(b+this.tickMinIndex)*this.tickDataSpacingNN)}}else{for(this.numIntervals=Math.floor(this.maxNumIntervals),this.tickDataSpacing=this.usedDataRange/this.numIntervals,a=this.usedDataMin,b=0;b<=this.numIntervals;b++)this.mainTickValues.push(a+b*this.tickDataSpacing);for(a=this.usedDataMin+this.tickDataSpacing/2,b=0;b<this.numIntervals;b++)this.secondaryTickValues.push(a+b*this.tickDataSpacing)}}function s(){var a,b,c,d,e,f=[.5];for(a=this.mainTickValues[0],e=0;e<f.length;e++)if(b=a-this.tickDataSpacingNN*f[e],c=this.plotMax-b,d=this.plotSize*this.tickDataSpacingNN/c,d>3*this.fontHeight)return this.plotMin=b,this.plotRange=c,void this.mainTickValues.splice(0,0,b)}function t(){var a,b,c,d,e,f=[.5];for(a=this.mainTickValues[this.mainTickValues.length-1],e=0;e<f.length;e++)if(b=a+this.tickDataSpacingNN*f[e],c=b-this.plotMin,d=this.plotSize*this.tickDataSpacingNN/c,d>3*this.fontHeight)return this.plotMax=b,this.plotRange=c,void this.mainTickValues.push(b)}function u(a,b){this.tickMinIndex=a?Math.ceil(this.usedDataMin/this.tickDataSpacingNN):Math.floor(this.usedDataMin/this.tickDataSpacingNN),this.tickMaxIndex=b?Math.floor(this.usedDataMax/this.tickDataSpacingNN):Math.ceil(this.usedDataMax/this.tickDataSpacingNN),this.plotMin=a?this.usedDataMin:this.tickMinIndex*this.tickDataSpacingNN,this.plotMax=b?this.usedDataMax:this.tickMaxIndex*this.tickDataSpacingNN,this.plotRange=this.plotMax-this.plotMin
}function v(){var a,b,c,d,e,f=this.plotMin,g=this.plotMax,h=this.tickMinIndex,i=this.tickMaxIndex,j=this.tickDataSpacingNN,k=this.tickMaxIndex-this.tickMinIndex,l=null!==this.explicitPlotMin,m=null!==this.explicitPlotMax,n=!0,o=2*this.fontHeight,p=k;if(d=this.mainTickValues?this.mainTickValues.length:0,b=this.mainTickValues[0],c=this.mainTickValues[d-1],null===this.explicitPlotMin&&b>this.dataMin&&p++,null===this.explicitPlotMax&&c<this.dataMax&&p++,p!==k){for(e=0;n&&10>e;)this.tickDataSpacingNN=y.getSmallNiceNumber(.99*this.tickDataSpacingNN),u.apply(this,[l,m]),a=this.tickMaxIndex-this.tickMinIndex,a>p&&(n=!1),e++;for(n=!0,e=0;this.tickDataSpacingNN<j&&n&&10>e;)this.tickDataSpacingNN=y.getGoodNumber(1.1*this.tickDataSpacingNN),u.apply(this,[l,m]),a=this.tickMaxIndex-this.tickMinIndex,a===p&&this.plotSize*this.tickDataSpacingNN/this.plotRange>o&&(n=!1),e++;n?(this.plotMin=f,this.plotMax=g,this.tickMinIndex=h,this.tickMaxIndex=i,this.tickDataSpacingNN=j):r.call(this)}}function w(){var a,b,c;c=this.mainTickValues?this.mainTickValues.length:0,a=this.mainTickValues[0],b=this.mainTickValues[c-1],null===this.explicitPlotMin&&a>this.dataMin&&null===this.explicitPlotMax&&b<this.dataMax?Math.abs(this.dataMin)<=Math.abs(this.dataMax)?(s.call(this),t.call(this)):(t.call(this),s.call(this)):null===this.explicitPlotMin&&a>this.dataMin?s.call(this):null===this.explicitPlotMax&&b<this.dataMax&&t.call(this)}function x(){return{plotMin:this.plotMin,plotMax:this.plotMax,tickSpacing:this.tickDataSpacingNN,tickBaseValue:this.tickBaseValue,tickMinIndex:this.tickMinIndex,tickMaxIndex:this.tickMaxIndex,minTickValue:this.minTickValue,maxTickValue:this.maxTickValue,mainTickValues:this.mainTickValues,secondaryTickValues:this.secondaryTickValues}}var y,z=Math.log(10),A=1e-12;return y={log:function(a,b){return 0>=a||0>=b?0/0:Math.log(a)/Math.log(b)},log10:function(a){return 0>=a?0/0:Math.log(a)/z},eliminateFloatingError:function(a){var b=Math.round(a);return Math.abs(a-b)<A&&(a=b),a},getNiceNumber:function(a){var b,c,d;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),c=a/Math.pow(10,b),d=1>=c?1:2>=c?2:5>=c?5:10,d*Math.pow(10,b)*(0>a?-1:1))},getSmallNiceNumber:function(a){var b,c,d;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),c=a/Math.pow(10,b),1>c?(d=5,b--):d=2>c?1:5>c?2:5,d*Math.pow(10,b)*(0>a?-1:1))},getMagnitude:function(a){var b;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),Math.pow(10,b))},getFraction:function(a){var b;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),a/Math.pow(10,b))},getGoodNumber:function(a){var b,c,d;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),c=a/Math.pow(10,b),d=Math.ceil(c),(7===d||9===d)&&d++,c>1&&1.5>=c?d=1.5:c>2&&2.5>=c&&(d=2.5),d*Math.pow(10,b)*(0>a?-1:1))},calculateTicks:function(a,b,d,e,f,g,h,j,q,s,t){var u,y=!1;return void 0===t&&(t=!1),isNaN(e)&&(e=null),isNaN(f)&&(f=null),b>d&&(u=b,b=d,d=u),null!==e&&null!==f&&e>f&&(u=e,e=f,f=u),this.plotSize=a,this.dataMin=b,this.dataMax=d,this.explicitPlotMin=e,this.explicitPlotMax=f,this.minTickSpacingInPixel=g,this.usedDataMin=null===this.explicitPlotMin?this.dataMin:this.explicitPlotMin,this.usedDataMax=null===this.explicitPlotMax?this.dataMax:this.explicitPlotMax,this.absMax=Math.max(Math.abs(this.usedDataMax),Math.abs(this.usedDataMin)),this.absMin=Math.min(Math.abs(this.usedDataMax),Math.abs(this.usedDataMin)),this.usedDataRange=this.usedDataMax-this.usedDataMin,this.maxNumIntervals=this.plotSize/this.minTickSpacingInPixel,this.maxNumTicks=this.maxNumIntervals+1,this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,this.fontHeight=h,this.niceNumberEnabled=j,this.tickBaseValue=0,this.spaceUseLimit=void 0===s?.6:s,this.spaceOptimizingEnabled=q,this.plotMaxCanBeTuned=null===this.explicitPlotMax&&this.usedDataMax>0,this.plotMinCanBeTuned=null===this.explicitPlotMin&&this.usedDataMin<0,j&&0!==a?(null!==this.explicitPlotMax&&this.explicitPlotMax<this.usedDataMin||null!==this.explicitPlotMin&&this.explicitPlotMin>this.usedDataMax?(y=!0,c.call(this)):0===this.usedDataRange?i.call(this):this.maxNumIntervals<1?m.call(this):(this.usedDataMax>0&&this.usedDataMin<0?1===this.maxNumIntervals?l.call(this,!0):this.maxNumIntervals>=5?k.call(this):this.maxNumIntervals<2?n.call(this):o.call(this):k.call(this),this.tickMaxIndex<this.tickMinIndex?(this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,m.call(this)):p.call(this)),r.call(this),t&&this.maxNumIntervals>=1&&!y&&(v.call(this),w.call(this)),x.call(this)):(this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,this.tickDataSpacingNN=this.tickDataSpacing,r.call(this),x.call(this))}}}),define("objects.views/charts/components/axis/linear-scale",["core.utils/class","../../utils/axis-utils"],function(a,b){var c=a.extend("LinearScale",{init:function(){this.plotMin=null,this.plotMax=null,this.plotRange=null,this.tickMin=this.plotMin,this.tickMax=this.plotMax,this.mainValues=[],this.secondaryValues=[],this._plotSize=0,this._calculationSize=0},setSize:function(a){this._plotSize=a},getPositionOfValue:function(a){return(a-this.plotMin)/this.plotRange*this._plotSize},getValueOfPosition:function(a){return this.plotMin+this.plotRange*a/this._plotSize},calculateLimits:function(){this._usedDataMin=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,this._usedDataMax=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,this.plotMin=null===this._explicitPlotMin||isNaN(this._explicitPlotMin)?this._usedDataMin:this._explicitPlotMin,this.plotMax=null===this._explicitPlotMax||isNaN(this._explicitPlotMax)?this._usedDataMax:this._explicitPlotMax,this.plotRange=this.plotMax-this.plotMin},calculateTicks:function(){var a,c,d,e,f;d=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,c=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,a=b.calculateTicks(this._calculationSize,d,c,this._explicitPlotMin,this._explicitPlotMax,this._minTickSpacingInPixel,this._fontHeight,this._niceNumberEnabled,this._whiteSpaceOptimizingEnabled,.6,this._showExplicitMinMax),this._tickSpacing=a.tickSpacing,this.plotMin=a.plotMin,this.plotMax=a.plotMax,this.plotRange=this.plotMax-this.plotMin,this.tickMin=a.tickMinValue,this.tickMax=a.tickMaxValue,this.mainValues=a.mainTickValues,this.secondaryValues=a.secondaryTickValues,0===this._tickSpacing&&(this._tickSpacing=1),this._showExplicitMinMax&&(f=this.mainValues[0],this.mainValues[0]=a.plotMin,f-a.plotMin>=a.tickSpacing/2&&this.mainValues.splice(1,0,f),e=a.mainTickValues[a.mainTickValues.length-1],a.plotMax-e<=a.tickSpacing/2?this.mainValues[a.mainTickValues.length-1]=a.plotMax:this.mainValues.push(a.plotMax))},getValues:function(){return{mainValues:this.mainValues,secondaryValues:this.secondaryValues}}});return c}),define("objects.views/charts/utils/axis-log-utils",["objects.views/charts/utils/axis-utils"],function(a){function b(a,b,c){var d,e=a?a.length:0,f=void 0===b?Number.MAX_VALUE:a[0]/b;for(d=1;e>d;d++)f=Math.min(f,a[d]/a[d-1]);void 0!==c&&(f=Math.min(f,c/a[e-1])),a.splice(0,0,f)}function c(a,c,d){var e,f=a?a.length:0;for(e=0;f>e;e++)b(a[e],c,d)}function d(){var a,b;for(c(E,1,10),a=0;a<F.length;a++)if(F[a])for(b=0;b<F[a].length;b++)F[a][b]instanceof Array&&c(F[a][b])}function e(){var a,b,c,d,e,f,g,h=!0,i=0;for(a=this.tickDataSpacingLog,g=0;h&&5>i;)a=Math.ceil(0===i?this.tickDataSpacingLog:1.01*a),b=this.minIsStrict?Math.ceil(this.usedDataMinLog/a):Math.floor(this.usedDataMinLog/a),c=this.maxIsStrict?Math.floor(this.usedDataMaxLog/a):Math.ceil(this.usedDataMaxLog/a),d=this.minIsStrict?this.explicitPlotMinLog:b*a,e=this.maxIsStrict?this.explicitPlotMaxLog:c*a,f=e-d,h=a/f*this.plotSize<this.minTickSpacingInPixel,i++;return h&&(a=Math.ceil(this.tickDataSpacingLog),b=this.minIsStrict?Math.ceil(this.usedDataMinLog/a):Math.floor(this.usedDataMinLog/a),c=this.maxIsStrict?Math.floor(this.usedDataMaxLog/a):Math.ceil(this.usedDataMaxLog/a),d=this.minIsStrict?this.explicitPlotMinLog:b*a,e=this.maxIsStrict?this.explicitPlotMaxLog:c*a),{plotMinLog:d,plotMaxLog:e,tickMinIndex:b,tickMaxIndex:c,tickDataSpacingNNLog:a,tickBaseValueLog:g,success:!h}}function f(){var a,b,c,d,e,f,g,h=!0,i=0;for(a=this.tickDataSpacingLog,b=0,g=this.usedDataMinLogFloor;h&&5>i;)a=Math.ceil(0===i?this.tickDataSpacingLog:1.01*a),b=this.minIsStrict?Math.ceil((this.usedDataMinLog-g)/a):Math.floor((this.usedDataMinLog-g)/a),c=this.maxIsStrict?Math.floor((this.usedDataMaxLog-g)/a):Math.ceil((this.usedDataMaxLog-g)/a),d=this.minIsStrict?this.explicitPlotMinLog:b*a+g,e=this.maxIsStrict?this.explicitPlotMaxLog:c*a+g,f=e-d,h=a/f*this.plotSize<this.minTickSpacingInPixel,i++;return h&&(a=Math.ceil(0===i?this.tickDataSpacingLog:1.01*a),b=this.minIsStrict?Math.ceil((this.usedDataMinLog-g)/a):Math.floor((this.usedDataMinLog-g)/a),c=this.maxIsStrict?Math.floor((this.usedDataMaxLog-g)/a):Math.ceil((this.usedDataMaxLog-g)/a),d=this.minIsStrict?this.explicitPlotMinLog:b*a+g,e=this.maxIsStrict?this.explicitPlotMaxLog:c*a+g),{plotMinLog:d,plotMaxLog:e,tickMinIndex:b,tickMaxIndex:c,tickDataSpacingNNLog:a,tickBaseValueLog:g,success:!h}}function g(){var a,b,c,d,g,h,i;return b=f.call(this),b.success?(c=this.usedDataMaxLog-this.usedDataMinLog,g=c/(b.plotMaxLog-b.plotMinLog),1===g?b:(a=e.call(this),a.success?(d=c/(a.plotMaxLog-a.plotMinLog),h=a.tickMaxIndex-a.tickMinIndex,i=b.tickMaxIndex-b.tickMinIndex,i>h||i===h&&g>d||i===h&&g===d&&b.plotMinLog<a.plotMinLog?b:a):b)):a=e.call(this)}function h(b,c,d,e,f){var g=a.getNiceNumber(1.1*f),h=b?Math.ceil(d/g):Math.floor(d/g),i=c?Math.floor(e/g):Math.ceil(e/g),j=b||0===h?d:h*g,k=c?e:i*g;return{plotMin:j,plotMax:k,tickSpacing:g,tickBaseValue:0}}function i(a,b){var c;for(c=0;c<a.length;c++)if(a[c]>=b)return c-1}function j(a,b){var c;for(c=a.length-1;c>=0;c--)if(a[c]<=b)return c+1}function k(a,b,c,d,e){var f,g;f=i(a,b),g=j(a,c),!d&&void 0!==a[f+1]&&a[f+1]>b&&(f-=1),!e&&g>0&&void 0!==a[g-1]&&a[g-1]<c&&(g+=1),g<a.length&&a.splice(g,a.length-g),f>=0&&a.splice(0,f+1)}function l(b,c,d,e){var f,g,h,i,j=Number.MAX_VALUE,k=-Number.MAX_VALUE,l=a.log10(d),m=a.log10(c),n=l-m;for(g=b?b.length:0,h=new Array(g),(null===e||isNaN(e))&&(e=1.71),f=0;g>f;f++)h[f]=a.log10(b[f]);for(f=1;g>f;f++)i=h[f]-h[f-1],j=Math.min(j,i),k=Math.max(k,i);return k=Math.max(k,Math.abs(h[0]-m)),k=Math.max(k,Math.abs(l-h[g-1])),j/n*this.plotSize>=this.minTickSpacingInPixel-C&&e>=k/j&&b.length-1<=this.maxNumIntervals}function m(b){var c,d,e,f,g=Number.MAX_VALUE,h=-Number.MAX_VALUE,i=b.mainTickValues;for(d=i?i.length:0,e=new Array(d),c=0;d>c;c++)e[c]=a.log10(i[c]);for(c=1;d>c;c++)f=e[c]-e[c-1],g=Math.min(g,f),h=Math.max(h,f);b.maxTickSpacing=h,b.minTickSpacing=g,b.tickSpacingRatio=h/g,b.spaceUseFactor=this.usedDataRange/(b.plotMax-b.plotMin),b.factor=b.spaceUseFactor/(b.tickSpacingRatio*b.tickSpacingRatio)}function n(b,c,d,e,f){var g,h,i,j,k;return g=(e+d)/2,void 0===f?(h=Math.round(g),h>=d&&e>=h?Math.pow(10,h):(i=Math.floor(g),i>=d&&e>=i?Math.pow(10,i):(j=Math.ceil(g),j>=d&&e>=j?Math.pow(10,j):(k=a.getSmallNiceNumber(Math.max(1,c-b)),Math.ceil(b/k)*k)))):(i=Math.pow(10,Math.floor(g)),j=Math.pow(10,Math.ceil(g)),Math.abs(i-f)<Math.abs(j-f)?i:j)}function o(a,b,c,d,e,f){var g,h,i=e?Math.ceil((a-c)/d):Math.floor((a-c)/d),j=f?Math.floor((b-c)/d):Math.ceil((b-c)/d),k=[];for(g=i;j>=g;g++)h=g*d+c,h>0&&k.push(g*d+c);return k}function p(a,b,c,d){a.mainTickValues=b,a.plotMin=c,a.plotMax=d}function q(){return this.usedDataMax>=10*this.usedDataMin?1:this.usedDataMaxLogFloor===this.usedDataMinLogFloor?this.maxIsStrict&&this.minIsStrict?2:3:1}function r(a){a.sort(function(a,b){return a-b})}function s(a,b,c,d,e,f,g){var h,i,j,m,n,o,p,q=0,s=[];for(q=0;q<a.length;q++)if(b<=a[q][0]+C){for(n=c.concat(),h=d;e>h;h++)for(i=1;i<a[q].length;i++)n.push(a[q][i]*Math.pow(10,h*f+g));r(n),k(n,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),o=this.minIsStrict?this.explicitPlotMin:n[0],p=this.maxIsStrict?this.explicitPlotMax:n[n.length-1],l.apply(this,[n,o,p])&&s.push({mainTickValues:n,plotMin:o,plotMax:p})}if(0===s.length)return n=c,k(n,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),o=this.minIsStrict?this.explicitPlotMin:n[0],p=this.maxIsStrict?this.explicitPlotMax:n[n.length-1],{mainTickValues:n,plotMin:o,plotMax:p};if(1===s.length)return s[0];for(m=c.length-1,q=0;q<s.length;q++)if(j=s[q].mainTickValues.length-1,s[q].mainTickValues[0]===c[0]&&s[q].mainTickValues[j]===c[m])return s[q];return s[0]}function t(a,b){var c,d,e,f,g,h,i=!0,j=Math.ceil(this.fractionMinLog),k=Math.floor(this.fractionMaxLog),m=0;if(a[j]&&a[j][k])for(g=a[j][k],g instanceof Array||(g=a[j][g]),h=g.length;h>m&&i;){if(b<=g[m][0]+C&&g[m].length-2<=this.maxNumIntervals){for(d=[],c=1;c<g[m].length;c++)d.push(g[m][c]*this.dataMinMagnitude);i=!l.apply(this,[d,this.usedDataMin,this.usedDataMax])}i&&m++}return i&&(d=[n(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)]),e=this.minIsStrict?this.explicitPlotMin:d[0],f=this.maxIsStrict?this.explicitPlotMax:d[d.length-1],{mainTickValues:d,plotMin:e,plotMax:f}}function u(a,b){var c,d,e,f,g,h,i,j,m,o,q,r,s,t,u,v=this.minIsStrict?Math.ceil(this.fractionMinLog):Math.floor(this.fractionMinLog),w=this.maxIsStrict?Math.floor(this.fractionMaxLog):Math.ceil(this.fractionMaxLog),x={};if(G[v]&&G[v][w])for(i=G[v][w],j=i instanceof Array?i.length/2:0,x.mainTickValues=[],c=0;j>c;c++)if(m=i[2*c],o=i[2*c+1],a[m]&&a[m][o])for(q=a[m][o],r=q.length,d=0;r>d;d++)if(s=b<=q[d][0]+C&&q[d].length-2<=this.maxNumIntervals,t=q[d][1]*this.dataMinMagnitude,u=q[d][q[d].length-1]*this.dataMinMagnitude,s=this.minIsStrict?s&&t>=this.usedDataMin:s&&t<=this.usedDataMin,s=this.maxIsStrict?s&&u<=this.usedDataMax:s&&u>=this.usedDataMax){for(f=[],e=1;e<q[d].length;e++)f.push(q[d][e]*this.dataMinMagnitude);if(k(f,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),g=this.minIsStrict?this.explicitPlotMin:f[0],h=this.maxIsStrict?this.explicitPlotMax:f[f.length-1],l.apply(this,[f,g,h])){x.mainTickValues.length<f.length&&p(x,f,g,h);break}}return x.mainTickValues&&0!==x.mainTickValues.length||(x.mainTickValues=[n(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)]),f=x.mainTickValues,x.plotMin=this.minIsStrict?this.explicitPlotMin:f[0],x.plotMax=this.maxIsStrict?this.explicitPlotMax:f[f.length-1],x}function v(a,b,c){var d,e=a.length;if(c){for(d=e-1;d>=0;d--)if(Math.abs(a[d]-b[d]*this.dataMinMagnitude)>C)return!1;return!0}for(d=0;e>d;d++)if(Math.abs(a[d]-b[d]*this.dataMinMagnitude)>C)return!1;return!0}function w(a){var b,c,d=a.mainTickValues,e=d.length;if(!(2>e||e>4))return c=5*this.dataMinMagnitude,(this.minIsStrict&&this.usedDataMin<=c||!this.minIsStrict&&this.usedDataMin>=c)&&(v.apply(this,[d,[6,10,20,40]])||v.apply(this,[d,[4,10,20,40]]))?(b=d[0],d[0]=c,a.plotMin=this.minIsStrict?this.explicitPlotMin:d[0],void(l.apply(this,[d,a.plotMin,a.plotMax])||(d[0]=b,a.plotMin=this.minIsStrict?this.explicitPlotMin:d[0]))):(c=80*this.dataMinMagnitude,(this.maxIsStrict&&this.usedDataMax>=c||!this.maxIsStrict&&this.usedDataMax<=c)&&v.apply(this,[d,[10,20,40,60],!0])?(b=d[e-1],d[e-1]=c,a.plotMax=this.maxIsStrict?this.explicitPlotMax:d[e-1],void(l.apply(this,[d,a.plotMin,a.plotMax])||(d[e-1]=b,a.plotMax=this.maxIsStrict?this.explicitPlotMax:d[e-1]))):void 0)}function x(b,c,d,e,f,g,i,j,k,m){var n,p,q,r,s=a.calculateTicks(b,c,d,e,f,g,i,j,k,m),t=null!==e,u=null!==f,v=t?e:c,w=u?f:d,x=1;for(0===s.plotMin&&(s.plotMin=t?e:c),n=s.mainTickValues,p=t?e:Math.min(c,n[0]),q=u?f:Math.max(n[n.length-1],d);!l.apply(this,[n,p,q])&&20>=x;)s=h(t||s.tickSpacing>v,u,v,w,s.tickSpacing),n=o(v,w,s.tickBaseValue,s.tickSpacing,t,u),p=t?e:Math.min(c,n[0]),q=u?f:Math.max(n[n.length-1],d),x++;return l.apply(this,[n,p,q])?(r=a.getFraction(n[0])/2,2===n.length&&n[1]/n[0]===2&&n[0]/2>=p&&r===Math.floor(r)&&(n.splice(0,0,n[0]/2),r=a.getFraction(n[0])/2,n[0]/2>=p&&r===Math.floor(r)&&n.splice(0,0,n[0]/2))):n=[],s.mainTickValues=n,s.numLoops=x,s}function y(){var a,b,c,d,e,f,h,i,j,m,o,r,v,x,y,z={};if(this.maxIsStrict&&this.explicitPlotMax<=this.usedDataMin?(this.dataMinLog=Math.ceil(this.explicitPlotMaxLog-(this.maxNumIntervals<2?1:2)),this.dataMin=Math.pow(10,this.dataMinLog)):this.minIsStrict&&this.explicitPlotMin>=this.usedDataMax?(this.dataMaxLog=Math.floor(this.explicitPlotMinLog+(this.maxNumIntervals<2?1:2)),this.dataMax=Math.pow(10,this.dataMaxLog)):this.usedDataMin===this.usedDataMax&&(c=this.usedDataMin,this.dataMinLog=Math.floor(this.dataMinLog),this.dataMaxLog=this.dataMinLog+1,this.dataMin=Math.pow(10,this.dataMinLog),this.dataMax=Math.pow(10,this.dataMaxLog)),this.usedDataMin=this.minIsStrict?this.explicitPlotMin:this.dataMin,this.usedDataMax=this.maxIsStrict?this.explicitPlotMax:this.dataMax,this.usedDataMinLog=this.minIsStrict?this.explicitPlotMinLog:this.dataMinLog,this.usedDataMaxLog=this.maxIsStrict?this.explicitPlotMaxLog:this.dataMaxLog,this.maxNumIntervals<1)return p(z,[n(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog,c)],this.usedDataMin,this.usedDataMax),z;if(this.tickDataSpacingLog=(this.usedDataMaxLog-this.usedDataMinLog)/this.maxNumIntervals,this.usedDataMinLogFloor=Math.floor(this.usedDataMinLog),this.usedDataMaxLogFloor=Math.floor(this.usedDataMaxLog),this.dataMinMagnitude=Math.pow(10,this.usedDataMinLogFloor),this.fractionMinLog=this.usedDataMin/this.dataMinMagnitude,this.fractionMaxLog=this.usedDataMax/this.dataMinMagnitude,a=Math.ceil(this.usedDataMaxLog),this.usedDataMinLog===this.usedDataMinLogFloor&&this.usedDataMaxLog===a&&this.maxNumIntervals>=2&&this.maxNumIntervals<3&&this.tickDataSpacingLog>1&&this.tickDataSpacingLog-Math.floor(this.tickDataSpacingLog)<D&&(b=Math.floor((this.usedDataMinLogFloor+a)/2),v=[Math.pow(10,this.usedDataMinLogFloor),3*Math.pow(10,b),Math.pow(10,a)],k(v,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),x=this.minIsStrict?this.explicitPlotMin:v[0],y=this.maxIsStrict?this.explicitPlotMax:v[v.length-1],v.length>=2&&l.apply(this,[v,x,y])))return p(z,v,x,y),z;if(h=g.call(this),!h.success)return p(z,[n(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)],this.usedDataMin,this.usedDataMax),z;for(i=h.tickMinIndex,j=h.tickMaxIndex,e=h.tickDataSpacingNNLog,f=h.tickBaseValueLog,this.minIsStrict&&i--,this.maxIsStrict&&j++,o=[],m=i;j>=m;m++)o.push(Math.pow(10,m*e+f));return d=Math.pow(10,this.tickDataSpacingLog),r=q.call(this),2===r?t.apply(this,[F,d]):3===r?u.apply(this,[F,d]):(z=s.apply(this,[E,d,o,i,j,e,f]),w.call(this,z),z)}function z(){var a,b,c,d,e={};for(this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,b=Math.floor(this.maxNumIntervals),c=(this.dataMaxLog-this.dataMinLog)/b,d=[this.usedDataMin],a=0;b>a;a++)d.push(Math.pow(10,this.dataMinLog+(a+1)*c));return p(e,d,this.plotMin,this.plotMax),e}var A,B=Math.log(10),C=1e-12,D=Math.log(3)/B,E=[[2,4,6],[2,4],[3]],F=[,[,,[[1,2]],[[1,2,3],[1,3]],[[1,2,4],[1,4]],[[1,2,4],[1,5]],[[1,2,4,6],[2,4,6],[1,3,6],[1,6]],[[1,2,4,6],[2,4,6],[1,3,6],[1,7]],[[1,2,4,8],[2,4,8],[1,8]],[[1,2,4,8],[2,4,8],[1,3,9],[1,9]],[[1,2,4,6,10],[1,2,4,10],[1,3,10],[3,10],[1,10]]],[,,,[[2,3]],[[2,3,4],[2,4]],[[2,3,4],[2,4],[2,5]],[[2,4,6],[2,6]],[[2,4,6],[2,6],[2,7]],[[2,4,8],[2,8]],[[2,4,8],[2,8],[2,9]],[[2,4,6,10],[2,4,10],[5,10],[3,10]]],[,,,,[[3,4]],[[3,4,5],[3,5]],[[3,4,5,6],[3,6]],[[3,4,5,6],[3,5,7],[3,7]],[[3,4,5,6,8],[3,5,7],[4,8],[3,8]],[[3,4,5,6,8],[3,4,6,9],[3,4,6,8],[3,6,9],[4,8],[3,9]],[[4,6,10],[5,10],[3,10]]],[,,,,,[[4,5]],[[4,5,6],[4,6]],[[4,5,6,7],[4,5,6],[4,6]],[[4,5,6,7,8],[4,5,6,7],[4,6,8],[4,8]],[[4,5,6,7,8],[4,6,9],[4,6,8],[4,8]],[[4,6,10],[5,7,9],[5,10],[4,10]]],[,,,,,,[[5,6]],[[5,6,7],[5,7]],[[5,6,7,8],[5,6,7],[6,8]],[[5,6,7,8,9],[5,6,7,8],[5,7,9],[5,9]],[[6,8,10],[5,10]]],[,,,,,,,[[6,7]],[[6,7,8],[6,8]],[[6,7,8,9],[6,7,8],[6,9]],[[6,7,8,9,10],[6,8,10],[6,10]]],[,,,,,,,,[[7,8]],[[7,8,9],[7,9]],[[7,8,9,10],[8,10],[7,10],[7,9]]],[,,,,,,,,,[[8,9]],[[8,9,10],[8,10]]],[,,,,,,,,,,[[9,10]]]],G=[,[,,[1,2],[1,3],[1,4],[1,5,1,6],[1,6],[1,10,1,8,1,7],[1,8,1,10],[1,10,1,9]],[,,,[2,3],[2,4],[2,6,2,5],[2,6,2,8],[2,8,2,7],[2,8,1,10],[1,10,2,10,2,9],[1,10,2,10]],[,,,,[3,4,2,4],[3,6,3,5],[3,6,2,6],[2,8,3,8,3,7],[2,8,3,8,3,9],[2,10,3,10,3,9]],[,,,,,[4,5,4,6,3,5],[4,6],[4,8,4,7],[4,8],[4,10,4,9,3,9],[4,10]],[,,,,,[5,6,4,6],[5,7,4,8],[4,8,5,8,5,10],[5,10,4,10,5,9],[5,10,4,10]],[,,,,,,[6,7,6,8],[6,8],[6,10,5,10,6,9],[6,10,5,10]],[,,,,,,,[7,8,6,8],[7,9,6,10],[6,10,7,10]],[,,,,,,,,[8,10,8,9],[8,10]],[,,,,,,,,,[9,10]]];return d(),A={calculateTicksLogPositive:function(b,c,d,e,f,g,h,i,j){var k,l,n,o={};return isNaN(e)&&(e=null),isNaN(f)&&(f=null),c>d&&(k=c,c=d,d=k),null!==e&&null!==f&&e>f&&(k=e,e=f,f=k),this.plotSize=b,this.dataMin=c,this.dataMax=d,this.explicitPlotMin=e,this.explicitPlotMax=f,this.minTickSpacingInPixel=g,this.minIsStrict=null!==e,this.maxIsStrict=null!==f,this.usedDataMin=this.minIsStrict?e:c,this.usedDataMax=this.maxIsStrict?f:d,this.usedDataRange=this.usedDataMax-this.usedDataMin,this.maxNumIntervals=b/g,this.maxNumTicks=this.maxNumIntervals+1,this.explicitPlotMinLog=this.minIsStrict?a.eliminateFloatingError(a.log10(e)):null,this.explicitPlotMaxLog=this.maxIsStrict?a.eliminateFloatingError(a.log10(f)):null,this.dataMinLog=a.eliminateFloatingError(a.log10(c)),this.dataMaxLog=a.eliminateFloatingError(a.log10(d)),i&&0!==b?this.minIsStrict&&this.maxIsStrict&&this.explicitPlotMin===this.explicitPlotMax?(p(o,[this.explicitPlotMin],this.explicitPlotMin,this.explicitPlotMax),o):(n=y.call(this),this.usedDataMax>=10*this.usedDataMin?n:(l=x.apply(this,[b,c,d,e,f,g,h,i,j]),l.mainTickValues.length<2?n:n.mainTickValues.length<2?l:l.mainTickValues.length===n.mainTickValues.length?(m.call(this,l),m.call(this,n),l.factor>n.factor?l:n):l.mainTickValues.length-1>=1.5*(n.mainTickValues.length-1)&&l.mainTickValues.length>n.mainTickValues.length?l:n)):z.call(this)},calculateTicks:function(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p;if(isNaN(d)&&(d=null),isNaN(e)&&(e=null),b>c&&(j=b,b=c,c=j),null!==d&&null!==e&&d>e&&(j=d,d=e,e=j),0>=b*c&&(b=null===d?b:d,c=null===e?c:e),b>0&&c>0&&(null===d||d>0)&&(null===e||e>0))return k=A.calculateTicksLogPositive(a,b,c,d,e,f,g,h,i),k.sign=1,k;if(0>b&&0>c&&(null===d||0>d)&&(null===e||0>e)){for(l=A.calculateTicksLogPositive(a,-c,-b,null===e?null:-e,null===d?null:-d,f,g,h,i),k={},k.plotMin=-l.plotMax,k.plotMax=-l.plotMin,n=l.mainTickValues,o=n?n.length:0,m=new Array(o),p=0;o>p;p++)m[p]=-n[o-1-p];return k.mainTickValues=m,k.sign=-1,k}return{plotMin:null===d?b:d,plotMax:null===e?c:e,mainTickValues:[]}}}}),define("objects.views/charts/components/axis/log-scale",["core.utils/class","../../utils/axis-utils","../../utils/axis-log-utils"],function(a,b,c){var d=a.extend("LogScale",{init:function(){this.plotMin=null,this.plotMax=null,this.plotRange=null,this.tickMin=this.plotMin,this.tickMax=this.plotMax,this.mainValues=[],this.secondaryValues=[],this._plotSize=0,this._calculationSize=0},setSize:function(a){this._plotSize=a},getPositionOfValue:function(a){var c;return 0===a?this._usedDataMin>0?0:this._plotSize:(c=a>0?b.log10(a):-b.log10(-a),(c-this._plotMinLog10)/this._plotRangeLog10*this._plotSize)},getValueOfPosition:function(a){var b;return 0===a?0:(b=this._plotMinLog10+this._plotRangeLog10*a/this._plotSize,this._usedDataMin>0?Math.pow(10,b):-Math.pow(10,-b))},calculateLimits:function(){this._usedDataMin=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,this._usedDataMax=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,this.plotMin=null===this._explicitPlotMin||isNaN(this._explicitPlotMin)?this._usedDataMin:this._explicitPlotMin,this.plotMax=null===this._explicitPlotMax||isNaN(this._explicitPlotMax)?this._usedDataMax:this._explicitPlotMax,this.plotRange=this.plotMax-this.plotMin,this._plotMinLog10=b.log10(Math.abs(this.plotMin))*(this.plotMin<0?-1:1),this._plotMaxLog10=b.log10(Math.abs(this.plotMax))*(this.plotMax<0?-1:1),this._plotRangeLog10=this._plotMaxLog10-this._plotMinLog10},calculateTicks:function(){var a;a=c.calculateTicks(this._calculationSize,this._usedDataMin,this._usedDataMax,this._explicitPlotMin,this._explicitPlotMax,this._minTickSpacingInPixel,this._fontHeight,this._niceNumberEnabled,this._whiteSpaceOptimizingEnabled),this.plotMin=a.plotMin,this.plotMax=a.plotMax,this.plotRange=this.plotMax-this.plotMin,this.tickMin=a.tickMin,this.tickMax=a.tickMax,this.mainValues=a.mainTickValues,this.secondaryValues=[],this._dataSign=a.sign,this._tickSpacing=this.mainValues.length>1?this.mainValues[1]-this.mainValues[0]:this.plotMax-this.plotMin,this._plotMinLog10=this._dataSign*b.log10(Math.abs(this.plotMin)),this._plotMaxLog10=this._dataSign*b.log10(Math.abs(this.plotMax)),this._plotRangeLog10=this._plotMaxLog10-this._plotMinLog10,0===this._tickSpacing&&(this._tickSpacing=1)},getValues:function(){return{mainValues:this.mainValues,secondaryValues:this.secondaryValues}}});return d}),define("objects.views/charts/utils/tween",["core.utils/class","objects.utils/animation-frame"],function(a,b){function c(){i.tick()&&(j=b.request(c))}function d(a){k.push(a),a._isRunning=!0,null===j&&(j=b.request(c))}function e(a,b){for(var c in a)this._props[c]||(this._props[c]={}),this._props[c][b]=Array.isArray(a[c])?a[c].slice():a[c]}function f(){var a,b,c,d;for(a in this._props)if(d=this._props[a],b="from"in d?d.from:this._target[a],c=d.to,d.from=b,Array.isArray(b)){var e=b.map(function(a){return a.value}),f=c.map(function(a){return a.value});d.fresh=c.filter(function(a){return e.indexOf(a.value)<0}),d.rotten=b.filter(function(a){return f.indexOf(a.value)<0}),d.ripe=c.filter(function(a){return e.indexOf(a.value)>=0}),d.combined=d.rotten.concat(d.ripe).concat(d.fresh),d.isArray=!0}else isNaN(b)||isNaN(d.to)||(d.change=d.to-b)}function g(a){var b;for(b in a)if(a[b].isArray){if(a[b].fresh.length||a[b].rotten.length)return!0}else if(a[b].change)return!0;return!1}function h(a,b,c){var d,e,f,g,h,i,j;for(e in a){if(f=a[e],g=f.to,h=f.from,f.isArray){for(i=f.fresh,j=f.rotten,f.value=c?f.to:f.combined,d=0;d<i.length;d++)i[d].opacity=b;for(d=0;d<j.length;d++)j[d].opacity=1-b;c&&(delete f.combined,delete f.fresh,delete f.rotten,delete f.ripe)}else f.value=!c&&"change"in f?h+f.change*b:g;c&&delete a[e].from}}var i,j=null,k=[],l=!0,m=Math.PI,n=Math.cos;i=a.extend("Tween",{init:function(a,b,c,e){var h,j,k,l={},m=!0;this._target=a,this._enabled=!0;for(h in b)j=Array.isArray(a[h])?a[h].slice():a[h],k=Array.isArray(b[h])?b[h].slice():b[h],l[h]={from:j,to:k};this._props=l,f.call(this),"object"==typeof c?(this._duration=c.duration||200,this._easing="function"==typeof c.easing?c.easing:i.easing[c.easing||"linear"],m=c.autoStart!==!1):(this._duration=c||200,this._easing="function"==typeof e?e:i.easing[e||"linear"]),this._dfd=new o,this._pos=0,this._isRunning=!1,m&&(g(this._props)?(this._startTime=Date.now(),d(this)):this._step(!0))},from:function(a){return this._isRunning||e.call(this,a,"from"),this},to:function(a){return this._isRunning||e.call(this,a,"to"),this},start:function(){return!this._isRunning&&this._enabled&&l&&(f.call(this),g(this._props)?this._start():this._dfd.resolve()),this},willStart:function(){return!this._isRunning&&this._enabled&&l&&(f.call(this),g(this._props))?!0:!1},stop:function(){return this._isRunning&&(this._isRunning=!1,k.splice(k.indexOf(this),1)),this},end:function(){return this._isRunning&&this._step(!0),this},then:function(){return this._dfd.then.apply(this._dfd,[].slice.call(arguments)),this},progress:function(){return this._dfd.progress.apply(this._dfd,[].slice.call(arguments)),this},isRunning:function(){return this._isRunning},on:function(){this._enabled=!0},off:function(){this._enabled=!1},destroy:function(){this.stop(),this._dfd.destroy()},_update:function(){var a;for(a in this._props)this._target[a]=this._props[a].value},_step:function(a){var b,c=Date.now()-this._startTime;return c>=this._duration||a?(this._pos=1,this._isRunning=!1,b=k.indexOf(this),b>=0&&k.splice(b,1),h(this._props,this._pos,!0),this._update(),this._dfd.notify(c,c/this._duration,this._pos),void this._dfd.resolve()):(this._pos=this._easing(c/this._duration),h(this._props,this._pos,!1),this._update(),void this._dfd.notify(c,c/this._duration,this._pos))},_start:function(){this._startTime=Date.now(),d(this),this._step()}}),i.off=function(){l=!1},i.on=function(){l=!0},i.tick=function(){var a,c,d=k.slice(),e=d.length;for(a=0;e>a;a++)c=d[a],c._step();return k.length?!0:(b.cancel(j),j=null,!1)},i.clear=function(){},i.easing={linear:function(a){return a},easeInOut:function(a){return.5*(1-n(a*m))}},i.tweens=k;var o=function(){this._onSuccess=[],this._onProgress=[],this._isResolved=!1};return o.prototype={then:function(a){this._onSuccess.push(a),this._isResolved&&a.call(null,[].slice.apply(arguments))},progress:function(a){this._onProgress.push(a)},resolve:function(){this._isResolved=!0;var a,b=this._onSuccess.length;for(a=0;b>a;a++)this._onSuccess[a].apply(null,[].slice.call(arguments))},notify:function(){var a,b=this._onProgress.length;for(a=0;b>a;a++)this._onProgress[a].apply(null,[].slice.call(arguments))},destroy:function(){this._onSuccess=[],this._onProgress=[]}},i}),define("objects.views/charts/components/axis/continuous-axis",["./axis","./linear-scale","./log-scale","objects.views/charts/components/axis/radial-axis-helper","util","objects.views/charts/utils/tween","objects.utils/shapes/rect","objects.utils/shapes/polygon"],function(a,b,c,d,e,f){function g(a){var b,c,d=[],e=a?a.length:0;for(b=0;e>b;b++)c=a[b],d.push({position:0,value:c,opacity:1});return d}function h(a){var b,c=a?a.length:0,d=[],e=[],f=[],g=[],h=[];if(a.forEach(function(a){f.push(a.position),e.push(a.value),g.push("opacity"in a?a.opacity:1),d.push(a.formatted||a.value+"")},this),1>=c)h=[this._plotSize];else{for(h[0]=Math.abs(a[1].position-a[0].position)/2+a[0].position,b=1;b<a.length-1;b++)h.push(Math.abs(a[b].position-a[b-1].position)/2+Math.abs(a[b+1].position-a[b].position)/2);h[b]=Math.abs(a[b].position-a[b-1].position)/2+(this._padding.left+this._plotSize-a[b].position)}return{values:e,widths:h,positions:f,opacities:g,labels:d,labelMode:k,labelSpace:this._wantedLabelSpace}}function i(a){var b,c,d=0,e=a[this._isVertical?"height":"width"],f=0,g=this._style;return this.isRadial()?d=2*Math.sin(this._relevantAngle/4)*this._fontHeight*g.label.lineHeight:this._isVertical?(this._calculateScale(e),b=this._formatter,c=this._renderer,b&&(f=Math.max.apply(null,this._scale.getValues().mainValues.map(function(a){return c.getTextWidth(b.formatValue(a)+"ml",g.label.font)}))),d=Math.min(a[this._isVertical?"width":"height"]/3,f<this.outerRect.width/2?f:this.outerRect.width/3)):d=this._fontHeight*g.label.lineHeight,this._wantedLabelSpace=d,d}var j,k=1,l={onProgress:function(){this._updateTickPositions(),this.invalidateDisplay(),this.fire("changed")},on:function(){this._tickTween.on(),this._linearTween.on()},off:function(){this._tickTween.off(),this._linearTween.off()},to:function(){this._linearTween.stop().to({plotMin:this._scale.plotMin,plotMax:this._scale.plotMax,plotRange:this._scale.plotRange}),this._tickTween.stop().to({ticks:this.ticks})},from:function(){this._linearTween.stop().from({plotMin:this._scale.plotMin,plotMax:this._scale.plotMax,plotRange:this._scale.plotRange}),this._tickTween.stop().from({ticks:this.ticks})},start:function(){this._scale===this._linearScale&&this._linearTween.willStart()&&(this._tickTween.start(),this._linearTween.start())},end:function(){this._scale===this._linearScale&&(this._tickTween.end(),this._linearTween.end())},stop:function(){this._tickTween.stop(),this._linearTween.stop()}};return j=a.extend("ContinuousAxis",{init:function(){this._super.apply(this,[].slice.call(arguments)),this._scaleDetails={showExplicitMinMax:!0,niceNumberEnabled:!0,tickMultiplier:1},this.ticks=[],this.minorTicks=[],this._defaultFormatter={formatValue:function(a){return String(a)},format:function(a){return String(a)}},this._formatter=this._defaultFormatter,this._useLogScaleIfPossible=!1,this._linearScale=new b,this._logarithmicScale=new c,this._scale=this._linearScale,this._cacheItems=null,this._useTransition=!1;var a={autoStart:!1,duration:500,easing:"easeInOut"};this._linearTween=new f(this._linearScale,{},a).progress(l.onProgress.bind(this)),this._tickTween=new f(this,{},a)
},setSelectableShapes:function(a){this._cacheItems=a},updateSize:function(){this._super(),this._calculationSize=this._plotSize,this._updateScaleAndTicks(),this._scale.setSize(this._plotSize),this._updateTickPositions(),l.to.call(this),this._changed?(this._changed=!1,l.start.call(this)):l.end.call(this)},calculateValuePositionMappingInfo:function(){this._scale.setSize(this._plotSize),this._scale._calculationSize=this._plotSize,this._scale.calculateLimits()},setUseTransition:function(a){this._super(),l[a?"on":"off"].call(this)},preRelevantSizeCalculation:function(){this._super(),this._areLabelsVisible=this.isVisible(this._layoutMode)&&this._showLabels},calculatePreliminaryLabelSpace:function(a){var b=0;return this._areLabelsVisible&&(b=i.call(this,a)),{relevantLabelSize:b||0,relevantSpacing:0}},calculateLabelSpace:function(a){var b=0;return this._calculateScale(this._calculationSize),this._areLabelsVisible&&(b=i.call(this,a)),{relevantLabelSize:b||0,relevantSpacing:0}},_updateTickPositions:function(){for(var a=0;a<this.ticks.length;a++)this.ticks[a].position=Math.floor(this.getPositionOfValue(this.ticks[a].value))-.5;for(a=0;a<this.minorTicks.length;a++)this.minorTicks[a].position=Math.floor(this.getPositionOfValue(this.minorTicks[a].value))-.5;this._areLabelsVisible&&(this._levels=[h.call(this,this.ticks)])},_generateLevels:function(){this._updateTickFormatting(this.ticks,this._formatter),this._levels=[h.call(this,this.ticks)]},_calculateScale:function(a){if(0!==a){var b=this._scaleDetails,c=isNaN(b.realDataMin)?b.dataMin:b.realDataMin,d=isNaN(b.realDataMax)?b.dataMax:b.realDataMax,e=isNaN(b.explicitPlotMin)||null===b.explicitPlotMin?c:b.explicitPlotMin,f=isNaN(b.explicitPlotMax)||null===b.explicitPlotMax?d:b.explicitPlotMax,g=this.isRadial()?96:Math.max(96,this._getApproximateLabelWidth(e,f)),h=this.isVertical()?4*this._fontHeight:g,i=Math.max(2,a/h/b.tickMultiplier+1);h=a/(i-1),this._scale=this._linearScale,this._useLogScaleIfPossible&&e*f>0&&(this._scale=this._logarithmicScale),b.usedDataMin=c,b.usedDataMax=d,b.defaultLabelWidth=g,b.minTickSpacingInPixel=h,b.numTicks=i,b.plotSize=this._plotSize,b.calculationSize="undefined"!=typeof a?a:this._calculationSize,b.fontHeight=this._fontHeight,Object.keys(b).forEach(function(a){this._scale["_"+a]=b[a]},this),this._scale.calculateTicks()}},_getLabelWidthFromValues:function(a){var b=this._formatter,c=this._renderer,d=this._style.label.font;return b?Math.max.apply(null,a.map(function(a){return c.getTextWidth(b.formatValue(a)+"ml",d)})):0},_getApproximateLabelWidth:function(a,b){var c=this._formatter,d=this._renderer,e=this._style.label.font;return c?Math.max.apply(null,[a,b,(b-a)/2].map(function(a){return d.getTextWidth(c.formatValue(a),e)})):0},_generateTickObjects:function(a,b){var c=a.getValues();this.ticks=g.call(this,c.mainValues,this._padding,b),this.minorTicks=g.call(this,c.secondaryValues,this._padding,b)},_updateTickFormatting:function(a,b){var c,d=a?a.length:0;for(c=0;d>c;c++)a[c].formatted=b.formatValue(a[c].value)},setPlotMin:function(a){this._scaleDetails.explicitPlotMin="number"==typeof a?a:null,this.invalidateProperties("setPlotMin")},getPlotMin:function(){return this._scale.plotMin},setPlotMax:function(a){this._scaleDetails.explicitPlotMax="number"==typeof a?a:null,this.invalidateProperties("setPlotMax")},getPlotMax:function(){return this._scale.plotMax},setTickMultiplier:function(a){this._scaleDetails.tickMultiplier=a||1,this.invalidateProperties("setTickMultiplier")},setSpacingMode:function(a){this._scaleDetails.spacingMode=a,this.invalidateProperties("setSpacingMode")},getSpacingMode:function(){return this._scaleDetails.spacingMode},setShowExplicitMinMax:function(a){this._scaleDetails.showExplicitMinMax=a,this.invalidateProperties("setShowExplicitMinMax")},setLogScale:function(a){this._useLogScaleIfPossible=a,this.invalidateProperties("setLogScale")},getLogScale:function(){return this._scale===this._logarithmicScale},numberFormat:function(a,b){return this._discrete?a:e.numberFormat(a,b?b:this._precision,this._exponentUsed)},format:function(a){return this._discrete||!this._formatter?a+"":this._formatter.format(a,this._formatPattern)},getNumberFormatPrecision:function(){return this._precision},_transition:function(){this._onAnimatitonEnd()},setDataRangeTransition:function(a){this._transitionEnabled=a},setDataRange:function(a,b){return this._scaleDetails.dataMin=a,this._scaleDetails.dataMax=b,this.invalidateDisplay("setDataRange"),this.invalidateProperties("setDataRange"),this},setRealDataRange:function(a,b){this._scaleDetails.realDataMin=a,this._scaleDetails.realDataMax=b,this.invalidateProperties("setRealDataRange")},getDataMin:function(){return this._scaleDetails.dataMin},getDataMax:function(){return this._scaleDetails.dataMax},setNiceNumberEnabled:function(a){this._scaleDetails.niceNumberEnabled!==a&&(this._scaleDetails.niceNumberEnabled=a,this.invalidateProperties("setNiceNumberEnabled"))},setWhiteSpaceOptimizingEnabled:function(a){this._scaleDetails.whiteSpaceOptimizingEnabled=a,this.invalidateProperties("setWhiteSpaceOptimizingEnabled")},getLabels:function(){return this._levels},updateFormatter:function(){var a=this.getType().indices;this._formatter=1===a.length&&this.measureFormatters.length?this.measureFormatters[a[0]]:this.combinedMeasuresFormatter||this._defaultFormatter,this._formatter.prepare&&this._formatter.prepare()},_onAnimatitonEnd:function(){this._super(),this.rect.width>0&&this.calculateLabelSpace(this.rect)},_updateProperties:function(){l.from.call(this),this._changed=this._oldIsVertical===this.isVertical()&&"number"==typeof this._scale.plotRange&&!isNaN(this._scale.plotRange),this._oldIsVertical=this.isVertical(),this.updateFormatter(),this._isSizing||this._updateScaleAndTicks()},_updateScaleAndTicks:function(){this._calculateScale(this._calculationSize,this._calculatedPlotMin,this._calculatedPlotMax),this._generateTickObjects(this._scale,this._plotSize),this._updateTickPositions(),this._areLabelsVisible&&this._generateLevels()},clear:function(){this._linearTween.end(),this._tickTween.end(),this._super()},getWidthOfValue:function(){return 1},getPositionOfValue:function(a){var b,c=this._scale.plotMin,d=this._scale.plotRange;return b=0===d?a>c?100*this._plotSize:c>a?100*-this._plotSize:this._plotSize/2:this._scale.getPositionOfValue(a),(this._isVertical&&!this._reverse||!this._isVertical&&this._reverse)&&(b=this._plotSize-b),b+this._padding[this._isVertical?"top":"left"]},getPositionOfNormalizedValue:function(a){var b=this._scale.plotMin,c=this._scale.plotMax;return this.getPositionOfValue(a*(c-b)+b)},getValueOfPosition:function(a){return this._plotSize<=0?0/0:(a-=this._padding[this._isVertical?"top":"left"],(this._isVertical&&!this._reverse||!this._isVertical&&this._reverse)&&(a=this._plotSize-a),this._scale.getValueOfPosition(a))},getAngleOfValue:function(a){return d.getAngleOfNormalizedValue((a-this._scale.plotMin)/(this._scale.plotMax-this._scale.plotMin),this)},getAngleOfNormalizedValue:function(a){return d.getAngleOfNormalizedValue(a,this)}})}),define("objects.views/charts/components/chart-component-angular",["jquery","qvangular","./chart-component"],function(a,b,c){var d;return d=c.extend({init:function(c,d,e,f){this._super(c,d,e);var g=b.getService("$compile");this._innerContainer=a(f).appendTo(a(this.container)),g(this._innerContainer)(a(this.container).scope().$new()),this._innerScope=this._innerContainer.scope()},getInnerContainer:function(){return this._innerContainer},getInnerContainerScope:function(){return this._innerScope},release:function(){this._super(),this._innerContainer.remove(),this._innerContaine=null,this._innerScope.$destroy(),this._innerScope=null}})}),define("text!objects.views/charts/components/axis/axis-title.ng.html",[],function(){return'<div qva-breadcrumb-bar \r\n     class="qva-breadcrumb-bar" \r\n     fontscale="fs" \r\n     vertical="vertical" \r\n     ng-class="{\'vertical\':vertical, \'horizontal\': !vertical}">\r\n</div>\r\n'}),define("text!objects.views/charts/components/axis/breadcrumb-bar.ng.html",[],function(){return'<div class="qv-breadcrumb" ng-class="{\'vertical\':vertical, \'horizontal\': !vertical}" ng-style="fontStyle">\r\n	<div class="qv-breadcrumb-container" ng-style="containerStyle">\r\n		<span ng-if="dim1">\r\n			<span class="crumb-item" ng-repeat="label in dim1" ng-class="{ \'single-label\': singleLabelMode }">\r\n				<i ng-if="$last && locked0" class="icon-toolbar-locked"></i>\r\n				<span ng-style="getCrumbStyle(hoverIndex === $index, $last, disabled)"\r\n					  ng-mouseover="hoverIndex = $index"\r\n					  ng-mouseout="hoverIndex = -1"\r\n					  ng-class="{\'crumb-button\' : !$last, \'disabled\' : disabled}"\r\n					  qva-activate="onClick($event,0,$index)">\r\n					{{label}}\r\n					<span class="crumb-arrow" ng-if="!$last">\r\n						U\r\n					</span>\r\n				</span>\r\n			</span>\r\n		</span>\r\n		<span ng-if="dim1 && dim2">,&nbsp;</span>\r\n		<span ng-if="dim2">\r\n			<span class="crumb-item" ng-repeat="label in dim2" ng-class="{ \'single-label\': singleLabelMode }">\r\n				<i ng-if="$last && locked1" class="icon-toolbar-locked"></i>\r\n				<span ng-style="getCrumbStyle(hoverIndex === $index, $last, disabled)"\r\n					  ng-mouseover="hoverIndex = $index"\r\n					  ng-mouseout="hoverIndex = -1"\r\n					  ng-class="{\'crumb-button\' : !$last, \'disabled\' : disabled }"\r\n					  qva-activate="onClick($event,1,$index)">\r\n					{{label}}\r\n					<span class="crumb-arrow"\r\n						  ng-if="!$last">\r\n						U\r\n					</span>\r\n				</span>\r\n			</span>\r\n		</span>\r\n	</div>\r\n	<div class="qv-breadcrumb-h-fader" ng-class="{\'hidden\': !hasDrillDown }" ng-style="faderStyleH">&nbsp;</div>\r\n</div>\r\n<div class="qv-breadcrumb-v-fader" ng-class="{\'hidden\': !hasDrillDown }" ng-style="faderStyleV">&nbsp;</div>'}),define("objects.views/charts/components/axis/breadcrumb-bar",["general.utils/color","assets/qvangular/qvangular-core","text!./breadcrumb-bar.ng.html","objects.views/charts/chart-style-service","touche"],function(a,b,c,d){function e(b){var c=i.getValue("",null,"backgroundColor","#ffffff"),d=a.toRGBA(c,0),e=a.toRGBA(c,1);b.fontStyle={"font-size":i.getValue("","axis.title","fontSize"),"font-family":i.getValue("","axis.title","fontFamily"),"font-weight":i.getValue("","axis.title","fontWeight")},b.faderStyleH={background:"linear-gradient(to right, "+e+", "+d+")"},b.faderStyleV={background:"linear-gradient(to right, "+e+", "+d+")"},j.crumbColor={color:i.getValue("","axis.title","color")},j.crumbButtonColor={color:i.getValue("","axis.title","color","inactive")},j.crumbButtonHoverColor={color:i.getValue("","axis.title","color","active")},j.crumbButtonLockedColor={color:i.getValue("","axis.title","color","locked")},j.crumbButtonDisabledColor={color:i.getValue("","axis.title","color","disabled")}}function f(a){var b=a.fontScale;a.containerStyle={"font-size":1*b+"em","line-height":"1em"},a.rightAlign&&!a.singleLabelMode?(a.containerStyle.position="absolute",a.containerStyle.right=k+"px"):a.rightAlign&&(a.containerStyle.width="100%"),a.vertical&&!a.singleLabelMode?a.containerStyle.left="-"+(52+a.verticalLeftShift)+"%":a.vertical&&(a.containerStyle.left="-"+(52-a.verticalLeftShift)+"%")}function g(a,b){return(a?a.length:0)+(b?b.length:0)===1}function h(a,b){return a&&a.length>1||b&&b.length>1}var i=d.getInstance(),j={},k=10;b.directive("qvaBreadcrumbBar",function(){return{template:c,link:function(a,b,c){a.labels1=a.$eval(c.labels1),a.hoverIndex=-1,a.height=b.width(),a.singleLabelMode=!0,a.onClick=function(b,c,d){a.disabled||a.$emit("drill-up",c,d)},a.setDimension=function(b,c){0===b?a.dim1=c:a.dim2=c,a.singleLabelMode=g(a.dim1,a.dim2),a.hasDrillDown=h(a.dim1,a.dim2)},a.getCrumbStyle=function(a,b,c){return c?j.crumbButtonDisabledColor:b?j.crumbColor:a?j.crumbButtonHoverColor:j.crumbButtonColor},e(a),a.$watch("fontScale",function(){f(a,c)}),a.setRelevantSize=function(d){a.rightAlign=!a.vertical&&b.find(".qv-breadcrumb-container").width()+k>d?!0:!1,a.verticalLeftShift=a.vertical&&b.find(".qv-breadcrumb-container").width()>d?(b.find(".qv-breadcrumb-container").width()-d)/.02/b.find(".qv-breadcrumb-container").width():2,f(a,c)},a.setLocked=function(b,c){a["locked"+b]=c}}}})}),define("objects.views/charts/components/axis/axis-title",["../chart-component-angular","objects.views/charts/utils/canvas-renderer","text!./axis-title.ng.html","objects.views/charts/components/axis/breadcrumb-bar","jquery"],function(a,b,c){var d,e=3;return d=a.extend("AxisTitle",{init:function(){var a=this,b=Array.prototype.slice.call(arguments);b.push(c),this._super.apply(this,b),this._type="measure",this._numCrumbs=[1,1],this._showTitle=!0,this._innerScope.fontScale=1,this._innerScope.vertical=!1,this.drillUpRef=this._innerScope.$on("drill-up",function(b,c,d){a._numCrumbs[c]-d>0&&a.fire("drill-up",[b,c,a._numCrumbs[c]-d])})},calculateRelevantSize:function(){this._super();var a={font:"12px 'QlikView Sans'",lineHeight:1.4};this._titleFontHeight=b.getFontHeight(a.font),this.relevantSize=this._titleFontHeight*a.lineHeight+e},setShowStrategy:function(a){this._showTitle=["all","title"].contains(a)},setDock:function(a){this._super(a),this._innerScope.vertical=this.isVertical()},setTitle:function(a){this._title=a},setType:function(a){this._type=a},setData:function(){if(this._super.apply(this,arguments),"dimension"===this._type){this._qDimensionInfo=this._data&&this._data.qHyperCube?this._data.qHyperCube.qDimensionInfo:null;var a,b;a=this._qDimensionInfo?this._qDimensionInfo.length:0,a>0&&3>a?(b=this._qDimensionInfo[0],this._numCrumbs[0]=b.qGroupPos,this._innerScope.setLocked(0,b.qLocked||!1),this._innerScope.setDimension(0,b.qGroupFallbackTitles.slice(0,b.qGroupPos+1)),1===a?this._innerScope.setDimension(1,!1):(b=this._qDimensionInfo[1],this._numCrumbs[1]=b.qGroupPos,this._innerScope.setLocked(1,b.qLocked||!1),this._innerScope.setDimension(1,b.qGroupFallbackTitles.slice(0,b.qGroupPos+1)))):(this._innerScope.setDimension(0,!1),this._innerScope.setDimension(1,!1))}},setFont:function(a){this._style&&(this._style.font=a)},isVisible:function(){return this._super.apply(this,arguments)&&this._showTitle},on:function(){this._innerScope.disabled=!1},off:function(){this._innerScope.disabled=!0},paint:function(){this._innerScope.fontScale=this.chartScale,this._innerScope.setRelevantSize(this.isVertical()?this.rect.height:this.rect.width),this._innerScope.$apply()},release:function(){this._super(),this.drillUpRef()}})}),define("objects.utils/event-utils",["qvangular","touche"],function(a){function b(a,b){a.gestures.forEach(function(c){c!==b&&a.cancelGesture(c)})}function c(a){var b=0,c=0,d=0,e=60;return a.wheelDelta&&(b=a.wheelDelta/e),a.detail&&(b=-a.detail/3),d=b,void 0!==a.axis&&a.axis===a.HORIZONTAL_AXIS&&(d=0,c=-1*b),void 0!==a.wheelDeltaY&&(d=a.wheelDeltaY/e),void 0!==a.wheelDeltaX&&(c=-1*a.wheelDeltaX/e),{delta:b,deltaX:c,deltaY:d,x:a.pageX,y:a.pageY}}function d(a,b,c){var d,e;return function(){var f=c||this,g=+new Date,h=arguments;d&&d+b>g?(clearTimeout(e),e=setTimeout(function(){d=g,a.apply(f,h)},b)):(d=g,a.apply(f,h))}}function e(a,b){return function(){var c=this,d=arguments;clearTimeout(h),h=setTimeout(function(){a.apply(c,d)},b)}}function f(b){b&&(b=b.map(function(a){return a.qFallbackTitle}),a.$rootScope.$broadcast("locked-feedback",[b]),e(function(){a.$rootScope.$broadcast("locked-feedback",[b,!0])},100)())}var g=Touche.Gesture.augment(function(a){function b(){a.apply(this,arguments)}return this.defaults={which:2,radiusThreshold:3},this.start=function(a,b){Touche.utils.touch||Touche.utils.msPointer&&a.pointerType!==a.MSPOINTER_TYPE_MOUSE||this.isValidMouseButton(a,this.options.which)&&(this.initiated=!0,b.startPoint=b.points[0],this.binder.start.call(this,a,b))},this.update=function(a,b){!this.started&&b.startPoint&&b.startPoint.distanceTo(b.points[0])>=this.options.radiusThreshold?(this.started=!0,this.binder.update.call(this,a,b)):this.started&&this.binder.update.call(this,a,b)},this.end=function(a,b){this.initiated&&(this.binder.end.call(this,a,b),this.initiated=!1)},b});Touche.gestures.add("wheelswipe",g);var h=null;return{getMouseWheelData:c,cancelGestures:b,throttle:d,debounce:e,showLockedFeedback:f}}),define("objects.views/charts/components/legend",["jquery","objects.views/charts/chart-style-service","./chart-component","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","client.utils/state","objects.utils/shapes/rect","objects.utils/shapes/line","objects.utils/shapes/circle","objects.utils/shapes/polygon","objects.utils/event-utils","objects.views/charts/utils/tween","touche"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a,b,c,d,e){return a.set(b,e,c-b,d-e),a}function n(a,b,c){var d,e,f=!1;for(e=0;e<a.length;e++)if(d=a[e].rect,d.pointInside(b,c))return f=a[e];return f}function o(a){return a.label?a.label:a.min+" - "+(a.isMax?"":"<")+a.max}function p(a,b,c,d,e,f,g,h){if("group"===a.children[0].type){for(var i=Array.isArray(b.marker)?b.marker:[b.marker],j=[],k=a.children[0].children,l=0;l<i.length;l++)j.push(k[l]?q.call(this,k[l],b.color,c,d,i[l],i.length>1):r.call(this,c,d,b.color,i[l],i.length>1));a.children[0].children=j}else q.call(this,a.children[0],b.color,c,d);a.children[1].shape.text=o(b,h),a.children[1].shape.x=c+2*I.pad+I.w,a.children[1].shape.y=d+this._cellHeight/2,a.children[1].shape.maxWidth=g,a.x=c,a.y=d,a.id=b.id,a.selectionType=b.type}function q(a,b,c,d,e,f){var k,l,m=!0,n=!0,o=e;switch(/^\!/.test(e)&&(n=!1,o=o.substring(1)),o){case"line":k=h;break;case"circle":k=i;break;case"diamond":case"triangle":k=j;break;default:k=g}return a.shape instanceof k?("line"===o?(m=!1,a.shape.set(c+J.pad,Math.floor(d+this._cellHeight/2),c+J.w+J.pad,Math.floor(d+this._cellHeight/2))):"circle"===o?(l=K.r*(f?.5:1),a.shape.set(c+K.pad+(f?2*l:l),d+this._cellHeight/2,l)):"diamond"===o?a.shape.set([{x:c+I.pad+I.w/2,y:d+this._markerTopPadding},{x:c+I.pad,y:d+this._markerTopPadding+I.h/2},{x:c+I.pad+I.w/2,y:d+this._markerTopPadding+I.h},{x:c+I.pad+I.w,y:d+this._markerTopPadding+I.h/2}]):"triangle"===o?a.shape.set([{x:c+I.pad+I.w/2,y:d+this._markerTopPadding},{x:c+I.pad,y:d+this._markerTopPadding+I.h},{x:c+I.pad+I.w,y:d+this._markerTopPadding+I.h}]):a.shape.set(c+I.pad,d+this._markerTopPadding,I.w,I.h),m&&n?(a.fill=b.toHex(),delete a.stroke):(a.stroke=b.toHex(),delete a.fill),a):r.call(this,c,d,b,e)}function r(a,b,c,d,e){var f,k,l=!0,m=!0;switch(/^\!/.test(d)&&(m=!1,d=d.substring(1)),d){case"line":f={shape:new h(a+J.pad,Math.floor(b+this._cellHeight/2),a+J.w+J.pad,Math.floor(b+this._cellHeight/2)),type:"line",strokeWidth:J.strokeWidth},l=!1;break;case"circle":k=K.r*(e?.5:1),f={shape:new i(a+K.pad+(e?2*k:k),b+this._cellHeight/2,k),type:"circle"};break;case"diamond":f={shape:new j([{x:a+I.pad+I.w/2,y:b+this._markerTopPadding},{x:a+I.pad,y:b+this._markerTopPadding+I.h/2},{x:a+I.pad+I.w/2,y:b+this._markerTopPadding+I.h},{x:a+I.pad+I.w,y:b+this._markerTopPadding+I.h/2}]),type:"polygon"};break;case"triangle":f={shape:new j([{x:a+I.pad+I.w/2,y:b+this._markerTopPadding},{x:a+I.pad,y:b+this._markerTopPadding+I.h},{x:a+I.pad+I.w,y:b+this._markerTopPadding+I.h}]),type:"polygon"};break;default:f={shape:new g(a+I.pad,b+this._markerTopPadding,I.w,I.h),type:"rect"}}return l&&m?(f.fill=c.toHex(),delete f.stroke):(f.stroke=c.toHex(),f.strokeWidth=2,delete f.fill),f}function s(a,b,c,d){var e,f=[];if(d&&Array.isArray(d))for(var g=0;g<d.length;g++)e=d[g],f.push(r.call(this,a,b,c,e,d.length>1));else f.push(r.call(this,a,b,c,d));return{type:"group",children:f}}function t(a,b,c,d,e,f,g){return{type:"group",selectionType:a.type,opacity:1,id:a.id,x:b,y:c,children:[s.call(this,b,c,a.color,a.marker),{type:"text",fill:this._style.title.color,shape:{text:o(a,g),lineHeight:this._style.label.lineHeight,font:this._style.label.font,color:this._style.label.color,x:b+2*I.pad+I.w,y:c+this._cellHeight/2,maxWidth:f,maxNumLines:2,align:"left",baseline:"middle"}}]}}function u(a,b){var c,d,e,f,h,i,j,k,l,n,o,q,r,s,u,v,w,x,z={},A=this.selectionIdentifier?this.selectionIdentifier:"legend";if(f=this._colorItems,h=this._boxItems,s=[],this._buttons=[],this._hitBoxes=[],i=!this.isHorizontal(),d=this.rect.width,e=this.rect.height,q=0,r=0,j=Math.min(d,L.w),k=this._cellHeight,o=j-I.w-2*I.pad,y.apply(this,[z,this.rect,b,i,"bottom"===this.dock]),i?(q=b,"right"===this.dock?r+=F:"left"===this.dock&&(d-=F)):(r=Math.max(a,(d-z.w)/2),"bottom"===this.dock&&(q+=P)),z.x=r,z.y=q,n=r,l=q,u=1,v=1,x=this,w=function(a,b,c){b?p.call(x,b,a,n,l,j,k,o,i):(b=t.apply(x,[a,n,l,j,k,o,i]),h.push(b)),s.push(b),m(x._hitRects[c],n-r,n+L.w-r,l-q,l+x._cellHeight-q),x._hitBoxes.push({id:a.id,rect:x._hitRects[c],type:a.type}),x._cacheMap&&x._cacheMap[a.id]&&x._cacheMap[a.id][0].addShape(A,x._hitRects[c]),i?(n+=j,n+j>d&&c<f.length-1&&(n=r,l+=k),l-q>=z.h*u&&u++):(l+=k,v*j>z.w*u&&u++,l+k>e&&(n+=j,l=q,v++))},"range"===this._boxType&&this.isHorizontal())for(c=f.length-1;c>=0;c--)w(f[c],h[f.length-c+1],f.length-c-1);else for(c=0;c<f.length;c++)w(f[c],h[c],c);return l!==q&&v++,z.numCols=v,this._numPages=u,this._buttons.push(i?{rect:new g(0,e-M.h,j+F,k),data:0}:{rect:new g(d-M.w-F,0,j,e),data:0}),this._boxGroup={type:"group",children:s,transform:null},z}function v(a,b){var c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,z,A,B={};for(r=[],s=[],g=this._colorItems,m=g.length,t=[],u=[],d=this.rect.width,f=this.rect.height,A=0,z=0,i=Math.min(d,L.w),j=!this.isHorizontal(),y.apply(this,[B,this.rect,j?b:a,j,"bottom"===this.dock]),j?(A=b+N.padding,z=F,v=Math.min(N.maxLength,f-b-2*N.padding)):(v=Math.min(N.maxLength,d-2*a-2*N.padding),z=Math.max(a+N.padding,Math.ceil(Math.max(0,(d-v)/2))),A=f/2),B.x=z,B.y=j?A:P/2-1,w=Math.floor(v/m),c=0;m>c;c++)j?(h=g[c],t.push([h.grad[0].toHex(),h.grad[1].toHex()]),u.push({visible:0===c||c===m/2,text:h.max,maxWidth:j?d-N.width-F:2*w,width:this._renderer.getTextWidth(h.max,this._style.label.font),height:this._renderer.getFontHeight(this._style.label.font)})):(h=g[m-c-1],t.push([h.grad[1].toHex(),h.grad[0].toHex()]),u.push({visible:0===c||c===m/2,text:h.min,maxWidth:j?i-N.width-5:2*w,width:this._renderer.getTextWidth(h.max,this._style.label.font),height:this._renderer.getFontHeight(this._style.label.font)}));for(u.push(j?{visible:!0,text:h.min,maxWidth:j?d-N.width-F:2*w,width:this._renderer.getTextWidth(h.min,this._style.label.font),height:this._renderer.getFontHeight(this._style.label.font)}:{visible:!0,text:h.max,maxWidth:j?i-N.width-N.limitTextPadding:2*w,width:this._renderer.getTextWidth(h.min,this._style.label.font),height:this._renderer.getFontHeight(this._style.label.font)}),k=N.limitTextPadding,l=0,n=0,o=w,c=0;m>c;c++)s.push({fill:{gradient:{limits:[0,1],colors:t[c],x0:k,x1:n,y0:l,y1:o}},type:"rect",opacity:this._globalAlpha,shape:{height:w,width:N.width,x:k,y:l}}),l=o,o=l+w;for(l=o,o=l+w,j?B.innerHeight=w*m:B.innerWidth=w*m,c=0;c<u.length;c++){var C;j?(p=z+N.width+N.limitTextPadding+N.verticalTextPadding,q=A+w*c,C=0===c?"hanging":c===u.length-1?"alphabetic":"middle"):(p=z+w*c,q=A+N.width,C="bottom"),u[c].visible&&r.push({type:"text",fill:this._style.label.color,opacity:this._globalAlpha,shape:{text:u[c].text+"",lineHeight:13,font:this._style.label.font,color:this._style.label.color,x:p,y:q,maxWidth:u[c].maxWidth,maxNumLines:1,align:j?"left":"center",baseline:C}})}return x=new e,j?x.translate(z,A):(x.translate(z,P/2),x.rotate(-Math.PI/2),x.scale(-1,1)),this._gradientGroup={type:"group",opacity:this._globalAlpha,children:s,transform:x.elements},this._boxGroup={type:"group",children:[this._gradientGroup].concat(r)},this._numPages=0,B}function w(a,b){b&&(this.isHorizontal()?(a.x=Math.max(0,this._legendMetrics.x-a.w-O),a.y="bottom"===this.dock?P+(this.rect.height-P)/2:this.rect.height/2):(a.x="scale"===this._mode?F:"left"===this.dock?F-I.pad:2*F-I.pad,a.y=this._legendMetrics.y-a.h/2-("scale"===this._mode?N.padding:0)),"scale"===this._mode&&(a.y=this.isHorizontal()?P/2-1:0),this._titleItem=[{fill:this._style.title.color,type:"text",shape:{text:this._colorMap.getLegendTitle(),font:this._style.title.font,maxNumLines:1,maxWidth:a.w,baseline:"scale"===this._mode?"top":"middle",x:a.x,y:a.y}}]),this._showTitle?(this._buttonRenderer.shapes=this._titleItem,this._buttonRenderer.render()):this._buttonRenderer.clear()}function x(a,b){var c=d.measureTextObject({shape:{text:this._colorMap.getLegendTitle(),font:this._style.title.font,maxWidth:G-O,maxNumLines:1}});a.tw=Math.ceil(c.width),a.th=c.height,a.w=b?Math.min(a.tw,this.rect.width-O):Math.min(a.tw,Math.min(G-O,this.rect.width)),a.h=Math.ceil(Math.min(2,Math.ceil(a.tw/a.w))*a.th),a.h=isNaN(a.h)?0:a.h}function y(a,b,c,d,e){"box"===this._mode?d?(a.maxItemsPerRow=Math.max(1,Math.floor((b.width-(this._showTitle?L.w:0)-M.w-M.pad)/L.w)),a.maxNumRows=Math.floor((b.height-(this._showTitle?this._cellHeight:0)-M.h)/this._cellHeight),a.numRows=Math.ceil(this._colorItems.length/a.maxItemsPerRow),a.itemsPerRow=Math.ceil(this._colorItems.length/a.numRows),a.w=Math.min(b.width,a.itemsPerRow*L.w),a.h=Math.min(b.height-(d?M.h:0)-(this._showTitle?this._cellHeight:0),Math.max(c,a.maxNumRows*this._cellHeight))):(a.maxItemsPerRow=Math.floor((b.width-(this._showTitle?G:0)-M.w-2*M.pad)/L.w),a.numRows=Math.ceil(this._colorItems.length/a.maxItemsPerRow),a.itemsPerRow=Math.ceil(this._colorItems.length/a.numRows),a.w=a.itemsPerRow*L.w,a.h=Math.min(this._maxRelevantHeight,Math.max(c,Math.ceil(a.numRows)*this._cellHeight+(e?P:0)))):d?(a.h=Math.min(N.maxLength,b.height-c-2*N.padding),a.w=G,a.innerWidth=N.width+N.limitTextPadding,a.innerHeight=a.h):(a.w=Math.min(N.maxLength,b.width-2*c-2*N.padding),a.h=Math.max(c,N.totalWidth),a.innerWidth=a.w,a.innerHeight=N.width+N.limitTextPadding)}function z(a,b){var c,d,e,f,g,h;for(d=function(a){return a.selected},c=0;c<this._boxGroup.children.length;c++)if(e=this._boxGroup.children[c],f=e.id.toString(),a){if(g=this._position+this._legendMetrics.y,h=this._legendMetrics.y+this._position+this._legendMetrics.h,e.y>=g){if(!(e.y<h))break;e.opacity="range"===e.selectionType?void 0!==this._selectedRange[e.id.toString()]||"-1"===f?1:this._globalAlpha:this._cacheMap[c]&&this._cacheMap[c].some(d)||"-1"===f?1:this._globalAlpha,b.push(e)}}else if(g=this._position+this._legendMetrics.x-L.w,h=this._legendMetrics.x+this._position+this._legendMetrics.w,e.x>=g){if(!(e.x<h))break;e.opacity="range"===e.selectionType?void 0!==this._selectedRange[e.id.toString()]||"-1"===f?1:this._globalAlpha:this._cacheMap[c]&&this._cacheMap[c].some(d)||"-1"===f?1:this._globalAlpha,b.push(e)}}function A(){if(this._selectableShapes&&this._data){var a,b=this._cacheMap={},c={},d=0,e=!this.getSelectionIndices()[0]&&this._data.qHyperCube&&this._data.qHyperCube.qDimensionInfo.length>1;this._selectableShapes.forEach(function(f){a=e&&f.parent?f.parent.data?f.parent.data.qElemNo:f.parent.id:f.id,-2!==a&&(void 0===c[a]&&(c[a]=d,b[c[a]]=[],d++),b[c[a]].push(f))},this)}}function B(a){var b={backgroundColor:a.getValue(R,null,"backgroundColor"),label:{font:a.getValue(R,"label","fontSize")+" '"+a.getValue(R,"label","fontFamily")+"'",color:a.getValue(R,"label","color"),lineHeight:.8},ticks:{color:"#a6a6a6",length:8},line:{color:"#666666"},title:{font:a.getValue(R,"title","fontSize")+" '"+a.getValue(R,"title","fontFamily")+"'",color:a.getValue(R,"title","color"),lineHeight:1.4}};return b}function C(a,b){var c,d;switch(isNaN(a)&&(a=this._position),this.dock){case"right":case"left":c=this._cellHeight;break;default:c=L.w}d=a%c,a+=c/2>d?-d:c-d,a=0>a?0:a,b||void 0===b?this._snapTween.stop().from({_position:this._position}).to({_position:a}).start():(this._position=a,this.invalidateDisplay("Legend.snapToPosition"))}var D,E=".legend",F=10,G=126,H=2,I={h:12,w:12,pad:4},J={w:12,pad:4,strokeWidth:2},K={r:6,pad:4},L={w:106},M={h:32,w:32,pad:5},N={maxLength:300,padding:20,width:18,verticalTextPadding:5,limitTextPadding:0,leftPadding:10,totalWidth:38},O=8,P=8,Q={scrolling:!1,x0:0,x1:0,y0:0,y1:0},R="legend";return D=c.extend("Legend",{init:function(){this._super.apply(this,arguments);var c=this;this.innerRect=new g(0,0,0,0);var e;this._$renderAreaWrap&&this._$renderAreaWrap.addClass("qv-chart-component-legend"),this._styleService=b.getInstance(),this._renderer=new d(this.container,{name:"legend",storeObjects:!0}),this._buttonRenderer=new d(this.container,{name:"legend-buttons",storeObjects:!0}),this.renderers={legend:this._renderer,"legend-title":this._buttonRenderer},this._$upButton=a('<button class="qui-plainbuttonicon" data-icon="R" />').appendTo(a(this.container)),this._$downButton=a('<button class="qui-plainbuttonicon" data-icon="S"/>').appendTo(a(this.container)),this._$leftButton=a('<button class="qui-plainbuttonicon" data-icon="T" />').appendTo(a(this.container)),this._$rightButton=a('<button class="qui-plainbuttonicon" data-icon="U" />').appendTo(a(this.container)),e={position:"absolute",display:"none",height:"32px"},a(this._$upButton).css(e),a(this._$downButton).css(e),this._$upButton.css({position:"absolute",left:"50%",bottom:"0px"}),this._$downButton.css({position:"absolute",right:"50%",bottom:"0px"}),a(this._$leftButton).css(e),a(this._$rightButton).css(e),this._$leftButton.css({position:"absolute",right:"5px",top:"50%"}),this._$rightButton.css({position:"absolute",right:"5px",bottom:"50%"}),this._invalid=!0,this._legendMetrics=null,this._colorMap=null,this._data=null,this._usedPage=0,this._position=0,this._boxGroup=[],this._transform={x:0,y:0},this._colorItems=[],this._boxItems=[],this._buttons=[],this._cacheItems=null,this._pagingMode=0,this._titleItem=[],this._selectedRange={},this._cacheMap={},this._viewBoxRect=new g(0,0,0,0),this._snapTween=new l(this,{},{duration:400,easing:a.easing.easeOutBounce}).progress(function(){c.invalidateDisplay("Legend.snapTween")})},setColorMap:function(a){this._colorMap=a,this._invalid=!0,this.invalidateProperties("Legend.setColorMap"),this.invalidateDisplay("Legend.setColorMap")},getColorMap:function(){return this._colorMap},setData:function(a){this._super(a),this._invalid=!0,this.invalidateProperties("Legend.setData"),this.invalidateDisplay("Legend.setData")},setShowTitle:function(a){this._showTitle=a,this._invalid=!0},setGlobalOpacity:function(a,b){this._super(a,b)},setSelectableShapes:function(a){this._colorMap&&(this._cacheItems=a,this._super(a),A.apply(this),this.invalidateDisplay("Legend.setSelectableShapes"))},getSelectionIndices:function(){return this._colorMap.getSelectionIndices()},getSelectionMode:function(){return this._selectionDisabled?"none":"scale"!==this._mode&&"item"===this._boxType?this._colorMode:"range"===this._boxType?"range":this._mode},setSelectedRange:function(a){var b=a+"";this._selectedRange[b]?delete this._selectedRange[b]:this._selectedRange[b]=a,this._invalid=!0,this.invalidateDisplay("Legend.setSelectedRange")},clearSelectedRange:function(){this._selectedRange={}},getScrollPosition:function(){return this._position},setScrollPosition:function(a){this._position=a,this._invalid=!0,this.invalidateDisplay("Legend.setScrollPosition")},isVisible:function(a){return this._super(a)},_updateSize:function(){this._invalid=!0,this.invalidateDisplay("Legend._updateSize")},_update:function(){this._updateDisplay()},_updateProperties:function(){if(this._colorMap&&this._data){this._style=B(this._styleService),this._cellHeight=2*this._renderer.getFontHeight(this._style.label.font)+2,this._maxRelevantHeight=this._cellHeight*H+("bottom"===this.dock?P:0),this._markerTopPadding=Math.floor(this._cellHeight/2)-I.h/2;var a,b;for(this._colorItems=this._colorMap.getColorMapping().concat(),this._shapes=[],this._hitRects=[],this._hitBoxes=[],b=this._colorMap.getLegendMode(),this._mode=b[0],this._boxType=b[1],this._colorMode=b[2],this._selectionDisabled=!!b[3],a=0;a<this._colorItems.length;a++)this._shapes.push(new g(0,0,0,0)),this._hitRects.push(new g(0,0,0,0));this._invalid=!0}},calculatePreliminaryRelevantSize:function(){this.relevantSize=0,this._updateProperties(),this._shapes&&0!==this._shapes.length&&(this.relevantSize=70)},calculateRelevantSize:function(a){this._super(),this.relevantSize=0;var b=this._cellHeight,c={},d={};
this._shapes&&0!==this._shapes.length&&(this._showTitle&&(x.apply(this,[c,!this.isHorizontal()]),b=Math.max(b,c.h)),this._shapes&&this._shapes.length>0&&(this.relevantSize=G),("bottom"===this.dock||"top"===this.dock)&&("scale"===this._mode?this.relevantSize=Math.max(b,N.totalWidth):this._colorItems&&this._colorItems.length&&a.width?(y.apply(this,[d,a,b,!1,"bottom"===this.dock]),this.relevantSize=d.h):this.relevantSize=0))},hasValidData:function(){return this._super()&&this._colorMap&&this._data},paint:function(){this._super(this._layoutMode,this._data),this._precision=this._colorMap._precision,this._exponentUsed=this._colorMap._exponentUsed;var a,b,c,d,h,i,j,k=!this.isHorizontal(),l=f.isInEditMode(),n=this;if(a={w:0,h:0,th:0,tw:0,x:0,y:0},this._invalid&&(this.innerRect=this.rect,this._showTitle&&x.apply(this,[a,k]),"box"===this._mode?(this._legendMetrics=u.apply(this,[a.w+O,a.h]),this.innerRect=new g(this.rect.x+this._legendMetrics.x,this.rect.y+this._legendMetrics.y,this._legendMetrics.w,this._legendMetrics.h)):"scale"===this._mode&&(this._legendMetrics=v.apply(this,[a.w,a.h]),this.innerRect=new g(this.rect.x+this._legendMetrics.x,this.rect.y+this._legendMetrics.y,this._legendMetrics.innerWidth,this._legendMetrics.innerHeight))),k?(this._position=Math.max(0,Math.min(this._position,this._cellHeight*this._legendMetrics.numRows-this._legendMetrics.h)),this._transform={x:0,y:this._position}):(this._position=Math.max(0,Math.min(this._position,L.w*(this._legendMetrics.numCols-1)-this._legendMetrics.w)),this._transform={x:this._position,y:0}),this._position=isNaN(this._position)?0:this._position,b=new e,b.translate(-this._transform.x,-this._transform.y),this._$downButton.css({display:"none"}),this._$rightButton.css({display:"none"}),this._$upButton.css({display:"none"}),this._$leftButton.css({display:"none"}),"box"===this._mode){if(this._boxGroup.transform=b.elements,this._renderer.viewBox={rect:m(this._viewBoxRect,this._legendMetrics.x,this._legendMetrics.x+this._legendMetrics.w,this._legendMetrics.y,this._legendMetrics.y+this._legendMetrics.h),type:"clip"},this._numPages>1&&f.view!==f.Views.story&&(k?(this._$downButton.prop("disabled",l),this._$downButton.css({display:""})):(this._$rightButton.prop("disabled",l),this._$rightButton.css({display:""})),k?(this._$upButton.prop("disabled",l),this._$upButton.css({display:""})):(this._$leftButton.prop("disabled",l),this._$leftButton.css({display:""}))),d=[],z.apply(this,[k,d]),this._cacheItems&&this._cacheItems.length&&"item"===this._boxType&&"dimension"===this._colorMode){this._cacheItems.forEach(this._cacheItems[0].objectShapes?function(a){a.objectShapes[n.selectionIdentifier]=null}:function(a){a.clearShapes(n.selectionIdentifier)}),j=k?function(a){a.addShape(n.selectionIdentifier,new g(n._hitRects[h].x,n._hitRects[h].y-n._position,n._hitRects[h].width,n._hitRects[h].height))}:function(a){a.addShape(n.selectionIdentifier,new g(n._hitRects[h].x-n._position,n._hitRects[h].y,n._hitRects[h].width,n._hitRects[h].height))},h=0;for(i in this._cacheMap)this._hitRects[i]&&this._cacheMap[i].forEach(j),h++}c={children:d,transform:this._boxGroup.transform,type:"group"}}else this._renderer.viewBox=null,c=this._boxGroup;this._renderer.shapes=[c],w.apply(this,[a,this._invalid]),this._renderer.render(),this._invalid=!1},getValueOfPosition:function(a){var b,c,d,e;return this.isVertical()?(c=this._legendMetrics.innerHeight,d=this._colorItems[0].id[0],e=this._colorItems[this._colorItems.length-1].id[1]):(c=this._legendMetrics.innerWidth,e=this._colorItems[0].id[0],d=this._colorItems[this._colorItems.length-1].id[1]),b=a===c?e:d-a/c*(d-e)},checkHitItems:function(a,b){if(this._hitBoxes){var c,d,e,f,g=n(this._hitBoxes,a+this._transform.x,b+this._transform.y);if(g&&"range"===g.type){this.setSelectedRange(g.id),c=[];for(d in this._selectedRange)c=c.concat(this._selectedRange[d]);if(c.sort(function(a,b){return b-a}),e=2===c.length&&c[0]===c[1],!e)for(f=0;f<c.length;f++)c[f]===c[f+1]&&(c.splice(f,2),f--);g.id=c,g.isMax=g.id[0]===this._colorItems[0].id[0],g.replace=!0}return g}return{type:"cancel"}},clear:function(){this._super(),this._$downButton.hide(),this._$rightButton.hide(),this._$upButton.hide(),this._$leftButton.hide()},on:function(){var b,c,d=this;this._scrollFunc=k.throttle(function(a){var b,c=k.getMouseWheelData(a.originalEvent);b=Math.floor(d._position)-(c.delta>0?1:-1)*("right"===d.dock||"left"===d.dock?d._cellHeight:L.w),b=0>b?0:b,C.apply(d,[b,!1])},20),a(this.container).on("mousewheel"+E+" DOMMouseScroll"+E,this._scrollFunc),c=function(a){d._position+=a,d.invalidateDisplay("Legend.buttonClick")},b=function(a,b){var e=!1;Touche(a).longtap({options:{timeThreshold:1e4},update:function(a,d){d.percentage>1&&(c(20*b),e=!0)},end:function(){e=!1,Touche.preventGestures(this.gestureHandler)},cancel:function(){Touche.preventGestures(this.gestureHandler)}}).tap({end:function(){e?C.call(d):c(b*("right"===d.dock||"left"===d.dock?d._cellHeight:L.w)),e=!1}})},b(this._$upButton[0],-1),b(this._$downButton[0],1),b(this._$leftButton[0],-1),b(this._$rightButton[0],1),Touche(this.container).swipe({options:{useMomentum:!0,inertia:.7},start:function(){"box"!==d._mode||f.isInEditMode()||(Q.scrolling=!0,Q.x0=d._position,Q.y0=d._position)},update:function(a,b){if(b.swipe&&Q.scrolling){var c=b.swipe.distance;d.isHorizontal()?"left"===b.swipe.direction?(d._position=Q.x0-c,d.invalidateDisplay("Legend.swipe")):"right"===b.swipe.direction&&(d._position=Q.x0+c,d.invalidateDisplay("Legend.swipe")):"up"===b.swipe.direction?(d._position=Q.y0-c,d.invalidateDisplay("Legend.swipe")):"down"===b.swipe.direction&&(d._position=Q.y0+c,d.invalidateDisplay("Legend.swipe"))}},end:function(){Q.scrolling=!1,C.call(d),"box"===d._mode&&Touche.preventGestures(this.gestureHandler)}})},off:function(){this._scrollFunc&&(a(this.container).off("mousewheel"+E+" DOMMouseScroll"+E,this._scrollFunc),this._scrollFunc=null),Touche(this.container).off(),Touche(this._$upButton[0]).off(),Touche(this._$downButton[0]).off(),Touche(this._$leftButton[0]).off(),Touche(this._$rightButton[0]).off()}}),Object.defineProperties(D.prototype,{pagingMode:{get:function(){return this._pagingMode},set:function(a){this._pagingMode=a}}}),Object.defineProperty(D.prototype,"className",{value:"Legend"}),D}),define("objects.views/charts/components/ref-lines",["./chart-component","core.utils/theme","objects.views/charts/utils/canvas-renderer"],function(a,b,c){function d(a){return Number(void 0!==a.value?a.value:a)}function e(a){return b.palette[a]?b.palette[a]:a}function f(){if(!this._numRefLinesDataAxes||!this._numAxes)return!1;var a,b,c,e,f,g,h;for(a=0;a<this._numAxes;a+=1)for(c=this._axes[a],g=c.getPlotMin(),h=c.getPlotMax(),this._axisPlotMinValues[a]=g,this._axisPlotMaxValues[a]=h,e=this._data[a]||[],b=0;b<e.length;b+=1)if(f=d(e[b].refLineExpr),e[b]&&e[b].show&&void 0!==e[b].refLineExpr&&null!==f&&!isNaN(f)&&f>=g&&h>=f)return!0;return!1}function g(){var a,b,c,d;for(a=0;a<this._numAxes;a+=1)if(b=this._axes[a],c=b.getPlotMin(),d=b.getPlotMax(),this._axisPlotMinValues[a]!==c||this._axisPlotMaxValues[a]!==d)return!0;return!1}function h(){var a,b;for(a=0;a<this._numAxes;a+=1)b=this._axes[a],this._axisPlotMinValues[a]=b.getPlotMin(),this._axisPlotMaxValues[a]=b.getPlotMax()}var i,j="#333";return i=a.extend("RefLines",{init:function(){this._super.apply(this,arguments),this.renderer=new c(this.container),this.renderer.edgeBleed={top:1,left:1,right:0,bottom:0},this._$renderAreaWrap.addClass("qv-chart-component-reflines"),this._hasVisibleRefLines=!1,this._numAxes=0,this.renderers={lines:this.renderer}},setData:function(){this._super.apply(this,arguments),this._numRefLinesDataAxes=void 0===this._data?0:this._data.length,this._hasVisibleRefLines=f.call(this),h.call(this)},setAxes:function(a){var b=this;this._axes=a,this._axes.forEach(function(a){a.listen("changed",function(){this.invalidateDisplay()},b)}),this._numAxes=void 0===a?0:a.length,(void 0===this._axisPlotMinValues||this._axisPlotMinValues.length!==this._numAxes)&&(this._axisPlotMinValues=new Array(this._numAxes)),(void 0===this._axisPlotMaxValues||this._axisPlotMaxValues.length!==this._numAxes)&&(this._axisPlotMaxValues=new Array(this._numAxes))},isVisible:function(){var a=this._super.apply(this,arguments);return a&&this._numAxes&&this._numRefLinesDataAxes?(g.call(this)&&(this._hasVisibleRefLines=f.call(this),h.call(this)),this._hasVisibleRefLines):!1},hasValidData:function(){return this._super()&&this._numRefLinesDataAxes&&this._numAxes},paint:function(){if(this._super.apply(this,[].slice.call(arguments)),g.call(this)&&(this._hasVisibleRefLines=f.call(this),h.call(this)),this._hasVisibleRefLines){var a,b,c,d,i,k,l,m,n,o,p,q,r,s=[];for(a=0;a<this._numRefLinesDataAxes;a+=1)for(c=this._data[a],d=this._axes[a],i=this._axisPlotMinValues[a],k=this._axisPlotMaxValues[a],b=0;b<c.length;b+=1)c[b].show&&void 0!==c[b].refLineExpr&&(l=this._currentProperties["value"+a+b],null===l||isNaN(l)||l>k||i>l||(m=d.getPositionOfValue(l),m=Math.floor(m)-.5,d.isVertical()?(n=0,o=m,p=this.rect.width,q=m):(n=m,o=0,p=m,q=this.rect.height),r=void 0!==c[b].color?e(c[b].color):j,s.push({type:"line",stroke:r,strokeWidth:1,shape:{x1:n,y1:o,x2:p,y2:q}})));this.renderer.shapes=s,this.renderer.render()}},_updateProperties:function(){if(this._data){var a,b,c=this._data,d=c.length;for(a=0;d>a;a++)if(void 0!==c[a])for(b=0;b<c[a].length;b++)this._transitionProperties["value"+a+b]=c[a][b].refLineExpr.value;this._super()}}})}),define("objects.views/charts/utils/label-positioner",[],function(){var a;return a={positionRectanglesAlongAxis:function(a,b,c,d,e){function f(){if(0===r)return s=[],void(t=0);var c,d,e,f,g;for(s=[[0]],c=1;r>c;c++)d=a[c].position,e=a[c].size,f=a[c-1].position,g=a[c-1].size,f+g/2+b>d-e/2?s[s.length-1].push(c):s.push([c]);t=s?s.length:0}function g(){0!==r&&(h(),i(),k(),u=j(),u||l())}function h(){var d,e,f,g,h;for(e=a[0].position,f=a[0].size,e=Math.max(c,e-f/2)+f/2,a[0].newPosition=e,d=1;r>d;d++)g=a[d-1].newPosition,h=a[d-1].size,e=a[d].position,f=a[d].size,e=Math.max(g+h/2+b,e-f/2)+f/2,a[d].newPosition=e}function i(){var e,f,g,h,i;if(f=a[r-1].newPosition,g=a[r-1].size,f+g/2>d)for(a[r-1].newPosition=d-g/2-c,e=r-2;e>=0;e--)h=a[e+1].newPosition,i=a[e+1].size,f=a[e].newPosition,g=a[e].size,f=Math.min(h-i/2-b,f+g/2)-g/2,a[e].newPosition=f}function j(){var d,e,f,g=a[0].newPosition,h=a[0].size;if(c>g-h/2)return!0;if(g-h/2>c)return!1;for(d=1;r>d;d++)if(e=a[d-1].newPosition,f=a[d-1].size,g=a[d].newPosition,h=a[d].size,g-h/2>e+f/2+b)return!1;return!0}function k(){var b,c,d,e,f,g,h,i,j,k,l,m;for(v&&v.length===t||(v=new Array(t)),b=0;t>b;b+=1)c=s[b],d=c[0],e=c[c.length-1],f=a[d],g=a[e],j=f.position,h=f.size,l=f.newPosition-h/2,k=g.position,i=g.size,m=g.newPosition+i/2,v[b]={firstPosition:j,lastPosition:k,minPosition:l,maxPosition:m}}function l(){m(0,c);for(var a=1;t>a;a++)m(a,v[a-1].maxPosition+b)}function m(a,b){var c=s[a];c.length%2===0?n(a,b):o(a,b)}function n(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,q;d=s[b],e=d[0],f=d[d.length/2-1],g=d[d.length/2],h=a[e],i=a[f],j=a[g],l=h.newPosition,k=h.size,n=(i.position+j.position)/2,o=(i.newPosition+j.newPosition)/2,q=o-n,m=l-q,p(b,l,m,k,c)}function o(b,c){var d,e,f,g,h,i,j,k,l,m,n;d=s[b],e=d[0],f=d[(d.length-1)/2],g=a[e],h=a[f],i=g.newPosition,j=g.size,k=h.position,l=h.newPosition,m=l-k,n=i-m,p(b,i,n,j,c)}function p(a,b,c,d,e){if(!(c>=b)){c=Math.max(e+d/2,c);var f=b-c;v[a].minPosition-=f,v[a].maxPosition-=f,q(a,f)}}function q(b,c){var d,e,f,g=s[b],h=g?g.length:0;for(d=0;h>d;d++)e=g[d],f=a[e],f.newPosition-=c}var r,s,t,u,v;r=a?a.length:0,e!==!0&&a.sort(function(a,b){return a.position>b.position?1:-1}),f(),g()}}}),define("objects.views/charts/components/ref-line-labels",["./chart-component","core.utils/theme","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/label-positioner","util"],function(a,b,c,d,e){function f(a){var b,d,e,f,g=a?a.length:0;for(b=0;g>b;b++)d=a[b],e=d.shapeWrapper,f=c.measureTextObject(e),d.size=f.height,d.info=f}function g(a){return b.palette[a]?b.palette[a]:a}function h(a,b,c,d,e,f){return void 0===e&&(e=Number.MAX_VALUE),void 0===f&&(f=1),{type:"text",fill:"black",shape:{text:a,font:b,x:c,y:d,align:L,baseline:M,maxWidth:e,maxNumLines:f}}}function i(a){if(void 0===a||""===a)return 0;F.shape.text=a;var b=c.measureTextObject(F);return b.width}function j(a){return void 0===a||""===a?0:(H.shape.text=a,c.measureTextObject(H))}function k(a){if(void 0===a||""===a)return 0;G.shape.text=a;var b=c.measureTextObject(G);return b.width}function l(a,b){return void 0===a||""===a?{numLines:0,width:0,height:0,lines:[]}:(G.shape.text=a,G.shape.maxWidth=b,c.measureTextObject(G))}function m(a,b,c){if(void 0===a||""===a)return{index:-1,width1:0,width2:0,width:0};void 0===b&&(b=i(a));for(var d,e,f,g,h=Number.MAX_VALUE,j=a.length,k=Math.floor(j/2),l=a.substring(0,k),m=0,n=!0,o=l.lastIndexOf(" ");o>-1&&n;)l=a.substring(0,o),d=i(l),e=b-d-c,f=Math.max(d,e),f>h?n=!1:(h=f,m++,g={index:o,width1:d,width2:e,width:h},o=l.lastIndexOf(" "));if(m>1)return g;for(o=a.indexOf(" ",k),m=0;o>-1;){if(l=a.substring(o+1),e=i(l),d=b-e-c,f=Math.max(d,e),f>h)return g;h=f,m++,g={index:o,width1:d,width2:e,width:h},o=a.indexOf(" ",o+1)}return void 0===g&&(g={index:-1,width1:0,width2:b,width:b}),g}function n(a,b,c){if(void 0===a||""===a)return{index1:-1,index2:-1,width1:0,width2:0,width3:0,width:0};void 0===b&&(b=i(a));for(var d,e,f,g,h,j,k,l=Number.MAX_VALUE,n=a.length,o=Math.floor(n/3),p=a.substring(0,o),q=0,r=!0,s=p.lastIndexOf(" ");s>-1&&r;)p=a.substring(0,s),d=a.substring(s+1),f=i(d),e=b-f-c,j=m(d,f,c),h=j.width,g=Math.max(e,h),g>l?r=!1:(l=g,q++,k={index1:s,index2:j.index,width1:e,width2:j.width1,width3:j.width2,width:l},s=p.lastIndexOf(" "));if(q>1)return k;for(s=a.indexOf(" ",o),q=0;s>-1;){if(d=a.substring(s+1),f=i(d),e=b-f-c,j=m(d,f,c),h=j.width,g=Math.max(e,h),g>l)return k;l=g,q++,k={index1:s,index2:j.index,width1:e,width2:j.width1,width3:j.width2,width:l},s=a.indexOf(" ",s+1)}return void 0===k&&(k={index1:-1,index2:-1,width1:0,width2:0,width3:b,width:b}),k}function o(a,b,c,d,e){var f;if(c>=b)return{minTextWidth:b,level:1};if(2*c>=b){if(f=m(a,b,d),f.width<=c)return{minTextWidth:f.width,level:0===f.width1?3:2};if(0===f.width1)return{minTextWidth:Math.ceil(f.width/2)+e,level:3}}return 3*c>b?(f=n(a,b,d),0===f.width1&&0===f.width2?{minTextWidth:Math.min(Math.ceil(f.width/3)+Math.ceil(3*e/2),c),level:3}:{minTextWidth:Math.min(f.width,c),level:3}):{minTextWidth:c,level:3}}function p(a,b,c,d,e,f){a.size=b,a.size2=c,a.numLines=d,a.level=e,a.info=f}function q(a,b,c,d){if(!(a.size/2<=b||3===a.numLines||3===a.level)){var e,f;if(2===a.numLines)return e=n(a.text,a.singleLineTextWidth,c),f=l(a.text,e.width),void p(a,e.width,f.height,f.numLines,3,f);if(e=m(a.text,a.singleLineTextWidth,c),0!==e.width1){if(e.width/2<=b||d===!0)return f=l(a.text,e.width),void p(a,e.width,f.height,f.numLines,2,f);e=n(a.text,a.singleLineTextWidth,c),f=l(a.text,e.width),p(a,e.width,f.height,f.numLines,3,f)}}}function r(a,b,c,d){var e,f;a.position+a.size/2+c>b.position-b.size/2&&(a.size>b.size?(e=a,f=b.position-b.size/2-c-a.position):(e=b,f=b.position-(a.position+a.size/2+c)),q(e,f,d,!0))}function s(a,b,c,d,e,f,g){a.singleLineTextWidth=b,a.size=c,a.size2=d,a.numLines=e,a.level=f,a.info=g}function t(a){return String(void 0!==a.label?a.label:a)}function u(a,b){var c=a,d=e.escapeRegExp("+-"+(this.chartFormatter.getLocaleInfo().qDecimalSep||"")+(this.chartFormatter.getLocaleInfo().qThousandSep||"")),f=c.replace(new RegExp("[0-9e"+d+"]","g"),"");return f=f.length?c:this._axis.format(b)}function v(a){if(this._axis&&this._data){this._axis.updateFormatter();var b,c,d,e,f,g,h=this._data?this._data.length:0,i=[],j=this._axis.getPlotMin(),k=this._axis.getPlotMax(),l=-Number.MAX_VALUE,m=Number.MAX_VALUE,n=0,o=0;for(this._plotMinValueForRelevantSize=j,this._plotMaxValueForRelevantSize=k,this._maxLowerLabelIndex=void 0,this._minUpperLabelIndex=void 0,b=0;h>b;b+=1)this._data[b]&&this._data[b].show&&void 0!==this._data[b].refLineExpr&&(c=t(this._data[b].refLineExpr),d=a?this._currentProperties["value"+b]:this._data[b].refLineExpr.value,null===d||isNaN(d)||(j>d?(n++,d>l&&(this._maxLowerLabelIndex=b)):d>k?(o++,m>d&&(this._minUpperLabelIndex=b)):(e=this._data[b].label,f=" ("+u.apply(this,[c,d])+")",g=e+f,i.push({index:b,text:g,value:d,text1:e,text2:f}))));o>0&&i.push({index:-1,text:10>o?o.toString():"9+",value:"max",type:1}),n>0&&i.push({index:-2,text:10>n?n.toString():"9+",value:"min",type:-1}),this._labelObjects=i,this._numLabelObjects=this._labelObjects?this._labelObjects.length:0,this._labelsMaxWidthNeedToUpdate=!0,this._labelsMaxHeightNeedToUpdate=!0,this._labelObjectsNeedToUpdate=!1,this._numLowerLabels=n,this._numUpperLabels=o}}function w(){if(this._labelsMaxWidthNeedToUpdate){this._labelsMaxWidthNeedToUpdate=!1;var a,b,c,d=0;for(G.shape.maxWidth=this._labelMaxWidthForYAxis,a=0;a<this._numLabelObjects;a++)if(void 0!==this._labelObjects[a].type?(b=j(this._labelObjects[a].text),c=z(b),d=Math.max(d,c+4)):d=Math.max(d,k(this._labelObjects[a].text)+4),d>=this._labelMaxWidthForYAxis)return void(this._labelsMaxWidth=this._labelMaxWidthForYAxis);this._labelsMaxWidth=d}}function x(a){return"max"===a?Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.5+(this.isVertical()?-.1:.1):"min"===a?Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.5+(this.isVertical()?.1:-.1):Math.floor(this._axis.getPositionOfValue(a))-.5}function y(){var a,b,c;for(a=0;a<this._numLabelObjects;a+=1)b=this._labelObjects[a],c=x.call(this,b.value),b.position=c}function z(a){return Math.sqrt(a.width*a.width+a.height*a.height)}function A(){if(this._labelsMaxHeightNeedToUpdate){this._labelsMaxHeightNeedToUpdate=!1,y.call(this);var a,b,c,e=0;for(this.calculateLabelWidths(this._labelObjects,this._componentWidth,this._horizontalLabelGap,this._boundaryGap,this._labelMaxWidthForXAxis),d.positionRectanglesAlongAxis(this._labelObjects,this._horizontalLabelGap,this._boundaryGap,this._componentWidth,!0),a=0;a<this._numLabelObjects;a+=1)void 0!==this._labelObjects[a].type?(b=j(this._labelObjects[a].text),c=z(b),e=Math.max(e,c)):e=Math.max(e,this._labelObjects[a].size2);this._labelsMaxHeight=e}}function B(a){var b,c,d=0,e=a.length-1;for(b=0;e>b;b++)c=a[b],d+="-"===c.substr(c.length-1,1)?c.length-1:c.length+1;return d}function C(a,b){I.shape.text=a,I.shape.maxWidth=b;var d=c.measureTextObject(I);return d.lines[0]}function D(a){var b,c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s=a?a.length:0;for(b=0;s>b;b++)c=a[b],d=c.info,d&&d.truncated===!0&&(e=d.lines,f=c.text,g=c.text1,h=c.text2,l=e[e.length-1],m=B(e),n=f.indexOf(l.substring(0,l.length-1),m),0>n||(j=g.substring(n),r=i(h),q=d.width-r-2,P>q?p=g.substring(0,n):(k=C(j,q),o=n+k.length-1,p=g.substring(0,o)+P),c.text=p+h,c.shapeWrapper.shape.text=c.text))}var E,F,G,H,I,J,K,L="center",M="bottom",N="#333",O="#737373",P="",Q=2;return E=a.extend("RefLineLabels",{init:function(){this._super.apply(this,arguments),this.renderer=new c(this.container),this._currentProperties={},this._transitionProperties={},this.renderers={labels:this.renderer},this._$renderAreaWrap.addClass("qv-chart-component-reflinelabels"),this._hasVisibleRefLines=!1,this._font="12px 'QlikView Sans'",this._font2="10px 'QlikView Sans'",this._labelMargin=4,this._labelMaxWidthForYAxis=70,this._labelMaxWidthForXAxis=100,this._labelMaxHeightForXAxis=50,this._verticaLabelGap=4,this._horizontalLabelGap=6,this._boundaryGap=4,F=h("",this._font,0,0,Number.MAX_VALUE,1),G=h("",this._font,0,0,Number.MAX_VALUE,3),H=h("",this._font2,0,0,Number.MAX_VALUE,1),I=h("",this._font,0,0,Number.MAX_VALUE,1)},calculateRelevantSize:function(){if(this._super(),v.call(this),this.isVertical())w.call(this),this.relevantSize=this._labelsMaxWidth+this._labelMargin;else{var a=this.rect.width?this.rect.width:this._axis._plotSize;this._componentWidth!==a&&(this._componentWidth=a,this._labelsMaxHeightNeedToUpdate=!0),A.call(this),this.relevantSize=this._labelsMaxHeight+this._labelMargin}},calculatePreliminaryRelevantSize:function(){this.relevantSize=this.isVertical()?this._labelMaxWidthForYAxis:this._labelMaxHeightForXAxis},setData:function(){this._super.apply(this,arguments),this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues(),this._labelObjectsNeedToUpdate=!0},setAxis:function(a){var b=this;this._axis=a,this._axis.listen("changed",function(){this.invalidateDisplay()},b),this._labelObjectsNeedToUpdate=!0},isVisible:function(){var a=this._super.apply(this,arguments);return a?(this._axis&&(this._plotMinValue!==this._axis.getPlotMin()||this._plotMaxValue!==this._axis.getPlotMax())&&(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues()),this._hasVisibleRefLines):!1},calculateLabelWidths:function(a,b,c,d,e){var f,g,h,j,k,m,n,p=a?a.length:0;if(0!==p){for(J=i("m m")-i("mm"),K=i("m"),f=0;p>f;f++)h=a[f],j=h.text,void 0===j||""===j?s(h,0,0,0,0,0,void 0):(k=i(j),m=o(j,k,e,J,K),n=l(j,m.minTextWidth),s(h,k,m.minTextWidth,n.height,n.numLines,m.level,n));for(a.sort(function(a,b){return a.position>b.position?1:-1}),h=a[p-1],void 0!==h.text&&""!==h.text&&q(h,b-h.position-d,J),h=a[0],void 0!==h.text&&""!==h.text&&q(h,h.position-d,J),f=0;p-1>f;f++)if(void 0!==a[f].text&&""!==a[f].text&&void 0!==a[f+1].text&&""!==a[f+1].text)for(g=0;4>g;g++)r(a[f],a[f+1],c,J)}},checkIfHavingVisibleRefLines:function(){if(!this._data||0===this._data.length||!this._axis)return!1;var a;for(a=0;a<this._data.length;a+=1)if(this._data[a]&&this._data[a].show&&void 0!==this._data[a].refLineExpr){if("value"in this._data[a].refLineExpr&&(null===this._data[a].refLineExpr.value||isNaN(this._data[a].refLineExpr.value)))continue;return!0}return!1},updateLocalPlotMaxMinValues:function(){this._axis&&(this._plotMinValue=this._axis.getPlotMin(),this._plotMaxValue=this._axis.getPlotMax())},setLabelMargin:function(a){this._labelMargin=void 0===a?4:a},hasValidData:function(){return this._super()&&this._data&&this._axis},paint:function(){if(this._super.apply(this,arguments),(this._plotMinValue!==this._axis.getPlotMin()||this._plotMaxValue!==this._axis.getPlotMax())&&(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues()),this._hasVisibleRefLines){v.call(this,!0);var a,b,e,h,i,j,k,l,m,n,o,p,q,r=this.isVertical()?"middle":"top"===this.dock?"bottom":"top",s="middle",t=this.rect.width,u=this.rect.height,w=t/2+this._labelMargin/2+1,y="top"===this.dock?u-this._labelMargin:this._labelMargin,A=new Array(this._numLabelObjects),B=this._labelMaxWidthForYAxis,C=this._font,E=w,F="top"===this.dock?(u-this._labelMargin)/2:(u+this._labelMargin)/2;for(a=0;a<this._numLabelObjects;a+=1)p=this._labelObjects[a],b=p.index,e=x.call(this,p.value),this.isVertical()?(h=w,i=e):(h=e,i=void 0!==p.type?F:y),j=b>-1&&void 0!==this._data[b].color?g(this._data[b].color):N,void 0!==p.type?(C=this._font2,q=s,j="white"):(C=this._font,q=r),k={type:"text",fill:j,shape:{text:p.text,x:h,y:i,align:"center",baseline:q,font:C,maxWidth:B,maxNumLines:3}},A[a]=k,p.position=e,p.shapeWrapper=k;if(0!==this._numLabelObjects){if(this.isVertical()){for(f(this._labelObjects),this._numUpperLabels>0&&(e=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.7,this._labelObjects.push({position:e,size:Q})),this._numLowerLabels>0&&(e=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.3,this._labelObjects.push({position:e,size:Q})),d.positionRectanglesAlongAxis(this._labelObjects,this._verticaLabelGap,this._boundaryGap,this.rect.height,!1),a=this._labelObjects.length-1;a>-1;a--)void 0===this._labelObjects[a].shapeWrapper&&this._labelObjects.splice(a,1);for(a=0;a<this._numLabelObjects;a+=1)p=this._labelObjects[a],l=p.shapeWrapper.shape,l.y=p.newPosition,1===p.type&&(m=c.measureTextObject(p.shapeWrapper),n={cx:l.x,cy:l.y,r:z(m)/2}),-1===p.type&&(m=c.measureTextObject(p.shapeWrapper),o={cx:l.x,cy:l.y,r:z(m)/2})}else{for(this.calculateLabelWidths(this._labelObjects,this.rect.width,this._horizontalLabelGap,this._boundaryGap,this._labelMaxWidthForXAxis),this._numUpperLabels>0&&(e=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.3,this._labelObjects.push({position:e,size:Q})),this._numLowerLabels>0&&(e=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.7,this._labelObjects.push({position:e,size:Q})),d.positionRectanglesAlongAxis(this._labelObjects,this._horizontalLabelGap,this._boundaryGap,this.rect.width,!1),a=this._labelObjects.length-1;a>-1;a--)void 0===this._labelObjects[a].shapeWrapper&&this._labelObjects.splice(a,1);for(a=0;a<this._numLabelObjects;a+=1)p=this._labelObjects[a],l=p.shapeWrapper.shape,l.x=p.newPosition,l.maxWidth=p.size,1===p.type&&(m=c.measureTextObject(p.shapeWrapper),n={cx:l.x,cy:F,r:z(m)/2}),-1===p.type&&(m=c.measureTextObject(p.shapeWrapper),o={cx:l.x,cy:F,r:z(m)/2})}D(this._labelObjects),this.isVertical()?(this._numUpperLabels>0&&(k={type:"polygon",fill:N,shape:{points:[{x:E-3,y:5.2},{x:E,y:0},{x:E+3,y:5.2}]}},A.push(k),k={type:"circle",fill:O,shape:n},A.splice(0,0,k)),this._numLowerLabels>0&&(k={type:"polygon",fill:N,shape:{points:[{x:E-3,y:u-5.2},{x:E,y:u},{x:E+3,y:u-5.2}]}},A.push(k),k={type:"circle",fill:O,shape:o},A.splice(0,0,k))):(this._numLowerLabels>0&&(k={type:"polygon",fill:N,shape:{points:[{x:5.2,y:F-3},{x:0,y:F},{x:5.2,y:F+3}]}},A.push(k),k={type:"circle",fill:O,shape:o},A.splice(0,0,k)),this._numUpperLabels>0&&(k={type:"polygon",fill:N,shape:{points:[{x:t-5.2,y:F-3},{x:t,y:F},{x:t-5.2,y:F+3}]}},A.push(k),k={type:"circle",fill:O,shape:n},A.splice(0,0,k))),this.renderer.shapes=A,this.renderer.render()}}},release:function(){this._super(),this._axis&&this._axis.stopListen("changed",null,this)},_updateProperties:function(){if(this._data){var a,b,c=this._data,d=c.length;for(b=0;d>b;b++)a="value"+b,this._transitionProperties[a]=c[b].refLineExpr.value;this.calculateRelevantSize(),this._super()}}})}),define("objects.views/charts/components/scroll-area",["./chart-component","objects.utils/shapes/rect","client.utils/state","jquery","touche"],function(a,b,c,d){function e(a){var c,d=this,e=this.isVertical(),f={size:e?"height":"width",pos:e?"y":"x",coord:e?"pageY":"pageX"},g=new b(0,0,0,0),h=d._$renderAreaWrap.offset();g.x=h.left,g.y=h.top,g.width=d._$renderAreaWrap.width(),g.height=d._$renderAreaWrap.height(),this.fire("scrollStart"),c=a.points[0][f.pos]-g[f.pos]-d.scrollRect[f.size]*g[f.size]/2,d.scrollRect[f.pos]=Math.max(0,Math.min(g[f.size]*(1-d.scrollRect[f.size]),c))/g[f.size],d.setOffset(d.scrollRect[f.pos]*d.fullState.max)}function f(a){var c=this,d=this.isVertical(),e={size:d?"height":"width",pos:d?"y":"x",coord:d?"pageY":"pageX"},f=c._$renderAreaWrap.offset();this._containerRect=new b(0,0,0,0),this._containerRect.x=f.left,this._containerRect.y=f.top,this._containerRect.width=c._$renderAreaWrap.width(),this._containerRect.height=c._$renderAreaWrap.height(),c.scrollRect[e.size]=c.viewState.range/c.fullState.max,this._rp=a.points[0][e.pos]-this._containerRect[e.pos]-c.scrollRect[e.pos]*this._containerRect[e.size],this._rp<0?(c.scrollRect[e.pos]=Math.max(0,c.scrollRect[e.pos]-this._rp/this._containerRect[e.size]),this._rp=0):this._rp/this._containerRect[e.size]>c.scrollRect[e.size]&&(c.scrollRect[e.pos]=Math.min(1,this._rp/this._containerRect[e.size])-c.scrollRect[e.size],this._rp=c.scrollRect[e.size]*this._containerRect[e.size]),this.fire("scrollStart")}function g(a){var b=this,c=this.options,d=this.isVertical(),e="function"==typeof c.onScroll?c.onScroll:function(){},f={size:d?"height":"width",pos:d?"y":"x",coord:d?"pageY":"pageX"},g=a.points[0][f.pos]-this._containerRect[f.pos];b.scrollRect[f.pos]=Math.max(0,Math.min(this._containerRect[f.size]*(1-b.scrollRect[f.size]),g-this._rp))/this._containerRect[f.size],b.setOffset(b.scrollRect[f.pos]*b.fullState.max),e()}function h(){if(this.miniChart){var a=this;Touche(this.miniChart.container).tap({id:n,end:function(b,c){e.call(a,c)}}),Touche(this.miniChart.container).swipe({id:n,options:{radiusThreshold:1},start:function(b,c){f.call(a,c)},update:function(b,c){g.call(a,c)}})}}function i(){this.miniChart&&(d(this.miniChart.container).off(n),Touche(this.miniChart.container).off("*",n))}function j(){this.miniChart&&(this._internalUseMiniChart?this.miniChart.showComponent():this.miniChart.hideComponent())}function k(a,b){var c=this.viewState.min;this.viewState.min=Math.max(0,Math.min(this._explicitOffset||0,(this.fullState.max||0)-(this.viewState.range||0))),this.viewState.min!==c&&(this.invalidateDisplay(a),b&&this.fire("offsetChanged"))}function l(a,b,c){var d=Array.isArray(a)?a:[a];d.forEach(function(a){c.forEach(function(b){a.style[b]=""}),a.className=b})}var m,n=".scrollarea";return m=a.extend("ScrollArea",{init:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this._useMiniChart=!0,this._internalUseMiniChart=!0,this._miniChartThreshold=.5,this._miniChartMinimunNumberOfBars=3,this.scrollRect=new b(0,0,0,0),this.fullState={min:0,max:20},this.viewState={min:0,range:10},this._$renderAreaWrap.addClass("qv-chart-component-scroll-area"),this.before=document.createElement("div"),this.bar=document.createElement("div"),this.after=document.createElement("div"),this.before.style.position="absolute",this.bar.style.position="absolute",this.after.style.position="absolute",this.before.style.backgroundColor=this.after.style.backgroundColor="rgba(0,0,0,0.1)",this.bar.style.marginTop="-1px",d(this.before).attr("tid","component.scrollArea.before"),d(this.bar).attr("tid","component.scrollArea.bar"),d(this.after).attr("tid","component.scrollArea.after"),this.container.appendChild(this.before),this.container.appendChild(this.bar),this.container.appendChild(this.after)},on:function(){var a=this;Touche(this.container).tap({id:n,end:function(b,d){c.isInEditMode()||e.call(a,d)}}),Touche(this.container).swipe({id:n,options:{radiusThreshold:1},start:function(b,d){c.isInEditMode()||f.call(a,d)},update:function(b,d){c.isInEditMode()||g.call(a,d)}}),h.call(this)},off:function(){d(this.container).off(n),Touche(this.container).off("*",n),i.call(this)},calculateRelevantSize:function(){var a,b=Touche.utils.touch?32:16;this.miniChart&&this._useMiniChart&&(this.miniChart.calculateRelevantSize(),a=this.miniChart.relevantSize,this._internalUseMiniChart=!0,j.apply(this)),this.relevantSize=this._internalUseMiniChart?a||16:b},insertAdjacentTo:function(){this._super.apply(this,[].slice.apply(arguments)),this.miniChart&&this.miniChart.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},setRect:function(){this._super.apply(this,[].slice.apply(arguments)),this.miniChart&&this.miniChart.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},setDock:function(a){this._super(a),this.miniChart&&this.miniChart.setDock(a)},getOffset:function(){return this.viewState.min},setOffset:function(a){this._explicitOffset=a,k.call(this,"ScrollArea.setOffset")},setMiniChart:function(a){i.call(this),this.miniChart=a,this.miniChart&&(this.miniChart.setDock(this.options.dock),j.apply(this)),c.isInEditMode()||a.backendApi.isSnapshot||h.call(this),this.invalidateDisplay("ScrollArea.setMiniChart")},setUseMiniChart:function(a){this._useMiniChart=a,this._internalUseMiniChart=a,j.apply(this),this.invalidateDisplay("ScrollArea.setUseMiniChart")},getUseMiniChart:function(){return this._useMiniChart},setViewRange:function(a){this.viewState.range=a,k.call(this,"ScrollArea.setViewRange",!0),this.invalidateDisplay("ScrollArea.setViewRange")},getViewRange:function(){return this.viewState.range},setSpaces:function(a){this._spaces=a},setDataRange:function(a){this.dataRange=a,this.invalidateDisplay("ScrollArea.setDataRange")},getDataRange:function(){return this.dataRange},setFullRange:function(a){this.fullState.max=a,k.apply(this,["ScrollArea.setFullRange",!0]),this.invalidateDisplay("ScrollArea.setFullRange")},isVisible:function(a){return this._super(a)&&this.viewState.range<this.fullState.max},setOuterRect:function(a,b,c,d){this._super(a,b,c,d),this.miniChart&&this.miniChart.setOuterRect(a,b,c,d)
},setLayoutToContainerRatios:function(a,b){this._super(a,b),this.miniChart&&this.miniChart.setLayoutToContainerRatios(a,b)},setContainerRect:function(a,b,c,d){this._super(a,b,c,d),this.miniChart&&this.miniChart.setContainerRect(a,b,c,d)},updateSize:function(){this._super(),this.miniChart&&this._internalUseMiniChart&&this.miniChart.isVisible()?(this.before.style.display="block",this.bar.style.border="1px solid rgba(0,0,0,0.4)",this.bar.style.backgroundColor="transparent",this.after.style.display="block",this.isVertical()?l.apply(this,[[this.before,this.bar,this.after],"qv-chart-scrollable-mini-chart-vertical",["width","left"]]):(l.apply(this,[[this.before,this.after],"qv-chart-scrollable-mini-chart-horizontal",["height","top"]]),l.apply(this,[this.bar,"qv-chart-scrollable-mini-chart-bar-horizontal",["height","top"]]))):(this.before.style.display="none",this.bar.style.backgroundColor="rgba(0,0,0,0.2)",this.bar.style.boxShadow="none",this.bar.style.border="none",this.after.style.display="none",this.isVertical()?l.apply(this,[this.bar,"qv-chart-scrollable-vertical",["width","left"]]):l.apply(this,[this.bar,"qv-chart-scrollable-horizontal",["height","top"]]))},paint:function(a,b){var c;this.bar.style.display="block",this._super(a,b),this.scrollRect[this.isVertical()?"height":"width"]=this.viewState.range/this.fullState.max,this.scrollRect[this.isVertical()?"y":"x"]=this.viewState.min/this.fullState.max,c=this.scrollRect[this.isVertical()?"height":"width"]*this.rect[this.isVertical()?"height":"width"],c=1>c?1:c,c=100*c/this.rect[this.isVertical()?"height":"width"],this.isVertical()?(d(this.before).css({height:100*this.scrollRect.y+"%",top:"0%"}),d(this.bar).css({top:100*this.scrollRect.y+"%",height:c+"%"}),d(this.after).css({top:100*this.scrollRect.y+c+"%",height:100-(100*this.scrollRect.y+c)+"%"})):(d(this.before).css({width:100*this.scrollRect.x+"%",left:"0%"}),d(this.bar).css({left:100*this.scrollRect.x+"%",width:c+"%"}),d(this.after).css({left:100*this.scrollRect.x+c+"%",width:100-(100*this.scrollRect.x+c)+"%"}))},clear:function(){this.bar.style.display="none"}}),Object.defineProperty(m.prototype,"className",{value:"ScrollArea"}),m}),define("objects.views/selections/cache-item-combo",["./cache-item-base"],function(a){var b=a.extend({addShape:function(a,b,c,d){this._super(a,b,c),void 0!==d&&(this._shapeMeasures||(this._shapeMeasures=[]),this._shapeMeasures.push(d))},getMeasuresIndecies:function(a){if(this._shapeMeasures&&void 0!==this._shapeMeasures[this._shapes.indexOf(a)]){var b=this._shapeMeasures[this._shapes.indexOf(a)];return void 0!==b?[b]:[]}return this._super()}});return b}),define("objects.views/charts/chart-data-helper",["objects.views/charts/utils/tree-node","objects.views/selections/cache-item-combo"],function(a,b){function c(a,b){var c=a?d(a):null;if(c){var e=c.getDimensions();if(e.length)return b.qText+","+e.join(",")}return b.qText}function d(a){return"P"===a.data.qType&&a.parent?a.parent.cacheItem:a.cacheItem}function e(b,c,d){if(b&&b.length){g=0,h=0,i=c&&c.length<2,j=c,k=d;var e,l=new a,m=[],n=[];return l.data.qApprMaxGlyphCount=k[0]?k[0].qApprMaxGlyphCount:0,e=f(b[0].qSubNodes,l,m,n,0),{dimensionTree:e,cacheItems:m}}return{dimensionTree:void 0,cacheItems:[]}}function f(e,m,n,o,p){var q,r,s,t,u,v;for(o[h]||(o[h]={}),s=0;s<e.length;s++)if("T"!==e[s].qType){if(q=new a,q.data.qType=e[s].qType,q.data.qMaxPos=e[s].qMaxPos,q.data.qMinNeg=e[s].qMinNeg,"P"===e[s].qType&&(l=e[s]),"V"===e[s].qType||"E"===e[s].qType||"P"===e[s].qType?(q.data.qText=e[s].qText,q.data.qNum=e[s].qNum,q.data.qValue=e[s].qValue,q.data.rowIndex=0,i?(r=new a,r.data.qType="_M",r.data.qMaxPos=q.data.qMaxPos,r.data.qMinNeg=q.data.qMinNeg,r.data.qText=j[0].qFallbackTitle,r.data.rowIndex=e[s].qRow,r.addChild(q),q=r):q.data.rowIndex=e[s].qRow):(q.data.qText="O"===e[s].qType&&k[p]?k[p].othersLabel||"":e[s].qText,k[p+1]&&(q.data.qApprMaxGlyphCount=k[p+1].qApprMaxGlyphCount),q.data.qElemNo=e[s].qElemNo,q.data.rowIndex=e[s].qRow),m.addChild(q),"V"!==e[s].qType&&"P"!==e[s].qType){var w=c(m,e[s]);if(o[h][w]&&l)u=o[h][w],q.cacheItem=u;else{u=new b(null,null,null,null,e[s].qRow,h),q.cacheItem=u,u.addDimension(q.data.qText),u.id=e[s].qElemNo;var x=d(m);if(x){u=q.cacheItem,u.parent=x,x.children.push(u),v=u.parent.getDimensions();for(t in v)u.addDimension(v[t])}o[h][w]=u}}"V"===e[s].qType&&(u=d(m),u&&(u.addMeasure(l?l.qText:q.data.qText,e[s].qValue,e[s].qText),n.contains(u)||n.push(u))),e[s].qSubNodes&&e[s].qSubNodes.length>0&&(h++,q=f(e[s].qSubNodes,q,n,o,p+("N"===e[s].qType||"O"===e[s].qType?1:0)))}return 0===--h&&g++,m}var g,h,i,j,k,l;return{prepareData:e}}),define("objects.views/charts/chart-context",["./events/event-launcher","objects.views/charts/utils/tree-node","objects.views/charts/chart-data-helper","objects.views/selections/cache-item-combo"],function(a,b,c,d){function e(a,c,d,e){var f=new b;return f.text=a,f.title=c,f.id=d,f.idx=e,f}function f(a,c){var d,e=new b;e.data.qApprMaxGlyphCount=0;for(d in c)e.data[d]=c[d];return a&&a.addChild(e),e}var g;return g=a.extend({init:function(a){this._super(),this._properties={},a&&this.refresh(a)},refresh:function(a){this._data=a,this._qDataObject=a.qHyperCube?a.qHyperCube:a.qListObject;var b;b=this._qDataObject.qDataPages&&this._qDataObject.qDataPages.length>0?this._generateDimensionTree():this._generatePivotTree(),this._dimensionTree=b?b.dimensionTree:null,this._cacheItems=b?b.cacheItems:null,this.fire("dimensionTreeChanged")},bindProperty:function(){throw new Error("ChartContext bindProperty: Deprecated")},unBindProperty:function(){throw new Error("ChartContext unBindProperty: Deprecated")},releaseAll:function(){throw new Error("ChartContext releaseAll: Deprecated")},release:function(){this._data=null,this._dimensionTree=null,this._cacheItems=null,this._qDataObject=null},_generateDimensionTree:function(){var a,c,g,h,i,j,k,l,m,n,o,p,q,r=e(),s=this.getDataMatrix(),t=this._qDataObject,u=t.qMeasureInfo,v=t.qDimensionInfo,w=t.qDataPages[0].qArea.qTop,x=t.qDataPages[0].qTails,y=u.length,z=v.length,A=s&&s[0]?s[0].length:0,B=[],C=[];for(k=0,j=0;z>j;j++)v[j].qError||(B[k]=j,k++);if(z=k,0===z)return null;for(n=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d].data.qText===b&&a[d].data.qNum===c)return d;return-1},j=0;j<s.length;j++){for(a=s[j],g=r,k=0;z>k;k++){if(c=a[k],!c)return;if(m=c.qIsOtherCell?void 0===g.data.othersIndex?-1:g.data.othersIndex:n(g.children,c.qText,c.qNum),-1===m){if(h=f(g,{qElemNo:a[k].qElemNumber,qText:a[k].qText,rowIndex:w+j,type:"dimension"}),void 0!==typeof a[k].qNum&&(h.data.qNum=a[k].qNum),c.qIsOtherCell&&(h.data.qIsOtherCell=!0,h.data.qText=v[B[k]].othersLabel||""),c.qIsTotalCell&&(h.data.qIsTotalCell=!0),g.data.qApprMaxGlyphCount=v[B[k]].qApprMaxGlyphCount,c.qIsOtherCell&&(g.data.othersIndex=g.children.length-1),o=new d([h.data.qText],null,null,null,w+j,k,h.data.qElemNo),g.cacheItem){o.parent=g.cacheItem,o.parent.children.push(o),p=o.parent.getDimensions();for(q in p)o.addDimension(p[q])}h.cacheItem=o,g=h}else g=g.children[m]}for(l=0;y>l&&A>z+l;l++)h=f(g,{qText:u[l].qFallbackTitle,qNum:a[z+l].qNum,rowIndex:w+j,type:"measure"}),g.data.qApprMaxGlyphCount=Math.max(g.qApprMaxGlyphCount,u[l].qApprMaxGlyphCount),o=g.cacheItem,o.addMeasure(h.data.qText,h.data.qNum,a[z+l].qText),0===l&&C.push(o),i=new b,i.data={qText:a[z+l].qText,qNum:a[z+l].qNum,qElemNo:a[z+l].qElemNumber,qState:a[z+l].qState},h.addChild(i)}return x&&x[0]&&(x[0].qUp>0||x[0].qDown>0)&&(r.children[r.children.length-1].incomplete=!0),{dimensionTree:r,cacheItems:C}},_generatePivotTree:function(){return c.prepareData(this._qDataObject.qStackedDataPages[0].qData,this._qDataObject.qMeasureInfo,this._qDataObject.qDimensionInfo)},_extractProperties:function(){throw new Error("ChartContext _extractProperties: Deprecated")},_updateProperty:function(){throw new Error("ChartContext _updateProperty: Deprecated")},getDataMatrix:function(){return this._qDataObject.qDataPages[0].qMatrix},getDimensionTree:function(){return this._dimensionTree},getCacheItems:function(){return this._cacheItems}})}),define("objects.views/charts/events/chart-event",["core.utils/class"],function(a){return a.extend({init:function(a){this._type=a},getType:function(){return this._type}})}),define("objects.views/charts/events/property-change-event",["objects.views/charts/events/chart-event"],function(a){return a.extend({init:function(a,b,c){this._super("propertyChange"),this.property=a,this.oldValue=b,this.newValue=c}})}),define("objects.views/charts/utils/binding",["core.utils/class","objects.views/charts/events/event-launcher","objects.views/charts/events/property-change-event"],function(a,b,c){function d(){var a,b,c,d,f,j,k,l;for(4===arguments.length?(c=new h(arguments[0]),a=arguments[1],b=arguments[2],j=arguments[3]):(c=new h(arguments[0],arguments[1]),a=arguments[2],b=arguments[3],j=arguments[4]),d=b.split("."),f=d[0],l=0;l<d.length;l++)k=new g(a,f),c.add(k),a=a&&"function"==typeof a[e(f)]?a[e(f)]():void 0,f=d[l+1];return c.startObserving(j),new i(c)}function e(a){return"get"+a.substring(0,1).toUpperCase()+a.substring(1)}function f(a,b){var d,e,f=b.substring(0,1).toUpperCase()+b.substring(1);"function"==typeof a["set"+f]&&(a[k]||(a[k]={}),void 0===a[k][b]?(d=a["set"+f],e=a.hasOwnProperty("set"+f),a["set"+f]=function(e){var g="function"==typeof a["get"+f]?a["get"+f]():void 0;return"function"==typeof a["get"+f]&&e===g?void d.call(a,e):(d.call(a,e),void a.fire(new c(b,g,e)))},a[k][b]={observers:1,original:d,isOriginalOwn:e,keep:!1}):a[k][b].observers++)}var g,h,i,j,k="__setters";return g=b.extend("Link",{init:function(a,b){this._super(),this._property=b,this._host=a},setHost:function(a){this._host===a&&this._hostObserved||(this.unobserve(),this._host=a,this.observe())},observe:function(a){if(!this._host)return void this.fire("hostPropertyValueChanged",[void 0]);f(this._host,this._property);var b=this,c=e(this._property);this._callback=function(a){a.property===b._property&&b.fire("hostPropertyValueChanged",[a.newValue])},this._callbackSimple=function(){"function"==typeof this[c]&&b.fire("hostPropertyValueChanged",[this[c]()])},a||"function"!=typeof this._host[c]||b.fire("hostPropertyValueChanged",[this._host[c]()]),this._host.listen("propertyChange",this._callback),this._host.listen(this._property+"Changed",this._callbackSimple),this._hostObserved=!0},unobserve:function(){if(this._host){if(this._callback&&this._host.stopListen("propertyChange",this._callback),this._callbackSimple&&this._host.stopListen(this._property+"Changed",this._callbackSimple),this._host[k]&&this._host[k][this._property]){var a,b=this._host[k][this._property];b.observers--,b.observers<=0&&(a="set"+this._property.substring(0,1).toUpperCase()+this._property.substring(1),b.isOriginalOwn?this._host[a]=b.original:(this._host[a]=null,delete this._host[a]),b.original=null,this._host[k][this._property]=null,delete this._host[k][this._property])}this._host=void 0,this._callback=void 0,this._callbackSimple=void 0,this._hostObserved=!1}}}),h=a.extend("Chain",{init:function(a,b){this._links=[],1===arguments.length&&"function"==typeof a?this._setter=a:(this._wannabe=a,this._wannabeProp=b)},add:function(a){var b,c=this;a.listen("hostPropertyValueChanged",function(a){if(b=c._links.indexOf(this),b===c._links.length-1)if(c._setter)c._setter(a);else{var d="set"+c._wannabeProp.substring(0,1).toUpperCase()+c._wannabeProp.substring(1);"function"==typeof c._wannabe[d]&&c._wannabe[d](a)}else c._links[b+1].setHost(a)}),this._links.push(a)},startObserving:function(a){this._links[0].observe(a)},isBroken:function(){return this._isBroken},unwatch:function(){for(var a=this._links.pop();a;)a.unobserve(),a.stopListen("hostPropertyValueChanged"),a=this._links.pop();this._setter=void 0,this._wannabe=void 0,this._wannabeProp=void 0}}),i=a.extend("ChangeWatcher",{init:function(a){this._chain=a},unbind:function(){this._chain.unwatch()}}),j={},j.bindProperty=function(a,b,c,e,f){return d(a,b,c,e,f)},j.bindSetter=function(a,b,c,e){return d(a,b,c,e)},j.getter=e,j}),define("objects.views/charts/components/mini-chart",["./chart-component","../components/axis/continuous-axis","../components/data-area","../chart-context","objects.views/charts/utils/binding","general.utils/color"],function(a,b,c,d,e,f){function g(a,b){var c,d={};if(b)for(c in a)d[c]="qHyperCube"===c?{qDataPages:[],qDimensionInfo:a.qHyperCube.qDimensionInfo.slice(),qMeasureInfo:a.qHyperCube.qMeasureInfo.slice(),qStackedDataPages:[],qMode:"S",qSize:{qcx:2,qcy:0}}:a[c];else{if(!a.reducedHyperCube)return a;d={};for(c in a)d[c]="qHyperCube"===c?a.reducedHyperCube:a[c]}return d}var h;return h=a.extend("MiniChart",{init:function(a,b){this._super.apply(this,Array.prototype.slice.call(arguments)),this.components={},this.options=b,this._chartContext=new d,this._createComponents();var c=12303291;this._colorMap=void 0,this._constantColorMap={getColorByNode:function(){return new f(c)},getColor:function(){return new f(c)}},this.components.dataArea.setColorMap&&this.components.dataArea.setColorMap(this._constantColorMap),this.components.dataArea.setLayoutMode(3),e.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree"),this._logScale=!1},setData:function(a){if(a&&a.qHyperCube){this._data=null;var b,c,d=a.qHyperCube,e=this,f=Math.min(2e3,1e4/(d.qMeasureInfo.length+1)),h=-1,i=("linechart"===a.visualization||"barchart"===a.visualization&&a.barGrouping&&"stacked"===a.barGrouping.grouping)&&d.qDimensionInfo.length>1&&"K"===d.qMode?1:0;"function"!=typeof this.backendApi.getReducedData?(this._data=g(a),this.invalidateProperties()):(b=g(a,!0),a.reducedHyperCube=b.qHyperCube,c=a.reducedHyperCube,this.backendApi.getReducedData([{qTop:0,qLeft:i,qWidth:a.qHyperCube.qDimensionInfo.length+a.qHyperCube.qMeasureInfo.length+i,qHeight:f}],h).then(function(a){c.qDataPages=a,e._data=b,i&&a&&(a[0].isReduced||a[0].qIsReduced)&&(c.qDimensionInfo=d.qDimensionInfo.slice(0,1),c.qMeasureInfo=[d.qMeasureInfo[0],d.qMeasureInfo[0]]),e.invalidateProperties()}))}},calculateRelevantSize:function(){this.relevantSize=Math.max(30,Math.min(40,this.outerRect[this.isVertical()?"width":"height"]/8))},setRect:function(a,b,c,d){this._super(a,b,c,d);for(var e in this.components)this.components[e].setRect(0,0,c,d);this.updateSize()},setOuterRect:function(a,b,c,d){this._super(a,b,c,d);for(var e in this.components)this.components[e].setOuterRect(a,b,c,d)},setLayoutToContainerRatios:function(a,b){this._super(a,b);for(var c in this.components)this.components[c].setLayoutToContainerRatios(a,b)},setContainerRect:function(a,b,c,d){this._super(a,b,c,d);for(var e in this.components)this.components[e].setContainerRect(a,b,c,d)},updateSize:function(){this._super();for(var a in this.components)this.components[a].updateSize()},isVisible:function(a){return this._super(a)&&this.rect&&this.rect.width>0&&this.rect.height>0},setLogScale:function(a){this._logScale=a,this._logScale!==!0&&(this._logScale=!1)},getLogScale:function(){return this._logScale},setHasValidData:function(a){this._super(a),Object.keys(this.components).forEach(function(b){this.components[b].setHasValidData(a)},this)},setDock:function(a){this._super(a),this.isVertical()?(this.components.measureAxis.setDock("top"),this.components.dimensionAxis.setDock("left")):(this.components.measureAxis.setDock("left"),this.components.dimensionAxis.setDock("bottom"))},paint:function(a,b){if(b&&this.isVisible()){this._super(a,b);var c;this.components.dataArea.rect=this.rect.clone(),this.components.dimensionAxis.rect=this.components.dataArea.rect,this.components.measureAxis.rect=this.components.dataArea.rect,this.components.dataArea.rect.x=0,this.components.dataArea.rect.y=0,this.components.dimensionAxis.invalidateProperties("MiniChart.paint"),this.components.dimensionAxis.updateNow(["properties"]),this.components.measureAxis.invalidateProperties("MiniChart.paint"),this.components.measureAxis.updateNow(["properties"]),this.components.dimensionAxis.calculateValuePositionMappingInfo(),this.components.measureAxis.calculateValuePositionMappingInfo();for(c in this.components)this.components[c].invalidateDisplay("MiniChart.paint")}},_createComponents:function(){var a=this.components,d=this.options;Object.keys(d.components).forEach(function(e){var f,g=[this.testId||"component",e].join("."),h=d.components[e];if(h.label=e,"function"==typeof d.components[e].clazz)f=d.components[e].clazz;else switch(e){case"dataArea":f=c;break;case"yAxis":case"measureAxis":f=b}f&&(a[e]=new f(this.container,h,g)),a[e].setUseTransition&&a[e].setUseTransition(!1)},this)},updateColorMap:function(a){if(a&&a.qHyperCube&&a.qHyperCube.qDimensionInfo[0]){var b=a.qHyperCube.qDataPages[0]&&a.qHyperCube.qDataPages[0].qIsReduced;this.components.dataArea.setColorMap&&this.components.dataArea.setColorMap(b||!a.color.auto&&"byExpression"===a.color.mode?this._constantColorMap:this._colorMap)}},updateAxis:function(a){var b,c,d,e,f,g;f=Math.min.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return a.qMin})),g=Math.max.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMax)}).map(function(a){return a.qMax})),b=this.components.measureAxis,c=this.components.dimensionAxis,b.setNiceNumberEnabled(!1),b.setLogScale(this._logScale),"barchart"===a.visualization&&(g=Math.max(0,g),f=Math.min(0,f)),e=this.components.dataArea.getMinorAxisData(),e&&(g=e.max,f=e.min),f===g&&0===g||isNaN(f)&&isNaN(g)?(g=10,f=-10,b.setDataRange(f,g)):b.setDataRange(f,g),d=this.components.dataArea.getMajorAxisData(),d?c.setDataRange(d.data,d.info):c.setDataRange([],[])},setBackendApi:function(a){this.backendApi=a},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setOrientation:function(a){this._orientation=a||"horizontal"},_updateProperties:function(){if(this._data){var a=this._data;this.updateColorMap(a),this._chartContext.refresh(a),this.components.dataArea.setData(a),this.components.dataArea.updateNow(["properties"]),this.updateAxis(a),this.invalidateDisplay("MiniChart._updateProperties")}},clear:function(){Object.keys(this.components).forEach(function(a){this.components[a].clear()},this)},release:function(){this._super(),Object.keys(this.components).forEach(function(a){this.components[a].release()},this)},showComponent:function(){if(this._super.apply(this),this.components.dataArea&&this.components.dataArea.renderers)for(var a in this.components.dataArea.renderers)this.components.dataArea.renderers[a].show()},hideComponent:function(){if(this._super.apply(this),this.components.dataArea&&this.components.dataArea.renderers)for(var a in this.components.dataArea.renderers)this.components.dataArea.renderers[a].hide()}}),Object.defineProperty(h.prototype,"className",{value:"MiniChart"}),h}),define("objects.views/charts/representation/legend-data-provider",["../events/event-launcher","objects.views/charts/utils/tree-iterator"],function(a,b){function c(a,c){var d,e,f,g,h,i,j,k=[],l={},m=this._qDataObject,n=this._legendMarker?this._legendMarker:"rect",o=m?m.qDimensionInfo instanceof Array?m.qDimensionInfo:[m.qDimensionInfo]:null,p=this._colorMap;if(c=void 0===c?o.length-1:c,d=this._dimensionTree,a)for(h=m.qMeasureInfo,i=h.length,f=0;i>f;f++)k.push({label:h[f].qFallbackTitle,color:p.getColor(0,0,f),id:[-1],type:"measure",marker:this._legendMarker?this._legendMarker:this._measureLegendTypes?this._measureLegendTypes[f]||"box":"box"});else b.each.call(d,function(a){j=b.getLevel.call(a),j-1===c&&-3!==a.data.qElemNo&&-2!==a.data.qElemNo&&void 0===l[a.data.qText]&&(g=[],g[c]=a.data.qElemNo,e={label:a.data.qText,color:p.getColor(g,0,0,a.data.rowIndex),id:[a.data.qElemNo],type:"dimension",marker:n},k.push(e),l[a.data.qText]=e)});return this._others&&k.push({label:o[0].othersLabel,color:p.getColor(-3,0,0),id:-3,type:"dimension"}),k}function d(a,b){var c,d,e,f,g,h,i,j=[],k={},l=this._data.qListObject.qDataPages[0].qMatrix,m=this._qDataObject,n=m?m.qDimensionInfo instanceof Array?m.qDimensionInfo:[m.qDimensionInfo]:null,o=this._colorMap;if(b=void 0===b?n.length-1:b,a)for(c=this._data.qListObject.qMeasureInfo,d=c.length,f=0;d>f;f++)j.push({label:c[f].qFallbackTitle,color:o.getColor(0,0,f),id:[-1],type:"measure"});else for(e=0;e<l.length;e++)g=l[e][b],-3!==g.qElemNumber&&-2!==g.qElemNumbero&&void 0===k[g.qText]&&(h=[],h[b]=g.qElemNumber,i={label:g.qText,color:o.getColor(h,0,0,e),id:[g.qElemNumber],type:"dimension"},j.push(i),k[g.qText]=i);return j}var e;return e=a.extend({init:function(a){this._data=a,this._colorMappings={}},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},getColorMapping:function(){if(!this._colorMap||!this._data)return[];var a,b=this._colorMap.getLegendMode();return"primary"===b[2]?[]:this._colorMappings[b]?this._colorMappings[b]:(a="box"===b[0]&&"range"===b[1]||"scale"===b[0]?this._colorMap.generateScaleBasedMapping():this._data.qListObject?d.apply(this,["measure"===b[2],this._colorMap.getDimensionIndex()[0]]):c.apply(this,["measure"===b[2],this._colorMap.getDimensionIndex()[0]]),this._colorMappings[b]=a,a)},setData:function(a){var b=a.qHyperCube?a.qHyperCube:a.qListObject,c=a.qHyperCube?a.qHyperCube.qDimensionInfo:[a.qListObject.qDimensionInfo];this._qDataObject=b,this._data=a,this._others=a&&b.qDataPages.length?b.qDataPages[0].qMatrix.some(function(a){return c&&c.length&&a[c.length-1].qIsOtherCell===!0}):!1,this._colorMappings={}},setDimensionTree:function(a){this._dimensionTree=a,this._colorMappings={}},setMeasureLegendTypes:function(a){this._measureLegendTypes=a},setLegendMarker:function(a){this._legendMarker=a},release:function(){this._colorMap=null,this._dimensionTree=null,this._data=null,this._qDataObject=null}})}),define("general.utils/color-cache",["./color"],function(a){function b(a,b){return function(){var c,d,e=function(){};return e.prototype=a.prototype,c=new e,d=a.apply(c,b),Object(d)===d?d:c}}function c(){j++}function d(){var d,e,f,k;if(arguments.length<3)"string"==typeof arguments[0]?d=arguments[0]:"number"==typeof arguments[0]&&arguments[0]>=0&&(d=arguments[0]+"");else if(arguments.length>=3)for(d=arguments[0],f=0;f>arguments.length;f++)d+=","+arguments[f];if(d&&g[d])return g[d];if(k=b(a,arguments)(),e=k._r+","+k._g+","+k._b+","+k._a,h[e])k=h[e];else{if(j>=i)return k;h[e]=k,c()}return d&&(g[d]=k),k}function e(d,e,f){var g,l,m=k(d._r+(e._r-d._r)*f),n=k(d._g+(e._g-d._g)*f),o=k(d._b+(e._b-d._b)*f),p=k(d._a+(e._a-d._a)*f);if(g=m+","+n+","+o+","+p,h[g])l=h[g];else{if(l=b(a,[m,n,o,p])(),j>=i)return l;h[g]=l,c()}return l}function f(){g={},h={},j=0}var g={},h={},i=5e3,j=0,k=Math.floor;return{retriveColor:d,retriveBlend:e,clear:f}}),define("objects.views/charts/representation/color-scale",["core.utils/class","general.utils/color-cache"],function(a,b){function c(a,b){var c;return a=h(g(.999999999999*(a+1e-12),1e-12),.999999999999),c=b-a*b}function d(a){return a=a?a:this._startLevel,h(a,this._colorParts.length-1)}function e(a){a.forEach(function(a){a.forEach(function(a){a.reverse()}),a.reverse()})}var f,g=Math.max,h=Math.min,i=b.retriveColor(13816530);return f=a.extend({init:function(){this._colorParts=[],this._startLevel=0,this._reverse=!1},addColorPart:function(a,c,d){d=d||0,this._startLevel=g(d,this._startLevel),this._colorParts[d]||(this._colorParts[d]=[]),this._colorParts[d].push([b.retriveColor(a),b.retriveColor(c)])},setReverse:function(a){this._reverse!==a&&(this._reverse=a,e(this._colorParts))},getColor:function(a,e){var f,g,h,j,k,l,m;return isNaN(a)?i:(e=d.apply(this,[e]),f=c(a,this._colorParts[e].length),g=Math.floor(f),j=this._colorParts[e][g],k=j[0],l=j[1],h=f-g,m=b.retriveBlend(k,l,h))},getColors:function(a){var b,c=[];for(b=0;b<a.length;b++)c.push(this.getColor(a[b]));return c},getLegendParts:function(a){var b,c,e,f=[];for(a=d.apply(this,[a]),c=this._colorParts[a].length,b=0;c>b;++b)e=this._colorParts[a][b],f.push({grad:e,color:e[0],solid:e[0]===e[1],index:b});return f}})}),define("objects.views/charts/representation/color-globals",[],function(){var a={};return a.qualitativeColors=[["#4477aa"],["#4477aa","#cc6677"],["#4477aa","#ddcc77","#cc6677"],["#4477aa","#117733","#ddcc77","#cc6677"],["#332288","#88ccee","#117733","#ddcc77","#cc6677"],["#332288","#88ccee","#117733","#ddcc77","#cc6677","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#ddcc77","#cc6677","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#999933","#ddcc77","#cc6677","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#999933","#ddcc77","#cc6677","#882255","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#999933","#ddcc77","#661100","#cc6677","#882255","#aa4499"],["#332288","#6699cc","#44aa99","#88ccee","#117733","#999933","#ddcc77","#661100","#cc6677","#882255","#aa4499"],["#332288","#6699cc","#88ccee","#44aa99","#117733","#999933","#ddcc77","#661100","#cc6677","#aa4466","#882255","#aa4499"]],a.largeQualitativeColors=["#99c867","#e43cd0","#e2402a","#66a8db","#3f1a20","#e5aa87","#3c6b59","#aa2a6b","#e9b02e","#7864dd","#65e93c","#5ce4ba","#d0e0da","#d796dd","#64487b","#e4e72b","#6f7330","#932834","#ae6c7d","#986717","#e3cb70","#408c1d","#dd325f","#533d1c","#2a3c54","#db7127","#72e3e2","#e2c1da","#d47555","#7d7f81","#54ae9b","#e9daa6","#3a8855","#5be66e","#ab39a4","#a6e332","#6c469d","#e39e51","#4f1c42","#273c1c","#aa972e","#8bb32a","#bdeca5","#63ec9b","#9c3519","#aaa484","#72256d","#4d749f","#9884df","#e590b8","#44b62b","#ad5792","#c65dea","#e670ca","#e38783","#29312d","#6a2c1e","#d7b1aa","#b1e7c3","#cdc134","#9ee764","#56b8ce","#2c6323","#65464a","#b1cfea","#3c7481","#3a4e96","#6493e1","#db5656","#747259","#bbabe4","#e33f92","#d0607d","#759f79","#9d6b5e","#8574ae","#7e304c","#ad8fac","#4b77de","#647e17","#b9c379","#8da8b0","#b972d9","#786279","#7ec07d","#916436","#2d274f","#dce680","#759748","#dae65a","#459c49","#b7934a","#51c671","#9ead3f","#969a5c","#b9976a","#46531a","#c0f084","#76c146","#bad0ad"],a.divColors=["#3d52a1","#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#e6f5fe","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e","#ae1c3e"].reverse(),a.divColorPyramid=[null,["#4477aa","#4477aa"].reverse(),["#99c7ec","#99c7ec","#f5a275","#f5a275"].reverse(),["#99c7ec","#99c7ec","#fffad2","#fffad2","#f5a275","#f5a275"].reverse(),["#008bce","#008bce","#b4ddf7","#b4ddf7","#f9bd7e","#f9bd7e","#d03232","#d03232"].reverse(),["#008bce","#008bce","#b4ddf7","#b4ddf7","#fffad2","#fffad2","#f9bd7e","#f9bd7e","#d03232","#d03232"].reverse(),["#3a89c9","#3a89c9","#99c7ec","#99c7ec","#e6f5fe","#e6f5fe","#ffe3aa","#ffe3aa","#f5a275","#f5a275","#d24d3e","#d24d3e"].reverse(),["#3a89c9","#3a89c9","#99c7ec","#99c7ec","#e6f5fe","#e6f5fe","#fffad2","#fffad2","#ffe3aa","#ffe3aa","#f5a275","#f5a275","#d24d3e","#d24d3e"].reverse(),["#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#e6f5fe","#e6f5fe","#ffe3aa","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e"].reverse(),["#3d52a1","#3d52a1","#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#ffe3aa","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e","#ae1c3e","#ae1c3e"].reverse(),["#3d52a1","#3d52a1","#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#e6f5fe","#e6f5fe","#ffe3aa","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e","#ae1c3e","#ae1c3e"].reverse()],a.seqColorPyramid=[null,["#d95f0e","#d95f0e"],["#fec44f","#fec44f","#d95f0e","#d95f0e"].reverse(),["#fed98e","#fed98e","#fb9a29","#fb9a29","#cc4c02","#cc4c02"].reverse(),["#fed98e","#fed98e","#fe9929","#fe9929","#d95f0e","#d95f0e","#993404","#993404"].reverse(),["#fee391","#fee391","#fec44f","#fec44f","#fe9929","#fe9929","#d95f0e","#d95f0e","#993404","#993404"].reverse(),["#fee391","#fee391","#fec44f","#fec44f","#fe9929","#fe9929","#ec7014","#ec7014","#cc4c02","#cc4c02","#8c2d04","#8c2d04"].reverse(),["#fee391","#fee391","#fec44f","#fec44f","#fb9a29","#fb9a29","#ec7014","#ec7014","#cc4c02","#cc4c02","#993404","#993404","#662506","#662506"].reverse()],a.seqColors=["#fff7bc","#fee391","#fee391","#fec44f","#fec44f","#fb9a29","#fb9a29","#ec7014","#ec7014","#cc4c02","#cc4c02","#993404","#993404","#662506"].reverse(),a.primaryColor="#4477aa",a.othersColor="#a5a5a5",a.nullColor="#d2d2d2",a}),define("objects.views/charts/representation/sequential-color-map",["util","core.utils/theme","general.utils/color-cache","objects.views/charts/events/event-launcher","objects.views/charts/representation/color-scale","objects.views/charts/representation/color-globals"],function(a,b,c,d,e,f){function g(a,b){var c,d,f,g=new e;if(b){for(d=0;d<a.length;d++)if(f=a[d])for(c=0;c<f.length;c+=2)g.addColorPart(f[c],f[c+1],d)}else for(c=0;c<a.length;c+=2)g.addColorPart(a[c],a[c+1]);return g}function h(a,b){var c,d,e,f,g,h,j,k,l,m,p,q,r,s=[],t=!1;if(!a||!a.qDataPages||!a.qDataPages.length)return[];for(c=a.qMeasureInfo,d=a.qDimensionInfo instanceof Array?a.qDimensionInfo:[a.qDimensionInfo],e=a.qDataPages[0].qMatrix,m=[],this._others=!1,r=[],this._dataMaxMinValues=null,g=d.length,h=g;h<c.length+g;h++){m[h-g]||(m[h-g]=[]),p=-Number.MAX_VALUE,q=Number.MAX_VALUE;a:for(f=0;f<e.length;f++){for(j=0;g>j;j++){if(k=e[f][j],-3===k.qElemNumber&&j===d.length-1){this._others=!0;continue a}if(-2===k.qElemNumber&&j===d.length-1){this._null=!0;continue a}}l=e[f][h],l&&(m[h-g].push(l.qNum),isNaN(l.qNum)||(p=n(l.qNum,p),q=o(l.qNum,q),t=!0))}r.push({max:p,min:q}),s[h-g]=a.qSize.qcy<=e.length&&!b?i(p,q,m[h-g],1,this.getLargestScaleSize()):this.getLargestScaleSize()}return a.qSize.qcy<=e.length&&!b&&t&&(this._dataMaxMinValues=r),s}function i(a,b,c,d,e){var f,g,h,j,k=0,l=[];if(f=(a-b)/(d+1),0===f)return 1;for(g=0;g<c.length;g++)h=.99*(c[g]-b),j=c[g]>a?Math.floor(a/f):c[g]<b?0:Math.floor(h/f),isNaN(j)||(l[j]?l[j]++:l[j]=1);for(g=0;g<l.length;g++)l[g]&&k++;return d>=k||k>=e?Math.max(k,d):i(a,b,c,++d,e)}function j(a){var b,c=[];for(b=0;b<a.length;b++)c.push(a[b]?k(a[b],!1):null);return c}function k(a,b){var c=1,d=[];for(d.push(a[0]),b||d.push(a[0]);c<a.length-1;c++)d.push(a[c]),d.push(a[c]);return c<a.length&&(d.push(a[c]),b||d.push(a[c])),d}function l(a){var b=a.colorSchemes.ordinalScales[0];this._seqScale=g(k(b.scale,"gradient"===b.type),"class-pyramid"===b.type),this._largestScaleSize=b.scale.length,b=a.colorSchemes.ordinalScales[1],this._seqClasses=g(j(b.scale),"class-pyramid"===b.type),this._largestScaleSize=n(b.scale.length,this._largestScaleSize),b=a.colorSchemes.ordinalScales[2],this._divScale=g(k(b.scale,"gradient"===b.type),"class-pyramid"===b.type),this._largestScaleSize=n(b.scale.length,this._largestScaleSize),b=a.colorSchemes.ordinalScales[3],this._divClasses=g(j(b.scale),"class-pyramid"===b.type),this._largestScaleSize=n(b.scale.length,this._largestScaleSize),this._activeScale=this._seqScale}var m,n=Math.max,o=Math.min;return m=d.extend({init:function(a){l.call(this,b),this._activeScale=this._seqScale,this._measure=0,this.setData(a)},setData:function(a){if(this._data=a,a){var b=a.color||{},c=a.qHyperCube?a.qHyperCube:a.qListObject,d=c?c.qDimensionInfo instanceof Array?c.qDimensionInfo:[c.qDimensionInfo]:null;if(this._qDataObject=c,this._persistantColors=b.persistent!==!1,this._byExpression="byExpression"===b.mode,this._classes=!1,this._numUsedColors=h.apply(this,[this._qDataObject,b.autoMinMax===!1||this._byExpression]),this._dimIndex=d?d.length-1:0,void 0!==b.measureScheme){var e=b.measureScheme.split("");"s"===e[0]?"c"===e[1]?(this._activeScale=this._seqClasses,this._classes=!0):this._activeScale=this._seqScale:"c"===e[1]?(this._activeScale=this._divClasses,this._classes=!0):this._activeScale=this._divScale}void 0!==b.reverseScheme&&(this._seqScale.setReverse(b.reverseScheme===!0),this._divScale.setReverse(b.reverseScheme===!0),this._divClasses.setReverse(b.reverseScheme===!0),this._seqClasses.setReverse(b.reverseScheme===!0))}},getColor:function(a,b,d,e){var g,h,i,j=this._qDataObject;if(d=d||0,a=a instanceof Array?a[this._dimIndex]:a,-3===a)g=c.retriveColor(f.othersColor);else if(-2===a||d>=j.qMeasureInfo.length)g=c.retriveColor(f.nullColor);else{if(i=this._getMinMax(j.qMeasureInfo[d],d),!i||isNaN(e))return c.retriveColor(f.nullColor);
h=i.min===i.max?.5:(e-i.min)/(i.max-i.min),g=this._activeScale.getColor(h,this._getNumUsedColors(d))}return g},getActiveScale:function(){return this._activeScale},getLargestScaleSize:function(){return this._largestScaleSize||0},generateScaleBasedMapping:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n=this._qDataObject,o=this.getValueFormatter();if(m=this._activeScale,l=[],h=m.getLegendParts(this._getNumUsedColors(0)),b=this._getMinMax(n.qMeasureInfo[this._measure],this._measure),!b)return l;if(c=b.max-b.min,isNaN(c))return l;for(j=a.getExponent(b.max),k=a.getExponent(b.min),this._exponentUsed=Math.abs(j)>Math.abs(k)?j:k,f=h.length,e=c/f,g=b.max,d=0;f-1>d;d++)i=h[d],i.isMax=0===d,i.max=o.formatValue(g),i.min=o.formatValue(g-e),i.id=[g,g-e],i.type="range",g-=e,l.push(i);return i=h[d],i.max=o.formatValue(g),i.min=o.formatValue(b.min),i.id=[g,b.min],i.type="range",l.push(i),h},getColorMapping:function(){return this.generateScaleBasedMapping()},getLegendMode:function(){return[this._classes?"box":"scale",this._classes?"range":"item","measure"]},getLegendTitle:function(){return this._qDataObject.qMeasureInfo[this._measure].qFallbackTitle},setMeasureFormatters:function(a){this._measureFormatters=a},setGenericFormatter:function(a){this._formatter=a},getValueFormatter:function(){return this._measureFormatters&&this._measureFormatters[0]&&!this._byExpression?this._measureFormatters[0]:{formatValue:function(a){return a}}},_getMinMax:function(a,b){return this._data.color.autoMinMax===!1?{min:this._data.color.measureMin||0,max:this._data.color.measureMax||10}:this._dataMaxMinValues&&this._dataMaxMinValues[b]?this._dataMaxMinValues[b]:a?{min:a.qMin,max:a.qMax}:null},_getNumUsedColors:function(a){return this._numUsedColors[a]},calculateNumberOfUsedColors:i})}),/**
 * @preserve IntegraXor Web SCADA - JavaScript Number Formatter
 * http://www.integraxor.com/
 * author: KPL, KHL
 * (c)2011 ecava
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
define("assets/external/numberformatter/format",[],function(){return function(a,b){if(!a||isNaN(+b))return b;var b="-"==a.charAt(0)?-b:+b,c=0>b?b=-b:0,d=a.match(/[^\d\-\+#]/g),e=d&&d[d.length-1]||".",f=d&&d[1]&&d[0]||",",a=a.split(e);b=b.toFixed(a[1]&&a[1].length),b=+b+"";var g=a[1]&&a[1].lastIndexOf("0"),h=b.split(".");(!h[1]||h[1]&&h[1].length<=g)&&(b=(+b).toFixed(g+1));var i=a[0].split(f);a[0]=i.join("");var j=a[0]&&a[0].indexOf("0");if(j>-1)for(;h[0].length<a[0].length-j;)h[0]="0"+h[0];else 0==+h[0]&&(h[0]="");b=b.split("."),b[0]=h[0];var k=i[1]&&i[i.length-1].length;if(k){for(var l=b[0],m="",n=l.length%k,o=0,p=l.length;p>o;o++)m+=l.charAt(o),!((o-n+1)%k)&&p-k>o&&(m+=f);b[0]=m}return b[1]=a[1]&&b[1]?e+b[1]:"",(c?"-":"")+b[0]+b[1]}}),define("objects.utils/number-formatter",["core.utils/class","util","assets/external/numberformatter/format"],function(a,b,c){function d(a,b,c,d){return a=a.toString(b),c[1]===c[1].toUpperCase()&&(a=a.toUpperCase()),a.length-a.indexOf(".")>10&&(a=a.slice(0,a.indexOf(".")+11)),a.replace(".",d||".")}function e(a,b,c){var e;return m.test(b)?a=d(a,Number(/\d{2}/.exec(b)[0]),b,c):n.test(b)?a=d(a,8,b,c):o.test(b)?a=d(a,10,b,c):p.test(b)?a=d(a,16,b,c):q.test(b)?a=d(a,2,b,c):r.test(b)&&(e="",0>a&&(e="-",a=-a),a=Math.floor(a),0===a?a="0":5e5>=a?(a=f(a,b),a=e+a):a=b+e+a.toExponential(0)),a}function f(a,b){for(var c,d="",e=Number(String(a).slice(-3)),f=(a-e)/1e3,g=[0,1,4,5,9,10,40,50,90,100,400,500,900].reverse(),h=["0","I","IV","V","IX","X","XL","L","XC","C","CD","D","CM"].reverse();e>0;)for(c=0;c<g.length;c++)if(g[c]<=e){d+=h[c],e-=g[c];break}for(c=0;f>c;c++)d="M"+d;return b[1]!==b[1].toUpperCase()&&(d=d.toLowerCase()),d}function g(a,b,c){var d,e,f,g,j,k,m,n,o,p=a.pattern;p.indexOf("A")>=0&&(p=p.replace("A",""),a.abbreviate=!0),o=i(b,c),f=p.match(o),f=f?f[0]:"",g=f?p.substr(0,p.indexOf(f)):p,j=f?p.substring(p.indexOf(f)+f.length):"",f||(f=p?"#":"##########"),b&&b===c&&(d=f.split(c),e=d.pop(),f=d.join("")+c+e,b=""),k=b,b=/,/.test(c)?"":",",k&&(f=f.replace(h(k,"g"),b)),m=c,c=".",m&&(f=f.replace(h(m,"g"),c)),n=f.match(/#/g),n=n?n.length:0,a.prefix=g||"",a.postfix=j||"",a.pattern=p,a.percentage=l.test(p),a.numericPattern=f||"",a.numericRegex=new RegExp(h(b,null,!0)+"|"+h(c,null,!0),"g"),a.groupTemp=k,a.decTemp=m,a.t=b,a.d=c,a.temp=n}function h(a,c,d){var e=b.escapeRegExp(a);return d?e:new RegExp(e||"",c)}function i(a,c){return c&&(c=b.escapeRegExp(c)),a&&(a=b.escapeRegExp(a)),new RegExp("(?:[#0]+"+a+")?[#0]+(?:"+c+"[#0]+)?")}var j,k={3:"k",6:"M",9:"G",12:"T",15:"P",18:"E",21:"Z",24:"Y","-3":"m","-6":"","-9":"n","-12":"p","-15":"f","-18":"a","-21":"z","-24":"y"},l=/%$/,m=/^\(r(0[2-9]|[12]\d|3[0-6])\)/i,n=/^\(oct\)/i,o=/^\(dec\)/i,p=/^\(hex\)/i,q=/^\(bin\)/i,r=/^\(rom\)/i,s=/^(\(rom\)|\(bin\)|\(hex\)|\(dec\)|\(oct\)|\(r(0[2-9]|[12]\d|3[0-6])\))/i;return j=a.extend("NumberFormatter",{init:function(a,b,c,d,e){this.localeInfo=a,this.pattern=b,this.thousandDelimiter=c||",",this.decimalDelimiter=d||".",this.type=e||"numeric",this.prepare()},clone:function(){var a=new j(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type);return a.subtype=this.subtype,a},format:function(a,b,c,d){return this.prepare(b,c,d),this.formatValue(a)},prepare:function(a,b,c){var d,e;return"undefined"==typeof a&&(a=this.pattern),"undefined"==typeof b&&(b=this.thousandDelimiter),"undefined"==typeof c&&(c=this.decimalDelimiter),a?(this._prepared={positive:{d:c,t:b,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""},negative:{d:c,t:b,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""}},d=this._prepared,a=a.split(";"),d.positive.pattern=a[0],d.negative.pattern=a[1],s.test(a[0])&&(d.positive.isFunctional=!0),a[1]?s.test(a[1])&&(d.negative.isFunctional=!0):d.negative=!1,e=d.positive.isFunctional&&(!d.negative||d.negative&&d.negative.isFunctional),void(e||(g(d.positive,b,c),d.negative&&g(d.negative,b,c)))):void(this._prepared={pattern:!1})},formatValue:function(a){var b,d,f,g,h,i,j,l,m,n=this._prepared,o="",p="";if(isNaN(a))return a;if(n.pattern===!1)return a.toString();if(0>a&&n.negative?(n=n.negative,a=-a):n=n.positive,h=n.d,i=n.t,n.isFunctional)a=e(a,n.pattern,h);else{if(n.percentage&&(a*=100),n.abbreviate&&(d=Number(Number(a).toExponential().split("e")[1]),d-=d%3,d in k&&(o=k[d],a/=Math.pow(10,d))),f=Math.abs(a),b=n.temp,l=n.numericPattern,m=l.split(h)[1],"I"===this.type&&(a=Math.round(a)),g=a,m||"#"!==l.slice(-1)[0])if(f>=1e15||f>0&&1e-14>=f)a=f?f.toExponential(15).replace(/\.?0+(?=e)/,""):"0";else{var q=Number(a.toFixed(Math.min(20,m?m.length:0)).split(".")[0]),r=l.split(h)[0];if(r+=h,a=c(r,q)||"0",m){var s=Math.max(0,Math.min(14,m.length)),t=m.replace(/#+$/,"").length,u=(f%1).toFixed(s).slice(2).replace(/0+$/,"");for(j=u.length;t>j;j++)u+="0";u&&(a+=h+u)}else 0===q&&(g=0)}else if(f>=Math.pow(10,b)||1>f||1e-4>f)0===a?a="0":1e-4>f||f>=1e20?(a=g.toExponential(Math.max(1,Math.min(14,b))-1),a=a.replace(/\.?0+(?=e)/,""),p=""):(a=a.toPrecision(Math.max(1,Math.min(14,b))),a.indexOf(".")>=0&&(a=a.replace(a.indexOf("e")<0?/0+$/:/\.?0+(?=e)/,""),a=a.replace(".",h)));else{for(l+=h,b=Math.max(0,Math.min(20,b-Math.ceil(Math.log(f)/Math.log(10)))),j=0;b>j;j++)l+="#";a=c(l,a)}a=a.replace(n.numericRegex,function(a){return a===i?n.groupTemp:a===h?n.decTemp:""}),0>g&&!/^\-/.test(a)&&(a="-"+a)}return n.prefix+a+p+o+n.postfix}}),window.NumberFormatter=j,j}),define("objects.utils/date-formatter",["core.utils/class"],function(a){function b(a,b){for(var c=a.length;b>c;c++)a="0"+a;return a}function c(a,b){var c=a.getHours(),d=a.getDay()-1;return b&&(c%=12,c||(c=12)),0>d&&(d=6),{year:a.getFullYear(),month:a.getMonth(),day:d,date:a.getDate(),h:c,m:a.getMinutes(),s:a.getSeconds(),f:a.getMilliseconds(),t:a.getHours()>=12?"pm":"am"}}function d(a){var b=a.toString().split(".");return b[1]?b=Number("0."+b[1]):0}function e(a,b){var c,e=Math.floor(a),f=d(a),g=24*f,h=60*(g-Math.floor(g)),i=60*(h-Math.floor(h)),j=0,k=1e3*(i-Math.floor(i));return/w+|t+/gi.test(b)&&(c=new Date(1899,11,30+Math.floor(a),0,0,86400*(a-Math.floor(a))),isNaN(c.getTime())&&(c=null)),/D+/gi.test(b)||(g+=24*e),/h+/gi.test(b)||(h+=60*g),/m+/gi.test(b)||(i+=60*h),/w+/gi.test(b)&&(j=c?c.getDay()-1:0,0>j&&(j=6)),{year:0,month:0,day:j,date:e,h:Math.floor(g),m:Math.floor(h),s:Math.floor(i),f:Math.round(k),t:c?c.getHours()>=12?"pm":"am":""}}function f(a,c){return{"Y+|y+":{Y:Number((c.year+"").slice(-2))+"",YY:b((c.year+"").slice(-2),2),YYY:b((c.year+"").slice(-3),3),def:function(a){return b(c.year+"",a.length)}},"M+":{M:c.month+1,MM:b(c.month+1+"",2),MMM:a.locale_months_abbr[c.month],def:a.locale_months[c.month]},"W+|w+":{W:c.day,WW:b(c.day+"",2),WWW:a.locale_days_abbr[c.day],def:a.locale_days[c.day]},"D+|d+":{D:c.date,def:function(a){return b(c.date+"",a.length)}},"h+|H+":{h:c.h,def:function(a){return b(c.h+"",a.length)}},"m+":{m:c.m,def:function(a){return b(c.m+"",a.length)}},"s+|S+":{s:c.s,def:function(a){return b(c.s+"",a.length)}},"f+|F+":{def:function(a){var b=c.f+"",d=a.length-b.length;if(d>0)for(var e=0;d>e;e++)b+="0";else 0>d&&(b=b.slice(0,a.length));return b}},"t{1,2}|T{1,2}":{def:function(a){var b=c.t;return a[0].toUpperCase()===a[0]&&(b=b.toUpperCase()),b=b.slice(0,a.length)}}}}var g,h=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],i=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],j=["January","February","March","April","May","June","July","August","September","October","November","December"],k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return g=a.extend({init:function(a,b){var c=a||{qCalendarStrings:{qLongDayNames:h,qDayNames:i,qLongMonthNames:j,qMonthNames:k}};this.localeInfo=c,this.locale_days=c.qCalendarStrings.qLongDayNames.slice(),this.locale_days_abbr=c.qCalendarStrings.qDayNames.slice(),this.locale_months=c.qCalendarStrings.qLongMonthNames.slice(),this.locale_months_abbr=c.qCalendarStrings.qMonthNames.slice(),this.pattern=b},clone:function(){var a=new g(this.localeInfo,this.pattern);return a.subtype=this.subtype,a},format:function(a,b){b||(b=this.pattern?this.pattern:"YYYY-MM-DD hh:mm:ss"),b=b.replace(/\[.+\]|\[|\]/g,"");var d,g=/t+/gi.test(b);d=a instanceof Date?c(a,g):e(a,b);var h=f(this,d),i=[];for(var j in h)i.push(j);var k=new RegExp(i.join("|"),"g"),l=b.replace(k,function(a){var b;for(var c in h)if(b=new RegExp(c),b.test(a))break;if(!b)return"";var d;for(var e in h[c])if(e===a||e.toLowerCase()===a){d=h[c][e],"undefined"==typeof d&&(d=h[c][e.toLowerCase()]);break}return"undefined"==typeof d&&(d=h[c].def),"function"==typeof d&&(d=d(a)),d});return l}})}),define("objects.utils/num-date-time-formatter",["objects.utils/number-formatter","objects.utils/date-formatter"],function(a,b){function c(a){if(isNaN(a)||!isFinite(a))return 1;var b=Number(a).toExponential(),c=b.split("e"),d=1;return"+"===c[1][0]&&(d+=Number(c[1])),d}function d(a){if(isNaN(a)||!isFinite(a))return 0;var b,c=Number(a).toExponential(),d=c.split("e"),e=0;return"-"===d[1][0]?(e=Math.abs(Number(d[1])),d=d[0].split("."),d[1]&&(e+=d[1].length)):(b=Number(d[1]),d=d[0].split("."),e=d[1]?d[1].length-b:0),e}var e,f={AUTO:"U",INTEGER:"I",NUMBER:"R",FIXED_TO:"F",MONEY:"M",DATE:"D",TIME:"T",DATE_TIME:"TS",INTERVAL:"IV"};return e=a.extend("QFormatter",{init:function(c,d,e,g,h){var i=c||{};this.localeInfo=i,this.pattern=d||"",this.decimalDelimiter="string"==typeof g?g:"string"==typeof i.qDecimalSep?i.qDecimalSep:".",this.thousandDelimiter="string"==typeof e?e:"string"==typeof i.qThousandSep&&this.decimalDelimiter!==i.qThousandSep?i.qThousandSep:"",this.type=h||f.AUTO,h===f.AUTO&&(this.pattern="#"+this.decimalDelimiter+"##A"),this._numberFormatter=new a(c),this._dateFormatter=new b(c),this.prepare()},clone:function(){return new e(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type)},prepare:function(a,b,c){if(a||(a=this.pattern),!a)switch(this.type){case f.INTEGER:a="##############";break;case f.NUMBER:a=Array(this.localeInfo.qnDec||11).join("#");break;case f.FIXED_TO:a="#"+this.localeInfo.qDecimalSep||"."+Array(this.localeInfo.qnDec||4).join("#");break;case f.MONEY:a=this.localeInfo.qMoneyFmt,c||(c=this.localeInfo.qMoneyDecimalSep||"."),b||c===this.localeInfo.qMoneyThousandSep||(b=this.localeInfo.qMoneyThousandSep);break;case f.DATE:a=this.localeInfo.qDateFmt||"YYYY-MM-DD";break;case f.DATE_TIME:a=this.localeInfo.qTimestampFmt||"YYYY-MM-DD hh:mm:ss";break;case f.TIME:case f.INTERVAL:a=this.localeInfo.qTimeFmt||"hh:mm:ss";break;default:a="##########"}this._numberFormatter.pattern=this.pattern,this._dateFormatter.pattern=this.pattern,this._numberFormatter.thousandDelimiter=this.thousandDelimiter,this._numberFormatter.decimalDelimiter=this.decimalDelimiter,this._numberFormatter.type=this.type,this._numberFormatter.prepare(a,b,c),this._prepared={pattern:a,t:b,d:c}},formatValue:function(a){var b,c=this._prepared;if("NaN"===a||"number"==typeof a&&isNaN(a))return"-";if(isNaN(a)||"number"!=typeof a)return a+"";switch(this.type){case f.DATE:case f.TIME:case f.DATE_TIME:return b=new Date(1899,11,30+Math.floor(a),0,0,86400*(a-Math.floor(a))),isNaN(b.getTime())?this._numberFormatter.format(a,"0",c.t,c.d):this._dateFormatter.format(b,c.pattern);case f.INTERVAL:return this._dateFormatter.format(a,c.pattern);default:return this._numberFormatter.formatValue(a)}},format:function(a,b,c,d){return"NaN"===a||"number"==typeof a&&isNaN(a)?"-":isNaN(a)||"number"!=typeof a?a+"":(this.prepare(b,c,d),this.formatValue(a))},createPatternFromRange:function(a,b,c){var d,e,f,g="",h=Number(Number(a).toExponential().split("e")[1]),i=Number(Number(b).toExponential().split("e")[1]),j=Math.min(Math.abs(h),Math.abs(i)),k=Math.abs(b-a),l=Number(Number(k/50).toExponential().split("e")[1]);if(f=Math.abs(l),0===k)return"0"+this.decimalDelimiter+"##"+(c?"A":"");if(l>=0?f=c?Math.max(2,j-l):0:(e=(c?j-j%3:0)*(0>i?1:-1),f-=e),g+=this.thousandDelimiter?"#"+this.thousandDelimiter+"##0":"0",f)for(g+=this.decimalDelimiter,d=0;f>d;d++)g+="#";return g+(c?"A":"")}}),e.getSignificantIntegers=function(a){return c(a)},e.getSignificantDecimals=function(a){return d(a)},e}),define("objects.views/charts/representation/expression-color-map",["core.utils/theme","general.utils/color-cache","objects.views/charts/representation/sequential-color-map","objects.utils/num-date-time-formatter"],function(a,b,c,d){function e(a,b){var c,d=-Number.MAX_VALUE,e=Number.MAX_VALUE;return b.color.autoMinMax===!1?{min:b.color.measureMin||0,max:b.color.measureMax||10}:a?(Object.keys(a).forEach(function(b){c=a[b].value;var f=b.split(",");isNaN(c)||f.contains("-3")||f.contains("-2")||(d=Math.max(d,c),e=Math.min(e,c))}),{min:e,max:d}):null}function f(c){if(!(c&&c.qDataPages[0]&&c.qMeasureInfo&&c.qMeasureInfo.length))return{};var d,e,f,g,i,j,k=c.qDataPages[0].qMatrix,l=h(c.qDimensionInfo),m={},n=0;for(c.qMeasureInfo[0].qAttrExprInfo&&c.qMeasureInfo[0].qAttrExprInfo.every(function(a,b){"colorByExpression"===a.type&&(n=b)}),i=0;i<k.length;i++){for(g=k[i][l].qAttrExps,f=""+k[i][0].qElemNumber,j=1;l>j;j++)f+=","+k[i][j].qElemNumber;g&&g.qValues.length?(d=b.retriveColor(isNaN(g.qValues[n].qNum)?g.qValues[n].qText:g.qValues[n].qNum,"argb"),e=g.qValues[n].qNum):(d=b.retriveColor(a.colorSchemes.nullColor),e=0/0),m[f]={color:d,value:e}}return m}function g(c){if(!(c&&c.qStackedDataPages[0]&&c.qMeasureInfo&&c.qMeasureInfo.length))return{};var d,e,f,g,h=c.qStackedDataPages[0].qData[0],i={};return g=function(c,h){if("V"===c.qType)f=c.qAttrExps,f&&f.qValues.length?(d=b.retriveColor(isNaN(f.qValues[0].qNum)?f.qValues[0].qText:f.qValues[0].qNum,"argb"),e=f.qValues[0].qNum,i[h]={color:d,value:e}):(d=b.retriveColor(a.colorSchemes.nullColor),e=0/0,i[h]||(i[h]={color:d,value:e}));else if(c.qSubNodes.length>0){"N"===c.qType&&(h?h+=","+c.qElemNo:h=""+c.qElemNo);for(var j=0;j<c.qSubNodes.length;j++)g(c.qSubNodes[j],h)}},g(h),i}function h(a){return Array.isArray(a)?a.length:1}var i;return i=c.extend({init:function(a){this._formatter=new d(null),this._super(a)},setData:function(a){if(this._super(a),this._mapping={},a){var b=a.color||{},c=a.qHyperCube?a.qHyperCube:a.qListObject;if(this._qDataObject=c,this._data=a,this._isColorExpression=b.expressionIsColor!==!1,this._byExpression="byExpression"===b.mode,this._expressionLabel=b.expressionLabel||"",this._byExpression){c.qDataPages&&c.qDataPages[0]?this._mapping=f(c):c.qStackedDataPages&&c.qStackedDataPages[0]&&(this._mapping=g(c)),this._minMax=e(this._mapping,a);var d=this._mapping;this._numUsedColors=[this.calculateNumberOfUsedColors(this._minMax.max,this._minMax.min,Object.keys(d).map(function(a){var b=a.split(",");return b.contains("-3")||b.contains("-2")?null:d[a].value}),1,this.getLargestScaleSize())],this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,!0),this._formatter.prepare()}else this._minMax=null,this._mapping=null,this._formatter.pattern=this._formatter.createPatternFromRange(0,1,!0),this._formatter.prepare()}},getColor:function(c,d,e,f){if(!this._byExpression)return this._super(c,d,e,f);var g,h,i,j=this._qDataObject,k=j?j.qMeasureInfo.length:0;return e=0,h=c instanceof Array?this._dimIndex>=0?c[this._dimIndex]:void 0:c,i=c instanceof Array?c.join(","):c+"",-3===h||void 0===h&&c instanceof Array&&-1!==c.indexOf(-3)?b.retriveColor(a.colorSchemes.othersColor):-2===h?b.retriveColor(a.colorSchemes.nullColor):k?!this._mapping[i]||this._mapping[i].color.isInvalid()&&this._isColorExpression?b.retriveColor(a.colorSchemes.nullColor):g=this._isColorExpression?this._mapping[i].color:this._super(c,d,0,this._mapping[i].value):this._super(c,d,e,f)},getExpressionValue:function(a){var b=a instanceof Array?a.join(","):a+"";return!this._mapping[b]||this._isColorExpression?void 0:this._mapping[b].value},getLegendTitle:function(){return this._byExpression?this._expressionLabel:this._super()},getLegendMode:function(){return this._byExpression?this._isColorExpression?["box","item","primary",!0]:[this._classes?"box":"scale",this._classes?"range":"item","measure",!0]:this._super()},getValueFormatter:function(){return this._measureFormatters&&this._measureFormatters[0]&&!this._byExpression?this._measureFormatters[0]:this._formatter},setGenericFormatter:function(a){this._super(a),this._byExpression&&this._minMax?(this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,!0),this._formatter.prepare()):this._formatter.pattern=this._formatter.createPatternFromRange(0,1,!0),this._formatter.prepare()},_getMinMax:function(a,b){return this._byExpression?a&&this._minMax?{min:this._minMax.min,max:this._minMax.max}:null:this._super(a,b)},_getNumUsedColors:function(a){return this._numUsedColors[a]}})}),define("objects.views/charts/representation/qualitative-color-map",["translator","core.utils/theme","general.utils/color-cache","objects.views/charts/events/event-launcher"],function(a,b,c,d){function e(a,b,c,d){var e=d.qDimensionInfo instanceof Array?d.qDimensionInfo.length:1,f=d.qMeasureInfo?d.qMeasureInfo.length:0;return a&&a!==k?f>1&&c!==m&&a!==l&&(a=m):a=b===l||c===k&&1>=e&&1>=f?l:m,"byDimension"===a?m:a}function f(a,b,c,d){var e,f=0,g=b instanceof Array,h=g?b.length:1;if(c&&!a)for(f;h>f;++f)if(e=g?b[f].cId:b.cId,e===c)return f;return d===o?0:h-1}function g(a){return b.palette[a]?b.palette[a]:a}var h,i,j,k="auto",l="primary",m="dimension",n="measure",o="first",p="last";return h=d.extend({init:function(a,c){c=c||{},this._primaryColorMode=c.colorBy||k,this._autoMode=c.autoMode||k,this._multiDimScheme=c.multiDimScheme||p,this._primaryColor=b.colorSchemes.primaryColor,i=b.colorSchemes.qualitativeScales[0].scale,j=b.colorSchemes.qualitativeScales[1].scale,this._qualitativeScale=i[i.length-1],this._persistantColors=!1,a&&this.setData(a)},setData:function(a){var b=a.color||{},c=a.qHyperCube?a.qHyperCube:a.qListObject,d=c&&c.qMeasureInfo?c.qMeasureInfo.length:0,h=c.qDimensionInfo instanceof Array?c.qDimensionInfo:[c.qDimensionInfo];this._qDataObject=c,this._data=a,this._colorMode=b.auto?k:b.mode||l,this._internalMode=e(b.auto?k:b.mode||k,this._autoMode,this._primaryColorMode,c),this._persistentColors=b.persistent!==!1,this._dimIndex=f(b.auto,h,b.dimensionId,this._multiDimScheme),this._haveNoDimension=0===h.length||this._dimIndex<0,this._dimLabel=this._haveNoDimension?"":h[this._dimIndex].qFallbackTitle,this._dimSize=d>1&&this._primaryColorMode!==m?d:this._persistentColors?this._haveNoDimension?0:h[this._dimIndex].qCardinal:c.qDataPages.length?c.qDataPages[0].qMatrix.length:this._haveNoDimension?0:h[this._dimIndex].qCardinal,void 0!==b.singleColor&&(this._primaryColor=g(b.singleColor)),this._qualitativeScale=this._dimSize>i.length?"100"!==b.dimensionScheme?i[i.length-1]:j:i[(this._dimSize-1)%i.length]},getColor:function(a,d,e){var f,g,h,i=this._qDataObject,j=i?i.qMeasureInfo.length:0;return h=a instanceof Array?this._dimIndex>=0?a[this._dimIndex]:void 0:a,-3===h||a instanceof Array&&-1!==a.indexOf(-3)?c.retriveColor(b.colorSchemes.othersColor):-2===h?c.retriveColor(b.colorSchemes.nullColor):this._internalMode===l&&this._colorMode===k?c.retriveColor(b.colorSchemes.primaryColor):this._internalMode===l?c.retriveColor(this._primaryColor):(f=j>1&&this._primaryColorMode!==m?e:this._persistentColors?h:d,g=c.retriveColor(this._qualitativeScale[f%this._qualitativeScale.length]))},getLegendMode:function(){var a=this._qDataObject?this._qDataObject.qMeasureInfo.length:0;return["box","item",this._internalMode===l?l:this._autoMode===n||this._primaryColorMode===n||a>1&&this._primaryColorMode!==m?"measure":"dimension"]},getDimensionIndex:function(){return this._dimIndex},getLegendTitle:function(){var b=this._qDataObject,c=b?b.qMeasureInfo.length:0,d=b?b.qDimensionInfo instanceof Array?b.qDimensionInfo.length:1:0;return this._primaryColorMode===n||1===d&&c>1&&this._primaryColorMode!==m?a.get("Common.Measures"):this._dimLabel}})}),define("objects.views/charts/representation/combo-color-map",["objects.views/charts/events/event-launcher","objects.views/charts/representation/legend-data-provider","objects.views/charts/representation/expression-color-map","objects.views/charts/representation/qualitative-color-map"],function(a,b,c,d){var e,f="auto",g="qualitative",h="primary",i="expression",j="measure";return e=a.extend({init:function(a,e){this._qualitativeMap=new d(a,e),this._sequentialMap=new c(a,e),this._legendDataProvider=new b(a),this._legendDataProvider.setColorMap(this),this._title="DEBUG",a&&this.setData(a)},getColor:function(a,b,c,d){return this._colorMode===j||this._colorMode===i?this._sequentialMap.getColor(a,d,c,b):this._qualitativeMap.getColor(a,d,c,b)},getTooltipContent:function(a){var b,c,d=null;return this._colorMode===i&&(b=this._sequentialMap.getExpressionValue(a),void 0!==b&&(this._sequentialMap.getValueFormatter&&(c=this._sequentialMap.getValueFormatter())&&(b=c.formatValue(b)),d={label:this.getLegendTitle(),value:b})),d},getColorMapping:function(){return this._legendDataProvider.getColorMapping()},generateScaleBasedMapping:function(){return this._sequentialMap.generateScaleBasedMapping()},getLegendMode:function(){return this._colorMode===j||this._colorMode===i?this._sequentialMap.getLegendMode():this._qualitativeMap.getLegendMode()},getSelectionIndices:function(){return this.getDimensionIndex()},getLegendTitle:function(){return this._colorMode===j||this._colorMode===i?this._sequentialMap.getLegendTitle():this._qualitativeMap.getLegendTitle()},getDimensionIndex:function(){return this._colorMode===j?[0]:[this._qualitativeMap.getDimensionIndex()]},setData:function(a){if(this._colorMode=g,this._data=a,a.color)if(a.color.auto)this._colorMode=f,this._sequentialMap.setData(a),this._qualitativeMap.setData(a);else switch(a.color.mode){case"byMeasure":this._colorMode=j,this._sequentialMap.setData(a);break;case"byExpression":this._colorMode=i,this._sequentialMap.setData(a);break;case"primary":this._colorMode=h,this._qualitativeMap.setData(a);break;default:this._qualitativeMap.setData(a)}else this._sequentialMap.setData(a),this._qualitativeMap.setData(a);this._legendDataProvider.setData(a)},setMeasureFormatters:function(a){this._measureFormatters=a,this._sequentialMap.setMeasureFormatters(a)},setGenericFormatter:function(a){this._sequentialMap.setGenericFormatter(a)},setDimensionTree:function(a){this._dimensionTree=a,this._legendDataProvider.setDimensionTree(a)},getLegendDataProvider:function(){return this._legendDataProvider},release:function(){this._qualitativeMap.release&&this._qualitativeMap.release(),this._sequentialMap.release&&this._sequentialMap.release(),this._legendDataProvider.release&&this._legendDataProvider.release(),this._dimensionTree=null,this._legendDataProvider=null,this._sequentialMap=null,this._qualitativeMap=null}}),Object.defineProperties(e.prototype,{mode:{get:function(){return this._colorMode}}}),Object.defineProperties(e,{AUTO:{value:f,writable:!1},PRIMARY:{value:h,writable:!1},MEASURE:{value:j,writable:!1},EXPRESSION:{value:i,writable:!1},QUALITATIVE:{value:g,writable:!1}}),Object.defineProperties(e.prototype,{AUTO:{value:f,writable:!1},PRIMARY:{value:h,writable:!1},MEASURE:{value:j,writable:!1},EXPRESSION:{value:i,writable:!1},QUALITATIVE:{value:g,writable:!1}}),e}),define("objects.views/charts/utils/chart-formatting",["core.utils/class","objects.utils/num-date-time-formatter","objects.utils/number-formatter"],function(a,b){function c(a){return!!a.qIsAutoFormat&&["M","D","T","TS","IV"].indexOf(a.qNumFormat.qType)<0}var d=a.extend("ChartFormatting",{init:function(a,b){this.localeInfo=a,this.measureFormatters=this.getFormattersForMeasures(b),this.combinedMeasuresFormatter=this.getFormatterFromFormatters(this.measureFormatters)},createFormatter:function(){return new b(this.localeInfo)},getLocaleInfo:function(){return this.localeInfo||{}},getFormatters:function(){return this.measureFormatters||[]},getMeasureFormatter:function(a){return this.measureFormatters[a]?this.measureFormatters[a]:void 0},getCombinedMeasuresFormatter:function(){return this.combinedMeasuresFormatter},formatMeasure:function(a,b){var c=this.measureFormatters[b];return c?c.format(a):a},getFormatterFromFormatters:function(a){var c,d,e,f,g,h=0,i=0,j=0,k=a?a.filter(function(a){return a.values?!isNaN(a.values.range):!1}):[];return a&&a.length&&(a.forEach(function(a){return"U"===a.type||a.values&&isNaN(a.values.range)?i++:["D","T","TS","IV"].contains(a.type)?h=1:j=1,a.prepare(),a}),k.length&&(c=k.reduce(function(a,b){return Math.min(b.values.min,a)},k[0].values.min),d=k.reduce(function(a,b){return Math.max(b.values.max,a)},k[0].values.max),e=Math.abs(d-c)),h+j>1?(g=a.filter(function(a){return"datetime"!==a.type})[0]||{},f=new b(this.localeInfo,g.pattern,g.thousandDelimiter,g.decimalDelimiter,"U"),isNaN(e)||(f.pattern=f.createPatternFromRange(c,d,!0))):h+j===1&&0===i?(g=a[0]||{},f=new b(this.localeInfo,g.pattern,g.thousandDelimiter,g.decimalDelimiter,g.type)):(g=a.filter(function(a){return"U"!==a.type}),g=g.length?g[0]:a[0]||{},f=new b(this.localeInfo,g.pattern,g.thousandDelimiter,g.decimalDelimiter,g.type),isNaN(e)||"U"!==g.type||(f.pattern=f.createPatternFromRange(c,d,!0))),f.prepare()),f||(f=new b(this.localeInfo,"0")),f},getFormattersForMeasures:function(a,d){var e,f=[];return a&&a.length&&(e=d?a.filter(function(a,b){return d.indexOf(b)>=0}):a,f=e.map(function(a){var d=c(a),e=new b(this.localeInfo,a.qNumFormat.qFmt,a.qNumFormat.qThou,a.qNumFormat.qDec,d?"U":a.qNumFormat.qType),f=Math.abs(a.qMax-a.qMin),g=isNaN(f);return e.values={min:a.qMin,max:a.qMax,range:f},!g&&d&&(e.pattern=e.createPatternFromRange(a.qMin,a.qMax,!0)),e.prepare(),e},this)),f}});return d}),define("objects.views/charts/chart",["./events/event-launcher","./layout-engine","./components/data-area","./components/grid","./components/axis/axis","./components/axis/discrete-axis","./components/axis/continuous-axis","./components/axis/axis-title","./components/legend","./components/ref-lines","./components/ref-line-labels","./components/scroll-area","./components/mini-chart","./representation/combo-color-map","./chart-context","objects.utils/shapes/rect","jquery","objects.utils/layout","objects.views/charts/utils/binding","objects.views/charts/utils/chart-formatting","client.utils/state","objects.extension/default-view","objects.utils/event-utils"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){function x(){if(this.selections){var a,b,c,d=this.components.dataArea.getSelectableShapes(),f=this._selectedRows,g=0,h=!1,j=[],k=this.selections.getActiveType?this.selections.getActiveType():!1,l=!!k;this.selections.cache&&(this.selections.cache.clear(),d.forEach(function(a){this.selections.cache.add(a)},this),l&&("item"===k.getActiveMode()?(g=this.components.dimensionAxis?this.components.dimensionAxis.getSelectionIndices()[0]:0,h=this.components.dimensionAxis&&this._data.qHyperCube.qDimensionInfo.length>1,d.forEach(function(d){b=d.col,a=d.rowIndex||d.row||0,h?b===g?d.selected=f.indexOf(a)>=0:f.indexOf(a)>=0&&b>g&&(c=d.parent,c&&c.col===g&&j.indexOf(c)<0&&j.push(c)):d.selected=f.indexOf(a)>=0},this),j&&j.forEach(function(b){b.children.forEach(function(b){a=b.rowIndex||b.row||0,b.selected=!0,f.indexOf(a)<0&&f.push(a)})})):(k.activeComponent instanceof e&&!k.activeComponent.isDiscrete()||k.activeComponent instanceof i&&"range"===k.getActiveMode())&&k.updateShapesState()),this.providers&&this.providers.tooltip&&this.providers.tooltip.setSelectableShapes(d)),Object.keys(this.components).forEach(function(a){["legend","xAxis","dimensionAxis"].contains(a)&&this.components[a].setSelectableShapes(d)},this)}}function y(){var a,b,c,d,e,f,g,h,i,j=this.container.parentElement,k="",l="";if(j.style.height="100%",j.style.width="",j.style.left="",j.style.top="",this._readStoredData&&this._data.snapshotData.content.size){a=this.container.clientWidth,b=this.container.clientHeight,g=this._data.snapshotData.content.size,c=g.w,d=g.h;var m=c/d,n=a/b;n>=m?(h=b/d,e=b*m/a,a=100*e+"%",b="100%",k=50*(1-e)+"%"):(h=a/c,f=a/m/b,b=100*f+"%",a="",l=50*(1-f)+"%"),this._chartScale=h,this.$scope.dataAttributes.chartScale=h;for(i in this.components)this.components[i].chartScale=this._chartScale;j.style.width=a,j.style.height=b,j.style.left=k,j.style.top=l}}function z(){this._sizeChanged=!1,y.call(this);var a,b,c=this.rect,d=this.container.clientWidth,e=this.container.clientHeight,f=new p(0,0,d,e);if(this.containerRect=new p(0,0,d,e),this._readStoredData&&this._data.snapshotData.content.size&&(b={width:this._data.snapshotData.content.size.w,height:this._data.snapshotData.content.size.h}),b&&(f=new p(0,0,b.width,b.height)),!c||c.width!==f.width||c.height!==f.height){for(a in this.components)this.components[a].setOuterRect(f.x+1,f.y+1,f.width-2,f.height-2);this.rect=f,this._updateLayoutMode(this.rect.width,this.rect.height),this._sizeChanged=!0}}function A(a,b){Object.keys(this.components).forEach(function(c){["legend","xAxis","dimensionAxis","dataArea"].contains(c)&&this.components[c].setGlobalOpacity(a,b||!1)},this)}function B(){var a;this.chartFormatter=new t(this.backendApi.localeInfo,this._data.qHyperCube.qMeasureInfo);for(a in this.components)this.components[a].chartFormatter=this.chartFormatter,this.components[a].measureFormatters=this.chartFormatter.getFormatters(),this.components[a].combinedMeasuresFormatter=this.chartFormatter.getCombinedMeasuresFormatter()}function C(){var b,c={};for(b in a.prototype)a.prototype.hasOwnProperty(b)&&"init"!==b&&(c[b]=a.prototype[b]);return c}var D,E,F;return E={debug:!0,components:{}},F=v.extend(C()),D=F.extend({refreshSelections:function(){this.specialCaseForSingleSelect=!1},initialize:function(){this._super(),this._initiateBindings()},init:function(c,d,e,f){a.prototype.init.call(this),e=q.extend(!0,e||{},{},E),this._super(c,d,e,f),this.container=d[0],this.backendApi=f,this.layoutEngine=new b,this.components={},this.providers={},this._changeWatchers=[],this._createComponents(),this._createProviders(),this._chartScale=1,this.chartFormatter=new t(this.backendApi.localeInfo),this._selectedRows=[],this._chartContext=new o,this._layoutMode=r.LayoutMode.FULL,this.$scope.dataAttributes={},this.resize(),this.specialCaseForSingleSelect=!1},selectionModeAlpha:.5,setMinimumRequirements:function(a,b){this._requirements={dimensions:{min:a},measures:{min:b}}},onToggleLasso:function(){this.toggleLasso(!this.isLassoing())},notUsingLasso:function(a){var b,c;return this.selections&&this.selections.options.getSelectionType&&this.selections.types&&this.selections.types.dataArea?this.selections.types.dataArea.options.lassoSelection?!1:(b=this.selections.options.getSelectionType.call(this.selections,{x:a.pageX,y:a.pageY}),c=!(!b||"item"!==b._activeMode||!b.activeComponent||b.activeComponent&&b.activeComponent!==this.components.dataArea)):!0},onSelection:{ToggleShape:function(a){if(!a.selected&&1===this.$scope.layout.qHyperCube.qSize.qcy)return void(this.specialCaseForSingleSelect=!0);if(this.toggleCacheItem?this.toggleCacheItem(a):this.onSelection.scheduleInvalidation.call(this),-3===a.id||a.id>=0){var b=a.rowIndex||a.row||0;a.selected&&this._selectedRows.indexOf(b)<0?this._selectedRows.push(b):!a.selected&&this._selectedRows.indexOf(b)>=0&&this._selectedRows.splice(this._selectedRows.indexOf(b),1)}this.specialCaseForSingleSelect=!1,this._haveToggledShapes=!!this._selectedRows.length},Activated:function(){A.apply(this,[this.selectionModeAlpha]),this._haveToggledShapes=!1},Deactivated:function(){A.apply(this,[1,this._haveToggledShapes]),this._selectedRows=[],this._toggleLasso&&this.toggleLasso(!1)},Select:function(a,b,c,d){if(!this.specialCaseForSingleSelect){var e=Array.isArray(c)?c:[c||0];this._selectedRows.length?this.backendApi.select(this._selectedRows,e,d)["catch"](function(a){a.isHandled=!0}):a.length&&a.every(function(a){return!a.selected})&&this.backendApi.clearSelections()}},SelectRange:function(a,b){var c=this;this.backendApi.selectRange(a,b).then(function(a){a.qSuccess||c.backendApi.clearSelections()})},Confirm:function(){},Cancel:function(){},Clear:function(){this._selectedRows=[]},scheduleInvalidation:function(){var a=this;this._invalidationTimer||(this._invalidationTimer=setTimeout(function(){a.onSelection.invalidate.call(a),a._invalidationTimer=null
},10))},cancelInvalidation:function(){clearTimeout(this._invalidationTimer),this._invalidationTimer=null},invalidate:function(){this.components.dataArea.invalidateDisplay("Chart.onSelection.invalidate"),this.components.legend&&this.components.legend.invalidateDisplay("Chart.onSelection.invalidate"),Object.keys(this.components).forEach(function(a){this.components[a]instanceof f&&this.components[a].invalidateDisplay("Chart.onSelection.invalidate")},this)}},getLayoutMode:function(){return this._layoutMode},getVerticalLayoutMode:function(){return this._verticalLayoutMode},getHorizontalLayoutMode:function(){return this._horizontalLayoutMode},setLayoutMode:function(a){this._explicitLayoutMode=a,this._layoutMode!==a&&(this._layoutMode=a,this.fire("layoutModeChanged"))},getSnapshotSize:function(){return{w:this.rect.width,h:this.rect.height}},_updateLayoutMode:function(a,b){this._explicitLayoutMode||(this._layoutMode=r.getLayoutMode(a,b),this._horizontalLayoutMode=r.getHorizontalLayoutMode(a),this._verticalLayoutMode=r.getVerticalLayoutMode(b),this.fire("layoutModeChanged"),this.fire("verticalLayoutModeChanged"),this.fire("horizontalLayoutModeChanged"))},_createProviders:function(){var a=this.options;a.providers.colorMap&&(this.providers.colorMap="function"==typeof a.providers.colorMap.clazz?new a.providers.colorMap.clazz(void 0,a.providers.colorMap):new n,this.components.dataArea&&this.components.dataArea.setColorMap(this.providers.colorMap),this.components.legend&&this.components.legend.setColorMap(this.providers.colorMap))},_initiateBindings:function(){this._changeWatchers||(this._changeWatchers=[]);var a;for(a in this.components)this._changeWatchers.push(s.bindProperty(this.components[a],"layoutMode",this,"layoutMode")),this._changeWatchers.push(s.bindProperty(this.components[a],"verticalLayoutMode",this,"verticalLayoutMode")),this._changeWatchers.push(s.bindProperty(this.components[a],"horizontalLayoutMode",this,"horizontalLayoutMode"));this.components.dataArea&&this._changeWatchers.push(s.bindSetter(x.bind(this),this.components.dataArea,"selectableShapes"))},_createComponents:function(){var a,b,e,f=this,n=this.components,o=this.options;Object.keys(o.components).map(function(a){return{sortKey:o.components[a].sortKey||0,cmpKey:a}}).sort(function(a,b){return a.sortKey-b.sortKey}).forEach(function(p){var q=p.cmpKey;if(a=["component",q].join("."),b=o.components[q],b.label=q,b.backendApi=f.backendApi,e=null,"function"==typeof o.components[q].clazz)e=o.components[q].clazz;else switch(q){case"grid":e=d;break;case"refLines":e=j;break;case"dataArea":case"dataArea2":e=c;break;case"miniChart":e=m;break;case"refLineLabels":case"refLineLabelsX":case"refLineLabelsY":e=k;break;case"axis":case"xAxis":case"yAxis":e=g;break;case"scrollArea":case"scrollAreaX":case"scrollAreaY":e=l;break;case"legend":e=i;break;case"xAxisTitle":case"yAxisTitle":e=h}e&&(n[q]=new e(this.container,b,a),n[q].setUseTransition(u.state<2),n[q]instanceof m||this.layoutEngine.addComponent(n[q]))},this)},preLayout:function(){},layout:function(a){this.layoutEngine.layout(this.rect,this._layoutMode,this.containerRect,a)},resize:function(){this._data&&this.isValid(this._data)&&this.prePaint(this._data),this._paint()},setSnapshotData:function(a){var b=this.getSnapshotSize(),c={};Object.keys(this.components).forEach(function(a){c[a]={visible:this.components[a].isVisible(),dock:this.components[a].dock,size:{w:this.components[a].rect.width,h:this.components[a].rect.height}}},this),a.snapshotData.content={chartData:this.getSnapshotChartData(),size:{w:b.w,h:b.h},components:c,v:.96}},getSnapshotChartData:function(){var a={};return this.components.legend&&(a.legendScrollOffset=this.components.legend.getScrollPosition()),a},getSnapshotStoredChartData:function(){return this._data&&this._data.snapshotData&&this._data.snapshotData.content?this._data.snapshotData.content.chartData:void 0},_postResize:function(){},_paint:function(){if(this.$scope.dataAttributes.layoutMode=this._layoutMode,!this.isValid(this._data))return this.clear(),!1;var a=this.getSnapshotStoredChartData();this.components.legend&&(this.components.legend.pagingMode=this._pagingMode||0,this._readStoredData&&a&&this.components.legend.setScrollPosition(a.legendScrollOffset||0)),z.call(this),this.$scope.dataAttributes.doesNotFit=this.rect.height<10,this._sizeChanged&&this._postResize()},paint:function(a,b){a.qSelectionInfo&&a.qSelectionInfo.qInSelections||this._paint(b)},suppressOnPaint:function(a){var b=this._super(a);return b&&this.prePaint(a),b},prePaint:function(){},updateData:function(a){return this._data=a,this.isValid(a)&&this._madeSelections!==!1?void this._updateData(a):(delete this._madeSelections,this.updateSelectableState(a),void this.clear())},_updateData:function(a){var b;this._data=a,this._readStoredData=a&&a.snapshotData&&a.snapshotData.content&&!this.isEffect&&u.view===u.Views.story,this._selectedRows=[],a.legend&&this.components.legend&&this.components.legend[(a.legend.auto||a.legend.show?"show":"hide")+"Component"](),B.call(this),this.providers.colorMap&&(this.providers.colorMap.setMeasureFormatters(this.chartFormatter.getFormatters()),this.providers.colorMap.setGenericFormatter(this.chartFormatter.createFormatter())),this.selections&&this.selections.types.tooltip&&(this.selections.types.tooltip.measureFormatters=this.chartFormatter.getFormatters(),this.selections.types.tooltip.parentScope=this.$scope,this.selections.types.tooltip.colorMap=this.providers.colorMap),this._chartContext.refresh(a);var c=this.isValid(this._data);for(b in this.components)this.components[b]._hasValidData=c;this.updateSelectableState()},destroy:function(){for(this.off();this._changeWatchers.length;)this._changeWatchers.pop().unbind();var a;for(a in this.components)this.components[a].release();for(a in this.providers)this.providers[a].release&&this.providers[a].release();this.$scope.dataAttributes={},this.selections&&this.selections.cache.clear(),this._chartContext.release(),this._data&&u.view!==u.Views.story&&delete this._data.snapshotData,this._super.apply(this,arguments)},clear:function(){Object.keys(this.components).forEach(function(a){this.components[a].clear()},this)},isValid:function(a){var b,c=!1;c=!!a&&!!a.qHyperCube&&a.qHyperCube.qDimensionInfo.length&&!a.qHyperCube.qDimensionInfo.some(function(a){return!!a.qError})&&a.qHyperCube.qMeasureInfo.length&&!a.qHyperCube.qMeasureInfo.some(function(a){return!!a.qError});for(b in this.components)this.components[b].setHasValidData(c);return c},isDataSelectable:function(a){return this.isValid(this._data)&&this.allowInteraction(u)?a.qHyperCube.qDimensionInfo.some(function(a){return a.qLocked!==!0}):!1},updateSelectableState:function(a){this.selections&&this.selections.setLocked(this.isDataSelectable(a||this._data)?!1:!0)},on:function(){Object.keys(this.components).forEach(function(a){this.components[a].on()},this),this.updateSelectableState(this._data),this._super()},off:function(){Object.keys(this.components).forEach(function(a){this.components[a].off()},this),this._super()},setInteraction:function(a){a?this.on():this.off()},selectWhileLocked:function(){w.showLockedFeedback(this._data.qHyperCube.qDimensionInfo)}})}),define("objects.views/charts/axis-chart",["jquery","objects.views/charts/chart","objects.views/charts/components/chart-component","general.utils/property-resolver"],function(a,b,c,d){function e(a,b){a.setDock(b&&"auto"!==d.getValue(b,"legend.dock","auto")?b.legend.dock:a.outerRect.height/a.outerRect.width<1?"right":"bottom")}var f;return f=b.extend({init:function(b,d,e,f){var g=a.extend(!0,{components:{grid:{show:!0,dock:"center",showFlag:c.prototype.ShowFlags.XSMALL},legend:{show:!1,order:4,reductionOrder:1,dock:"right",relevantSize:126,showFlag:c.prototype.ShowFlags.MEDIUM},xAxis:{show:!0,order:1,dock:"bottom",relevantSize:120,showFlag:c.prototype.ShowFlags.XSMALL},yAxis:{show:!0,order:1,dock:"left",relevantSize:90,reductionOrder:2,showFlag:c.prototype.ShowFlags.XSMALL},xAxisTitle:{show:!0,order:1.1,dock:"bottom",relevantSize:30,reductionOrder:1,showFlag:c.prototype.ShowFlags.SMALL}}},e||{});this._super(b,d,g,f)},_updateData:function(a,b){this._super.apply(this,[].slice.call(arguments)),this.updateDataArea(a,b),this.updateAxis(a,b),this.updateLegend(a,b),this.updateGrid(a,b),this.updateRefLines(a,b)},updateDataArea:function(a,b){var c,d;for(c in b.axes)d=b.axes[c],d.component.setDataIndices(d.dataIndices||[d.dataIndex||0]),d.component.setCurrentDataIndices(d.currentDataIndices||d.dataIndices||[d.dataIndex||0])},setAxisDataRange:function(a,b,c,d,e,f){null!==d&&null!==e||null===d&&null===e?a.setDataRange(c,b):null!==d&&c>=d?a.setDataRange(d-f,b):null!==e&&e>=b?a.setDataRange(c,e+f):a.setDataRange(c,b)},updateAxis:function(a,b){var c,d,e,f=b.axes;for(c in b.axes)d=f[c],d.component.setTitle(d.title),d.component.setShowStrategy(d.data.show),d.component.setLabelMode(d.data.label),d.component.setLockedInfo&&d.component.setLockedInfo(a.qHyperCube.qDimensionInfo.map(function(a){return a.qLocked===!0})),d.component.setPlotMin&&(e=this.getAxisOptions(d),d.component.setPlotMin(e.min),d.component.setPlotMax(e.max),d.component.setTickMultiplier(d.data.spacing),d.component.setLogScale(d.data.logarithmic)),["right","left","top","bottom"].contains(d.data.dock)&&(d.data.dock=["right","top"].contains(d.data.dock)?"far":"near"),d.component.setDock(d.component.isVertical()?"far"===d.data.dock?"right":"left":"far"===d.data.dock?"top":"bottom");for(c in b.axisTitles)d=b.axisTitles[c],d.component.setTitle(d.title),d.component.setShowStrategy(d.data.show),["right","left","top","bottom"].contains(d.data.dock)&&(d.data.dock=["right","top"].contains(d.data.dock)?"far":"near"),d.component.setDock(d.component.isVertical()?"far"===d.data.dock?"right":"left":"far"===d.data.dock?"top":"bottom")},getAxisOptions:function(a){return a&&a.data?a.data.autoMinMax?{min:null,max:null}:{min:["min","minMax"].contains(a.data.minMax)?Number(a.data.min):null,max:["max","minMax"].contains(a.data.minMax)?Number(a.data.max):null}:void 0},_postResize:function(){this._super(),e.apply(this,[this.components.legend,this._data])},updateLegend:function(a){this.components.legend&&(e.apply(this,[this.components.legend,this._data]),this.components.legend.setShowTitle(d.getValue(a,"legend.showTitle",!1)))},updateGrid:function(a,b){if(this.components.grid){var c,d;if(a.gridLine&&"number"==typeof a.gridLine.spacing){d=a.gridLine.auto?2:a.gridLine.spacing;for(c in b.axes)b.axes[c].component.setSpacingMode&&b.axes[c].component.setSpacingMode(d)}}},updateRefLines:function(a,b){var c,d=b.refLineLabels,e=[],f=[];for(c in d)d[c].component&&(d[c].component.setData(d[c].data),d[c].component.setAxis(d[c].axis),d[c].component.setDock(d[c].axis.getOppositeDock()),f.push(d[c].axis),e.push(d[c].data));b.refLines&&b.refLines.component&&(b.refLines.component.setAxes(f),b.refLines.component.setData(e))}})}),define("objects.views/charts/scrollable-chart",["jquery","./axis-chart","objects.views/charts/components/axis/discrete-axis","objects.views/charts/components/axis/continuous-axis","objects.views/charts/components/chart-component","objects.views/charts/representation/combo-color-map","objects.views/charts/utils/binding","objects.utils/event-utils","objects.utils/shapes/rect","touche"],function(a,b,c,d,e,f,g,h,i){function j(a,b){var c,d,e=this.components.scrollArea;this._panning||(this._panning=!0,this._panX=b.points[0].x,this._panY=b.points[0].y),e.isHorizontal()?(d=b.swipe&&b.swipe.currentPoint?b.swipe.currentPoint.x:a.pageX,c=e.getOffset()-(d-this._panX)/(this.components.dimensionAxis._discreteSpacing||28),this._panX=d):(d=b.swipe&&b.swipe.currentPoint?b.swipe.currentPoint.y:a.pageY,c=e.getOffset()-(d-this._panY)/(this.components.dimensionAxis._discreteSpacing||28),this._panY=d),c=0>c?0:c,e.setOffset(c)}function k(a){var b=a.getActiveType(),c=a.types.tooltip;b&&"range.dimension"===b.getActiveMode()&&b.cancel(),c&&c.clearSelection()}function l(a,b,e,f){var g,h,i=[],j=[];Object.keys(this.components).forEach(function(a){this.components[a]instanceof c?i.push(this.components[a]):this.components[a]instanceof d&&!this.components[a].isStacked&&j.push(this.components[a])}.bind(this)),g=["top","bottom"].contains(i[0].dock)?"x":"y",h="x"===g?"y":"x",this.selections.types.range.setComponent(g,i),1===a&&this.selections.types.tooltip.setComponent(g,i),this.selections.types.range.setComponent(h,j),e&&(a>1||b>1)?(this.selections.types.range.setComponent(h,[]),"byMeasure"===f?this.selections.types.legend.removeComponent("legend",this.components.legend):this.selections.types.legend.setComponent("legend",this.components.legend)):this.selections.types.legend.setComponent("legend",this.components.legend)}function m(){this._isPagingTransitionEnabled&&(this.components.measureAxis.setDataRangeTransition(!1),this.components.measureAxis.stopListen("endTransition",n,this),this.components.measureAxis.stopListen("startTransition",o,this),clearTimeout(this._pagingTransitionTimer),delete this.components.measureAxis.setDataRange,this._isPagingTransitionEnabled=!1)}function n(){this.components.refLineLabels&&this.layout();for(var a in this.components)this.components[a].invalidateDisplay("ScrollableChart.onAxisTransitionEnded")}function o(){this._visibleRefLines=this.components.refLineLabels.isVisible()}function p(){if(!this._isPagingTransitionEnabled){this._isPagingTransitionEnabled=!0;var a=this,b=this.components.measureAxis,c=b.setDataRange;b.listen("endTransition",n,this),b.listen("startTransition",o,this),this._pagingTransitionTimer=null,this.components.measureAxis.setDataRange=function(d,e){clearTimeout(a._pagingTransitionTimer),a._pagingTransitionTimer=setTimeout(function(){var f;b.setDataRangeTransition(!0),c.apply(b,[d,e]),a.layout();for(f in a.components)a.components[f].invalidateDisplay()},500)}}}function q(){var a,b,c,d,e,f=this.components.scrollArea,g=this._scrollableHint,h=[];this._scrollAffordance||(this._scrollAffordance={canIncrease:!1,canDecrease:!1}),c=f.getOffset(),e=f.getViewRange(),d=f.fullState.max,b=c>0,a=d>c+e,(b!==this._scrollAffordance.canDecrease||a!==this._scrollAffordance.canIncrease)&&(this._scrollAffordance.canIncrease=a,this._scrollAffordance.canDecrease=b,b&&h.push(f.isVertical()?"up":"left"),a&&h.push(f.isVertical()?"down":"right"),g.attr("class",function(a,b){return b.replace(/\bqv-chart-scrollable-\S+/g,"")}),g.addClass("qv-chart-scrollable-"+h.join("-")))}var r,s={NONE:0,ONE_DIM:1,TWO_DIM:2};return r=b.extend("ScrollableChart",{init:function(b,d,h,j){var l=this,m=a.extend(!0,{providers:{colorMap:{clazz:f,multiDimScheme:"last"}},components:{refLines:{sortKey:5,show:!0,dock:"center",showFlag:e.prototype.ShowFlags.SPARK},dataArea:{sortKey:10,show:!0,dock:"center",showFlag:e.prototype.ShowFlags.SPARK},miniChart:{show:!0,components:{dimensionAxis:{show:!1,clazz:c},measureAxis:{show:!1},dataArea:{isMini:!0,show:!0}}},xAxis:{clazz:c,reductionOrder:10,shrinkToFitThreshold:.85,showFlag:{whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.SMALL},whenHorizontal:{vertical:e.prototype.ShowFlags.SMALL,horizontal:e.prototype.ShowFlags.XSMALL}},titleShowFlag:{whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.MEDIUM},whenHorizontal:{vertical:e.prototype.ShowFlags.MEDIUM,horizontal:e.prototype.ShowFlags.XSMALL}}},xAxisTitle:{showFlag:{whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.MEDIUM},whenHorizontal:{vertical:e.prototype.ShowFlags.MEDIUM,horizontal:e.prototype.ShowFlags.XSMALL}},reductionOrder:1},scrollArea:{sortKey:2,show:!1,dock:"bottom",order:2,relevantSize:20,reductionOrder:10.1,showFlag:e.prototype.ShowFlags.XSMALL},refLineLabels:{show:!0,dock:"right",order:3,reductionOrder:3,showFlag:{whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.SMALL},whenHorizontal:{vertical:e.prototype.ShowFlags.MEDIUM,horizontal:e.prototype.ShowFlags.XSMALL}}}}},h||{});this._super(b,d,m,j),this._scrollableHint=a("<div class='qv-chart-scrollable'>").appendTo(d),this._changeWatchers=this._changeWatchers||[],this._pagingInfo=new i(0,0,0,0),this.components.measureAxis=this.components.yAxis,this.components.dimensionAxis=this.components.xAxis,this.components.dimensionAxisTitle=this.components.xAxisTitle,delete this.components.xAxisTitle,delete this.components.xAxis,delete this.components.yAxis,this.components.dimensionAxisTitle.setType("dimension"),this.components.dimensionAxisTitle.listen("drill-up",function(a,b,c){l.backendApi.drillUp(b,c)}),this.components.scrollArea.listen("scrollStart",function(){k(this.selections)}.bind(this)),this._showLegend=!1,this.scrollMultiplicator=1,this.components.dataArea.setMinorAxis(this.components.measureAxis),this.components.dataArea.setMajorAxis(this.components.dimensionAxis),this.components.grid.setAxes(this.components.dimensionAxis,this.components.measureAxis),this.components.dimensionAxis.setMinDiscreteUnitSize(28),this._changeWatchers.push(g.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(g.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(g.bindSetter(function(){l.components.dimensionAxis.setOffset(l.components.scrollArea.getOffset())},this.components.scrollArea,"offset")),this._changeWatchers.push(g.bindSetter(function(a){l.components.scrollArea.setFullRange(a)},this.components.dimensionAxis,"numDiscreteUnits")),this._changeWatchers.push(g.bindSetter(function(a){l.components.scrollArea.setViewRange(l._pagingMode===s.TWO_DIM?a/2:a)},this.components.dimensionAxis,"numDiscreteUnitsInView")),this._changeWatchers.push(g.bindSetter(function(){l._checkPage!==!1&&l.checkPage(),q.call(l)},this.components.dimensionAxis,"offset"))},initSelections:function(){this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.range.setComponent("dataArea",this.components.dataArea),this.selections.types.legend.setComponent("legend",this.components.legend),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Pan.bind(this.onPan.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this))},getSnapshotSize:function(){var a=this.rect.width,b=this.rect.height,c=this.getSnapshotChartData();return!c.hasMiniChart&&this.components.scrollArea.isVisible()&&(this.components.scrollArea.isVertical()?a-=this.components.scrollArea.rect.width:b-=this.components.scrollArea.rect.height),{w:a,h:b}},getSnapshotChartData:function(){return a.extend(!0,this._super()||{},{scrollOffset:this.components.scrollArea.getOffset(),discreteSpacing:this.components.dimensionAxis.getDiscreteSpacing(),axisInnerOffset:this.components.dimensionAxis.getInnerOffset(),hasMiniChart:this.components.miniChart&&!!this.components.miniChart.isVisible()})},checkPage:function(a){if(!this.isValid(this._data)||!this._pagingMode)return!1;var b=this.components.scrollArea,c=Math.floor(b.getOffset()/this.scrollMultiplicator),d=this._pagingInfo.y,e=this._pagingInfo.height,f=this._pagingMode===s.TWO_DIM?0:5,g=Math.ceil(b.getViewRange()/this.scrollMultiplicator);return isNaN(g)&&(g=500),this._pagingMode===s.TWO_DIM&&(g*=2),c+g>d+e||Math.max(0,c)<d?this.pageData(Math.floor(Math.max(0,c-f)),g+2*f,a):void 0},pageData:function(a,b,c){if("function"!=typeof this.backendApi.getReducedData)return!1;if(this._data.qHyperCube){var d,e=this;d="K"===this._data.qHyperCube.qMode?this._data.qHyperCube.qStackedDataPages[0]&&this._data.qHyperCube.qStackedDataPages[0].qData&&this._data.qHyperCube.qStackedDataPages[0].qData.length>0:this._data.qHyperCube.qDataPages[0]&&this._data.qHyperCube.qDataPages[0].qMatrix.length>0,0>=b?("S"===e._data.qHyperCube.qMode?e._data.qHyperCube.qDataPages=[]:e._data.qHyperCube.qStackedDataPages=[],e._pagingInfo.set(a,0,this._data.qHyperCube.qSize.qcx,b)):this.backendApi.getData([{qTop:a,qLeft:0,qWidth:this._data.qHyperCube.qSize.qcx,qHeight:b}]).then(function(f){if("S"===e._data.qHyperCube.qMode){e._data.qHyperCube.qDataPages=f;var g=f[0].qArea;e._pagingInfo.set(g.qLeft,g.qTop,g.qWidth,g.qHeight)}else e._data.qHyperCube.qStackedDataPages=f,e._pagingInfo.set(0,a,e._data.qHyperCube.qSize.qcx,b);c||!d?(e._chartContext.refresh(e._data),e.paint(e._data)):e.partialUpdate(e._data)})}},partialUpdate:function(a){var b,c,d,e;p.call(this),this._chartContext.refresh(a),this.providers.colorMap.setData(a),c=a.qHyperCube.qStackedDataPages.length>0?this._pagingInfo.y:a.qHyperCube.qDataPages[0].qArea.qTop,this.components.dimensionAxis.setInnerOffset(c*this.scrollMultiplicator);for(b in this.components)"miniChart"!==b&&this.components[b].invalidateProperties("ScrollableChart.partialUpdate");this.components.dataArea.updateNow(["properties"]),d=this.components.dataArea.getMajorAxisData(),e=this.components.dataArea.getMinorAxisData(),e&&this.components.measureAxis.setDataRange(e.min,e.max),this.components.dimensionAxis.setDataRange(d.data,d.info),this.components.legend.updateNow(["properties"]),this.components.dimensionAxis.updateLevels(),this.components.dimensionAxis.invalidateDisplay("ScrollableChart.partialUpdate"),this.components.dataArea.invalidateDisplay("ScrollableChart.partialUpdate"),this.components.legend.invalidateDisplay("ScrollableChart.partialUpdate")},_updateData:function(a){if(this._super.apply(this,[].slice.call(arguments)),this._pagingInfo.set(0,0,0,0),this.isValid(a)){var b,c=a.qHyperCube.qStackedDataPages[a.qHyperCube.qStackedDataPages.length-1];b=c&&c.qData?{qLeft:0,qTop:0,qWidth:a.qHyperCube.qSize.qcx,qHeight:c.qData[0].qSubNodes.length}:a.qHyperCube.qDataPages[0].qArea,this._pagingInfo.set(b.qLeft,b.qTop,b.qWidth,b.qHeight)}},updateAxis:function(a){var b;this._super.apply(this,[].slice.call(arguments)),b=this.getSnapshotStoredChartData(),!this._readStoredData||b&&b.hasMiniChart?this.components.scrollArea.showComponent():this.components.scrollArea.hideComponent(),l.apply(this,[a.qHyperCube.qDimensionInfo.length,a.qHyperCube.qMeasureInfo.length,"S"!==a.qHyperCube.qMode,a.color?a.color.mode:null]),this._updateMinDiscreteUnitSize(this.components.dimensionAxis)},_disablePagingTransitions:function(){m.call(this)},_enablePagingTransitions:function(){p.call(this)},_postResize:function(){this._super(),this.components.dimensionAxis&&this._updateMinDiscreteUnitSize(this.components.dimensionAxis)},_updateMinDiscreteUnitSize:function(a){a.setMinDiscreteUnitSize(!a.isVisible(this._layoutMode)||"title"===this._data.dimensionAxis.show||"all"===this._data.dimensionAxis.show&&"none"===this._data.dimensionAxis.label?this._layoutMode===e.prototype.ShowFlags.SPARK?7:20:28)},layout:function(){this._super(this.components.dimensionAxis.isVertical()?"vertical":"horizontal");var a=this.components.dataArea.rect.clone(),b={top:0,left:0,right:0,bottom:0},c=this.components.measureAxis.getPadding(),d=this.components.dataArea.layoutToContainerRatios;b.top+=c.top,b.left+=c.left,b.right+=c.right,b.bottom+=c.bottom,this._scrollableHint.css({left:(a.x+b.left)*d.x,top:(a.y+b.top)*d.y,width:(a.width-b.left-b.right)*d.x,height:(a.height-b.top-b.bottom)*d.y}),q.call(this)},onPan:function(a,b,c){var d=this;switch(a){case"start":d._panX=c.points[0].x,d._panY=c.points[0].y,k(d.selections);break;case"update":j.apply(d,[b,c]);break;case"end":this._panning=!1}},on:function(){var b=this,c=this.namespace,d=3,e=function(c){var e,f=h.getMouseWheelData(c.originalEvent),g=b.components.scrollArea,i=b.components.legend.rect.clone(),j=a(b.components.legend.container).offset();i.x=j.left,i.y=j.top,i.pointInside(f.x,f.y)||(e=Math.floor(g.getOffset())+(f.delta>0?-d:d),e=0>e?0:e,g.setOffset(e),k(b.selections))};Touche(this.container).swipe({id:c,options:{useMomentum:!0,touches:2,inertia:.7},start:function(a,c){b._panning=!0,b._panX=c.points[0].x,b._panY=c.points[0].y,k(b.selections)},update:function(a,c){j.apply(b,[a,c])},end:function(){b._panning=!1}}),Touche(this.container).wheelswipe({id:c,options:{useMomentum:!0,inertia:.7},start:function(a){b._panning=!0,b._panX=a.pageX,b._panY=a.pageY,k(b.selections)},update:function(a,c){j.apply(b,[a,c])},end:function(){b._panning=!1}}),a(this.container).on("mousewheel"+c+" DOMMouseScroll"+c,h.throttle(e,20)),this.components.miniChart&&a(this.components.miniChart.container).on("mousewheel"+c+" DOMMouseScroll"+c,h.throttle(e,20)),this._super()},off:function(){Touche(this.components.dataArea.container).off("*",this.namespace),Touche(this.container).off("*",this.namespace),this.components.miniChart&&a(this.components.miniChart.container).off(this.namespace),a(this.container).off(this.namespace),this._super()},destroy:function(){this._super(),this._disablePagingTransitions(),this.components.scrollArea.stopListen("scrollStart"),this.components.dimensionAxisTitle.stopListen("drill-up")}})}),define("objects.backend-api/hypercube-api",["./backend-api"],function(a){var b;return b=a.extend("HyperCube",{init:function(a){this._super(a,"/qHyperCubeDef"),this.cacheCube.setMethodName("GetHyperCubeData")},updateCache:function(a){a&&a.qHyperCube?(this.cacheCube.set(a.qHyperCube.qDataPages),this.cacheCube.setCubeSize(a.qHyperCube.qSize)):this.cacheCube.clear()},getData:function(a){return this.cacheCube.getData(a)},getReducedData:function(a,b,c){return c=void 0!==c?c:"D1",this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,a,b,c])},selectRange:function(a,b,c){var d;return b=!!b,c=c||[],d=a.map(function(a){return{qMeasureIx:a.measure,qRange:{qMin:a.range.min,qMax:a.range.max,qMinInclEq:a.range.minInclEq!==!1,qMaxInclEq:a.range.maxInclEq!==!1}}}),this.model.rpc("RangeSelectHyperCubeValues",null,[this.path,d,c,b])},select:function(a,b){return this.model.rpc("SelectHyperCubeCells",null,[this.path,a,b])},selectValues:function(a,b,c){return this.model.rpc("SelectHyperCubeValues",null,[this.path,a,b,c])},getProperties:function(){return this.model.getProperties()},save:function(){return this.model.save()},getDimensionInfos:function(){return this.model.layout.qHyperCube.qDimensionInfo},getMeasureInfos:function(){return this.model.layout.qHyperCube.qMeasureInfo},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections}})}),define("objects.backend-api/stacked-api",["./hypercube-api"],function(a){function b(a,b,c){var d,e,f,g=[];for(e=0;e<b.length;e++)for(d=0;d<a.length;d++)f={qType:c,qCol:b[e],qRow:a[d]},g.push(f);return g}var c;return c=a.extend("StackedApi",{init:function(){this._super.apply(this,arguments),this.backendStackThrottle.setMethodName("GetHyperCubeStackData")},updateCache:function(a){a&&a.qHyperCube&&"S"===a.qHyperCube.qMode?(this.cacheCube.set(a.qHyperCube.qDataPages),this.cacheCube.setCubeSize(a.qHyperCube.qSize)):this.cacheCube.clear(),this.backendStackThrottle.clear()},getData:function(a){switch(this.model.layout.qHyperCube.qMode){case"P":return this.model.rpc("GetHyperCubePivotData","qDataPages",[this.path,a]);case"S":return this.cacheCube.getData(a);case"K":return this.backendStackThrottle.getData(a);default:return this.cacheCube.getData(a)}},getReducedData:function(a,b,c){return c=void 0!==c?c:"D1",this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,a,b,c])},select:function(a,c,d){switch(this.model.layout.qHyperCube.qMode){case"P":case"K":return this.model.rpc("SelectPivotCells",null,[this.path,b(a,c,d)]);default:return this.model.rpc("SelectHyperCubeCells",null,[this.path,a,c])}}})}),define("text!extensions.qliktech/barchart/barchart.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<div class="qv-viz-disclaimer" ng-if="dataAttributes.limitedData || dataAttributes.hasNegativeData">\r\n	<span>*</span>\r\n	<span ng-if="dataAttributes.limitedData" q-translation="Object.Disclaimer.LimitedData" q-title-translation="Object.Disclaimer.LimitedData" ng-style="getDisclaimerStyle(dataAttributes.chartScale)"></span>\r\n</div>\r\n'}),define("extensions.qliktech/barchart/barchart",["jquery","util","client.utils/state","extensions.qliktech/barchart/bararea","extensions.qliktech/barchart/barchart-properties","extensions.qliktech/barchart/barchart-data","objects.views/charts/scrollable-chart","objects.backend-api/stacked-api","text!./barchart.ng.html","objects.extension/object-conversion"],function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c,d,e,f){var g,h=["bottom","top"],i=["left","right"];"horizontal"===f?(g=h,h=i,i=g,d.setDock("right")):d.setDock("bottom"),a.setDock("far"===e.dimensionAxis.dock?h[1]:h[0]),b.setDock("far"===e.dimensionAxis.dock?h[1]:h[0]),c.setDock("far"===e.measureAxis.dock?i[1]:i[0])}var l,m,n=500,o={NONE:0,ONE_DIM:1,TWO_DIM:2};return l=g.extend("BarChart",{namespace:".barchart",init:function(b,c,e,f){var g,h=a.extend(!0,{},e);this.$scope=b,e=a.extend(!0,e||{},{components:{dataArea:{clazz:d},miniChart:{components:{dataArea:{clazz:d}}}}},h),this._super(b,c,e,f),this._data={},this._tree=null,this.components.dimensionAxis.setMaxDiscreteUnitSize(64),g=this.components.miniChart,this.components.miniChart&&(this.components.miniChart.setBackendApi(this.backendApi),this.components.scrollArea.setUseMiniChart(!0),g.components.measureAxis.setDock("left"),g.components.dimensionAxis.setDock("bottom"),g.components.dataArea.setMinorAxis(g.components.measureAxis),g.components.dataArea.setMajorAxis(g.components.dimensionAxis),g.components.dataArea.setShowDataPoints(!1),g.setColorMap(this.providers.colorMap)),this._orientation="vertical"},initSelections:function(){this.selections.Select.bind(function(a,b){var c=[0];this.selections._activeType.components.dataArea?c=this.components.dataArea.getSelectionIndices()||[0]:this.selections._activeType.components.legend&&(c=this.components.legend.getSelectionIndices()),this.onSelection.Select.apply(this,[a,b,c,"L"])}.bind(this)),this._super()},_paint:function(){if(this._super()===!1)return!1;var a,b=this._data,c=this.components.scrollArea,d=this.getSnapshotStoredChartData(),e="vertical"===b.orientation?this.rect.height:this.rect.width,f=0;if(this._cutMode?((this._cutMode.positive||this._cutMode.negative)&&(f=this._layoutMode>=15?32:this._layoutMode>=7?16:8),"vertical"===b.orientation?this.components.measureAxis.setPadding(this._cutMode.positive?f:0,0,this._cutMode.negative?f:0,0):this.components.measureAxis.setPadding(0,this._cutMode.positive?f:0,0,this._cutMode.negative?f:0)):this.components.measureAxis.setPadding(0,0,0,0),this.components.dimensionAxis.setMaxDiscreteUnitSize(Math.max(1,Math.ceil(e/4))),this.components.dimensionAxisTitle.setFont(this.components.dimensionAxis._style.title.font),this.layout(),this._dataForMiniChartChanged&&this.components.scrollArea.isVisible()&&this.components.scrollArea.getUseMiniChart()&&this.components.miniChart&&(this.components.miniChart.setData(b),this._dataForMiniChartChanged=!1),this._readStoredData&&(this.components.dimensionAxis.setInnerOffset(d.axisInnerOffset),this.components.scrollArea.setOffset(d.scrollOffset)),!this.checkPage()){for(a in this.components)this.components[a].invalidateDisplay("BarChart.paint");c.viewState.min+c.viewState.range>c.fullState.max&&c.setOffset(c.fullState.max-c.viewState.range)}},prePaint:function(){},_updateData:function(a){this._checkPage=!1,this._disablePagingTransitions.call(this),this._data=a,this._dataForMiniChartChanged=!0,this.isStacked="stacked"===a.barGrouping.grouping&&(a.qHyperCube.qDimensionInfo.length>1||a.qHyperCube.qMeasureInfo.length>1),this.components.measureAxis.isStacked=this.isStacked,this.components.scrollArea.setUseMiniChart(!0),this.components.dataArea.setData(a),this.providers.colorMap.setData(a),this.components.legend.setData(a),this.components.dimensionAxisTitle.setData(a),a.orientation&&this.components.miniChart?(this._orientation!==a.orientation&&(this.components.miniChart.clear(),this._orientation=a.orientation),this.components.miniChart.setOrientation(a.orientation),this.components.scrollArea.setMiniChart(this.components.miniChart)):this._orientation=a.orientation;
var b={axes:{measureAxis:{component:this.components.measureAxis},dimensionAxis:{component:this.components.dimensionAxis}},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle}},refLineLabels:{labels:{data:a.refLine.refLines,component:this.components.refLineLabels}},refLines:{component:this.components.refLines}},c=null,d=this.getSnapshotStoredChartData();this.scrollMultiplicator=1,this._pagingMode=o.NONE,this.components.dataArea._allowInnerSelection=!1,a.qHyperCube.qDimensionInfo.length<2&&a.qHyperCube.qSize.qcy>n?(c=a.qHyperCube.qSize.qcy,"grouped"===a.barGrouping.grouping&&a.qHyperCube.qMeasureInfo.length>1&&(this.scrollMultiplicator=a.qHyperCube.qMeasureInfo.length+1,c*=this.scrollMultiplicator),this._pagingMode=o.ONE_DIM):a.qHyperCube.qDimensionInfo.length>1&&"grouped"===a.barGrouping.grouping?(a.qHyperCube.qSize.qcy>n&&(this._pagingMode=o.TWO_DIM,c=a.qHyperCube.qSize.qcy),this.components.dataArea._allowInnerSelection=a.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected<=1):a.qHyperCube.qDimensionInfo.length>1&&(this.components.dataArea._allowInnerSelection=a.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected<=1,c=this.isStacked?a.qHyperCube.qStackedDataPages&&a.qHyperCube.qStackedDataPages.length?a.qHyperCube.qStackedDataPages[0].qData[0].qSubNodes.length+a.qHyperCube.qStackedDataPages[0].qData[0].qDown:a.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected:a.qHyperCube.qDataPages[0].qMatrix.length+a.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected,this._pagingMode=o.ONE_DIM),this.components.dimensionAxis.isDiscrete()||(this._pagingMode=o.NONE),this.components.dimensionAxis.setNumDiscreteUnits(c),this._super(a,b),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(d.axisInnerOffset),this.components.scrollArea.setOffset(d.scrollOffset)):(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)),this._checkPage=!0},updateDataArea:function(a){this.components.dataArea.setShowDataPoints(a.dataPoint.showLabels),this.components.dataArea.setGroupingMode(a.barGrouping.grouping),this.components.miniChart&&this.components.miniChart.components.dataArea.setGroupingMode(a.barGrouping.grouping),this.components.dataArea.updateNow(["properties"])},updateAxis:function(d,e){var f,g,h,i,j,l,n,o,p,q,r,s,t,u=d.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return{min:a.qMin,max:a.qMax,index:d.qHyperCube.qMeasureInfo.indexOf(a)}});p=u.reduce(function(a,b){return a.min<b.min?a:b},u[0]),q=u.reduce(function(a,b){return a.max>b.max?a:b},u[0]),r=p?p.min:m,s=q?q.max:m,b.isNumeric(r)||(r=0),b.isNumeric(s)||(s=1),f=this.components.measureAxis,g=this.components.dimensionAxis,h=this.components.dimensionAxisTitle;var v=this.components.dataArea.getMajorAxisData(),w=this.components.dataArea.getMinorAxisData();g.setDataRange(v.data,v.info),g.setGroupSize(v.groupSize),l=d.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle}).join(", "),n=d.qHyperCube.qDimensionInfo.map(function(a){return a.qFallbackTitle}).join(", "),c.view!==c.Views.story?(h.setTitle(n),h.showComponent()):h.hideComponent(),a.extend(e.axes.measureAxis,{data:a.extend(!0,{},d.measureAxis,{logarithmic:!1}),title:l,dataIndices:d.qHyperCube.qMeasureInfo.map(function(a,b){return b})}),a.extend(e.axes.dimensionAxis,{data:d.dimensionAxis,title:c.view!==c.Views.story?"":n,dataIndices:d.qHyperCube.qDimensionInfo.map(function(a,b){return b}),currentDataIndices:[0]}),a.extend(e.axisTitles.dimensionAxisTitle,{data:d.dimensionAxis,title:c.view!==c.Views.story?"":n}),o=e.axes.measureAxis,t=this.getAxisOptions(o),e.refLineLabels.labels.axis=f,k.apply(this,[g,h,f,this.components.scrollArea,d,this._orientation]),this._super(d,e);for(j in e.axes)i=e.axes[j],i.component.setDataIndices(i.dataIndices||[i.dataIndex||0]),i.component.setCurrentDataIndices(i.currentDataIndices||i.dataIndices||[i.dataIndex||0]);r>s?(s=10,r=-10):r===s&&0===s&&(s=10,r=-10),s=Math.max(0,s),r=Math.min(0,r),p&&q?(this._cutMode=this.getSpikeSettings(d,p,q,r,s,t),s=this._cutMode.max,r=this._cutMode.min):this._cutMode={positive:!1,negative:!1},w?this.setAxisDataRange(f,w.max,w.min,t.max,t.min,1):this.setAxisDataRange(f,s,r,t.max,t.min,1),g.setUnitAlignment("none"===d.measureAxis.show?"center":["near","far"].contains(d.measureAxis.dock)?g.isHorizontal()?d.measureAxis.dock:"near"===d.measureAxis.dock?"far":"near":g.isHorizontal()?"left"===d.measureAxis.dock?"near":"far":"bottom"===d.measureAxis.dock?"far":"near")},getSpikeSettings:function(a,b,c,d,e,f){for(var g,h,i=0,j=0,k=0,l=0,m=!1,n=!1,o=c.index+a.qHyperCube.qDimensionInfo.length,p=b.index+a.qHyperCube.qDimensionInfo.length,q=a.qHyperCube.qDataPages[0]?a.qHyperCube.qDataPages[0].qMatrix:[],r=0;r<q.length;r++)g=q[r],h=g[o].qNum,h>0&&!isNaN(h)&&(g[0].qIsOtherCell||g[1].qIsOtherCell?k=Math.max(h,k):i=Math.max(h,i)),h=g[p].qNum,0>h&&!isNaN(h)&&(g[0].qIsOtherCell||g[1].qIsOtherCell?l=Math.min(h,l):j=Math.min(h,j));return this.isStacked&&a.qHyperCube.qMeasureInfo.length+a.qHyperCube.qDimensionInfo.length>2||(null!==f.max&&f.max<e?m=f.max>0:i>0&&k/i>5&&(e=i,m=e>=0),null!==f.min&&f.min>d?n=f.min<0:0>j&&l/j>5&&(d=j,n=0>d)),{max:e,min:d,positive:m,negative:n}},setOrientation:function(a){this._orientation=a||"horizontal"},getOrientation:function(){return this._orientation}}),{type:"barchart",BackendApi:h,template:i,View:l,definition:e,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"S",qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:n,qLeft:0,qWidth:17}],qSuppressZero:!1,qSuppressMissing:!0}},snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},range:{},legend:{}}},data:f,importProperties:function(a,b,c){var d=j.axisChart.importProperties.apply(j,[a,b,c]),e=d.qProperty;return e.qHyperCubeDef.qDimensions.length>1&&"stacked"===e.barGrouping.grouping&&(e.qHyperCubeDef.qMode="K"),d},exportProperties:j.axisChart.exportProperties.bind(j)}}),define("extensions.qliktech/piechart/piearea-helper",["objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","objects.views/charts/components/axis/radial-axis-helper","general.utils/color"],function(a,b,c,d){function e(a,b){return Math.round(100*a*Math.pow(10,b))/Math.pow(10,b)}function f(a){return a/360*Math.PI*2%(2*Math.PI)}function g(b,c,d,e,f,g,j){if(j)return h(b,c,d,e,f);var k,l,m,n,o,p=c.end-c.start,q=c.radius,r=.4,s=a.measureText(b,d),t=(c.arcCenter+c.radianOffset)%(2*Math.PI),u=(t+Math.PI)%(2*Math.PI);return 0>p&&(p+=2*Math.PI),k=i(p>r&&s.width<p*q,u),m="center"===k,n=q*Math.cos(t)+(m?Math.cos(t)*s.width/2:0)+(m?-s.width/2:"right"===k?-s.width:0),o=q*Math.sin(t)+(m?Math.sin(t)*s.height/2:0),l={font:d,text:b,baseline:"middle",align:"left",textAlign:k,x:n,y:o,width:s.width,laHeight:s.height,arcCenter:u,arcLength:p,cx:c.cx,cy:c.cy},{type:"text",opacity:f,fill:e,shape:l}}function h(b,c,d,e,f){var g=c.radius,h=d.split("px"),i=h[1],j=a.measureText(b,d),k=Math.min(2*g/j.width,8),l=11,m=Math.min(100,Math.max(g/10*k*.3,l)),n=m+"px"+i;return{type:"text",opacity:f,fill:e,shape:{text:b,font:n,align:"center",baseline:"bottom",x:0,y:0,cx:c.cx,cy:c.cy,maxWidth:1.3*g}}}function i(a,b){return a?"center":b<Math.PI/2||b>1.5*Math.PI?"right":"left"}function j(c,d,e,f,g,h,i,j,l){var m,n,o,p,q,r,s=(e.arcCenter+e.radianOffset)%(2*Math.PI),t=(s+Math.PI)%(2*Math.PI),u=i?i:a.measureText(c,g),v=new b;return j?k(c,e,l,d,h):(q=f?e.innerRadius:e.radius,m=t<Math.PI/2||t>1.5*Math.PI,n=t>Math.PI,r=.07*(m?1:-1)*(n?1:-1)*Math.abs(Math.sin(t)),o=.95*q*Math.cos(s)+e.cx-(m?-1:1)*(Math.abs(Math.cos(t))*u.width/2),p=.95*q*Math.sin(s+r)+e.cy-(n?1:-1)*(Math.abs(Math.sin(t))*u.height/2),v.translate(o,p),{type:"text",fill:d,transform:v.elements,opacity:h,shape:{text:c,font:g,align:"center",baseline:"middle",maxWidth:1.4*u.width}})}function k(b,c,d,e,f){if(d){var g,h=c.radius,i=d.split("px"),j=i[0],k=i[1],l=.8*j,m=10,n=l+"px"+k,o=a.measureText(b,n);return o.width>1.2*h&&(g=1.2*h/o.width,l=Math.max(l*g,m),n=l+"px"+k),{type:"text",opacity:f,fill:e,shape:{text:b,font:n,align:"center",baseline:"top",x:c.cx,y:c.cy,maxWidth:1.3*h}}}}function l(a,b,c,e,f){return c||d.useDarkLabel(e,f)?b:a}function m(a,b,c){if(!(a.length<2)){var d,e,f,g,h=Math.min(c.width,c.height),i=[],j=[],k=[],l=[],m=[],o=[];for(f=0;f<a.length;f++)o.push({label:a[f],line:b[f]});for(o.sort(function(a,b){return a.label.shape.arcCenter>b.label.shape.arcCenter?1:-1}),f=0;f<a.length;f++)switch(e=o[f],d=e.label.shape,g=d.arcCenter,d.quartile=t(g),d.quartile){case 1:i.push(e);break;case 2:j.push(e);break;case 3:k.push(e);break;case 4:l.push(e)}return m=i.concat(j.reverse()).concat(k).concat(l.reverse()),m=n(m,h,c)}}function n(a,b,d){var e,f,g,h,i,j,k,l,m,n,t,u,v,w,x=a[0]?a[0].label.shape.laHeight:20,y=10,z=20;for(m=0;m<a.length;m++)e=a[m].label.shape,j=e.x,k=e.y,g=c.getPolPos({x:j,y:k}),h=g.a>Math.PI/2||g.a<-Math.PI/2,z=Math.max(Math.min(z,g.r/15),5),i=c.getCartPos({r:g.r+z,a:g.a}),j=i.x,k=i.y,0!==m&&(f=a[m-1].label.shape,l=f.y),f&&r(e.quartile,f.quartile)?(u=q(k,l,e.quartile,f.quartile,h,x),v=Math.abs(u),l=k+u+2*(u>0?1:-1)):(t=e.arcLength*b/3,v=x-t,l=k+(v>0?v*(1===e.quartile||2===e.quartile?1:-1):0)),v>y?(w={x:e.x,y:e.y},o(a[m],w,{x:j,y:l})):a[m].line.strokeWidth=0,e.x=j,e.y=l,e=p(e,d),e.maxWidth=e.width,e.width=null,"center"===a[m].label.shape.textAlign&&v>y&&(a[m].line.shape.x1+=Math.cos(a[m].label.shape.arcLength)*(h?1:-1)*a[m].label.shape.maxWidth/2,a[m].line.shape.x2+=(h?1:-1)*a[m].label.shape.maxWidth/4,a[m].line.shape.y1+=Math.sin(a[m].label.shape.arcLength)*(h?1:-1)*a[m].label.shape.laHeight/2,a[m].line.shape.y2+=(h?1:-1)*a[m].label.shape.laHeight/2,a[m].line.strokeWidth=1),n=e.y+e.cy+x*(s(e.quartile)?.5:-.5),(-n>0||n-d.height>0)&&(a[m].label.fill=void 0,a[m].line.strokeWidth=0);return a}function o(a,b,c){var d,e,f,g,h={r:Math.sqrt(b.x*b.x+b.y*b.y),a:Math.atan2(b.y,b.x)},i={r:Math.sqrt(c.x*c.x+c.y*c.y),a:Math.atan2(c.y,c.x)},j=a.label.shape.textAlign,k=2,l=3;return d=(h.r+k)*Math.cos(h.a),e=(h.r+k)*Math.sin(h.a),f=(i.r-l)*Math.cos(i.a),g=(i.r-l)*Math.sin(i.a),a.line.shape.x1=d+("right"===j?a.label.shape.width:0),a.line.shape.y1=e,a.line.shape.x2=f+("right"===j?a.label.shape.width:0),a.line.shape.y2=g,a}function p(a,b){switch(a.textAlign){case"left":a.x-a.width<-a.cx?(a.width+=a.cx+(a.x-a.width),a.x=-a.cx+a.width):a.x+a.width>b.width-a.cx&&(a.width-=a.x+a.width-(b.width-a.cx));break;case"right":a.x<-a.cx&&(a.width+=a.x+a.cx,a.x=-a.cx);break;case"center":a.x<-a.cx?(a.width+=a.x+a.cx,a.x=-a.cx):a.x+a.width>b.width-a.cx&&(a.width-=a.x+a.width-(b.width-a.cx))}return a}function q(a,b,c,d,e,f){var g;return g=f>(a-b)*(1===d||2===c?1:-1)?b-a+f*(e&&3===c||!e&&4===c?-1:1):0}function r(a,b){return a===b||3===a&&2===b}function s(a){return 1===a||2===a}function t(a){var b=1;return a>=1.5*Math.PI?b=2:a<=Math.PI/2?b=3:a>Math.PI/2&&a<Math.PI&&(b=4),b}function u(a,b,e,f,g){var h,i,j={type:"line",opacity:.4*g,strokeWidth:1};return h=c.getCartPos({r:f.radius-1,a:f.start+f.radianOffset},{x:f.cx,y:f.cy}),i=c.getCartPos({r:f.innerRadius+1,a:f.start+f.radianOffset},{x:f.cx,y:f.cy}),j.shape={x1:h.x,y1:h.y,x2:i.x,y2:i.y},j.stroke=b&&d.getContrast(a,b)>1.2?a.toHex():a.isDark()?"#ccc":"#333",j}return{getFormattedPercentageValue:e,getRadianOffset:f,createNameLabel:g,createValueLabel:j,getLabelColor:l,improveNameLabelPositions:m,updateLabel:o,checkQuartile:t,isBottomQuartile:s,checkRelevantQuartile:r,checkInterference:q,checkEllipsis:p,getDivider:u}}),define("extensions.qliktech/piechart/piearea",["objects.views/charts/components/chart-component","objects.utils/shapes/arc","objects.utils/shapes/rect","objects.views/charts/utils/tree-iterator","objects.views/charts/utils/canvas-renderer","objects.views/charts/chart-style-service","extensions.qliktech/piechart/piearea-helper","translator","general.utils/color"],function(a,b,c,d,e,f,g,h,i){function j(a){var b={backgroundColor:a.getValue(q,null,"backgroundColor"),dataPoint:{},dataValue:{},shape:{},line:{}};return b.dataPoint.label={fontFamily:a.getValue(q,"item.name","fontFamily"),fontWeight:a.getValue(q,"item.name","fontWeight"),color:{dark:a.getValue(q,"item.name","color","dark"),light:a.getValue(q,"item.name","color","light")},fontSize:{large:a.getValue(q,"item.name","fontSize","large"),medium:a.getValue(q,"item.name","fontSize","medium"),small:a.getValue(q,"item.name","fontSize","small"),tiny:a.getValue(q,"item.name","fontSize","tiny")}},b.dataValue.label={fontFamily:a.getValue(q,"item.value","fontFamily"),fontWeight:a.getValue(q,"item.value","fontWeight"),color:{dark:a.getValue(q,"item.value","color","dark"),light:a.getValue(q,"item.value","color","light")},fontSize:{large:a.getValue(q,"item.value","fontSize","large"),medium:a.getValue(q,"item.value","fontSize","medium"),small:a.getValue(q,"item.value","fontSize","small"),tiny:a.getValue(q,"item.value","fontSize","tiny")}},b.shape={border:{width:a.getValue(q,"item.shape.border","width")},selected:{border:{width:a.getValue(q,"item.shape.border","width","selected"),color:a.getValue(q,"item.shape.border","color","selected")}}},b.line={color:a.getValue(q,"item.line","color"),width:a.getValue(q,"item.line","width")},b}function k(a){this._fontSize=a>300?"large":a>200?"medium":a>100?"small":"tiny"}function l(a,c,d,e){var f,g=0,h=0;return e>0&&(f=(2*c+d)/2+this._radianOffset,g=e*Math.cos(f),h=e*Math.sin(f)),b.apply(a,[this.rect.width/2+g,this.rect.height/2+h,this._showAsDonut?this._innerRadius:0,this._radius,c,c+d,this._radianOffset]),a}function m(){if(this._data&&this._tree){var a,b,c,d,f,h,j,k,m,n,p,q,r,s,t,u,v,w,x,y,z,A,B,C=this._tree,D=C.children.length,E=0,F=0,G=[],H=[],I=[],J=[],K=[],L=this._styles,M=this,N=new i(L.backgroundColor).isDark();if(this.beforeRenderPie(this._tree,o),this._radianOffset=g.getRadianOffset(this._currentProperties.rotation+90),x={nameLabel:{font:L.dataPoint.label.fontWeight+" "+L.dataPoint.label.fontSize[M._fontSize]+" '"+L.dataPoint.label.fontFamily+"'",color:"#f00"},dataLabel:{font:L.dataValue.label.fontWeight+" "+L.dataValue.label.fontSize[M._fontSize]+" '"+L.dataValue.label.fontFamily+"'",color:"#f00"}},D&&(t=1===this._numSlices,this._itemData.forEach(function(a){!a.pieData||a.pieData.value<=0||(b=a.pieData.share,F=Math.min(2*Math.PI*b,2*Math.PI),f=a.parent.cacheItem,h=M._arcs[a.pieData.shpIndex],k=f.selected,y=k?1:M._globalAlpha,l.apply(M,[h,E-Math.PI,F]),w={border:{color:"white",width:0}},f.selected&&(w={border:{color:L.shape.selected.border.color,width:L.shape.selected.border.width}}),q=t&&!M._showAsDonut?{type:"circle",fill:a.pieData.color.toRGBA(),opacity:y,stroke:w.border.color,strokeWidth:w.border.width,shape:h}:{type:"arc",fill:a.pieData.color.toRGBA(),lineJoin:"round",opacity:y,stroke:w.border.color,strokeWidth:w.border.width,shape:h},f.highlighted?H.push(q):(G.push(q),t||k||(r=g.getDivider.call(this,a.pieData.color,d,w.border,q.shape,y),G.push(r),M.dividerAddedToRender(r))),M.pieAddedToRender(a,q),M._showDimensionValues&&(c=t?g.getLabelColor(L.dataPoint.label.color.light,L.dataPoint.label.color.dark,M._showAsDonut,a.pieData.color,N):N?L.dataPoint.label.color.light:L.dataPoint.label.color.dark,m=g.createNameLabel(a.pieData.title,h,x.nameLabel.font,c,y,M.rect,t),I.push(m),J.push({type:"line",opacity:m.opacity,stroke:L.line.color,strokeWidth:L.line.width,shape:{x1:0,y1:0,x2:0,y2:0}})),E+=F,d=a.pieData.color)}),!this._data.dataPoint.auto||this._layoutMode>3))for(a=0;a<this._sortedIndices.length;a++){if(s=this._itemData[this._sortedIndices[a].idx],!s.pieData||s.pieData.value<=0)return;if(h=M._arcs[s.pieData.shpIndex],u=h.start,v=h.end,p=this._dataPointsLabelMode===o.SHARE?s.pieData.formattedShare.toString()+" %":s.pieData.label,z=e.measureText(p,x.dataLabel.font),B=(h.arcCenter+h.radianOffset)%(2*Math.PI),A=(B+Math.PI)%(2*Math.PI),!(this._dataPointsLabelMode!==o.NONE&&h.radius*(v===u?2*Math.PI:v>=u?v-u:u-v)>Math.abs(Math.cos(A))*z.height*2+Math.abs(Math.sin(A))*z.width*2))break;c=g.getLabelColor(L.dataValue.label.color.light,L.dataValue.label.color.dark,this._showAsDonut,s.pieData.color,N),n=g.createValueLabel(p,c,h,this._showAsDonut,x.dataLabel.font,y,z,t,m?m.shape.font:null),(t||n.shape.maxWidth<(this._showAsDonut?h.innerRadius:h.radius))&&K.push(n)}for(g.improveNameLabelPositions(I.concat(),J,M.rect),a=0;a<I.length;a++)j=I[a].shape,j.x+=j.cx,j.y+=j.cy,J[a].shape.x1+=j.cx,J[a].shape.y1+=j.cy,J[a].shape.x2+=j.cx,J[a].shape.y2+=j.cy,this._labelRects[a].x="right"===j.align?j.x-j.maxWidth:j.x,this._labelRects[a].y=j.y-j.laHeight/2,this._labelRects[a].width=j.maxWidth,this._labelRects[a].height=j.laHeight;this._renderer.shapes=G.concat(H).concat(J).concat(I).concat(K),this._renderer.render()}}var n,o,p=1,q="pieChart";return o={NONE:0,SHARE:1,VALUE:2},n=a.extend({init:function(){this._super.apply(this,arguments),this._data=null,this._arcs=[],this._itemData=[],this._labelRects=[],this._nameLabels=[],this._cacheItems=[],this._renderer=new e(this.container),this.renderers={pie:this._renderer},this._fontSize="large",this._styles={},this._styleService=f.getInstance(),this._transitionHelper.setTransitionCurve("easeout"),this._maxSizeRatio=.8,this._showValueTextInsideSlice=!1,this._showDimensionValues=!0,this._showAsDonut=!1,this._showLabels=!0,this._recalculcating=!1,this._currentProperties.rotation=0,this._transitionProperties.rotation=0,this._hasNegativeValues=!1,this._innerRadiusRatio=.7},beforeRenderPie:function(){},pieAddedToRender:function(){},dividerAddedToRender:function(){},afterPaint:function(){},setShowDimensionValues:function(a){this._showDimensionValues=a,this.invalidateDisplay("setShowDimensionValues")},getShowDimensionValues:function(){return this._showDimensionValues},setRotation:function(a){this._transitionProperties.rotation=a,this._transition()},getRotation:function(){return this._transitionProperties.rotation},setScaleRatio:function(a){this._maxSizeRatio=a,this.invalidateDisplay("setScaleRatio")},getScaleRatio:function(){return this._maxSizeRatio},setShowAsDonut:function(a){this._showAsDonut=a,this.invalidateDisplay("setShowAsDonut")},getShowAsDonut:function(){return this._showAsDonut},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setDataPointsLabelMode:function(a){switch(a){case"value":this._dataPointsLabelMode=o.VALUE;break;case"share":this._dataPointsLabelMode=o.SHARE;break;default:this._dataPointsLabelMode=o.NONE}this.invalidateDisplay("setDataPointsLabelMode")},getDataPointsLabelMode:function(){return this._dataPointsLabelMode},setDimensionTree:function(a){this._tree=a,this.invalidateProperties(),this.invalidateDisplay("setDimensionTree")},_updateSize:function(){this.invalidateDisplay("_updateSize")},_updateProperties:function(){if(this._data&&this._tree){this._nameLabels=[],this._itemData=[];var a,e,f,i,j,k,l,m,n=[],o=this._data.qHyperCube.qDimensionInfo.length,q=this._tree,r=this._nameLabels,s=o+1,t=0,u=this._arcs.length,v=q.children.length,w=this.measureFormatters[0],x=this,y=this.selectionIdentifier?this.selectionIdentifier:"dataArea";this._numSlices=0,v&&d.each.call(q,function(g,h){if(e=d.getLevel.call(g),g.idx=h,e===s){if(f=g.data.qNum,isNaN(f)||0>=f)return void((1>=o||0>=h)&&(a=g.parent.cacheItem,n.push(a)));x._numSlices++,l=g.parent.data.qText,m="U"!==w.type?g.children[0].data.qText:w.formatValue(g.data.qNum),g.pieData={value:f,title:l,color:null,label:m},(1>=o||0>=h)&&(g.pieData.shpIndex=t++,t>u?(j=new b(0,0,0,0,0,0,0),i=new c(0,0,0,0),x._arcs.push(j),x._labelRects.push(i)):(j=x._arcs[g.pieData.shpIndex],i=x._labelRects[g.pieData.shpIndex]),r.push({text:"",rect:i}),a=g.parent.cacheItem,a.addShape(y,j),a.addShape(y,i),n.push(a)),k=null!=x._colorMap?x._colorMap.getColor(g.parent.data.qElemNo,f,0,g.parent.idx):null,g.pieData.color=k,x._itemData.push(g)}}),this.setSelectableShapes(n),this._sortedIndices=this._itemData.map(function(a,b){return{value:a.pieData.value,idx:b}}),this._sortedIndices.sort(function(a,b){return a.value<b.value?1:-1});var z,A,B=0;this._numNonZero=0,this._itemData.forEach(function(a){B+=a.pieData.value,x._numNonZero+=a.pieData.value>0?1:0}),this._itemData.forEach(function(a){z=a.pieData.value/B,a.pieData.share=z,A=g.getFormattedPercentageValue(z,x._data.dataPoint.sharePrecision?x._data.dataPoint.sharePrecision:p),a.pieData.formattedShare=A,a.parent.cacheItem.addMeasure(h.get("properties.dataPoints.labelmode.share"),A+" %",A+" %")}),this._super()}},hasValidData:function(){return this._super()&&this._data&&this._tree},paint:function(){this._super(this._layoutMode,this._data),this._radius=this._maxSizeRatio*Math.min(this.rect.width,this.rect.height)/2,k.apply(this,[this._radius]),this._styles=j(this._styleService),this._innerRadius=this._innerRadiusRatio*this._radius,m.call(this),this.afterPaint()}})}),define("extensions.qliktech/piechart/piechart-properties",["general.utils/property-resolver"],function(a){function b(b){var c=a.getValue(b,"color.auto"),d=a.getValue(b,"color.expressionIsColor"),e=a.getValue(b,"color.mode");return!c&&"primary"===e||!c&&"byExpression"===e&&(d||void 0===d)}var c,d;c={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showAsDonut:{ref:"donut.showAsDonut",type:"boolean",component:"item-selection-list",defaultValue:!1,horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.pie",value:!1},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.donut",value:!0}]},labels:{type:"items",snapshot:{tid:"property-labels"},items:{dimensionTitle:{ref:"dimensionTitle",type:"boolean",component:"switch",translation:"properties.dataPoints.dimensionlabels",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},valuesAuto:{ref:"dataPoint.auto",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},labelMode:{ref:"dataPoint.labelMode",type:"string",component:"dropdown",options:[{value:"none",translation:"Common.None"},{value:"share",translation:"properties.dataPoints.labelmode.share"},{value:"value",translation:"properties.dataPoints.labelmode.value"}],defaultValue:"share",show:function(b){return!a.getValue(b,"dataPoint.auto")}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{colorMode:{defaultValue:"byDimension"}},legend:{items:{show:{show:function(a){return!b(a)},snapshot:{tid:"property-legend"}},showTitle:{show:function(c){return a.getValue(c,"legend.show")&&!b(c)}},dock:{show:function(c){return a.getValue(c,"legend.show")&&!b(c)}}}}}}}};var e={uses:"data",items:{dimensions:{uses:"dimensions"},measures:{uses:"measures",items:{numberFormatting:{items:{percentOfPieMessage:{component:"text",translation:"properties.numberFormatting.pieMessage",show:function(b,c){return c&&(a.getValue(c,"properties.dataPoint.auto")||"share"===a.getValue(c,"properties.dataPoint.labelMode"))}}}}}}}};return d={uses:"sorting"},{type:"items",component:"accordion",items:{data:e,sorting:d,settings:c}}}),define("extensions.qliktech/piechart/piechart-data",["general.utils/property-resolver"],function(a){function b(a){1===a.getDimensions().length&&1===a.getMeasures().length&&(a.getMeasures()[0].qSortBy.qSortByNumeric=-1,1!==a.getSorting()[0]&&a.changeSorting(1,0))}function c(b,c){var d=c.getMeasures(),e=a.getValue(b,"color.mode");"byExpression"===e&&0===d.length&&a.setValue(b,"color.mode","primary")}return{dimensions:{add:function(a,c,d){a.qOtherTotalSpec.qOtherMode="OTHER_COUNTED",a.qOtherTotalSpec.qOtherCounted={qv:"10"},b(d)},min:1,max:1},measures:{min:1,max:1,add:function(a,c,d){b(d)},remove:function(a,b,d){c(b,d)}}}}),define("text!extensions.qliktech/piechart/piechart.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNegativeOrZero" q-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" q-title-translation="Object.Disclaimer.OnlyNegativeOrZeroValues"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData"></span>\r\n<div qva-chart-disclaimer options="dataAttributes" visible="!dataAttributes.onlyNegativeOrZero"></div>'}),define("objects.views/charts/disclaimers/chart-utils",[],function(){function a(a,b,c){var d,e,f,g,h,i=b.length;for(a&&(e=!(a.autoMinMax||"min"!==a.minMax&&"minMax"!==a.minMax||null===a.min||isNaN(a.min)),f=!(a.autoMinMax||"max"!==a.minMax&&"minMax"!==a.minMax||null===a.max||isNaN(a.max))),g=Number.MAX_VALUE,h=-Number.MAX_VALUE,d=0;i>d;d++){if(g=e?a.min:Math.min(g,b[d].qMin),h=f?a.max:Math.max(h,b[d].qMax),0>=g&&h>=0)return!0;if((!c||"area"===c)&&(g>0||0>h))return!0}return!1}var b={applyDisclaimerAttributes:function(b,c,d,e,f,g){return c||(c={}),c.noDataExist=g.qHyperCube.qSize.qcy*g.qHyperCube.qSize.qcx===0,c.noDataExist?(d.toggleClass("qv-viz-with-disclaimer",!1),c):(b=b||{},b.overlay=b.overlay||!1,b.supportNegative=void 0===b.supportNegative?!0:b.supportNegative,b.supportRangeOverZero=void 0===b.supportRangeOverZero?!0:b.supportRangeOverZero,c.limitedData=g.qHyperCube.qDataPages[0]?!b.paging&&g.qHyperCube.qSize.qcy>g.qHyperCube.qDataPages[0].qMatrix.length:b.expliciLimitedData===!0,c.hasNegativeOrZeroData=!b.supportNegative&&g.qHyperCube.qMeasureInfo.some(function(a){return a.qMin<=0}),c.onlyNegativeOrZero=!b.supportNegative&&g.qHyperCube.qMeasureInfo.every(function(a){return a.qMax<=0&&a.qMax>=a.qMin})||0===g.qHyperCube.qSize.qcy,c.onlyNanData=g.qHyperCube.qMeasureInfo.every(function(a){return a.qMax<a.qMin||"NaN"===a.qMax}),c.hasDataRangeIncludingZero=!b.supportRangeOverZero&&a(g.measureAxis,g.qHyperCube.qMeasureInfo,g.lineType),c.onlyNegativeOrZero&&b.overlay||!(c.limitedData||c.hasNegativeOrZeroData&&!b.supportNegative||c.hasDataRangeIncludingZero)?(d.toggleClass("qv-viz-with-disclaimer",!1),e.options.showDisclaimerStar=!1):(d.toggleClass("qv-viz-with-disclaimer",b.bottom),e.options.showDisclaimerStar=!0),c)}};return b}),define("text!objects.views/charts/disclaimers/chart-disclaimer.ng.html",[],function(){return'<div class="qv-viz-disclaimer" ng-if="visible && (options.limitedData || options.hasNegativeOrZeroData || options.hasDataRangeIncludingZero) && !options.doesNotFit" ng-style="getDisclaimerStyle(options.chartScale)">\r\n	<span>*</span>\r\n	<span ng-if="options.limitedData" q-translation="Object.Disclaimer.LimitedData" q-title-translation="Object.Disclaimer.LimitedData"></span>\r\n	<span ng-if="options.hasNegativeOrZeroData" q-translation="Object.Disclaimer.NegativeOrZeroValues" q-title-translation="Object.Disclaimer.NegativeOrZeroValues"></span>\r\n	<span ng-if="options.hasDataRangeIncludingZero" q-translation="Object.Disclaimer.DataRangeIncludingZero" q-title-translation="Object.Disclaimer.DataRangeIncludingZero"></span>\r\n</div>\r\n'}),define("objects.views/charts/disclaimers/chart-disclaimer-directive",["qvangular","text!./chart-disclaimer.ng.html"],function(a,b){a.directive("qvaChartDisclaimer",function(){return{template:b,replace:!0,scope:{options:"=",visible:"="},link:function(a){a.getDisclaimerStyle=function(a){return a=Math.min(1,a||1),{"font-size":1*a+"em"}}}}})}),define("extensions.qliktech/piechart/piechart",["jquery","client.utils/state","objects.views/charts/chart","objects.views/charts/components/chart-component","./piearea","objects.views/charts/representation/combo-color-map","objects.backend-api/hypercube-api","extensions.qliktech/piechart/piechart-properties","extensions.qliktech/piechart/piechart-data","text!./piechart.ng.html","objects.utils/event-utils","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.views/charts/disclaimers/chart-disclaimer-directive"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){this.components.dataArea.setRotation(0)}function o(a,b,c){b.legend.show===!1||c?a.hideComponent():a.showComponent(),a.setShowTitle(b.legend.showTitle)}function p(a,b){a.setDock(b&&"auto"!==b.legend.dock?b.legend.dock:a.outerRect.height/a.outerRect.width>1?"right":"bottom")}function q(a){if(void 0!==a){this.components.dataArea.setRotation(a);var b=this.selections.types.tooltip;b&&b.clearSelection()}}var r,s=".piechart";return r=c.extend("PieChart",{init:function(b,c,g,h){var i=this,j=a.extend(!0,{},g);g=a.extend(!0,g||{},{debug:!0,providers:{colorMap:{clazz:f,colorBy:"dimension"}},components:{xAxisTitle:{show:!0,order:1,dock:"top",relevantSize:30,showFlag:d.prototype.ShowFlags.SMALL},dataArea:{sortKey:1e3,show:!0,dock:"center",clazz:e,showFlag:d.prototype.ShowFlags.SPARK},legend:{show:!1,dock:"right",relevantSize:126,label:"legend",showFlag:d.prototype.ShowFlags.MEDIUM}}},j),this._super(b,c,g,h),this.components.dimensionAxisTitle=this.components.xAxisTitle,this.components.dimensionAxisTitle.setType("dimension"),this.components.dimensionAxisTitle.listen("drill-up",function(a,b,c){i.backendApi.drillUp(b,c)}),delete this.components.xAxisTitle,this._showLegend=!1,this._lastRotation=0},initSelections:function(){this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.legend.setComponent("legend",this.components.legend),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.onSelection.Select.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this))},on:function(){var b=this;a(this.components.dataArea.container).on("mousewheel"+s+" DOMMouseScroll"+s,function(a){var c=k.getMouseWheelData(a.originalEvent);q.apply(b,[b.components.dataArea.getRotation()+5*c.delta])}),a(this.components.dataArea.container).on("mouseup"+s,function(a){2===a.which&&(a.preventDefault(),n.call(b))}),Touche(this.container).rotate({id:s,start:function(){b._lastRotation=0,b.components.dataArea.setUseTransition(!1),Touche.preventGestures(this.gestureHandler)},update:function(a,c){q.apply(b,[b.components.dataArea.getRotation()+c.rotation-b._lastRotation]),b._lastRotation=c.rotation,Touche.preventGestures(this.gestureHandler)},end:function(){b.components.dataArea.setUseTransition(!0),Touche.preventGestures(this.gestureHandler)}}),Touche(this.components.dataArea.container).tap({id:s,options:{touches:3},end:function(){n.call(b),Touche.preventGestures(this.gestureHandler)}}),this._super(),this._on=!0},off:function(){Touche(this.components.dataArea.container).off("*",s),Touche(this.container).off("*",s),a(this.components.dataArea.container).off(s),this._super(),this._on=!1},_postResize:function(){p.apply(this,[this.components.legend,this._data])},getSnapshotChartData:function(){return a.extend(!0,this._super()||{},{rotation:this.components.dataArea._currentProperties.rotation})},_paint:function(){var a;if(this._super()===!1)return!1;this.layout(),this.components.dataArea.setShowDimensionValues(this._layoutMode>d.prototype.ShowFlags.SPARK);for(a in this.components)this.components[a].invalidateDisplay("PieChart._paint")},prePaint:function(a){l.applyDisclaimerAttributes({title:!0,bottom:!0,overlay:!0,supportNegative:!1},this.$scope.dataAttributes,this.$element,this.$scope,b,a)
},_updateData:function(a){this._data=a;var c=this.getSnapshotStoredChartData();this._super(a),this.$scope.dataAttributes.onlyNegativeOrZero?(this.selections.off(),this._on&&this.off()):!this.$scope.dataAttributes.onlyNegativeOrZero&&this.isDataSelectable(a)&&(this.selections.on(),this._on||b.isInEditMode()||this.on()),this.providers.colorMap.setData(a),this.components.dataArea.setData(a),this.components.legend.setData(a),this.components.dimensionAxisTitle.setData(a),this.providers.colorMap.setDimensionTree(this._chartContext.getDimensionTree()),this.components.dataArea.setDimensionTree(this._chartContext.getDimensionTree()),a.dataPoint&&this.components.dataArea.setDataPointsLabelMode(a.dataPoint.auto?"share":a.dataPoint.labelMode),a.donut&&this.components.dataArea.setShowAsDonut(a.donut.showAsDonut),a.scale&&this.components.dataArea.setScaleRatio(a.scale),this.components.dataArea.setRotation(this._readStoredData&&c?c.rotation:a.rotation||0),a.dimensionTitle===!1||this.$scope.dataAttributes.onlyNegativeOrZero?this.components.dimensionAxisTitle.hideComponent():this.components.dimensionAxisTitle.showComponent(),o.apply(this,[this.components.legend,a,this.$scope.dataAttributes.onlyNegativeOrZero]),p.apply(this,[this.components.legend,this._data])},setShowLegend:function(a){this._showLegend=a,a?this.components.legend.showComponent():this.components.legend.hideComponent()},getShowLegend:function(){return this._showLegend},destroy:function(){this._super(),this.components.dimensionAxisTitle&&this.components.dimensionAxisTitle.stopListen("drill-up")}}),{type:"piechart",BackendApi:g,template:j,View:r,definition:h,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:10,qHeight:500}],qSuppressZero:!1,qSuppressMissing:!0}},data:i,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},legend:{}}},importProperties:m.colorChart.importProperties.bind(m),exportProperties:m.colorChart.exportProperties.bind(m)}}),define("extensions.qliktech/scatterplot/scatter-helper",["objects.utils/shapes/circle","objects.utils/shapes/rect","objects.utils/shapes/polygon"],function(a,b,c){function d(d,e){var f;switch(d){case"circle":f=new a(e[0],e[1],e[2],e[3]);break;case"rect":f=new b(e[0],e[1],e[2],e[3]);break;case"polygon":f=new c}return f}function e(a,b){return a?[]:b}function f(a){return a.dotData&&"NaN"!==a.dotData.xValue&&"NaN"!==a.dotData.yValue?!0:!1}function g(a){return a&&a.cacheItem&&a.cacheItem.selected?!0:!1}function h(a,b){return!b||!!a.selected||!!a.highlighted}function i(a,b,c,d){var e;return e=b?j(a,c.sizeDataMin,c.sizeDataMax,c._minDotSize,c._maxDotSize):c._minDotSize,e*d}function j(a,b,c,d,e){var f,g;return isNaN(a)||null===a?0/0:b===c?(d+e)/2:b>=a?d:a>=c?e:(f=(a-b)/(c-b),g=d+(e-d)*Math.sqrt(f))}function k(a,b,c,d,e){var f=isNaN(c)||void 0===c,g=f?0:c;return-g>a||a>d+g||-g>b||b>e+g}function l(a,b,c){return 0>a?-10+c:a>b?b-c+10:a}function m(a,b,c){var d;for(d=0;d<c.length;d++)if(a[c[d]]!==b[c[d]])return!1;return!0}function n(a,b,c,d,e){return 13!==a.length?null:(a[0].x=b-d+e/2,a[0].y=c-d-e/2,a[1].x=b-d-e/2,a[1].y=c-d+e/2,a[2].x=b-e,a[2].y=c,a[3].x=b-d-e/2,a[3].y=c+d-e/2,a[4].x=b-d+e/2,a[4].y=c+d+e/2,a[5].x=b,a[5].y=c+e,a[6].x=b+d-e/2,a[6].y=c+d+e/2,a[7].x=b+d+e/2,a[7].y=c+d-e/2,a[8].x=b+e,a[8].y=c,a[9].x=b+d+e/2,a[9].y=c-d+e/2,a[10].x=b+d-e/2,a[10].y=c-d-e/2,a[11].x=b,a[11].y=c-e,a[12].x=b-d+e/2,a[12].y=c-d-e/2,a)}function o(a,b){var c,d,e=!1;for(d=0;d<a.length;d++)if(c=a[d],"circle"===c.type){if(m(c,b,["cx","cy","r"])){e=!0;break}}else if(m(c,b,["cx","cy"])){e=!0;break}return e}function p(a,b){var c,d;return c=a.cacheItem.getShapes("dataArea")[0],d=b.cacheItem.getShapes("dataArea")[0],c.cy-c.r>d.cy-d.r?1:c.cy-c.r<d.cy-d.r?-1:c.cx-c.r>d.cx-d.r?1:c.cx-c.r<d.cx-d.r?-1:c.r>d.r?-1:c.r<d.r?1:a.cacheItem.id<b.cacheItem.id?-1:1}function q(a,b){return 0===b?a[1]?a[1]:null:a[b-1]}function r(a,b,c,d){var e,f,g={x:!1,y:!1};return isNaN(d.cx)||isNaN(d.cy)?(g.y=!0,g):(e=-(b.y-a.y),0>e?g:(e<2*a.height+d.r+c.r&&(g.y=!0,f=Math.abs(b.x-a.x),f<a.width/2+b.width/2&&(g.x=!0)),g))}function s(a,b){var c=a.x-a.width/2;return a.maxWidth=a.width,0>c&&(a.maxWidth+=2*c,a.x=a.maxWidth/2),c=a.x+a.width/2-b,c>0&&(a.maxWidth-=2*c),a}function t(a,b){return a.x=b.x-b.width/2,a.y=b.y-b.height,a.width=b.maxWidth,a.height=b.height,a}return{createShape:d,checkClearNodes:e,checkNodeValid:f,checkSelected:g,checkShouldRender:h,getRadius:i,getDotRadius:j,outOfBounds:k,outOfBoundsPosition:l,isSame:m,updateCross:n,checkOverlapping:o,sortObjectsForLabels:p,getComparableObject:q,checkLabelInterference:r,checkEllipsis:s,centerLabel:t}}),define("extensions.qliktech/scatterplot/scatter-circle",["objects.views/charts/shapes/container","objects.views/charts/shapes/display-object","objects.views/charts/renderers/canvas-renderer","objects.views/charts/renderers/canvas/circle","objects.views/charts/renderers/canvas/polygon","objects.views/charts/shapes/circle","objects.utils/shapes/circle"],function(a,b,c,d,e,f,g){function h(a,b,c){"saltire"===this.type?e.render.apply(this,[a,b,c]):d.render.apply(this,[a,b,c])}function i(a){var b,c=[];for(b=0;a>b;b++)c.push(j());return c}function j(){return{x:0,y:0}}function k(a,b,c,d,e){return 13!==a.length?null:(a[0].x=b-d+e/2,a[0].y=c-d-e/2,a[1].x=b-d-e/2,a[1].y=c-d+e/2,a[2].x=b-e,a[2].y=c,a[3].x=b-d-e/2,a[3].y=c+d-e/2,a[4].x=b-d+e/2,a[4].y=c+d+e/2,a[5].x=b,a[5].y=c+e,a[6].x=b+d-e/2,a[6].y=c+d+e/2,a[7].x=b+d+e/2,a[7].y=c+d-e/2,a[8].x=b+e,a[8].y=c,a[9].x=b+d+e/2,a[9].y=c-d+e/2,a[10].x=b+d-e/2,a[10].y=c-d-e/2,a[11].x=b,a[11].y=c-e,a[12].x=b-d+e/2,a[12].y=c-d-e/2,a)}var l=a.extend("ScatterCircle",{init:function(a,b,c,d,e){this._super(),this.type="circle",this.saltireSize=d,this.saltireWidth=e,g.apply(this,[a,b,c])},pointInside:b.prototype.pointInside,containsPoint:g.prototype.containsPoint,intersectsLocalLine:g.prototype.intersectsLocalLine,getLocalPoints:g.prototype.getLocalPoints,getLocalBoundingRect:f.prototype.getLocalBoundingRect,set:function(a,b,c,d,e){this.saltireSize=this.saltireSize||d,this.saltireWidth=this.saltireWidth||e,this._saltire=k(this._saltire||i(13),a,b,this.saltireSize,this.saltireWidth),this._polygons=[{points:this._saltire}],f.prototype.set.apply(this,[a,b,c])}});return Object.keys(f.prototype).forEach(function(a){!l.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints"].indexOf(a)<0&&(l.prototype[a]=f.prototype[a])}),c._registerRenderFn(h,l),l}),define("extensions.qliktech/scatterplot/scatterarea",["objects.views/charts/components/chart-component","extensions.qliktech/scatterplot/scatter-helper","objects.views/charts/renderers/canvas-renderer","./scatter-circle","objects.views/charts/shapes/text","objects.views/charts/shapes/rect","objects.views/charts/shapes/line","objects.views/charts/utils/tree-iterator","objects.views/charts/chart-style-service","general.utils/color"],function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c,d){return a.set(b,c,d),a}function l(a){var b="scatterPlot",c={backgroundColor:a.getValue(b,null,"backgroundColor"),dataPoint:{label:{color:a.getValue(b,"value","color"),font:a.getFont(b,"value"),background:a.getValue(b,"value","background")}},shape:{border:{width:a.getValue(b,"shape.border","width")},selected:{border:{color:a.getValue(b,"shape.border","color"),width:a.getValue(b,"shape.border","width","selected")}},outOfBounds:{opacity:a.getValue(b,"shape.outOfBounds","opacity")}},line:{color:a.getValue(b,"line","color"),width:a.getValue(b,"line","width")}};return c}function m(a){var c,e,f,g,h,i,j,l,m,n,o,p,q,r,s=this._tree,t=this._tree.children.length,u=b.createShape("circle",[0,0,0,0]),v=this.rect.width,w=this.rect.height,x=this._dots,y=this,z=[],A=[],B=3,C=1,D=3,E=this._canvasShapes,F=this._data.qHyperCube.qMeasureInfo.length>2&&!this._data.qHyperCube.qDataPages[0].qIsReduced,G=Math.min(this.rect.height,this.rect.width)/300,H=this.selectionIdentifier?this.selectionIdentifier:"dataArea",I=this._styles;return t?(this._renderedNodes=b.checkClearNodes(!a,this._renderedNodes),s.children.forEach(function(s){if(b.checkNodeValid(s)&&(j=!1,g=b.checkSelected(s),s.selected=g,s.highlighted=s.cacheItem.highlighted,n=g?I.shape.selected.border.width:I.shape.border.width,"dimension"===s.data.type)){if(!b.checkShouldRender(s,a)||!y._currentProperties.values)return;if(o=y._currentProperties.values[s.data.qElemNo],!o)return;if(c=y._xAxis.getPositionOfValue(o.xValue),e=y._yAxis.getPositionOfValue(o.yValue),f=b.getRadius(o.rValue,F,y._currentProperties,G),isNaN(c)||isNaN(e))return;f=.5>f?.5:f,D=D>f?f:D,l=isNaN(f)||void 0===f,s.dotData.outOfBounds=j=b.outOfBounds(c,e,f,v,w),j&&(f=D,c=b.outOfBoundsPosition(c,v,f),e=b.outOfBoundsPosition(e,w,f)),m=l&&!j,u=k(x[s.dotData.dotIndex],c,e,m?2*B:f),i=s.cacheItem,i.clearShapes(H),i.addShape(H,u,!0),h=i.highlighted,s.dotData.color=y._colorMap.getColor(s.data.qElemNo,s._children[0].data.qNum,0,s.data.rowIndex),q=s.dotData.color.isDark()?"light":"dark",r=!1,s.selected||(r=b.checkOverlapping(j?A:z,u,c,e,C)),r||(p=E[s.idx],p?p.fill=s.dotData.color.toRGBA():(p=new d(0,0,0,B,C),p.fill=s.dotData.color.toRGBA(),p.strokeWidth=n,p.stroke=h?I.shape.highlighted.border[q].color:y._sheetBackgroundColor.toRGBA(),p.data.label=s.data.qText.substr(0,128),E[s.idx]=p),j?(p.set(u.cx,u.cy,u.r),p.type="circle",A.push(p)):(p.set(u.cx,u.cy,u.r),p.type=l?"saltire":"circle",a||(z.push(p),y._renderedNodes.push(s))))}}),void(a||(this.renderers.dots.stage.removeChildren(),this.renderers.oob.stage.removeChildren(),this.renderers.dots.stage.addChildren(z),this.renderers.oob.stage.addChildren(A),this.renderers.dots.render(),this.renderers.oob.render()))):void this.clear()}function n(){var a,c,d,h,i,j,k,l,m,n,o,q,r,s=this._renderedNodes.length,t=this,u=[],v=this._labelShapes,w=this.renderers.labels,x=this._styles,y=this.selectionIdentifier?this.selectionIdentifier:"dataArea";s&&(j=this._renderedNodes.sort(b.sortObjectsForLabels),j.forEach(function(s,w){if(v[s.data.rowIndex]&&(v[s.data.rowIndex].visible=!1),h=s.cacheItem,c=s.dotData.label,a=h.getShapes(y)[0],i=h.toggleShapes[0],n=w-1,k=b.getComparableObject(j,w),c.x=a.cx,c.y=a.cy-a.r-5,!c||s.dotData.outOfBounds)return void i.set(0,0,0,0);if(t._labelMode===p.AUTO&&k){if(l=k.cacheItem.getShapes(y)[0],d=k.dotData.label,m=b.checkLabelInterference(c,d,a,l),m.x&&m.y)return void(i.width=0);for(;m.y&&n>0;)if(n--,k=0!==w?j[n]:null,l=k.cacheItem.getShapes(y)[0],d=k.dotData.label,m=b.checkLabelInterference(c,d,a,l),m.x&&m.y)return void(i.width=0)}return c.y-c.height<0||c.y>t.rect.height?void i.set(0,0,0,0):(c=b.checkEllipsis(c,t.rect.width),i=b.centerLabel(i,c),v[s.data.rowIndex]?(q=v[s.data.rowIndex].rect,o=v[s.data.rowIndex].text,r=v[s.data.rowIndex].line,v[s.data.rowIndex].visible=!0):(q=new f,o=new e,r=new g,v[s.data.rowIndex]={visible:!0,rect:q,text:o,line:r},q.fill=x.dataPoint.label.background,o.fill=x.dataPoint.label.color,o.align="center",o.font=x.dataPoint.label.font,o.baseline="bottom",r.stroke=x.line.color),q.x=i.x-2,q.y=i.y,q.width=i.width+4,q.height=i.height,o.setText(c.text),o.x=c.x,o.y=c.y,o.maxWidth=c.maxWidth,r.set(c.x,c.y-2,c.x,c.y+3),u.push(q),u.push(o),void u.push(r))})),w.stage.removeChildren(),w.stage.addChildren(u),w.render()}var o,p;return p={NONE:0,AUTO:1,ALL:2},o=a.extend({init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._dots=[],this._labelRects=[],this._cacheItems=[],this._renderedNodes=[],this._showDataPoints=!0,this._colorMap=null,this._navigationVisible=!1,this._globalAlpha=1,this._canvasShapes={},this._labelMode=p.AUTO,this._savedCacheItems={},this._transitionProperties._minDotSize=2,this._transitionProperties._maxDotSize=10,this._style={dataPoints:{color:"#666",font:"12px 'QlikView Sans'"}},this._styles={},this._styleService=i.getInstance(),this._styles=l(this._styleService),this._sheetBackgroundColor=new j(this._styles.backgroundColor),this._sheetBackgroundColor.setAlpha(.3),this.renderers={dots:new c(this.container,{name:"dots"}),labels:new c(this.container,{name:"labels"}),oob:new c(this.container,{name:"oob"})},this.perpendicularlyRelevantSpacing={top:10,left:10,right:10,bottom:10},this._transitionHelper.setTransitionTime(500,0)},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setXAxis:function(a){this._xAxis=a,this._xAxis.listen("changed",function(){this.invalidateDisplay()},this)},setYAxis:function(a){this._yAxis=a,this._yAxis.listen("changed",function(){this.invalidateDisplay()},this)},setDimensionTree:function(a){this._tree=a,this.invalidateProperties(),this.invalidateDisplay()},setMinDotSize:function(a){this._transitionProperties._minDotSize=a,this.invalidateDisplay()},setMaxDotSize:function(a){this._transitionProperties._maxDotSize=a,this.invalidateDisplay()},setLabelMode:function(a){this._labelMode=a,this.invalidateDisplay()},setNavigation:function(a){this._navigationVisible=a,this.invalidateDisplay()},preRelevantSizeCalculation:function(){this.perpendicularlyRelevantSpacing={top:10,left:10,right:10,bottom:10}},_updateSize:function(){this.invalidateDisplay()},_updateProperties:function(){if(this._data&&this._tree){this._canvasShapes={},this._labelShapes={};var a,c,d,e,f,g,i,j=[],k=this._data.qHyperCube.qDimensionInfo.length,l=this._data.qHyperCube.qMeasureInfo.length,m=this._tree,n=this,o=this._dots,p=this._labelRects,q=m.children.length,r=0,s=this._dots.length,t=k+1,u=this.renderers.dots,v=this._style.dataPoints,w=this.selectionIdentifier?this.selectionIdentifier:"dataArea";this._onlySelected=!1,n._transitionProperties.values={},n._transitionProperties.nodes={},l>2&&(n._transitionProperties.sizeDataMin=this._data.qHyperCube.qMeasureInfo[2].qMin,n._transitionProperties.sizeDataMax=this._data.qHyperCube.qMeasureInfo[2].qMax),q&&h.each.call(m,function(l,m){if(i=h.getLevel.call(l),l.idx=m,i===t-1){if(k>1&&m>0)return;e=l.children[0].data.qNum,f=l.children[1].data.qNum,g=l.children.length>2?l.children[2].data.qNum:.5,l.dotData={color:null,label:null},1>=k&&(l.dotData.dotIndex=r++,r>s?(a=b.createShape("circle",[0,0,0,0]),c=b.createShape("rect",[0,0,0,0]),o.push(a),p.push(c)):(a=n._dots[l.dotData.dotIndex],c=n._labelRects[l.dotData.dotIndex]),d=l.cacheItem,d.addShape(w,a,!0),d.toggleShapes=[c],j.push(d),n._transitionProperties.values[l.data.qElemNo]={xValue:e,yValue:f,rValue:g}),l.dotData.label={x:0,y:0,width:0,height:0,text:l.data.qText},l.dotData.label.width=u.getTextWidth(l.dotData.label.text,v.font),l.dotData.label.height=u.getFontHeight(v.font)}}),this._dots.length>r&&(this._dots=this._dots.slice(0,r),this._labelRects=this._labelRects.slice(0,r)),this.setSelectableShapes(j),this._super()}},hasValidData:function(){return this._super()&&this._data&&this._tree&&this._xAxis&&this._yAxis},paint:function(){this._super(this._layoutMode,this._data),this._xAxis&&this._yAxis&&this._data&&(this._xAxis.updateNow(),this._yAxis.updateNow(),this.renderers.oob.edgeBleed={left:10,right:10,bottom:10,top:10},this._styles=l(this._styleService),this._renderData&&this._tree.children.length>0?(this.renderers.dots.stage.opacity=this._globalAlpha||1,this.renderers.labels.stage.opacity=this._globalAlpha||1,m.apply(this,[this._onlySelected]),this._onlySelected=!1,this._labelMode>p.NONE&&this._layoutMode>this.ShowFlags.XSMALL?n.apply(this,[]):(this.renderers.labels.stage.removeChildren(),this.renderers.labels.clear())):this.clear())},clear:function(){this._transitionHelper.clear(),this._super()},toggleCacheItem:function(a){var b=!0,c=this._styles,d=.9,e=this;this.renderers.dots.stage.opacity!==this._globalAlpha&&(b=!1,this.renderers.dots.stage.opacity=this._globalAlpha,this.renderers.labels.stage.opacity=this._globalAlpha);var f=this._canvasShapes[a.row],g=this._labelShapes[a.row];f&&(a.selected?(f.strokeWidth=c.shape.selected.border.width,f.stroke=c.shape.selected.border.color,f.opacity=d,f.zIndex=1,g&&g.visible&&(g.text.opacity=1,g.line.opacity=1,g.zIndex=1)):(f.opacity=void 0,f.stroke=e._sheetBackgroundColor.toRGBA(),f.strokeWidth=c.shape.border.width,f.zIndex=void 0,g&&g.visible&&(g.text.opacity=void 0,g.line.opacity=void 0,g.zIndex=void 0)),b&&(f.invalidate(),g&&g.visible&&g.text.invalidate())),b||(this.renderers.dots.render(),this.renderers.labels.render(),this.renderers.oob.render())},setRenderData:function(a){this._renderData=a}})}),define("extensions.qliktech/scatterplot/scatterplot-properties",["general.utils/property-resolver","translator"],function(a,b){function c(b){return"primary"!==a.getValue(b,"color.mode")&&!a.getValue(b,"color.auto")}var d,e;d={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},bubbleSizes:{type:"integer",component:"slider",ref:"dataPoint.bubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,defaultValue:5,show:function(a){return a.qHyperCubeDef.qMeasures.length<3}},rangeBubbleSizes:{type:"array",component:"slider",ref:"dataPoint.rangeBubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,defaultValue:[2,8],show:function(a){return a.qHyperCubeDef.qMeasures.length>=3}},labelMode:{ref:"labels.mode",translation:"properties.labels",type:"string",component:"dropdown",defaultValue:1,options:[{value:1,translation:"Common.Auto"},{value:2,translation:"Common.All"},{value:0,translation:"Common.None"}],snapshot:{tid:"property-labels"}},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridLine.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(a){return!a.gridLine.auto}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{colorMode:{defaultValue:"primary",options:function(a,b){var c=[{value:"primary",translation:"properties.colorMode.primary"},{value:"byDimension",translation:"properties.colorMode.byDimension"}];return b.getMeasures().length>=1&&c.push({value:"byExpression",translation:"properties.colorMode.byExpression"}),c}}}},legend:{show:function(a){return c(a)},items:{show:{snapshot:{tid:"property-legend"}},showTitle:{show:function(b){return a.getValue(b,"legend.show")}},dock:{show:function(b){return a.getValue(b,"legend.show")}}}}}},xAxis:{type:"items",uses:"measureAxis",label:function(a,c){var d,e=c.getMeasureLayouts()[0];return d=e&&!e.qError?b.get("properties.xAxisWithInfo",[e.qFallbackTitle]):b.get("properties.xAxis")},items:{axis:{items:{show:{ref:"xAxis.show",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},dock:{ref:"xAxis.dock",show:function(a){return"none"!==a.xAxis.show},options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}]},spacing:{ref:"xAxis.spacing",show:function(a){return"none"!==a.xAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"xAxis.autoMinMax"},minMax:{ref:"xAxis.minMax",show:function(a){return!a.xAxis.autoMinMax}},min:{ref:"xAxis.min",show:function(a){return["min","minMax"].contains(a.xAxis.minMax)&&!a.xAxis.autoMinMax},invalid:function(a){return"minMax"===a.xAxis.minMax?a.xAxis.min>=a.xAxis.max:!1}},max:{ref:"xAxis.max",show:function(a){return["max","minMax"].contains(a.xAxis.minMax)&&!a.xAxis.autoMinMax},invalid:function(a){return"minMax"===a.xAxis.minMax?a.xAxis.min>=a.xAxis.max:!1}}}}}},yAxis:{type:"items",uses:"measureAxis",label:function(a,c){var d,e=c.getMeasureLayouts()[1];return d=e&&!e.qError?b.get("properties.yAxisWithInfo",[e.qFallbackTitle]):b.get("properties.yAxis")},items:{axis:{items:{show:{ref:"yAxis.show",snapshot:{title:"properties.yAxis",tid:"property-yAxis"}},dock:{ref:"yAxis.dock",show:function(a){return"none"!==a.yAxis.show}},spacing:{ref:"yAxis.spacing",show:function(a){return"none"!==a.yAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"yAxis.autoMinMax"},minMax:{ref:"yAxis.minMax",show:function(a){return!a.yAxis.autoMinMax}},min:{ref:"yAxis.min",show:function(a){return["min","minMax"].contains(a.yAxis.minMax)&&!a.yAxis.autoMinMax},invalid:function(a){return"minMax"===a.yAxis.minMax?a.yAxis.min>=a.yAxis.max:!1}},max:{ref:"yAxis.max",show:function(a){return["max","minMax"].contains(a.yAxis.minMax)&&!a.yAxis.autoMinMax},invalid:function(a){return"minMax"===a.yAxis.minMax?a.yAxis.min>=a.yAxis.max:!1}}}}}}}};var f={uses:"data"};return e={type:"items",component:"expandable-items",translation:"properties.addons",items:{refLinesX:{uses:"reflines",ref:"refLine.refLinesX",translation:"properties.referenceLinesX"},refLinesY:{uses:"reflines",ref:"refLine.refLinesY",translation:"properties.referenceLinesY"}}},{type:"items",component:"accordion",items:{data:f,addons:e,settings:d}}}),define("extensions.qliktech/scatterplot/scatterplot-data",["general.utils/property-resolver"],function(a){function b(a){var b=a.getMeasures();2===b.length?a.setSorting([2,1,0]):3===b.length&&a.setSorting([3,2,1,0])}function c(b,c){var d=c.getMeasures(),e=a.getValue(b,"color.mode");"byExpression"===e&&0===d.length&&a.setValue(b,"color.mode","primary")}var d={dimensions:{min:1,max:1},measures:{min:2,max:3,add:function(a,c,d){b(d),a.qSortBy.qSortByNumeric=-1},remove:function(a,d,e){b(e),c(d,e)}}};return d}),define("text!extensions.qliktech/scatterplot/scatterplot.ng.html",[],function(){return'<div style="height: 100%; position: relative;">\r\n	<div qv-extension\r\n		class="qv-viz"\r\n		style="position: relative;">\r\n	</div>\r\n	<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.reduceDataDisc  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.ReduceDataBySelections" q-title-translation="Object.Disclaimer.ReduceDataBySelections"></span>\r\n	<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist"></span>\r\n	<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData"></span>\r\n    <div qva-scatter-navigation>\r\n	<!--on-navigation="onNavigation" \r\n    navigation-disabled="navigationDisabled" \r\n    navigation-home-only="navigationHomeOnly" \r\n    navigation-visible="navigationVisible"\r\n    navigation-style="navigationPosition"-->\r\n	</div>\r\n</div>'}),define("text!extensions.qliktech/scatterplot/scatterplot-navigation.ng.html",[],function(){return'<div class="qv-scatter-nav" ng-style="navigationStyle">\r\n	<div ng-show="navigationHomeOnly && navigationVisible" class="qv-scatter-nav-homeonly">\r\n		<button class="qv-scatter-nav-home qui-plainbuttonicon" data-icon="" qva-activate="onHomePressed()" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ResetZoom" />\r\n	</div>\r\n	<div ng-show="!navigationHomeOnly && navigationVisible" class="qv-scatter-nav-fullnav">\r\n		<div class="qv-scatter-nav-top">\r\n			<button class="qv-scatter-nav-up qui-plainbuttonicon" data-icon="R" qva-activate="onNavigationPressed(\'navUp\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanUp" />\r\n		</div>\r\n		<div class="qv-scatter-nav-middle">\r\n			<button class="qv-scatter-nav-left qui-plainbuttonicon" data-icon="T" qva-activate="onNavigationPressed(\'navLeft\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanLeft" />\r\n			<button class="qv-scatter-nav-home qui-plainbuttonicon" data-icon="" qva-activate="onHomePressed()" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ResetZoom" />\r\n			<button class="qv-scatter-nav-right qui-plainbuttonicon" data-icon="U" qva-activate="onNavigationPressed(\'navRight\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanRight" />\r\n		</div>\r\n		<div class="qv-scatter-nav-bottom">\r\n			<button class="qv-scatter-nav-down qui-plainbuttonicon" data-icon="S" qva-activate="onNavigationPressed(\'navDown\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanDown" />\r\n			<button class="qv-scatter-nav-in qui-plainbuttonicon" data-icon="Y" qva-activate="onNavigationPressed(\'zoomIn\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ZoomIn" />\r\n			<button class="qv-scatter-nav-out qui-plainbuttonicon" data-icon="Z" qva-activate="onNavigationPressed(\'zoomOut\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ZoomOut" />\r\n		</div>\r\n	</div>\r\n</div>'}),define("extensions.qliktech/scatterplot/scatterplot-navigation",["assets/qvangular/qvangular-core","text!extensions.qliktech/scatterplot/scatterplot-navigation.ng.html"],function(a,b){a.directive("qvaScatterNavigation",function(){return{template:b,replace:!0,link:function(a,b){a.innerElement=b.find(".qv-scatter-nav"),a.onHomePressed=function(){a.$broadcast("navigationPressed","resetZoom")},a.onNavigationPressed=function(b){a.$broadcast("navigationPressed",b)}}}})}),define("extensions.qliktech/scatterplot/scatterplot",["jquery","client.utils/state","objects.views/charts/axis-chart","objects.views/charts/components/chart-component","objects.views/charts/utils/binding","./scatterarea","objects.views/charts/representation/combo-color-map","objects.backend-api/hypercube-api","extensions.qliktech/scatterplot/scatterplot-properties","extensions.qliktech/scatterplot/scatterplot-data","text!./scatterplot.ng.html","objects.utils/event-utils","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.views/charts/utils/matrix","extensions.qliktech/scatterplot/scatterplot-navigation","touche"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a){var b=a.getActiveType(),c=a.types.tooltip;b&&"item"!==b.getActiveMode()&&b.clearSelection(),c&&c.clearSelection()}function q(){var a=(this._layoutMode<31||!this._data.navigation)&&!this.backendApi.isSnapshot&&this._layoutMode>3,b=!(this._defaultZoomPan&&!this._data.navigation||this.backendApi.isSnapshot||!(this._layoutMode>3||a&&this._layoutMode>=3)),c=this;this.$scope.navigationHomeOnly=a,this.$scope.navigationVisible=b,this.$scope.navigationStyle={top:this.components.dataArea.rect.y+5+"px",right:this.rect.width-this.components.dataArea.rect.x-this.components.dataArea.rect.width+5+"px"},setTimeout(function(){c.$scope.$apply()})}function r(){var a=this.components.dataArea,b=a._xAxis,c=a._yAxis;p(this.selections),b.setUseTransition(this._allowTransitions),c.setUseTransition(this._allowTransitions),b.setPlotMin(!this._data.xAxis.autoMinMax&&["min","minMax"].contains(this._data.xAxis.minMax)?Number(this._data.xAxis.min):null),b.setPlotMax(!this._data.xAxis.autoMinMax&&["max","minMax"].contains(this._data.xAxis.minMax)?Number(this._data.xAxis.max):null),c.setPlotMin(!this._data.yAxis.autoMinMax&&["min","minMax"].contains(this._data.yAxis.minMax)?Number(this._data.yAxis.min):null),c.setPlotMax(!this._data.yAxis.autoMinMax&&["max","minMax"].contains(this._data.yAxis.minMax)?Number(this._data.yAxis.max):null),w.x.min=this.components.xAxis.getPlotMin(),w.x.max=this.components.xAxis.getPlotMax(),w.y.min=this.components.yAxis.getPlotMin(),w.y.max=this.components.yAxis.getPlotMax(),this._defaultZoomPan=!0,this._zoomScale=1,this._paint()}function s(a,b,c){var d,e,f,g=this._transformMatrix.identity(),h=this.components.dataArea.rect,i=this.components.xAxis,j=this.components.yAxis,k={x:w.x.min,y:w.y.min},l={x:w.x.max,y:w.y.max},m=l.x-k.x,n=l.y-k.y,o={x:a/h.width*m+k.x,y:l.y-b/h.height*n};e=(this._panX-a)/h.width*m,f=(this._panY-b)/h.height*n,g.translate(e,-f),c&&(g.translate(o.x,o.y),g.scale(1/c,1/c),g.translate(-o.x,-o.y)),this._defaultZoomPan=!1,k=g.transformPoint(k),l=g.transformPoint(l),k.x>this._xZoomMin&&l.x<this._xZoomMax&&l.x-k.x>1e-5*(i.getDataMax()-i.getDataMin())&&(i.setPlotMin(k.x),i.setPlotMax(l.x)),k.y>this._yZoomMin&&l.y<this._yZoomMax&&l.y-k.y>1e-5*(j.getDataMax()-j.getDataMin())&&(j.setPlotMin(k.y),j.setPlotMax(l.y));for(d in this.components)this.components[d].invalidateDisplay();this._debouncedUpdateLayout(),q.call(this)}function t(a,b){this._panX=a,this._panY=b,w.x.min=this.components.xAxis.getPlotMin(),w.x.max=this.components.xAxis.getPlotMax(),w.y.min=this.components.yAxis.getPlotMin(),w.y.max=this.components.yAxis.getPlotMax(),this.components.xAxis.setUseTransition(!1),this.components.yAxis.setUseTransition(!1),p(this.selections)}var u,v=".scatterplot",w={x:{min:null,max:null},y:{min:null,max:null}},x=1e3;return u=c.extend("ScatterPlot",{init:function(c,h,i,j){var k,m=this;i=a.extend(!0,i||{},{providers:{colorMap:{clazz:g,colorBy:"dimension",autoMode:"primary"}},components:{refLines:{sortKey:5,show:!0,dock:"center",showFlag:d.prototype.ShowFlags.SPARK},dataArea:{sortKey:10,show:!0,dock:"center",clazz:f,showFlag:d.prototype.ShowFlags.SPARK},grid:{showFlag:d.prototype.ShowFlags.XSMALL},xAxis:{showFlag:d.prototype.ShowFlags.SMALL},yAxis:{showFlag:d.prototype.ShowFlags.SMALL},xAxisTitle:{show:!1},refLineLabelsX:{show:!0,dock:"top",order:3,showFlag:d.prototype.ShowFlags.XSMALL},refLineLabelsY:{show:!0,dock:"right",order:3,showFlag:d.prototype.ShowFlags.XSMALL}}}),this._super(c,h,i,j),this.components.xAxisTitle.hideComponent(),this._showLegend=!1,this.components.dataArea.setYAxis(this.components.yAxis),this.components.dataArea.setXAxis(this.components.xAxis),this.components.yAxis.setShowExplicitMinMax(!1),this.components.xAxis.setShowExplicitMinMax(!1),this._allowTransitions=b.view!==b.Views.story,this.components.yAxis.setUseTransition(this._allowTransitions),this.components.xAxis.setUseTransition(this._allowTransitions),this.components.grid.setAxes(this.components.xAxis,this.components.yAxis),this._transformMatrix=new o;var n=this.providers.colorMap.getLegendDataProvider();n.setLegendMarker("circle"),this.components.xAxis.getTransitionHelper().setTransitionTime(700),this.components.yAxis.getTransitionHelper().setTransitionTime(700),this.components.dataArea.getTransitionHelper().setTransitionTime(700),this._changeWatchers.push(e.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(e.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this._axesAnimating=0,this._spring={active:!1,xMin:null,xMax:null,yMin:null,yMax:null},this._debouncedUpdateLayout=l.debounce(function(){m._paint(),m.components.xAxis.setUseTransition(!0),m.components.yAxis.setUseTransition(!0)},200),k=function(a,c,d){b.isInEditMode()||(t.apply(m,[m.components.dataArea.rect.width/2,m.components.dataArea.rect.height/2]),s.apply(m,[a,c,d]))},this._zoomScale=1,this.onNavigationPressed=c.$on("navigationPressed",function(a,b){switch(a.preventDefault(),b){case"resetZoom":r.call(m);break;case"zoomIn":k(m.components.dataArea.rect.width/2,m.components.dataArea.rect.height/2,m._zoomScale+.2);break;case"zoomOut":k(m.components.dataArea.rect.width/2,m.components.dataArea.rect.height/2,m._zoomScale-.2);break;case"navUp":k(m.components.dataArea.rect.width/2,m.components.dataArea.rect.height/2+30,0);break;case"navDown":k(m.components.dataArea.rect.width/2,m.components.dataArea.rect.height/2-30,0);break;case"navLeft":k(m.components.dataArea.rect.width/2+30,m.components.dataArea.rect.height/2,0);break;case"navRight":k(m.components.dataArea.rect.width/2-30,m.components.dataArea.rect.height/2,0)}}),this.$scope.navigationDisabled=!0},initSelections:function(){this.selections.types.legend.setComponent("legend",this.components.legend),this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.range.setComponent("dataArea",this.components.dataArea),this.selections.types.range.setComponent("x",this.components.xAxis),this.selections.types.range.setComponent("y",this.components.yAxis),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Pan.bind(this.onPan.bind(this)),this.selections.Select.bind(this.onSelection.Select.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this))
},_paint:function(b){var c;if(this._super()===!1)return!1;this.components.dataArea&&(this._offset=a(this.components.dataArea.container).offset()),void 0===b&&(b=!0),b&&(this._updateLayoutMode(this.rect.width,this.rect.height),this.layout());for(c in this.components)this.components[c].invalidateDisplay();q.call(this)},onPan:function(a,b,c){var d=this;switch(a){case"update":d._panning||(d._panning=!0,t.apply(d,[c.swipe.startPoint.x,c.swipe.startPoint.y])),d._panning&&s.apply(d,[c.swipe.currentPoint.x,c.swipe.currentPoint.y]);break;case"end":d._panning=!1}},on:function(){if(!this._on){if(this.supressDotRendering)return void this.selections.off();var b=this;a(this.components.dataArea.container).on("mousewheel"+v+" DOMMouseScroll"+v,l.throttle(function(a){var c=l.getMouseWheelData(a.originalEvent);t.apply(b,[c.x-b._offset.left,c.y-b._offset.top]),s.apply(b,[c.x-b._offset.left,c.y-b._offset.top,c.delta>0?1.2:.8])},20)),Touche(this.components.dataArea.container).wheelswipe({id:v,start:function(a){b._panX=a.pageX,b._panY=a.pageY},update:function(a){!b._panning&&(Math.abs(a.pageX-b._panX)>3||Math.abs(a.pageX-b._panX)>3)&&(b._panning=!0,t.apply(b,[b._panX,b._panY])),b._panning&&s.apply(b,[a.pageX,a.pageY])},end:function(){b._panning||r.call(b),b._panning=!1}}),Touche(this.components.dataArea.container).pinch({id:v,options:{useMomentum:!0,inertia:.7},update:function(a,c){var d,e;b._panning||(b._panning=!0,t.apply(b,[c.centerPoint.x-b._offset.left,c.centerPoint.y-b._offset.top])),d=c.centerPoint.x-b._offset.left,e=c.centerPoint.y-b._offset.top,s.apply(b,[d,e,c.scale]),Touche.preventGestures(this.gestureHandler)},end:function(){b._panning=!1}}),Touche(this.components.dataArea.container).swipe({id:v,options:{useMomentum:!0,touches:2,inertia:.7},start:function(a,c){b.onPan("start",a,c),Touche.preventGestures(this.gestureHandler)},update:function(a,c){b.onPan("update",a,c)},end:function(a,c){b.onPan("end",a,c)}}),Touche(this.components.dataArea.container).tap({id:v,options:{touches:3},end:function(){r.call(b),Touche.preventGestures(this.gestureHandler)}}),Touche(this.container).longtap({id:v}),this._super(),this.$scope.navigationDisabled=!1,this._on=!0}},off:function(){this.$scope.navigationDisabled=!0,this._on&&(Touche(this.components.dataArea.container).off("*",v),Touche(this.container).off("*",v),a(this.components.dataArea.container).off(v),a(this.container).off(v),this._super(),this._on=!1)},isValid:function(a){return this._super(a)&&a.qHyperCube.qMeasureInfo.length>=2&&!this.supressChartRendering},prePaint:function(a){m.applyDisclaimerAttributes({title:!1,bottom:!1,overlay:!0},this.$scope.dataAttributes,this.$element,this.$scope,b,a),this.$scope.dataAttributes.onlyNanData=a.qHyperCube.qMeasureInfo.slice(0,2).some(function(a){return a.qMax<a.qMin||"NaN"===a.qMax}),this.supressChartRendering=this.$scope.dataAttributes.onlyNanData,this.supressDotRendering=this.supressChartRendering||this.$scope.dataAttributes.limitedData,this.$scope.dataAttributes.reduceDataDisc=this.$scope.dataAttributes.limitedData&&!this.$scope.dataAttributes.onlyNanData,this.$scope.dataAttributes.limitedData=!1},_updateData:function(a){this._allowTransitions=b.view!==b.Views.story;var c,d,e,f,g,h;this._data=a,this._defaultZoomPan=!0,this._transformMatrix.identity(),this._currentPanX=0,this.components.dataArea.setData(a),this.providers.colorMap.setData(a),this.components.legend.setData(a),g={axes:{xAxis:{component:this.components.xAxis,data:a.xAxis,title:a.qHyperCube.qMeasureInfo[0].qFallbackTitle,dataIndices:[0]},yAxis:{component:this.components.yAxis,data:a.yAxis,title:a.qHyperCube.qMeasureInfo[1].qFallbackTitle,dataIndices:[1]}},refLineLabels:{x:{axis:this.components.xAxis,data:a.refLine?a.refLine.refLinesX:"",component:this.components.refLineLabelsX},y:{axis:this.components.yAxis,data:a.refLine?a.refLine.refLinesY:"",component:this.components.refLineLabelsY}},refLines:{component:this.components.refLines}},this._super(a,g),h=this.getSnapshotStoredChartData(),f=a.qHyperCube.qMeasureInfo[0].qMin,e=a.qHyperCube.qMeasureInfo[0].qMax,d=e-f,c=f-10*(d>0?d:Math.abs(e)/20),this._xZoomMin=["min","minMax"].contains(a.xAxis.minMax&&!a.xAxis.autoMinMax)&&a.xAxis.min<c?a.xAxis.min:c,c=e+10*(d>0?d:Math.abs(e)/20),this._xZoomMax=["max","minMax"].contains(a.xAxis.minMax&&!a.xAxis.autoMinMax)?a.xAxis.max>c?a.xAxis.max:c:void 0!==a.xAxis.min&&a.xAxis.min>c?a.xAxis.min+c:c,f=a.qHyperCube.qMeasureInfo[1].qMin,e=a.qHyperCube.qMeasureInfo[1].qMax,d=e-f,c=f-10*(d>0?d:Math.abs(e)/20),this._yZoomMin=["min","minMax"].contains(a.yAxis.minMax&&!a.yAxis.autoMinMax)&&a.yAxis.min<c?a.yAxis.min:c,c=e+10*(d>0?d:Math.abs(e)/20),this._yZoomMax=["max","minMax"].contains(a.yAxis.minMax&&!a.yAxis.autoMinMax)?a.yAxis.max>c?a.yAxis.max:c:void 0!==a.yAxis.min&&a.yAxis.min>c?a.yAxis.min+Math.abs(c):c,this._readStoredData&&h&&(this.components.xAxis.setPlotMin(this._xZoomMin=h.xAxisMin),this.components.xAxis.setPlotMax(this._xZoomMax=h.xAxisMax),this.components.yAxis.setPlotMin(this._yZoomMin=h.yAxisMin),this.components.yAxis.setPlotMax(this._yZoomMax=h.yAxisMax)),a.legend&&this.components.legend[(this.supressDotRendering||!a.legend.auto&&!a.legend.show?"hide":"show")+"Component"](),this._zoomScale=1},updateDataArea:function(a,c){this._super(a,c),a.qHyperCube.qMeasureInfo.length>2&&a.dataPoint.rangeBubbleSizes?a.dataPoint.rangeBubbleSizes.length>0&&(this.components.dataArea.setMinDotSize(a.dataPoint.rangeBubbleSizes[0]),a.dataPoint.rangeBubbleSizes.length>1&&this.components.dataArea.setMaxDotSize(a.dataPoint.rangeBubbleSizes[1])):a.dataPoint.bubbleSizes&&this.components.dataArea.setMinDotSize(a.dataPoint.bubbleSizes),null!==a.labels.mode&&this.components.dataArea.setLabelMode(a.labels.mode),this.components.dataArea.setRenderData(!this.supressDotRendering),this.supressDotRendering?(this.selections.off(),this._on&&this.off()):!this.supressDotRendering&&this.isDataSelectable(a)&&(this.selections.on(),this._on||b.isInEditMode()||this.on())},updateAxis:function(a,b){this._super(a,b);var c,d,e,f,g,h,i,j,k=0;for(f in b.axes)c=b.axes[f],e=c.dataIndices[0],d=c.component,g=a.qHyperCube.qMeasureInfo[e].qMin,h=a.qHyperCube.qMeasureInfo[e].qMax,i=!c.data.autoMinMax&&["min","minMax"].contains(c.data.minMax)?Number(c.data.min):null,j=!c.data.autoMinMax&&["max","minMax"].contains(c.data.minMax)?Number(c.data.max):null,g>h?(h=10,g=-10):g===h&&0===h||isNaN(g)&&isNaN(h)?(h=10,g=-10):k=Math.abs(h!==g?.02*(h-g):.1*h),this.setAxisDataRange(d,Math.max(g,h+k),g-k,j,i,k)},updateRefLines:function(a,b){this._super(a,b);for(var c in b.refLineLabels)b.refLineLabels[c].component.setLabelMargin(10)},toggleCacheItem:function(a){this.components.dataArea.toggleCacheItem(a),this.components.legend.invalidateDisplay("ScatterPlot#toggleCacheItem")},getSnapshotChartData:function(){return a.extend(!0,this._super()||{},{xAxisMin:this.components.xAxis.getPlotMin(),xAxisMax:this.components.xAxis.getPlotMax(),yAxisMin:this.components.yAxis.getPlotMin(),yAxisMax:this.components.yAxis.getPlotMax()})},clear:function(){this._super(),this.$scope.navigationVisible=!1},getContextMenu:function(a,c){var d=a,e=d.model,f=e.layout;d.isReadonly||c.addItem({translation:"Common.Navigation",tid:"navigation",icon:"icon-hub-home",select:function(){if(b.isInEditMode())e.getProperties().then(function(a){a.navigation=!a.navigation,e.save()});else{var a=[[],!0];a[0][0]={qPath:"/navigation",qOp:void 0===f.navigation?"add":"replace",qValue:f.navigation?"false":"true"},d.backendApi.applyPatches(a)}}})},destroy:function(){this._super(),this.onNavigationPressed()}}),{type:"scatterplot",BackendApi:h,template:k,View:u,definition:i,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:4,qHeight:x}],qSuppressMissing:!0}},data:j,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},range:{},legend:{}}},importProperties:n.colorChart.importProperties.bind(n),exportProperties:n.colorChart.exportProperties.bind(n)}}),define("extensions.qliktech/linechart/line-objects-model",["core.utils/class","util"],function(a,b){var c,d={LINE:"line",AREA:"area",STACKED:"stackedArea"},e={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return c=a.extend("LineObjectsModel",{init:function(){this._lineObjectSettings=[]},update:function(a,c){this._updateLineObjectsSettings(a,b.extend({selections:this._getSelected(a,c.numDimensions)},c))},getLineObjectsSettings:function(){return this._lineObjectSettings},getPointsOutOfRange:function(){return this._outOfRange.points},_updateLineObjectsSettings:function(a,c){var d,e,f,g,h,i,j,k=a?a.length:0;for(this._outOfRange={up:{},down:{},points:[]},this._lineObjectSettings=[],d=0;k>d;d++)e=a[d],f=c.minorAxes[c.measureToAxisIndex[e.measureIdx]],g=c.axesSettings[c.measureToAxisIndex[e.measureIdx]],h=this._getColorSettings(c.colorMap,g),h.interpolatePointColors=h.isExpression,i=[],this._updateLinePoints(a[d].points,i,this._outOfRange,b.extend({majorAxis:c.majorAxis,minorAxis:f,measureIdx:e.measureIdx,axisSettings:g,isLineSelected:c.selections.lines.indexOf(d)>=0},c)),j=b.extend({info:a.info,colors:h,clippings:this._getClippings(f,c.rect),idx:a.idx,points:i},c),this._lineObjectSettings.push(j)},_updateLinePoints:function(a,b,c,f){var g,h,i,j,k,l,m,n,o,p,q,r=a?a.length:0,s=1===r;for(l=f.majorAxis.getPositionOfValue(0,0),m=0,h=0;r>h;h++)if(a[h]&&(g=a[h],i=g.idx,j={x:f.majorAxis.getPositionOfValue(i,0),y:f.minorAxis.zeroPos},k=g.cacheCircle,k.cx=j.x,k.cy=j.y,!s||!(j.x<0||j.x>f.rect.width))){if(g.isNaN&&!g.hasRightNeighbour&&"number"!=typeof g.nearestRightNeighbour)break;if(g.isNaN&&f.lineType===d.STACKED&&f.nullMode===e.CONNECT&&g.isInterpolationOffset!==!0);else if(g.isNaN&&g.isInterpolationOffset!==!0){l=f.majorAxis.getPositionOfValue(g.hasRightNeighbour?h+1:g.nearestRightNeighbour,0),b.push(!1);continue}if(n=g.hasRightNeighbour?a[h+1].idx:g.nearestRightNeighbour,l="undefined"!=typeof n?f.majorAxis.getPositionOfValue(n,0):0/0,0>l)b.push(!1);else if(m>f.rect.width)b.push(!1);else{o=g.cacheItem.selected;var t=!o&&f.isLineSelected&&f.selections.synqronize&&this._isSelectedIndirectly(i,f.selections.lines,f.selections.points);j.y=f.minorAxis.getPositionOfValue(g.aggregated.end),j.y<-1e5&&(j.y=-1e5),j.y>f.rect.height+1e5&&(j.y=f.rect.height+1e5),k.r=8,k.cy=Math.max(f.axisSettings.topCutoff,Math.min(f.axisSettings.bottomCutoff,j.y)),g.isNaN||(m=j.x),p=f.colorMap.getColor(g.cacheItem.parent?[g.cacheItem.parent.id,g.cacheItem.id]:g.cacheItem.id,g.aggregated.end,f.measureIdx,g.rowIndex).toRGBA(),q={size:o?f.style.dataPoints.size.selected:f.style.dataPoints.size.normal,selected:o||t,selectedIndirectly:t,text:g.cacheItem.getDimensions()[0],measureIdx:g.measureIdx,label:g.label,value:g.aggregated.end,isNaN:g.isNaN,isInterpolationOffset:g.isInterpolationOffset,color:p,outOfRangeUp:j.y<f.axisSettings.topCutoff,outOfRangeDown:j.y>f.axisSettings.bottomCutoff,outOfDimensionBounds:j.x<0||j.x>f.rect.width,outOfBounds:j.x<0||j.x>f.rect.width||g.aggregated.end>f.axisSettings.plotMax||g.aggregated.end<f.axisSettings.plotMin,dataIndex:i,isSingle:!g.hasLeftNeighbour&&!g.hasRightNeighbour&&f.nullMode!==e.CONNECT||s,x:j.x,y:j.y,y1:0===g.aggregated.start?f.axisSettings.areaStartBase:f.minorAxis.getPositionOfValue(g.aggregated.start),cacheItem:g.cacheItem},(q.outOfRangeUp||q.outOfRangeDown)&&(q.outOfRangeUp&&!c.up[q.x]?(c.points.push(q),c.up[q.x]=!0):q.outOfRangeDown&&!c.down[q.x]&&(c.points.push(q),c.down[q.x]=!0)),b[i]=q}}},_getSelected:function(a,b){var c,d,e,f=[],g=[],h=a.length;if(b)for(c=0;h>c;c++)for(e=a[c].points,d=0;d<e.length;d++)e[d]&&e[d].cacheItem.selected&&(-1===f.indexOf(c)?(f.push(c),g[c]=[e[d].idx]):g[c].push(e[d].idx));return{lines:f,points:g,synqronize:f.length>1}},_isSelectedIndirectly:function(a,b,c){var d,e,f,g=b?b.length:0,h=!1;for(d=0;g>d;d++)for(f=c[b[d]],e=0;e<f.length;e++)if(a===f[e]){h=!0;break}return h},_getMeasureGradient:function(a,b){var c=a.plotMin,d=a.plotRange,e={gradient:{colors:[],limits:[],x0:0,x1:0,y0:a.posMin,y1:a.posMax}};return b.getColorMapping().slice().reverse().forEach(function(a){e.gradient.colors.push(a.grad[0].toRGBA()),e.gradient.colors.push(a.grad[1].toRGBA()),e.gradient.limits.push(Math.min(1,Math.max(0,(a.id[0]-c)/d))),e.gradient.limits.push(Math.min(1,Math.max(0,(a.id[1]-c)/d)))}),e},_getClippings:function(a,b){var c=a.getPadding(),d=c.top-1,e=a.rect.height-c.bottom;return{areaClip:{x:0,y:d-1,width:b.width,height:e-d},lineClip:{x:0,y:d-2,width:b.width,height:e-d+2}}},_getColorSettings:function(a,b){var c,d=.3;return a.mode&&a.mode===a.MEASURE&&!isNaN(b.posMin)&&(d=.6,c=this._getMeasureGradient(b,a)),{isExpression:a.mode&&a.mode===a.EXPRESSION,areaAlpha:d,gradient:c}}})}),define("extensions.qliktech/linechart/layers/layer",["core.utils/class","objects.views/charts/renderers/canvas-renderer"],function(a,b){var c;return c=a.extend("layer",{init:function(a,c){this.wrapper=document.createElement("div"),this.wrapper.style.position="absolute",this.renderer=new b(this.wrapper,c),this.minorAxis=null,this.majorAxis=null,a.appendChild(this.wrapper)},update:function(){},release:function(){this.wrapper&&this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null,this.renderer.release(),this.minorAxis=null,this.majorAxis=null},show:function(){this.wrapper.style.display="block"},hide:function(){this.wrapper.style.display="none"},render:function(){"none"!==this.wrapper.style.display&&this.renderer.render()}})}),define("extensions.qliktech/linechart/layers/shapes/points",["objects.views/charts/shapes/container","objects.views/charts/shapes/circle","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect"],function(a,b,c,d){function e(a){switch(a){case"diamond":case"triangle":return new c;case"circle":return new b;case"line":return new d;default:return new d}}function f(a,b,c,d,e){var f=d;switch(e){case"circle":a.set(b,c,.5*f);break;case"diamond":a.set([{x:b,y:c-f/2},{x:b-f/2,y:c},{x:b,y:c+f/2},{x:b+f/2,y:c}]);break;case"triangle":a.set([{x:b,y:c-f/2},{x:b-f/2,y:c+f/2},{x:b+f/2,y:c+f/2}]);break;default:f=d,a.set(b-f/2,c-f/2,f,f)}}var g;return g=a.extend("Points",{init:function(a){this._super(),this._symbol=a||"circle"},update:function(a){var b,c,d,g=a.points?a.points:[],h=0,i=!1,j=g?g.length:0;for(c=0;j>c;c++)d=g[c],!d||d.outOfDimensionBounds||d.isNaN||(b=this._children[h++],b||(b=e(this._symbol),this.addChild(b)),f(b,d.x,d.y,d.size,this._symbol),b.fill=d.selectedIndirectly?"white":d.color,b.stroke=d.selectedIndirectly?d.color:d.selected?"white":!1,b.opacity=d.selected||d.selectedIndirectly?1:a.globalAlpha,b.strokeWidth=1.5,b.visible=!d.outOfBounds&&!d.isNaN&&(a.showDataPoints||d.isSingle||d.keep||d.selected),b.visible&&!i&&(i=b["true"]),b.data.outOfBounds=d.outOfBounds,b.data.value=d.value,b.data.label=d.label,b.data.dataIndex=d.dataIndex,b.data.text=d.text);return h<this._children.length&&this.removeChildren(this._children.slice(h-this._children.length)),this.visible=i,this}})}),define("extensions.qliktech/linechart/layers/shapes/poly-line",["objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/line"],function(a,b,c){function d(a){var b,c=[];for(b=0;b<a.length;b++)c=c.concat(e(a[b]));return c}function e(a){var b,c,d,g,h,i,j,k=[],l=a._polygons[0].points;if(!l||l.length<2)return k;for(a.data.selected=l[0].selected&&l[1].selected,i=null,j=l.length-1,h=1;h<l.length;h++)if(l[h-1].selected&&l[h].selected){i=h-1;break}if(null!==i){for(h=i;h<l.length;h++)if(!l[h].selected){j=h-1;break}c=l.slice(0,i+1),d=l.slice(i,j+1),g=l.slice(j),c&&c.length>1&&(b=f(c,a),k.push(b)),d&&d.length>1&&(b=f(d,a),b.data.selected=!0,k.push(b)),g&&g.length>1&&(b=f(g,a),k=k.concat(e(b)))}else k.push(a);return k}function f(a,c){var d=new b(a);return d.opacity=c.opacity,d.close=!1,d.stroke=c.stroke,d.strokeWidth=c.strokeWidth,d.lineJoin=c.lineJoin,d.lineCap=c.lineCap,d}function g(a,c,e,f){var g,h,i,k,l,m=[];for(i=c?c.length:0,k=[],g=0;i>g;g++)l=c[g],!l||l.isNaN&&l.isInterpolationOffset!==!0?e===j.GAP&&h&&m.length&&(h.set(m),k.push(h),h=null,m=[]):(h||(h=new b,h.close=!1,h.stroke=f||l.color||"#333333",h.lineJoin="round",h.lineCap="round",h.opacity=1,m=[]),m.push({x:l.x,y:l.y,selected:l.selected,dataIndex:l.dataIndex,y_:l.y1}));for(h&&m.length>1&&(h.set(m),k.push(h)),k=d(k),i=k.length,g=0;i>g;g++)k[g].strokeWidth=a.style.line.width*(k[g].data.selected?2:1),k[g].opacity=k[g].data.selected?1:a.globalAlpha;return k}function h(a,b,d){var e,f,g,h=b?b.length:0,i=[],k=null;for(e=0;h>e;e++)f=b[e],!f||f.isNaN&&f.isInterpolationOffset!==!0?d===j.GAP&&(g=null):g?(k=new c(g.x,g.y,f.x,f.y),k.data.selected=g.selected&&f.selected,k.data.y1_=g.y1,k.data.y2_=f.y1,k.stroke={gradient:{x0:g.x,y0:g.y,x1:f.x,y1:f.y,limits:[0,1],colors:[g.color||"#333333",f.color||"#333333"]}},k.opacity=k.data.selected?1:a.globalAlpha,k.strokeWidth=a.style.line.width*(k.data.selected?2:1),i.push(k),g=f):g=f;return i}var i,j={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return i=a.extend("PolyLine",{init:function(){this._super(),this.lineJoin="round",this.lineCap="round"},update:function(a){this.clip=a.clippings.lineClip,this.removeChildren(),this.addChildren(a.colors.interpolatePointColors?h.call(this,a,a.points,a.nullMode):g.call(this,a,a.points,a.nullMode,a.colors.gradient))}})}),define("extensions.qliktech/linechart/layers/shapes/poly-area",["objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/line"],function(a,b,c){function d(a){return{x:a.x,y:a.y_}}var e;return e=a.extend("PolyArea",{init:function(){this._super()},update:function(a,e){var f,g,h,i,j;for(this.clip=a.clippings.areaClip,this.removeChildren(),i=e?e.length:0,h=[],f=0;i>f;f++)e[f]instanceof b?(j=e[f]._polygons[0].points,g=new b(j.concat(j.map(d).reverse())),g.fill=a.colors.gradient||e[f].stroke,g.opacity=a.colors.areaAlpha*(e[f].data.selected?1:a.globalAlpha)):e[f]instanceof c&&(j=[{x:e[f].x1,y:e[f].y1},{x:e[f].x1,y:e[f].data.y1_},{x:e[f].x2,y:e[f].data.y2_},{x:e[f].x2,y:e[f].y2}],g=new b(j),g.fill=a.colors.gradient||"#eeeeee",g.opacity=a.colors.areaAlpha*(e[f].data.selected?1:a.globalAlpha)),g&&h.push(g);this.addChildren(h)}})}),define("extensions.qliktech/linechart/layers/shapes/line-object",["objects.views/charts/shapes/container","./points","./poly-line","./poly-area"],function(a,b,c,d){var e;return e=a.extend("LineObject",{init:function(a,e){this._super(),this.data.label=a.info.label,e.showArea&&(this._areaLayer=new d,this.addChild(this._areaLayer)),this._lineLayer=new c,this.addChild(this._lineLayer),this._pointLayer=new b("circle"),this.addChild(this._pointLayer)},update:function(a){this._pointLayer.update(a),this._lineLayer.update(a),this.visible=this._pointLayer.visible||this._lineLayer.visible,this._areaLayer&&(this._areaLayer.update(a,this._lineLayer.children),this._areaLayer.visible&&(this.visible=!0))}})}),define("extensions.qliktech/linechart/layers/line-objects-layer",["./layer","./shapes/line-object"],function(a,b){var c;return c=a.extend("LineObjectLayer",{init:function(a){this._super(a,{name:"line-objects-layer"})},updateInstances:function(a,c){var d,e=a?a.length:0,f=[];for(this.renderer.stage.removeChildren(),d=0;e>d;d++)f.push(new b(a[d],{showArea:c.showArea}));this.renderer.stage.addChildren(f),this._lineObjects=f},getLineObjects:function(){return this._lineObjects},update:function(a){var b,c=this._lineObjects?this._lineObjects.length:0;for(b=0;c>b;b++)this._lineObjects[b].update(a[b])}})}),define("extensions.qliktech/linechart/layers/oob-layer",["./layer","objects.views/charts/shapes/polygon"],function(a,b){function c(a,b,c,d,e){var f=[];return"left"===e?(f.push({x:a,y:b+c/2}),f.push({x:a,y:b-c/2}),f.push({x:a-d,y:b})):"right"===e?(f.push({x:a,y:b+c/2}),f.push({x:a,y:b-c/2}),f.push({x:a+d,y:b})):"up"===e?(f.push({x:a-c/2,y:b}),f.push({x:a+c/2,y:b}),f.push({x:a,y:b-d})):"down"===e&&(f.push({x:a-c/2,y:b}),f.push({x:a+c/2,y:b}),f.push({x:a,y:b+d})),f}var d;return d=a.extend("OutOfBoundsLayer",{init:function(a){this._super(a,{name:"out-of-bounds-layer"}),this._markerSize=8},update:function(a,d){var e,f,g,h,i,j,k=this.renderer.stage,l=k.children,m=d.markerSize||this._markerSize,n=a?a.length:0;for(j=0;n>j;j++)e=l[j],f=a[j],h=f,f.data&&(h=f.data),i=d.axesSettings[d.measureToAxisIndex[h.measureIdx]],g=c(h.x,h.outOfRangeUp?i.topCutoff+m:i.bottomCutoff-m,m,m,h.outOfRangeUp?"up":"down"),e?e.set(g):(e=new b(g),k.addChild(e)),e.fill="#999999",e.opacity=h.selected?1:d.globalAlpha;n<l.length&&k.removeChildren(l.slice(n-l.length))}})}),define("extensions.qliktech/linechart/layers/label-layer",["./layer","objects.views/charts/utils/canvas-renderer","objects.utils/shapes/geometry-math"],function(a,b,c){function d(){var a,b,c,d,e,f,g,h,i,j,k={},l=this.combinedMeasuresFormatter;for(this._allDataLineObjectsLength=this._allDataLineObjects?this._allDataLineObjects.length:0,this._dataLabelsOfLines=new Array(this._allDataLineObjectsLength),this._allDataPointLabels=[],a=0;a<this._allDataLineObjectsLength;a++)for(this._dataLabelsOfLines[a]=[],c=this._allDataLineObjects[a],f=c.find("Points [visible='true']"),e=f?f.length:0,b=0;e>b;b++)g=f[b].getBoundingRect(),h=g.x+g.width/2,i=g.y+g.height/2,j=h+";"+i,j in k||(k[j]=!0,d={text:this._lineType===s.STACKED&&this._allDataLineObjectsLength>1?l.formatValue(f[b].value):f[b].data.label,x0:h,y0:i,x:h,y:i-this._dataLabelMargin,align:"center",baseline:"bottom",font:this._style.dataPoints.font,maxWidth:512,maxNumLines:1,line:a},this._dataLabelsOfLines[a].push(d),this._allDataPointLabels.push(d));this._numAllDataPointLabels=this._allDataPointLabels.length}function e(){var a;for(a=0;a<this._numAllDataPointLabels;a++)this._allDataPointLabels[a].size=b.measureTextObject({type:"text",shape:this._allDataPointLabels[a]})}function f(){e.call(this);var a,b,c,d,f,g,h,i=this._discreteSpacing/2;for(a=0;a<this._allDataLineObjectsLength;a++)if(d=this._dataLabelsOfLines[a],c=d.length,0!==c)if(1!==c){for(f=d[0],f.priority=5,h=d[1],f.leftDx=i,f.leftDy=0,f.rightDx=h.x0-f.x0,f.rightDy=f.y0-h.y0,b=1;c-1>b;b++)f=d[b],g=d[b-1],h=d[b+1],f.leftDx=g.rightDx,f.leftDy=-g.rightDy,f.rightDx=h.x0-f.x0,f.rightDy=f.y0-h.y0,f.priority=g.y0<f.y0?f.y0<h.y0?1:f.y0===h.y0?2:3:g.y0===f.y0?f.y0<h.y0?2:f.y0===h.y0?0:2:f.y0<h.y0?4:f.y0===h.y0?2:1;f=d[c-1],g=d[c-2],f.leftDx=g.rightDx,f.leftDy=-g.rightDy,f.rightDx=i,f.rightDy=0,f.priority=5}else f=d[0],f.leftDx=i,f.leftDy=0,f.rightDx=i,f.rightDy=0}function g(){var a,b;for(a=0;a<this._numAllDataPointLabels;a++)b=this._allDataPointLabels[a],i.call(this,b),h.call(this,b)}function h(a){var b,c,d,e=this._dataLabelHorizontalGap/2,f=this._dataLabelVerticalGap/2;b=a.size.width/2,c=b+e,a.minX=a.x-b,a.maxX=a.x+b,a.minX2=a.x-c,a.maxX2=a.x+c,d=a.size.height,"top"===a.baseline&&(a.minY=a.y,a.maxY=a.y+d,a.maxY2=a.maxY+f,a.minY2=a.minY-f),"bottom"===a.baseline&&(a.maxY=a.y,a.minY=a.y-d,a.maxY2=a.maxY+f,a.minY2=a.minY-f),"middle"===a.baseline&&(a.maxY=a.y+d/2,a.minY=a.y-d/2,a.maxY2=a.maxY+f,a.minY2=a.minY-f)}function i(a){var b,c,d,e,f,g=a.leftDx,h=a.rightDx,i=a.leftDy,j=a.rightDy,k=1e-9;(i>0||j>0)&&(i=Math.max(i,k),j=Math.max(j,k),b=a.size.width+2*this._horizontalDistanceFromLine,d=b/(g/i+h/j),d>this._maxDataLabelMargin?(a.y=a.y0+this._dataLabelMargin,a.baseline="top"):(d=Math.max(d,this._dataLabelMargin),a.y=a.y0-d,e=d*g/i,f=d*h/j,c=b/2,c>e?a.x=a.x+(c-e):c>f&&(a.x=a.x-(c-f))))}function j(a){var b,c,d,e,f=0,g=this.rect.width,h=9;a.priority>3?(a.baseline="middle",a.x0-f<=g-a.x0?(a.x=a.x0+h+a.size.width/2,a.y=a.y0):(a.x=a.x0-h-a.size.width/2,a.y=a.y0)):3===a.priority&&(b=a.leftDy/a.leftDx,c=a.rightDy/a.rightDx,c>=b?(d=(a.size.height/2+1)/c,2*h>=d?(a.baseline="middle",a.y=a.y0,a.x=a.x0+Math.max(d,h)+a.size.width/2):(e=2*h*c-1,a.baseline="top",a.y=a.y0-e,a.x=a.x0+2*h+a.size.width/2)):(d=(a.size.height/2+1)/b,2*h>=d?(a.baseline="middle",a.y=a.y0,a.x=a.x0-Math.max(d,h)-a.size.width/2):(e=2*h*b-1,a.baseline="top",a.y=a.y0-e,a.x=a.x0-2*h-a.size.width/2)))}function k(){this._allDataPointLabels.sort(void 0!==this._usedDataMax&&this._usedDataMax===this._usedDataMin?function(a,b){return a.x0<b.x0?-1:1}:function(a,b){return a.line>b.line?-1:a.line<b.line?1:a.priority>b.priority?-1:a.priority===b.priority?a.y0===b.y0?a.x0>b.x0?-1:1:4===a.priority?a.y0>b.y0?1:-1:3===a.priority?a.y0>b.y0?-1:1:a.y0<b.y0?-1:1:1})}function l(a,b){return a.minX2>b.maxX2||a.maxX2<b.minX2||a.minY2>b.maxY2||a.maxY2<b.minY2?!1:!0}function m(){var a,b,c=0,d=this.rect.width,e=1,f=this.rect.height-1;for(a=0;a<this._numAllDataPointLabels;a++)b=this._allDataPointLabels[a],b.status=b.x0>c&&b.x0<d&&b.minX>=c&&b.maxX<=d&&b.minY>=e&&b.maxY<=f,!b.status&&b.priority>2&&(j.call(this,b),h.call(this,b),b.status=b.x0>c&&b.x0<d&&b.minX>=c&&b.maxX<=d&&b.minY>=e&&b.maxY<=f)}function n(){var a,b,c,d,e,f,g=[];for(a=0;a<this._allDataLineObjectsLength;a++)for(c=this._allDataLineObjects[a],d=c.find("PolyLine [stroke]"),e=d?d.length:0,b=0;e>b;b++)f=d[b],g.push(f.getPoints());return g}function o(){var a,b,d=n.call(this);for(a=0;a<this._numAllDataPointLabels;a++)b=this._allDataPointLabels[a],b.status&&(b.status=!c.checkPolylinesIntersectingRectDefinedByMaxMin(d,b))}function p(){var a,b;for(a=1;a<this._numAllDataPointLabels;a++)b=this._allDataPointLabels[a],b.status&&q.call(this,a)}function q(a){var b,c=this._allDataPointLabels[a];for(b=0;a>b;b++)if(this._allDataPointLabels[b].status&&l(c,this._allDataPointLabels[b]))return c.status=!1,void(this._allDataPointLabels[b].hasConflict=!0)}var r,s={LINE:"line",AREA:"area",STACKED:"stackedArea"};return r=a.extend("LabelLayer",{init:function(a){this.wrapper=document.createElement("div"),this.wrapper.style.position="absolute",this.renderer=new b(this.wrapper),this.minorAxis=null,this.majorAxis=null,a.appendChild(this.wrapper),this._dataLabelMargin=6,this._maxDataLabelMargin=12,this._dataLabelHorizontalGap=6,this._dataLabelVerticalGap=3,this._horizontalDistanceFromLine=2},update:function(a,b){this.combinedMeasuresFormatter=b.combinedMeasuresFormatter,this._allDataLineObjects=a,this._lineType=b.lineType,this._discreteSpacing=b.majorAxis.getDiscreteSpacing(),this._style=b.style,this.rect=b.rect,this.renderer.shapes=[],d.call(this),f.call(this),g.call(this),k.call(this),m.call(this),o.call(this),p.call(this);var c,e,h,i=[];for(c=0;c<this._numAllDataPointLabels;c++)e=this._allDataPointLabels[c],e.status&&(h={type:"text",fill:this._style.dataPoints.color,shape:e},i.push(h));this.renderer.shapes=i}})}),define("extensions.qliktech/linechart/linearea",["objects.views/charts/components/chart-component","objects.utils/shapes/circle","./line-objects-model","./layers/line-objects-layer","./layers/oob-layer","./layers/label-layer","objects.views/charts/chart-style-service"],function(a,b,c,d,e,f,g){function h(a){return!!a}function i(a){var b,c,d,e,f,g=a?a.length:0;for(b=0;g>b;b++)if(f=a[b],f&&!f.hasRightNeighbour){for(c=b+1;g>c;c++)if(a[c]&&!a[c].isNaN){f.nearestRightNeighbour=c;break}if(!f.isNaN){if(!isNaN(f.nearestRightNeighbour))for(e=c-b,d=1;e>d;d++)a[b+d]&&(a[b+d].nearestRightNeighbour=f.nearestRightNeighbour,a[b+d].nearestLeftNeighbour=b);b=c-1}}}function j(a){var b,c,d,e,f,g,h,i,j=a?a.length:0;for(b=0;j>b;b++)if(i=a[b],i&&!i.hasRightNeighbour&&!i.isNaN&&!isNaN(i.nearestRightNeighbour))for(c=i.nearestRightNeighbour,f=i.value,g=a[c].value,h=c-b,d=1;h>d;d++)e=d/h,a[b+d]&&(a[b+d].interpolatedValue=f*(1-e)+g*e)}function k(a,b){var c,d,e,f,g,h=[],i=a?a.length:0;for(c=0;i>c;c++)d=a[c].points,Object.keys(d).forEach(function(a){var c=!1;g=d[a].idx,h[g]||(h[g]={pos:0,neg:0,total:0}),f=d[a],f&&(e=f.isNaN?isNaN(f.interpolatedValue)?0:f.interpolatedValue:f.value,isNaN(e)||(b?(0===e?f.hasLeftNeighbour&&d[a-1]?c=d[a-1].aggregated.end<0:f.hasRightNeighbour&&d[a+1]&&(c=d[a+1].aggregated.end<0):c=0>e,c?(f.aggregated.start=h[g].neg,h[g].neg+=e,f.aggregated.end=h[g].neg):(f.aggregated.start=h[g].pos,h[g].pos+=e,f.aggregated.end=h[g].pos)):(f.aggregated.start=h[g].total,h[g].total+=e,h[g].pos=Math.max(h[g].pos,h[g].total),h[g].neg=Math.min(h[g].neg,h[g].total),f.aggregated.end=h[g].total),"number"==typeof f.interpolatedValue&&(f.interpolatedValue=f.aggregated.end,f.isInterpolationOffset=!0)))});return{pos:Math.max.apply(null,h.filter(function(a){return!!a}).map(function(a){return a.pos})),neg:Math.min.apply(null,h.filter(function(a){return!!a}).map(function(a){return a.neg}))}}function l(a,b){var c=a.layoutMap[b]||"medium",d={dataPoints:{color:a.getValue(o,"item.value","color"),font:a.getFont(o,"item.value",c),size:{normal:a.getValue(o,"item.shape","size"),selected:a.getValue(o,"item.shape","size","selected")}},outOfRange:{color:a.getValue(o,"item.outOfRange","color")},line:{width:a.getValue(o,"item.line","width",c)}};return d}function m(){if(!this._data||!this._tree)return[];var a,b=this._data.qHyperCube.qDimensionInfo,c=b.length,d=[],e=0;return this._tree.children.forEach(function(f){f.id=b[0].cId+"_"+f.data.qElemNo,a={label:f.data.qText||"",cacheIndex:[],id:f.id},d.push(a),1===c&&(a.cacheIndex[0]=e++),c>1&&f.children.forEach(function(){a.cacheIndex.push(e++)},this)},this),{data:d,info:[{qApprMaxGlyphCount:this._tree.data.qApprMaxGlyphCount}],groupSize:null}}var n,o="lineChart",p={LINE:"line",AREA:"area",STACKED:"stackedArea"},q={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return n=a.extend("LineArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._generatedCacheItems=[],this._showDataPoints=!0,this._colorMap=null,this._showDataPoints=!1,this._lineType=p.LINE,this._nullMode=q.GAP,this._separateStacking=!0,this._globalAlpha=1,this._dataLabelMargin=6,this._maxDataLabelMargin=12,this._dataLabelHorizontalGap=6,this._dataLabelVerticalGap=3,this._horizontalDistanceFromLine=2,this._styleService=g.getInstance(),this._lineObjectsModel=new c,this._lineLayer=new d(this.container),this.layers=[this._lineLayer],this.isMini||(this._oobLayer=new e(this.container),this.layers.push(this._oobLayer),this._labelLayer=new f(this.container),this.layers.push(this._labelLayer))},preRender:function(){},afterPaint:function(){},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setShowDataPoints:function(a){this._showDataPoints=a,this.invalidateDisplay()},getShowDataPoints:function(){return this._showDataPoints},setMajorAxis:function(a){this._majorAxis=a,this._majorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setMinorAxis:function(a){this._minorAxis=a,this._minorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setSecondaryMinorAxis:function(a){this._secondaryMinorAxis=a,this._secondaryMinorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setDimensionTree:function(a){this._tree=a,this.invalidateProperties(),this.invalidateDisplay()},setLineType:function(a){this._lineType=a,this.invalidateDisplay()},setNullMode:function(a){this._nullMode=a},setSeparateStacking:function(a){this._separateStacking=a},setShowDataPointLabels:function(a){this._showDataPointLabels=a},getShowDataPointLabels:function(){return this._showDataPointLabels},freezeZOrdering:function(){this._zOrderFreezed=!0},unFreezeZOrdering:function(){this._zOrderFreezed=!1},setColorMappings:function(a){this._colorMappings=a},_updateSize:function(){this.invalidateDisplay()},getCacheItems:function(){return this._cacheItems},setCacheItems:function(a){this._cacheItems=a},getGeneratedCacheItems:function(){return this._generatedCacheItems||[]},setMeasureIndices:function(a){this._measureIndices=a},getMajorAxisData:function(){return this._majorAxisData},getMinorAxisData:function(){return this._minorAxisData},_updateProperties:function(){if(this._data&&this._tree){this._minorAxes=[this._minorAxis],this._secondaryMinorAxis&&this._minorAxes.push(this._secondaryMinorAxis),this._majorAxisData=m.call(this),this._minorAxisData=null;var a,c,d,e,f,g,l,n=[],o=this._data.qHyperCube.qDimensionInfo,r=o.length,s=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,t=this._data.qHyperCube.qMeasureInfo,u=this._tree,v=this._shapes,w=u.children.length,x=0,y=this._shapes.length,z={},A=this.measureFormatters,B=this.selectionIdentifier?this.selectionIdentifier:"dataArea",C=this._minorAxes,D=[],E=[];
if(this._measureIndices)E=this._measureIndices;else if(s>0&&20>s)for(;E.length<s;)E.push(E.slice(-1)[0]+1||0);if(E.forEach(function(a){D[a]=C.filter(function(b){return b._dataIndices?b._dataIndices.indexOf(a)>=0:!0})[0]}),this._measureToAxis=D,this._measureToAxisIndex=D.map(function(a){return C.indexOf(a)}),this._polysData=[],w&&E||E.length){u.children.forEach(function(h,i){h.id=o[0].cId+"_"+h.data.qElemNo,h.children.forEach(function(j,k){if(r>1)a=h.id+";"+o[1].cId+"_"+j.data.qElemNo,l=z[j.data.qText],l||(z[j.data.qText]={info:{label:j.data.qText},points:[],values:[],measureIdx:r>1?0:k},l=z[j.data.qText]),j=j.children[0],g=A[0];else{if(this._measureIndices&&this._measureIndices.indexOf(k)<0)return;a=h.id,l=z[k],l||(z[k]={info:{label:t[k].qFallbackTitle},measureIdx:k,points:[],values:[]},l=z[k]),g=A[k]}d=j.children[0],d&&(c=void 0!==d.data.qValue?d.data.qValue:d.data.qNum,f=isNaN(c),this._nullMode===q.ZERO&&f&&(c=0,f=!1),j.chartData={value:c,isNaN:f,idx:i,measureIdx:r>1?0:k,hasLeftNeighbour:!!l.points[i-1]&&!l.points[i-1].isNaN,hasRightNeighbour:!1,color:null,text:d.data.qText,label:d.data.qText?g&&("U"===g.type||isNaN(d.data.qNum))?g.formatValue(c):d.data.qText:"",rowIndex:j.data.rowIndex,dimValue:h.data.qNum,id:a,aggregated:{}},j.chartData.isNaN||(j.chartData.aggregated.start=0,j.chartData.aggregated.end=c,l.values.push(c)),l.points[i]=j.chartData,l.points[i-1]&&(l.points[i-1].hasRightNeighbour=!j.chartData.isNaN),j.chartData.shapeIndex=x++,x>y&&v.push(new b(0/0,0/0,0/0)),j.chartData.cacheCircle=v[j.chartData.shapeIndex],e=j.parent,e.cacheItem&&(n.indexOf(e.cacheItem)<0&&n.push(e.cacheItem),j.chartData.cacheItem=e.cacheItem,e.cacheItem.addShape(B,j.chartData.cacheCircle,!0),e.cacheItem.calculateTooltipPosition=!0))},this)},this);var F=[],G=this._nullMode===q.CONNECT&&this._lineType===p.STACKED&&(s>1||r>1);if(Object.keys(z).forEach(function(a){this._nullMode!==q.ZERO&&i.call(this,z[a].points),G&&j.call(this,z[a].points),z[a].points=z[a].points.filter(h),F.push(z[a])},this),this._polysData=F,this._zOrderFreezed){var H=this._sortedOrder;this._polysData.forEach(function(a,b){a.idx=b}),this._polysData.sort(function(a,b){return H.indexOf(a.idx)-H.indexOf(b.idx)})}else this._lineType===p.AREA?(this._polysData.forEach(function(a,b){a.idx=b,a.values.sort(function(a,b){return b-a}),a.absMedian=Math.abs(a.values[Math.floor(a.values.length/2)])}),this._polysData.sort(function(a,b){return b.absMedian-a.absMedian})):this._polysData.forEach(function(a,b){a.idx=b}),this._sortedOrder=this._polysData.map(function(a){return a.idx});if(this._lineType===p.STACKED&&(s>1||r>1)){var I=k.apply(this,[F,this._separateStacking]);this._minorAxisData={min:I.neg>=0?0:I.neg,max:I.pos<0?0:I.pos}}}this._shapes.length>x&&(this._shapes=this._shapes.slice(0,x)),this.setSelectableShapes(n),this._lineLayer.updateInstances(this._polysData,{showArea:[p.AREA,p.STACKED].contains(this._lineType)})}},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data&&this._tree},updateSize:function(){this._super(),this.layers.forEach(function(a){a.rect=this.rect,a.renderer.setDimensions(0,0,this.rect.width,this.rect.height),a.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y)},this),this._style=l(this._styleService,this._layoutMode)},release:function(){this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this),this._secondaryMinorAxis&&this._secondaryMinorAxis.stopListen("changed",null,this)},beforeLayerUpdates:function(){},paint:function(){this._majorAxis.updateNow(),this._minorAxis.updateNow();var a={numDimensions:this._data.qHyperCube.qDimensionInfo.length,showDataPoints:this._showDataPoints&&this._layoutMode>this.ShowFlags.SPARK,nullMode:this._nullMode,globalAlpha:this._globalAlpha,majorAxis:this._majorAxis,minorAxes:this._minorAxes,measureToAxisIndex:this._measureToAxisIndex,axesSettings:this._minorAxes.map(this._getAxisDetails),combinedMeasuresFormatter:this.combinedMeasuresFormatter,colorMap:this._colorMap,rect:this.rect,style:this._style,markerSize:Math.min(8,this._majorAxis.getDiscreteSpacing()/2)};this._lineObjectsModel.update(this._polysData,a),this.beforeLayerUpdates(this._lineObjectsModel.getLineObjectsSettings()),this._lineLayer.update(this._lineObjectsModel.getLineObjectsSettings()),this.preRender(this._lineLayer._lineObjects),this._lineLayer.render(),this._oobLayer&&(this._oobLayer.update(this._lineObjectsModel.getPointsOutOfRange(),a),this._oobLayer.render()),this._labelLayer&&(this._layoutMode>this.ShowFlags.XSMALL&&this._showDataPointLabels&&this._showDataPoints?(this._labelLayer.update(this._lineLayer.getLineObjects(),a),this._labelLayer.show(),this._labelLayer.render()):this._labelLayer.hide()),this.afterPaint(a.axesSettings[0].topCutoff,a.axesSettings[0].bottomCutoff)},_getAxisDetails:function(a){var b=a.getPlotMin(),c=a.getPlotMax(),d=c-b,e=a.getPadding(),f=e.top-1,g=a.rect.height-e.bottom,h=0;return h=b>0?g:0>c?f:Math.floor(a.getPositionOfValue(0))-.5,{plotMin:b,plotMax:c,posMin:a.getPositionOfValue(b),posMax:a.getPositionOfValue(c),plotRange:d,topCutoff:f,bottomCutoff:g,areaStartBase:h,zeroPos:Math.floor(a.getPositionOfValue(0))-.5}}})}),define("extensions.qliktech/linechart/linechart-properties",["translator"],function(a){function b(a,b){var c=b.getDimensions(),d=b.getMeasures();return"area"===a.lineType&&c.length+d.length>2}function c(a,b){return b?b.getMeasureLayouts():a.qHyperCubeDef.qMeasures.map(function(a){return a.qDef})}function d(a,b){return b?b.getDimensionLayouts():a.qHyperCubeDef.qDimensions.map(function(a){return a.qDef})}var e,f,g;e={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{lineType:{ref:"lineType",type:"string",component:"item-selection-list",defaultValue:"line",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.area",value:"area"}]},stackedProps:{type:"items",grouped:!1,items:{stackedArea:{ref:"stackedArea",translation:"properties.style.stackedArea",type:"boolean",defaultValue:!1,show:function(a,c){return b(a,c)}},separateStacking:{ref:"separateStacking",translation:"properties.separateStacking",type:"boolean",defaultValue:!0,readOnly:function(a){return!a.stackedArea},show:function(a,c){return b(a,c)}}}},nullMode:{type:"string",component:"dropdown",ref:"nullMode",translation:"properties.nullMode",options:[{value:"gap",translation:"properties.nullMode.gap"},{value:"connect",translation:"properties.nullMode.connect"},{value:"zero",translation:"properties.nullMode.zero"}],defaultValue:"gap"},dataPointSettings:{type:"items",grouped:!1,snapshot:{tid:"property-dataPoint"},items:{dataPoints:{ref:"dataPoint.show",translation:"properties.dataPoints.showDataPoints",type:"boolean",defaultValue:!1},showDataPointLabels:{ref:"dataPoint.showLabels",translation:"properties.dataPoints.labelmode",type:"boolean",component:"switch",defaultValue:!1,show:function(a){return a.dataPoint&&a.dataPoint.show},options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]}}},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{type:"number",component:"dropdown",ref:"gridLine.spacing",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(a){return a.gridLine&&!a.gridLine.auto}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{colorMode:{options:function(a,b){var c=[{value:"primary",translation:"properties.colorMode.primary"}];return 1===b.getMeasures().length&&b.getDimensions().length<=1&&c.push({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),b.getMeasures().length>1?c.push({value:"byDimension",translation:"properties.colorMode.multicolored"}):b.getDimensions().length>1&&c.push({value:"byDimension",translation:"properties.colorMode.byDimension"}),b.getMeasures().length>=1&&c.push({value:"byExpression",translation:"properties.colorMode.byExpression"}),c}}}},legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{type:"items",label:function(b,c){var e,f=d(b,c).map(function(a){return a.qFallbackTitle||""}).join(", ");return e=f?a.get("properties.xAxisWithInfo",[f]):a.get("properties.xAxis")},items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(a){return a.dimensionAxis&&["all","labels"].contains(a.dimensionAxis.show)}},dock:{type:"string",component:"dropdown",ref:"dimensionAxis.dock",translation:"Common.Position",options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}],show:function(a){return a.dimensionAxis&&"none"!==a.dimensionAxis.show},defaultValue:"near"}}},measureAxis:{uses:"measureAxis",label:function(b,d){var e,f=c(b,d).map(function(a){return a.qFallbackTitle}).join(", ");return e=f?a.get("properties.yAxisWithInfo",[f]):a.get("properties.yAxis")},items:{axis:{type:"items",items:{show:{snapshot:{title:"properties.yAxis",tid:"property-yAxis"}}}},scale:{type:"items",items:{logScale:{ref:"measureAxis.logarithmic",translation:"properties.axis.logarithmicScale",type:"boolean"},label:{component:"text",translation:"properties.axis.logarithmicScaleNote",show:function(a){return a.measureAxis&&a.measureAxis.logarithmic}}}}}}}},f={uses:"sorting",items:{dimensions:{locked:function(a,b,c){return 1===c.getMeasures().length&&2===c.getDimensions().length?0===a:!1}}}},g={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"},refLines:{uses:"reflines"}}};var h={uses:"data",items:{dimensions:{}}};return{type:"items",component:"accordion",items:{data:h,sorting:f,addons:g,settings:e}}}),define("extensions.qliktech/linechart/linechart-data",["general.utils/property-resolver","general.utils/array-util"],function(a,b){function c(a){var b=a.getDimensions(),c=a.getMeasures();1===b.length&&1===c.length&&0!==a.getSorting()[0]&&a.changeSorting(1,0)}function d(b,c){var d=c.getDimensions(),e=c.getMeasures(),f=a.getValue(b,"color.mode");d.length>1&&a.setValue(b,"color.persistent",!0),"byMeasure"===f&&(d.length>1||e.length>1)?a.setValue(b,"color.mode","byDimension"):"byDimension"===f&&d.length<=1&&e.length<=1?a.setValue(b,"color.mode","primary"):"byExpression"===f&&0===e.length&&a.setValue(b,"color.mode","primary")}function e(a){return a>=2?1:15}return{dimensions:{min:1,max:function(a){return a>=2?1:2},add:function(a,b,e){e.getDimensions().length>1&&(b.qHyperCubeDef.qMode="K",b.qHyperCubeDef.qAlwaysFullyExpanded=!0),c(e),d(b,e)},remove:function(a,b,c){var f=c.getDimensions(),g=c.getMeasures(),h=e(f.length),i=c.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures;1===g.length&&i&&i.length&&i.splice(0,h-1).forEach(function(a){g.push(a),c.hcProperties.qInterColumnSortOrder.push(f.length+g.length-1)}),d(b,c),1===f.length&&(b.qHyperCubeDef.qMode="S")},autoSort:function(a,b,c,d){c&&(c.contains("$text")||c.contains("$ascii")?d.qSortByAscii=1:c.contains("$numeric")&&(d.qSortByNumeric=1))}},measures:{min:1,max:e,add:function(a,b,e){c(e),d(b,e)},remove:function(a,c,e){var f=e.getDimensions(),g=e.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions;1===f.length&&g&&g.length&&(f.push(g.splice(0,1)[0]),b.indexAdded(e.hcProperties.qInterColumnSortOrder,f.length-1)),d(c,e),f.length>1?(c.qHyperCubeDef.qMode="K",c.qHyperCubeDef.qAlwaysFullyExpanded=!0):1===f.length&&(c.qHyperCubeDef.qMode="S")}}}}),define("text!extensions.qliktech/linechart/linechart.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<div qva-chart-disclaimer options="dataAttributes" visible="true"></div>'}),define("extensions.qliktech/linechart/linechart",["jquery","util","client.utils/state","objects.views/charts/scrollable-chart","objects.views/charts/components/chart-component","./linearea","extensions.qliktech/linechart/linechart-properties","extensions.qliktech/linechart/linechart-data","objects.backend-api/stacked-api","text!./linechart.ng.html","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.views/charts/disclaimers/chart-disclaimer-directive"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){var b,c,d,f;b=this.components.measureAxis,!a.dataPoint.show||this._layoutMode<=e.prototype.ShowFlags.XSMALL?(c=4,d=4):a.dataPoint.show&&(f=15,a.dataPoint.showLabels?(c=f+7,d=Math.max(6,f/2+1)):(c=f/2+1,d=f/2+1)),["near","bottom"].contains(this.components.dimensionAxis.dock)?b.setPadding(c,0,d,0):b.setPadding(d,0,c,0)}var n,o={NONE:0,ONE_DIM:1,TWO_DIM:2};return n=d.extend("LineChart",{namespace:".linechart",init:function(b,c,d,e){var g,h=a.extend(!0,{},d);d=a.extend(!0,d||{},{components:{dataArea:{clazz:f},miniChart:{components:{dataArea:{clazz:f}}}}},h),this._super(b,c,d,e),this.components.miniChart&&(g=this.components.miniChart,this.components.miniChart.setBackendApi(this.backendApi),this.components.scrollArea.setMiniChart(g),g.setColorMap(this.providers.colorMap),g.components.measureAxis.setDock("left"),g.components.dimensionAxis.setDock("bottom"),g.components.dataArea.setMinorAxis(g.components.measureAxis),g.components.dataArea.setMajorAxis(g.components.dimensionAxis),g.setOrientation("vertical"))},initSelections:function(){this.selections.types.range.setComponent("x",this.components.dimensionAxis),this.selections.types.range.setComponent("y",this.components.measureAxis),this.selections.Select.bind(function(a,b){var c,d=this.selections.getActiveType().activeComponent;c=d instanceof f?this.components.dimensionAxis.getType().current:d.getSelectionIndices(),this.onSelection.Select.apply(this,[a,b,c,"L"])}.bind(this)),this._super()},_postResize:function(){this.components.measureAxis.setNiceNumberEnabled(this._layoutMode>e.prototype.ShowFlags.XSMALL),this._super()},partialUpdate:function(){this.components.dataArea.freezeZOrdering(),this._super.apply(this,[].slice.call(arguments))},_paint:function(){if(this._super()===!1)return!1;var a,b=this.components.scrollArea;if(m.call(this,this._data),this.layout(),this._dataForMiniChartChanged&&this.components.scrollArea.isVisible()&&this.components.scrollArea.getUseMiniChart()&&this.components.miniChart&&(this.components.miniChart.setData(this._data),this._dataForMiniChartChanged=!1),!this.checkPage()){for(a in this.components)this.components[a].invalidateDisplay("LineChart.paint");b.viewState.min+b.viewState.range>b.fullState.max&&b.setOffset(b.fullState.max-b.viewState.range)}},prePaint:function(a){var b=!1;if(2===a.qHyperCube.qDimensionInfo.length&&a.qHyperCube.qStackedDataPages[0]){var d=a.qHyperCube.qStackedDataPages[0].qData[0];b=0!==d.qSubNodes[0].qUp||0!==d.qSubNodes[d.qSubNodes.length-1].qDown}k.applyDisclaimerAttributes({title:a.qHyperCube.qDimensionInfo.length>1,bottom:!0,supportRangeOverZero:!a.measureAxis.logarithmic,paging:1===a.qHyperCube.qDimensionInfo.length,expliciLimitedData:b},this.$scope.dataAttributes,this.$element,this.$scope,c,a)},_updateData:function(a){this._checkPage=!1,this._data=a,this._dataForMiniChartChanged=!0,this._disablePagingTransitions(),this.components.dataArea.unFreezeZOrdering(),this.isStacked=("stackedArea"===a.lineType||"area"===a.lineType&&a.stackedArea)&&(a.qHyperCube.qDimensionInfo.length>1||a.qHyperCube.qMeasureInfo.length>1),this.components.measureAxis.isStacked=this.isStacked,this.components.scrollArea.setUseMiniChart(a.qHyperCube.qDimensionInfo.length>1&&!this.isStacked?!1:!0);var b=null;this._pagingMode=o.NONE,a.qHyperCube.qDimensionInfo.length>1?(b=a.qHyperCube.qStackedDataPages&&a.qHyperCube.qStackedDataPages.length?a.qHyperCube.qStackedDataPages[0].qData[0].qSubNodes.length+a.qHyperCube.qStackedDataPages[0].qData[0].qDown+a.qHyperCube.qStackedDataPages[0].qData[0].qUp:null,this.components.dimensionAxis.setSelectionIndices([0]),this.components.dataArea.setSelectionIndices([0,1]),this._pagingMode=o.ONE_DIM,this.isStacked=!0):a.qHyperCube.qSize.qcy>a.qHyperCube.qDataPages[0].qArea.qHeight&&(b=a.qHyperCube.qSize.qcy,this._pagingMode=o.ONE_DIM),this.components.dimensionAxis.isDiscrete()||(this._pagingMode=o.NONE),this.components.dimensionAxis.setNumDiscreteUnits(b);var d,e=a.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle}).join(", "),f=a.qHyperCube.qDimensionInfo.map(function(a){return a.qFallbackTitle}).join(", "),g={axes:{measureAxis:{component:this.components.measureAxis,data:a.measureAxis,title:e,dataIndices:a.qHyperCube.qMeasureInfo.map(function(a,b){return b})},dimensionAxis:{component:this.components.dimensionAxis,data:a.dimensionAxis,title:c.view!==c.Views.story?"":f,dataIndices:a.qHyperCube.qDimensionInfo.map(function(a,b){return b})}},refLineLabels:{labels:{data:a.refLine.refLines,component:this.components.refLineLabels,axis:this.components.measureAxis}},refLines:{component:this.components.refLines},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle,data:a.dimensionAxis}}},h=this.components.dimensionAxisTitle;this.components.dataArea.setData(a),this.providers.colorMap.setData(a),this.components.legend.setData(a);var i=this.providers.colorMap.getLegendDataProvider();i.setLegendMarker(a.dataPoint.show?["line","circle"]:["line"]),h.setData(a),this._super(a,g),d=this.getSnapshotStoredChartData(),c.view!==c.Views.story?(h.setTitle(f),h.showComponent()):h.hideComponent(),this._readStoredData&&d?(this.components.dimensionAxis.setInnerOffset(d.axisInnerOffset),this.components.scrollArea.setOffset(d.scrollOffset)):(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)),this._checkPage=!0},updateDataArea:function(a){var b="stackedArea"===a.lineType||"area"===a.lineType&&a.stackedArea?"stackedArea":a.lineType;this._super.apply(this,[].slice.call(arguments)),this.components.dataArea.setLineType(b),this.components.miniChart&&(this.components.miniChart.components.dataArea.setLineType(b),this.components.miniChart.components.dataArea.setNullMode(a.nullMode),this.components.miniChart.components.dataArea.setSeparateStacking(a.separateStacking),this.components.miniChart.setLogScale(a.measureAxis.logarithmic)),this.components.dataArea.setShowDataPoints(a.dataPoint.show),this.components.dataArea.setNullMode(a.nullMode),this.components.dataArea.setSeparateStacking(a.separateStacking),this.components.dataArea.setShowDataPointLabels(a.dataPoint.showLabels),this.components.dataArea.updateNow(["properties"])},updateAxis:function(a,c){this._super(a,c);var d,e,f,g,h,i,j;f=Math.min.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return a.qMin})),g=Math.max.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMax)}).map(function(a){return a.qMax})),b.isNumeric(f)||(f=-1),b.isNumeric(g)||(g=1),h=c.axes.measureAxis,i=!h.data.autoMinMax&&["min","minMax"].contains(h.data.minMax)?Number(h.data.min):null,j=!h.data.autoMinMax&&["max","minMax"].contains(h.data.minMax)?Number(h.data.max):null,this._dataMaxPositive=g>0,this._dataMinNegative=0>f,d=this.components.measureAxis,d.setWhiteSpaceOptimizingEnabled(!0),d.setRealDataRange(void 0,void 0);var k=this.components.dataArea.getMajorAxisData(),l=this.components.dataArea.getMinorAxisData();this.components.dimensionAxis.setDataRange(k.data,k.info),e=0,f>g?(g=10,f=-10):g===f&&(g?e=Math.abs(g?.2*g:0):(g=10,f=-10)),l&&("stackedArea"===a.lineType||"area"===a.lineType&&a.stackedArea)&&(a.qHyperCube.qMeasureInfo.length>1||a.qHyperCube.qDimensionInfo.length>1)?this.setAxisDataRange(d,l.max,l.min,j,i,e):"line"!==a.lineType?this.setAxisDataRange(d,g>0?g+e:0,0>f?f-e:0,j,i,e):this.setAxisDataRange(d,g>0?g+e:Math.min(0,g+e),0>f?f-e:Math.max(0,f-e),j,i,e),m.call(this,a)}}),{type:"linechart",BackendApi:i,template:j,View:n,definition:g,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"S",qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:500,qLeft:0,qWidth:17}],qSuppressZero:!1,qSuppressMissing:!0}},data:h,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},range:{},legend:{}}},importProperties:function(a,b,c){var d=l.axisChart.importProperties.apply(l,[a,b,c]),e=d.qProperty;return e.qHyperCubeDef.qDimensions.length>1&&(e.qHyperCubeDef.qMode="K"),e.color&&"byDimension"===e.color.mode&&e.qHyperCubeDef.qDimensions.length<=1&&l.changeProperty("color.mode","primary",d),d},exportProperties:l.axisChart.exportProperties.bind(l)}}),define("extensions.qliktech/straight-table/straight-table-properties",["client.property-panel/default-properties","util","general.utils/property-resolver","translator"],function(a,b,c,d){var e,f;e={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",items:{totals:{ref:"totals.show",type:"boolean",translation:"properties.totals",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0},totalsMode:{ref:"totals.position",translation:"Common.Position",type:"string",component:"dropdown",options:[{value:"noTotals",translation:"Common.None"},{value:"top",translation:"Common.Top"},{value:"bottom",translation:"Common.Bottom"}],defaultValue:"noTotals",show:function(a){return!a.totals.show}},totalsLabel:{ref:"totals.label",translation:"properties.totals.label",type:"string",expression:"optional",defaultValue:function(){return d.get("Object.Table.Totals")}}}}}};var g={type:"array",component:"columns",translation:"Common.Data",sortIndexRef:"qHyperCubeDef.columnOrder",allowMove:!0,allowAdd:!0,addTranslation:"Common.Columns",items:{dimensions:{type:"items",component:"expandable-items",ref:"qHyperCubeDef.qDimensions",grouped:!0,items:a.dimensions.items},measures:{type:"items",component:"expandable-items",ref:"qHyperCubeDef.qMeasures",grouped:!0,items:b.extend(!0,{},a.measures.items,{tableColorBgByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.0.qExpression",translation:"Object.Table.Measure.BackgroundExpression",defaultValue:""},tableColorByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.1.qExpression",translation:"Object.Table.Measure.ForegroundExpression",defaultValue:"",change:function(a){void 0===a.qAttributeExpressions[0]&&(a.qAttributeExpressions[0]={})}},totalsAggr:{type:"items",items:{totalsAggrFunc:{type:"string",component:"dropdown",ref:"qDef.qAggrFunc",translation:"Object.Table.AggrFunc",options:[{value:"Expr",translation:"Common.Auto"},{value:"Avg",translation:"Object.Table.AggrFunc.Avg"},{value:"Count",translation:"Object.Table.AggrFunc.Count"},{value:"Max",translation:"Object.Table.AggrFunc.Max"},{value:"Min",translation:"Object.Table.AggrFunc.Min"},{value:"Sum",translation:"Object.Table.AggrFunc.Sum"},{value:"None",translation:"Object.Table.AggrFunc.None"}],defaultValue:"Expr"},totalsAggrFuncMessage:{component:"text",translation:"Object.Table.AggrFuncMessage",show:function(a,b){return b&&!c.getValue(b,"properties.totals.show")&&"noTotals"===c.getValue(b,"properties.totals.position")}}}}})}}};return f={uses:"sorting"},{type:"items",component:"accordion",items:{data:g,sorting:f,settings:e}}}),define("text!extensions.qliktech/straight-table/straight-table.ng.html",[],function(){return'<div class="qv-st" ng-class="{ \'qv-st-interactive\': interactive,\r\n	\'align-totals\': scrollApi.alignTotals,\r\n	\'align-column-picker\': scrollApi.settings.columnPicker.show,\r\n	\'qv-st-selections-active\': selections.active,\r\n	\'qv-st-virtual-scroll-enabled\': scrollApi.virtualScrollEnabled\r\n	}"\r\n	 ng-style="fontScale">\r\n	<qv-straight-table-top-header on-sort-header="sort(header);" on-search="search($alignTo,header)"></qv-straight-table-top-header>\r\n	<qv-scroll-area class="qv-grid-object-scroll-area qv-animate">\r\n		<qv-straight-table-data qv-selections-select-while-locked="selectWhileLocked()"\r\n								qv-selections-toggle-dimension-value="{ selector: \'.qv-st-data-cell\'}"\r\n								qv-selections-on-toggle-dimension-value="interactive && selectDimensionValue(cell, offsetLeft, width, $event)"\r\n								qv-selections-multiselect="{ selector: \'.qv-st-data-cell:not(.qv-st-data-cell-null-value)\' }"\r\n								qv-selections-start-multiselect="interactive && activateSelections(cell, offsetLeft, width)"\r\n								qv-selections-update-multiselect="interactive && multiselectDimensionValues(start, current, dataColIx)"\r\n								qv-selections-end-multiselect="interactive && multiselect()"></qv-straight-table-data>\r\n	</qv-scroll-area>\r\n	<qv-straight-table-bottom-header></qv-straight-table-bottom-header>\r\n	<qv-scroll-loader></qv-scroll-loader>\r\n	<qv-straight-table-column-picker-activator ng-if="scrollApi.settings.columnPicker.show"></qv-straight-table-column-picker-activator>\r\n</div>\r\n'}),define("objects.grid/services/data-service",["qvangular","translator","general.utils/color"],function(a,b,c){function d(a,b){var c,d=[],e=a.length,f=b.length;for(c=0;e>c;++c)d.push(c);for(c=0;f>c;++c)d.push(e+c);return d}function e(a,b){var c,d,e,f,g=[];for(d=a.rows.length,c=0;d>c;++c)f=a.rows[c],e=f.cells.length,e>b&&b>=0&&g.push(f.cells[b]);return g}function f(a,b,c){var d,e,f,g,h=a.rows.length,i=null,j=[];for(d=0;h>d;++d)for(f=a.rows[d],g=f.cells.length,e=0;g>e;++e)i=f.cells[e],i.dataColIx===b&&i.dataValue===c&&j.push(i);return j}function g(a,b,c){var d,e,f,g,h=a.rows.length,i=null;for(d=0;h>d;++d)for(f=a.rows[d],g=f.cells.length,e=0;g>e;++e)if(i=f.cells[e],i.dataColIx===b&&i.dataRowIx===c)return i;return null}function h(a,b){var c=b.qHyperCube.qDimensionInfo.length;return b.qHyperCube.columnOrder?c>a?b.qHyperCube.qDimensionInfo[a]:b.qHyperCube.qMeasureInfo[a-c]:{othersLabel:!1,qLocked:!1}}function i(a,b){var c=b.qHyperCube.qGrandTotalRow[a-b.qHyperCube.qDimensionInfo.length];return c||(c={qText:""}),c}function j(a){return a?"qDimensionType"in a:void 0}function k(a,b,c,d,e,f,g){var h,i,j,l,n,p,q;for(h=0;h<e.length;++h)i=e[h],j=d.getHeaderRow(a),l=j.getNextCell(),n=i.qText,m(i)&&(p=g.leftCellCnt+b,p>=g.pseudoDimIndex&&p--,n=g.layout.qHyperCube.qDimensionInfo[p].othersLabel),l.setTopHeader(n,i.qElemNo,1,1,b,f+c),(o(i)||i.qCanCollapse||i.qCanExpand)&&(l.addClass("bold"),l.setCollapseExpandClass(i),j.addClass("bold")),i.qSubNodes.length?(q=k(a+1,b+1,c,d,i.qSubNodes,f,g),l.colspan=q-c,c=q):c++;return c}function l(a,b,c,d){d.dataColumnsInfo.cnt<=0||(k(1,0,0,a,b,c,d),a.setNextHeaderIx(Math.max(2,a.topTreeDepth+1)))}function m(a){return-3===a.qElemNo}function n(a){return-2===a.qElemNo}function o(a){return-1===a.qElemNo}function p(a){return-4===a.qElemNo}function q(a){return o(a)||p(a)}function r(a){return"P"===a.qType}function s(a){return a.qCanCollapse||a.qCanExpand||a.qSubNodes.length&&!r(a.qSubNodes[0])}function t(a,b){return 0===a&&(o(b)||r(b))||!q(b)&&!r(b)}function u(a,b,c,d,e,f,g,h){var i,j=0,k=e.getRow(a);return c>0&&k.addEmptyHeaderCell(1,c,"left"),(d.qCanCollapse||d.qCanExpand)&&(k.addLeftCollapseExpandCell(f+a,b,d),j=-1),i=k.getNextCell(),h=h||d.qText,m(d)&&(h=g.layout.qHyperCube.qDimensionInfo[b>=g.pseudoDimIndex?b-1:b].othersLabel),i.setLeftHeader(h,d.qElemNo,1,g.leftCellCnt-c+j,f+a,b),s(d)&&(i.addClass("bold"),k.addClass("bold")),i}function v(a,b,c,d,e,f,g,h,i,j,k){var l,m,o;for(l=0;l<e.length;++l)m=e[l],t(b,m)&&(f=m,g=b,h=c),b>0&&r(m)&&(i=m),m.qSubNodes.length?a=v(a,b+1,c+(b>0&&r(m)?0:1),d,m.qSubNodes,f,g,h,i,j,k):(o=f.qText,i&&(o+=n(f)?" ":" - "+i.qText,i=null),u(a,g,h,f,d,j,k,o),++a);return a}function w(a,b,c,d,e,f){var g,h,i,j,k,l,n,q=0;for(g=0;g<d.length;++g)if(h=d[g],i=c.getRow(a),p(h)?(j=i.getNextCell(),j.setLeftHeader("",-4,1,2)):(j=i.getNextCell(),(h.qCanCollapse||h.qCanExpand)&&(k=j,k.setLeftHeader("",-1,1,1,e+a,b),k.setCollapseExpandClass(h),j=i.getNextCell(),q=1),n=h.qText,m(h)&&(n=f.layout.qHyperCube.qDimensionInfo[b>=f.pseudoDimIndex?b-1:b].othersLabel),j.setLeftHeader(n,h.qElemNo,1,2-q,e+a,b),o(h)&&(j.addClass("bold"),i.addClass("bold"))),h.qSubNodes.length)l=w(a,b+1,c,h.qSubNodes,e,f),j.rowspan=l-a,k&&(k.rowspan=j.rowspan),a=l;else{var r=f.leftCellCnt-2*(b+1);r>0&&(j=i.getNextCell(),j.setLeftHeader("",-4,1,r)),++a}return a}function x(a,b,c,d){d.isIndentMode?v(0,0,0,a,b,null,-1,-1,null,c,d):w(0,0,a,b,c,d)}function y(a,b){var d,e;a.style.backgroundColor="",a.color.bgByExpression=!1,a.color.bgIsDark=!1,"U"!==b.qType&&b.qAttrExps&&b.qAttrExps.qValues&&b.qAttrExps.qValues.length&&(a.color.bgByExpression=!0,e="NaN"!==b.qAttrExps.qValues[0].qNum?b.qAttrExps.qValues[0].qNum:b.qAttrExps.qValues[0].qText,d=new c(e,"argb"),d.isInvalid()||(a.style.backgroundColor=d.toRGBA(),a.color.bgIsDark=d.isDark(),a.addClass(a.color.bgIsDark?"color-light":"color-dark"))),a.style.color="",b.qAttrExps&&b.qAttrExps.qValues&&b.qAttrExps.qValues.length>1&&(e="NaN"!==b.qAttrExps.qValues[1].qNum?b.qAttrExps.qValues[1].qNum:b.qAttrExps.qValues[1].qText,d=new c(e,"argb"),d.isInvalid()||(a.style.color=d.toRGBA()))}function z(a,b,c,d){var e,f,g,h,i,j=0,k=0;for(e=0,j=b.length;j>e;++e)for(h=a.getNextRow(),0===a.leftTreeDepth&&h.addEmptyHeaderCell(1,1),k=b[e].length,0===k&&0===e&&h.cells.lastElement.addClass("first-data-cell"),f=0;k>f;++f)i=h.getNextCell(),g=b[e][f],i.setData(g.qText,1,1,c+e,d+f),i.addClass("data"),0===e&&0===f&&i.addClass("first-data-cell"),"U"===g.qType&&i.addClass("null-value"),isNaN(g.qNum)||i.addClass("numeric"),h.hasClass("bold")&&i.addClass("bold"),y(i,g)}function A(a,b,d,e,f,g,i){var k,l,m,n,o,p,q,r,s,t,u,v,w,x;for(w=new c(255,255,255,1),l=g.length,k=0;l>k;++k){for(p=b.getRow(d+k),o=g[k].length,n=0;o>n;++n)s=f.qLeft+n,r=g[k][n],q=p.getCell(e+n),m=h(s,a),q.isOtherCell=r.qIsOtherCell,q.isTotalCell=r.qIsTotalCell,q.value=q.isOtherCell?m.othersLabel:r.qText,q.locked=m.qLocked,q.dataValue=r.qElemNumber,q.dataColIx=s,q.dataRowIx=i?f.qTop+f.qHeight-k-1:f.qTop+k,q.isNumeric=!isNaN(r.qNum),q.isDimensionValue=j(m),q.isNullValue=q.isDimensionValue?-2===q.dataValue:r.qIsNull,q.selected=!1,q.selectedHighlighted=!1,q.rowspan=1,q.colspan=q.isDimensionValue?2:1,q.style.backgroundColor="",q.color.bgByExpression=!1,q.color.bgIsDark=!1,!q.isNullValue&&r.qAttrExps&&r.qAttrExps.qValues&&r.qAttrExps.qValues.length&&(u="NaN"!==r.qAttrExps.qValues[0].qNum?r.qAttrExps.qValues[0].qNum:r.qAttrExps.qValues[0].qText,t=new c(u,"argb"),t.isInvalid()||(q.color.bgByExpression=!0,q.style.backgroundColor=t.toRGBA(),q.color.bgIsDark=t.isDark(),x=c.getBlend(w,new c(t._r,t._g,t._b,1),t._a),q.color.fadeFromColor=new c(x._r,x._g,x._b,0).toRGBA(),q.color.fadeToColor=x.toRGBA(),1===b.headerRows.length&&(v=b.getHeaderRow(0).cells.filter(function(a){return a.dataColIx===q.dataColIx})[0],v.color.bgIsDark=t.isDark()))),q.style.color="",r.qAttrExps&&r.qAttrExps.qValues&&r.qAttrExps.qValues.length>1&&(u="NaN"!==r.qAttrExps.qValues[1].qNum?r.qAttrExps.qValues[1].qNum:r.qAttrExps.qValues[1].qText,t=new c(u,"argb"),t.isInvalid()||(q.style.color=t.toRGBA()));p.setNextCellIx(e+n)}b.setNextRowIx(d+k)}function B(a,b){var c,d,e,f,g;c=a.getHeaderRow(0),b.dataColumnsInfo.cnt>0&&b.leftCellCnt>0&&(d=c.addEmptyMetaCell(1,b.leftCellCnt,"left"),d.addClass("top-meta")),b.dataColumnsInfo.cnt>0&&(e=c.addEmptyMetaCell(1,b.dataColumnsInfo.cnt),e.addClass("top-meta").addClass("meta"),e.templateSrc="pt-meta-top.ng.html"),b.leftCellCnt>0&&(f=a.getHeaderRow(1),g=f.addEmptyMetaCell(a.topTreeDepth,b.leftCellCnt),g.addClass("left-meta").addClass("meta"),g.templateSrc="pt-meta-left.ng.html",a.topTreeDepth<=0&&f.addEmptyHeaderCell(1,b.dataColumnsInfo.cnt,"left")),a.setNextHeaderIx(Math.max(2,a.topTreeDepth+1))
}function C(a,b){return b.length?C(a+1,b[0].qSubNodes):a}function D(a,c){function d(){return c.qHyperCube.qMeasureInfo.length>0&&c.qHyperCube.qGrandTotalRow.length>0}function e(){return d()&&c.totals&&(c.totals.show||"noTotals"!==c.totals.position)}function f(){return e()&&c.totals&&!c.totals.show&&"bottom"===c.totals.position?!1:!0}var g,h,j,k,l,m=a.headerRows[0].getCellSize();if(e()&&f())h=a.getNextHeaderRow();else{if(!e())return;h=a.getNextFooterRow()}for(g=0;m>g;++g)l=a.getHeaderCell(0,g),f()&&l.isSearchIcon||(k=h.getNextCell(),k.tid=l.isSearchIcon?"st.total.search":"st.total",k.colIx=g,k.style={},k.colspan=f()&&l.isDimension?2:1,k.isDimension=!f()&&l.isDimension,k.isMeasure=l.isMeasure,f()||(k.style.width=l.style.width),l.isMeasure?(j=i(l.dataColIx,c),k.value=j.qText,k.isNumeric=!0):(k.value=0===g?void 0!==c.totals.label?c.totals.label:b.get("Object.Table.Totals"):"",k.isNumeric=!1),k.isTotal=!0)}function E(a,b){var c,d,e,f=b.length;for(d=a.getNextHeaderRow(),c=0;f>c;++c)e=d.getNextCell(),e.setFromMetaHeader(b[c])}function F(a,b){a.tid="st.header",a.qvaOutsideIgnoreFor="",a.isSearchIcon=!1,a.open=!1,a.isNumeric="N"===a.info.qDimensionType||void 0===a.info.qDimensionType,a.locked=a.info.qLocked,a.value=a.info.qFallbackTitle,a.canCollapse=!1,a.canExpand=!1,a.sortable=!0,a.rowspan=1,a.colspan=1,a.dataColIx=a.qLeft,a.isDimension=!!a.info.qDimensionType,a.fieldName=a.isDimension?a.info.qGroupFieldDefs[a.info.qGroupPos]:"",a.isMeasure=!a.isDimension,a.isSorted=a.dataColIx===b[0],a.reversed=!!a.info.qReverseSort,a.sortIndicator=a.info.qSortIndicator,a.style={},a.color={}}function G(a,b,c){function d(a){return z>a?y[a]:A[a-z]}var e,f,g,h,j,k,l,m,n,o,p,q=b.width-b.columnPicker.width,r=b.column.minWidth,s=b.column.minSearchWidth,t=b.column.glyphWidth,u=b.column.maxMeasureWidth,v=a.qHyperCube,w=v.columnOrder,x=w.length,y=v.qDimensionInfo,z=y.length,A=v.qMeasureInfo,B=r/q,C=24,D=C/q,E=s/q,G=0,H=14,I=[],J=[],K=Math.floor(q/t),L=Math.ceil(r/t),M=Math.ceil(C/t),N=Math.ceil(H/t),O=1,P=Math.floor(Math.min(q,u)/t)-N;for(b.columnPicker.show=!1,e=0;x>e&&K>0&&(k=d(w[e]),j=0,o=w[e]>=z,l=k.qApprMaxGlyphCount,o?(p=i(w[e],a),n=Math.min(p.qText.length,P),l=Math.min(l,P),m=Math.max(M,l,k.qFallbackTitle.length,n)):(m=L,j=Math.ceil(s/t)),m+=N,!(0>K-m&&0===I.length&&o))&&!(0>K-m&&I.length>0);++e)K-=m,h={info:k,isDimension:w[e]<z,isMeasure:o,grandTotal:p,qLeft:w[e],apprMaxGlyphCnt:l,calcApprMaxGlyphCnt:m,searchGlyphCnt:j},F(h,v.qEffectiveInterColumnSortOrder),I.push(h);for(b.columnCount=e,b.columnPicker.show=x>e,e=0,x=I.length;x>e;++e)h=I[e],h.isDimension?(h.bestFitWidthFactor=h.apprMaxGlyphCnt*t/q,h.widthFactor=B,J.push(h)):(h.bestFitWidthFactor=h.calcApprMaxGlyphCnt*t/q,h.widthFactor=Math.max(D,h.bestFitWidthFactor)),h.widthFactor+=H/q,O-=h.widthFactor;if(O>0){for(J.sort(function(a,b){return a.apprMaxGlyphCnt<b.apprMaxGlyphCnt}),e=0,f=J.length;f>e&&(h=J[e],g=0,h.bestFitWidthFactor>h.widthFactor&&(g=Math.max(0,Math.min(O,h.bestFitWidthFactor-h.widthFactor)),h.widthFactor+=g),!(0>=O));++e)O-=g;if(O>0)for(e=0;x>e;++e)h=I[e],h.widthFactor+=O/x}for(e=0,x=I.length;G+x>e;++e)h=I[e],h.isDimension?(I.splice(e+1,0,{isSearchIcon:!0,qvaOutsideIgnoreFor:"qv-st-header-cell-search-"+c,tid:"st.header.search",widthFactor:E,style:{width:100*E+"%"},fieldName:h.fieldName,dataColIx:h.dataColIx,colspan:1}),h.widthFactor-=E,h.style.width=100*h.widthFactor+"%",++G):h.style.width=100*h.widthFactor+"%";return I}return a.service("qvGridObjectDataService",function(){return{getTopTreeDepth:function(a){return C(0,a.qTop)},getLeftTreeDepth:function(a){return C(0,a.qLeft)},updatePivotItems:function(a,b,c,d){var e=a.layout,f=a.grid,g=b[0].qTop,h=b[0].qLeft,i=b[0].qData,j=C(0,g),k=C(0,h),m=c[0],n=a.metaGhostHeaders,o=e.qHyperCube.qIndentMode,p=this.getPseudoDimIndex(e);f.reset(!1,d,p,o),f.setTopTreeDepth(j),f.setLeftTreeDepth(k),B(f,n),l(f,g,m.qLeft,n),x(f,h,m.qTop,n),z(f,i,m.qTop,m.qLeft),f.removeUnused()},updateStraightItems:function(a,b,c,d,e,f){var g,h=a.layout,i=a.grid,j=0,k=Math.min(b.length,a.scrollApi.settings.columnCount);for(d||i.reset(f),f||(E(i,c),D(i,h)),j=i.getNextRowIx(),g=0;k>g;++g)0!==b[g].length&&A(h,i,j,g,b[g].qArea,b[g].qMatrix,e);d&&i.setNextRowIx(i.rows.length),i.removeUnused()},getPseudoDimIndex:function(a){var b=a.qHyperCube.qEffectiveInterColumnSortOrder.indexOf(-1);return~b?b:a.qHyperCube.qEffectiveInterColumnSortOrder.length},getColumnInfo:h,getColumnCells:e,getCellsInColumnWithValue:f,getCellInColumnWithRowIndex:g,columnOrder:{get:d},getStraightMetaHeaders:G}})}),define("extensions.qliktech/straight-table/snapshot/snapshot-helper",["jquery"],function(a){function b(b,c){for(var d,e,f=c.top+c.height,g=0;g<b.length;){if(a(b[g]).offset().top+a(b[g]).height()>c.top){d=b[g];break}g++}for(g=b.length-1;g>=0;){if(a(b[g]).offset().top<f){e=b[g];break}g--}if(!d||!e||0>j)return{index:1,height:1,width:1};var h=a(d).scope().row.getIndex(),i=a(e).scope().row.getIndex(),j=g;return{index:h,height:i-h+1,width:j+1}}function c(a){if(!a.layout.snapshotData||a.layout.snapshotData.object.freeResize)return void delete a.dataTableHeight;var b=a.object.objectSize.h,c=b/a.layout.snapshotData.object.size.h,d=a.layout.snapshotData.object.dataTableHeight;a.dataTableHeight={height:d*c+"px","max-height":60*c+"px"}}return{scaleDynamically:c,getIndexHeightAndWidth:b}}),define("general.scroll/api/dom-api",["core.utils/class","touche"],function(a,b){function c(){return".grid-object-dom-api-"+ ++e}var d,e=0;return d=a.extend({init:function(a,b,d,e,f){f=f||".scroll-content",this.$element=a,this.$scrollArea=b,this.$scrollContent=b.find(f),this.firstRowSelector=d,this.lastRowSelector=e,this.namespace=c()},destroy:function(){this.unbindNativeScroll()},bindNativeScroll:function(a){this.$scrollArea.on("scroll"+this.namespace,a)},unbindNativeScroll:function(){this.$scrollArea.off(this.namespace)},resetNativeScroll:function(){this.$scrollArea.scrollTop(0)},preventNativeScroll:function(){var a="mousewheel"+this.namespace+" DOMMouseScroll"+this.namespace+" mousemove"+this.namespace;return this.$scrollArea.on(a,function(a){a.preventDefault()}),b(this.$scrollArea[0]).tap({id:this.namespace}),function(){this.$scrollArea.off(a),b(this.$scrollArea[0]).off("tap",this.namespace)}.bind(this)},getBoundingBox:function(){return this.$element[0].getBoundingClientRect()},getClientWidth:function(){return this.$element[0].clientWidth},getClientHeight:function(){return this.$element[0].clientHeight},getScrollAreaBoundingBox:function(){return this.$scrollArea[0].getBoundingClientRect()},getScrollAreaClientWidth:function(){return this.$scrollArea[0].clientWidth},getScrollAreaClientHeight:function(){return this.$scrollArea[0].clientHeight},getScrollAreaOffsetTop:function(){return this.$scrollArea[0].offsetTop},getScrollContentBoundingBox:function(){return this.$scrollContent[0].getBoundingClientRect()},getFirstRow:function(){return this.$scrollArea.find(this.firstRowSelector)},getLastRow:function(){return this.$scrollArea.find(this.lastRowSelector)},alignToFirstRow:function(){var a=this.getFirstRow(),b=48;return function(){var c=a.position().top-b;this.$scrollArea.scrollTop(c)}.bind(this)},alignToLastRow:function(){var a=this.getLastRow(),b=48;return function(){this.$scrollArea.scrollTop(0);var c=a.position().top-this.getScrollAreaBoundingBox().height+a[0].getBoundingClientRect().height+b;this.$scrollArea.scrollTop(c)}.bind(this)}})}),define("general.scroll/api/data-api",["core.utils/deferred","core.utils/class"],function(a,b){var c;return c=b.extend({getRowCount:function(){return 0},getFirstElementIndex:function(){return-1},getLastElementIndex:function(){return-1},getIndexOf:function(a){return a.getIndex()},onVirtualScroll:function(){return a.resolve()},onGotoNextBlock:function(){return a.resolve()},onGotoPreviousBlock:function(){return a.resolve()},onInitialNativeScroll:function(){return a.resolve()}})}),define("general.scroll/loader/loader",["qvangular","core.utils/deferred"],function(a,b){a.directive("qvScrollLoader",["$animate","$timeout",function(a,c){return{restrict:"E",replace:!0,template:function(a,b){var c=b.tag||"div";return"<"+c+' ng-style="loaderStyle" class="qv-scroll-loader qv-animate"><qv-rain ng-if="showRain" show="showRain"></qv-rain></'+c+">"},scope:{},controller:function(){},link:function(d,e,f,g){function h(a,b){d.loaderStyle.top=a,d.loaderStyle.width=b.width,d.loaderStyle.height=b.height}var i,j=!!f.noRain;d.loaderStyle={width:0,height:0},d.showRain=!1,g.fadeIn=function(f,g){var k=b();return h(f,g),j||(i=c(function(){d.showRain=!0})),a.addClass(e,"fade",function(){k.resolve()}),k.promise},g.fadeOut=function(){var c=b();return d.showRain=!1,a.removeClass(e,"fade",function(){d.loaderStyle.width=0,d.loaderStyle.height=0,d.$digest(),c.resolve()}),c.promise},d.$on("$destroy",function(){c.cancel(i)})}}}])}),define("text!general.scroll/loader/load-button.ng.html",[],function(){return'<div class="qv-scroll-data-load-buttons" ng-class="{ previous: previous }">\r\n	<div ng-transclude></div>\r\n	<button class="qui-outlinebutton" qva-activate="load()">\r\n		<p q-translation="{{text}}"></p>\r\n	</button>\r\n</div>'}),define("general.scroll/loader/load-button",["qvangular","text!./load-button.ng.html"],function(a,b){a.directive("qvScrollLoadButton",[function(){return{restrict:"E",transclude:!0,replace:!0,template:function(a,c){var d=c.tag||"div";return b.replace(/^\s*<div/,"<"+d).replace(/<\/div>\s*$/,"</"+d+">")},scope:{onLoad:"&",text:"@",previous:"="},link:function(a){a.load=function(){a.onLoad()}}}}])}),define("general.scroll/api/vertical-scroll-api",["core.utils/class","core.utils/notification","util","general.utils/support","general.scroll/api/dom-api","general.scroll/api/data-api","general.scroll/scroll-area-controller","general.scroll/loader/loader","general.scroll/loader/load-button","general.scroll/scroll-area"],function(a,b,c,d,e,f,g){var h;return h=a.extend({destroy:function(){this.$timeout.cancel(this.initPromise),this.$timeout.cancel(this.setVirtualSizePromise),this.unpreventNativeScroll&&this.unpreventNativeScroll(),this.domApi.destroy()},init:function(a,e){b.create(this,"Scroll"),this.$timeout=a,this.initPromise=null,this.setVirtualSizePromise=null,this.virtualScrollEnabled=void 0!==e.virtualScrollEnabled?e.virtualScrollEnabled:d.treatAsDesktop(),this.loaderStyle={width:0,height:0},this.totalRows=0,this.totalColumns=0,this.alignBottom=!1,this.alignRight=!1,this.ignoreScroll=!1,this.loadNext=!1,this.loadPrevious=!1,this.settings=c.extend(!0,{minRowHeight:21,minColumnWidth:30,viewportRowCount:0,viewportColumnCount:0,width:0,height:0,blockSize:100,keepItemsCount:10},e)},initialize:function(a,b,c,d){if(!(a instanceof e))throw"Must provide an instance of domApi";if(!(b instanceof f))throw"Must provide an instance of dataApi";if(!(c instanceof g[4]))throw"Must provide an instance of ScrollAreaController";if(!d||"function"!=typeof d.fadeIn||"function"!=typeof d.fadeOut)throw"Must provide valid loader api";return this.initPromise?this.initPromise:(this.domApi=a,this.dataApi=b,this.virtualScrollApi=c,this.loaderApi=d,this.initPromise=this.$timeout(function(){this.onInit(),this.onInitVirtualScroll(),this.bindNativeScroll()}.bind(this)),this.initPromise)},onInit:function(){this.updateViewport()},onInitVirtualScroll:function(){this.virtualScrollApi.onScroll(this.onVirtualScroll.bind(this)),this.virtualScrollApi.getScrollAmount=this.getVirtualScrollAmount.bind(this)},bindNativeScroll:function(){this.domApi.bindNativeScroll(this.onNativeScroll.bind(this))},activate:function(){this.virtualScrollEnabled&&this.virtualScrollApi.on(),this.unpreventNativeScroll&&(this.unpreventNativeScroll(),this.unpreventNativeScroll=null)},deactivate:function(){this.unpreventNativeScroll=this.domApi.preventNativeScroll(),this.virtualScrollApi.off()},updateViewport:function(){var a=this.domApi.getBoundingBox();this.settings.width=a.width,this.settings.height=a.height,this.settings.viewportRowCount=Math.ceil(this.settings.height/this.settings.minRowHeight),this.settings.viewportColumnCount=Math.ceil(this.settings.width/this.settings.minColumnWidth)},setTotalRows:function(a){this.totalRows=a},setTotalColumns:function(a){this.totalColumns=a},getSpliceArgs:function(){var a=this.dataApi.getRowCount(),b=this.settings.viewportRowCount,c=this.settings.keepItemsCount,d=a-b-c;return[0,d]},onSetVirtualSize:function(a){var b,c,d,e=this.domApi.getScrollAreaBoundingBox(),f=this.virtualScrollApi.getVirtualPosition(),g=this.settings.minColumnWidth*this.totalColumns,h=this.settings.minRowHeight*this.totalRows;this.dataApi.getRowCount()===this.totalRows&&(h=this.domApi.getScrollContentBoundingBox().height),b={width:g,height:h},c={width:e.width,height:e.height},d={top:0,left:0,width:e.width,height:e.height},this.virtualScrollApi.setVirtualSize(b,c,d),a&&this.virtualScrollApi.scroll(f.vPosX,f.vPosY,!0)},setVirtualSize:function(a){if(this.virtualScrollEnabled){var b=this.setVirtualSizePromise=this.$timeout(function(){this.onSetVirtualSize(a),this.updateAlignBottom()}.bind(this));return b}},getVirtualScrollAmount:function(a,b,c){var d=this.virtualScrollApi.getVirtualPosition(),e=this.virtualScrollApi.getMaxPosition();if(this.alignBottom&&0>b)return{deltaX:a,deltaY:b};switch(c){case 1:return{deltaX:0,deltaY:this.settings.minRowHeight*b};case 2:return{deltaX:0,deltaY:this.settings.viewportRowCount*this.settings.minRowHeight*b};case 10:return{deltaX:0,deltaY:b>0?d.vPosY*b:d.vPosY-e.vPosY};default:return{deltaX:a,deltaY:b}}},onVirtualScroll:function(a,b){this.Scroll.emit();var c=this.virtualScrollApi.getVirtualPosition(),d=Math.floor(c.vPosY/this.settings.minRowHeight),e=this.settings.viewportRowCount,f=Math.floor(c.vPosX/this.settings.minColumnWidth),g=this.settings.viewportColumnCount;return d>0&&d+e>this.totalRows&&(d=Math.max(0,this.totalRows-e),e=Math.min(this.totalRows,e)),this.dataApi.onVirtualScroll(d,e,f,g,a,b).then(function(){this.updateAlignBottom(),this.updateAlignRight()}.bind(this))},updateAlignBottom:function(){var a=this.virtualScrollApi.getVirtualPosition(),b=this.virtualScrollApi.getMaxPosition();this.alignBottom=this.virtualScrollApi.isVerticalScrollEnabled()&&a.vPosY===b.vPosY?!0:!1},updateAlignRight:function(){var a=this.virtualScrollApi.getVirtualPosition(),b=this.virtualScrollApi.getMaxPosition();this.alignRight=this.virtualScrollApi.isVerticalScrollEnabled()&&a.vPosX===b.vPosX?!0:!1},updateLoadingButtons:function(){var a=this.dataApi.getFirstElementIndex(),b=this.dataApi.getRowCount();this.loadNext=a+b+1>=this.totalRows?!1:!0,this.loadPrevious=a>0?!0:!1},resetNativeScroll:function(){return this.ignoreScroll=!0,this.loadNext=!1,this.loadPrevious=!1,this.domApi.resetNativeScroll(),function(){this.ignoreScroll=!1}.bind(this)},onNativeScroll:function(){if(this.Scroll.emit(),!this.ignoreScroll){var a=this.dataApi.getLastElementIndex()+1,b=this.settings.blockSize-a;this.ignoreScroll=!0,this.dataApi.onInitialNativeScroll(a,b).then(function(){this.updateLoadingButtons()}.bind(this))}},gotoNextBlock:function(){this.loaderApi.fadeIn(this.domApi.getScrollAreaOffsetTop(),this.domApi.getScrollAreaBoundingBox()).then(function(){var a=this.domApi.alignToLastRow(),b=this.dataApi.getLastElementIndex()+1,c=this.settings.blockSize-this.settings.keepItemsCount;this.dataApi.onGotoNextBlock(b,c).then(function(){this.updateLoadingButtons(),this.$timeout(function(){a(),this.$timeout(function(){this.loaderApi.fadeOut()}.bind(this))}.bind(this))}.bind(this))}.bind(this))},gotoPreviousBlock:function(){this.loaderApi.fadeIn(this.domApi.getScrollAreaOffsetTop(),this.domApi.getScrollAreaBoundingBox()).then(function(){var a=this.domApi.alignToFirstRow(),b=this.settings.blockSize-this.settings.keepItemsCount,c=this.dataApi.getFirstElementIndex()-b;0>c&&(b+=c,c=0),this.dataApi.onGotoPreviousBlock(c,b).then(function(){this.updateLoadingButtons(),this.$timeout(function(){a(),this.$timeout(function(){this.loaderApi.fadeOut()}.bind(this))}.bind(this))}.bind(this))}.bind(this))}})}),define("objects.grid/data-grid",["core.utils/class"],function(a){var b,c,d,e,f,g,h;return c=a.extend("ClassList",{init:function(){this.classList=[]},addClass:function(a){if(a){var b=this.classList.indexOf(a);return-1===b&&this.classList.push(a),this}},removeClass:function(a){if(a){var b=this.classList.indexOf(a);return-1!==b&&this.classList.splice(b,1),this}},hasClass:function(a){return-1!==this.classList.indexOf(a)}}),d=c.extend("Cell",{init:function(){this._super.apply(this,arguments),this.color={},this.style={},this.setDefaults()},setDefaults:function(){this.classList.length=0,this.style={},this.colspan=1,this.rowspan=1,this.text="",this.dataValue=-1,this.dataValue=-1,this.dataColIx=-1,this.dataRowIx=-1,this.tid="",this.fieldName=""},setData:function(a,b,c,d,e){this.text=a,this.rowspan=b||1,this.colspan=c||1,this.dataRowIx=d||-1,this.dataColIx=e||-1},setHeader:function(a,b,c,d,e,f){this.text=a,this.dataValue=b,this.rowspan=c||1,this.colspan=d||1,this.dataRowIx=e,this.dataColIx=f,this.templateSrc="pt-header-cell-item.ng.html",this.addClass("header")},setTopHeader:function(){this.setHeader.apply(this,arguments),this.addClass("top")},setLeftHeader:function(){this.setHeader.apply(this,arguments),this.addClass("left")},setFromMetaHeader:function(a){Object.keys(a).forEach(function(b){this[b]=a[b]},this)}}),f=d.extend("StraightCell",{setDefaults:function(){this._super.apply(this,arguments),this.isNumeric=!1,this.color.bgByExpression=!1,this.color.bgIsDark=!1,this.locked=!1,this.isNullValue=!1,this.selected=!1,this.selectedHighlighted=!1,this.qvaOutsideIgnoreFor="",this.isSearchIcon=!1,this.open=!1,this.sortable=!1,this.isDimensionValue=!1,this.isMeasure=!1,this.isSorted=!1,this.reversed=!1,this.isTotal=!1}}),g=d.extend("PivotCell",{setDefaults:function(){this._super.apply(this,arguments),this.templateSrc=null,this.collapseExpandClass="",this.isMeta=!1},setCollapseExpandClass:function(a){a.qCanExpand?(this.collapseExpandClass="icon-add",this.addClass("parent")):a.qCanCollapse&&(this.collapseExpandClass="icon-remove",this.addClass("parent"))},setEmpty:function(a,b,c){this.setHeader("",-4,a,b),this.addClass("empty"),this.addClass(c)}}),e=c.extend("Row",{init:function(a){this._super.apply(this,arguments),this.cells=[],this.style={},this.isBold=!1,this.classList=[],this.gridType=a,this.reset()},getIndex:function(){var a,b;for(b=0;b<this.cells.length;++b)if(a=this.cells[b],a.dataRowIx>=0)return a.dataRowIx;return-1},setNextCellIx:function(a){this.nextCellIx=a},reset:function(a){var b;for(this.nextCellIx=0,this.isBold=!1,a||(this.classList=[]),b=0;b<this.cells.length;++b)this.cells[b].setDefaults()},removeUnused:function(){this.cells.splice(this.nextCellIx,this.cells.length-this.nextCellIx)},_createCell:function(){switch(this.gridType){case"pivot":return new g;default:return new f}},getCell:function(a){return this.cells[a]||(this.cells[a]=this._createCell()),this.cells[a]},getNextCell:function(){var a;return this.cells[this.nextCellIx]?(a=this.cells[this.nextCellIx],a.setDefaults()):a=this.cells[this.nextCellIx]=this._createCell(),this.nextCellIx++,a},getCellSize:function(){return this.nextCellIx},addEmptyHeaderCell:function(a,b,c){var d=this.getNextCell();return d.setEmpty(a,b,c),d},addEmptyMetaCell:function(a,b,c){var d=this.addEmptyHeaderCell(a,b,c);return d.isMeta=!0,d},addEmptyDataCell:function(a,b){var c=this.getNextCell();return c.setData("",-4,a,b),c.addClass("empty"),c},addTotalCell:function(a,b,c){var d=this.getNextCell();return d.setHeader(a,-1,b,c),d.addClass("bold"),this.addClass("bold"),d},addLeftCollapseExpandCell:function(a,b,c){var d=this.getNextCell();d.setLeftHeader("",-1,1,1,a,b),d.setCollapseExpandClass(c)}}),h=a.extend("RowList",{init:function(a){this.rows=[],this.gridType=a},reset:function(a){this.rows.forEach(function(b){b.reset(a)}),this.nextRowIx=0},get:function(a){return this.rows[a]||(this.rows[a]=new e(this.gridType)),this.rows[a]},getNext:function(){var a=this.get(this.nextRowIx);return this.nextRowIx++,a},removeUnused:function(){this.rows.splice(this.nextRowIx,this.rows.length-this.nextRowIx),this.rows.forEach(function(a){a.removeUnused()})},setNextRowIx:function(a){this.nextRowIx=a}}),b=a.extend("DataGrid",{init:function(a){this.headerList=new h(a),this.rowList=new h(a),this.footerList=new h(a),this.gridType=a,this.reset()},setTopTreeDepth:function(a){this.topTreeDepth=a},setLeftTreeDepth:function(a){this.leftTreeDepth=a},reset:function(a,b){this.rowList.reset(),a||(this.headerList.reset(b),this.footerList.reset(b)),this.topTreeDepth=-1,this.leftTreeDepth=-1},getRow:function(a){return this.rowList.get(a)},getHeaderRow:function(a){return this.headerList.get(a)},getFooterRow:function(a){return this.footerList.get(a)},getNextRow:function(){return this.rowList.getNext()},getNextHeaderRow:function(){return this.headerList.getNext()},getNextFooterRow:function(){return this.footerList.getNext()},getCell:function(a,b){return this.getRow(a).getCell(b)},getHeaderCell:function(a,b){return this.getHeaderRow(a).getCell(b)},getFooterCell:function(a,b){return this.getFooterRow(a).getCell(b)},removeUnused:function(){this.rowList.removeUnused(),this.headerList.removeUnused(),this.footerList.removeUnused()},getNextRowIx:function(){return this.rowList.nextRowIx},setNextRowIx:function(a){this.rowList.setNextRowIx(a)},setNextHeaderIx:function(a){this.headerList.setNextRowIx(a)}}),Object.defineProperties(b.prototype,{headerRows:{get:function(){return this.headerList.rows}},footerRows:{get:function(){return this.footerList.rows}},rows:{get:function(){return this.rowList.rows}}}),b}),define("objects.grid/directives/selections",["qvangular","jquery","touche"],function(a,b,c){a.directive("qvSelectionsToggleValue",["$parse",function(a){return{restrict:"A",link:function(c,d,e){var f=a(e.qvSelectionsToggleValue)(),g=f.selector,h="."+c.$id+"-toggle-value",i=f.itemKey||"cell";d.on("qv-activate"+h,g,function(a){var d=b(a.target).closest(g),f=d.scope()[i];d.length&&f&&c.$apply(function(){var b={$event:a};b[i]=d.scope()[i],c.$eval(e.qvSelectionsOnToggleValue,b)})}),c.$on("$destroy",function(){d.off(h)})}}}]),a.directive("qvSelectionsToggleDimensionValue",["$parse",function(a){return{restrict:"A",link:function(c,d,e){var f=a(e.qvSelectionsToggleDimensionValue)(),g=f.selector,h="."+c.$id+"-toggle-dimension-value",i=f.itemKey||"cell";d.on("qv-activate"+h,g,function(a){var d,f=b(a.target).closest(g),h=f.scope()[i];if(h&&h.isDimensionValue){if(h.locked)return void c.$eval(e.qvSelectionsSelectWhileLocked);d=f[0].getBoundingClientRect(),c.$apply(function(){var b={$event:a,offsetLeft:f[0].offsetLeft,width:d.width};b[i]=f.scope()[i],c.$eval(e.qvSelectionsOnToggleDimensionValue,b)})}}),c.$on("$destroy",function(){d.off(h)})}}}]),a.directive("qvSelectionsMultiselect",["$parse",function(a){return{restrict:"A",link:function(d,e,f){function g(){return c(e[0]).swipe({id:o,options:{radiusThreshold:4,preventDefault:!1},start:function(a){var e,g,h,i=b(a.target).closest(m);return c.utils.isMouse(a)&&i.length?(e=i.scope()[n],e.isDimensionValue?e.locked?(d.$eval(f.qvSelectionsSelectWhileLocked),void this.cancel()):(k=e,g=i[0].getBoundingClientRect(),h={offsetLeft:i[0].offsetLeft,width:g.width,$event:a},h[n]=e,void d.$apply(d.$eval(f.qvSelectionsStartMultiselect,h))):void this.cancel()):void this.cancel()},update:function(a){var c,e=b(a.target).closest(m);e.length&&(c=e.scope()[n],d.$apply(d.$eval(f.qvSelectionsUpdateMultiselect,{start:k,current:c,dataColIx:c.dataColIx})))},end:function(a){d.$apply(d.$eval(f.qvSelectionsEndMultiselect,{$event:a}))}}),function(){c(e[0]).off("*",o)}}function h(){return c(e[0]).tap({id:p,options:{touches:2,preventDefault:!1},end:function(a,c){var e,g=c.pagePoints[0],h=c.pagePoints[1],i=b(document.elementFromPoint(g.x,g.y)),j=b(document.elementFromPoint(h.x,h.y)),k=i.closest(m).scope()[n],l=j.closest(m).scope()[n];if(k.isDimensionValue&&l.isDimensionValue)return k.locked||l.locked?void d.$eval(f.qvSelectionsSelectWhileLocked):void d.$apply(function(){e={offsetLeft:i[0].offsetLeft,width:i[0].clientWidth,$event:a},e[n]=k,d.$eval(f.qvSelectionsStartMultiselect,e),d.$eval(f.qvSelectionsUpdateMultiselect,{start:k,current:l,dataColIx:k.dataColIx}),d.$eval(f.qvSelectionsEndMultiselect,{$event:a})})}}),function(){c(e[0]).off("*",p)}}var i,j,k,l=a(f.qvSelectionsMultiselect)(),m=l.selector,n=l.itemKey||"cell",o=d.$id+"-multiselect",p=d.$id+"-2finger-multiselect";d.$watch("interactive",function(a){void 0!==a&&(a?(i=g(),j=h()):(i&&i(),j&&j()))}),d.$on("$destroy",function(){i&&i(),j&&j()})}}}])}),define("objects.grid/services/selections",["qvangular","objects.grid/services/data-service","objects.grid/directives/selections"],function(a){a.service("qvGridObjectSelectionService",["$timeout","$document","qvGridObjectDataService",function(b,c,d){var e;return e={$new:function(){return{active:!1,currentDataColIx:-1,cols:[],values:[],rows:[],unbindKeyboard:null}},init:function(b,c,d,f,g,h){b.confirm=function(){c.endSelections(!0),b.deactivated(),e.reset(d),e.hide(d),a.$rootScope.selectionObject=null,f()},b.cancel=function(){c.endSelections(!1),b.deactivated(),e.reset(d),e.hide(d),a.$rootScope.selectionObject=null,g()},b.clear=function(){d.values.length=0,d.rows.length=0,h(),c.clearSelections()}},reset:function(a){a.cols.length=0,a.values.length=0,a.rows.length=0},show:function(a,b,c,d){c.active||(c.active=!0,c.currentDataColIx=d,c.cols=[d])},hide:function(a){a.currentDataColIx=-1,a.active=!1},bindKeyboard:function(a,b){var d=".selections-keyboard-"+b;return c.on("keyup"+d,function(b){27===b.which?a.cancel():13===b.which&&a.confirm()}),function(){c.off(d)}},selectCell:function(a,b,c,e,f,g){var h,i,j=f.dataColIx,k=f.dataRowIx,l=f.dataValue,m=d.getCellsInColumnWithValue(e,j,l);if(!f.isNullValue&&(i=b.values.indexOf(l),a.getSize().qcy!==m.length||!g||-1===i))return b.values.filter(function(a){return a!==l}).forEach(function(a){d.getCellsInColumnWithValue(e,j,a).forEach(function(a){a.selected=!0,a.selectedHighlighted=!1})}),g&&-1!==i?(b.values.splice(i,1),m.forEach(function(a){h=b.rows.indexOf(a.dataRowIx),-1!==h&&b.rows.splice(h,1),a.selected=!1,a.selectedHighlighted=!1})):-1===i?(b.values.push(l),b.rows.push(k),m.forEach(function(a){a.selected=!0}),f.selected=!1,f.selectedHighlighted=!0):g||(m.forEach(function(a){a.selected=!0,a.selectedHighlighted=!1}),f.selected=!1,f.selectedHighlighted=!0),function(){g&&-1!==i&&0===b.rows.length?c.clear():(c.selectionsMade=!0,a.select(b.rows,[f.dataColIx],"D"))}},selectDimensionValue:function(a,b,c,d,f,g,h){var i=e.activateSelections(a,b,c,d,f,g);return g.locked||e.selectCell(c,d,f,h,g,!0)(),i},activateSelections:function(a,c,d,f,g,h){return f.active||h.locked||(d.beginSelections(),e.show(g,c,f,h.dataColIx),f.unbindKeyboard=e.bindKeyboard(g,a),b(function(){g.activated(!0)})),function(){f.unbindKeyboard()}},update:function(a,b,c){if(b.values.length){d.getColumnCells(a,c).forEach(function(a){-1!==b.values.indexOf(a.dataValue)&&(a.selected=!0,a.selectedHighlighted=!1)});var e=b.values.lastElement,f=b.rows.lastElement;d.getCellsInColumnWithValue(a,b.currentDataColIx,e).forEach(function(a){f===a.dataRowIx?(a.selectedHighlighted=!0,a.selected=!1):a.selected=!0})}}}}])}),define("text!extensions.qliktech/straight-table/layout/top/straight-table-top-header.ng.html",[],function(){return'<div class="qv-st-header" tid="qv-st-header-top" ng-style="scrollApi.topBottomStyle">\r\n	<table qva-delegated-activate=".qv-st-header-sortable#interactive && !selections.active && sortHeader($event);\r\n		   .qv-st-header-cell-search:not(.qv-st-total-cell)#interactive && !selections.active && searchHeader($event)">\r\n		<tbody>\r\n			<tr ng-repeat="row in grid.headerRows">\r\n				<th ng-repeat="header in row.cells"\r\n					tid="{{header.tid}}"\r\n					class="qv-st-header-cell"\r\n					qva-outside-ignore-for="{{header.qvaOutsideIgnoreFor}}"\r\n					ng-class="{ \'qv-st-header-cell-numeric\': header.isNumeric,\r\n					\'qv-st-header-sortable\': header.sortable,\r\n					\'qv-st-total-cell\': header.isTotal,\r\n					\'qv-st-header-cell-dimension\': header.isDimension,\r\n					\'qv-st-header-cell-search\': header.isSearchIcon,\r\n					\'qv-st-header-cell-search-open\': header.isSearchIcon && header.open }"\r\n					ng-style="header.style"\r\n					colspan="{{header.colspan}}">\r\n					<qv-straight-table-header-cell ng-if="!header.isSearchIcon"></qv-straight-table-header-cell>\r\n					<qv-straight-table-header-cell-search ng-if="!header.isTotal && header.isSearchIcon"></qv-straight-table-header-cell-search>\r\n				</th>\r\n			</tr>\r\n		</tbody>\r\n	</table>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/top/straight-table-top-header",["qvangular","jquery","text!./straight-table-top-header.ng.html"],function(a,b,c){a.directive("qvStraightTableTopHeader",function(){return{restrict:"E",replace:!0,template:c,link:function(a,c,d){a.sortHeader=function(c){a.$eval(d.onSortHeader,{header:b(c.target).scope().header})},a.searchHeader=function(c){var e=b(c.target).closest(".qv-st-header-cell"),f=e.scope().header;c.preventDefault(),a.$eval(d.onSearch,{$alignTo:e,header:f})}}}})}),define("text!extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell.ng.html",[],function(){return'<div class="qv-st-header-cell-wrapper">\r\n	<div class="qv-st-fade-out"\r\n		 ng-class="{ \'qv-st-header-selections-active\': header.selectionsActive }" title="{{header.value}}">\r\n		<i ng-class="{\'icon-toolbar-locked\': header.locked }"></i><span>{{header.value}}</span>\r\n	</div>\r\n	<i ng-if="header.isSorted && header.sortIndicator !== \'N\'"\r\n		class="qv-st-sorting-indicator"\r\n		ng-class="{ \'icon-triangle-top\': header.sortIndicator === \'A\', \'icon-triangle-bottom\': header.sortIndicator === \'D\', \'icon-triangle-light\': header.color.bgIsDark && !header.reversed }"\r\n		ng-style="header.sortStyle"></i>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell",["qvangular","text!./straight-table-header-cell.ng.html"],function(a,b){a.directive("qvStraightTableHeaderCell",[function(){return{restrict:"E",replace:!0,template:b,link:function(a,b){var c=b.closest(".qv-st-header-cell");a.$watch("!header.isTotal && selections.active && selections.currentDataColIx === header.dataColIx",function(b){b&&(a.selectionsApi.getDockToElement=function(){return c})})}}}]),a.directive("qvStraightTableHeaderCellSearch",[function(){return{restrict:"E",replace:!0,template:'<i class="icon-magnifying-glass"></i>',link:function(a,b){var c=b.closest(".qv-st-header-cell");a.$watch("!header.isTotal && selections.active && selections.currentDataColIx === header.dataColIx",function(b){b&&(a.selectionsApi.getSelectionToolbarWidthOffset=function(){return c[0].getBoundingClientRect().width+1})})}}}])}),define("text!extensions.qliktech/straight-table/layout/data/straight-table-data.ng.html",[],function(){return'<div class="qv-st-data" ng-class="{ \'align-bottom\': scrollApi.alignBottom }" tid="qv-st-data">\r\n	<qv-scroll-load-button ng-show="scrollApi.loadPrevious" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true">\r\n		<qv-straight-table-highlight-column></qv-straight-table-highlight-column>\r\n	</qv-scroll-load-button>\r\n	<table ng-style="dataTableHeight">\r\n		<tbody>\r\n			<tr>\r\n				<th ng-repeat="header in grid.headerRows[0].cells"\r\n					class="qv-st-header-cell qv-st-header-cell-data"\r\n					ng-style="header.style">\r\n				</th>\r\n			</tr>\r\n			<tr ng-repeat="row in grid.rows" class="qv-st-data-row" ng-class="{ \'qv-grid-object-data-first-row\': $first, \'qv-grid-object-data-last-row\': $last }">\r\n				<td ng-repeat="cell in row.cells" class="qv-st-data-cell"\r\n					rowspan="{{ cell.rowspan }}"\r\n					colspan="{{ cell.colspan }}"\r\n					ng-style="cell.style"\r\n					ng-class="{ \'qv-st-data-cell-dimension-value\' : cell.isDimensionValue,\r\n						\'qv-st-data-cell-numeric\': cell.isNumeric,\r\n						\'qv-st-data-cell-selected\': cell.selected,\r\n						\'qv-st-data-cell-selected-highlighted\': cell.selectedHighlighted,\r\n						\'qv-st-data-cell-null-value\': cell.isNullValue,\r\n						\'qv-st-data-cell-color-dark\': cell.color.bgByExpression && !cell.color.bgIsDark,\r\n						\'qv-st-data-cell-color-light\': cell.color.bgByExpression && cell.color.bgIsDark }">\r\n					<qv-straight-table-data-cell></qv-straight-table-data-cell>\r\n				</td>\r\n			</tr>\r\n		</tbody>\r\n	</table>\r\n	<qv-scroll-loader class="qv-scroll-row-loader"></qv-scroll-loader>\r\n	<qv-scroll-load-button ng-show="scrollApi.loadNext" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\r\n	<qv-straight-table-disable-columns-left-hand-side ng-if="selections.active"></qv-straight-table-disable-columns-left-hand-side>\r\n	<qv-straight-table-disable-columns-right-hand-side ng-if="selections.active"></qv-straight-table-disable-columns-right-hand-side>\r\n</div>\r\n'
}),define("extensions.qliktech/straight-table/layout/data/straight-table-data",["qvangular","text!./straight-table-data.ng.html"],function(a,b){a.directive("qvStraightTableData",[function(){return{restrict:"E",replace:!0,template:b}}])}),define("text!extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell.ng.html",[],function(){return'<div ng-class="{ \'qv-st-fade-out\': !cell.color.bgByExpression, \'qv-st-fade-out-bgr-expr\': cell.color.bgByExpression}" title="{{cell.value}}">\r\n	{{cell.value}} <div ng-if="cell.color.bgByExpression && !cell.isNumeric" class="qv-st-fade-out-bgr-expr-overlay" ng-attr-style="background-image: linear-gradient(to right, {{cell.color.fadeFromColor}}, {{cell.color.fadeToColor}});"></div>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell",["qvangular","text!./straight-table-data-cell.ng.html"],function(a,b){a.directive("qvStraightTableDataCell",[function(){return{restrict:"E",replace:!0,template:b,link:function(){}}}])}),define("text!extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header.ng.html",[],function(){return'<div class="qv-st-bottom-header" tid="qv-st-bottom-header" ng-style="topBottomStyle">\r\n	<table>\r\n		<tbody>\r\n			<tr ng-repeat="row in grid.footerRows">\r\n				<th ng-repeat="header in row.cells"\r\n					tid="{{header.tid}}"\r\n					class="qv-st-header-cell"\r\n					ng-class="{ \'qv-st-header-cell-numeric\': header.isNumeric,\r\n					\'qv-st-header-cell-dimension\': header.isDimension,\r\n					\'qv-st-header-cell-measure\': header.isMeasure,\r\n					\'qv-st-header-cell-search\': header.isSearchIcon }"\r\n					ng-style="header.style">\r\n					<qv-straight-table-header-cell></qv-straight-table-header-cell>\r\n				</th>\r\n			</tr>\r\n		</tbody>\r\n	</table>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header",["qvangular","text!./straight-table-bottom-header.ng.html"],function(a,b){a.directive("qvStraightTableBottomHeader",function(){return{restrict:"E",replace:!0,template:b,link:function(){}}})}),define("extensions.qliktech/straight-table/selections/highlight-column",["qvangular"],function(a){a.service("qvStraightTableHighlightColumnService",function(){return{show:function(a,b,c,d,e){a.enabled=!0,a.style.left=b-1+"px",a.style.width=c-1+"px",a.dimRightStyle.left=b+c+"px",a.dimRightStyle.width=d-c-1,e>0?(a.dimRightStyle.width-=b,a.dimLeftStyle.display="block",a.dimLeftStyle.left="0px",a.dimLeftStyle.width=b+"px"):a.dimLeftStyle.display="none",a.dimRightStyle.width+="px"},hide:function(a){a.enabled=!1}}}),a.directive("qvStraightTableHighlightColumn",[function(){return{restrict:"E",replace:!0,template:'<div ng-show="highlightColumn.enabled" ng-style="highlightColumn.style" class="qv-st-highlight-column"></div>'}}]),a.directive("qvStraightTableDisableColumnsLeftHandSide",[function(){return{restrict:"E",replace:!0,template:'<div ng-show="highlightColumn.enabled" ng-style="highlightColumn.dimLeftStyle" class="qv-st-dim-columns" ng-class="{\'load-previous\': gridObject.loadPrevious, \'load-next\': scrollApi.loadNext }"></div>'}}]),a.directive("qvStraightTableDisableColumnsRightHandSide",[function(){return{restrict:"E",replace:!0,template:'<div ng-show="highlightColumn.enabled" ng-style="highlightColumn.dimRightStyle" class="qv-st-dim-columns" ng-class="{\'load-previous\': gridObject.loadPrevious, \'load-next\': scrollApi.loadNext }"></div>'}}])}),define("text!client.property-panel/property-panel.ng.html",[],function(){return'<div class="qv-property-panel">\r\n	<div ng-if="!isInvalid && isLinked" class="overlay">\r\n		<div class="overlay-content">\r\n			<div class="icon icon-link"></div>\r\n			<p class="title" q-translation="Object.Linked.NoEdit.PropPanel.Title"></p>\r\n			<p q-translation="Object.Linked.NoEdit.PropPanel.Text"></p>\r\n		</div>\r\n	</div>\r\n	<div ng-if="isInvalid" class="overlay">\r\n		<div class="overlay-content">\r\n			<p class="title" q-translation="Object.Invalid.NoEdit.PropPanel.Title"></p>\r\n			<p q-translation="Object.Invalid.NoEdit.PropPanel.Text"></p>\r\n		</div>\r\n	</div>\r\n	<div class="property-header">\r\n		<div class="header-wrapper">\r\n			<div class="type">\r\n				<i ng-show="!isInvalid" class="type-icon {{iconClass}}"></i>\r\n			</div>\r\n\r\n			<div class="title">{{title}}</div>\r\n		</div>\r\n	</div>\r\n\r\n	<div class="property-content" ng-if="!isLinked" include-pp-component x-component="rootComponent" x-args="args" x-definition="definition" x-data="data"></div>\r\n</div>'}),define("client.property-panel/component-utils",["general.utils/property-resolver","core.utils/deferred","translator"],function(a,b,c){var d={defineValue:function(b,c,d,e){function f(b){var e=a.getValue(d(),c.ref);return"undefined"==typeof e?"undefined"!=typeof c.undefinedValue?c.undefinedValue:a.getDefaultValue(b,c):e}function g(b,e,f){var g=a.getTypeValue(b,e,f);a.setValue(d(),c.ref,g)}var h,i,j;c.resolveFunctions?"object"==typeof c.resolveFunctions?(i=function(){return c.resolveFunctions.get(f,c)},j=function(a){return c.resolveFunctions.set(a,g,c)}):(i=function(){return a.resolveFunctions[c.resolveFunctions].get(f,c)},j=function(b){return a.resolveFunctions[c.resolveFunctions].set(b,g,c)}):(i=function(){return f(c.type)},j=function(b){var d=a.getDefaultValue(c.type,c);g(c.type,b,d)}),h="undefined"!=typeof e?e:"value",Object.defineProperty(b,h,{get:i,set:j})},defineExpression:function(b,c){var d=b.definition.expression,e=b.definition.expressionType,f="optional"===d||"always"===d,g=c?"qValueExpression":"qStringExpression";!e&&f&&(e=c?"ValueExpression":"StringExpression"),b.expressionType=e,b.isExpressionDefinition=f,Object.defineProperty(b,"displayValue",{get:function(){var a=b.value;return a&&"object"==typeof a&&(a=a[g].qExpr,a&&"="!==a[0]&&(a="="+a)),a},set:function(a){var c,d=f&&a&&0===a.indexOf("=");a&&d?(c={},c[g]={qExpr:a}):c=a,b.value=c}}),b.isExpression=function(){if("always"===d)return!0;if("optional"===d){var c=a.getValue(b.data,b.definition.ref);return"object"==typeof c}return!!e},b.isLocked=function(){if(f){var a=b.value;return"object"==typeof a&&(a=a[g].qExpr),!a||c&&"number"==typeof a?!1:a&&(-1!==a.indexOf("\n")||a.length>b.maxlength)}return!1}},defineChange:function(a,b){function c(){a.$emit("saveProperties",a.data)}a.change=function(){if("function"==typeof a.definition.change){var d=a.definition.change(a.data,b,a.args.properties,a.args);"object"==typeof d&&d.then?d.then(function(a){a!==!1&&c()}):d!==!1&&c()}else c()}},defineVisible:function(a,b){var c=a.definition.show;"function"==typeof c?Object.defineProperty(a,"visible",{get:function(){return c(a.data,b,a.args)}}):a.visible="boolean"==typeof c?c:!0},defineReadOnly:function(a,b){var c=a.definition.readOnly;"function"==typeof c?Object.defineProperty(a,"readOnly",{get:function(){return c(a.data,b,a.args)}}):a.readOnly="boolean"==typeof c?c:!1},defineLabel:function(a,b,d,e){return b.translation?a.label=c.get(b.translation):"function"==typeof b.label?Object.defineProperty(a,"label",{get:function(){return b.label(d(),e)}}):b.label&&(a.label=b.label),""},defineCustom:function(a,b,c){var d=a.definition[c];"function"==typeof d?Object.defineProperty(a,c,{get:function(){return d(a.data,b,a.args)}}):d&&(a[c]=d)},fillOptions:function(a,d,e,f){function g(){var c=a.options;return"function"==typeof c&&(c=a.options.call(null,d,e)),"object"==typeof c&&"function"==typeof c.then?c:b.resolve(c)}function h(a){return a.map(function(a){var b={value:a.value};return b.label=a.translation?c.get(a.translation):a.label?a.label:a.value,a.tooltipTranslation?b.tooltip=c.get(a.tooltipTranslation):a.tooltip&&(b.tooltip=a.tooltip),b})}return g().then(function(a){a=h(a),f.splice(0,f.length);for(var b=0;b<a.length;++b)f.push(a[b])})}};return d}),define("text!client.property-panel/sheet-properties/sheet-thumbnail/sheet-thumbnail.ng.html",[],function(){return'<div class="pp-component pp-media-component pp-sheet-thumbnail-component" tcl="media">\r\n	<div class="label" ng-if="label">{{label}}</div>\r\n	<div class="value">\r\n		<div class="placeholder">\r\n			<div qv-ao-thumb item="item" issheet="true" thumbprop="data" editmode="!readOnly" thumb-width="221" thumb-height="128" emitchanges="true"></div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("client.property-panel/sheet-properties/sheet-thumbnail/sheet-thumbnail",["client.property-panel/components/components","client.property-panel/component-utils","text!./sheet-thumbnail.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(a){var c=function(){return a.data};b.defineLabel(a,a.definition,c,a.args.handler),b.defineReadOnly(a,a.args.handler),a.item={qData:a.data,qMeta:{published:a.args.model.layout.qMeta.published}},a.save=function(){a.$emit("saveProperties")},a.$on("thumbnailchanged",function(){a.save()})}]};return a.addComponent("sheet-thumbnail",d),d}),define("client.property-panel/sheet-properties/sheet-properties",["client.property-panel/sheet-properties/sheet-thumbnail/sheet-thumbnail"],function(){var a={type:"items",component:"accordion",items:{sheetProps:{type:"items",translation:"properties.sheetProperties",items:{title:{type:"string",ref:"qMetaDef.title",translation:"Common.Title",change:function(a,b,c,d){var e=(a.qMetaDef.title||"").trim();return e?void 0:d.model.getProperties().then(function(b){return a.qMetaDef.title=b.qMetaDef.title,!1})}},description:{type:"string",component:"textarea",ref:"qMetaDef.description",translation:"Common.Description"},thumbnail:{translation:"properties.sheetProperties.thumbnail",type:"string",component:"sheet-thumbnail",defaultValue:""}}}}};return a}),define("general.utils/expression-validator",["core.utils/notification","core.utils/class","core.models/app"],function(a,b,c){var d={Expression:0,NumberOrExpression:1},e=b.extend("ExpressionValidator",{init:function(b,e){this.currentExpr=null,this.nextExpr=null,this.hasOutstandingCall=!1,this.app=b||c.current,this.mode=e||d.Expression,a.create(this,"Update")},onResponse:function(a){var b,c,d,e,f;if(this.hasOutstandingCall=!1,this.nextExpr)b=this.nextExpr,c=this.nextLabels,this.nextExpr=null,this.nextLabels=null,this.callEngine(b,c);else{for(b=this.currentExpr,d=!a.qErrorMsg&&0===a.qBadFieldNames.length,e=0;e<a.qBadFieldNames.length;e++)f=a.qBadFieldNames[e],f.name=b.substr(f.qFrom||0,f.qCount);this.Update.emit({valid:d,data:{error:a.qErrorMsg,bad:a.qBadFieldNames}})}},callEngine:function(a,b){var c=this;if(this.hasOutstandingCall)throw new Error("Invalid state");this.currentExpr=a,this.hasOutstandingCall=!0;var e;e=this.mode===d.NumberOrExpression?this.app.checkNumberOrExpression(a):this.app.checkExpression(a,b),e.then(function(a){c.onResponse(a)},function(){c.onResponse({qErrorMsg:"Error",qBadFieldNames:[]})})},validate:function(a,b){this.hasOutstandingCall?(this.nextExpr=a,this.nextLabels=b):this.callEngine(a,b)}});return{ExpressionValidator:e,Modes:d}}),define("text!general.components/info-popover/info-popover.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" position="position" collision="fit" on-close-view="closeView()" qv-dialog-escape="closeView()">\r\n	<span class="info-popover-message" ng:show="translationKey" q-translation="{{translationKey}}"></span>\r\n	<span class="info-popover-message" ng:show="text">{{text}}</span>\r\n</immidiate-contextual>\r\n'}),define("general.components/info-popover/info-popover",["text!./info-popover.ng.html","assets/client/dialogs/directives/escape"],function(a){var b={scope:{translationKey:"=",text:"=",alignTo:"=",position:"="},template:a,controller:["$scope",function(a){a.closeView=function(){a.destroyComponent(),a.onClose()}}]};return b}),define("text!assets/client/dialogs/expression-dialog/expression-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="expression-editor-dialog" qv-cancel="cancel()" qv-confirm="confirm()">\r\n	<div id="expression-editor-wrapper">\r\n		<section id="expression-editor-content">\r\n			<h1 class="dm-header" q-translation="{{input.title}}"></h1>\r\n			<main class="dm-main">\r\n\r\n				<div id="expression-editor-container">\r\n					<div qv-extract="resizeCounter" id="expression-editor-stage" data-help="Panel.Stage" ng-class="{ invalid: !validity.expression }">\r\n						<qv-codearea\r\n								data-show-breakpoint-gutter="false"\r\n								data-disabled="false"\r\n								data-resize-trigger="resizeCounter"\r\n								data-mode="qlikviewReloadScriptMode"\r\n								qv-codearea-code-container="codearea"\r\n								qv-codearea-exposed-context-api="codearea.contextApi"\r\n								qv-codearea-function-tip="functionTipOptions"\r\n								qv-codearea-limit="stringLimits.expression"\r\n								qv-codearea-exposed-touch-api=\'codeareaTouchApi\'\r\n\r\n								qv-codearea-help-mode="false"\r\n								qv-codearea-help-mode-options="helpModeOptions"\r\n								qv-codearea-composition-event\r\n							></qv-codearea>\r\n						<qv-codearea-touch-overlay\r\n								ng-if="enableTouchOverlay"\r\n								codearea-touch-api="codeareaTouchApi"\r\n							></qv-codearea-touch-overlay>\r\n					</div>\r\n				</div>\r\n\r\n				<div id="expression-editor-status" ng-class="info.status" >\r\n					<i ng-class="{ disabled: !info.extraErrorMsg }"\r\n						class="icon-info"\r\n						qva-activate="showErrorMessage( info.extraErrorMsg, $event )"></i>\r\n					<span translate="info.errorMsg" ng-show="info.errorMsg"></span>\r\n				</div>\r\n\r\n			</main>\r\n		</section>\r\n		<section id="expression-editor-panel" class="qribby-accordion-pp">\r\n			<section class="qribby-accordion-section">\r\n				<header class="qribby-accordion-section-header">\r\n					<h1 q-translation="Common.Fields"></h1>\r\n				</header>\r\n				<div class="qribby-accordion-section-content">\r\n\r\n					<div id="expression-editor-toolbar-table">\r\n						<label q-translation="Assets.FieldsTab.Table"></label>\r\n						<qui-select\r\n							id="expression-dialog-fields-tab-select-field"\r\n							qui-model="controller.selectedTable"\r\n							qui-options="table for table in controller.tableNames">\r\n						</qui-select>\r\n					</div>\r\n\r\n					<div id="expression-editor-toolbar-field">\r\n						<label q-translation="Common.Field"></label>\r\n						<qui-select\r\n							id="expression-dialog-functions-common-select-field"\r\n							qui-model="controller.selectedField"\r\n							qui-options="field for field in controller.fieldNames">\r\n						</qui-select>\r\n					</div>\r\n\r\n					<div id="expression-editor-toolbar-functions">\r\n						<qui-select id="expression-dialog-fields-tab-select-aggregation" qui-model="controller.selectedCommonFunction">\r\n							<option q-translation="ExpressionEditor.FieldsTab.SelectAggregationHint" value=""></option>\r\n							<option ng-repeat="func in controller.commonFunctions" value="{{func}}">{{func}}</option>\r\n						</qui-select>\r\n					</div>\r\n\r\n					<div id="expression-editor-toolbar-insert">\r\n						<qui-button\r\n							outline\r\n							ng-disabled="!controller.previewText()"\r\n							type="button"\r\n							qva-activate="insertTextHandler($event)"\r\n							q-title-translation="Tooltip.ExpressionEditor.InsertExpression">\r\n							<span q-translation="ExpressionEditor.Insert"></span>\r\n						</qui-button>\r\n					</div>\r\n				</div>\r\n			</section>\r\n		</section>\r\n	</div>\r\n	<qv-confirm-cancel-footer qv-confirm="confirm()" qv-cancel="cancel()" qv-confirm-label="Common.Apply"></qv-confirm-cancel-footer>\r\n</qv-modal-dialog>\r\n'}),define("assets/client/dialogs/expression-dialog/expression-dialog-controller",["util"],function(a){function b(){return["Sum","Count","Avg","Min","Max"]}function c(){var b;return b=this.selectedField||"",b=a.escapeField(b),this.selectedCommonFunction?this.selectedCommonFunction+"("+b+")":b}function d(a){return a.map(function(a){return a.qName})}function e(a,b){return a.filter(function(a){return-1!==a.qSrcTables.indexOf(b)})}function f(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())}function g(a){var b,c,d=[];for(b=0;b<a.length;++b)for(c=0;c<a[b].qSrcTables.length;++c)-1===d.indexOf(a[b].qSrcTables[c])&&d.push(a[b].qSrcTables[c]);return d.sort(f),d}function h(a,b,c){c!==a.allTablesText&&(b=e(b,c)),a.fieldNames=d(b),i(a)}function i(a){-1===a.fieldNames.indexOf(a.selectedField)&&(a.selectedField=a.fieldNames[0])}function j(a){var e=a.translator,f=a.fields.slice();f.sort(function(a,b){return a.qName.toLowerCase().localeCompare(b.qName.toLowerCase())});var j=e.get("Common.All.Tables"),k={allTablesText:j,commonFunctions:b(),selectedCommonFunction:"",setTableFilter:function(a){h(k,f,a)},selectedTable:j,tableNames:[j].concat(g(f)),fieldNames:d(f),selectedField:"",previewText:c};return i(k),k}return{create:j}}),define("assets/client/dialogs/expression-dialog/expression-validation-info",[],function(){function a(a,b){if(a.status=b.valid?e:f,a.errorMsg=b.valid?"Common.OK":"Expression.Validation.InvalidExpression",a.extraErrorMsg="",b.data)if(b.data.bad.length>0){var c=b.data.bad.map(function(a){return a.name});a.errorMsg={id:"Expression.Validation.BadFieldName",value:[c.join(", ")]}}else b.data.error&&(a.extraErrorMsg=b.data.error)}function b(a,b,c,e){""!==c.replace(/\s+/g,"")?(a.status=d,b.validate(c,e)):(a.status=f,a.errorMsg="",a.extraErrorMsg="")}function c(c){var e=c.validator,f={errorMsg:"",extraErrorMsg:"",status:d,setExpr:function(a){b(f,e,a,c.labels)}};return e.Update.bind(function(b){a(f,b)}),f}var d="validating",e="valid",f="invalid";return{create:c}}),define("client.services/validation",[],function(){function a(a){return a.replace(/^=+/,"")}function b(a,b){return a.validity.name=!!a.name&&!!a.name.trim()&&a.name.length<=b.name,a.validity.description=a.description.length<=b.description,a.validity.name&&a.validity.description}function c(b,c){var d=b.expression,e="string"==typeof d&&d.trim().length>0&&d.length<=c.expression;return d&&(b.expression=a(d)),b.validity.expression=e,e}function d(a){var b=a.selectedFields,c=!1;return b?("single"===a.type?c=1===b.length:"drilldown"===a.type&&(c=b.length>1),a.validity.selectedFields=c,c):!1}return{validateMetadata:b,validateExpr:c,validateFieldsInDimension:d}}),define("text!general.components/function-tip-view/function-tip-view.html",[],function(){return"<qui-float qui-offset=\"offset\" qui-resize-on-change=\"content\">\r\n	<div class='qv-function-tip-view' ng-show='content'>{{content}}</div>\r\n</qui-float>\r\n"}),define("general.components/function-tip-view/function-tip-view",["text!./function-tip-view.html"],function(a){return{scope:{offset:"=",content:"="},template:a,controller:[function(){}]}}),define("lz-string",[],function(){var a={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(b){if(null==b)return"";var c,d,e,f,g,h,i,j="",k=0;for(b=a.compress(b);k<2*b.length;)k%2==0?(c=b.charCodeAt(k/2)>>8,d=255&b.charCodeAt(k/2),e=k/2+1<b.length?b.charCodeAt(k/2+1)>>8:0/0):(c=255&b.charCodeAt((k-1)/2),(k+1)/2<b.length?(d=b.charCodeAt((k+1)/2)>>8,e=255&b.charCodeAt((k+1)/2)):d=e=0/0),k+=3,f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),j=j+a._keyStr.charAt(f)+a._keyStr.charAt(g)+a._keyStr.charAt(h)+a._keyStr.charAt(i);return j},decompressFromBase64:function(b){if(null==b)return"";var c,d,e,f,g,h,i,j,k="",l=0,m=0,n=a._f;for(b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");m<b.length;)g=a._keyStr.indexOf(b.charAt(m++)),h=a._keyStr.indexOf(b.charAt(m++)),i=a._keyStr.indexOf(b.charAt(m++)),j=a._keyStr.indexOf(b.charAt(m++)),d=g<<2|h>>4,e=(15&h)<<4|i>>2,f=(3&i)<<6|j,l%2==0?(c=d<<8,64!=i&&(k+=n(c|e)),64!=j&&(c=f<<8)):(k+=n(c|d),64!=i&&(c=e<<8),64!=j&&(k+=n(c|f))),l+=3;return a.decompress(k)},compressToUTF16:function(b){if(null==b)return"";var c,d,e,f="",g=0,h=a._f;for(b=a.compress(b),c=0;c<b.length;c++)switch(d=b.charCodeAt(c),g++){case 0:f+=h((d>>1)+32),e=(1&d)<<14;break;case 1:f+=h(e+(d>>2)+32),e=(3&d)<<13;break;case 2:f+=h(e+(d>>3)+32),e=(7&d)<<12;break;case 3:f+=h(e+(d>>4)+32),e=(15&d)<<11;break;case 4:f+=h(e+(d>>5)+32),e=(31&d)<<10;break;case 5:f+=h(e+(d>>6)+32),e=(63&d)<<9;break;case 6:f+=h(e+(d>>7)+32),e=(127&d)<<8;break;case 7:f+=h(e+(d>>8)+32),e=(255&d)<<7;break;case 8:f+=h(e+(d>>9)+32),e=(511&d)<<6;break;case 9:f+=h(e+(d>>10)+32),e=(1023&d)<<5;break;case 10:f+=h(e+(d>>11)+32),e=(2047&d)<<4;break;case 11:f+=h(e+(d>>12)+32),e=(4095&d)<<3;break;case 12:f+=h(e+(d>>13)+32),e=(8191&d)<<2;break;case 13:f+=h(e+(d>>14)+32),e=(16383&d)<<1;break;case 14:f+=h(e+(d>>15)+32,(32767&d)+32),g=0}return f+h(e+32)},decompressFromUTF16:function(b){if(null==b)return"";for(var c,d,e="",f=0,g=0,h=a._f;g<b.length;){switch(d=b.charCodeAt(g)-32,f++){case 0:c=d<<1;break;case 1:e+=h(c|d>>14),c=(16383&d)<<2;break;case 2:e+=h(c|d>>13),c=(8191&d)<<3;break;case 3:e+=h(c|d>>12),c=(4095&d)<<4;break;case 4:e+=h(c|d>>11),c=(2047&d)<<5;break;case 5:e+=h(c|d>>10),c=(1023&d)<<6;break;case 6:e+=h(c|d>>9),c=(511&d)<<7;break;case 7:e+=h(c|d>>8),c=(255&d)<<8;break;case 8:e+=h(c|d>>7),c=(127&d)<<9;break;case 9:e+=h(c|d>>6),c=(63&d)<<10;break;case 10:e+=h(c|d>>5),c=(31&d)<<11;break;case 11:e+=h(c|d>>4),c=(15&d)<<12;break;case 12:e+=h(c|d>>3),c=(7&d)<<13;break;case 13:e+=h(c|d>>2),c=(3&d)<<14;break;case 14:e+=h(c|d>>1),c=(1&d)<<15;break;case 15:e+=h(c|d),f=0}g++}return a.decompress(e)},compress:function(b){if(null==b)return"";var c,d,e,f={},g={},h="",i="",j="",k=2,l=3,m=2,n="",o=0,p=0,q=a._f;for(e=0;e<b.length;e+=1)if(h=b.charAt(e),Object.prototype.hasOwnProperty.call(f,h)||(f[h]=l++,g[h]=!0),i=j+h,Object.prototype.hasOwnProperty.call(f,i))j=i;else{if(Object.prototype.hasOwnProperty.call(g,j)){if(j.charCodeAt(0)<256){for(c=0;m>c;c++)o<<=1,15==p?(p=0,n+=q(o),o=0):p++;for(d=j.charCodeAt(0),c=0;8>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1}else{for(d=1,c=0;m>c;c++)o=o<<1|d,15==p?(p=0,n+=q(o),o=0):p++,d=0;for(d=j.charCodeAt(0),c=0;16>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1}k--,0==k&&(k=Math.pow(2,m),m++),delete g[j]}else for(d=f[j],c=0;m>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1;k--,0==k&&(k=Math.pow(2,m),m++),f[i]=l++,j=String(h)}if(""!==j){if(Object.prototype.hasOwnProperty.call(g,j)){if(j.charCodeAt(0)<256){for(c=0;m>c;c++)o<<=1,15==p?(p=0,n+=q(o),o=0):p++;for(d=j.charCodeAt(0),c=0;8>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1}else{for(d=1,c=0;m>c;c++)o=o<<1|d,15==p?(p=0,n+=q(o),o=0):p++,d=0;for(d=j.charCodeAt(0),c=0;16>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1}k--,0==k&&(k=Math.pow(2,m),m++),delete g[j]}else for(d=f[j],c=0;m>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1;k--,0==k&&(k=Math.pow(2,m),m++)}for(d=2,c=0;m>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1;for(;;){if(o<<=1,15==p){n+=q(o);break}p++}return n},decompress:function(b){if(null==b)return"";if(""==b)return null;var c,d,e,f,g,h,i,j,k=[],l=4,m=4,n=3,o="",p="",q=a._f,r={string:b,val:b.charCodeAt(0),position:32768,index:1};for(d=0;3>d;d+=1)k[d]=d;for(f=0,h=Math.pow(2,2),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;switch(c=f){case 0:for(f=0,h=Math.pow(2,8),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;j=q(f);break;case 1:for(f=0,h=Math.pow(2,16),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;j=q(f);break;case 2:return""}for(k[3]=j,e=p=j;;){if(r.index>r.string.length)return"";for(f=0,h=Math.pow(2,n),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;switch(j=f){case 0:for(f=0,h=Math.pow(2,8),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;k[m++]=q(f),j=m-1,l--;break;case 1:for(f=0,h=Math.pow(2,16),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;k[m++]=q(f),j=m-1,l--;break;case 2:return p}if(0==l&&(l=Math.pow(2,n),n++),k[j])o=k[j];else{if(j!==m)return null;o=e+e.charAt(0)}p+=o,k[m++]=e+o.charAt(0),l--,e=o,0==l&&(l=Math.pow(2,n),n++)}}};return a}),define("general.models/bnf-model",["core.models/engine","lz-string","ng!$q"],function(a,b,c){function d(a){function b(a){return a.replace(/\s+/g," ").replace(/\s+(\)|\]|,)/g,"$1").replace(/(\(|\[|,)\s+/g,"$1")}function c(){a.forEach(d)}function d(a){a.qBnfLiteral===!0&&(s.keywords.push(a.qStr),a.qStr&&(s.keywordsAsLowerCase.push(a.qStr.toLowerCase()),s.mapping[a.qStr.toLowerCase()]=a.qNbr,a.qAggrFunc||a.qQvFunc?(s.functions.push(a.qStr),q[a.qStr.toLowerCase()]="function"):a.qFieldFlag||(s.notFunctions.push(a.qStr),q[a.qStr.toLowerCase()]="keyword")))}function e(b){if(b=parseInt(b,10),s.bnfEntries[b])return s.bnfEntries[b];var c=a.filter(function(a){return parseInt(a.qNbr,10)===b});return s.bnfEntries[b]=c[0],c[0]||!1}function f(a){s.keywords.length<1&&c(),a=a.toLowerCase();var b=s.mapping[a];return e(b)}function g(a){var b="",c=e(a);return a>=0&&56>=a?b=c.qStr||"":c&&(b=c.qStr||c.qName),b}function h(a){return a&&!a.signature&&(a.qBnf&&a.qBnf.length>0?a.signature=a.qBnf.map(g).join(" ").trim():a.qPNbr&&(a.signature=h(e(a.qPNbr))),a.signature=b(a.signature)),a.signature||""}function i(){return s.keywords.length<1&&c(),s.keywords}function j(){return s.keywordsAsLowerCase.length<1&&c(),s.keywordsAsLowerCase}function k(a){var b=f(a);return b!==!1?h(b):""}function l(){return a.filter(function(a){return a.qHelpId&&a.qHelpId>0}).map(function(a){return a.qStr})}function m(a){return"function"===q[a.toLowerCase()]}function n(a){return!!r[a]}function o(a){for(var b=0;b<a.length;++b){var c=a[b].qName;r[c]=!0}}function p(a){return!!q[a.toLowerCase()]}var q={},r={},s={keywords:[],keywordsAsLowerCase:[],functions:[],notFunctions:[],bnfEntries:[],mapping:{}};c();var t={getBnfEntry:e,getLiteralString:g,getAllKeywords:i,getAllKeywordsAsLowerCase:j,getKeywordsWithHelp:l,getSignatureFromKeyword:k,getFunctionTip:k,isFunction:m,isField:n,isKeyword:p,setFields:o};return t}function e(e){var f="BNF_CACHE_DATA_"+e,g="BNF_CACHE_VERSION_"+e;return a.global.qvVersion().then(function(h){var i=c.defer(),j=localStorage.getItem(g),k=j===h,l=k?localStorage.getItem(f):void 0;if(l)try{var m=JSON.parse(b.decompressFromUTF16(l));return i.resolve(d(m)),i.promise}catch(n){}return a.global.getBNF(e).then(function(a){var c=a.qBnfDefs;localStorage.setItem(f,b.compressToUTF16(JSON.stringify(c))),localStorage.setItem(g,h),i.resolve(d(c))}),i.promise})}function f(a){return i[a]||(i[a]=e(a)),i[a]}function g(){return f("S")}function h(){return f("E")}var i={},j={createBnfModel:d,getReloadScriptBnfModel:g,getExpressionBnfModel:h};return j}),define("general.components/extract",["jquery","qvangular","core.utils/resize","general.services/aligner/aligner"],function(a,b,c,d){b.directive("qvExtract",["$timeout","$parse",function(b,e){return{restrict:"A",transclude:!0,link:function(f,g,h,i,j){function k(){l.update(),++n,m.assign&&m.assign(f,n)}var l=new d({container:a("<div style='position:absolute'>"),body:document.body,alignAgainst:g}),m=e(h.qvExtract),n=0;l.showTranscluded(j),l.update(),b(function(){k()}),c.on("end",k),f.$on("$destroy",function(){l.hide(),c.off("end",k)})}}}])}),window.CodeMirror=function(){function a(c,d){if(!(this instanceof a))return new a(c,d);this.options=d=d||{};for(var e in ff)!d.hasOwnProperty(e)&&ff.hasOwnProperty(e)&&(d[e]=ff[e]);m(d);var f="string"==typeof d.value?0:d.value.first,g=this.display=b(c,f);g.wrapper.CodeMirror=this,j(this),d.autofocus&&!Ne&&ob(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,draggingText:!1,highlight:new Vd},h(this),d.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");var i=d.value;"string"==typeof i&&(i=new uf(d.value,d.mode)),gb(this,md)(this,i),Ae&&setTimeout(ce(nb,this,!0),20),qb(this);var k;try{k=document.activeElement==g.input}catch(l){}k||d.autofocus&&!Ne?setTimeout(ce(Ib,this),20):Jb(this),gb(this,function(){for(var a in ef)ef.propertyIsEnumerable(a)&&ef[a](this,d[a],gf);for(var b=0;b<lf.length;++b)lf[b](this)})()}function b(a,b){var c={},d=c.input=fe("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none; font-size: 4px;");return De?d.style.width="1000px":d.setAttribute("wrap","off"),Me&&(d.style.border="1px solid black"),d.setAttribute("autocorrect","off"),d.setAttribute("autocapitalize","off"),d.setAttribute("spellcheck","false"),c.inputDiv=fe("div",[d],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),c.scrollbarH=fe("div",[fe("div",null,null,"height: 1px")],"CodeMirror-hscrollbar"),c.scrollbarV=fe("div",[fe("div",null,null,"width: 1px")],"CodeMirror-vscrollbar"),c.scrollbarFiller=fe("div",null,"CodeMirror-scrollbar-filler"),c.gutterFiller=fe("div",null,"CodeMirror-gutter-filler"),c.lineDiv=fe("div",null,"CodeMirror-code"),c.selectionDiv=fe("div",null,null,"position: relative; z-index: 1"),c.cursor=fe("div","","CodeMirror-cursor"),c.otherCursor=fe("div","","CodeMirror-cursor CodeMirror-secondarycursor"),c.measure=fe("div",null,"CodeMirror-measure"),c.lineSpace=fe("div",[c.measure,c.selectionDiv,c.lineDiv,c.cursor,c.otherCursor],null,"position: relative; outline: none"),c.mover=fe("div",[fe("div",[c.lineSpace],"CodeMirror-lines")],null,"position: relative"),c.sizer=fe("div",[c.mover],"CodeMirror-sizer"),c.heightForcer=fe("div",null,null,"position: absolute; height: "+zf+"px; width: 1px;"),c.gutters=fe("div",null,"CodeMirror-gutters"),c.lineGutter=null,c.scroller=fe("div",[c.sizer,c.heightForcer,c.gutters],"CodeMirror-scroll"),c.scroller.setAttribute("tabIndex","-1"),c.wrapper=fe("div",[c.inputDiv,c.scrollbarH,c.scrollbarV,c.scrollbarFiller,c.gutterFiller,c.scroller],"CodeMirror"),Be&&(c.gutters.style.zIndex=-1,c.scroller.style.paddingRight=0),a.appendChild?a.appendChild(c.wrapper):a(c.wrapper),Me&&(d.style.width="0px"),De||(c.scroller.draggable=!0),Ie?(c.inputDiv.style.height="1px",c.inputDiv.style.position="absolute"):Be&&(c.scrollbarH.style.minWidth=c.scrollbarV.style.minWidth="18px"),c.viewOffset=c.lastSizeC=0,c.showingFrom=c.showingTo=b,c.lineNumWidth=c.lineNumInnerWidth=c.lineNumChars=null,c.prevInput="",c.alignWidgets=!1,c.pollingFast=!1,c.poll=new Vd,c.cachedCharWidth=c.cachedTextHeight=null,c.measureLineCache=[],c.measureLineCachePos=0,c.inaccurateSelection=!1,c.maxLine=null,c.maxLineLength=0,c.maxLineChanged=!1,c.wheelDX=c.wheelDY=c.wheelStartX=c.wheelStartY=null,c}function c(b){b.doc.mode=a.getMode(b.options,b.doc.modeOption),b.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null)}),b.doc.frontier=b.doc.first,G(b,100),b.state.modeGen++,b.curOp&&jb(b)}function d(a){a.options.lineWrapping?(a.display.wrapper.className+=" CodeMirror-wrap",a.display.sizer.style.minWidth=""):(a.display.wrapper.className=a.display.wrapper.className.replace(" CodeMirror-wrap",""),l(a)),f(a),jb(a),U(a),setTimeout(function(){n(a)},100)}function e(a){var b=cb(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/db(a.display)-3);return function(e){return Qc(a.doc,e)?0:c?(Math.ceil(e.text.length/d)||1)*b:b}}function f(a){var b=a.doc,c=e(a);b.iter(function(a){var b=c(a);b!=a.height&&qd(a,b)})}function g(a){var b=of[a.options.keyMap],c=b.style;a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(c?" cm-keymap-"+c:""),a.state.disableInput=b.disableInput}function h(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-"),U(a)}function i(a){j(a),jb(a),setTimeout(function(){p(a)},20)}function j(a){var b=a.display.gutters,c=a.options.gutters;ge(b);for(var d=0;d<c.length;++d){var e=c[d],f=b.appendChild(fe("div",null,"CodeMirror-gutter "+e));"CodeMirror-linenumbers"==e&&(a.display.lineGutter=f,f.style.width=(a.display.lineNumWidth||1)+"px")
}b.style.display=d?"":"none"}function k(a,b){if(0==b.height)return 0;for(var c,d=b.text.length,e=b;c=Nc(e);){var f=c.find();e=nd(a,f.from.line),d+=f.from.ch-f.to.ch}for(e=b;c=Oc(e);){var f=c.find();d-=e.text.length-f.from.ch,e=nd(a,f.to.line),d+=e.text.length-f.to.ch}return d}function l(a){var b=a.display,c=a.doc;b.maxLine=nd(c,c.first),b.maxLineLength=k(c,b.maxLine),b.maxLineChanged=!0,c.iter(function(a){var d=k(c,a);d>b.maxLineLength&&(b.maxLineLength=d,b.maxLine=a)})}function m(a){var b=$d(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):b>-1&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function n(a){var b=a.display,c=a.doc.height,d=c+L(b);b.sizer.style.minHeight=b.heightForcer.style.top=d+"px",b.gutters.style.height=Math.max(d,b.scroller.clientHeight-zf)+"px";var e=Math.max(d,b.scroller.scrollHeight),f=b.scroller.scrollWidth>b.scroller.clientWidth+1,g=e>b.scroller.clientHeight+1;g?(b.scrollbarV.style.display="block",b.scrollbarV.style.bottom=f?le(b.measure)+"px":"0",b.scrollbarV.firstChild.style.height=e-b.scroller.clientHeight+b.scrollbarV.clientHeight+"px"):(b.scrollbarV.style.display="",b.scrollbarV.firstChild.style.height="0"),f?(b.scrollbarH.style.display="block",b.scrollbarH.style.right=g?le(b.measure)+"px":"0",b.scrollbarH.firstChild.style.width=b.scroller.scrollWidth-b.scroller.clientWidth+b.scrollbarH.clientWidth+"px"):(b.scrollbarH.style.display="",b.scrollbarH.firstChild.style.width="0"),f&&g?(b.scrollbarFiller.style.display="block",b.scrollbarFiller.style.height=b.scrollbarFiller.style.width=le(b.measure)+"px"):b.scrollbarFiller.style.display="",f&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(b.gutterFiller.style.display="block",b.gutterFiller.style.height=le(b.measure)+"px",b.gutterFiller.style.width=b.gutters.offsetWidth+"px"):b.gutterFiller.style.display="",Je&&0===le(b.measure)&&(b.scrollbarV.style.minWidth=b.scrollbarH.style.minHeight=Ke?"18px":"12px",b.scrollbarV.style.pointerEvents=b.scrollbarH.style.pointerEvents="none")}function o(a,b,c){var d=a.scroller.scrollTop,e=a.wrapper.clientHeight;"number"==typeof c?d=c:c&&(d=c.top,e=c.bottom-c.top),d=Math.floor(d-K(a));var f=Math.ceil(d+e);return{from:sd(b,d),to:sd(b,f)}}function p(a){var b=a.display;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var c=s(b)-b.scroller.scrollLeft+a.doc.scrollLeft,d=b.gutters.offsetWidth,e=c+"px",f=b.lineDiv.firstChild;f;f=f.nextSibling)if(f.alignable)for(var g=0,h=f.alignable;g<h.length;++g)h[g].style.left=e;a.options.fixedGutter&&(b.gutters.style.left=c+d+"px")}}function q(a){if(!a.options.lineNumbers)return!1;var b=a.doc,c=r(a.options,b.first+b.size-1),d=a.display;if(c.length!=d.lineNumChars){var e=d.measure.appendChild(fe("div",[fe("div",c)],"CodeMirror-linenumber CodeMirror-gutter-elt")),f=e.firstChild.offsetWidth,g=e.offsetWidth-f;return d.lineGutter.style.width="",d.lineNumInnerWidth=Math.max(f,d.lineGutter.offsetWidth-g),d.lineNumWidth=d.lineNumInnerWidth+g,d.lineNumChars=d.lineNumInnerWidth?c.length:-1,d.lineGutter.style.width=d.lineNumWidth+"px",!0}return!1}function r(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function s(a){return je(a.scroller).left-je(a.sizer).left}function t(a,b,c,d){for(var e,f=a.display.showingFrom,g=a.display.showingTo,h=o(a.display,a.doc,c),i=!0;;i=!1){var j=a.display.scroller.clientWidth;if(!u(a,b,h,d))break;if(e=!0,b=[],C(a),n(a),i&&a.options.lineWrapping&&j!=a.display.scroller.clientWidth)d=!0;else if(d=!1,c&&(c=Math.min(a.display.scroller.scrollHeight-a.display.scroller.clientHeight,"number"==typeof c?c:c.top)),h=o(a.display,a.doc,c),h.from>=a.display.showingFrom&&h.to<=a.display.showingTo)break}return e&&(Qd(a,"update",a),(a.display.showingFrom!=f||a.display.showingTo!=g)&&Qd(a,"viewportChange",a,a.display.showingFrom,a.display.showingTo)),e}function u(a,b,c,d){var e=a.display,f=a.doc;if(!e.wrapper.clientWidth)return e.showingFrom=e.showingTo=f.first,void(e.viewOffset=0);if(!(!d&&0==b.length&&c.from>e.showingFrom&&c.to<e.showingTo)){q(a)&&(b=[{from:f.first,to:f.first+f.size}]);var g=e.sizer.style.marginLeft=e.gutters.offsetWidth+"px";e.scrollbarH.style.left=a.options.fixedGutter?g:"0";var h=1/0;if(a.options.lineNumbers)for(var i=0;i<b.length;++i)b[i].diff&&b[i].from<h&&(h=b[i].from);var j=f.first+f.size,k=Math.max(c.from-a.options.viewportMargin,f.first),l=Math.min(j,c.to+a.options.viewportMargin);if(e.showingFrom<k&&k-e.showingFrom<20&&(k=Math.max(f.first,e.showingFrom)),e.showingTo>l&&e.showingTo-l<20&&(l=Math.min(j,e.showingTo)),Xe)for(k=rd(Pc(f,nd(f,k)));j>l&&Qc(f,nd(f,l));)++l;var m=[{from:Math.max(e.showingFrom,f.first),to:Math.min(e.showingTo,j)}];if(m=m[0].from>=m[0].to?[]:x(m,b),Xe)for(var i=0;i<m.length;++i)for(var n,o=m[i];n=Oc(nd(f,o.to-1));){var p=n.find().from.line;if(!(p>o.from)){m.splice(i--,1);break}o.to=p}for(var r=0,i=0;i<m.length;++i){var o=m[i];o.from<k&&(o.from=k),o.to>l&&(o.to=l),o.from>=o.to?m.splice(i--,1):r+=o.to-o.from}if(!d&&r==l-k&&k==e.showingFrom&&l==e.showingTo)return void w(a);m.sort(function(a,b){return a.from-b.from});try{var s=document.activeElement}catch(t){}.7*(l-k)>r&&(e.lineDiv.style.display="none"),z(a,k,l,m,h),e.lineDiv.style.display="",s&&document.activeElement!=s&&s.offsetHeight&&s.focus();var u=k!=e.showingFrom||l!=e.showingTo||e.lastSizeC!=e.wrapper.clientHeight;return u&&(e.lastSizeC=e.wrapper.clientHeight,G(a,400)),e.showingFrom=k,e.showingTo=l,v(a),w(a),!0}}function v(a){for(var b,c=a.display,d=c.lineDiv.offsetTop,e=c.lineDiv.firstChild;e;e=e.nextSibling)if(e.lineObj){if(Be){var f=e.offsetTop+e.offsetHeight;b=f-d,d=f}else{var g=je(e);b=g.bottom-g.top}var h=e.lineObj.height-b;if(2>b&&(b=cb(c)),h>.001||-.001>h){qd(e.lineObj,b);var i=e.lineObj.widgets;if(i)for(var j=0;j<i.length;++j)i[j].height=i[j].node.offsetHeight}}}function w(a){var b=a.display.viewOffset=td(a,nd(a.doc,a.display.showingFrom));a.display.mover.style.top=b+"px"}function x(a,b){for(var c=0,d=b.length||0;d>c;++c){for(var e=b[c],f=[],g=e.diff||0,h=0,i=a.length;i>h;++h){var j=a[h];e.to<=j.from&&e.diff?f.push({from:j.from+g,to:j.to+g}):e.to<=j.from||e.from>=j.to?f.push(j):(e.from>j.from&&f.push({from:j.from,to:e.from}),e.to<j.to&&f.push({from:e.to+g,to:j.to+g}))}a=f}return a}function y(a){for(var b=a.display,c={},d={},e=b.gutters.firstChild,f=0;e;e=e.nextSibling,++f)c[a.options.gutters[f]]=e.offsetLeft,d[a.options.gutters[f]]=e.offsetWidth;return{fixedPos:s(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function z(a,b,c,d,e){function f(b){var c=b.nextSibling;return De&&Oe&&a.display.currentWheelTarget==b?(b.style.display="none",b.lineObj=null):b.parentNode.removeChild(b),c}var g=y(a),h=a.display,i=a.options.lineNumbers;d.length||De&&a.display.currentWheelTarget||ge(h.lineDiv);var j=h.lineDiv,k=j.firstChild,l=d.shift(),m=b;for(a.doc.iter(b,c,function(b){if(l&&l.to==m&&(l=d.shift()),Qc(a.doc,b)){if(0!=b.height&&qd(b,0),b.widgets&&k&&k.previousSibling)for(var c=0;c<b.widgets.length;++c){var h=b.widgets[c];if(h.showIfHidden){var n=k.previousSibling;if(/pre/i.test(n.nodeName)){var o=fe("div",null,null,"position: relative");n.parentNode.replaceChild(o,n),o.appendChild(n),n=o}var p=n.appendChild(fe("div",[h.node],"CodeMirror-linewidget"));h.handleMouseEvents||(p.ignoreEvents=!0),B(h,p,n,g)}}}else if(l&&l.from<=m&&l.to>m){for(;k.lineObj!=b;)k=f(k);i&&m>=e&&k.lineNumber&&ie(k.lineNumber,r(a.options,m)),k=k.nextSibling}else{if(b.widgets)for(var q,s=0,t=k;t&&20>s;++s,t=t.nextSibling)if(t.lineObj==b&&/div/i.test(t.nodeName)){q=t;break}var u=A(a,b,m,g,q);if(u!=q)j.insertBefore(u,k);else{for(;k!=q;)k=f(k);k=k.nextSibling}u.lineObj=b}++m});k;)k=f(k)}function A(a,b,c,d,e){var f,g=cd(a,b),h=g.pre,i=b.gutterMarkers,j=a.display,k=g.bgClass?g.bgClass+" "+(b.bgClass||""):b.bgClass;if(!(a.options.lineNumbers||i||k||b.wrapClass||b.widgets))return h;if(e){e.alignable=null;for(var l,m=!0,n=0,o=null,p=e.firstChild;p;p=l)if(l=p.nextSibling,/\bCodeMirror-linewidget\b/.test(p.className)){for(var q=0;q<b.widgets.length;++q){var s=b.widgets[q];if(s.node==p.firstChild){s.above||o||(o=p),B(s,p,e,d),++n;break}}if(q==b.widgets.length){m=!1;break}}else e.removeChild(p);e.insertBefore(h,o),m&&n==b.widgets.length&&(f=e,e.className=b.wrapClass||"")}if(f||(f=fe("div",null,b.wrapClass,"position: relative"),f.appendChild(h)),k&&f.insertBefore(fe("div",null,k+" CodeMirror-linebackground"),f.firstChild),a.options.lineNumbers||i){var t=f.insertBefore(fe("div",null,null,"position: absolute; left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px"),f.firstChild);if(a.options.fixedGutter&&(f.alignable||(f.alignable=[])).push(t),!a.options.lineNumbers||i&&i["CodeMirror-linenumbers"]||(f.lineNumber=t.appendChild(fe("div",r(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+d.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+j.lineNumInnerWidth+"px"))),i)for(var u=0;u<a.options.gutters.length;++u){var v=a.options.gutters[u],w=i.hasOwnProperty(v)&&i[v];w&&t.appendChild(fe("div",[w],"CodeMirror-gutter-elt","left: "+d.gutterLeft[v]+"px; width: "+d.gutterWidth[v]+"px"))}}if(Be&&(f.style.zIndex=2),b.widgets&&f!=e)for(var q=0,x=b.widgets;q<x.length;++q){var s=x[q],y=fe("div",[s.node],"CodeMirror-linewidget");s.handleMouseEvents||(y.ignoreEvents=!0),B(s,y,f,d),s.above?f.insertBefore(y,a.options.lineNumbers&&0!=b.height?t:h):f.appendChild(y),Qd(s,"redraw")}return f}function B(a,b,c,d){if(a.noHScroll){(c.alignable||(c.alignable=[])).push(b);var e=d.wrapperWidth;b.style.left=d.fixedPos+"px",a.coverGutter||(e-=d.gutterTotalWidth,b.style.paddingLeft=d.gutterTotalWidth+"px"),b.style.width=e+"px"}a.coverGutter&&(b.style.zIndex=5,b.style.position="relative",a.noHScroll||(b.style.marginLeft=-d.gutterTotalWidth+"px"))}function C(a){var b=a.display,c=Wb(a.doc.sel.from,a.doc.sel.to);if(c||a.options.showCursorWhenSelecting?D(a):b.cursor.style.display=b.otherCursor.style.display="none",c?b.selectionDiv.style.display="none":E(a),a.options.moveInputWithCursor){var d=$(a,a.doc.sel.head,"div"),e=je(b.wrapper),f=je(b.lineDiv);b.inputDiv.style.top=Math.max(0,Math.min(b.wrapper.clientHeight-10,d.top+f.top-e.top))+"px",b.inputDiv.style.left=Math.max(0,Math.min(b.wrapper.clientWidth-10,d.left+f.left-e.left))+"px"}}function D(a){var b=a.display,c=$(a,a.doc.sel.head,"div");b.cursor.style.left=c.left+"px",b.cursor.style.top=c.top+"px",b.cursor.style.height=Math.max(0,c.bottom-c.top)*a.options.cursorHeight+"px",b.cursor.style.display="",c.other?(b.otherCursor.style.display="",b.otherCursor.style.left=c.other.left+"px",b.otherCursor.style.top=c.other.top+"px",b.otherCursor.style.height=.85*(c.other.bottom-c.other.top)+"px"):b.otherCursor.style.display="none"}function E(a){function b(a,b,c,d){0>b&&(b=0),g.appendChild(fe("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==c?h-a:c)+"px; height: "+(d-b)+"px"))}function c(c,d,f){function g(b,d){return Z(a,Vb(c,b),"div",l,d)}var j,k,l=nd(e,c),m=l.text.length;return ne(ud(l),d||0,null==f?m:f,function(a,c,e){var l,n,o,p=g(a,"left");if(a==c)l=p,n=o=p.left;else{if(l=g(c-1,"right"),"rtl"==e){var q=p;p=l,l=q}n=p.left,o=l.right}null==d&&0==a&&(n=i),l.top-p.top>3&&(b(n,p.top,null,p.bottom),n=i,p.bottom<l.top&&b(n,p.bottom,null,l.top)),null==f&&c==m&&(o=h),(!j||p.top<j.top||p.top==j.top&&p.left<j.left)&&(j=p),(!k||l.bottom>k.bottom||l.bottom==k.bottom&&l.right>k.right)&&(k=l),i+1>n&&(n=i),b(n,l.top,o-n,l.bottom)}),{start:j,end:k}}var d=a.display,e=a.doc,f=a.doc.sel,g=document.createDocumentFragment(),h=d.lineSpace.offsetWidth,i=M(a.display);if(f.from.line==f.to.line)c(f.from.line,f.from.ch,f.to.ch);else{var j=nd(e,f.from.line),k=nd(e,f.to.line),l=Pc(e,j)==Pc(e,k),m=c(f.from.line,f.from.ch,l?j.text.length:null).end,n=c(f.to.line,l?0:null,f.to.ch).start;l&&(m.top<n.top-2?(b(m.right,m.top,null,m.bottom),b(i,n.top,n.left,n.bottom)):b(m.right,m.top,n.left-m.right,m.bottom)),m.bottom<n.top&&b(i,m.bottom,null,n.top)}he(d.selectionDiv,g),d.selectionDiv.style.display=""}function F(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursor.style.visibility=b.otherCursor.style.visibility="",a.options.cursorBlinkRate>0&&(b.blinker=setInterval(function(){b.cursor.style.visibility=b.otherCursor.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate))}}function G(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.showingTo&&a.state.highlight.set(b,ce(H,a))}function H(a){var b=a.doc;if(b.frontier<b.first&&(b.frontier=b.first),!(b.frontier>=a.display.showingTo)){var c,d=+new Date+a.options.workTime,e=tc(b.mode,J(a,b.frontier)),f=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.showingTo+500),function(g){if(b.frontier>=a.display.showingFrom){var h=g.styles;g.styles=$c(a,g,e);for(var i=!h||h.length!=g.styles.length,j=0;!i&&j<h.length;++j)i=h[j]!=g.styles[j];i&&(c&&c.end==b.frontier?c.end++:f.push(c={start:b.frontier,end:b.frontier+1})),g.stateAfter=tc(b.mode,e)}else ad(a,g,e),g.stateAfter=b.frontier%5==0?tc(b.mode,e):null;return++b.frontier,+new Date>d?(G(a,a.options.workDelay),!0):void 0}),f.length&&gb(a,function(){for(var a=0;a<f.length;++a)jb(this,f[a].start,f[a].end)})()}}function I(a,b,c){for(var d,e,f=a.doc,g=c?-1:b-(a.doc.mode.innerMode?1e3:100),h=b;h>g;--h){if(h<=f.first)return f.first;var i=nd(f,h-1);if(i.stateAfter&&(!c||h<=f.frontier))return h;var j=Wd(i.text,null,a.options.tabSize);(null==e||d>j)&&(e=h-1,d=j)}return e}function J(a,b,c){var d=a.doc,e=a.display;if(!d.mode.startState)return!0;var f=I(a,b,c),g=f>d.first&&nd(d,f-1).stateAfter;return g=g?tc(d.mode,g):uc(d.mode),d.iter(f,b,function(c){ad(a,c,g);var h=f==b-1||f%5==0||f>=e.showingFrom&&f<e.showingTo;c.stateAfter=h?tc(d.mode,g):null,++f}),c&&(d.frontier=f),g}function K(a){return a.lineSpace.offsetTop}function L(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function M(a){var b=he(a.measure,fe("pre",null,null,"text-align: left")).appendChild(fe("span","x"));return b.offsetLeft}function N(a,b,c,d,e){var f=-1;if(d=d||Q(a,b),d.crude){var g=d.left+c*d.width;return{left:g,right:g+d.width,top:d.top,bottom:d.bottom}}for(var h=c;;h+=f){var i=d[h];if(i)break;0>f&&0==h&&(f=1)}return e=h>c?"left":c>h?"right":e,"left"==e&&i.leftSide?i=i.leftSide:"right"==e&&i.rightSide&&(i=i.rightSide),{left:c>h?i.right:i.left,right:h>c?i.left:i.right,top:i.top,bottom:i.bottom}}function O(a,b){for(var c=a.display.measureLineCache,d=0;d<c.length;++d){var e=c[d];if(e.text==b.text&&e.markedSpans==b.markedSpans&&a.display.scroller.clientWidth==e.width&&e.classes==b.textClass+"|"+b.wrapClass)return e}}function P(a,b){var c=O(a,b);c&&(c.text=c.measure=c.markedSpans=null)}function Q(a,b){var c=O(a,b);if(c)return c.measure;var d=R(a,b),e=a.display.measureLineCache,f={text:b.text,width:a.display.scroller.clientWidth,markedSpans:b.markedSpans,measure:d,classes:b.textClass+"|"+b.wrapClass};return 16==e.length?e[++a.display.measureLineCachePos%16]=f:e.push(f),d}function R(a,b){function c(a){var b=a.top-o.top,c=a.bottom-o.top;c>r&&(c=r),0>b&&(b=0);for(var d=p.length-2;d>=0;d-=2){var e=p[d],f=p[d+1];if(!(e>c||b>f)&&(b>=e&&f>=c||e>=b&&c>=f||Math.min(c,f)-Math.max(b,e)>=c-b>>1)){p[d]=Math.min(b,e),p[d+1]=Math.max(c,f);break}}return 0>d&&(d=p.length,p.push(b,c)),{left:a.left-o.left,right:a.right-o.left,top:d,bottom:null}}function d(a){a.bottom=p[a.top+1],a.top=p[a.top]}if(!a.options.lineWrapping&&b.text.length>=a.options.crudeMeasuringFrom)return S(a,b);var e=a.display,f=be(b.text.length),g=cd(a,b,f,!0).pre;if(Ae&&!Be&&!a.options.lineWrapping&&g.childNodes.length>100){for(var h=document.createDocumentFragment(),i=10,j=g.childNodes.length,k=0,l=Math.ceil(j/i);l>k;++k){for(var m=fe("div",null,null,"display: inline-block"),n=0;i>n&&j;++n)m.appendChild(g.firstChild),--j;h.appendChild(m)}g.appendChild(h)}he(e.measure,g);var o=je(e.lineDiv),p=[],q=be(b.text.length),r=g.offsetHeight;Ce&&e.measure.first!=g&&he(e.measure,g);for(var s,k=0;k<f.length;++k)if(s=f[k]){var t=s,u=null;if(/\bCodeMirror-widget\b/.test(s.className)&&s.getClientRects){1==s.firstChild.nodeType&&(t=s.firstChild);var v=t.getClientRects();v.length>1&&(u=q[k]=c(v[0]),u.rightSide=c(v[v.length-1]))}u||(u=q[k]=c(je(t))),s.measureRight&&(u.right=je(s.measureRight).left),s.leftSide&&(u.leftSide=c(je(s.leftSide)))}ge(a.display.measure);for(var s,k=0;k<q.length;++k)(s=q[k])&&(d(s),s.leftSide&&d(s.leftSide),s.rightSide&&d(s.rightSide));return q}function S(a,b){var c=new qf(b.text.slice(0,100),null);b.textClass&&(c.textClass=b.textClass);var d=R(a,c),e=N(a,c,0,d,"left"),f=N(a,c,99,d,"right");return{crude:!0,top:e.top,left:e.left,bottom:e.bottom,width:(f.right-e.left)/100}}function T(a,b){var c=!1;if(b.markedSpans)for(var d=0;d<b.markedSpans;++d){var e=b.markedSpans[d];!e.collapsed||null!=e.to&&e.to!=b.text.length||(c=!0)}var f=!c&&O(a,b);if(f||b.text.length>=a.options.crudeMeasuringFrom)return N(a,b,b.text.length,f&&f.measure,"right").right;var g=cd(a,b,null,!0).pre,h=g.appendChild(me(a.display.measure));return he(a.display.measure,g),je(h).right-je(a.display.lineDiv).left}function U(a){a.display.measureLineCache.length=a.display.measureLineCachePos=0,a.display.cachedCharWidth=a.display.cachedTextHeight=null,a.options.lineWrapping||(a.display.maxLineChanged=!0),a.display.lineNumChars=null}function V(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function W(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function X(a,b,c,d){if(b.widgets)for(var e=0;e<b.widgets.length;++e)if(b.widgets[e].above){var f=Vc(b.widgets[e]);c.top+=f,c.bottom+=f}if("line"==d)return c;d||(d="local");var g=td(a,b);if("local"==d?g+=K(a.display):g-=a.display.viewOffset,"page"==d||"window"==d){var h=je(a.display.lineSpace);g+=h.top+("window"==d?0:W());var i=h.left+("window"==d?0:V());c.left+=i,c.right+=i}return c.top+=g,c.bottom+=g,c}function Y(a,b,c){if("div"==c)return b;var d=b.left,e=b.top;if("page"==c)d-=V(),e-=W();else if("local"==c||!c){var f=je(a.display.sizer);d+=f.left,e+=f.top}var g=je(a.display.lineSpace);return{left:d-g.left,top:e-g.top}}function Z(a,b,c,d,e){return d||(d=nd(a.doc,b.line)),X(a,d,N(a,d,b.ch,null,e),c)}function $(a,b,c,d,e){function f(b,f){var g=N(a,d,b,e,f?"right":"left");return f?g.left=g.right:g.right=g.left,X(a,d,g,c)}function g(a,b){var c=h[b],d=c.level%2;return a==oe(c)&&b&&c.level<h[b-1].level?(c=h[--b],a=pe(c)-(c.level%2?0:1),d=!0):a==pe(c)&&b<h.length-1&&c.level<h[b+1].level&&(c=h[++b],a=oe(c)-c.level%2,d=!1),d&&a==c.to&&a>c.from?f(a-1):f(a,d)}d=d||nd(a.doc,b.line),e||(e=Q(a,d));var h=ud(d),i=b.ch;if(!h)return f(i);var j=ve(h,i),k=g(i,j);return null!=Lf&&(k.other=g(i,Lf)),k}function _(a,b,c,d){var e=new Vb(a,b);return e.xRel=d,c&&(e.outside=!0),e}function ab(a,b,c){var d=a.doc;if(c+=a.display.viewOffset,0>c)return _(d.first,0,!0,-1);var e=sd(d,c),f=d.first+d.size-1;if(e>f)return _(d.first+d.size-1,nd(d,f).text.length,!0,1);for(0>b&&(b=0);;){var g=nd(d,e),h=bb(a,g,e,b,c),i=Oc(g),j=i&&i.find();if(!i||!(h.ch>j.from.ch||h.ch==j.from.ch&&h.xRel>0))return h;e=j.to.line}}function bb(a,b,c,d,e){function f(d){var e=$(a,Vb(c,d),"line",b,j);return h=!0,g>e.bottom?e.left-i:g<e.top?e.left+i:(h=!1,e.left)}var g=e-td(a,b),h=!1,i=2*a.display.wrapper.clientWidth,j=Q(a,b),k=ud(b),l=b.text.length,m=qe(b),n=re(b),o=f(m),p=h,q=f(n),r=h;if(d>q)return _(c,n,r,1);for(;;){if(k?n==m||n==xe(b,m,1):1>=n-m){for(var s=o>d||q-d>=d-o?m:n,t=d-(s==m?o:q);Df.test(b.text.charAt(s));)++s;var u=_(c,s,s==m?p:r,0>t?-1:t?1:0);return u}var v=Math.ceil(l/2),w=m+v;if(k){w=m;for(var x=0;v>x;++x)w=xe(b,w,1)}var y=f(w);y>d?(n=w,q=y,(r=h)&&(q+=1e3),l=v):(m=w,o=y,p=h,l-=v)}}function cb(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==Re){Re=fe("pre");for(var b=0;49>b;++b)Re.appendChild(document.createTextNode("x")),Re.appendChild(fe("br"));Re.appendChild(document.createTextNode("x"))}he(a.measure,Re);var c=Re.offsetHeight/50;return c>3&&(a.cachedTextHeight=c),ge(a.measure),c||1}function db(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=fe("span","x"),c=fe("pre",[b]);he(a.measure,c);var d=b.offsetWidth;return d>2&&(a.cachedCharWidth=d),d||10}function eb(a){a.curOp={changes:[],forceUpdate:!1,updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,cursorActivity:!1,updateMaxLine:!1,updateScrollPos:!1,id:++Ye},yf++||(xf=[])}function fb(a){var b=a.curOp,c=a.doc,d=a.display;if(a.curOp=null,b.updateMaxLine&&l(a),d.maxLineChanged&&!a.options.lineWrapping&&d.maxLine){var e=T(a,d.maxLine);d.sizer.style.minWidth=Math.max(0,e+3+zf)+"px",d.maxLineChanged=!1;var f=Math.max(0,d.sizer.offsetLeft+d.sizer.offsetWidth-d.scroller.clientWidth);f<c.scrollLeft&&!b.updateScrollPos&&Ab(a,Math.min(d.scroller.scrollLeft,f),!0)}var g,h;if(b.updateScrollPos)g=b.updateScrollPos;else if(b.selectionChanged&&d.scroller.clientHeight){var i=$(a,c.sel.head);g=jc(a,i.left,i.top,i.left,i.bottom)}(b.changes.length||b.forceUpdate||g&&null!=g.scrollTop)&&(h=t(a,b.changes,g&&g.scrollTop,b.forceUpdate),a.display.scroller.offsetHeight&&(a.doc.scrollTop=a.display.scroller.scrollTop)),!h&&b.selectionChanged&&C(a),b.updateScrollPos?(d.scroller.scrollTop=d.scrollbarV.scrollTop=c.scrollTop=g.scrollTop,d.scroller.scrollLeft=d.scrollbarH.scrollLeft=c.scrollLeft=g.scrollLeft,p(a),b.scrollToPos&&hc(a,$b(a.doc,b.scrollToPos.from),$b(a.doc,b.scrollToPos.to),b.scrollToPos.margin)):g&&gc(a),b.selectionChanged&&F(a),a.state.focused&&b.updateInput&&nb(a,b.userSelChange);var j=b.maybeHiddenMarkers,k=b.maybeUnhiddenMarkers;if(j)for(var m=0;m<j.length;++m)j[m].lines.length||Pd(j[m],"hide");if(k)for(var m=0;m<k.length;++m)k[m].lines.length&&Pd(k[m],"unhide");var n;if(--yf||(n=xf,xf=null),b.textChanged&&Pd(a,"change",a,b.textChanged),b.cursorActivity&&Pd(a,"cursorActivity",a),n)for(var m=0;m<n.length;++m)n[m]()}function gb(a,b){return function(){var c=a||this,d=!c.curOp;d&&eb(c);try{var e=b.apply(c,arguments)}finally{d&&fb(c)}return e}}function hb(a){return function(){var b,c=this.cm&&!this.cm.curOp;c&&eb(this.cm);try{b=a.apply(this,arguments)}finally{c&&fb(this.cm)}return b}}function ib(a,b){var c,d=!a.curOp;d&&eb(a);try{c=b()}finally{d&&fb(a)}return c}function jb(a,b,c,d){null==b&&(b=a.doc.first),null==c&&(c=a.doc.first+a.doc.size),a.curOp.changes.push({from:b,to:c,diff:d})}function kb(a){a.display.pollingFast||a.display.poll.set(a.options.pollInterval,function(){mb(a),a.state.focused&&kb(a)})}function lb(a){function b(){var d=mb(a);d||c?(a.display.pollingFast=!1,kb(a)):(c=!0,a.display.poll.set(60,b))}var c=!1;a.display.pollingFast=!0,a.display.poll.set(20,b)}function mb(a){var b=a.display.input,c=a.display.prevInput,d=a.doc,e=d.sel;if(!a.state.focused||If(b)||pb(a)||a.state.disableInput)return!1;a.state.pasteIncoming&&a.state.fakedLastChar&&(b.value=b.value.substring(0,b.value.length-1),a.state.fakedLastChar=!1);var f=b.value;if(f==c&&Wb(e.from,e.to))return!1;if(Ae&&!Ce&&a.display.inputHasSelection===f)return nb(a,!0),!1;var g=!a.curOp;g&&eb(a),e.shift=!1;for(var h=0,i=Math.min(c.length,f.length);i>h&&c.charCodeAt(h)==f.charCodeAt(h);)++h;var j=e.from,k=e.to;h<c.length?j=Vb(j.line,j.ch-(c.length-h)):a.state.overwrite&&Wb(j,k)&&!a.state.pasteIncoming&&(k=Vb(k.line,Math.min(nd(d,k.line).text.length,k.ch+(f.length-h))));var l=a.curOp.updateInput,m={from:j,to:k,text:Hf(f.slice(h)),origin:a.state.pasteIncoming?"paste":"+input"};return Ob(a.doc,m,"end"),a.curOp.updateInput=l,Qd(a,"inputRead",a,m),f.length>1e3||f.indexOf("\n")>-1?b.value=a.display.prevInput="":a.display.prevInput=f,g&&fb(a),a.state.pasteIncoming=!1,!0}function nb(a,b){var c,d,e=a.doc;if(Wb(e.sel.from,e.sel.to))b&&(a.display.prevInput=a.display.input.value="",Ae&&!Ce&&(a.display.inputHasSelection=null));else{a.display.prevInput="",c=Jf&&(e.sel.to.line-e.sel.from.line>100||(d=a.getSelection()).length>1e3);var f=c?"-":d||a.getSelection();a.display.input.value=f,a.state.focused&&Zd(a.display.input),Ae&&!Ce&&(a.display.inputHasSelection=f)}a.display.inaccurateSelection=c}function ob(a){"nocursor"==a.options.readOnly||Ne&&document.activeElement==a.display.input||a.display.input.focus()}function pb(a){return a.options.readOnly||a.doc.cantEdit}function qb(a){function b(){a.state.focused&&setTimeout(ce(ob,a),0)}function c(){null==h&&(h=setTimeout(function(){h=null,g.cachedCharWidth=g.cachedTextHeight=Ff=null,U(a),ib(a,ce(jb,a))},100))}function d(){for(var a=g.wrapper.parentNode;a&&a!=document.body;a=a.parentNode);a?setTimeout(d,5e3):Od(window,"resize",c)}function e(b){Rd(a,b)||a.options.onDragEvent&&a.options.onDragEvent(a,Gd(b))||Kd(b)}function f(){g.inaccurateSelection&&(g.prevInput="",g.inaccurateSelection=!1,g.input.value=a.getSelection(),Zd(g.input))}var g=a.display;Nd(g.scroller,"mousedown",gb(a,tb)),Ae?Nd(g.scroller,"dblclick",gb(a,function(b){if(!Rd(a,b)){var c=sb(a,b);if(c&&!wb(a,b)&&!rb(a.display,b)){Hd(b);var d=qc(nd(a.doc,c.line).text,c);bc(a.doc,d.from,d.to)}}})):Nd(g.scroller,"dblclick",function(b){Rd(a,b)||Hd(b)}),Nd(g.lineSpace,"selectstart",function(a){rb(g,a)||Hd(a)}),Ve||Nd(g.scroller,"contextmenu",function(b){Kb(a,b)}),Nd(g.scroller,"scroll",function(){g.scroller.clientHeight&&(zb(a,g.scroller.scrollTop),Ab(a,g.scroller.scrollLeft,!0),Pd(a,"scroll",a))}),Nd(g.scrollbarV,"scroll",function(){g.scroller.clientHeight&&zb(a,g.scrollbarV.scrollTop)}),Nd(g.scrollbarH,"scroll",function(){g.scroller.clientHeight&&Ab(a,g.scrollbarH.scrollLeft)}),Nd(g.scroller,"mousewheel",function(b){Bb(a,b)}),Nd(g.scroller,"DOMMouseScroll",function(b){Bb(a,b)}),Nd(g.scrollbarH,"mousedown",b),Nd(g.scrollbarV,"mousedown",b),Nd(g.wrapper,"scroll",function(){g.wrapper.scrollTop=g.wrapper.scrollLeft=0});var h;Nd(window,"resize",c),setTimeout(d,5e3),Nd(g.input,"keyup",gb(a,function(b){Rd(a,b)||a.options.onKeyEvent&&a.options.onKeyEvent(a,Gd(b))||16==b.keyCode&&(a.doc.sel.shift=!1)})),Nd(g.input,"input",function(){Ae&&!Ce&&a.display.inputHasSelection&&(a.display.inputHasSelection=null),lb(a)}),Nd(g.input,"keydown",gb(a,Gb)),Nd(g.input,"keypress",gb(a,Hb)),Nd(g.input,"focus",ce(Ib,a)),Nd(g.input,"blur",ce(Jb,a)),a.options.dragDrop&&(Nd(g.scroller,"dragstart",function(b){yb(a,b)}),Nd(g.scroller,"dragenter",e),Nd(g.scroller,"dragover",e),Nd(g.scroller,"drop",gb(a,xb))),Nd(g.scroller,"paste",function(b){rb(g,b)||(ob(a),lb(a))}),Nd(g.input,"paste",function(){if(De&&!a.state.fakedLastChar&&!(new Date-a.state.lastMiddleDown<200)){var b=g.input.selectionStart,c=g.input.selectionEnd;g.input.value+="$",g.input.selectionStart=b,g.input.selectionEnd=c,a.state.fakedLastChar=!0}a.state.pasteIncoming=!0,lb(a)}),Nd(g.input,"cut",f),Nd(g.input,"copy",f),Ie&&Nd(g.sizer,"mouseup",function(){document.activeElement==g.input&&g.input.blur(),ob(a)})}function rb(a,b){for(var c=Ld(b);c!=a.wrapper;c=c.parentNode)if(!c||c.ignoreEvents||c.parentNode==a.sizer&&c!=a.mover)return!0}function sb(a,b,c){var d=a.display;if(!c){var e=Ld(b);if(e==d.scrollbarH||e==d.scrollbarH.firstChild||e==d.scrollbarV||e==d.scrollbarV.firstChild||e==d.scrollbarFiller||e==d.gutterFiller)return null}var f,g,h=je(d.lineSpace);try{f=b.clientX,g=b.clientY}catch(b){return null}return ab(a,f-h.left,g-h.top)}function tb(a){function b(a){if(!Wb(r,a)){if(r=a,"single"==k)return void bc(e.doc,$b(g,i),a);if(p=$b(g,p),q=$b(g,q),"double"==k){var b=qc(nd(g,a.line).text,a);Xb(a,p)?bc(e.doc,b.from,q):bc(e.doc,p,b.to)}else"triple"==k&&(Xb(a,p)?bc(e.doc,q,$b(g,Vb(a.line,0))):bc(e.doc,p,$b(g,Vb(a.line+1,0))))}}function c(a){var d=++t,h=sb(e,a,!0);if(h)if(Wb(h,m)){var i=a.clientY<s.top?-20:a.clientY>s.bottom?20:0;i&&setTimeout(gb(e,function(){t==d&&(f.scroller.scrollTop+=i,c(a))}),50)}else{e.state.focused||Ib(e),m=h,b(h);var j=o(f,g);(h.line>=j.to||h.line<j.from)&&setTimeout(gb(e,function(){t==d&&c(a)}),150)}}function d(a){t=1/0,Hd(a),ob(e),Od(document,"mousemove",u),Od(document,"mouseup",v)}if(!Rd(this,a)){var e=this,f=e.display,g=e.doc,h=g.sel;if(h.shift=a.shiftKey,rb(f,a))return void(De||(f.scroller.draggable=!1,setTimeout(function(){f.scroller.draggable=!0},100)));if(!wb(e,a)){var i=sb(e,a);switch(Md(a)){case 3:return void(Ve&&Kb.call(e,e,a));case 2:return De&&(e.state.lastMiddleDown=+new Date),i&&bc(e.doc,i),setTimeout(ce(ob,e),20),void Hd(a)}if(!i)return void(Ld(a)==f.scroller&&Hd(a));e.state.focused||Ib(e);var j=+new Date,k="single";if(Te&&Te.time>j-400&&Wb(Te.pos,i))k="triple",Hd(a),setTimeout(ce(ob,e),20),rc(e,i.line);else if(Se&&Se.time>j-400&&Wb(Se.pos,i)){k="double",Te={time:j,pos:i},Hd(a);var l=qc(nd(g,i.line).text,i);bc(e.doc,l.from,l.to)}else Se={time:j,pos:i};var m=i;if(e.options.dragDrop&&Ef&&!pb(e)&&!Wb(h.from,h.to)&&!Xb(i,h.from)&&!Xb(h.to,i)&&"single"==k){var n=gb(e,function(b){De&&(f.scroller.draggable=!1),e.state.draggingText=!1,Od(document,"mouseup",n),Od(f.scroller,"drop",n),Math.abs(a.clientX-b.clientX)+Math.abs(a.clientY-b.clientY)<10&&(Hd(b),bc(e.doc,i),ob(e))});return De&&(f.scroller.draggable=!0),e.state.draggingText=n,f.scroller.dragDrop&&f.scroller.dragDrop(),Nd(document,"mouseup",n),void Nd(f.scroller,"drop",n)}Hd(a),"single"==k&&bc(e.doc,$b(g,i));var p=h.from,q=h.to,r=i,s=je(f.wrapper),t=0,u=gb(e,function(a){Ae||Md(a)?c(a):d(a)}),v=gb(e,d);Nd(document,"mousemove",u),Nd(document,"mouseup",v)}}}function ub(a,b,c,d,e){try{var f=b.clientX,g=b.clientY}catch(b){return!1}if(f>=Math.floor(je(a.display.gutters).right))return!1;d&&Hd(b);var h=a.display,i=je(h.lineDiv);if(g>i.bottom||!Td(a,c))return Jd(b);g-=i.top-h.viewOffset;for(var j=0;j<a.options.gutters.length;++j){var k=h.gutters.childNodes[j];if(k&&je(k).right>=f){var l=sd(a.doc,g),m=a.options.gutters[j];return e(a,c,a,l,m,b),Jd(b)}}}function vb(a,b){return Td(a,"gutterContextMenu")?ub(a,b,"gutterContextMenu",!1,Pd):!1}function wb(a,b){return ub(a,b,"gutterClick",!0,Qd)}function xb(a){var b=this;if(!(Rd(b,a)||rb(b.display,a)||b.options.onDragEvent&&b.options.onDragEvent(b,Gd(a)))){Hd(a),Ae&&(Ze=+new Date);var c=sb(b,a,!0),d=a.dataTransfer.files;if(c&&!pb(b))if(d&&d.length&&window.FileReader&&window.File)for(var e=d.length,f=Array(e),g=0,h=function(a,d){var h=new FileReader;h.onload=function(){f[d]=h.result,++g==e&&(c=$b(b.doc,c),Ob(b.doc,{from:c,to:c,text:Hf(f.join("\n")),origin:"paste"},"around"))},h.readAsText(a)},i=0;e>i;++i)h(d[i],i);else{if(b.state.draggingText&&!Xb(c,b.doc.sel.from)&&!Xb(b.doc.sel.to,c))return b.state.draggingText(a),void setTimeout(ce(ob,b),20);try{var f=a.dataTransfer.getData("Text");if(f){var j=b.doc.sel.from,k=b.doc.sel.to;dc(b.doc,c,c),b.state.draggingText&&Ub(b.doc,"",j,k,"paste"),b.replaceSelection(f,null,"paste"),ob(b),Ib(b)}}catch(a){}}}}function yb(a,b){if(Ae&&(!a.state.draggingText||+new Date-Ze<100))return void Kd(b);if(!Rd(a,b)&&!rb(a.display,b)){var c=a.getSelection();if(b.dataTransfer.setData("Text",c),b.dataTransfer.setDragImage&&!He){var d=fe("img",null,null,"position: fixed; left: 0; top: 0;");d.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",Ge&&(d.width=d.height=1,a.display.wrapper.appendChild(d),d._top=d.offsetTop),b.dataTransfer.setDragImage(d,0,0),Ge&&d.parentNode.removeChild(d)}}}function zb(a,b){Math.abs(a.doc.scrollTop-b)<2||(a.doc.scrollTop=b,ze||t(a,[],b),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbarV.scrollTop!=b&&(a.display.scrollbarV.scrollTop=b),ze&&t(a,[]),G(a,100))}function Ab(a,b,c){(c?b==a.doc.scrollLeft:Math.abs(a.doc.scrollLeft-b)<2)||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,p(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbarH.scrollLeft!=b&&(a.display.scrollbarH.scrollLeft=b))}function Bb(a,b){var c=b.wheelDeltaX,d=b.wheelDeltaY;null==c&&b.detail&&b.axis==b.HORIZONTAL_AXIS&&(c=b.detail),null==d&&b.detail&&b.axis==b.VERTICAL_AXIS?d=b.detail:null==d&&(d=b.wheelDelta);var e=a.display,f=e.scroller;if(c&&f.scrollWidth>f.clientWidth||d&&f.scrollHeight>f.clientHeight){if(d&&Oe&&De)for(var g=b.target;g!=f;g=g.parentNode)if(g.lineObj){a.display.currentWheelTarget=g;break}if(c&&!ze&&!Ge&&null!=_e)return d&&zb(a,Math.max(0,Math.min(f.scrollTop+d*_e,f.scrollHeight-f.clientHeight))),Ab(a,Math.max(0,Math.min(f.scrollLeft+c*_e,f.scrollWidth-f.clientWidth))),Hd(b),void(e.wheelStartX=null);
if(d&&null!=_e){var h=d*_e,i=a.doc.scrollTop,j=i+e.wrapper.clientHeight;0>h?i=Math.max(0,i+h-50):j=Math.min(a.doc.height,j+h+50),t(a,[],{top:i,bottom:j})}20>$e&&(null==e.wheelStartX?(e.wheelStartX=f.scrollLeft,e.wheelStartY=f.scrollTop,e.wheelDX=c,e.wheelDY=d,setTimeout(function(){if(null!=e.wheelStartX){var a=f.scrollLeft-e.wheelStartX,b=f.scrollTop-e.wheelStartY,c=b&&e.wheelDY&&b/e.wheelDY||a&&e.wheelDX&&a/e.wheelDX;e.wheelStartX=e.wheelStartY=null,c&&(_e=(_e*$e+c)/($e+1),++$e)}},200)):(e.wheelDX+=c,e.wheelDY+=d))}}function Cb(a,b,c){if("string"==typeof b&&(b=nf[b],!b))return!1;a.display.pollingFast&&mb(a)&&(a.display.pollingFast=!1);var d=a.doc,e=d.sel.shift,f=!1;try{pb(a)&&(a.state.suppressEdits=!0),c&&(d.sel.shift=!1),f=b(a)!=Af}finally{d.sel.shift=e,a.state.suppressEdits=!1}return f}function Db(a){var b=a.state.keyMaps.slice(0);return a.options.extraKeys&&b.push(a.options.extraKeys),b.push(a.options.keyMap),b}function Eb(a,b){var c=vc(a.options.keyMap),d=c.auto;clearTimeout(af),d&&!xc(b)&&(af=setTimeout(function(){vc(a.options.keyMap)==c&&(a.options.keyMap=d.call?d.call(null,a):d,g(a))},50));var e=yc(b,!0),f=!1;if(!e)return!1;var h=Db(a);return f=b.shiftKey?wc("Shift-"+e,h,function(b){return Cb(a,b,!0)})||wc(e,h,function(b){return("string"==typeof b?/^go[A-Z]/.test(b):b.motion)?Cb(a,b):void 0}):wc(e,h,function(b){return Cb(a,b)}),f&&(Hd(b),F(a),Ce&&(b.oldKeyCode=b.keyCode,b.keyCode=0),Qd(a,"keyHandled",a,e,b)),f}function Fb(a,b,c){var d=wc("'"+c+"'",Db(a),function(b){return Cb(a,b,!0)});return d&&(Hd(b),F(a),Qd(a,"keyHandled",a,"'"+c+"'",b)),d}function Gb(a){var b=this;if(b.state.focused||Ib(b),!(Rd(b,a)||b.options.onKeyEvent&&b.options.onKeyEvent(b,Gd(a)))){Ae&&27==a.keyCode&&(a.returnValue=!1);var c=a.keyCode;b.doc.sel.shift=16==c||a.shiftKey;var d=Eb(b,a);Ge&&(cf=d?c:null,!d&&88==c&&!Jf&&(Oe?a.metaKey:a.ctrlKey)&&b.replaceSelection(""))}}function Hb(a){var b=this;if(!(Rd(b,a)||b.options.onKeyEvent&&b.options.onKeyEvent(b,Gd(a)))){var c=a.keyCode,d=a.charCode;if(Ge&&c==cf)return cf=null,void Hd(a);if(!(Ge&&(!a.which||a.which<10)||Ie)||!Eb(b,a)){var e=String.fromCharCode(null==d?c:d);this.options.electricChars&&this.doc.mode.electricChars&&this.options.smartIndent&&!pb(this)&&this.doc.mode.electricChars.indexOf(e)>-1&&setTimeout(gb(b,function(){mc(b,b.doc.sel.to.line,"smart")}),75),Fb(b,a,e)||(Ae&&!Ce&&(b.display.inputHasSelection=null),lb(b))}}}function Ib(a){"nocursor"!=a.options.readOnly&&(a.state.focused||(Pd(a,"focus",a),a.state.focused=!0,-1==a.display.wrapper.className.search(/\bCodeMirror-focused\b/)&&(a.display.wrapper.className+=" CodeMirror-focused"),a.curOp||(nb(a,!0),De&&setTimeout(ce(nb,a,!0),0))),kb(a),F(a))}function Jb(a){a.state.focused&&(Pd(a,"blur",a),a.state.focused=!1,a.display.wrapper.className=a.display.wrapper.className.replace(" CodeMirror-focused","")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.doc.sel.shift=!1)},150)}function Kb(a,b){function c(){if(null!=e.input.selectionStart){var a=e.input.value=""+(Wb(f.from,f.to)?"":e.input.value);e.prevInput="",e.input.selectionStart=1,e.input.selectionEnd=a.length}}function d(){if(e.inputDiv.style.position="relative",e.input.style.cssText=j,Ce&&(e.scrollbarV.scrollTop=e.scroller.scrollTop=h),kb(a),null!=e.input.selectionStart){(!Ae||Ce)&&c(),clearTimeout(bf);var b=0,d=function(){" "==e.prevInput&&0==e.input.selectionStart?gb(a,nf.selectAll)(a):b++<10?bf=setTimeout(d,500):nb(a)};bf=setTimeout(d,200)}}if(!Rd(a,b,"contextmenu")){var e=a.display,f=a.doc.sel;if(!rb(e,b)&&!vb(a,b)){var g=sb(a,b),h=e.scroller.scrollTop;if(g&&!Ge){var i=a.options.resetSelectionOnContextMenu;i&&(Wb(f.from,f.to)||Xb(g,f.from)||!Xb(g,f.to))&&gb(a,dc)(a.doc,g,g);var j=e.input.style.cssText;if(e.inputDiv.style.position="absolute",e.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(b.clientY-5)+"px; left: "+(b.clientX-5)+"px; z-index: 1000; background: white; outline: none;border-width: 0; outline: none; overflow: hidden; opacity: .05; -ms-opacity: .05; filter: alpha(opacity=5);",ob(a),nb(a,!0),Wb(f.from,f.to)&&(e.input.value=e.prevInput=" "),Ae&&!Ce&&c(),Ve){Kd(b);var k=function(){Od(window,"mouseup",k),setTimeout(d,20)};Nd(window,"mouseup",k)}else setTimeout(d,50)}}}}function Lb(a,b,c){if(!Xb(b.from,c))return $b(a,c);var d=b.text.length-1-(b.to.line-b.from.line);if(c.line>b.to.line+d){var e=c.line-d,f=a.first+a.size-1;return e>f?Vb(f,nd(a,f).text.length):_b(c,nd(a,e).text.length)}if(c.line==b.to.line+d)return _b(c,Yd(b.text).length+(1==b.text.length?b.from.ch:0)+nd(a,b.to.line).text.length-b.to.ch);var g=c.line-b.from.line;return _b(c,b.text[g].length+(g?0:b.from.ch))}function Mb(a,b,c){if(c&&"object"==typeof c)return{anchor:Lb(a,b,c.anchor),head:Lb(a,b,c.head)};if("start"==c)return{anchor:b.from,head:b.from};var d=df(b);if("around"==c)return{anchor:b.from,head:d};if("end"==c)return{anchor:d,head:d};var e=function(a){if(Xb(a,b.from))return a;if(!Xb(b.to,a))return d;var c=a.line+b.text.length-(b.to.line-b.from.line)-1,e=a.ch;return a.line==b.to.line&&(e+=d.ch-b.to.ch),Vb(c,e)};return{anchor:e(a.sel.anchor),head:e(a.sel.head)}}function Nb(a,b,c){var d={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){this.canceled=!0}};return c&&(d.update=function(b,c,d,e){b&&(this.from=$b(a,b)),c&&(this.to=$b(a,c)),d&&(this.text=d),void 0!==e&&(this.origin=e)}),Pd(a,"beforeChange",a,d),a.cm&&Pd(a.cm,"beforeChange",a.cm,d),d.canceled?null:{from:d.from,to:d.to,text:d.text,origin:d.origin}}function Ob(a,b,c,d){if(a.cm){if(!a.cm.curOp)return gb(a.cm,Ob)(a,b,c,d);if(a.cm.state.suppressEdits)return}if(!(Td(a,"beforeChange")||a.cm&&Td(a.cm,"beforeChange"))||(b=Nb(a,b,!0))){var e=We&&!d&&Lc(a,b.from,b.to);if(e){for(var f=e.length-1;f>=1;--f)Pb(a,{from:e[f].from,to:e[f].to,text:[""]});e.length&&Pb(a,{from:e[0].from,to:e[0].to,text:b.text},c)}else Pb(a,b,c)}}function Pb(a,b,c){if(1!=b.text.length||""!=b.text[0]||!Wb(b.from,b.to)){var d=Mb(a,b,c);yd(a,b,d,a.cm?a.cm.curOp.id:0/0),Sb(a,b,d,Jc(a,b));var e=[];ld(a,function(a,c){c||-1!=$d(e,a.history)||(Ed(a.history,b),e.push(a.history)),Sb(a,b,null,Jc(a,b))})}}function Qb(a,b){if(!a.cm||!a.cm.state.suppressEdits){var c=a.history,d=("undo"==b?c.done:c.undone).pop();if(d){var e={changes:[],anchorBefore:d.anchorAfter,headBefore:d.headAfter,anchorAfter:d.anchorBefore,headAfter:d.headBefore,generation:c.generation};("undo"==b?c.undone:c.done).push(e),c.generation=d.generation||++c.maxGeneration;for(var f=Td(a,"beforeChange")||a.cm&&Td(a.cm,"beforeChange"),g=d.changes.length-1;g>=0;--g){var h=d.changes[g];if(h.origin=b,f&&!Nb(a,h,!1))return void(("undo"==b?c.done:c.undone).length=0);e.changes.push(xd(a,h));var i=g?Mb(a,h,null):{anchor:d.anchorBefore,head:d.headBefore};Sb(a,h,i,Kc(a,h));var j=[];ld(a,function(a,b){b||-1!=$d(j,a.history)||(Ed(a.history,h),j.push(a.history)),Sb(a,h,null,Kc(a,h))})}}}}function Rb(a,b){function c(a){return Vb(a.line+b,a.ch)}a.first+=b,a.cm&&jb(a.cm,a.first,a.first,b),a.sel.head=c(a.sel.head),a.sel.anchor=c(a.sel.anchor),a.sel.from=c(a.sel.from),a.sel.to=c(a.sel.to)}function Sb(a,b,c,d){if(a.cm&&!a.cm.curOp)return gb(a.cm,Sb)(a,b,c,d);if(b.to.line<a.first)return void Rb(a,b.text.length-1-(b.to.line-b.from.line));if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var e=b.text.length-1-(a.first-b.from.line);Rb(a,e),b={from:Vb(a.first,0),to:Vb(b.to.line+e,b.to.ch),text:[Yd(b.text)],origin:b.origin}}var f=a.lastLine();b.to.line>f&&(b={from:b.from,to:Vb(f,nd(a,f).text.length),text:[b.text[0]],origin:b.origin}),b.removed=od(a,b.from,b.to),c||(c=Mb(a,b,null)),a.cm?Tb(a.cm,b,d,c):id(a,b,d,c)}}function Tb(a,b,c,d){var f=a.doc,g=a.display,h=b.from,i=b.to,j=!1,l=h.line;a.options.lineWrapping||(l=rd(Pc(f,nd(f,h.line))),f.iter(l,i.line+1,function(a){return a==g.maxLine?(j=!0,!0):void 0})),Xb(f.sel.head,b.from)||Xb(b.to,f.sel.head)||(a.curOp.cursorActivity=!0),id(f,b,c,d,e(a)),a.options.lineWrapping||(f.iter(l,h.line+b.text.length,function(a){var b=k(f,a);b>g.maxLineLength&&(g.maxLine=a,g.maxLineLength=b,g.maxLineChanged=!0,j=!1)}),j&&(a.curOp.updateMaxLine=!0)),f.frontier=Math.min(f.frontier,h.line),G(a,400);var m=b.text.length-(i.line-h.line)-1;if(jb(a,h.line,i.line+1,m),Td(a,"change")){var n={from:h,to:i,text:b.text,removed:b.removed,origin:b.origin};if(a.curOp.textChanged){for(var o=a.curOp.textChanged;o.next;o=o.next);o.next=n}else a.curOp.textChanged=n}}function Ub(a,b,c,d,e){if(d||(d=c),Xb(d,c)){var f=d;d=c,c=f}"string"==typeof b&&(b=Hf(b)),Ob(a,{from:c,to:d,text:b,origin:e},null)}function Vb(a,b){return this instanceof Vb?(this.line=a,void(this.ch=b)):new Vb(a,b)}function Wb(a,b){return a.line==b.line&&a.ch==b.ch}function Xb(a,b){return a.line<b.line||a.line==b.line&&a.ch<b.ch}function Yb(a){return Vb(a.line,a.ch)}function Zb(a,b){return Math.max(a.first,Math.min(b,a.first+a.size-1))}function $b(a,b){if(b.line<a.first)return Vb(a.first,0);var c=a.first+a.size-1;return b.line>c?Vb(c,nd(a,c).text.length):_b(b,nd(a,b.line).text.length)}function _b(a,b){var c=a.ch;return null==c||c>b?Vb(a.line,b):0>c?Vb(a.line,0):a}function ac(a,b){return b>=a.first&&b<a.first+a.size}function bc(a,b,c,d){if(a.sel.shift||a.sel.extend){var e=a.sel.anchor;if(c){var f=Xb(b,e);f!=Xb(c,e)?(e=b,b=c):f!=Xb(b,c)&&(b=c)}dc(a,e,b,d)}else dc(a,b,c||b,d);a.cm&&(a.cm.curOp.userSelChange=!0)}function cc(a,b,c){var d={anchor:b,head:c};return Pd(a,"beforeSelectionChange",a,d),a.cm&&Pd(a.cm,"beforeSelectionChange",a.cm,d),d.anchor=$b(a,d.anchor),d.head=$b(a,d.head),d}function dc(a,b,c,d,e){if(!e&&Td(a,"beforeSelectionChange")||a.cm&&Td(a.cm,"beforeSelectionChange")){var f=cc(a,b,c);c=f.head,b=f.anchor}var g=a.sel;if(g.goalColumn=null,null==d&&(d=Xb(c,g.head)?-1:1),(e||!Wb(b,g.anchor))&&(b=fc(a,b,d,"push"!=e)),(e||!Wb(c,g.head))&&(c=fc(a,c,d,"push"!=e)),!Wb(g.anchor,b)||!Wb(g.head,c)){g.anchor=b,g.head=c;var h=Xb(c,b);g.from=h?c:b,g.to=h?b:c,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=a.cm.curOp.cursorActivity=!0),Qd(a,"cursorActivity",a)}}function ec(a){dc(a.doc,a.doc.sel.from,a.doc.sel.to,null,"push")}function fc(a,b,c,d){var e=!1,f=b,g=c||1;a.cantEdit=!1;a:for(;;){var h=nd(a,f.line);if(h.markedSpans)for(var i=0;i<h.markedSpans.length;++i){var j=h.markedSpans[i],k=j.marker;if((null==j.from||(k.inclusiveLeft?j.from<=f.ch:j.from<f.ch))&&(null==j.to||(k.inclusiveRight?j.to>=f.ch:j.to>f.ch))){if(d&&(Pd(k,"beforeCursorEnter"),k.explicitlyCleared)){if(h.markedSpans){--i;continue}break}if(!k.atomic)continue;var l=k.find()[0>g?"from":"to"];if(Wb(l,f)&&(l.ch+=g,l.ch<0?l=l.line>a.first?$b(a,Vb(l.line-1)):null:l.ch>h.text.length&&(l=l.line<a.first+a.size-1?Vb(l.line+1,0):null),!l)){if(e)return d?(a.cantEdit=!0,Vb(a.first,0)):fc(a,b,c,!0);e=!0,l=b,g=-g}f=l;continue a}}return f}}function gc(a){var b=hc(a,a.doc.sel.head,null,a.options.cursorScrollMargin);if(a.state.focused){var c=a.display,d=je(c.sizer),e=null;if(b.top+d.top<0?e=!0:b.bottom+d.top>(window.innerHeight||document.documentElement.clientHeight)&&(e=!1),null!=e&&!Le){var f="none"==c.cursor.style.display;f&&(c.cursor.style.display="",c.cursor.style.left=b.left+"px",c.cursor.style.top=b.top-c.viewOffset+"px"),c.cursor.scrollIntoView(e),f&&(c.cursor.style.display="none")}}}function hc(a,b,c,d){for(null==d&&(d=0);;){var e=!1,f=$(a,b),g=c&&c!=b?$(a,c):f,h=jc(a,Math.min(f.left,g.left),Math.min(f.top,g.top)-d,Math.max(f.left,g.left),Math.max(f.bottom,g.bottom)+d),i=a.doc.scrollTop,j=a.doc.scrollLeft;if(null!=h.scrollTop&&(zb(a,h.scrollTop),Math.abs(a.doc.scrollTop-i)>1&&(e=!0)),null!=h.scrollLeft&&(Ab(a,h.scrollLeft),Math.abs(a.doc.scrollLeft-j)>1&&(e=!0)),!e)return f}}function ic(a,b,c,d,e){var f=jc(a,b,c,d,e);null!=f.scrollTop&&zb(a,f.scrollTop),null!=f.scrollLeft&&Ab(a,f.scrollLeft)}function jc(a,b,c,d,e){var f=a.display,g=cb(a.display);0>c&&(c=0);var h=f.scroller.clientHeight-zf,i=f.scroller.scrollTop,j={},k=a.doc.height+L(f),l=g>c,m=e>k-g;if(i>c)j.scrollTop=l?0:c;else if(e>i+h){var n=Math.min(c,(m?k:e)-h);n!=i&&(j.scrollTop=n)}var o=f.scroller.clientWidth-zf,p=f.scroller.scrollLeft;b+=f.gutters.offsetWidth,d+=f.gutters.offsetWidth;var q=f.gutters.offsetWidth,r=q+10>b;return p+q>b||r?(r&&(b=0),j.scrollLeft=Math.max(0,b-10-q)):d>o+p-3&&(j.scrollLeft=d+10-o),j}function kc(a,b,c){a.curOp.updateScrollPos={scrollLeft:null==b?a.doc.scrollLeft:b,scrollTop:null==c?a.doc.scrollTop:c}}function lc(a,b,c){var d=a.curOp.updateScrollPos||(a.curOp.updateScrollPos={scrollLeft:a.doc.scrollLeft,scrollTop:a.doc.scrollTop}),e=a.display.scroller;d.scrollTop=Math.max(0,Math.min(e.scrollHeight-e.clientHeight,d.scrollTop+c)),d.scrollLeft=Math.max(0,Math.min(e.scrollWidth-e.clientWidth,d.scrollLeft+b))}function mc(a,b,c,d){var e=a.doc;if(null==c&&(c="add"),"smart"==c)if(a.doc.mode.indent)var f=J(a,b);else c="prev";var g,h=a.options.tabSize,i=nd(e,b),j=Wd(i.text,null,h),k=i.text.match(/^\s*/)[0];if("smart"==c&&(g=a.doc.mode.indent(f,i.text.slice(k.length),i.text),g==Af)){if(!d)return;c="prev"}"prev"==c?g=b>e.first?Wd(nd(e,b-1).text,null,h):0:"add"==c?g=j+a.options.indentUnit:"subtract"==c?g=j-a.options.indentUnit:"number"==typeof c&&(g=j+c),g=Math.max(0,g);var l="",m=0;if(a.options.indentWithTabs)for(var n=Math.floor(g/h);n;--n)m+=h,l+="	";g>m&&(l+=Xd(g-m)),l!=k&&Ub(a.doc,l,Vb(b,0),Vb(b,k.length),"+input"),i.stateAfter=null}function nc(a,b,c){var d=b,e=b,f=a.doc;return"number"==typeof b?e=nd(f,Zb(f,b)):d=rd(b),null==d?null:c(e,d)?(jb(a,d,d+1),e):null}function oc(a,b,c,d,e){function f(){var b=h+c;return b<a.first||b>=a.first+a.size?l=!1:(h=b,k=nd(a,b))}function g(a){var b=(e?xe:ye)(k,i,c,!0);if(null==b){if(a||!f())return l=!1;i=e?(0>c?re:qe)(k):0>c?k.text.length:0}else i=b;return!0}var h=b.line,i=b.ch,j=c,k=nd(a,h),l=!0;if("char"==d)g();else if("column"==d)g(!0);else if("word"==d||"group"==d)for(var m=null,n="group"==d,o=!0;!(0>c)||g(!o);o=!1){var p=k.text.charAt(i)||"\n",q=de(p)?"w":n?/\s/.test(p)?null:"p":null;if(m&&m!=q){0>c&&(c=1,g());break}if(q&&(m=q),c>0&&!g(!o))break}var r=fc(a,Vb(h,i),j,!0);return l||(r.hitSide=!0),r}function pc(a,b,c,d){var e,f=a.doc,g=b.left;if("page"==d){var h=Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);e=b.top+c*(h-(0>c?1.5:.5)*cb(a.display))}else"line"==d&&(e=c>0?b.bottom+3:b.top-3);for(;;){var i=ab(a,g,e);if(!i.outside)break;if(0>c?0>=e:e>=f.height){i.hitSide=!0;break}e+=5*c}return i}function qc(a,b){var c=b.ch,d=b.ch;if(a){(b.xRel<0||d==a.length)&&c?--c:++d;for(var e=a.charAt(c),f=de(e)?de:/\s/.test(e)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!de(a)};c>0&&f(a.charAt(c-1));)--c;for(;d<a.length&&f(a.charAt(d));)++d}return{from:Vb(b.line,c),to:Vb(b.line,d)}}function rc(a,b){bc(a.doc,Vb(b,0),$b(a.doc,Vb(b+1,0)))}function sc(b,c,d,e){a.defaults[b]=c,d&&(ef[b]=e?function(a,b,c){c!=gf&&d(a,b,c)}:d)}function tc(a,b){if(b===!0)return b;if(a.copyState)return a.copyState(b);var c={};for(var d in b){var e=b[d];e instanceof Array&&(e=e.concat([])),c[d]=e}return c}function uc(a,b,c){return a.startState?a.startState(b,c):!0}function vc(a){return"string"==typeof a?of[a]:a}function wc(a,b,c){function d(b){b=vc(b);var e=b[a];if(e===!1)return"stop";if(null!=e&&c(e))return!0;if(b.nofallthrough)return"stop";var f=b.fallthrough;if(null==f)return!1;if("[object Array]"!=Object.prototype.toString.call(f))return d(f);for(var g=0,h=f.length;h>g;++g){var i=d(f[g]);if(i)return i}return!1}for(var e=0;e<b.length;++e){var f=d(b[e]);if(f)return"stop"!=f}}function xc(a){var b=Kf[a.keyCode];return"Ctrl"==b||"Alt"==b||"Shift"==b||"Mod"==b}function yc(a,b){if(Ge&&34==a.keyCode&&a["char"])return!1;var c=Kf[a.keyCode];return null==c||a.altGraphKey?!1:(a.altKey&&(c="Alt-"+c),(Ue?a.metaKey:a.ctrlKey)&&(c="Ctrl-"+c),(Ue?a.ctrlKey:a.metaKey)&&(c="Cmd-"+c),!b&&a.shiftKey&&(c="Shift-"+c),c)}function zc(a,b){this.pos=this.start=0,this.string=a,this.tabSize=b||8,this.lastColumnPos=this.lastColumnValue=0}function Ac(a,b){this.lines=[],this.type=b,this.doc=a}function Bc(a,b,c,d,e){if(d&&d.shared)return Dc(a,b,c,d,e);if(a.cm&&!a.cm.curOp)return gb(a.cm,Bc)(a,b,c,d,e);var f=new Ac(a,e);if("range"==e&&!Xb(b,c))return f;d&&ae(d,f),f.replacedWith&&(f.collapsed=!0,f.replacedWith=fe("span",[f.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||(f.replacedWith.ignoreEvents=!0)),f.collapsed&&(Xe=!0),f.addToHistory&&yd(a,{from:b,to:c,origin:"markText"},{head:a.sel.head,anchor:a.sel.anchor},0/0);var g,h,i,j=b.line,k=0,l=a.cm;if(a.iter(j,c.line+1,function(d){l&&f.collapsed&&!l.options.lineWrapping&&Pc(a,d)==l.display.maxLine&&(i=!0);var e={from:null,to:null,marker:f};k+=d.text.length,j==b.line&&(e.from=b.ch,k-=b.ch),j==c.line&&(e.to=c.ch,k-=d.text.length-c.ch),f.collapsed&&(j==c.line&&(h=Mc(d,c.ch)),j==b.line?g=Mc(d,b.ch):qd(d,0)),Gc(d,e),++j}),f.collapsed&&a.iter(b.line,c.line+1,function(b){Qc(a,b)&&qd(b,0)}),f.clearOnEnter&&Nd(f,"beforeCursorEnter",function(){f.clear()}),f.readOnly&&(We=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory()),f.collapsed){if(g!=h)throw new Error("Inserting collapsed marker overlapping an existing one");f.size=k,f.atomic=!0}return l&&(i&&(l.curOp.updateMaxLine=!0),(f.className||f.title||f.startStyle||f.endStyle||f.collapsed)&&jb(l,b.line,c.line+1),f.atomic&&ec(l)),f}function Cc(a,b){this.markers=a,this.primary=b;for(var c=0,d=this;c<a.length;++c)a[c].parent=this,Nd(a[c],"clear",function(){d.clear()})}function Dc(a,b,c,d,e){d=ae(d),d.shared=!1;var f=[Bc(a,b,c,d,e)],g=f[0],h=d.replacedWith;return ld(a,function(a){h&&(d.replacedWith=h.cloneNode(!0)),f.push(Bc(a,$b(a,b),$b(a,c),d,e));for(var i=0;i<a.linked.length;++i)if(a.linked[i].isParent)return;g=Yd(f)}),new Cc(f,g)}function Ec(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function Fc(a,b){for(var c,d=0;d<a.length;++d)a[d]!=b&&(c||(c=[])).push(a[d]);return c}function Gc(a,b){a.markedSpans=a.markedSpans?a.markedSpans.concat([b]):[b],b.marker.attachLine(a)}function Hc(a,b,c){if(a)for(var d,e=0;e<a.length;++e){var f=a[e],g=f.marker,h=null==f.from||(g.inclusiveLeft?f.from<=b:f.from<b);if(h||"bookmark"==g.type&&f.from==b&&(!c||!f.marker.insertLeft)){var i=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);(d||(d=[])).push({from:f.from,to:i?null:f.to,marker:g})}}return d}function Ic(a,b,c){if(a)for(var d,e=0;e<a.length;++e){var f=a[e],g=f.marker,h=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);if(h||"bookmark"==g.type&&f.from==b&&(!c||f.marker.insertLeft)){var i=null==f.from||(g.inclusiveLeft?f.from<=b:f.from<b);(d||(d=[])).push({from:i?null:f.from-b,to:null==f.to?null:f.to-b,marker:g})}}return d}function Jc(a,b){var c=ac(a,b.from.line)&&nd(a,b.from.line).markedSpans,d=ac(a,b.to.line)&&nd(a,b.to.line).markedSpans;if(!c&&!d)return null;var e=b.from.ch,f=b.to.ch,g=Wb(b.from,b.to),h=Hc(c,e,g),i=Ic(d,f,g),j=1==b.text.length,k=Yd(b.text).length+(j?e:0);if(h)for(var l=0;l<h.length;++l){var m=h[l];if(null==m.to){var n=Ec(i,m.marker);n?j&&(m.to=null==n.to?null:n.to+k):m.to=e}}if(i)for(var l=0;l<i.length;++l){var m=i[l];if(null!=m.to&&(m.to+=k),null==m.from){var n=Ec(h,m.marker);n||(m.from=k,j&&(h||(h=[])).push(m))}else m.from+=k,j&&(h||(h=[])).push(m)}if(j&&h){for(var l=0;l<h.length;++l)null!=h[l].from&&h[l].from==h[l].to&&"bookmark"!=h[l].marker.type&&h.splice(l--,1);h.length||(h=null)}var o=[h];if(!j){var p,q=b.text.length-2;if(q>0&&h)for(var l=0;l<h.length;++l)null==h[l].to&&(p||(p=[])).push({from:null,to:null,marker:h[l].marker});for(var l=0;q>l;++l)o.push(p);o.push(i)}return o}function Kc(a,b){var c=Ad(a,b),d=Jc(a,b);if(!c)return d;if(!d)return c;for(var e=0;e<c.length;++e){var f=c[e],g=d[e];if(f&&g)a:for(var h=0;h<g.length;++h){for(var i=g[h],j=0;j<f.length;++j)if(f[j].marker==i.marker)continue a;f.push(i)}else g&&(c[e]=g)}return c}function Lc(a,b,c){var d=null;if(a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&-1!=$d(d,c)||(d||(d=[])).push(c)}}),!d)return null;for(var e=[{from:b,to:c}],f=0;f<d.length;++f)for(var g=d[f],h=g.find(),i=0;i<e.length;++i){var j=e[i];if(!Xb(j.to,h.from)&&!Xb(h.to,j.from)){var k=[i,1];(Xb(j.from,h.from)||!g.inclusiveLeft&&Wb(j.from,h.from))&&k.push({from:j.from,to:h.from}),(Xb(h.to,j.to)||!g.inclusiveRight&&Wb(j.to,h.to))&&k.push({from:h.to,to:j.to}),e.splice.apply(e,k),i+=k.length-1}}return e}function Mc(a,b){var c,d=Xe&&a.markedSpans;if(d)for(var e,f=0;f<d.length;++f)e=d[f],e.marker.collapsed&&(null==e.from||e.from<b)&&(null==e.to||e.to>b)&&(!c||c.width<e.marker.width)&&(c=e.marker);return c}function Nc(a){return Mc(a,-1)}function Oc(a){return Mc(a,a.text.length+1)}function Pc(a,b){for(var c;c=Nc(b);)b=nd(a,c.find().from.line);return b}function Qc(a,b){var c=Xe&&b.markedSpans;if(c)for(var d,e=0;e<c.length;++e)if(d=c[e],d.marker.collapsed){if(null==d.from)return!0;if(!d.marker.replacedWith&&0==d.from&&d.marker.inclusiveLeft&&Rc(a,b,d))return!0}}function Rc(a,b,c){if(null==c.to){var d=c.marker.find().to,e=nd(a,d.line);return Rc(a,e,Ec(e.markedSpans,c.marker))}if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var f,g=0;g<b.markedSpans.length;++g)if(f=b.markedSpans[g],f.marker.collapsed&&!f.marker.replacedWith&&f.from==c.to&&(f.marker.inclusiveLeft||c.marker.inclusiveRight)&&Rc(a,b,f))return!0}function Sc(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function Tc(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function Uc(a){return function(){var b=!this.cm.curOp;b&&eb(this.cm);try{var c=a.apply(this,arguments)}finally{b&&fb(this.cm)}return c}}function Vc(a){return null!=a.height?a.height:(a.node.parentNode&&1==a.node.parentNode.nodeType||he(a.cm.display.measure,fe("div",[a.node],null,"position: relative")),a.height=a.node.offsetHeight)}function Wc(a,b,c,d){var e=new pf(a,c,d);return e.noHScroll&&(a.display.alignWidgets=!0),nc(a,b,function(b){var c=b.widgets||(b.widgets=[]);if(null==e.insertAt?c.push(e):c.splice(Math.min(c.length-1,Math.max(0,e.insertAt)),0,e),e.line=b,!Qc(a.doc,b)||e.showIfHidden){var d=td(a,b)<a.doc.scrollTop;qd(b,b.height+Vc(e)),d&&lc(a,0,e.height)}return!0}),e}function Xc(a,b,c,d){a.text=b,a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null),null!=a.order&&(a.order=null),Sc(a),Tc(a,c);var e=d?d(a):1;e!=a.height&&qd(a,e)}function Yc(a){a.parent=null,Sc(a)}function Zc(a,b,c,d,e){var f=c.flattenSpans;null==f&&(f=a.options.flattenSpans);var g,h=0,i=null,j=new zc(b,a.options.tabSize);for(""==b&&c.blankLine&&c.blankLine(d);!j.eol();)j.pos>a.options.maxHighlightLength?(f=!1,j.pos=b.length,g=null):g=c.token(j,d),f&&i==g||(h<j.start&&e(j.start,i),h=j.start,i=g),j.start=j.pos;for(;h<j.pos;){var k=Math.min(j.pos,h+5e4);e(k,i),h=k}}function $c(a,b,c){var d=[a.state.modeGen];Zc(a,b.text,a.doc.mode,c,function(a,b){d.push(a,b)});for(var e=0;e<a.state.overlays.length;++e){var f=a.state.overlays[e],g=1,h=0;Zc(a,b.text,f.mode,!0,function(a,b){for(var c=g;a>h;){var e=d[g];e>a&&d.splice(g,1,a,d[g+1],e),g+=2,h=Math.min(a,e)}if(b)if(f.opaque)d.splice(c,g-c,a,b),g=c+2;else for(;g>c;c+=2){var i=d[c+1];d[c+1]=i?i+" "+b:b}})}return d}function _c(a,b){return b.styles&&b.styles[0]==a.state.modeGen||(b.styles=$c(a,b,b.stateAfter=J(a,rd(b)))),b.styles}function ad(a,b,c){var d=a.doc.mode,e=new zc(b.text,a.options.tabSize);for(""==b.text&&d.blankLine&&d.blankLine(c);!e.eol()&&e.pos<=a.options.maxHighlightLength;)d.token(e,c),e.start=e.pos}function bd(a,b){if(!a)return null;for(;;){var c=a.match(/(?:^|\s)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:new RegExp("(?:^|s)"+c[2]+"(?:$|s)").test(b[d])||(b[d]+=" "+c[2])}return rf[a]||(rf[a]="cm-"+a.replace(/ +/g," cm-"))}function cd(a,b,c,d){for(var e,f=b,g=!0;e=Nc(f);)f=nd(a.doc,e.find().from.line);var h={pre:fe("pre"),col:0,pos:0,measure:null,measuredSomething:!1,cm:a,copyWidgets:d};do{f.text&&(g=!1),h.measure=f==b&&c,h.pos=0,h.addToken=h.measure?ed:dd,(Ae||De)&&a.getOption("lineWrapping")&&(h.addToken=fd(h.addToken));var i=hd(f,h,_c(a,f));c&&f==b&&!h.measuredSomething&&(c[0]=h.pre.appendChild(me(a.display.measure)),h.measuredSomething=!0),i&&(f=nd(a.doc,i.to.line))}while(i);!c||h.measuredSomething||c[0]||(c[0]=h.pre.appendChild(g?fe("span",""):me(a.display.measure))),h.pre.firstChild||Qc(a.doc,b)||h.pre.appendChild(document.createTextNode(""));var j;if(c&&Ae&&(j=ud(f))){var k=j.length-1;j[k].from==j[k].to&&--k;var l=j[k],m=j[k-1];if(l.from+1==l.to&&m&&l.level<m.level){var n=c[h.pos-1];n&&n.parentNode.insertBefore(n.measureRight=me(a.display.measure),n.nextSibling)}}var o=h.textClass?h.textClass+" "+(b.textClass||""):b.textClass;return o&&(h.pre.className=o),Pd(a,"renderLine",a,b,h.pre),h}function dd(a,b,c,d,e,f){if(b){if(sf.test(b))for(var g=document.createDocumentFragment(),h=0;;){sf.lastIndex=h;var i=sf.exec(b),j=i?i.index-h:b.length-h;if(j&&(g.appendChild(document.createTextNode(b.slice(h,h+j))),a.col+=j),!i)break;if(h+=j+1,"	"==i[0]){var k=a.cm.options.tabSize,l=k-a.col%k;g.appendChild(fe("span",Xd(l),"cm-tab")),a.col+=l}else{var m=fe("span","","cm-invalidchar");m.title="\\u"+i[0].charCodeAt(0).toString(16),g.appendChild(m),a.col+=1}}else{a.col+=b.length;var g=document.createTextNode(b)}if(c||d||e||a.measure){var n=c||"";d&&(n+=d),e&&(n+=e);var m=fe("span",[g],n);return f&&(m.title=f),a.pre.appendChild(m)}a.pre.appendChild(g)}}function ed(a,b,c,d,e){for(var f=a.cm.options.lineWrapping,g=0;g<b.length;++g){var h=b.charAt(g),i=0==g;h>=""&&"">h&&g<b.length-1?(h=b.slice(g,g+2),++g):g&&f&&ke(b,g)&&a.pre.appendChild(fe("wbr"));var j=a.measure[a.pos],k=a.measure[a.pos]=dd(a,h,c,i&&d,g==b.length-1&&e);j&&(k.leftSide=j.leftSide||j),Ae&&f&&" "==h&&g&&!/\s/.test(b.charAt(g-1))&&g<b.length-1&&!/\s/.test(b.charAt(g+1))&&(k.style.whiteSpace="normal"),a.pos+=h.length}b.length&&(a.measuredSomething=!0)}function fd(a){function b(a){for(var b=" ",c=0;c<a.length-2;++c)b+=c%2?" ":"";return b+=" "}return function(c,d,e,f,g,h){return a(c,d.replace(/ {3,}/g,b),e,f,g,h)}}function gd(a,b,c,d){var e=!d&&c.replacedWith;if(e&&(a.copyWidgets&&(e=e.cloneNode(!0)),a.pre.appendChild(e),a.measure)){if(b)a.measure[a.pos]=e;else{var f=me(a.cm.display.measure);if("bookmark"!=c.type||c.insertLeft){if(a.measure[a.pos])return;a.measure[a.pos]=a.pre.insertBefore(f,e)}else a.measure[a.pos]=a.pre.appendChild(f)}a.measuredSomething=!0}a.pos+=b}function hd(a,b,c){var d=a.markedSpans,e=a.text,f=0;if(d)for(var g,h,i,j,k,l,m=e.length,n=0,o=1,p="",q=0;;){if(q==n){h=i=j=k="",l=null,q=1/0;for(var r=[],s=0;s<d.length;++s){var t=d[s],u=t.marker;t.from<=n&&(null==t.to||t.to>n)?(null!=t.to&&q>t.to&&(q=t.to,i=""),u.className&&(h+=" "+u.className),u.startStyle&&t.from==n&&(j+=" "+u.startStyle),u.endStyle&&t.to==q&&(i+=" "+u.endStyle),u.title&&!k&&(k=u.title),u.collapsed&&(!l||l.marker.size<u.size)&&(l=t)):t.from>n&&q>t.from&&(q=t.from),"bookmark"==u.type&&t.from==n&&u.replacedWith&&r.push(u)}if(l&&(l.from||0)==n&&(gd(b,(null==l.to?m:l.to)-n,l.marker,null==l.from),null==l.to))return l.marker.find();if(!l&&r.length)for(var s=0;s<r.length;++s)gd(b,0,r[s])}if(n>=m)break;for(var v=Math.min(m,q);;){if(p){var w=n+p.length;if(!l){var x=w>v?p.slice(0,v-n):p;b.addToken(b,x,g?g+h:h,j,n+x.length==q?i:"",k)}if(w>=v){p=p.slice(v-n),n=v;break}n=w,j=""}p=e.slice(f,f=c[o++]),g=bd(c[o++],b)}}else for(var o=1;o<c.length;o+=2)b.addToken(b,e.slice(f,f=c[o]),bd(c[o+1],b))}function id(a,b,c,d,e){function f(a){return c?c[a]:null}function g(a,c,d){Xc(a,c,d,e),Qd(a,"change",a,b)}var h=b.from,i=b.to,j=b.text,k=nd(a,h.line),l=nd(a,i.line),m=Yd(j),n=f(j.length-1),o=i.line-h.line;if(0==h.ch&&0==i.ch&&""==m){for(var p=0,q=j.length-1,r=[];q>p;++p)r.push(new qf(j[p],f(p),e));g(l,l.text,n),o&&a.remove(h.line,o),r.length&&a.insert(h.line,r)}else if(k==l)if(1==j.length)g(k,k.text.slice(0,h.ch)+m+k.text.slice(i.ch),n);else{for(var r=[],p=1,q=j.length-1;q>p;++p)r.push(new qf(j[p],f(p),e));r.push(new qf(m+k.text.slice(i.ch),n,e)),g(k,k.text.slice(0,h.ch)+j[0],f(0)),a.insert(h.line+1,r)}else if(1==j.length)g(k,k.text.slice(0,h.ch)+j[0]+l.text.slice(i.ch),f(0)),a.remove(h.line+1,o);else{g(k,k.text.slice(0,h.ch)+j[0],f(0)),g(l,m+l.text.slice(i.ch),n);for(var p=1,q=j.length-1,r=[];q>p;++p)r.push(new qf(j[p],f(p),e));o>1&&a.remove(h.line+1,o-1),a.insert(h.line+1,r)}Qd(a,"change",a,b),dc(a,d.anchor,d.head,null,!0)}function jd(a){this.lines=a,this.parent=null;for(var b=0,c=a.length,d=0;c>b;++b)a[b].parent=this,d+=a[b].height;this.height=d}function kd(a){this.children=a;for(var b=0,c=0,d=0,e=a.length;e>d;++d){var f=a[d];b+=f.chunkSize(),c+=f.height,f.parent=this}this.size=b,this.height=c,this.parent=null}function ld(a,b,c){function d(a,e,f){if(a.linked)for(var g=0;g<a.linked.length;++g){var h=a.linked[g];if(h.doc!=e){var i=f&&h.sharedHist;(!c||i)&&(b(h.doc,i),d(h.doc,a,i))}}}d(a,null,!0)}function md(a,b){if(b.cm)throw new Error("This document is already in use.");a.doc=b,b.cm=a,f(a),c(a),a.options.lineWrapping||l(a),a.options.mode=b.modeOption,jb(a)}function nd(a,b){for(b-=a.first;!a.lines;)for(var c=0;;++c){var d=a.children[c],e=d.chunkSize();if(e>b){a=d;break}b-=e}return a.lines[b]}function od(a,b,c){var d=[],e=b.line;return a.iter(b.line,c.line+1,function(a){var f=a.text;e==c.line&&(f=f.slice(0,c.ch)),e==b.line&&(f=f.slice(b.ch)),d.push(f),++e}),d}function pd(a,b,c){var d=[];return a.iter(b,c,function(a){d.push(a.text)}),d}function qd(a,b){for(var c=b-a.height,d=a;d;d=d.parent)d.height+=c}function rd(a){if(null==a.parent)return null;for(var b=a.parent,c=$d(b.lines,a),d=b.parent;d;b=d,d=d.parent)for(var e=0;d.children[e]!=b;++e)c+=d.children[e].chunkSize();return c+b.first}function sd(a,b){var c=a.first;a:do{for(var d=0,e=a.children.length;e>d;++d){var f=a.children[d],g=f.height;if(g>b){a=f;continue a}b-=g,c+=f.chunkSize()}return c}while(!a.lines);for(var d=0,e=a.lines.length;e>d;++d){var h=a.lines[d],i=h.height;if(i>b)break;b-=i}return c+d}function td(a,b){b=Pc(a.doc,b);for(var c=0,d=b.parent,e=0;e<d.lines.length;++e){var f=d.lines[e];if(f==b)break;c+=f.height}for(var g=d.parent;g;d=g,g=d.parent)for(var e=0;e<g.children.length;++e){var h=g.children[e];if(h==d)break;c+=h.height}return c}function ud(a){var b=a.order;return null==b&&(b=a.order=Mf(a.text)),b}function vd(a){return{done:[],undone:[],undoDepth:1/0,lastTime:0,lastOp:null,lastOrigin:null,generation:a||1,maxGeneration:a||1}}function wd(a,b,c,d){var e=b["spans_"+a.id],f=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((e||(e=b["spans_"+a.id]={}))[f]=c.markedSpans),++f})}function xd(a,b){var c={line:b.from.line,ch:b.from.ch},d={from:c,to:df(b),text:od(a,b.from,b.to)};return wd(a,d,b.from.line,b.to.line+1),ld(a,function(a){wd(a,d,b.from.line,b.to.line+1)},!0),d}function yd(a,b,c,d){var e=a.history;e.undone.length=0;var f=+new Date,g=Yd(e.done);if(g&&(e.lastOp==d||e.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&e.lastTime>f-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0)))){var h=Yd(g.changes);Wb(b.from,b.to)&&Wb(b.from,h.to)?h.to=df(b):g.changes.push(xd(a,b)),g.anchorAfter=c.anchor,g.headAfter=c.head}else for(g={changes:[xd(a,b)],generation:e.generation,anchorBefore:a.sel.anchor,headBefore:a.sel.head,anchorAfter:c.anchor,headAfter:c.head},e.done.push(g),e.generation=++e.maxGeneration;e.done.length>e.undoDepth;)e.done.shift();e.lastTime=f,e.lastOp=d,e.lastOrigin=b.origin}function zd(a){if(!a)return null;for(var b,c=0;c<a.length;++c)a[c].marker.explicitlyCleared?b||(b=a.slice(0,c)):b&&b.push(a[c]);return b?b.length?b:null:a}function Ad(a,b){var c=b["spans_"+a.id];if(!c)return null;for(var d=0,e=[];d<b.text.length;++d)e.push(zd(c[d]));return e}function Bd(a,b){for(var c=0,d=[];c<a.length;++c){var e=a[c],f=e.changes,g=[];d.push({changes:g,anchorBefore:e.anchorBefore,headBefore:e.headBefore,anchorAfter:e.anchorAfter,headAfter:e.headAfter});for(var h=0;h<f.length;++h){var i,j=f[h];if(g.push({from:j.from,to:j.to,text:j.text}),b)for(var k in j)(i=k.match(/^spans_(\d+)$/))&&$d(b,Number(i[1]))>-1&&(Yd(g)[k]=j[k],delete j[k])}}return d}function Cd(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)
}function Dd(a,b,c,d){for(var e=0;e<a.length;++e){for(var f=a[e],g=!0,h=0;h<f.changes.length;++h){var i=f.changes[h];if(f.copied||(i.from=Yb(i.from),i.to=Yb(i.to)),c<i.from.line)i.from.line+=d,i.to.line+=d;else if(b<=i.to.line){g=!1;break}}f.copied||(f.anchorBefore=Yb(f.anchorBefore),f.headBefore=Yb(f.headBefore),f.anchorAfter=Yb(f.anchorAfter),f.readAfter=Yb(f.headAfter),f.copied=!0),g?(Cd(f.anchorBefore),Cd(f.headBefore),Cd(f.anchorAfter),Cd(f.headAfter)):(a.splice(0,e+1),e=0)}}function Ed(a,b){var c=b.from.line,d=b.to.line,e=b.text.length-(d-c)-1;Dd(a.done,c,d,e),Dd(a.undone,c,d,e)}function Fd(){Kd(this)}function Gd(a){return a.stop||(a.stop=Fd),a}function Hd(a){a.preventDefault?a.preventDefault():a.returnValue=!1}function Id(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function Jd(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function Kd(a){Hd(a),Id(a)}function Ld(a){return a.target||a.srcElement}function Md(a){var b=a.which;return null==b&&(1&a.button?b=1:2&a.button?b=3:4&a.button&&(b=2)),Oe&&a.ctrlKey&&1==b&&(b=3),b}function Nd(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent("on"+b,c);else{var d=a._handlers||(a._handlers={}),e=d[b]||(d[b]=[]);e.push(c)}}function Od(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else{var d=a._handlers&&a._handlers[b];if(!d)return;for(var e=0;e<d.length;++e)if(d[e]==c){d.splice(e,1);break}}}function Pd(a,b){var c=a._handlers&&a._handlers[b];if(c)for(var d=Array.prototype.slice.call(arguments,2),e=0;e<c.length;++e)c[e].apply(null,d)}function Qd(a,b){function c(a){return function(){a.apply(null,e)}}var d=a._handlers&&a._handlers[b];if(d){var e=Array.prototype.slice.call(arguments,2);xf||(++yf,xf=[],setTimeout(Sd,0));for(var f=0;f<d.length;++f)xf.push(c(d[f]))}}function Rd(a,b,c){return Pd(a,c||b.type,a,b),Jd(b)||b.codemirrorIgnore}function Sd(){--yf;var a=xf;xf=null;for(var b=0;b<a.length;++b)a[b]()}function Td(a,b){var c=a._handlers&&a._handlers[b];return c&&c.length>0}function Ud(a){a.prototype.on=function(a,b){Nd(this,a,b)},a.prototype.off=function(a,b){Od(this,a,b)}}function Vd(){this.id=null}function Wd(a,b,c,d,e){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));for(var f=d||0,g=e||0;b>f;++f)"	"==a.charAt(f)?g+=c-g%c:++g;return g}function Xd(a){for(;Bf.length<=a;)Bf.push(Yd(Bf)+" ");return Bf[a]}function Yd(a){return a[a.length-1]}function Zd(a){if(Me)a.selectionStart=0,a.selectionEnd=a.value.length;else try{a.select()}catch(b){}}function $d(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;++c)if(a[c]==b)return c;return-1}function _d(a,b){function c(){}c.prototype=a;var d=new c;return b&&ae(b,d),d}function ae(a,b){b||(b={});for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function be(a){for(var b=[],c=0;a>c;++c)b.push(void 0);return b}function ce(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function de(a){return/\w/.test(a)||a>""&&(a.toUpperCase()!=a.toLowerCase()||Cf.test(a))}function ee(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function fe(a,b,c,d){var e=document.createElement(a);if(c&&(e.className=c),d&&(e.style.cssText=d),"string"==typeof b)ie(e,b);else if(b)for(var f=0;f<b.length;++f)e.appendChild(b[f]);return e}function ge(a){for(var b=a.childNodes.length;b>0;--b)a.removeChild(a.firstChild);return a}function he(a,b){return ge(a).appendChild(b)}function ie(a,b){Ce?(a.innerHTML="",a.appendChild(document.createTextNode(b))):a.textContent=b}function je(a){return a.getBoundingClientRect()}function ke(){return!1}function le(a){if(null!=Ff)return Ff;var b=fe("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return he(a,b),b.offsetWidth&&(Ff=b.offsetHeight-b.clientHeight),Ff||0}function me(a){if(null==Gf){var b=fe("span","");he(a,fe("span",[b,document.createTextNode("x")])),0!=a.firstChild.offsetHeight&&(Gf=b.offsetWidth<=1&&b.offsetHeight>2&&!Be)}return Gf?fe("span",""):fe("span","",null,"display: inline-block; width: 1px; margin-right: -1px")}function ne(a,b,c,d){if(!a)return d(b,c,"ltr");for(var e=!1,f=0;f<a.length;++f){var g=a[f];(g.from<c&&g.to>b||b==c&&g.to==b)&&(d(Math.max(g.from,b),Math.min(g.to,c),1==g.level?"rtl":"ltr"),e=!0)}e||d(b,c,"ltr")}function oe(a){return a.level%2?a.to:a.from}function pe(a){return a.level%2?a.from:a.to}function qe(a){var b=ud(a);return b?oe(b[0]):0}function re(a){var b=ud(a);return b?pe(Yd(b)):a.text.length}function se(a,b){var c=nd(a.doc,b),d=Pc(a.doc,c);d!=c&&(b=rd(d));var e=ud(d),f=e?e[0].level%2?re(d):qe(d):0;return Vb(b,f)}function te(a,b){for(var c,d;c=Oc(d=nd(a.doc,b));)b=c.find().to.line;var e=ud(d),f=e?e[0].level%2?qe(d):re(d):d.text.length;return Vb(b,f)}function ue(a,b,c){var d=a[0].level;return b==d?!0:c==d?!1:c>b}function ve(a,b){for(var c,d=0;d<a.length;++d){var e=a[d];if(e.from<b&&e.to>b)return Lf=null,d;if(e.from==b||e.to==b){if(null!=c)return ue(a,e.level,a[c].level)?(Lf=c,d):(Lf=d,c);c=d}}return Lf=null,c}function we(a,b,c,d){if(!d)return b+c;do b+=c;while(b>0&&Df.test(a.text.charAt(b)));return b}function xe(a,b,c,d){var e=ud(a);if(!e)return ye(a,b,c,d);for(var f=ve(e,b),g=e[f],h=we(a,b,g.level%2?-c:c,d);;){if(h>g.from&&h<g.to)return h;if(h==g.from||h==g.to)return ve(e,h)==f?h:(g=e[f+=c],c>0==g.level%2?g.to:g.from);if(g=e[f+=c],!g)return null;h=c>0==g.level%2?we(a,g.to,-1,d):we(a,g.from,1,d)}}function ye(a,b,c,d){var e=b+c;if(d)for(;e>0&&Df.test(a.text.charAt(e));)e+=c;return 0>e||e>a.text.length?null:e}var ze=/gecko\/\d/i.test(navigator.userAgent),Ae=/MSIE \d/.test(navigator.userAgent),Be=Ae&&(null==document.documentMode||document.documentMode<8),Ce=Ae&&(null==document.documentMode||document.documentMode<9),De=/WebKit\//.test(navigator.userAgent),Ee=De&&/Qt\/\d+\.\d+/.test(navigator.userAgent),Fe=/Chrome\//.test(navigator.userAgent),Ge=/Opera\//.test(navigator.userAgent),He=/Apple Computer/.test(navigator.vendor),Ie=/KHTML\//.test(navigator.userAgent),Je=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),Ke=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Le=/PhantomJS/.test(navigator.userAgent),Me=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Ne=Me||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),Oe=Me||/Mac/.test(navigator.platform),Pe=/win/i.test(navigator.platform),Qe=Ge&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);Qe&&(Qe=Number(Qe[1])),Qe&&Qe>=15&&(Ge=!1,De=!0);var Re,Se,Te,Ue=Oe&&(Ee||Ge&&(null==Qe||12.11>Qe)),Ve=ze||Ae&&!Ce,We=!1,Xe=!1,Ye=0,Ze=0,$e=0,_e=null;Ae?_e=-.53:ze?_e=15:Fe?_e=-.7:He&&(_e=-1/3);var af,bf,cf=null,df=a.changeEnd=function(a){return a.text?Vb(a.from.line+a.text.length-1,Yd(a.text).length+(1==a.text.length?a.from.ch:0)):a.to};a.Pos=Vb,a.prototype={constructor:a,focus:function(){window.focus(),ob(this),Ib(this),lb(this)},setOption:function(a,b){var c=this.options,d=c[a];(c[a]!=b||"mode"==a)&&(c[a]=b,ef.hasOwnProperty(a)&&gb(this,ef[a])(this,b,d))},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](a)},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||"string"!=typeof b[c]&&b[c].name==a)return b.splice(c,1),!0},addOverlay:gb(null,function(b,c){var d=b.token?b:a.getMode(this.options,b);if(d.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:d,modeSpec:b,opaque:c&&c.opaque}),this.state.modeGen++,jb(this)}),removeOverlay:gb(null,function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;if(d==a||"string"==typeof a&&d.name==a)return b.splice(c,1),this.state.modeGen++,void jb(this)}}),indentLine:gb(null,function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract"),ac(this.doc,a)&&mc(this,a,b,c)}),indentSelection:gb(null,function(a){var b=this.doc.sel;if(Wb(b.from,b.to))return mc(this,b.from.line,a);for(var c=b.to.line-(b.to.ch?0:1),d=b.from.line;c>=d;++d)mc(this,d,a)}),getTokenAt:function(a,b){var c=this.doc;a=$b(c,a);for(var d=J(this,a.line,b),e=this.doc.mode,f=nd(c,a.line),g=new zc(f.text,this.options.tabSize);g.pos<a.ch&&!g.eol();){g.start=g.pos;var h=e.token(g,d)}return{start:g.start,end:g.pos,string:g.current(),className:h||null,type:h||null,state:d}},getTokenTypeAt:function(a){a=$b(this.doc,a);var b=_c(this,nd(this.doc,a.line)),c=0,d=(b.length-1)/2,e=a.ch;if(0==e)return b[2];for(;;){var f=c+d>>1;if((f?b[2*f-1]:0)>=e)d=f;else{if(!(b[2*f+1]<e))return b[2*f+2];c=f+1}}},getModeAt:function(b){var c=this.doc.mode;return c.innerMode?a.innerMode(c,this.getTokenAt(b).state).mode:c},getHelper:function(a,b){if(mf.hasOwnProperty(b)){var c=mf[b],d=this.getModeAt(a);return d[b]&&c[d[b]]||d.helperType&&c[d.helperType]||c[d.name]}},getStateAfter:function(a,b){var c=this.doc;return a=Zb(c,null==a?c.first+c.size-1:a),J(this,a+1,b)},cursorCoords:function(a,b){var c,d=this.doc.sel;return c=null==a?d.head:"object"==typeof a?$b(this.doc,a):a?d.from:d.to,$(this,c,b||"page")},charCoords:function(a,b){return Z(this,$b(this.doc,a),b||"page")},coordsChar:function(a,b){return a=Y(this,a,b||"page"),ab(this,a.left,a.top)},lineAtHeight:function(a,b){return a=Y(this,{top:a,left:0},b||"page").top,sd(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b){var c=!1,d=this.doc.first+this.doc.size-1;a<this.doc.first?a=this.doc.first:a>d&&(a=d,c=!0);var e=nd(this.doc,a);return X(this,nd(this.doc,a),{top:0,left:0},b||"page").top+(c?e.height:0)},defaultTextHeight:function(){return cb(this.display)},defaultCharWidth:function(){return db(this.display)},setGutterMarker:gb(null,function(a,b,c){return nc(this,a,function(a){var d=a.gutterMarkers||(a.gutterMarkers={});return d[b]=c,!c&&ee(d)&&(a.gutterMarkers=null),!0})}),clearGutter:gb(null,function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,jb(b,d,d+1),ee(c.gutterMarkers)&&(c.gutterMarkers=null)),++d})}),addLineClass:gb(null,function(a,b,c){return nc(this,a,function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"wrapClass";if(a[d]){if(new RegExp("(?:^|\\s)"+c+"(?:$|\\s)").test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:gb(null,function(a,b,c){return nc(this,a,function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"wrapClass",e=a[d];if(!e)return!1;if(null==c)a[d]=null;else{var f=e.match(new RegExp("(?:^|\\s+)"+c+"(?:$|\\s+)"));if(!f)return!1;var g=f.index+f[0].length;a[d]=e.slice(0,f.index)+(f.index&&g!=e.length?" ":"")+e.slice(g)||null}return!0})}),addLineWidget:gb(null,function(a,b,c){return Wc(this,a,b,c)}),removeLineWidget:function(a){a.clear()},lineInfo:function(a){if("number"==typeof a){if(!ac(this.doc,a))return null;var b=a;if(a=nd(this.doc,a),!a)return null}else{var b=rd(a);if(null==b)return null}return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(a,b,c,d,e){var f=this.display;a=$(this,$b(this.doc,a));var g=a.bottom,h=a.left;if(b.style.position="absolute",f.sizer.appendChild(b),"over"==d)g=a.top;else if("above"==d||"near"==d){var i=Math.max(f.wrapper.clientHeight,this.doc.height),j=Math.max(f.sizer.clientWidth,f.lineSpace.clientWidth);("above"==d||a.bottom+b.offsetHeight>i)&&a.top>b.offsetHeight?g=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=i&&(g=a.bottom),h+b.offsetWidth>j&&(h=j-b.offsetWidth)}b.style.top=g+"px",b.style.left=b.style.right="","right"==e?(h=f.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==e?h=0:"middle"==e&&(h=(f.sizer.clientWidth-b.offsetWidth)/2),b.style.left=h+"px"),c&&ic(this,h,g,h+b.offsetWidth,g+b.offsetHeight)},triggerOnKeyDown:gb(null,Gb),execCommand:function(a){return nf[a](this)},findPosH:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);for(var f=0,g=$b(this.doc,a);b>f&&(g=oc(this.doc,g,e,c,d),!g.hitSide);++f);return g},moveH:gb(null,function(a,b){var c,d=this.doc.sel;c=d.shift||d.extend||Wb(d.from,d.to)?oc(this.doc,d.head,a,b,this.options.rtlMoveVisually):0>a?d.from:d.to,bc(this.doc,c,c,a)}),deleteH:gb(null,function(a,b){var c=this.doc.sel;Wb(c.from,c.to)?Ub(this.doc,"",c.from,oc(this.doc,c.head,a,b,!1),"+delete"):Ub(this.doc,"",c.from,c.to,"+delete"),this.curOp.userSelChange=!0}),findPosV:function(a,b,c,d){var e=1,f=d;0>b&&(e=-1,b=-b);for(var g=0,h=$b(this.doc,a);b>g;++g){var i=$(this,h,"div");if(null==f?f=i.left:i.left=f,h=pc(this,i,e,c),h.hitSide)break}return h},moveV:gb(null,function(a,b){var c=this.doc.sel,d=$(this,c.head,"div");null!=c.goalColumn&&(d.left=c.goalColumn);var e=pc(this,d,a,b);"page"==b&&lc(this,0,Z(this,e,"div").top-d.top),bc(this.doc,e,e,a),c.goalColumn=d.left}),toggleOverwrite:function(a){(null==a||a!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?this.display.cursor.className+=" CodeMirror-overwrite":this.display.cursor.className=this.display.cursor.className.replace(" CodeMirror-overwrite",""))},hasFocus:function(){return this.state.focused},scrollTo:gb(null,function(a,b){kc(this,a,b)}),getScrollInfo:function(){var a=this.display.scroller,b=zf;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-b,width:a.scrollWidth-b,clientHeight:a.clientHeight-b,clientWidth:a.clientWidth-b}},scrollIntoView:gb(null,function(a,b){null==a?a={from:this.doc.sel.head,to:null}:"number"==typeof a?a={from:Vb(a,0),to:null}:null==a.from&&(a={from:a,to:null}),a.to||(a.to=a.from),b||(b=0);var c=a;null!=a.from.line&&(this.curOp.scrollToPos={from:a.from,to:a.to,margin:b},c={from:$(this,a.from),to:$(this,a.to)});var d=jc(this,Math.min(c.from.left,c.to.left),Math.min(c.from.top,c.to.top)-b,Math.max(c.from.right,c.to.right),Math.max(c.from.bottom,c.to.bottom)+b);kc(this,d.scrollLeft,d.scrollTop)}),setSize:gb(null,function(a,b){function c(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}null!=a&&(this.display.wrapper.style.width=c(a)),null!=b&&(this.display.wrapper.style.height=c(b)),this.options.lineWrapping&&(this.display.measureLineCache.length=this.display.measureLineCachePos=0),this.curOp.forceUpdate=!0}),operation:function(a){return ib(this,a)},refresh:gb(null,function(){var a=null==this.display.cachedTextHeight;U(this),kc(this,this.doc.scrollLeft,this.doc.scrollTop),jb(this),a&&f(this)}),swapDoc:gb(null,function(a){var b=this.doc;return b.cm=null,md(this,a),U(this),nb(this,!0),kc(this,a.scrollLeft,a.scrollTop),Qd(this,"swapDoc",this,b),b}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Ud(a);var ef=a.optionHandlers={},ff=a.defaults={},gf=a.Init={toString:function(){return"CodeMirror.Init"}};sc("value","",function(a,b){a.setValue(b)},!0),sc("mode",null,function(a,b){a.doc.modeOption=b,c(a)},!0),sc("indentUnit",2,c,!0),sc("indentWithTabs",!1),sc("smartIndent",!0),sc("tabSize",4,function(a){c(a),U(a),jb(a)},!0),sc("electricChars",!0),sc("rtlMoveVisually",!Pe),sc("theme","default",function(a){h(a),i(a)},!0),sc("keyMap","default",g),sc("extraKeys",null),sc("onKeyEvent",null),sc("onDragEvent",null),sc("lineWrapping",!1,d,!0),sc("gutters",[],function(a){m(a.options),i(a)},!0),sc("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?s(a.display)+"px":"0",a.refresh()},!0),sc("coverGutterNextToScrollbar",!1,n,!0),sc("lineNumbers",!1,function(a){m(a.options),i(a)},!0),sc("firstLineNumber",1,i,!0),sc("lineNumberFormatter",function(a){return a},i,!0),sc("showCursorWhenSelecting",!1,C,!0),sc("resetSelectionOnContextMenu",!0),sc("readOnly",!1,function(a,b){"nocursor"==b?(Jb(a),a.display.input.blur()):b||nb(a,!0)}),sc("dragDrop",!0),sc("cursorBlinkRate",530),sc("cursorScrollMargin",0),sc("cursorHeight",1),sc("workTime",100),sc("workDelay",100),sc("flattenSpans",!0),sc("pollInterval",100),sc("undoDepth",40,function(a,b){a.doc.history.undoDepth=b}),sc("historyEventDelay",500),sc("viewportMargin",10,function(a){a.refresh()},!0),sc("maxHighlightLength",1e4,function(a){c(a),a.refresh()},!0),sc("crudeMeasuringFrom",1e4),sc("moveInputWithCursor",!0,function(a,b){b||(a.display.inputDiv.style.top=a.display.inputDiv.style.left=0)}),sc("tabindex",null,function(a,b){a.display.input.tabIndex=b||""}),sc("autofocus",null);var hf=a.modes={},jf=a.mimeModes={};a.defineMode=function(b,c){if(a.defaults.mode||"null"==b||(a.defaults.mode=b),arguments.length>2){c.dependencies=[];for(var d=2;d<arguments.length;++d)c.dependencies.push(arguments[d])}hf[b]=c},a.defineMIME=function(a,b){jf[a]=b},a.resolveMode=function(b){if("string"==typeof b&&jf.hasOwnProperty(b))b=jf[b];else if(b&&"string"==typeof b.name&&jf.hasOwnProperty(b.name)){var c=jf[b.name];b=_d(c,b),b.name=c.name}else if("string"==typeof b&&/^[\w\-]+\/[\w\-]+\+xml$/.test(b))return a.resolveMode("application/xml");return"string"==typeof b?{name:b}:b||{name:"null"}},a.getMode=function(b,c){var c=a.resolveMode(c),d=hf[c.name];if(!d)return a.getMode(b,"text/plain");var e=d(b,c);if(kf.hasOwnProperty(c.name)){var f=kf[c.name];for(var g in f)f.hasOwnProperty(g)&&(e.hasOwnProperty(g)&&(e["_"+g]=e[g]),e[g]=f[g])}return e.name=c.name,e},a.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}}),a.defineMIME("text/plain","null");var kf=a.modeExtensions={};a.extendMode=function(a,b){var c=kf.hasOwnProperty(a)?kf[a]:kf[a]={};ae(b,c)},a.defineExtension=function(b,c){a.prototype[b]=c},a.defineDocExtension=function(a,b){uf.prototype[a]=b},a.defineOption=sc;var lf=[];a.defineInitHook=function(a){lf.push(a)};var mf=a.helpers={};a.registerHelper=function(b,c,d){mf.hasOwnProperty(b)||(mf[b]=a[b]={}),mf[b][c]=d},a.isWordChar=de,a.copyState=tc,a.startState=uc,a.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state,a=c.mode}return c||{mode:a,state:b}};var nf=a.commands={selectAll:function(a){a.setSelection(Vb(a.firstLine(),0),Vb(a.lastLine()))},killLine:function(a){var b=a.getCursor(!0),c=a.getCursor(!1),d=!Wb(b,c);d||a.getLine(b.line).length!=b.ch?a.replaceRange("",b,d?c:Vb(b.line),"+delete"):a.replaceRange("",b,Vb(b.line+1,0),"+delete")},deleteLine:function(a){var b=a.getCursor().line;a.replaceRange("",Vb(b,0),Vb(b),"+delete")},delLineLeft:function(a){var b=a.getCursor();a.replaceRange("",Vb(b.line,0),b,"+delete")},undo:function(a){a.undo()},redo:function(a){a.redo()},goDocStart:function(a){a.extendSelection(Vb(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(Vb(a.lastLine()))},goLineStart:function(a){a.extendSelection(se(a,a.getCursor().line))},goLineStartSmart:function(a){var b=a.getCursor(),c=se(a,b.line),d=a.getLineHandle(c.line),e=ud(d);if(e&&0!=e[0].level)a.extendSelection(c);else{var f=Math.max(0,d.text.search(/\S/)),g=b.line==c.line&&b.ch<=f&&b.ch;a.extendSelection(Vb(c.line,g?0:f))}},goLineEnd:function(a){a.extendSelection(te(a,a.getCursor().line))},goLineRight:function(a){var b=a.charCoords(a.getCursor(),"div").top+5;a.extendSelection(a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:b},"div"))},goLineLeft:function(a){var b=a.charCoords(a.getCursor(),"div").top+5;a.extendSelection(a.coordsChar({left:0,top:b},"div"))},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("	","end","+input")},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.replaceSelection("	","end","+input")},transposeChars:function(a){var b=a.getCursor(),c=a.getLine(b.line);b.ch>0&&b.ch<c.length-1&&a.replaceRange(c.charAt(b.ch)+c.charAt(b.ch-1),Vb(b.line,b.ch-1),Vb(b.line,b.ch+1))},newlineAndIndent:function(a){gb(a,function(){a.replaceSelection("\n","end","+input"),a.indentLine(a.getCursor().line,null,!0)})()},toggleOverwrite:function(a){a.toggleOverwrite()}},of=a.keyMap={};of.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},of.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},of.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft",fallthrough:["basic","emacsy"]},of["default"]=Oe?of.macDefault:of.pcDefault,of.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},a.lookupKey=wc,a.isModifierKey=xc,a.keyName=yc,a.fromTextArea=function(b,c){function d(){b.value=j.getValue()}if(c||(c={}),c.value=b.value,!c.tabindex&&b.tabindex&&(c.tabindex=b.tabindex),!c.placeholder&&b.placeholder&&(c.placeholder=b.placeholder),null==c.autofocus){var e=document.body;try{e=document.activeElement}catch(f){}c.autofocus=e==b||null!=b.getAttribute("autofocus")&&e==document.body}if(b.form&&(Nd(b.form,"submit",d),!c.leaveSubmitMethodAlone)){var g=b.form,h=g.submit;try{var i=g.submit=function(){d(),g.submit=h,g.submit(),g.submit=i}}catch(f){}}b.style.display="none";var j=a(function(a){b.parentNode.insertBefore(a,b.nextSibling)},c);return j.save=d,j.getTextArea=function(){return b},j.toTextArea=function(){d(),b.parentNode.removeChild(j.getWrapperElement()),b.style.display="",b.form&&(Od(b.form,"submit",d),"function"==typeof b.form.submit&&(b.form.submit=h))},j},zc.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0==this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(a){var b=this.string.charAt(this.pos);if("string"==typeof a)var c=b==a;else var c=b&&(a.test?a.test(b):a(b));return c?(++this.pos,b):void 0},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){var b=this.string.indexOf(a,this.pos);return b>-1?(this.pos=b,!0):void 0},backUp:function(a){this.pos-=a},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Wd(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue},indentation:function(){return Wd(this.string,null,this.tabSize)},match:function(a,b,c){if("string"!=typeof a){var d=this.string.slice(this.pos).match(a);return d&&d.index>0?null:(d&&b!==!1&&(this.pos+=d[0].length),d)}var e=function(a){return c?a.toLowerCase():a},f=this.string.substr(this.pos,a.length);return e(f)==e(a)?(b!==!1&&(this.pos+=a.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)}},a.StringStream=zc,a.TextMarker=Ac,Ud(Ac),Ac.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;if(b&&eb(a),Td(this,"clear")){var c=this.find();c&&Qd(this,"clear",c.from,c.to)}for(var d=null,e=null,f=0;f<this.lines.length;++f){var g=this.lines[f],h=Ec(g.markedSpans,this);null!=h.to&&(e=rd(g)),g.markedSpans=Fc(g.markedSpans,h),null!=h.from?d=rd(g):this.collapsed&&!Qc(this.doc,g)&&a&&qd(g,cb(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(var f=0;f<this.lines.length;++f){var i=Pc(a.doc,this.lines[f]),j=k(a.doc,i);j>a.display.maxLineLength&&(a.display.maxLine=i,a.display.maxLineLength=j,a.display.maxLineChanged=!0)}null!=d&&a&&jb(a,d,e+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&ec(a)),b&&fb(a)}},Ac.prototype.find=function(){for(var a,b,c=0;c<this.lines.length;++c){var d=this.lines[c],e=Ec(d.markedSpans,this);if(null!=e.from||null!=e.to){var f=rd(d);null!=e.from&&(a=Vb(f,e.from)),null!=e.to&&(b=Vb(f,e.to))}}return"bookmark"==this.type?a:a&&{from:a,to:b}},Ac.prototype.changed=function(){var a=this.find(),b=this.doc.cm;if(a&&b){"bookmark"!=this.type&&(a=a.from);var c=nd(this.doc,a.line);if(P(b,c),a.line>=b.display.showingFrom&&a.line<b.display.showingTo){for(var d=b.display.lineDiv.firstChild;d;d=d.nextSibling)if(d.lineObj==c){d.offsetHeight!=c.height&&qd(c,d.offsetHeight);break}ib(b,function(){b.curOp.selectionChanged=b.curOp.forceUpdate=b.curOp.updateMaxLine=!0})}}},Ac.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=$d(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)},Ac.prototype.detachLine=function(a){if(this.lines.splice($d(this.lines,a),1),!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;(b.maybeHiddenMarkers||(b.maybeHiddenMarkers=[])).push(this)}},a.SharedTextMarker=Cc,Ud(Cc),Cc.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();Qd(this,"clear")}},Cc.prototype.find=function(){return this.primary.find()};var pf=a.LineWidget=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.cm=a,this.node=b};Ud(pf),pf.prototype.clear=Uc(function(){var a=this.line.widgets,b=rd(this.line);if(null!=b&&a){for(var c=0;c<a.length;++c)a[c]==this&&a.splice(c--,1);a.length||(this.line.widgets=null);var d=td(this.cm,this.line)<this.cm.doc.scrollTop;qd(this.line,Math.max(0,this.line.height-Vc(this))),d&&lc(this.cm,0,-this.height),jb(this.cm,b,b+1)}}),pf.prototype.changed=Uc(function(){var a=this.height;this.height=null;var b=Vc(this)-a;if(b){qd(this.line,this.line.height+b);var c=rd(this.line);jb(this.cm,c,c+1)}});var qf=a.Line=function(a,b,c){this.text=a,Tc(this,b),this.height=c?c(this):1};Ud(qf);var rf={},sf=/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\uFEFF]/g;jd.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;d>c;++c){var e=this.lines[c];this.height-=e.height,Yc(e),Qd(e,"delete")}this.lines.splice(a,b)},collapse:function(a){a.splice.apply(a,[a.length,0].concat(this.lines))},insertInner:function(a,b,c){this.height+=c,this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(var d=0,e=b.length;e>d;++d)b[d].parent=this},iterN:function(a,b,c){for(var d=a+b;d>a;++a)if(c(this.lines[a]))return!0}},kd.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],e=d.chunkSize();if(e>a){var f=Math.min(b,e-a),g=d.height;if(d.removeInner(a,f),this.height-=g-d.height,e==f&&(this.children.splice(c--,1),d.parent=null),0==(b-=f))break;a=0}else a-=e}if(this.size-b<25){var h=[];this.collapse(h),this.children=[new jd(h)],this.children[0].parent=this}},collapse:function(a){for(var b=0,c=this.children.length;c>b;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length,this.height+=c;for(var d=0,e=this.children.length;e>d;++d){var f=this.children[d],g=f.chunkSize();if(g>=a){if(f.insertInner(a,b,c),f.lines&&f.lines.length>50){for(;f.lines.length>50;){var h=f.lines.splice(f.lines.length-25,25),i=new jd(h);f.height-=i.height,this.children.splice(d+1,0,i),i.parent=this}this.maybeSpill()}break}a-=g}},maybeSpill:function(){if(!(this.children.length<=10)){var a=this;do{var b=a.children.splice(a.children.length-5,5),c=new kd(b);if(a.parent){a.size-=c.size,a.height-=c.height;var d=$d(a.parent.children,a);a.parent.children.splice(d+1,0,c)}else{var e=new kd(a.children);e.parent=a,a.children=[e,c],a=e}c.parent=a.parent}while(a.children.length>10);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var d=0,e=this.children.length;e>d;++d){var f=this.children[d],g=f.chunkSize();if(g>a){var h=Math.min(b,g-a);if(f.iterN(a,h,c))return!0;if(0==(b-=h))break;a=0}else a-=g}}};var tf=0,uf=a.Doc=function(a,b,c){if(!(this instanceof uf))return new uf(a,b,c);null==c&&(c=0),kd.call(this,[new jd([new qf("",null)])]),this.first=c,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.history=vd(),this.cleanGeneration=1,this.frontier=c;var d=Vb(c,0);this.sel={from:d,to:d,head:d,anchor:d,shift:!1,extend:!1,goalColumn:null},this.id=++tf,this.modeOption=b,"string"==typeof a&&(a=Hf(a)),id(this,{from:d,to:d,text:a},null,{head:d,anchor:d})};uf.prototype=_d(kd.prototype,{constructor:uf,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0,e=b.length;e>d;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=pd(this,this.first,this.first+this.size);return a===!1?b:b.join(a||"\n")},setValue:function(a){var b=Vb(this.first,0),c=this.first+this.size-1;Ob(this,{from:b,to:Vb(c,nd(this,c).text.length),text:Hf(a),origin:"setValue"},{head:b,anchor:b},!0)},replaceRange:function(a,b,c,d){b=$b(this,b),c=c?$b(this,c):b,Ub(this,a,b,c,d)},getRange:function(a,b,c){var d=od(this,$b(this,a),$b(this,b));return c===!1?d:d.join(c||"\n")},getLine:function(a){var b=this.getLineHandle(a);return b&&b.text},setLine:function(a,b){ac(this,a)&&Ub(this,b,Vb(a,0),$b(this,Vb(a)))},removeLine:function(a){a?Ub(this,"",$b(this,Vb(a-1)),$b(this,Vb(a))):Ub(this,"",Vb(0,0),$b(this,Vb(1,0)))},getLineHandle:function(a){return ac(this,a)?nd(this,a):void 0},getLineNumber:function(a){return rd(a)},getLineHandleVisualStart:function(a){return"number"==typeof a&&(a=nd(this,a)),Pc(this,a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return $b(this,a)},getCursor:function(a){var b,c=this.sel;return b=null==a||"head"==a?c.head:"anchor"==a?c.anchor:"end"==a||a===!1?c.to:c.from,Yb(b)
},somethingSelected:function(){return!Wb(this.sel.head,this.sel.anchor)},setCursor:hb(function(a,b,c){var d=$b(this,"number"==typeof a?Vb(a,b||0):a);c?bc(this,d):dc(this,d,d)}),setSelection:hb(function(a,b,c){dc(this,$b(this,a),$b(this,b||a),c)}),extendSelection:hb(function(a,b,c){bc(this,$b(this,a),b&&$b(this,b),c)}),getSelection:function(a){return this.getRange(this.sel.from,this.sel.to,a)},replaceSelection:function(a,b,c){Ob(this,{from:this.sel.from,to:this.sel.to,text:Hf(a),origin:c},b||"around")},undo:hb(function(){Qb(this,"undo")}),redo:hb(function(){Qb(this,"redo")}),setExtending:function(a){this.sel.extend=a},historySize:function(){var a=this.history;return{undo:a.done.length,redo:a.undone.length}},clearHistory:function(){this.history=vd(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration()},changeGeneration:function(){return this.history.lastOp=this.history.lastOrigin=null,this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:Bd(this.history.done),undone:Bd(this.history.undone)}},setHistory:function(a){var b=this.history=vd(this.history.maxGeneration);b.done=a.done.slice(0),b.undone=a.undone.slice(0)},markText:function(a,b,c){return Bc(this,$b(this,a),$b(this,b),c,"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft};return a=$b(this,a),Bc(this,a,a,c,"bookmark")},findMarksAt:function(a){a=$b(this,a);var b=[],c=nd(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var e=c[d];(null==e.from||e.from<=a.ch)&&(null==e.to||e.to>=a.ch)&&b.push(e.marker.parent||e.marker)}return b},getAllMarks:function(){var a=[];return this.iter(function(b){var c=b.markedSpans;if(c)for(var d=0;d<c.length;++d)null!=c[d].from&&a.push(c[d].marker)}),a},posFromIndex:function(a){var b,c=this.first;return this.iter(function(d){var e=d.text.length+1;return e>a?(b=a,!0):(a-=e,void++c)}),$b(this,Vb(c,b))},indexFromPos:function(a){a=$b(this,a);var b=a.ch;return a.line<this.first||a.ch<0?0:(this.iter(this.first,a.line,function(a){b+=a.text.length+1}),b)},copy:function(a){var b=new uf(pd(this,this.first,this.first+this.size),this.modeOption,this.first);return b.scrollTop=this.scrollTop,b.scrollLeft=this.scrollLeft,b.sel={from:this.sel.from,to:this.sel.to,head:this.sel.head,anchor:this.sel.anchor,shift:this.sel.shift,extend:!1,goalColumn:this.sel.goalColumn},a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory())),b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from),null!=a.to&&a.to<c&&(c=a.to);var d=new uf(pd(this,b,c),a.mode||this.modeOption,b);return a.sharedHist&&(d.history=this.history),(this.linked||(this.linked=[])).push({doc:d,sharedHist:a.sharedHist}),d.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}],d},unlinkDoc:function(b){if(b instanceof a&&(b=b.doc),this.linked)for(var c=0;c<this.linked.length;++c){var d=this.linked[c];if(d.doc==b){this.linked.splice(c,1),b.unlinkDoc(this);break}}if(b.history==this.history){var e=[b.id];ld(b,function(a){e.push(a.id)},!0),b.history=vd(),b.history.done=Bd(this.history.done,e),b.history.undone=Bd(this.history.undone,e)}},iterLinkedDocs:function(a){ld(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),uf.prototype.eachLine=uf.prototype.iter;var vf="iter insert remove copy getEditor".split(" ");for(var wf in uf.prototype)uf.prototype.hasOwnProperty(wf)&&$d(vf,wf)<0&&(a.prototype[wf]=function(a){return function(){return a.apply(this.doc,arguments)}}(uf.prototype[wf]));Ud(uf),a.e_stop=Kd,a.e_preventDefault=Hd,a.e_stopPropagation=Id;var xf,yf=0;a.on=Nd,a.off=Od,a.signal=Pd;var zf=30,Af=a.Pass={toString:function(){return"CodeMirror.Pass"}};Vd.prototype={set:function(a,b){clearTimeout(this.id),this.id=setTimeout(b,a)}},a.countColumn=Wd;var Bf=[""],Cf=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Df=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F\udc00-\udfff]/;a.replaceGetRect=function(a){je=a};var Ef=function(){if(Ce)return!1;var a=fe("div");return"draggable"in a||"dragDrop"in a}();ze?ke=function(a,b){return 36==a.charCodeAt(b-1)&&39==a.charCodeAt(b)}:He&&!/Version\/([6-9]|\d\d)\b/.test(navigator.userAgent)?ke=function(a,b){return/\-[^ \-?]|\?[^ !\'\"\),.\-\/:;\?\]\}]/.test(a.slice(b-1,b+1))}:De&&/Chrome\/(?:29|[3-9]\d|\d\d\d)\./.test(navigator.userAgent)?ke=function(a,b){var c=a.charCodeAt(b-1);return c>=8208&&8212>=c}:De&&(ke=function(a,b){if(b>1&&45==a.charCodeAt(b-1)){if(/\w/.test(a.charAt(b-2))&&/[^\-?\.]/.test(a.charAt(b)))return!0;if(b>2&&/[\d\.,]/.test(a.charAt(b-2))&&/[\d\.,]/.test(a.charAt(b)))return!1}return/[~!#%&*)=+}\]\\|\"\.>,:;][({[<]|-[^\-?\.\u2010-\u201f\u2026]|\?[\w~`@#$%\^&*(_=+{[|><]|[\w~`@#$%\^&*(_=+{[><]/.test(a.slice(b-1,b+1))});var Ff,Gf,Hf=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;d>=b;){var e=a.indexOf("\n",b);-1==e&&(e=a.length);var f=a.slice(b,"\r"==a.charAt(e-1)?e-1:e),g=f.indexOf("\r");-1!=g?(c.push(f.slice(0,g)),b+=g+1):(c.push(f),b=e+1)}return c}:function(a){return a.split(/\r\n?|\n/)};a.splitLines=Hf;var If=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},Jf=function(){var a=fe("div");return"oncopy"in a?!0:(a.setAttribute("oncopy","return;"),"function"==typeof a.oncopy)}(),Kf={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};a.keyNames=Kf,function(){for(var a=0;10>a;a++)Kf[a+48]=String(a);for(var a=65;90>=a;a++)Kf[a]=String.fromCharCode(a);for(var a=1;12>=a;a++)Kf[a+111]=Kf[a+63235]="F"+a}();var Lf,Mf=function(){function a(a){return 255>=a?b.charAt(a):a>=1424&&1524>=a?"R":a>=1536&&1791>=a?c.charAt(a-1536):a>=1792&&2220>=a?"r":"L"}var b="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL",c="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr",d=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,e=/[stwN]/,f=/[LRr]/,g=/[Lb1n]/,h=/[1n]/,i="L";return function(b){if(!d.test(b))return!1;for(var c,j=b.length,k=[],l=0;j>l;++l)k.push(c=a(b.charCodeAt(l)));for(var l=0,m=i;j>l;++l){var c=k[l];"m"==c?k[l]=m:m=c}for(var l=0,n=i;j>l;++l){var c=k[l];"1"==c&&"r"==n?k[l]="n":f.test(c)&&(n=c,"r"==c&&(k[l]="R"))}for(var l=1,m=k[0];j-1>l;++l){var c=k[l];"+"==c&&"1"==m&&"1"==k[l+1]?k[l]="1":","!=c||m!=k[l+1]||"1"!=m&&"n"!=m||(k[l]=m),m=c}for(var l=0;j>l;++l){var c=k[l];if(","==c)k[l]="N";else if("%"==c){for(var o=l+1;j>o&&"%"==k[o];++o);for(var p=l&&"!"==k[l-1]||j-1>o&&"1"==k[o]?"1":"N",q=l;o>q;++q)k[q]=p;l=o-1}}for(var l=0,n=i;j>l;++l){var c=k[l];"L"==n&&"1"==c?k[l]="L":f.test(c)&&(n=c)}for(var l=0;j>l;++l)if(e.test(k[l])){for(var o=l+1;j>o&&e.test(k[o]);++o);for(var r="L"==(l?k[l-1]:i),s="L"==(j-1>o?k[o]:i),p=r||s?"L":"R",q=l;o>q;++q)k[q]=p;l=o-1}for(var t,u=[],l=0;j>l;)if(g.test(k[l])){var v=l;for(++l;j>l&&g.test(k[l]);++l);u.push({from:v,to:l,level:0})}else{var w=l,x=u.length;for(++l;j>l&&"L"!=k[l];++l);for(var q=w;l>q;)if(h.test(k[q])){q>w&&u.splice(x,0,{from:w,to:q,level:1});var y=q;for(++q;l>q&&h.test(k[q]);++q);u.splice(x,0,{from:y,to:q,level:2}),w=q}else++q;l>w&&u.splice(x,0,{from:w,to:l,level:1})}return 1==u[0].level&&(t=b.match(/^\s+/))&&(u[0].from=t[0].length,u.unshift({from:0,to:t[0].length,level:0})),1==Yd(u).level&&(t=b.match(/\s+$/))&&(Yd(u).to-=t[0].length,u.push({from:j-t[0].length,to:j,level:0})),u[0].level!=Yd(u).level&&u.push({from:j,to:j,level:u[0].level}),u}}();return a.version="3.19.0",a}(),define("codemirror",function(a){return function(){var b;return b||a.CodeMirror}}(this)),function(){function a(a,b,c){function d(b,c,d){if(b.text){var g=m?0:b.text.length-1,i=m?b.text.length:-1;if(b.text.length>h)return null;for(null!=d&&(g=d+n);g!=i;g+=n){var j=b.text.charAt(g);if(r.test(j)&&a.getTokenTypeAt(e(c,g+1))==p){var k=f[j];if(">"==k.charAt(1)==m)q.push(j);else{if(q.pop()!=k.charAt(0))return{pos:g,match:!1};if(!q.length)return{pos:g,match:!0}}}}}}var g=a.state.matchBrackets,h=g&&g.maxScanLineLength||1e4,i=b||a.getCursor(),j=a.getLineHandle(i.line),k=i.ch-1,l=k>=0&&f[j.text.charAt(k)]||f[j.text.charAt(++k)];if(!l)return null;var m=">"==l.charAt(1),n=m?1:-1;if(c&&m!=(k==i.ch))return null;for(var o,p=a.getTokenTypeAt(e(i.line,k+1)),q=[j.text.charAt(k)],r=/[(){}[\]]/,s=i.line,t=m?Math.min(s+100,a.lineCount()):Math.max(-1,s-100);s!=t&&!(o=s==i.line?d(j,s,k):d(a.getLineHandle(s),s));s+=n);return{from:e(i.line,k),to:o&&e(s,o.pos),match:o&&o.match,forward:m}}function b(b,c){var f=b.state.matchBrackets.maxHighlightLineLength||1e3,g=a(b);if(!(!g||b.getLine(g.from.line).length>f||g.to&&b.getLine(g.to.line).length>f)){var h=g.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",i=b.markText(g.from,e(g.from.line,g.from.ch+1),{className:h}),j=g.to&&b.markText(g.to,e(g.to.line,g.to.ch+1),{className:h});d&&b.state.focused&&b.display.input.focus();var k=function(){b.operation(function(){i.clear(),j&&j.clear()})};return c?void setTimeout(k,800):k}}function c(a){a.operation(function(){g&&(g(),g=null),a.somethingSelected()||(g=b(a,!1))})}var d=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),e=CodeMirror.Pos,f={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},g=null;CodeMirror.defineOption("matchBrackets",!1,function(a,b,d){d&&d!=CodeMirror.Init&&a.off("cursorActivity",c),b&&(a.state.matchBrackets="object"==typeof b?b:{},a.on("cursorActivity",c))}),CodeMirror.defineExtension("matchBrackets",function(){b(this,!0)}),CodeMirror.defineExtension("findMatchingBracket",function(b,c){return a(this,b,c)})}(),define("codemirror.matchbrackets",function(){}),define("general.components/codearea/qlikview-script-mode",["codemirror"],function(){var a=/[^\s\(\)\"\'\,\+\$\*\-\<\>\=\&\/\!\{\}\;\.\:\@\`\\[\]]/;return CodeMirror.defineMode("qlikviewscript",function(b,c){function d(a,b,c){return b.tokenize=c,c(a,b)}function e(a,b){for(var c,d=!1;null!=(c=a.next());){if(c==b&&!d)return!1;d=!d&&"\\"==c}return d}function f(a,b,c){return u=a,v=c,b}function g(b,e){if(b.eatSpace())return null;u="any";var g=b.next();if(x.test(g))return"["===g?d(b,e,i("]")):d(b,e,i(g));if(/[\[\]{}\(\),;\:]/.test(g))return f(g);if("0"==g&&b.eat(/x/i))return b.eatWhile(/[\da-f]/i),f("number","number");if(/[\.\d]/.test(g))return b.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),!b.eol()&&(g=b.peek(),/[A-z]/.test(g))?"normaltext":"number";if("/"===g)return b.eat("*")?d(b,e,j):b.eat("/")?(b.skipToEnd(),"comment"):(b.eatWhile(w),"operator");if(w.test(g))return b.eatWhile(w),"operator";b.eatWhile(a);var h=b.current(),l=h.toLowerCase();return"rem"===l?d(b,e,k):c.service.isFunction(l)&&b.match(/(^\s*\()/,!1,!0)?f("function","keyword",l):c.service.isField(h)?f("field","field"):c.service.isKeyword(l)?f("keyword","keyword"):"normaltext"}function h(a){return a.substr(1,a.length-2)}function i(a){return function(b,d){if(!e(b,a)&&(d.tokenize=g,"'"!==a)){var i=h(b.current(),a);if(c.service.isField(i))return f("field","field")}return f("string","string")}}function j(a,b){for(var c,d=!1;c=a.next();){if("/"==c&&d){b.tokenize=g;break}d="*"==c}return f("comment","comment")}function k(a,b){for(var c;c=a.next();)if(";"==c){b.tokenize=g;break}return f("comment","comment")}function l(a,b,c){this.type=a,this.prev=b,this.info=c}function m(a,b,c,d,e){var f=a.cc;for(y.state=a,y.stream=e,y.marked=null,y.cc=f;;){var g=f.length?f.pop():t;if(g(c,d)){for(;f.length&&f[f.length-1].lex;)f.pop()();return y.marked?y.marked:b}}}function n(){for(var a=arguments.length-1;a>=0;a--)y.cc.push(arguments[a])}function o(){return n.apply(null,arguments),!0}function p(a,b){var c=function(){var c=y.state;c.lexical=new l(a,c.lexical,b)};return c.lex=!0,c}function q(){var a=y.state;a.lexical.prev&&(a.lexical=a.lexical.prev)}function r(a){return function(b){return b==a?o():";"==a?n():o(arguments.callee)}}function s(a,b){return function c(d){return d==b?o():n(a,c)}}function t(a){return"function"==a?o(p("qvfunction",v),r("("),s(t,")"),q):"("===a?o(s(t,")")):o()}var u,v,w=/[+\-*&=<>]/,x=/[\u0022\u0027\u0060\u00b4[]/,y={state:null,column:null,marked:null,cc:null};return q.lex=!0,{startState:function(){return{tokenize:g,lastType:null,cc:[],lexical:new l("block")}},token:function(a,b){if(a.eatSpace())return null;var c=b.tokenize(a,b);return"comment"==u?c:(b.lastType=u,m(b,c,u,v,a))},lineComment:"//"}}),{REGEXP_WORD:a}}),define("general.components/codearea/codearea-function-tip",["qvangular","general.services/show-service/show-service"],function(a,b){a.directive("qvCodeareaFunctionTip",function(){return{restrict:"A",require:"qvCodearea",link:function(c,d,e,f){var g,h,i=c.$watch(e.qvCodeareaFunctionTip,function(d){function e(){var a=f.codemirror.getTokenAt(f.codemirror.getCursor());if("comment"!==a.type){for(var b=0,c=a.state.lexical;c&&"qvfunction"!==c.type||0===b&&c.info&&a.string.toLowerCase()===c.info.toLowerCase();)c=c.prev,b++;return c?c.info:void 0}return void 0}function j(){var c=e(),h=c?d.service.getFunctionTip(c):void 0;a.$apply(function(){g&&g.destroy(),h&&(g=b.show(d.view,{content:h,offset:f.codemirror.cursorCoords()}))})}function k(){clearTimeout(h),h=setTimeout(j,250)}function l(){g&&g.destroy()}d&&(f.codemirror.on("blur",l),f.codemirror.on("focus",j),f.codemirror.on("cursorActivity",k),c.$on("$destroy",function(){f.codemirror.off("blur",l),f.codemirror.off("focus",j),f.codemirror.off("cursorActivity",k),g&&g.destroy()}),i())},!0)}}})}),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.5.2";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?void 0:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return arguments.length<2||c?a[x.random(a.length-1)]:x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={},f=null==c?x.identity:B(c);return y(b,function(c,g){var h=f.call(d,c,g,b);a(e,h,c)}),e}};x.groupBy=C(function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:new Date,g=null,f=a.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h;return function(){f=this,e=arguments,g=new Date;var i=function(){var j=new Date-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e)))},j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e)),h}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h))return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("underscore",function(a){return function(){var b;return b||a._}}(this)),define("general.components/codearea/codearea-autocomplete",["jquery","codemirror","qvangular","underscore"],function(a,b,c,d){function e(a,c,d){function e(){return a.somethingSelected()||"keyword"===a.getTokenAt(a.getCursor()).type&&!h||d.autocompleteOptions.disabled?void 0:d.async?void c(a,f,d):f(c(a,d))}function f(c){function f(a){if(a=Math.max(0,Math.min(a,p.length-1)),r!==a){q.childNodes[r].className="CodeMirror-hint";var b=q.childNodes[r=a];b.className="CodeMirror-hint CodeMirror-hint-active",b.offsetTop<q.scrollTop?q.scrollTop=b.offsetTop-3:b.offsetTop+b.offsetHeight>q.scrollTop+q.clientHeight&&(q.scrollTop=b.offsetTop+b.offsetHeight-q.clientHeight+3)}}function i(){return Math.floor(q.clientHeight/q.firstChild.offsetHeight)||1}function j(){clearTimeout(J);var b=a.getCursor(),c=a.getLine(b.line).length;b.line!==L.line||c-b.ch!==M-L.ch||b.ch<g||a.somethingSelected()?k():J=setTimeout(function(){k(),h=!0,e()},70)}function k(){K||(K=!0,clearTimeout(J),q.parentNode.removeChild(q),a.removeKeyMap(E),a.off("cursorActivity",j),a.off("blur",m),a.off("focus",n),a.off("scroll",o))}function l(){a.replaceRange(p[r],c.from,c.to),k()}function m(){H=setTimeout(k,300)}function n(){clearTimeout(H)}function o(){var b=a.getScrollInfo(),c=a.getWrapperElement().getBoundingClientRect(),d=w+I.top-b.top,e=d;return x||(e+=q.offsetHeight),e<=c.top||e>=c.bottom?k():(q.style.top=d+"px",void(q.style.left=v+I.left-b.left+"px"))}if(c&&c.list.length){var p=c.list;if(!h&&d.completeSingle!==!1&&1===p.length)return a.replaceRange(p[0],c.from,c.to),!0;var q=document.createElement("ul"),r=0;q.className="CodeMirror-hints";for(var s=0;s<p.length;++s){var t=q.appendChild(document.createElement("li"));t.className="CodeMirror-hint"+(s?"":" CodeMirror-hint-active"),t.appendChild(document.createTextNode(p[s])),t.hintId=s}var u=a.cursorCoords(d.alignWithWord!==!1?c.from:null),v=u.left,w=u.bottom,x=!0;q.style.left=v+"px",q.style.top=w+"px",document.body.appendChild(q);var y=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),z=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight),A=q.getBoundingClientRect(),B=A.right-y,C=A.bottom-z;if(B>0&&(A.right-A.left>y&&(q.style.width=y-5+"px",B-=A.right-A.left-y),q.style.left=(v=u.left-B)+"px"),C>0){var D=A.bottom-A.top;A.top-(u.bottom-u.top)-D>0?(C=D+(u.bottom-u.top),x=!1):D>z&&(q.style.height=z-5+"px",C-=D-z),q.style.top=(w=u.bottom-C)+"px"}var E={Up:function(){f(r-1)},Down:function(){f(r+1)},PageUp:function(){f(r-i())},PageDown:function(){f(r+i())},Home:function(){f(0)},End:function(){f(p.length-1)},Enter:l,Tab:l,Esc:k};if(d.customKeys)for(var F in d.customKeys)if(d.customKeys.hasOwnProperty(F)){var G=d.customKeys[F];/^(Up|Down|Enter|Esc)$/.test(F)&&(G=E[G]),E[F]=G}a.addKeyMap(E),a.on("cursorActivity",j);var H;a.on("blur",m),a.on("focus",n);var I=a.getScrollInfo();a.on("scroll",o),b.on(q,"click",function(b){var c=b.target||b.srcElement;null!==c.hintId&&(r=c.hintId,l()),setTimeout(function(){a.focus()},20)}),b.on(q,"mouseover",function(b){var c=b.target||b.srcElement;null!==c.hintId&&f(c.hintId),setTimeout(function(){a.focus()},20)});var J,K=!1,L=a.getCursor(),M=a.getLine(L.line).length;return!0}}d||(d={});
var g=a.getCursor().ch,h=!1;return e()}function f(a,b,c){function e(a){a&&0===a.toLowerCase().indexOf(i.toLowerCase())&&!d.contains(h,a)&&h.push(a)}function f(a,b){return a.toLowerCase()===b.toLowerCase()?0:a.toLowerCase()>b.toLowerCase()?1:-1}function g(){c.forEach(e)}var h=[],i=a.string;return""!==a.string&&(b||(g(),d.forEach(c,e)),h.sort(f)),1===h.length&&a.string===h[0]&&(h=[]),h}function g(a,b,c){var d,e=a.getCursor(),g=c(a,e);return/^[\w$_]*$/.test(g.string)||(g={start:e.ch,end:e.ch,string:"",state:g.state,className:null}),{list:f(g,d,b),from:{line:e.line,ch:g.start},to:{line:e.line,ch:g.end}}}c.directive("qvCodeareaAutocomplete",function(){return{restrict:"A",require:"qvCodearea",link:function(b,c,d,f){var h,i,j=[37,38,39,40,33,34,27],k=b.$watch(d.qvCodeareaAutocomplete,function(c){function d(a){return g(a,c.service.getAllKeywords(),function(a,b){return a.getTokenAt(b)})}function l(){h||clearTimeout(h),h=setTimeout(function(){0===a(".CodeMirror-hints").length&&e(f.codemirror,d,o)},500)}function m(){}function n(b,c){-1===a.inArray(c.which,j)&&l()}var o={completeSingle:!1,autocompleteOptions:c};c&&(f.codemirror.on("blur",m),f.codemirror.on("focus",l),f.codemirror.on("keyup",n),b.$on("$destroy",function(){f.codemirror.off("blur",m),f.codemirror.off("focus",l),f.codemirror.off("keyup",n),i&&i.destroy()}),k())},!0)}}})}),define("general.components/codearea/search-cursor",["codemirror"],function(a){function b(a,b,c,e){if(this.atOccurrence=!1,this.cm=a,null==e&&"string"==typeof b&&(e=!0),c=c?a.clipPos(c):d(0,0),this.pos={from:c,to:c},"string"!=typeof b)b.global||(b=new RegExp(b.source,b.ignoreCase?"ig":"g")),this.matches=function(c,e){var f,g,h;if(c){for(b.lastIndex=0,f=a.getLine(e.line).slice(0,e.ch),g=b.exec(f),h=0;g;){h+=g.index+1,f=f.slice(h),b.lastIndex=0;var i=b.exec(f);if(!i)break;g=i}h--}else b.lastIndex=e.ch,f=a.getLine(e.line),g=b.exec(f),h=g&&g.index;return g&&g[0]?{from:d(e.line,h),to:d(e.line,h+g[0].length),match:g}:void 0};else{e&&(b=b.toLowerCase());var f=e?function(a){return a.toLowerCase()}:function(a){return a},g=b.split("\n");this.matches=1==g.length?b.length?function(c,e){var g,h=f(a.getLine(e.line)),i=b.length;return(c?e.ch>=i&&-1!=(g=h.lastIndexOf(b,e.ch-i)):-1!=(g=h.indexOf(b,e.ch)))?{from:d(e.line,g),to:d(e.line,g+i)}:void 0}:function(){}:function(b,c){var e=c.line,h=b?g.length-1:0,i=g[h],j=f(a.getLine(e)),k=b?j.indexOf(i)+i.length:j.lastIndexOf(i);if(!(b?k>=c.ch||k!=i.length:k<=c.ch||k!=j.length-i.length))for(;;){if(b?!e:e==a.lineCount()-1)return;if(j=f(a.getLine(e+=b?-1:1)),i=g[b?--h:++h],!(h>0&&h<g.length-1)){var l=b?j.lastIndexOf(i):j.indexOf(i)+i.length;if(b?l!=j.length-i.length:l!=i.length)return;var m=d(c.line,k),n=d(e,l);return{from:b?n:m,to:b?m:n}}if(j!=i)return}}}}function c(a,c,d,e){return new b(a,c,d,e)}var d=a.Pos;return b.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(a){function b(a){var b=d(a,0);return c.pos={from:b,to:b},c.atOccurrence=!1,!1}for(var c=this,e=this.cm.clipPos(a?this.pos.from:this.pos.to);;){if(this.pos=this.matches(a,e))return this.pos.from&&this.pos.to||window.console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(a){if(!e.line)return b(0);e=d(e.line-1,this.cm.getLine(e.line-1).length)}else{var f=this.cm.lineCount();if(e.line==f-1)return b(f);e=d(e.line+1,0)}}},from:function(){return this.atOccurrence?this.pos.from:void 0},to:function(){return this.atOccurrence?this.pos.to:void 0},replace:function(b){if(this.atOccurrence){var c=a.splitLines(b);this.cm.replaceRange(c,this.pos.from,this.pos.to),this.pos.to=d(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0))}}},{getSearchCursor:c}}),define("scripteditor.utils/string-util",["jquery"],function(){function a(a){var b=/^[^\\/:*?\"<>|\x00-\x1f]+$/;return"undefined"!=typeof a&&b.test(a)&&a.length>=w&&a.length<=x}function b(a){return!/[\\\*\?"\(\)<>\|' &\$\^\/+\-]+/.test(a)}function c(a){return/^(ftp|http|https):\/\/[^ "]+$/.test(a.toLowerCase())}function d(a){return/^.*:\/\//.test(a)?a:"http://"+a}function e(a,b){return 0===a.indexOf(b)}function f(a,b){return-1!==a.indexOf(b,a.length-b.length)}function g(a,b){return b||(b=""),a.length>0?a.reduce(function(a,c){return a+b+c}):""}function h(a){var b=a.replace(/.*\[|\]/gi,""),c=b.match(/"[^=]*"|[^;]+/g);return c}function i(a,b){var c,d=h(a);if(d)for(c=0;c<d.length;c++)if(-1!==d[c].toLowerCase().indexOf(b.toLowerCase()))return d[c].split("=")[1];return""}function j(a,b){function c(){return(a+"\\"+b).replace("\\\\","\\")}function d(){return"\\\\"===a.substring(0,2)?"\\"+c():void 0}return d()||c()}function k(a){var b,c=h(a),d=[];return c&&c.forEach(function(a){b=a.split("="),b&&d.push({key:b[0],value:b.length>1?b[1]:""})}),d}function l(a){return"\\"===a.charAt(0)&&(a=a.substring(1)),"\\"===a.charAt(a.length-1)&&(a=a.slice(0,-1)),a}function m(a){return"\\"!==a.charAt(a.length-1)&&(a+="\\"),a}function n(a){var b;return"\\\\"===a.substring(0,2)?(b=l(a.substring(2)).split("\\"),b.pop(),"\\\\"+g(b,"\\")):(b=l(a).split("\\"),b.pop(),g(b,"\\"))}function o(a){return a.replace(/[0-9]+/g,function(a){var b=a.length,c=""+b,d="000",e=d.substring(0,d.length-c.length)+c;return e+""+a})}function p(a,b){a.sort(function(a,c){return q(a[b],c[b])})}function q(a,b){var c=o(a).toLowerCase(),d=o(b).toLowerCase();return c.localeCompare(d)}function r(a,b){if(!a)throw new Error("Haystack is undefined.");if(!b)throw new Error("Needle is undefined.");return-1!==a.indexOf(b)}function s(a,b){if(a+="",b+="",!b)return 0;var c=b.match(/^\/(.*)\/([a-z]*)$/);if(!c){a=a.toLowerCase(),b=b.toLowerCase();for(var d=0,e=0,f=b.length;;){if(e=a.indexOf(b,e),!(e>=0))break;d++,e+=f}return d}try{var g=new RegExp(c[1],-1===c[2].indexOf("i")?"":"i");return a.split(g).length-1}catch(h){return 0}}function t(a){return a.substring(a.lastIndexOf("\\")+1,a.length)}function u(a){return a.substring(0,a.lastIndexOf("\\")+1)}function v(a){var b=a.match(/.*\\(.*)\\.*$/);return b||(b=a.match(/^(.*)\\.*$/)),b?b[1]:null}var w=1,x=256,y={MIN_CONNECTION_NAME_LENGTH:w,MAX_CONNECTION_NAME_LENGTH:x,isValidConnectionName:a,isValidFieldName:b,isValidUrl:c,prefixHttpToUrl:d,endsWith:f,startsWith:e,goUpOneFolderLevel:n,removeSurroundingSlashes:l,arrayToString:g,formatDirectoryPathForEngine:m,sortSlightlyMoreNaturallyArray:p,sortSlightlyMoreNaturallySingle:q,_expandNumbersForNaturalSorting:o,getValueFromConnectionString:i,tokenizeConnectionString:k,contains:r,occurrencesRE:s,combinePath:j,fileNameFromPath:t,fileDirectoryFromPath:u,lastFolderFromPath:v};return y}),define("general.components/codearea/search-util",["scripteditor.utils/string-util"],function(a){function b(b,d){var e=a.occurrencesRE(b,d),f=e>=c?c:e;return f}var c=2e3;return{MAX_NBR_OF_HITS:c,getMaxNumberOfHits:b}}),define("general.components/codearea/searcher",["./search-cursor","./search-util"],function(a,b){function c(){this.posFrom=this.posTo=this.query=null,this.marked=[]}function d(d){function e(b,c){return a.getSearchCursor(d,b,c)}function f(a){s.validQuery=!0;var b=!1;try{return b?new RegExp(b[1],-1===b[2].indexOf("i")?"":"i"):a}catch(c){return s.validQuery=!1,a}}function g(){d.operation(function(){var a;if(r.query){for(r.query=null,a=0;a<r.marked.length;++a)r.marked[a].clear();r.marked.length=0}}),i()}function h(a){var c=2e3,h=0;return g(),a?(d.operation(function(){if(r.query=f(a),p=e(r.query,{line:0,ch:0}),h=b.getMaxNumberOfHits(d.getValue(),a),d.lineCount()<c)for(;p.findNext();)r.marked.push(d.markText(p.from(),p.to(),{className:"cm-searching"}));r.posFrom=r.posTo=d.getCursor(),p=e(r.query,{line:0,ch:0})}),k(),s.hits=h,h):(s.hits=0,0)}function i(){q&&q.clear()}function j(){i(),q=d.markText(p.from(),p.to(),{className:"cm-current"}),r.posFrom=p.from(),r.posTo=p.to()}function k(a,b){var c=p.find(a);return c?j():b&&b(),c}function l(){return p=e(r.query,{line:0,ch:0}),k(!1)}function m(){var a=d.lastLine(),b=d.getLine(a).length;return p=e(r.query,{line:a,ch:b}),k(!0)}function n(a,b,c){var d="string"==typeof r.query?b:p.pos.match[0].replace(r.query,b);p.replace(d),s.hits--;var e=p.find(a);e?j():c&&c()}function o(a,b){if(a){var c=0;return a=f(a),d.operation(function(){for(p=e(a);p.findNext();){c++;var d="string"==typeof r.query?b:p.pos.match[0].replace(r.query,b);p.replace(d)}}),s.hits=0,c}}var p,q,r=new c,s={doSearch:h,clearMarkedSearch:g,doFindNext:k,doFindFirst:l,doFindLast:m,doReplaceAll:o,doReplace:n,hits:0,validQuery:!0};return s}return{createSingleCodeareaSearcher:d}}),function(){function a(a){var b=a.search(c);return-1==b?0:b}var b={},c=/[^\s\u00a0]/,d=CodeMirror.Pos;CodeMirror.commands.toggleComment=function(a){var b=a.getCursor("start"),c=a.getCursor("end");a.uncomment(b,c)||a.lineComment(b,c)},CodeMirror.defineExtension("lineComment",function(e,f,g){g||(g=b);var h=this,i=h.getModeAt(e),j=g.lineComment||i.lineComment;if(!j)return void((g.blockCommentStart||i.blockCommentStart)&&(g.fullLines=!0,h.blockComment(e,f,g)));var k=h.getLine(e.line);if(null!=k){var l=Math.min(0!=f.ch||f.line==e.line?f.line+1:f.line,h.lastLine()+1),m=null==g.padding?" ":g.padding,n=g.commentBlankLines||e.line==f.line;h.operation(function(){if(g.indent)for(var b=k.slice(0,a(k)),f=e.line;l>f;++f){var i=h.getLine(f),o=b.length;(n||c.test(i))&&(i.slice(0,o)!=b&&(o=a(i)),h.replaceRange(b+j+m,d(f,0),d(f,o)))}else for(var f=e.line;l>f;++f)(n||c.test(h.getLine(f)))&&h.replaceRange(j+m,d(f,0))})}}),CodeMirror.defineExtension("blockComment",function(a,e,f){f||(f=b);var g=this,h=g.getModeAt(a),i=f.blockCommentStart||h.blockCommentStart,j=f.blockCommentEnd||h.blockCommentEnd;if(!i||!j)return void((f.lineComment||h.lineComment)&&0!=f.fullLines&&g.lineComment(a,e,f));var k=Math.min(e.line,g.lastLine());k!=a.line&&0==e.ch&&c.test(g.getLine(k))&&--k;var l=null==f.padding?" ":f.padding;a.line>k||g.operation(function(){if(0!=f.fullLines){var b=c.test(g.getLine(k));g.replaceRange(l+j,d(k)),g.replaceRange(i+l,d(a.line,0));var m=f.blockCommentLead||h.blockCommentLead;if(null!=m)for(var n=a.line+1;k>=n;++n)(n!=k||b)&&g.replaceRange(m+l,d(n,0))}else g.replaceRange(j,e),g.replaceRange(i,a)})}),CodeMirror.defineExtension("uncomment",function(a,e,f){f||(f=b);var g,h=this,i=h.getModeAt(a),j=Math.min(e.line,h.lastLine()),k=Math.min(a.line,j),l=f.lineComment||i.lineComment,m=[],n=null==f.padding?" ":f.padding;a:if(l){for(var o=k;j>=o;++o){var p=h.getLine(o),q=p.indexOf(l);if(-1==q&&(o!=j||o==k)&&c.test(p))break a;if(q>-1&&c.test(p.slice(0,q)))break a;m.push(p)}if(h.operation(function(){for(var a=k;j>=a;++a){var b=m[a-k],c=b.indexOf(l),e=c+l.length;0>c||(b.slice(e,e+n.length)==n&&(e+=n.length),g=!0,h.replaceRange("",d(a,c),d(a,e)))}}),g)return!0}var r=f.blockCommentStart||i.blockCommentStart,s=f.blockCommentEnd||i.blockCommentEnd;if(!r||!s)return!1;var t=f.blockCommentLead||i.blockCommentLead,u=h.getLine(k),v=j==k?u:h.getLine(j),w=u.indexOf(r),x=v.lastIndexOf(s);return-1==x&&k!=j&&(v=h.getLine(--j),x=v.lastIndexOf(s)),-1==w||-1==x?!1:(h.operation(function(){h.replaceRange("",d(j,x-(n&&v.slice(x-n.length,x)==n?n.length:0)),d(j,x+s.length));var a=w+r.length;if(n&&u.slice(a,a+n.length)==n&&(a+=n.length),h.replaceRange("",d(k,w),d(k,a)),t)for(var b=k+1;j>=b;++b){var e=h.getLine(b),f=e.indexOf(t);if(-1!=f&&!c.test(e.slice(0,f))){var g=f+t.length;n&&e.slice(g,g+n.length)==n&&(g+=n.length),h.replaceRange("",d(b,f),d(b,g))}}}),!0)})}(),define("codemirror.comment",function(){}),define("general.components/codearea/codearea-exposed-context-api",["qvangular","codemirror","codemirror.comment"],function(a,b){var c="\r\n";a.directive("qvCodeareaExposedContextApi",["$parse","$timeout",function(a,d){return{require:["qvCodearea","qvCodeareaExposedContextApi"],link:function(b,c,d,e){var f=e[0],g=e[1];g._connectCodeArea(f);var h=a(d.qvCodeareaExposedContextApi);h.assign(b,g),b.$on("$destroy",function(){h.assign(b,void 0),g._connectCodeArea(void 0)})},controller:function(){function a(a){p=a}function e(){for(var a=p.codemirror.getTokenAt(p.codemirror.getCursor()),b=0,c=a.state.lexical;c&&"qvfunction"!==c.type||0===b&&c.info&&a.string.toLowerCase()===c.info.toLowerCase();)c=c.prev,b++;return c?c.info:!1}function f(){p.focus()}function g(){p.codemirror.undo()}function h(){p.codemirror.redo()}function i(){b.commands.toggleComment(p.codemirror),f()}function j(){p.codemirror.indentSelection("add"),f()}function k(){p.codemirror.indentSelection("subtract"),f()}function l(a){var b=p.codemirror.getDoc().getSelection(),c=a(b);p.codemirror.replaceSelection(c)}function m(a){p.codemirror.setCursor(p.codemirror.getCursor("end"));var b=p.codemirror.getCursor().line,d=p.codemirror.getCursor().ch,e=p.codemirror.getLine(b).length;e>0&&(d===e?(p.codemirror.setCursor(b,e),p.codemirror.replaceSelection(c)):(p.codemirror.setCursor(p.codemirror.lineCount(),0),a=c+c+a)),p.codemirror.setCursor(p.codemirror.getCursor("end")),p.codemirror.replaceSelection(a),p.focus()}function n(a){p.codemirror.replaceSelection(a,"end"),p.focus()}function o(a){d(function(){var b=p.codemirror.lineCount();b>a?p.codemirror.setCursor(a-1,0):p.codemirror.setCursor(b-2,0),p.focus()})}var p,q={applyToSelection:l,focus:f,undo:g,redo:h,comment:i,indent:j,outdent:k,insertCode:m,replaceSelection:n,getFunctionNameUnderCursor:e,gotoLine:o,_connectCodeArea:a,codemirror:void 0};return Object.defineProperty(q,"canUndo",{get:function(){return p&&p.codemirror&&p.codemirror.historySize().undo>0},enumerable:!0}),Object.defineProperty(q,"canRedo",{get:function(){return p&&p.codemirror&&p.codemirror.historySize().redo>0},enumerable:!0}),q}}}])}),define("general.components/codearea/codearea-exposed-touch-api",["jquery","qvangular"],function(a,b){function c(a,b){var c,d=a.length,e=b.length,f=Math.min(a.length,b.length);for(c=0;f>c&&a.charAt(c)===b.charAt(c);c++);if(c===a.length&&c===b.length)return void 0;var g,h,i=c;for(c=0;f>c&&(g=d-c-1,h=e-c-1,!(i>g||i>h))&&a.charAt(d-c-1)===b.charAt(e-c-1);c++);var j=d-c-1,k=e-c-1;return{start:i,targetRange:{from:i,to:j+1},sourceRange:{from:i,to:k+1}}}b.directive("qvCodeareaExposedTouchApi",["$parse","$timeout",function(b,d){return{require:["qvCodearea","qvCodeareaExposedTouchApi"],link:function(a,c,e,f){var g=f[0],h=f[1];h._connectCodeArea(g);var i=b(e.qvCodeareaExposedTouchApi);i.assign(a,h),a.$on("$destroy",function(){i.assign(a,void 0),d(function(){h._connectCodeArea(void 0)})})},controller:["$scope",function(b){function e(a){o=a}function f(a,b){o.codemirror.scrollTo(b,a)}function g(a){o.setCustomFocusFn(a)}function h(c){function d(){var b=a(o.codemirror.getScrollerElement());c(b.scrollTop(),b.scrollLeft())}o.codemirror.on("scroll",d),b.$on("$destroy",function(){o.codemirror.off("scroll",d),c=void 0})}function i(a){function c(){var b={anchor:o.codemirror.indexFromPos(o.codemirror.getCursor("anchor")),head:o.codemirror.indexFromPos(o.codemirror.getCursor("head"))};a(o.codemirror.getValue(),b)}function d(){p||c()}c(),o.codemirror.on("change",d),b.$on("$destroy",function(){o.codemirror.off("change",d),a=void 0})}function j(c){b.$watch(function(){return String(o.codemirror.lineCount()).length},function(){d(function(){var b=a(o.codemirror.getGutterElement()).outerWidth(),d={top:0,left:b,bottom:0,right:0};c(d)})}),b.$on("$destroy",function(){c=void 0})}function k(a,b,c){o&&o.codemirror.setSelection(a,b,c)}function l(a,b){var d=o.codemirror.getValue("\n"),e=c(d,b);if(e){var f=b.substring(e.sourceRange.from,e.sourceRange.to),g=o.codemirror.posFromIndex(e.targetRange.from),h=o.codemirror.posFromIndex(e.targetRange.to);p=!0,o.codemirror.replaceRange(f,g,h),p=!1}}function m(){o.cssClasses["qv-codearea-disable-selection"]=!0}function n(){o.cssClasses["qv-codearea-disable-selection"]=!1}var o,p,q={_connectCodeArea:e,scrollTo:f,onScroll:h,setOverlayFocuser:g,replicateSelection:k,replicateContent:l,onNewContent:i,onResize:j,disableSelections:m,restoreSelections:n};return q}]}}]);var d={diff:c};return d}),define("general.components/codearea/codearea-exposed-search-api",["qvangular","general.components/codearea/searcher"],function(a,b){a.directive("qvCodeareaExposedSearchApi",["$parse",function(a){return{require:"qvCodearea",link:function(c,d,e,f){var g=a(e.qvCodeareaExposedSearchApi);g.assign(c,b.createSingleCodeareaSearcher(f.codemirror)),c.$on("$destroy",function(){g.assign(c,void 0)})},controller:function(){}}}])}),define("general.components/codearea/codearea-accelerators",["qvangular"],function(a){a.directive("qvCodeareaAccelerators",function(){return{require:["qvCodearea","qvCodeareaExposedContextApi"],link:function(b,c,d,e){function f(a,b){return a.keyCode===b.keyCode&&a.ctrlKey===(b.ctrlKey||!1)&&a.shiftKey===(b.shiftKey||!1)}function g(c,e){var g=b.$eval(d.qvCodeareaAccelerators);for(var h in g){var k=g[h];if(f(e,k)&&(!k.previous||f(j,k.previous)))return a.$apply(function(){k.fn(i)}),j={keyCode:void 0,ctrlKey:void 0,shiftKey:void 0},void e.preventDefault()}j={keyCode:e.keyCode,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey}}var h=e[0],i=e[1],j={keyCode:void 0,ctrlKey:void 0,shiftKey:void 0};h.codemirror.on("keydown",g),b.$on("$destroy",function(){h.codemirror.off("keydown",g)})}}})}),define("general.components/codearea/codearea-breakpoints",["jquery","qvangular"],function(a,b){function c(b){var c=a("<div class='qv-codearea-breakpoint-marker' data-icon='debugger-breakpoint'></div>");return c.data("breakpoint",b),c[0]}function d(b,c){c.enabled?(a(b).addClass("qv-codearea-breakpoint-marker-enabled"),a(b).removeClass("qv-codearea-breakpoint-marker-disabled")):(a(b).addClass("qv-codearea-breakpoint-marker-disabled"),a(b).removeClass("qv-codearea-breakpoint-marker-enabled"))}b.directive("qvCodeareaBreakpoints",function(){return{require:"qvCodearea",link:function(e,f,g,h){function i(a){if(a){l=a;for(var b=h.codemirror.getDoc().lineCount(),e=0;b>e;e++){var f=e+1,g=a[f],i=h.codemirror.lineInfo(e).gutterMarkers,j=i&&i["qv-codearea-breakpoint"];g?(j||(j=c(g),h.codemirror.setGutterMarker(e,"qv-codearea-breakpoint",j)),d(j,g)):j&&h.codemirror.setGutterMarker(e,"qv-codearea-breakpoint",null)}}}function j(){h.supressChangeEvent||b.$apply(function(){var b=l;for(var c in b)b.hasOwnProperty(c)&&delete b[c];for(var d=h.codemirror.getDoc().lineCount(),e=0;d>e;e++){var f=e+1,g=h.codemirror.lineInfo(e).gutterMarkers,i=g&&g["qv-codearea-breakpoint"];if(i){var j=a(i),k=j.data("breakpoint");k.lineNbr=f,b[f]=k}}})}function k(a,b){h.disabled||e.$apply(function(){var a=b+1,c=l[a];c?delete l[a]:l[a]={enabled:!0,lineNbr:a}})}var l;e.$watch(g.qvCodeareaBreakpoints,i),e.$watch(g.qvCodeareaBreakpoints,i,!0),h.codemirror.on("change",j),h.codemirror.on("gutterClick",k),e.$on("$destroy",function(){h.codemirror.off("change",j),h.codemirror.off("gutterClick",k)})}}})}),define("general.components/codearea/codearea-debug-location",["qvangular"],function(a){a.directive("qvCodeareaDebugLocation",function(){return{require:"qvCodearea",link:function(a,b,c,d){var e;a.$watch(c.qvCodeareaDebugLocation,function(a){if(a){var b=d.codemirror.lastLine()+1,c=a.lineNbr;c>b&&(c=b),e&&(d.codemirror.removeLineClass(e,"background","qv-codearea-current-debug-line"),d.codemirror.removeLineClass(e,"background","qv-codearea-current-debug-line-error")),c>0&&b>=c&&(d.codemirror.addLineClass(c-1,"background","qv-codearea-current-debug-line"),a.errorMessage&&d.codemirror.addLineClass(c-1,"background","qv-codearea-current-debug-line-error"),d.codemirror.scrollIntoView({line:c-1,ch:0},200),e=d.codemirror.getLineHandle(c-1))}},!0)}}})}),define("general.components/codearea/codearea-code-container",["qvangular"],function(a){a.directive("qvCodeareaCodeContainer",function(){return{require:"qvCodearea",priority:-1,link:function(a,b,c,d){function e(a){d.supressChangeEvent=!0,d.codemirror.setValue(a),d.supressChangeEvent=!1,setTimeout(function(){d.codemirror.refresh(d.codemirror)},0)}function f(){return d.codemirror.getValue()}function g(){d.supressChangeEvent||(h.content=f(),clearTimeout(i),i=setTimeout(function(){a.$apply()},250))}var h;a.$watch(c.qvCodeareaCodeContainer,function(a,b){b&&b!==a&&(b.editorState={history:JSON.stringify(d.codemirror.getHistory()),selectionFrom:d.codemirror.getCursor(!0),selectionTo:d.codemirror.getCursor(!1),scrollInfo:d.codemirror.getScrollInfo()},b.content=f()),a&&(e(a.content||""),a.editorState?(d.codemirror.setHistory(JSON.parse(a.editorState.history)),d.codemirror.setSelection(a.editorState.selectionFrom,a.editorState.selectionTo),d.codemirror.scrollTo(a.editorState.scrollInfo.left,a.editorState.scrollInfo.top)):d.codemirror.clearHistory()),h=a});var i=null;d.codemirror.on("change",g),a.$on("$destroy",function(){d.codemirror.off("change",g)})}}})}),define("general.components/codearea/codearea-errors",["qvangular"],function(a){a.directive("qvCodeareaErrors",function(){return{require:"qvCodearea",link:function(a,b,c,d){var e=[];a.$watch(c.qvCodeareaErrors+".content",function(a){if(a){var b;for(b=0;b<e.length;b++)e[b].clear();for(b=0;b<a.length;b++){var c=a[b],f={line:c.qLineInTab,ch:c.qColInLine},g={line:c.qLineInTab,ch:c.qColInLine+c.qErrLen},h=c.selected?"syntaxContainerErrorMarkSelected":"syntaxContainerErrorMarkGeneral",i=d.codemirror.markText(f,g,{className:h});e.push(i)}}},!0),a.$on("$destroy",function(){e=[]})}}})}),define("general.components/codearea/codemirror-change-limiter",[],function(){function a(a,b,c){var d=b.text.join("\n"),e=a.getRange(b.from,b.to).length,f=d.length,g=f-e,h=a.getValue().length;h>=c&&0===e?b.cancel():h+g>c&&(f=Math.max(0,c-h+e),d=d.substr(0,f),b.update(null,null,d.split("\n")))}return a}),define("general.components/codearea/codearea-limit",["qvangular","general.components/codearea/codemirror-change-limiter"],function(a,b){a.directive("qvCodeareaLimit",function(){return{require:"qvCodearea",link:function(a,c,d,e){function f(c,e){var f=a.$eval(d.qvCodeareaLimit);f&&f>0&&b(c,e,f)}e.codemirror.on("beforeChange",f),a.$on("$destroy",function(){e.codemirror.off("beforeChange",f)})}}})}),define("core.utils/external-urls",["translator"],function(a){var b={serverHelpBaseUrl:"http://help.qlik.com/sense/1.1/",personalHelpBaseUrl:"http://help.qlik.com/sense/1.1/",cloudBaseUrl:"https://qlikcloud.com/",cloudUploadUrl:"https://qlikcloud.com/upload?"};return Object.defineProperty(b,"gettingStarted",{get:function(){return"http://www.qlik.com/"+a.language+"-sense-gettingstarted"}}),b}),define("core.utils/help-url",["core.utils/external-urls"],function(a){function b(){var a=location.pathname.split("/").slice(-2,-1)[0];location.pathname.toLowerCase().indexOf("workbench")>-1?a="workbench":"qmc"!==a.toLowerCase()&&(a="client"),d+=a+"/"}var c={},d=a.serverHelpBaseUrl;return c.setBaseUrl=function(c){d=c?a.personalHelpBaseUrl:a.serverHelpBaseUrl,b()},Object.defineProperty(c,"path",{get:function(){return d}}),b(),c}),define("general.components/codearea/codearea-help-mode",["qvangular","core.utils/help-url","translator"],function(a,b,c){function d(a,b){var c,d,e,f=[];for(d=0;d<a.length;d++)for(c=a[d].split(" "),e=0;e<c.length;e++)c[e].toLowerCase()===b.toLowerCase()&&(j||(j=c.length>1,k=e>0),f.push(a[d]));return f}function e(a,b,c){if(" "===c.string){var d=a.getTokenAt({ch:c.end+1,line:b.line});if(d.string.length>1)return d}return c}function f(a,b,c,d){var e=d?b.end-(b.string.length+1):b.end+2,f=a.getTokenAt({ch:e,line:c.line});return f}function g(a,b,c,d){var e={left:b.pageX,top:b.pageY},f=a.coordsChar(e,"window"),g=a.getTokenAt(f);return i(a,g,c,d)}function h(a,b,c,d){var e=a.getTokenAt(a.getCursor());return i(a,e,c,d)}function i(a,g,h,i){j=!1,k=!1,h=h?h:"scriptsyntax";var m,n,o,p=b.path+"?"+c.language+"|"+h+".",q=[];"keyword"===g.type&&(g=e(a,a.getCursor(),g),q=d(i.getAllKeywords(),g.string),j?(n=f(a,g,a.getCursor(),k),o=d(q,n.string),m=o.length>0&&n.string!==g.string?k?n.string+"_"+g.string:g.string+"_"+n.string:g.string):m=g.string,p+=m,/firefox/.test(window.navigator.userAgent.toLocaleLowerCase())&&l&&l.close(),l=window.open(p,"__qlikviewhelp"))}var j,k,l;a.directive("qvCodeareaHelpMode",function(){return{require:"qvCodearea",link:function(a,b,c,d){var e,f=a.$watch(c.qvCodeareaHelpModeOptions,function(b){function i(a,c){e&&(c.preventDefault(),g(a,c,b.syntax,b.service))}function j(a,c){72!==c.keyCode&&104!==c.keyCode||!c.ctrlKey||(c.preventDefault(),h(d.codemirror,c,b.syntax,b.service))}f(),a.$watch(c.qvCodeareaHelpMode,function(a){e=a,d.cssClasses["qv-codearea-help-mode"]=a}),d.codemirror.on("mousedown",i),d.codemirror.on("keydown",j),a.$on("$destroy",function(){d.codemirror.off("keydown",j),d.codemirror.off("mousedown",i)})})}}})}),define("general.components/codearea/codearea-touch-overlay",["qvangular"],function(a){a.directive("qvCodeareaTouchOverlay",function(){return{restrict:"E",replace:!0,scope:{codeareaTouchApi:"=",enabled:"=",helpMode:"="},template:'<div class="qv-codearea-touch-overlay-container" ng-style="containerStyle"><textarea class="qv-codearea-touch-overlay" autocorrect="off" autocapitalize="off" autocomplete="off" spellcheck="false" wrap="off"></textarea></div>',link:function(a,b){function c(b){function c(a,b){var c=a.substring(0,b).split("\n"),d=c.length-1,e=c[c.length-1].length;return{line:d,ch:e}}function f(){var a=d.val(),e=d[0].selectionStart,f=d[0].selectionEnd,g=c(a,e),h=c(a,f);b.replicateSelection(g,h,{scroll:!1})}function g(){e||((d[0].selectionStart!==i||d[0].selectionEnd!==j)&&(i=d[0].selectionStart,j=d[0].selectionEnd,f()),setTimeout(g,200))}var h=/iPad|iPhone|iPod/.test(navigator.userAgent);h&&d.css("padding-left","1px"),b.disableSelections(),a.$on("$destroy",function(){b.restoreSelections()}),b.onNewContent(function(a,b){d.val(a),d[0]===document.activeElement&&(d[0].selectionStart!==b.anchor||d[0].selectionEnd!==b.head)&&(d[0].selectionStart=b.anchor,d[0].selectionEnd=b.head)}),b.setOverlayFocuser(function(){}),b.onResize(function(b){a.containerStyle.left=b.left}),b.onScroll(function(a,b){d.scrollTop(a),d.scrollLeft(b)}),d.on("scroll",function(){b.scrollTo(d.scrollTop(),d.scrollLeft())}),d.on("input",function(a){var c=d.val();b.replicateContent(a,c)});var i,j;setTimeout(g,200)}var d=b.find("textarea"),e=!1;a.containerStyle={},a.$watch("helpMode",function(a){a?b.hide():b.show()});var f=a.$watch("codeareaTouchApi",function(a){a&&(c(a),f())});a.$on("$destroy",function(){e=!0,d=void 0})}}})}),define("general.components/codearea/codearea-block-large-pastes",["qvangular"],function(a){a.directive("qvCodeareaBlockLargePastes",function(){var a=function(a){return""===a||isNaN(a)?1e6:a},b=function(a){return a.originalEvent.clipboardData?a.originalEvent.clipboardData.getData("text/plain").length:window.clipboardData.getData("Text").length};return{restrict:"A",controller:["$scope","$element","$attrs",function(c,d,e){d.find("textarea").on("paste",function(c){b(c)>a(e.qvCodeareaBlockLargePastes)&&c.preventDefault()}),c.$on("$destroy",function(){d.find("textarea").off("paste")})}]}})}),define("general.components/codearea/codearea-exposed-gutter-width",["jquery","qvangular"],function(a,b){b.directive("qvCodeareaExposedGutterWidth",["$parse","$timeout",function(b,c){return{require:"qvCodearea",link:function(d,e,f,g){var h=b(f.qvCodeareaExposedGutterWidth);d.$watch(function(){return String(g.codemirror.lineCount()).length},function(){var b=a(g.codemirror.getGutterElement()).outerWidth();h.assign(d,b),c(function(){var b=a(g.codemirror.getGutterElement()).outerWidth();h.assign(d,b)})}),d.$on("$destroy",function(){h.assign(d,void 0)})},controller:function(){}}}])}),define("general.components/codearea/codearea-composition-event",["qvangular","jquery","codemirror"],function(a,b,c){function d(a){var b,c,d,e;for(c=a.getAllMarks(),d=0,e=c.length;e>d;d++)b=c[d],null!=b&&b.className===q&&b.clear();return!0}function e(a,e){function q(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");return b>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)}var s=e;a.options.enableCompositionMod=!0,j=function(){k&&k(),a.display.input.blur(),a.display.input.focus()},i=function(b){if(l=b["char"],k&&k(),a.display.inCompositionMode){var c=a.getCursor(),d=a.display.compositionHead,e=a.charCoords(c).left-a.charCoords(d).left;e+=void 0!==l?30:1,a.display.input.style.width=e+"px"}},f=function(){a.options.enableCompositionMod&&(p.disabled=!0,a.display.inCompositionMode=!0,n=s.offset(),a.display.inputDiv.classList.add("CodeMirror-input-wrapper"),a.display.inputDiv.classList.add("in-composition"),a.setOption("readOnly",!0),a.somethingSelected()&&a.replaceSelection(""),a.display.compositionHead=a.getCursor(),void 0===l?a.display.input.value="":" "===l&&g({data:" "}))},g=function(b){var c,d;if(a.options.enableCompositionMod&&a.display.inCompositionMode){var e=a.display.compositionHead;a.display.textMarkerInComposition?(c=a.display.textMarkerInComposition.find(),c&&(a.replaceRange(b.data,e,c.to),a.display.textMarkerInComposition.clear(),a.display.textMarkerInComposition=void 0)):a.replaceRange(b.data,e,e);var f=a.getCursor();d=a.charCoords(f).left-a.charCoords(e).left,void 0===l&&(d+=1),a.display.input.style.width=d+"px",a.display.textMarkerInComposition=a.markText(e,f,r),m()}},h=function(b){var e;a.options.enableCompositionMod&&a.display.inCompositionMode&&(q()?"\b"===l&&g(b):g(b),a.display.inCompositionMode=!1,a.display.compositionHead=void 0,null!=(e=a.display.textMarkerInComposition)&&e.clear(),a.display.textMarkerInComposition=void 0,a.setOption("readOnly",!1),a.display.inputDiv.classList.remove("in-composition"),a.display.inputDiv.classList.remove("CodeMirror-input-wrapper"),d(a),k=function(){p.disabled=!1,c.off(a.display.input,"input",k),a.display.inCompositionMode||(a.display.input.value="",a.display.input.style.width="0px",k=void 0)},c.on(a.display.input,"input",k))},m=function(){if(a.display.inCompositionMode){var b=a.charCoords(a.display.compositionHead).top-n.top;void 0!==l&&(b-=1),a.display.inputDiv.style.top=b+"px";var c=a.charCoords(a.display.compositionHead).left-n.left;a.display.inputDiv.style.left=c+"px"}},o=function(c){var d=b(a.display.scroller);d.scrollTop(d.scrollTop()-c.wheelDelta)}}var f,g,h,i,j,k,l,m,n,o,p,q="CodeMirror-text-in-composition",r={inclusiveLeft:!0,inclusiveRight:!0,className:q};a.directive("qvCodeareaCompositionEvent",function(){return{restrict:"A",require:"qvCodearea",link:function(a,d,l,n){e(n.codemirror,d);var q=n.codemirror.display.input,r=a.$watch(l.qvCodeareaAutocomplete,function(a){p=a,r()});r=a.$watch("codeareaTouchApi",function(a){a&&(a.onResize(function(){m()}),a.onScroll(function(){m()}),r())}),b(window).on("resize",m),c.on(n.codemirror,"mousedown",j),c.on(q,"keydown",i),c.on(q,"compositionstart",f),c.on(q,"compositionupdate",g),c.on(q,"compositionend",h),c.on(q,"mousedown",j),c.on(q,"mousewheel",o),a.$on("$destroy",function(){b(window).off("resize",m),c.off(n.codemirror,"mousedown",j),c.off(q,"compositionstart",f),c.off(q,"keydown",i),c.off(q,"compositionupdate",g),c.off(q,"compositionend",h),c.off(q,"input",k),c.off(q,"mousedown",j),c.off(q,"mousewheel",o)})}}})}),define("general.components/codearea/codearea",["jquery","qvangular","codemirror","codemirror.matchbrackets","general.components/codearea/qlikview-script-mode","general.components/codearea/codearea-function-tip","general.components/codearea/codearea-autocomplete","general.components/codearea/searcher","general.components/codearea/codearea-exposed-context-api","general.components/codearea/codearea-exposed-touch-api","general.components/codearea/codearea-exposed-search-api","general.components/codearea/codearea-accelerators","general.components/codearea/codearea-breakpoints","general.components/codearea/codearea-debug-location","general.components/codearea/codearea-code-container","general.components/codearea/codearea-errors","general.components/codearea/codearea-limit","general.components/codearea/codearea-help-mode","general.components/codearea/codearea-touch-overlay","general.components/codearea/codearea-block-large-pastes","general.components/codearea/codearea-exposed-gutter-width","general.components/codearea/codearea-composition-event"],function(a,b,c){b.directive("qvCodearea",function(){return{replace:!0,restrict:"EA",priority:2,scope:{mode:"=",showBreakpointGutter:"=",resizeTrigger:"=",options:"=",showLineNumbers:"@",disabled:"="},template:"<div class='qv-codearea' ng-class='cssClasses'></div>",controller:["$scope","$element","$timeout",function(b,d,e){var f=this;
b.cssClasses={},"undefined"==typeof b.showLineNumbers&&(b.showLineNumbers=!0);var g=[],h="true"===b.showLineNumbers||b.showLineNumbers===!0;h&&g.push("CodeMirror-linenumbers"),b.showBreakpointGutter&&g.push("qv-codearea-breakpoint");var i={lineWrapping:!1,lineNumbers:h,mode:b.mode,matchBrackets:!0,gutters:g};return b.options&&(i=a.extend({},i,b.options)),f.codemirror=c(d[0],i),f.cssClasses=b.cssClasses,f.setCustomFocusFn=function(a){f.customfocusFn=a},f.focus=function(){f.customfocusFn?f.customfocusFn():f.codemirror.hasFocus()||f.codemirror.focus()},b.codemirror=f.codemirror,b.codemirror.on("drop",function(a,b){b.dataTransfer.files.length>0&&b.preventDefault()}),b.$watch("disabled",function(a){f.disabled=a,f.cssClasses["qv-codearea-disabled"]=a,a&&"nocursor"!==f.codemirror.getOption("readOnly")?f.codemirror.setOption("readOnly","nocursor"):a||"nocursor"!==f.codemirror.getOption("readOnly")||f.codemirror.setOption("readOnly",!1)}),b.$watch("resizeTrigger",function(a){a&&e(function(){f.codemirror.refresh()})}),b.$on("$destroy",function(){b.codemirror=void 0,setTimeout(function(){f.codemirror=void 0,f.overrideCustomFocus=void 0},1e3)}),e(function(){a(".qv-codearea .CodeMirror textarea").css("font-size","13px")}),f}]}})}),define("assets/client/dialogs/expression-dialog/expression-dialog",["jquery","core.models/app","core.utils/deferred","general.models/field","client.assets/tab-contents/fields/assets-field-list-model","general.utils/expression-validator","general.components/info-popover/info-popover","general.services/show-service/show-service","text!assets/client/dialogs/expression-dialog/expression-dialog.ng.html","assets/client/dialogs/expression-dialog/expression-dialog-controller","assets/client/dialogs/expression-dialog/expression-validation-info","general.utils/string-limits","client.services/validation","translator","general.components/function-tip-view/function-tip-view","touche","general.models/bnf-model","general.components/extract","general.components/codearea/codearea"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a,b){b.preventDefault();var c=a.controller.previewText();a.codearea.contextApi.replaceSelection(c)}function s(a,b){a.functionTipOptions={service:b,view:o}}function t(b,c,d,e){function f(){h(),c.codearea.contextApi.focus()}function h(){a(document).off("keydown",f),i.remove()}if(d){var i=a("<div />").appendTo(document.body);d=d.replace(/\n/g," "),/^(input|textarea)$/i.test(document.activeElement.tagName)&&a.support.touch&&document.activeElement.blur(),i.showComponent(g,{alignTo:e.target,text:d,onClose:h,position:"top"}),a(document).one("keydown",{self:this},f)}}function u(a,b){var c={expression:a,validity:b.validity};return m.validateExpr(c,l)}function v(a){var f=a.app||b.current;return c.all({bnf:q.getExpressionBnfModel(),fields:d.getListLayout(null,f)}).then(function(b){var c=b.bnf,d=e.expand(b.fields);c.setFields(d);var f=String(a.expr||"");f=f.replace(/^=+/,"");var g={title:a.title,allowEmpty:a.allowEmpty,labels:a.labels,expr:f,mode:a.mode,controller:j.create({fields:d,translator:n}),expressionBnfModel:c},i=h.show(w,g);return i.resultPromise})}var w={template:i,controller:["$scope","$element",function(a,b){function c(b){a.info.setExpr(b),a.validity.expression||u(b,a)}a.stringLimits=l,a.controller=a.input.controller,a.codearea={content:a.input.expr};var d=new f.ExpressionValidator(null,a.input.mode);a.validity={expression:!0},a.enableTouchOverlay=p.utils.touch,a.insertTextHandler=r.bind(null,a),a.$watch("controller.selectedTable",function(b){a.controller.setTableFilter(b)}),a.info=k.create({validator:d,labels:a.input.labels}),a.info.setExpr(a.input.expr),a.showErrorMessage=t.bind(null,b,a),a.qlikviewReloadScriptMode={name:"qlikviewscript",service:a.input.expressionBnfModel},a.helpModeOptions={syntax:"chartsyntax",service:a.input.expressionBnfModel},s(a,a.input.expressionBnfModel),a.cancel=function(){a.destroyComponent(),a.deferredResult.reject()},a.confirm=function(){var b=a.codearea.content,c=u(b,a);(c||a.input.allowEmpty&&""===b)&&(a.destroyComponent(),a.deferredResult.resolve(b))},a.$watch("codearea.content",c)}]};return{_insertTextHandler:r,show:v}}),define("client.property-panel/property-panel-directives",["jquery","angular","qvangular","core.utils/resize","general.utils/expression-validator","assets/client/dialogs/expression-dialog/expression-dialog","util","general.utils/dom-util","general.utils/support","jqueryui"],function(a,b,c,d,e,f,g,h,i){function j(a){return"ValueExpr"===a||"ValueExpression"===a?e.Modes.NumberOrExpression:e.Modes.Expression}function k(a,b){if(void 0===a)return!1;switch(b){case"StringExpression":return 0===a.indexOf("=");case"ValueExpression":return"string"==typeof a&&0===a.indexOf("=");case"StringExpr":return 0===a.indexOf("=");case"ValueExpr":return!0;case"dimension":return!0;case"measure":return!0;default:return!1}}return c.directive("ppSortable",[function(){return{scope:"=",link:function(b,c,d){b.$watch(d.ppSortable,function(d){if(d){var e;d=g.extend({},{handle:"[pp-sortable-handle]",start:function(a,b){b.item.data("startPos",b.item.index())},scrollSpeed:i.treatAsDesktop()?25:60,distance:i.treatAsDesktop()?10:0,items:"> :not(.locked)",cancel:".locked",update:function(a,c){var e=c.item.index(),f=c.item.data("startPos");b.$apply(function(){d.onMove(f,e)})},stop:function(){i.treatAsDesktop()||c.sortable("option","disabled",!0)}},d),e=c.closest(".pp-section"),e.length&&(d.containment=e),c.sortable(d),i.treatAsDesktop()||c.sortable("option","disabled",!0),b.enableTouchDrag=function(){var b;c.sortable("option","disabled",!1),b=a.Event(window.event,{type:"mousedown"}),b.which=1,b.pageX=window.event.pageX,b.pageY=window.event.pageY,b.target=window.event.target,a.ui.mouse.prototype._touchStart.call(c.data("ui-sortable"),b)}}})}}}]),c.directive("ppSlider",[function(){return{require:"?ngModel",link:function(a,d,e,f){a.$watch(e.ppSlider,function(e){e&&(e.range?(e=g.extend({},{min:0,max:10,step:1,values:f.$modelValue,stop:function(b,d){c.$apply(a,function(){f.$setViewValue(d.values)})}},e),a.$watchCollection(function(){return f.$modelValue},function(a,c){b.equals(a,c)||d.slider("values",a)})):(e=g.extend({},{min:0,max:10,step:1,value:f.$modelValue,stop:function(b,d){c.$apply(a,function(){f.$setViewValue(d.value)})}},e),a.$watch(function(){return f.$modelValue},function(a,b){a!==b&&d.slider("value",a)})),d.slider(e))})}}}]),c.directive("ppModelOnblur",function(){return{priority:1,require:"ngModel",link:function(a,b,c,d){"radio"!==c.type&&"checkbox"!==c.type&&(b.unbind("input keydown change compositionend"),b.bind("blur",function(){b.attr("readonly")||a.$apply(function(){d.$setViewValue(b.val())})}),b.bind("keydown",function(a){27===a.which?(a.stopPropagation(),b.val(d.$viewValue),b.trigger("blur")):13===a.which&&"textarea"!==b[0].nodeName.toLowerCase()&&b.trigger("blur")}))}}}),c.directive("ppModelOnkeyup",function(){return{priority:2,link:function(a,b){b.bind("keyup",function(){"function"==typeof a.onkeyup&&a.onkeyup(b)})}}}),c.directive("ppPlaceholder",function(){return{link:function(a,b,c){function d(){var d=a.$eval(c.ppPlaceholder),e=a.$eval(c.ppPlaceholderSuppressEqual);e&&"="===d[0]&&(d=d.substr(1)),b.attr("placeholder",d)}b.on("focus",function(){b.attr("placeholder","")}),b.on("blur",function(){d()}),a.$watch(c.ppPlaceholder,function(){d()})}}}),c.directive("ppAccordion",function(){return{template:"<div ng-transclude></div>",transclude:!0,scope:{ppAccordion:"=",definition:"=",args:"="},controller:["$scope","$element","$timeout",function(b,c,e){function f(a){var c=-1;return a=a.split(".")[0],Object.keys(b.definition.items||{}).filter(function(a){var c=b.definition.items[a];return c.show!==!1}).forEach(function(b,d){return b===a?(c=d,!1):void 0}),c}var g=function(){e(function(){c.accordion("refresh")})},h=b.args.cache;this.loadit=function(e){var j=h.get("accordion_path"),k=-1;j&&(k=f(j)),e===b.ppAccordion.length-1&&(c.accordion({header:".pp-section-header",active:k,heightStyle:"fill",animate:i.treatAsDesktop()?"swing":!1,activate:function(b,c){var d=a(c.newPanel).attr("x-path");h.put("accordion_path",d)}}),d.on("end",g))},b.$on("pp-open-path",function(a,b){c.accordion("option","active",f(b))}),b.$on("$destroy",function(){d.off("end",g)})}]}}),c.directive("ppAccordionItem",function(){return{require:"^ppAccordion",link:function(a,b,c,d){d.loadit(a.$index)}}}),c.directive("ppInputValidator",["$parse",function(a){return{require:"ngModel",link:function(b,c,d,f){function h(c){d.ppValidationOnResult?a(d.ppValidationOnResult)(b,{isValid:c}):b.invalid=!c}function i(a){h(a.valid)}function l(a){var c=!1;return"boolean"==typeof p.invalid&&(c=c||p.invalid),"function"==typeof p.invalid&&(c=c||p.invalid.call(null,b.data,b.args.properties,b.args)),"number"===p.type&&(g.isNumeric(a)?("number"==typeof p.max&&a>p.max&&(c=!0),"number"==typeof p.min&&a<p.min&&(c=!0)):c=!0),"integer"===p.type&&(g.isInteger(a)?("number"==typeof p.max&&a>p.max&&(c=!0),"number"==typeof p.min&&a<p.min&&(c=!0)):c=!0),"string"===p.type&&("undefined"!=typeof p.maxlength&&(c=c||a.length>p.maxlength),"undefined"!=typeof p.minlength&&(c=c||a.length<p.minlength)),!c}function m(a){"measure"===q?""===a?h(!0):o.validate(a):"dimension"===q?""===a?h(!1):(a&&"="!==a[0]&&(a="="+g.escapeField(a)),o.validate(a)):o.validate(a)}function n(a){k(a,q)?m(a):h(l(a))}var o=null,p=b.definition,q=d.expressionType;q&&(o=new e.ExpressionValidator(null,j(q)),o.Update.bind(i)),b.$on("datachanged",function(){n(f.$modelValue)}),b.$watch(function(){return f.$modelValue},function(a){n(a)}),b.$on("$destroy",function(){o&&o.Update.unbind(i)})}}}]),c.directive("ppExpressionEditor",["$parse","$timeout",function(b,c){return{link:function(d,e,i){function l(){var a=b(i.ppExpressionEditor)(d),c=i.expressionType,e=j(c);"object"==typeof a&&("StringExpression"===c?a=a.qStringExpression.qExpr:"ValueExpression"===c?a=a.qValueExpression.qExpr:"StringExpr"===c?a=a.qv:"ValueExpr"===c&&(a=a.qv));var h=k(a,c);"dimension"===c&&a.length?"="!==a[0]&&(a="="+g.escapeField(a)):h||"StringExpr"!==c&&"StringExpression"!==c||("StringExpr"===c&&a.qv&&(a=a.qv),a&&(a="'"+a.replace(/'/g,"''")+"'")),f.show({expr:a,title:a?"Dimension.Expression.Dialog.Edit.Title":"Dimension.Expression.Dialog.Add.Title",allowEmpty:!0,mode:e}).then(function(a){"ValueExpression"===c&&a.length?a={qValueExpression:{qExpr:a}}:"StringExpression"===c&&a.length?a={qStringExpression:{qExpr:a}}:"ValueExpr"===c?a={qv:a}:"StringExpr"===c?("="!==a[0]&&(a="="+a),a={qv:a}):"dimension"===c&&a.length&&"="!==a[0]&&(a="="+a),i.ppExpressionEditorOnApply?b(i.ppExpressionEditorOnApply)(d,{value:a}):(d.value=a,d.change())},function(){})}e.on("qv-activate.pp-expression",function(){var e,f=null;i.editorDisabled&&(f=b(i.editorDisabled)(d))||(h.isInput(document.activeElement)?(e=a(document.activeElement),e.on("blur.pp-expression",function(){c(function(){l()}),e.off("blur.pp-expression")}),e.blur()):l())}),d.$on("$destroy",function(){e.off(".pp-expression")})}}}]),c.componentDirective("includePpComponent",{definition:"=",data:"=",args:"="}),{}}),define("client.property-panel/property-panel",["qvangular","core.models/rpc-base","core.models/app","core.utils/deferred","text!./property-panel.ng.html","client.property-panel/components/components","general.utils/property-resolver","./sheet-properties/sheet-properties","util","client.utils/state","client.property-panel/property-panel-directives"],function(a,b,c,d,e,f,g,h,i,j){function k(a){a.isInvalid=a.model.layout.qError||"invalid"===a.type,a.isLinked=!!a.data.qExtendsId}var l=a.getService("$cacheFactory"),m=l("pp-object"),n=l("pp-sheet");a.directive("qvPropertyPanel",function(){return{template:e,restrict:"E",replace:!0,scope:{},controller:["$scope",function(a){var c=!0;this.destroy=function(){a.destroyComponent()},b.bindLayout(a,"model",function(b){var d=b.visualization||b.qInfo.qType;a.type&&a.type!==d||(c?c=!1:a.model.getProperties().then(function(b){a.data=b,a.handler&&a.handler.setProperties(b),k(a),a.$broadcast("datachanged",a.data)}),a.title=g.getValue(b,a.titleRef||"title"),a.subtitle=b.subtitle,a.$broadcast("layoutchanged",b))}),a.$on("saveProperties",function(b){b.stopPropagation(),a.$broadcast("datachanged",a.data),a.globalChangeListeners&&a.globalChangeListeners.forEach(function(b){b&&"function"==typeof b&&b(a.data)}),a.model.save(),c=!0}),a.$on("updateContent",function(b,d){b.preventDefault(),f.loadComponents().then(function(){a.args=d.args,a.definition=d.definition,a.globalChangeListeners=d.globalChangeListeners,a.data=d.data,a.model=d.model,a.iconClass=d.iconClass,a.titleRef=d.titleRef,a.type=d.type,a.handler=d.args.handler,a.rootComponent=i.extend({},f.findComponent(d.definition)),k(a),c=!0})})}]}}),a.directive("qvStageProperties",function(){return{template:"<div class='qv-panel-properties'><qv-property-panel></qv-property-panel></div>",restrict:"E",replace:!0,scope:{cell:"="},controller:["$scope",function(a){function b(){a.updateStageProperties()}j.SheetChanged.bind(b),a.$watch("cell",function(b){a.updateStageProperties(b)}),a.$on("refreshPropertyPanel",function(){a.updateStageProperties(a.cell)}),a.$on("$destroy",function(){j.SheetChanged.unbind(b)}),a.updateStageProperties=function(b){if(b)c.get().then(function(c){b.getVisualization().then(function(b){b.getPropertyPanelContent().then(function(e){var f=e.handler,g=e.ext;delete e.handler,delete e.ext,d.all({clearSoftProperties:e.backendApi?e.backendApi.clearSoftProperties():d.resolve(),appLayout:c.getLayout(),properties:b.model.getProperties(),layout:b.model.getLayout()}).then(function(c){f.setProperties(c.properties),f.setLayout(c.layout),e.data=c.properties,e.model=b.model,e.args={properties:c.properties,layout:c.layout,model:b.model,cache:m,handler:f,localeInfo:c.appLayout.qLocaleInfo,ext:g},a.$broadcast("updateContent",e)})})})});else{var e=j.model;e.getProperties().then(function(b){e.getLayout().then(function(c){h.items.sheetProps.items.title.readOnly=!c.permissions.update||c.qMeta&&c.qMeta.sourceObject&&c.qMeta.sourceObject.length>0,h.items.sheetProps.items.description.readOnly=!c.permissions.update,h.items.sheetProps.items.thumbnail.readOnly=!c.permissions.update,a.$broadcast("updateContent",{data:b,definition:h,id:"sheet",model:e,iconClass:"icon-toolbar-app",titleRef:"qMeta.title",args:{cache:n,model:e}})})})}}}]}})}),define("text!client.property-panel/components/accordion/accordion.ng.html",[],function(){return'<div pp-accordion="items" x-args="args" x-definition="definition" tabindex=\'-1\' class="pp-accordion-container" tcl="accordion">\r\n	<div class="pp-section" ng-repeat="item in items" pp-accordion-item tid="{{item.key}}">\r\n		<h4 class="pp-section-header" ng-class="{ \'last\': $last }">{{item.label}}</h4>\r\n		<div class="pp-section-content" include-pp-component x-component="item.component" x-definition="item.definition"\r\n			 x-data="data" x-args="args" x-path="{{item.path}}">\r\n		</div>\r\n	</div>\r\n</div>'}),define("client.property-panel/components/accordion/accordion",["client.property-panel/components/components","client.property-panel/component-utils","text!./accordion.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(c){var d=c.definition.items,e=function(){return c.data};c.items=Object.keys(d).filter(function(a){var b=d[a];return"boolean"==typeof b.show?b.show:!0}).map(function(f){var g,h=d[f];return g={component:a.findComponent(h),definition:h,key:f,path:f},b.defineLabel(g,h,e,c.args.handler),g})}]};return d}),define("text!client.property-panel/components/checkbox/checkbox.ng.html",[],function(){return'<div class="pp-component pp-checkbox-component" ng-if="visible" tcl="checkbox">\r\n	<div class="value">\r\n		<label class="qui-checkboxicon" ng-disabled="readOnly">\r\n			<input type="checkbox" ng-model="value" tid="value" ng-change="change()" ng-disabled="readOnly" />\r\n			<div class="check-wrap">\r\n				<span class="check"></span>\r\n				<span class="check-text label" ng-disabled="readOnly" ng-if="label">{{label}}</span>\r\n			</div>\r\n		</label>\r\n	</div>\r\n</div>\r\n'}),define("client.property-panel/components/checkbox/checkbox",["client.property-panel/component-utils","text!./checkbox.ng.html"],function(a,b){var c={template:b,controller:["$scope",function(b){var c=function(){return b.data};b.definition.inverted&&(b.definition.resolveFunctions="invertedBoolean"),a.defineLabel(b,b.definition,c,b.args.handler),a.defineVisible(b,b.args.handler),a.defineReadOnly(b,b.args.handler),a.defineChange(b,b.args.handler),a.defineValue(b,b.definition,c)}]};return c}),define("text!client.property-panel/components/dimensions/dimensions.ng.html",[],function(){return'<div class="pp-component pp-list-component pp-toplist" tcl="dimensions">\r\n	<button class="qui-outlinebutton pp-toplist-add-button" ng-class="{\'qui-active\': adding }" qva-activate="addClicked($event)" qv-enter="addClicked($event)"\r\n			ng-disabled="addDisabled() || !definition.allowAdd" q-translation="{{definition.addTranslation}}" tid="add-dimension"></button>\r\n\r\n	<ul class="pp-expandable-list pp-toplist-content pp-dimension-list" pp-sortable="sortableOptions">\r\n		<li ng-repeat="item in items track by item.id" ng-class="{ \'locked\': item.locked || !definition.allowMove }">\r\n			<div class="pp-expandable-list-header pp-dimension" qva-activate="itemClicked( $event, item )" qva-longtapdrag="enableTouchDrag()"\r\n				 ng-class="{ \'expanded\': item.expanded, \'disabled\': item.disabled, \'invalid\': isInvalid( $index ) }" pp-sortable-handle>\r\n				<i class="toggle-expand {{ item.expanded ? \'icon-triangle-bottom\' : \'icon-triangle-right\' }}"></i>\r\n				<span class="text">{{item.title()}}</span>\r\n				<span class="icon icon-trash pp-delete-property" ng-if="definition.allowRemove" q-title-translation="Common.Delete"></span>\r\n			</div>\r\n			<div class="pp-expandable-list-content" ng-if="item.expanded && !item.disabled">\r\n				<div include-pp-component x-component="listItemComponent" x-definition="listItemDefinition" x-data="item.data" x-args="args"></div>\r\n			</div>\r\n		</li>\r\n	</ul>\r\n</div>\r\n'}),define("client.property-panel/components/dimensions/dimensions",["jquery","touche","client.property-panel/components/components","general.utils/property-resolver","general.services/show-service/show-service","objects.utils/data-properties/library-utils","objects.add-popovers/add-dimension-popover","translator","core.utils/resize","text!./dimensions.ng.html"],function(a,b,c,d,e,f,g,h,i,j){var k={template:j,controller:["$scope","$element","$timeout",function(j,k,l){function m(){var a=j.definition,b=d.getValue(j.data,j.definition.ref,[]),e=b.map(function(b,d){var e=b.qDef.cId;return{title:function(){var a=j.args.handler.getDimensionLayout(e);return b.qLibraryId?a&&a.qError?h.get("Object.ErrorMessage.MissingDimension"):a&&a.title||"":a&&a.qFallbackTitle||""},component:c.getComponent("items"),definition:a,data:b,id:e,index:d,expanded:r.get(s+e)||!1,disabled:!1}}),g={},i=d.getValue(j.data,j.definition.disabledRef,[]),k=i.map(function(d,e){var i=d.qDef.cId;return{title:function(){var a=d.qLibraryId;return a?"undefined"!=typeof g[a]?null===g[a]?h.get("Object.ErrorMessage.MissingDimension"):g[a]:f.findLibraryDimension(d.qLibraryId).then(function(b){return b?(g[a]=b.qData.title,g[a]):(g[a]=null,h.get("Object.ErrorMessage.MissingDimension"))}):d.qDef.qFieldLabels[0]||d.qDef.qFieldDefs[0]},component:c.getComponent("items"),definition:a,data:d,id:i,index:b.length+e,expanded:r.get(s+i)||!1,disabled:!0}});j.items=e.concat(k)}function n(c){t&&(t.destroy(),t=null),c&&a(c.target).hasClass("pp-toplist-add-button")&&b.preventGestures(),j.adding=!1}function o(){l(function(){var a=k.find(".pp-toplist-content"),b=a.children().last();a[0].scrollTop=b[0].offsetTop-1},100)}function p(a){j.args.handler.addFieldDimension(a.value,"").then(function(a){r.put(s+a.qDef.cId,!0),j.$emit("saveProperties"),n(),o()})}function q(a){j.args.handler.addLibraryDimension(a.libraryId).then(function(a){r.put(s+a.qDef.cId,!0),j.$emit("saveProperties"),n(),o()})}var r=j.args.cache,s="dimensions_";j.listItemComponent=c.getComponent("items"),j.listItemDefinition={items:j.definition.items||[],grouped:j.definition.grouped},j.$watchCollection("data."+j.definition.ref,function(){m()}),j.$watchCollection("data."+j.definition.disabledRef,function(){m()}),j.isInvalid=function(a){var b=j.args.handler.getDimensionLayouts()[a];return b&&!!b.qError},j.itemClicked=function(b,c){if(a(b.target).hasClass("pp-delete-property"))j.args.handler.removeDimension(c.index).then(function(){j.$emit("saveProperties")});else{var d=r.get(s+c.data.qDef.cId)||!1;c.disabled||(c.expanded=!d,r.put(s+c.data.qDef.cId,!d))}},j.addDisabled=function(){return j.args.handler.getDimensions().length>=j.args.handler.maxDimensions()};var t=null;j.addClicked=function(b){j.addDisabled()||j.adding||(t=e.show(g,{alignTo:a(b.target),position:"bottom",closeAddPopover:n,addFieldDimension:p,addLibraryDimension:q}),j.adding=!0)},j.sortableOptions={disabled:!j.definition.allowMove,onMove:function(a,b){j.args.handler.moveDimension(a,b).then(function(){j.$emit("saveProperties")})}},i.on("start",n),j.$on("$destroy",function(){i.off("start",n)})}]};return k}),define("text!client.property-panel/components/dropdown/dropdown.ng.html",[],function(){return'<div class="pp-component pp-dropdown-component" ng-if="visible" tcl="dropdown">\r\n    <div class="label" ng-if="label" ng-class="{ \'disabled\': readOnly }">\r\n		{{label}}\r\n	</div>\r\n\r\n	<div class="value">\r\n		<div ng-if="!loading">\r\n			<qui-select qui-model="value" qui-change="change()" qui-disabled="readOnly"\r\n						qui-options="option.value as option.label for option in options" qui-tid="{{key}}">\r\n			</qui-select>\r\n			<div style="display: none" class="tids">\r\n				<i ng-repeat="option in options">{{option.value}}</i>\r\n			</div>\r\n		</div>\r\n\r\n		<div class="pp-loading-container" ng-if="loading">\r\n			<div class="pp-loader qv-loader"></div>\r\n		</div>\r\n		<div ng-if="errorMessage" class="pp-invalid error">{{errorMessage}}</div>\r\n	</div>\r\n</div>'}),define("client.property-panel/components/dropdown/dropdown",["client.property-panel/component-utils","translator","text!./dropdown.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(c){function d(){var a=c.value,d=c.options.some(function(b){return b.value===a});d||c.options.splice(0,0,{value:a,label:b.get("properties.selectValue")})}function e(){c.loading=!0,c.errorMessage="",a.fillOptions(c.definition,c.data,c.args.handler,c.options).then(function(){d(),c.errorMessage="",c.loading=!1},function(){d(),c.errorMessage=b.get("Properties.PromiseFailed"),c.loading=!1})}var f=function(){return c.data};a.defineLabel(c,c.definition,f,c.args.handler),a.defineVisible(c,c.args.handler),a.defineChange(c,c.args.handler),a.defineReadOnly(c,c.args.handler),a.defineValue(c,c.definition,f),c.options=[],d(),e(),c.$on("datachanged",function(){e()})}]};return d}),define("text!client.property-panel/components/expression/expression.ng.html",[],function(){return'<div class="pp-component pp-string-component" ng-if="visible" tcl="string">\n	<div class="label" ng-if="label">{{label}}</div>\n\n	<div class="value qui-inputwithicon">\n		<input type="text" maxlength="{{maxlength}}" ng-class="{ \'qui-invalid\': invalid, \'is-expression\': isLocked() }"\n			ng-model="displayValue" pp-model-onblur pp-input-validator ng-readonly="isLocked()" ng-disabled="readOnly" ng-change="change()"\n			pp-expression-editor="value" editor-disabled="!isLocked()" expression-type="{{definition.expressionType}}" tid="{{key}}" />\n\n		<i class="icon-expression edit-expression" ng-class="{\'active\': isExpression()}" ng-show="!readOnly"\n		   pp-expression-editor="value" expression-type="{{definition.expressionType}}"\n		   q-title-translation="Tooltip.AddExpression"></i>\n	</div>\n\n	<div ng-if="isLocked()" class="hint" q-translation="properties.editInExpressionEditor"></div>\n</div>\n'}),define("client.property-panel/components/expression/expression",["client.property-panel/component-utils","general.utils/property-resolver","general.utils/string-limits","text!./expression.ng.html"],function(a,b,c,d){var e={template:d,controller:["$scope",function(d){var e=function(){return d.data};d.maxlength=d.definition.maxlength?d.definition.maxlength:c.name,a.defineLabel(d,d.definition,e,d.args.handler),a.defineVisible(d,d.args.handler),a.defineReadOnly(d,d.args.handler),a.defineChange(d,d.args.handler),a.defineValue(d,d.definition,e),Object.defineProperty(d,"displayValue",{get:function(){var a=d.value;return a&&"object"==typeof a&&(a=a.qv),a},set:function(a){var b=d.definition.expressionType;d.value="StringExpr"===b||"ValueExpr"===b?{qv:a}:a}}),d.isExpression=function(){var a=d.definition.expressionType,c=b.getValue(d.data,d.definition.ref);return"StringExpr"===a?c.qv&&"="===c.qv[0]:"dimension"===a?0===c.indexOf("="):!0},d.isLocked=function(){var a=d.value;return"object"==typeof a&&(a=a.qv),a&&(-1!==a.indexOf("\n")||a.length>d.maxlength)}}]};return e}),define("text!client.property-panel/components/buttongroup/buttongroup.ng.html",[],function(){return'<div class="pp-component pp-buttongroup-component" ng-if="visible" tcl="buttongroup">\r\n	<div class="label" ng-if="label" ng-class="{ \'disabled\': readOnly }">\r\n		{{label}}\r\n	</div>\r\n\r\n	<div class="value">\r\n		<div class="qui-buttongroup" ng-if="!loading">\r\n			<button ng-repeat="option in options track by option.value" class="qui-button" ng-disabled="readOnly"\r\n				ng-class="{ \'qui-active\': option.value == value, \'small-icon\' : definition.smallIconFont }"\r\n				qva-activate="select(option.value)" tid="{{option.value}}" data-icon="{{definition.icon}}"\r\n				q-title-translation="{{option.tooltip || option.label}}">\r\n				{{option.label}}\r\n			</button>\r\n		</div>\r\n\r\n		<div class="pp-loading-container" ng-if="loading">\r\n			<div class="pp-loader qv-loader"></div>\r\n		</div>\r\n		<div ng-if="errorMessage" class="pp-invalid error">{{errorMessage}}</div>\r\n	</div>\r\n</div>'}),define("client.property-panel/components/buttongroup/buttongroup",["client.property-panel/component-utils","translator","text!./buttongroup.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(c){function d(){c.loading=!0,c.errorMessage="",a.fillOptions(c.definition,c.data,c.args.handler,c.options).then(function(){c.errorMessage="",c.loading=!1},function(){c.errorMessage=b.get("Properties.PromiseFailed"),c.loading=!1})}var e=function(){return c.data};c.options=[],c.select=function(a){c.value=a,"function"==typeof c.definition.change&&c.definition.change(c.data,c.args.handler),c.$emit("saveProperties")},a.defineLabel(c,c.definition,e,c.args.handler),a.defineVisible(c,c.args.handler),a.defineReadOnly(c,c.args.handler),a.defineValue(c,c.definition,e),d(),c.$on("datachanged",function(){d()})}]};return d}),define("text!client.property-panel/components/radiobuttons/radiobuttons.ng.html",[],function(){return'<div class="pp-component pp-radiobuttons-component" ng-if="visible" tcl="radiobuttons">\r\n	<div class="label" ng-if="label" ng-class="{ \'disabled\': readOnly }">\r\n		{{label}}\r\n	</div>\r\n\r\n	<div class="value">\r\n		<div ng-if="!loading">\r\n			<label ng-repeat="option in options" class="qui-radiobutton"\r\n				   ng-class="{ \'qui-disabled\': readOnly, \'qui-hover\': hover }" title="{{option.tooltip}}"\r\n				   qva-activate="click()" ng-mouseenter="hover = true" ng-mouseleave="hover = false">\r\n				<input type="radio" ng-value="option.value" ng-model="value" ng-change="change()" ng-disabled="readOnly">\r\n				<div class="radio-wrap">\r\n					<span class="radio"></span>\r\n					<span class="radio-text">{{option.label}}</span>\r\n				</div>\r\n			</label>\r\n		</div>\r\n\r\n		<div class="pp-loading-container" ng-if="loading">\r\n			<div class="pp-loader qv-loader"></div>\r\n		</div>\r\n		<div ng-if="errorMessage" class="pp-invalid error">{{errorMessage}}</div>\r\n	</div>\r\n</div>'}),define("client.property-panel/components/radiobuttons/radiobuttons",["client.property-panel/component-utils","translator","text!./radiobuttons.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(c){function d(){c.loading=!0,c.errorMessage="",a.fillOptions(c.definition,c.data,c.args.handler,c.options).then(function(){c.errorMessage="",c.loading=!1},function(){c.errorMessage=b.get("Properties.PromiseFailed"),c.loading=!1})}var e=function(){return c.data};a.defineLabel(c,c.definition,e,c.args.handler),a.defineVisible(c,c.args.handler),a.defineChange(c,c.args.handler),a.defineReadOnly(c,c.args.handler),a.defineValue(c,c.definition,e),c.options=[],d(),c.$on("datachanged",function(){d()})}]};return d}),define("text!client.property-panel/components/expandable-items/expandable-items.ng.html",[],function(){return'<div class="pp-component pp-expandable-items-component" ng-ifs="isVisible()" tcl="expandable-items">\r\n	<ul class="pp-expandable-list">\r\n		<li ng-repeat="item in items track by item.key" tid="{{item.key}}">\r\n			<div class="pp-expandable-list-header" qva-activate="expandClicked(item)" ng-class="{ \'expanded\': item.expanded }">\r\n                <i class="toggle-expand {{ item.expanded ? \'icon-triangle-bottom\' : \'icon-triangle-right\' }}"></i>\r\n				<span class="text">{{item.label}}</span>\r\n			</div>\r\n			<div class="pp-expandable-list-content" ng-if="item.expanded" ng-class="{ \'grouped\': definition.grouped }">\r\n				<div include-pp-component x-component="item.component" x-definition="item.definition" x-data="item.data" x-args="args"></div>\r\n			</div>\r\n		</li>\r\n	</ul>\r\n</div>'}),define("client.property-panel/components/expandable-items/expandable-items",["client.property-panel/components/components","client.property-panel/component-utils","text!./expandable-items.ng.html"],function(a,b,c){var d;return d={template:c,controller:["$scope",function(c){function d(){c.items=Object.keys(e).filter(function(a){var b=e[a];return"function"==typeof b.show?b.show(c.data,c.args.handler,c.args):"boolean"==typeof b.show?b.show:!0}).map(function(d){var i,j=e[d],k=g.get(h+d);return i={component:a.findComponent(j),definition:j,data:c.data,expanded:k||!1,key:d},b.defineLabel(i,j,f,c.args.handler),i})}var e=c.definition.items||c.definition,f=function(){return c.data},g=c.args.cache,h="expanded_"+(c.translation||c.label)+"_";c.expandClicked=function(a){a.expanded=!a.expanded,g.put(h+a.key,a.expanded)},c.$on("datachanged",function(){d()}),c.$watch("data",function(){d()}),b.defineVisible(c,c.args.handler)}]}}),define("text!client.property-panel/popovers/type-popover.ng.html",[],function(){return'<immidiate-contextual width="150" align-to="alignTo" position="\'bottom\'" on-close-view="closeTypeFoldout(event)" class="pp-type-popover" tid="pp-type-popover">\r\n	<ul class="qui-icontextlist">\r\n		<li ng-repeat="item in items" tid="{{item.tid}}" ng-class="{ \'qui-disabled\': item.disabled() }" qva-activate="itemClicked($event,item);">\r\n			<span class="qui-textlist-text" q-translation="{{item.translation}}"></span>\r\n		</li>\r\n	</ul>\r\n</immidiate-contextual>'}),define("client.property-panel/popovers/type-popover",["text!./type-popover.ng.html"],function(a){return{template:a,controller:["$scope",function(a){a.itemClicked=function(a,b){a.preventDefault(),b.disabled()||b.select()}}],scope:{items:"=",alignTo:"=",closeTypeFoldout:"="}}}),define("text!general.components/context-menu/context-menu.ng.html",[],function(){return'<div class="qui-immidiateContextual qv-contextmenu" tid="context-menu" qva-outside="close($event)">\r\n	<div class="content">\r\n		<ul class="qui-textlist">\r\n			<li ng-if="levels.length" class="qv-contextmenu-item-container back">\r\n				<div class="qv-contextmenu-item" qva-activate="goBack();" tcl="context-menu-item">\r\n					<i class="icon-triangle-left back-icon"></i>\r\n					<span class="qui-textlist-text" q-translation="Common.Back" tid="context-menu-back"></span>\r\n				</div>\r\n			</li>\r\n			<li ng-repeat="item in currentItems" class="qv-contextmenu-item-container">\r\n				<div class="qv-contextmenu-item" ng-class="{ \'qv-contextmenu-has-submenu\': item.hasSubmenu(), \'has-icon\': item.hasIcon() }"\r\n					 qva-activate="selectItem($event,item)" tcl="context-menu-item">\r\n					<i class="item-icon {{item.icon}}" ng-if="item.hasIcon()"></i>\r\n					<span class="qui-textlist-text" title="{{item.getLabel()}}" tid="{{item.tid}}">{{item.getLabel()}}</span>\r\n					<i ng-show="item.hasSubmenu()" class="icon-triangle-right"></i>\r\n				</div>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n</div>\r\n'
}),define("general.components/context-menu/context-menu",["jquery","general.utils/window-positioner","core.utils/resize","text!./context-menu.ng.html"],function(a,b,c,d){function e(a,b,c,d){switch(b){case"BottomLeft":c-=a.outerWidth();break;case"Bottom":c-=a.outerWidth()/2;break;case"BottomRight":break;case"Left":c-=a.outerWidth(),d-=a.outerHeight()/2;break;case"Center":c-=a.outerWidth()/2,d-=a.outerHeight()/2;break;case"Right":d-=a.outerHeight()/2;break;case"Top":d-=a.outerHeight(),c-=a.outerWidth()/2;break;case"TopRight":default:d-=a.outerHeight()}return{left:c,top:d}}function f(b,c){var d=a(window),e=10,f=e,g=d.outerWidth()-b.outerWidth()-e,h=Math.max(f,Math.min(g,c.left)),i=e,j=d.outerHeight()-b.outerHeight()-e,k=Math.max(i,Math.min(j,c.top));return{left:h,top:k}}function g(a,b,c){var d=e(a,b,c.x,c.y);return d=f(a,d),a.offset(d),d}function h(a,b){return b=f(a,b),a.offset(b),b}function i(a,b){a.$$postDigest(function(){a.$$postDigest(b)})}var j={template:d,scope:{menu:"=",options:"="},controller:["$scope","$element","$timeout",function(d,e){function f(a){i(d,function(){d.options.alignTo?b.align(l(),d.options.alignTo,{collision:d.options.collision||"flip",position:d.options.docking||"top"}):(a=a||m,m=a?h(l(),a):g(l(),d.options.docking,d.options.position))})}function j(){if(d.levels.length){var a=d.levels.pop();d.currentItems=a.items,f(a.offset)}}function k(a){var b=a.items;d.levels.push({items:d.currentItems,offset:m}),d.currentItems=b,f()}function l(){return e.children().first()}var m=null;d.levels=[],d.currentItems=d.menu.items,d.goBack=function(){j()},d.selectItem=function(a,b){a.stopPropagation(),b.hasSubmenu()?k(b):(b.select(b.args),d.close())},d.close=function(){"function"==typeof d.menu.onClosing&&d.menu.onClosing.call(null),d.destroyComponent(),c.off("start",d.close)},c.on("start",d.close),e.find(".content").css("max-height",a(window).outerHeight()-40),f(),"function"==typeof d.menu.onOpen&&d.menu.onOpen.call(null)}]};return j}),define("general.components/context-menu/context-menu-service",["qvangular","general.components/context-menu/context-menu","general.services/show-service/show-service","translator"],function(a,b,c,d){var e=function(a){var b=this;Object.keys(a||{}).forEach(function(c){b[c]=a[c]}),this.items=[]};return e.prototype.addItem=function(a){var b=new e(a);return this.items.push(b),b},e.prototype.hasSubmenu=function(){return this.items.length>0},e.prototype.hasIcon=function(){return!!this.icon},e.prototype.getLabel=function(){function a(a){return Array.isArray(a)?d.get(a[0],a.slice(1).join(",")):d.get(a)}return"function"==typeof this.translation?a(this.translation()):this.translation?a(this.translation):"function"==typeof this.label?this.label():this.label?this.label:"Missing translation/label"},a.service("qvContextMenu",function(){var a,d={};return d.show=function(e,f){if(d.close(),0!==e.items.length){var g=f.component||b;return a=c.show(g,{menu:e,options:f})}},d.close=function(){a&&(a.destroy(),a=null)},d.menu=function(){var a=new e,b={addItem:function(b){return a.addItem(b)}};return Object.defineProperty(b,"items",{get:function(){return a.items}}),b},d})}),define("general.sortable/sortable-list-service",["jquery","qvangular"],function(a,b){b.service("qvSortableListDragService",[function(){var b;return b={$new:function(){return{fromItem:void 0,enterItem:void 0,enterList:void 0,toItem:void 0,offsetX:0,offsetY:0,left:0,top:0,direction:void 0,clientRect:void 0,scroll:{},pageX:0,pageY:0}},startOffset:function(a,b,c,d){var e=c.offsetParent(),f=c.position();b.left=f.left+e[0].scrollLeft,b.top=f.top+e[0].scrollTop,b.offsetX=b.left-d.x-e[0].scrollLeft,b.offsetY=b.top-d.y-e[0].scrollTop},startData:function(a,b,c,d){b.scroll.clientRect=a[0].getBoundingClientRect(),b.scroll.width=a[0].scrollWidth,b.scroll.height=a[0].scrollHeight,b.clientRect=c[0].getBoundingClientRect(),b.minLeft=-b.clientRect.width,b.maxLeft=b.scroll.width,b.minTop=-b.clientRect.height,b.maxTop=b.scroll.height-b.clientRect.height,b.fromItem=c.scope()[d],b.toItem=void 0,b.enterItem=void 0,b.enterList=void 0},updateData:function(c,d,e,f,g,h,i,j,k,l,m){function n(a){return a.length&&b.isChild(c[0],a[0])}var o,p,q,r,s=function(){};d.pageX=f,d.pageY=g,d.pageX<=d.scroll.clientRect.left?d.pageX=d.scroll.clientRect.left+1:d.pageX>=d.scroll.clientRect.left+d.scroll.clientRect.width&&(d.pageX=d.scroll.clientRect.left+d.scroll.clientRect.width-1),d.pageY<=d.scroll.clientRect.top?d.pageY=d.scroll.clientRect.top+1:d.pageY>=d.scroll.clientRect.top+d.scroll.clientRect.height&&(d.pageY=d.scroll.clientRect.top+d.scroll.clientRect.height-1);var t=e[0].style.display;e[0].style.display="none",p=document.elementFromPoint(d.pageX,d.pageY),o=a(p).closest(j),n(o)?s=function(a){q=a.scope()[k],d.enterItem!==q&&(d.enterList=void 0,d.enterItem=q,d.toItem=d.enterItem,l())}:(o=a(p).closest(h),n(o)?s=function(a){r="function"==typeof i?i(a):a.scope()[i],d.enterList!==r&&(d.enterList=r,d.enterItem=void 0,d.toItem=void 0,m())}:d.enterItem=void 0),e[0].style.display=t,s(o)},start:function(a,b,c){c[0].style||(c[0].style=""),c[0].style.position="absolute",c[0].style.width=b.clientRect.width+"px",c[0].style.height=b.clientRect.height+"px",c[0].style.pointerEvents="none",c[0].style.left=b.left+"px",c[0].style.top=b.top+"px",c[0].style.zIndex=1},update:function(a,b,c,d){var e,f;switch(b.direction){case"horizontal":b.left=d.currentPoint.x+b.offsetX+a[0].scrollLeft;break;case"vertical":b.top=d.currentPoint.y+b.offsetY+a[0].scrollTop;break;default:b.left=d.currentPoint.x+b.offsetX+a[0].scrollLeft,b.top=d.currentPoint.y+b.offsetY+a[0].scrollTop}e=b.left,f=b.top,b.left<b.minLeft?e=b.minLeft:b.left>b.maxLeft&&(e=b.maxLeft),b.top<b.minTop?f=b.minTop:b.top>b.maxTop&&(f=b.maxTop),c[0].style.left=e+"px",c[0].style.top=f+"px"},end:function(a,b){a.stopAutoScrolling&&(a.stopAutoScrolling(),a.stopAutoScrolling=null),b&&b.length&&b[0].removeAttribute("style")},isParent:function(a,b){return a===b},isChild:function(a,c){var d=c;if(b.isParent(a,c))return!1;for(;d;){if(d===a)return!0;d=d.parentNode}return!1},autoScroll:function(a,b,c,d,e,f,g,h){function i(e,g){if(k=a.scrollLeft,l=a.scrollTop,j){if(0>e&&0===k)return void(j=!1);if(e>0&&k+parseInt(b.height+.5,10)>=c)return void(j=!1);if(0>g&&0===l)return void(j=!1);if(g>0&&l+parseInt(b.height+.5,10)>=d)return void(j=!1);0!==e&&(a.scrollLeft+=e),0!==g&&(a.scrollTop+=g),f(),setTimeout(function(){i(e,g)})}}var j=!0,k=0,l=0,m=0,n=0;switch(e.direction){case"horizontal":e.pageX<=b.left+h?m=-g:e.pageX>=b.left+b.width-h&&(m=g);break;case"vertical":e.pageY<=b.top+h?n=-g:e.pageY>=b.top+b.height-h&&(n=g);break;default:e.pageY<=b.top+h?n=-g:e.pageY>=b.top+b.height-h&&(n=g)}return(0!==m||0!==n)&&i(m,n),e.stopAutoScrolling&&(e.stopAutoScrolling(),delete e.stopAutoScrolling),e.stopAutoScrolling=function(){j=!1},e.stopAutoScrolling}}}])}),define("general.sortable/sortable-list",["core.utils/class","util","jquery","qvangular","touche","general.utils/dom-util","general.sortable/sortable-list-service"],function(a,b,c,d,e,f){var g=a.extend("DefaultSortableList",{init:function(a){this.options=b.extend(!0,{gesture:{name:"swipe",options:{radiusThreshold:2,preventDefault:!1}},direction:"",scrollSelector:"",listSelector:"",listKey:"",itemSelector:"[ng-repeat]",itemDragSelector:"[ng-repeat]",itemKey:"$index"},a||{})},onBegin:function(){},onEnter:function(){},onEnterList:function(){},onMove:function(){},onMoveToList:function(){},onCancel:function(){},allowDrag:function(a){return e.utils.isMouse(a)?!!c(a.target).closest(this.options.itemSelector).length:!!c(a.target).closest(this.options.itemDragSelector).length},allowScroll:function(a){return!this.allowDrag(a)},allowEnter:function(){return!0},allowAutoScroll:function(){return!0},onAutoScroll:function(a){a()},getGesture:function(){return this.options.gesture},getDirection:function(){return this.options.direction},getScrollSensitivity:function(a){return e.utils.isMouse(a)?15:25},getScrollSpeed:function(a){return e.utils.isMouse(a)?15:25}});return d.directive("qvSortableList",["$parse","qvSortableListDragService",function(a,b){return{restrict:"A",controller:function(){},link:function(a,h,i,j){var k=a.$watch(i.qvSortableList,function(i){function l(){return o=void 0,e(h[0])[r.name](w).tap(v),e(n[0]).tap({id:"sortable-list-tap-"+a.$id,options:{preventDefault:!1},start:function(a){i.allowScroll(a)||f.isInput(a.target)||a.preventDefault()}}),function(){e(n[0]).off("*","sortable-list-tap-"+a.$id),e(h[0]).off("*",u)}}if(k(),!(i instanceof g)){var m=g.extend(i||{});i=new m(i&&i.options)}var n=h.closest(i.options.scrollSelector);n.length||(n=h);var o,p,q,r,s,t=b.$new(),u="sortable-list-"+a.$id,v={id:u,options:{preventDefault:!1},start:function(a,d){if(o=void 0,!f.isInput(a.target)&&b.isChild(n[0],a.target)&&i.allowDrag(a)){if(o=c(a.target).closest(i.options.itemSelector),0===o.length)return void(o=void 0);t.direction=i.getDirection(),p=i.getScrollSpeed(a),q=i.getScrollSensitivity(a),b.startOffset(n,t,o,d.pagePoints[0]),b.startData(n,t,o,i.options.itemKey)}},end:function(){o=void 0}},w={id:u,start:function(c){return o?(c.preventDefault(),a.$apply(function(){i.onBegin(t.fromItem,t.clientRect)}),void b.start(n,t,o)):void this.cancel()},update:function(c,d){function e(){b.update(n,t,o,d.swipe),b.updateData(n,t,o,d.pagePoints[0].x,d.pagePoints[0].y,i.options.listSelector,i.options.listKey,i.options.itemSelector,i.options.itemKey,function(){f()},function(){a.$apply(function(){i.onEnterList(t.enterList)})})}function f(){i.allowEnter(t.enterItem,t.fromItem)?a.$apply(function(){i.onEnter(t.enterItem)}):(t.enterItem=void 0,t.toItem=void 0)}if(!o)return void this.cancel();if(e(),i.allowAutoScroll()){var g=b.autoScroll.bind(this,n[0],t.scroll.clientRect,t.scroll.width,t.scroll.height,t,e,p,q);i.onAutoScroll(g,t.enterList,t.enterItem,function(a,c,d,f){b.autoScroll(a,c,d,f,t,e,p,q)})}},end:function(){b.end(t,o),a.$apply(void 0!==t.toItem?function(){i.onMove(t.fromItem,t.toItem)}:void 0!==t.enterList?function(){i.onMoveToList(t.fromItem,t.enterList)}:function(){i.onCancel()}),o=void 0},cancel:function(){o&&(b.end(t,o),d.$apply(function(){i.onCancel()}),o=void 0)}};r=i.options.gesture,w.options=r.options,a.$on("$destroy",function(){e(n[0]).off("*","sortable-list-tap-"+a.$id),e(h[0]).off("*",u)}),j.on=function(){s||(s=l())},j.off=function(){s&&(s(),s=void 0)},j.cancel=function(){w.cancel()},j.on()})}}}]),g}),define("general.sortable/sortable-item-lists",["core.utils/class","general.sortable/sortable-list"],function(a,b){var c={Dimensions:1,Measures:2,Placeholder:16,Locked:32},d=a.extend("SortableItem",{init:function(a,b,c,d){this.title=a,this.id=b,this.classList=c||[],this.typeFlag=d||1},addClass:function(a){if(a){var b=this.classList.indexOf(a);return-1===b&&this.classList.push(a),this}},removeClass:function(a){if(a){var b=this.classList.indexOf(a);return-1!==b&&this.classList.splice(b,1),this}},hasClass:function(a){return-1!==this.classList.indexOf(a)}}),e=a.extend("SortableItemList",{init:function(a,b){this.items=[],this.disabled=!1,this.typeFlag=a||1,Object.keys(b||{}).forEach(function(a){this[a]=b[a]},this)},add:function(a,b,c,e){var f=new d(a,b,c,e);return this.items.push(f),f},addItem:function(a){if(!(a instanceof d))throw new Error("item not instance of SortableItem");return this.items.push(a),a},createItem:function(a){var b=new d;return Object.keys(a||{}).forEach(function(c){b[c]=a[c]}),b},moveItem:function(a,b){this.items.splice(b,0,this.items.splice(a,1)[0])},getItemByIndex:function(a){return this.items[a]},getItemById:function(a){return this.get(function(b){return b.id===a})[0]},getIndexByItem:function(a){return this.items.indexOf(a)},get:function(a){return this.items.filter(a||function(){return!0})},getLockedIndices:function(){return this.get(function(a){return!!(a.typeFlag&c.Locked)}).map(function(a){return this.getIndexByItem(a)},this)},reset:function(){this.items.length=0,this.disabled=!1},isEmpty:function(){return 0===this.items.length}});Object.defineProperties(e.prototype,{length:{get:function(){return this.items.length}}});var f=b.extend("SortableItemLists",{init:function(){this._super.apply(this,arguments),this.lists=[],this.dragPlaceholder=null},addPlaceholder:function(a){var b=this.getList(a),e=b.items.indexOf(a);return this.dragPlaceholder=new d("","placeholder",[],c.Placeholder),b.items.splice(e,0,this.dragPlaceholder),this.dragPlaceholder.style={visibility:"hidden"},this.dragPlaceholder},removePlaceholder:function(){if(this.dragPlaceholder){var a=this.getList(this.dragPlaceholder),b=a.items.indexOf(this.dragPlaceholder);-1!==b&&(a.items.splice(b,1),this.dragPlaceholder=null)}},getPlaceholder:function(){return this.dragPlaceholder},createList:function(a,b){var c=new e(a,b);return this.lists.push(c),c},reset:function(){this.lists.forEach(function(a){a.reset()})},getList:function(a){return this.lists.filter(function(b){return-1!==b.items.indexOf(a)})[0]},disable:function(a){this.lists.forEach(function(b){b.disabled=!(a.typeFlag&b.typeFlag)})},enable:function(){this.lists.forEach(function(a){a.disabled=!1})},moveItem:function(a,b){var c,d,e=this.getList(a),f=this.getList(b);e&&f&&(d=f.items.indexOf(b),c=e.items.indexOf(a),e.items.splice(c,1),f.items.splice(d,0,a))},onBegin:function(a,b){this.addPlaceholder(a,b),this.disable(a)},onEnter:function(a){var b=this.getList(a),c=b.getLockedIndices();this.moveItem(this.dragPlaceholder,a);var d=b.getLockedIndices();c.forEach(function(a,c){b.moveItem(d[c],a)})},onEnterList:function(a){if(!a.disabled){var b=this.getList(this.dragPlaceholder),c=b.getIndexByItem(this.dragPlaceholder);b.items.splice(c,1),a.items.push(this.dragPlaceholder)}},onMove:function(a){var b=this.dragPlaceholder;this.moveItem(a,b),this.removePlaceholder(),this.enable()},onMoveToList:function(a,b){if(!b.disabled){var c=this.getList(a),d=c.items.indexOf(a);if(c===b)return void this.onMove(a);c.items.splice(d,1),b.items.push(a)}this.removePlaceholder(),this.enable()},onCancel:function(){this.removePlaceholder(),this.enable()},allowEnter:function(a,b){return!!(b.typeFlag&this.getList(a).typeFlag)}});return f.create=function(a){var b=f.extend(a||{});return a=new b(a&&a.options)},f}),define("text!client.property-panel/components/common/data.ng.html",[],function(){return'<div class="pp-component pp-list-component pp-toplist" tcl="data">\r\n	<button class="qui-outlinebutton pp-toplist-add-button" qva-activate="addClicked($event)" qv-enter="addClicked($event)"\r\n			ng-disabled="addDisabled()" tid="add-data">\r\n		{{getAddLabel()}}\r\n		<i class="toggle-expand icon-triangle-bottom" ng-if="hasMultipleAddOptions()"></i>\r\n	</button>\r\n\r\n	<div class="pp-toplist-content pp-data-container" qv-sortable-list="sortableItemLists">\r\n		<div class="pp-data" ng-repeat="list in sortableItemLists.lists" tid="{{list.tid}}" ng-class="{ \'disabled\': list.disabled }" ng-if="list.show() != false">\r\n			<div class="pp-data-header ">\r\n				<span class="pp-data-header-text">{{list.title}}</span>\r\n			</div>\r\n\r\n			<ul class="pp-expandable-list pp-data-list">\r\n				<li ng-repeat="item in list.items track by item.id" ng-include src="item.templateSrc" ng-class="item.classList"></li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n</div>'}),define("client.property-panel/components/hypercube-data/hypercube-data",["jquery","touche","client.property-panel/components/components","objects.error-handling/error-translation","translator","objects.utils/data-properties/library-utils","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover","client.property-panel/popovers/type-popover","general.components/context-menu/context-menu-service","general.utils/property-resolver","general.utils/support","general.services/show-service/show-service","general.sortable/sortable-item-lists","text!client.property-panel/components/common/data.ng.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p={template:o,controller:["$scope","$element","$timeout",function(o,p,q){function r(b){var c=a(b.currentTarget);G=m.show(i,{items:[{tid:"dimension",select:function(){B("dimensions",c)},disabled:function(){return o.args.handler.getDimensions().length>=o.args.handler.maxDimensions()},translation:"Common.Dimension"},{tid:"measure",select:function(){B("measures",c)},disabled:function(){return o.args.handler.getMeasures().length>=o.args.handler.maxMeasures()},translation:"Common.Measure"}],closeTypeFoldout:s,alignTo:c})}function s(c){G&&(G.destroy(),G=null),c&&a(c.target).hasClass("pp-toplist-add-button")&&b.preventGestures()}function t(){o.sortableItemLists.reset(),u(),v();var a;J.isEmpty()&&(a=J.createItem({id:"empty-item",templateSrc:"pp-empty-data-item.ng.html",index:-1}),J.addItem(a)),K.isEmpty()&&(a=K.createItem({id:"empty-item",templateSrc:"pp-empty-data-item.ng.html",index:-1}),K.addItem(a))}function u(){var a=o.definition.items.dimensions,b=k.getValue(o.data,a.ref,[]);b.forEach(function(b,e){var f=b.qDef.cId,g=J.createItem({title:function(){var a=o.args.handler.getDimensionLayout(f);return a&&a.qError?d.getDimensionError(a.qError.qErrorCode,!0):b.qLibraryId?a&&a.title||"":a&&a.qFallbackTitle||""},isInvalid:function(){var a=o.args.handler.getDimensionLayout(f);return a&&!!a.qError},component:c.getComponent("items"),definition:a.items,data:b,args:o.args,id:f,index:e,type:"dimension",expanded:E.get(F+f)||!1,disabled:!1,sortable:a.allowMove!==!1,templateSrc:"pp-data-item.ng.html",markerClass:"pp-dimension",typeFlag:1});J.addItem(g)});var g={},h=k.getValue(o.data,a.disabledRef,[]);h.forEach(function(d,h){var i=d.qDef.cId,j=J.createItem({title:function(){var a=d.qLibraryId;return a?"undefined"!=typeof g[a]?null===g[a]?e.get("Object.ErrorMessage.MissingDimension"):g[a]:f.findLibraryDimension(d.qLibraryId).then(function(b){return b?(g[a]=b.qData.title,g[a]):(g[a]=null,e.get("Object.ErrorMessage.MissingDimension"))}):d.qDef.qFieldLabels[0]||d.qDef.qFieldDefs[0]},component:c.getComponent("items"),definition:a.items,data:d,args:o.args,id:i,index:b.length+h,type:"dimension",expanded:E.get(F+i)||!1,disabled:!0,templateSrc:"pp-data-item.ng.html",markerClass:"pp-dimension",sortable:a.allowMove!==!1});J.addItem(j)})}function v(){var a=o.definition.items.measures,b=k.getValue(o.data,a.ref,[]);b.forEach(function(b,e){var f=b.qDef.cId,g=K.createItem({title:function(){var a=o.args.handler.getMeasureLayout(f);return a&&a.qError?d.getMeasureError(a.qError.qErrorCode,!0):a&&a.qFallbackTitle||""},isInvalid:function(){var a=o.args.handler.getMeasureLayout(f);return a&&!!a.qError},component:c.getComponent("items"),definition:a.items,data:b,args:o.args,id:f,index:e,type:"measure",expanded:E.get(F+f)||!1,disabled:!1,sortable:a.allowMove!==!1,templateSrc:"pp-data-item.ng.html",markerClass:"pp-measure",typeFlag:2});K.addItem(g)});var g={},h=k.getValue(o.data,a.disabledRef,[]);h.forEach(function(d,h){var i=d.qDef.cId,j=K.createItem({title:function(){var a=d.qLibraryId;return a?"undefined"!=typeof g[a]?null===g[a]?e.get("Object.ErrorMessage.MissingMeasure"):g[a]:f.findLibraryMeasure(a).then(function(b){return b?(g[a]=b.qData.title,g[a]):(g[a]=null,e.get("Object.ErrorMessage.MissingMeasure"))}):d.qDef.qLabel||d.qDef.qDef},component:c.getComponent("items"),definition:a.items,data:d,args:o.args,id:i,index:b.length+h,type:"measure",expanded:E.get(F+i)||!1,disabled:!0,sortable:a.allowMove!==!1,templateSrc:"pp-data-item.ng.html",markerClass:"pp-measure",typeFlag:2});K.addItem(j)})}function w(a){o.args.handler.addFieldDimension(a.value,"").then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),C(),D("dimensions")})}function x(a){o.args.handler.addLibraryDimension(a.libraryId).then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),C(),D("dimensions")})}function y(a){o.args.handler.addLibraryMeasure(a.libraryId).then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),C(),D("measures")})}function z(a){o.args.handler.addExpressionMeasure(a.value,"").then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),C(),D("measures")})}function A(){J.items.forEach(function(a){a.expanded=!1,E.put(F+a.id,!1)}),K.items.forEach(function(a){a.expanded=!1,E.put(F+a.id,!1)})}function B(a,b){s(),A(),"dimensions"===a?(H=m.show(g,{alignTo:b,position:"bottom",allowExpressionEditor:!0,closeAddPopover:C,addFieldDimension:w,addLibraryDimension:x}),o.adding=!0):H=m.show(h,{alignTo:b,position:"bottom",allowExpressionEditor:!0,closeAddPopover:C,addLibraryMeasure:y,addExpressionMeasure:z})}function C(c){H&&(H.destroy(),H=null),c&&a(c.target).hasClass("pp-toplist-add-button")&&b.preventGestures(),o.adding=!1}function D(a){q(function(){var b=p.find(".pp-toplist-content"),c=p.find("[tid='"+a+"'] .pp-data-list"),d=c.children().last();d[0]&&(b[0].scrollTop=d[0].offsetTop-1)},100)}var E=o.args.cache,F="data_";o.expandClicked=function(b,c){c.disabled||a(b.target).hasClass("pp-move-item")||(c.expanded=!c.expanded,E.put(F+c.id,c.expanded))},o.removeItem=function(a){"dimension"===a.type?o.args.handler.removeDimension(a.index).then(function(){o.$emit("saveProperties")}):o.args.handler.removeMeasure(a.index).then(function(){o.$emit("saveProperties")})},o.addDisabled=function(){var a=o.args.handler.getDimensions().length>=o.args.handler.maxDimensions(),b=o.args.handler.getMeasures().length>=o.args.handler.maxMeasures();return a&&b||!o.definition.allowAdd},o.getAddLabel=function(){var a=o.args.ext&&o.args.ext.data;return e.get(a&&!a.measures?"Visualization.Requirements.AddDimension":a&&!a.dimensions?"Visualization.Requirements.AddMeasure":o.definition.addTranslation)},o.addClicked=function(b){var c=o.args.ext&&o.args.ext.data;c&&!c.measures?B("dimensions",a(b.target)):c&&!c.dimensions?B("measures",a(b.target)):r(b)},o.hasMultipleAddOptions=function(){var a=o.args.ext&&o.args.ext.data;return a.measures&&a.dimensions};var G=null,H=null,I=null;o.openContextMenu=function(a,b){var c=j.menu();c.addItem({translation:"Common.Delete",tid:"delete",select:function(){o.removeItem(b)}}),I=j.show(c,{position:{x:a.pageX,y:a.pageY},docking:"Top"})},o.$on("pp-open-path",function(a,b){var c=b.split("."),d=c[0],e=c[1];if("data"===d&&e){E.put(F+e,!0);var f=J.get().some(function(a){return a.cId===e});D(f?"dimensions":"measures")}}),o.sortableItemLists=n.create({options:{direction:"vertical",listKey:"list",listSelector:".pp-expandable-list",itemKey:"item",itemSelector:".qv-pp-sortable",itemDragSelector:".qv-pp-sortable-handle",gesture:{name:"swipe",options:{radiusThreshold:l.treatAsDesktop()?4:0,preventDefault:!1}}},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.addClass("qv-pp-sortable"),a.templateSrc="pp-data-item.ng.html"},onBegin:function(){this._super.apply(this,arguments),A()},onMove:function(){this._super.apply(this,arguments);var a=[],b=[];J.get().forEach(function(c,d){"empty-item"!==c.id&&(d+1>o.args.handler.maxDimensions()?b.push(c.data):a.push(c.data))});var c=[],d=[];K.get().forEach(function(a,b){"empty-item"!==a.id&&(b+1>o.args.handler.maxMeasures()?d.push(a.data):c.push(a.data))}),k.setValue(o.data,o.definition.items.dimensions.ref,a),k.setValue(o.data,o.definition.items.dimensions.disabledRef,b),k.setValue(o.data,o.definition.items.measures.ref,c),k.setValue(o.data,o.definition.items.measures.disabledRef,d),o.$emit("saveProperties")}});var J=o.sortableItemLists.createList(1,{title:e.get("Common.Dimensions"),tid:"dimensions",show:function(){var a=o.args.ext&&o.args.ext.data;return!a||!!a.dimensions}}),K=o.sortableItemLists.createList(2,{title:e.get("Common.Measures"),tid:"measures",show:function(){var a=o.args.ext&&o.args.ext.data;return!a||!!a.measures}});o.$watchCollection("data."+o.definition.items.dimensions.ref,t),o.$watchCollection("data."+o.definition.items.dimensions.disabledRef,t),o.$watchCollection("data."+o.definition.items.measures.ref,t),o.$watchCollection("data."+o.definition.items.measures.disabledRef,t),o.$on("$destroy",function(){s(),C(),I&&I.destroy()})}]};return p}),define("text!client.property-panel/components/common/sorting.ng.html",[],function(){return'<div class="pp-component pp-sorting-component" style="position:relative; height: 100%;" tcl="sorting" qv-sortable-list="sortableItemLists">\r\n	<div ng-if="sortableItemLists.lists[0].isEmpty()" class="pp-data-empty-hint">\r\n		<span q-translation="Common.NoData"></span>\r\n	</div>\r\n	<ul class="pp-expandable-list pp-data-list">\r\n		<li ng-repeat="item in sortableItemLists.lists[0].items track by item.id" ng-include src="item.templateSrc" ng-class="item.classList"></li>\r\n	</ul>\r\n</div>'}),define("client.property-panel/components/hypercube-sorting/hypercube-sorting",["jquery","client.property-panel/components/components","general.utils/property-resolver","general.sortable/sortable-item-lists","general.utils/support","objects.error-handling/error-translation","text!client.property-panel/components/common/sorting.ng.html"],function(a,b,c,d,e,f,g){var h={template:g,controller:["$scope",function(g){function h(){g.sortableItemLists.reset();var a=[],d=g.definition.items.dimensions,e=c.getValue(g.data,d.ref,[]);e.forEach(function(c,e){var h,i=c.qDef.cId;"function"==typeof d.locked?h=d.locked.call(null,e,g.data,g.args.handler):"boolean"==typeof d.locked&&(h=d.locked),a.push({title:function(){var a=g.args.handler.getDimensionLayout(i);return a&&a.qError?f.getDimensionError(a.qError.qErrorCode,!0):c.qLibraryId?a&&a.title||"":a&&a.qFallbackTitle||""},isInvalid:function(){var a=g.args.handler.getDimensionLayout(i);return a&&!!a.qError},component:b.getComponent("items"),definition:d,data:c,args:g.args,type:"dimension",id:c.qDef.cId,interColIx:e,expanded:j.get(k+i)||!1,sortable:d.allowMove!==!1&&!h,typeFlag:1,showPriority:!0,templateSrc:"pp-sorting-item.ng.html"})});var h=g.definition.items.measures,i=c.getValue(g.data,h.ref,[]);i.forEach(function(c,d){var i,l=c.qDef.cId;"function"==typeof h.locked?i=h.locked.call(null,d,g.data,g.args.handler):"boolean"==typeof h.locked&&(i=h.locked),a.push({title:function(){var a=g.args.handler.getMeasureLayout(l);return a&&a.qError?f.getMeasureError(a.qError.qErrorCode,!0):a&&a.qFallbackTitle||""},isInvalid:function(){var a=g.args.handler.getMeasureLayout(l);return a&&!!a.qError},component:b.getComponent("items"),definition:h,data:c,args:g.args,type:"measure",id:c.qDef.cId,interColIx:e.length+d,expanded:j.get(k+l)||!1,sortable:h.allowMove!==!1&&!i,typeFlag:1,showPriority:!0,templateSrc:"pp-sorting-item.ng.html"})});var m,n=c.getValue(g.data,g.definition.sortIndexRef,void 0);m=n?n.map(function(b){return a[b]}):a,m.forEach(function(a,b){a.priority=b+1}),m.forEach(function(a){l.addItem(l.createItem(a))})}function i(){l.get().forEach(function(a){a.expanded=!1,j.put(k+a.id,!1)})}var j=g.args.cache,k="sortable_";g.expandClicked=function(b,c){c.disabled||a(b.target).hasClass("pp-move-item")||(c.expanded=!c.expanded,j.put(k+c.id,c.expanded))},g.sortableItemLists=d.create({options:{direction:"vertical",listKey:"list",listSelector:".pp-expandable-list",itemKey:"item",itemSelector:".qv-pp-sortable",itemDragSelector:".qv-pp-sortable-handle",gesture:{name:"swipe",options:{radiusThreshold:e.treatAsDesktop()?4:0,preventDefault:!1}}},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.addClass("qv-pp-sortable"),a.templateSrc="pp-sorting-item.ng.html"},onBegin:function(){this._super.apply(this,arguments),i()},onMove:function(){this._super.apply(this,arguments);var a=l.get().map(function(a){return a.interColIx});c.setValue(g.data,g.definition.sortIndexRef,a),g.$emit("saveProperties")}});var l=g.sortableItemLists.createList(1,{tid:"sorting"});Object.keys(g.definition.items).forEach(function(a){var b=g.definition.items[a];g.$watchCollection("data."+b.ref,function(){h()})}),g.$watchCollection("data."+g.definition.sortIndexRef,function(){h()})}]};return h}),define("text!client.property-panel/components/inline-dimension/inline-dimension.ng.html",[],function(){return'<div tcl="dimensions">\r\n	<div class="pp-component pp-string-component" tcl="string">\r\n		<div class="label" q-translation="Common.Field"></div>\r\n		<div class="value qui-inputwithicon">\r\n			<input type="text" maxlength="255" ng-readonly="items[0].isLocked()" pp-input-validator pp-validation-on-result="items[0].invalid = !isValid"\r\n					   pp-expression-editor="items[0].field" editor-disabled="!items[0].isLocked()" expression-type="dimension"\r\n				   pp-expression-editor-on-apply="items[0].setExpression(value)"\r\n				   ng-model="items[0].field" ng-class="{ \'qui-invalid\': items[0].invalid, \'is-expression\': items[0].isLocked() }" ng-change="change()"\r\n				   pp-model-onblur tid="field"/>\r\n			<i class="icon-expression edit-expression" ng-class="{\'active\': items[0].isCalculated()}"\r\n				   pp-expression-editor="items[0].field" pp-expression-editor-on-apply="items[0].setExpression(value)" expression-type="dimension"\r\n			   q-title-translation="Tooltip.AddExpression"></i>\r\n		</div>\r\n\r\n		<div ng-if="items[0].isLocked()" class="hint" q-translation="properties.editInExpressionEditor"></div>\r\n	</div>\r\n\r\n	<div class="pp-component pp-string-component" tcl="string">\r\n		<div class="label" q-translation="Common.Label"></div>\r\n		<div class="value">\r\n			<input type="text" class="qui-input pp-placeholder" maxlength="255"\r\n				   pp-placeholder="items[0].field" pp-placeholder-suppress-equal="true"\r\n				   ng-model="items[0].label" ng-class="{ \'qui-invalid\': invalid }" ng-change="change()"\r\n				   pp-model-onblur pp-input-validator tid="label"/>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("client.property-panel/components/inline-dimension/inline-dimension",["client.property-panel/component-utils","general.utils/property-resolver","general.utils/string-limits","text!./inline-dimension.ng.html"],function(a,b,c,d){var e=0,f={template:d,controller:["$scope",function(d){function f(){var e=b.getValue(d.data,i+"qDef.qFieldDefs",[]);d.items=e.map(function(b,e){var f={index:e,expanded:g.get(h+e)||!1,isCalculated:function(){return 0===f.field.indexOf("=")},isLocked:function(){var a=f.field;return a?a&&(-1!==a.indexOf("\n")||a.length>c.name):!1},setExpression:function(a){a.length&&"="!==a[0]&&(a="="+a),f.field=a,d.change()}};return a.defineValue(f,{type:"string",ref:i+"qDef.qFieldDefs."+e,expression:"always"},j,"field"),a.defineValue(f,{type:"string",ref:i+"qDef.qFieldLabels."+e},j,"label"),f})}e++;var g=d.args.cache,h="dimensions_inline"+e+"_",i=d.definition.ref?d.definition.ref+".":"",j=function(){return d.data};d.$watchCollection("data."+i+"qDef.qFieldDefs",function(){f()}),d.$watchCollection("data."+i+"qDef.qFieldLabels",function(){f()}),a.defineChange(d,d.args.handler)}]};return f}),define("text!client.property-panel/components/inline-measure/inline-measure.ng.html",[],function(){return'<div tcl="measures">\n	<div class="pp-component pp-string-component" tcl="string">\n		<div class="label" q-translation="Common.Expression"></div>\n		<div class="value qui-inputwithicon">\n			<input type="text" maxlength="255" ng-readonly="item.isLocked()" pp-input-validator pp-validation-on-result="item.invalid = !isValid"\n				   pp-expression-editor="item.expression" editor-disabled="!item.isLocked()" expression-type="measure"\n				   pp-expression-editor-on-apply="item.setExpression(value)"\n				   ng-model="item.expression" ng-class="{ \'qui-invalid\': item.invalid, \'is-expression\': item.isLocked() }" ng-change="change()"\n				   pp-model-onblur tid="field"/>\n			<i class="icon-expression edit-expression active"\n			   pp-expression-editor="item.expression" pp-expression-editor-on-apply="item.setExpression(value)" expression-type="measure"\n			   q-title-translation="Tooltip.AddExpression"></i>\n		</div>\n\n		<div ng-if="item.isLocked()" class="hint" q-translation="properties.editInExpressionEditor"></div>\n	</div>\n\n	<div class="pp-component pp-string-component" tcl="string">\n		<div class="label" q-translation="Common.Label"></div>\n		<div class="value">\n			<input type="text" class="qui-input pp-placeholder" maxlength="255" pp-placeholder="item.expression"\n				   ng-model="item.label" ng-class="{ \'qui-invalid\': invalid }" ng-change="change()"\n				   pp-model-onblur pp-input-validator tid="label"/>\n		</div>\n	</div>\n</div>\n'
}),define("client.property-panel/components/inline-measure/inline-measure",["client.property-panel/component-utils","general.utils/string-limits","text!./inline-measure.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(c){function d(){var d={isLocked:function(){var a=d.expression;return a?a&&(-1!==a.indexOf("\n")||a.length>b.name):!1},setExpression:function(a){d.expression=a,c.change()}};a.defineValue(d,{type:"string",ref:e+"qDef.qDef",expression:"always"},f,"expression"),a.defineValue(d,{type:"string",ref:e+"qDef.qLabel"},f,"label"),c.item=d}var e=c.definition.ref?c.definition.ref+".":"",f=function(){return c.data};d(),a.defineChange(c,c.args.handler)}]};return d}),define("text!client.property-panel/components/integer/integer.ng.html",[],function(){return'<div class="pp-component pp-integer-component" ng-if="visible" tcl="integer">\r\n	<div class="label" ng-if="label">{{label}}</div>\r\n\r\n	<div class="value" ng-class="{ \'qui-inputwithicon\': isExpressionDefinition }">\r\n		<input type="text" maxlength="{{maxlength}}" ng-class="{ \'qui-invalid\': invalid, \'qui-input\': !isExpressionDefinition, \'is-expression\': isLocked() }"\r\n			   ng-model="displayValue" pp-model-onblur pp-input-validator ng-readonly="isLocked()" ng-disabled="readOnly" ng-change="change()"\r\n			   pp-expression-editor="value" editor-disabled="!isLocked()" expression-type="{{expressionType}}" tid="{{key}}" pattern="[0-9]+"/>\r\n\r\n		<i class="icon-expression edit-expression" ng-class="{\'active\': isExpression()}" ng-show="isExpressionDefinition && !readOnly"\r\n		   pp-expression-editor="value" expression-type="{{expressionType}}"\r\n		   q-title-translation="Tooltip.AddExpression"></i>\r\n	</div>\r\n\r\n	<div ng-if="isLocked()" class="hint" q-translation="properties.editInExpressionEditor"></div>\r\n</div>\r\n'}),define("client.property-panel/components/integer/integer",["client.property-panel/component-utils","general.utils/string-limits","text!./integer.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(c){var d=function(){return c.data};c.maxlength=c.definition.maxlength?c.definition.maxlength:b.name,a.defineLabel(c,c.definition,d,c.args.handler),a.defineVisible(c,c.args.handler),a.defineReadOnly(c,c.args.handler),a.defineChange(c,c.args.handler),a.defineValue(c,c.definition,d),a.defineExpression(c,!0)}]};return d}),define("text!client.property-panel/components/items/items.ng.html",[],function(){return'<div class="pp-component pp-items-component" ng-if="visible" tcl="items">\r\n	<div ng-repeat="item in items track by item.key" tid="{{item.key}}" class="item" ng-class="{ \'grouped\': definition.grouped }">\r\n		<div include-pp-component x-component="item.component" x-definition="item.definition" x-data="data" x-args="args"></div>\r\n	</div>\r\n</div>'}),define("client.property-panel/components/items/items",["client.property-panel/components/components","client.property-panel/component-utils","text!./items.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(c){function d(){c.items=Object.keys(e).filter(function(a){var b=e[a];return"function"==typeof b.show?b.show(c.data,c.args.handler,c.args):"boolean"==typeof b.show?b.show:!0}).map(function(b){var c=e[b];return{component:a.findComponent(c),definition:c,key:b}})}var e=c.definition.items||c.definition;c.$on("datachanged",function(){d()}),c.$watch("data",function(){d()}),b.defineVisible(c,c.args.handler)}]};return d}),define("text!client.property-panel/components/link/link.ng.html",[],function(){return'<div class="pp-component pp-link-component" ng-if="visible" tcl="link">\r\n	<!--<div class="label" ng-if="label">{{label}}</div>-->\r\n\r\n	<div class="value" style="text-align: right;">\r\n		<a ng-href="{{url}}" target="_blank">{{label}}</a>\r\n	</div>\r\n\r\n</div>\r\n'}),define("client.property-panel/components/link/link",["client.property-panel/component-utils","text!./link.ng.html"],function(a,b){var c={template:b,controller:["$scope",function(b){var c=function(){return b.data};a.defineLabel(b,b.definition,c,b.args.handler),a.defineVisible(b,b.args.handler),a.defineChange(b,b.args.handler),a.defineCustom(b,b.args.handler,"url")}]};return c}),define("text!client.property-panel/components/list/list.ng.html",[],function(){return'<div class="pp-component pp-list-component" ng-if="visible" tcl="list">\r\n	<button class="qui-outlinebutton pp-add-property" ng-disabled="addDisabled() || !definition.allowAdd" qva-activate="addClicked()" tid="add-item">\r\n		{{definition.addTranslation | translate}}\r\n	</button>\r\n\r\n	<div class="pp-list-container" qv-sortable-list="sortableItemLists">\r\n		<ul class="pp-expandable-list pp-list-content">\r\n			<li ng-repeat="item in sortableItemLists.lists[0].items track by item.id" ng-style="item.style">\r\n				<div class="pp-expandable-list-header" qva-activate="expandClicked($event,item)" qva-context-menu="openContextMenu($event, item)"\r\n						ng-class="{ \'expanded\': item.expanded, \'unused\': item.unused, \'qv-pp-sortable\': item.sortable }">\r\n					<i class="toggle-expand {{ item.expanded ? \'icon-triangle-bottom\' : \'icon-triangle-right\' }}"></i>\r\n					<span class="text">{{item.title()}}</span>\r\n					<span class="icon icon-handle pp-move-item qv-pp-sortable-handle" ng-if="item.sortable" q-title-translation="Common.Move"></span>\r\n				</div>\r\n				<div class="pp-expandable-list-content" ng-if="item.expanded">\r\n					<div include-pp-component x-component="item.component" x-definition="item.definition" x-data="item.data" x-args="args"></div>\r\n					<button class="qui-outlinebutton pp-remove-property" qva-activate="removeItem(item.index)">\r\n						<div q-translation="Common.Delete"></div>\r\n                        <div class="icon-bin remove-icon" q-title-translation="Common.Delete"></div>\r\n					</button>\r\n				</div>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n</div>'}),define("client.property-panel/components/list/list",["jquery","client.property-panel/components/components","client.property-panel/component-utils","general.utils/property-resolver","general.utils/property-mapper","general.utils/support","general.components/context-menu/context-menu-service","general.sortable/sortable-item-lists","util","text!./list.ng.html"],function(a,b,c,d,e,f,g,h,i,j){var k={template:j,controller:["$scope","$element",function(j,k){function l(a){return j.definition.cId?d.getValue(a,j.definition.cId,""):a&&a.cId}function m(a,b){d.setValue(a,j.definition.cId||"cId",b)}function n(){j.sortableItemLists.reset();var a=d.getValue(j.data,j.definition.ref,[]);a.forEach(function(a,c){var e=j.itemId(a),f=t.createItem({title:function(){var b,e=j.definition.itemTitleRef;return e?(b="function"==typeof e?e.call(null,a,c,j.args.handler):d.getValue(a,e,""),"object"==typeof b&&(b=b.qStringExpression?b.qStringExpression.qExpr:b.qValueExpression.qExpr)):b=""+(c+1),b},component:b.getComponent("items"),definition:j.definition.items,data:a,id:e,index:c,expanded:q.get(r+e)||!1,disabled:!0,sortable:j.definition.allowMove!==!1});t.addItem(f)})}function o(){t.items.forEach(function(a){a.expanded=!1,q.put(r+l(a.data),!1)})}function p(){return"function"==typeof j.definition.max?j.definition.max.call(null,j.data,this):j.definition.max||1e6}var q=j.args.cache,r="list_"+j.definition.ref+"_";c.defineVisible(j,j.args.handler),j.listItemComponent=b.getComponent("items"),j.listItemDefinition={items:j.definition.items||[],grouped:j.definition.grouped},j.itemId=function(a){var b=l(a);return b||(b=a.$$hashKey,m(a,b),delete a.$$hashKey),b},j.isExpanded=function(a){return q.get(r+l(a))},j.expandClicked=function(b,c){if(!a(b.target).hasClass("pp-move-item")){var d=l(c.data),e=q.get(r+d)||!1;c.expanded=!e,q.put(r+d,c.expanded)}},j.addClicked=function(){if(!j.addDisabled()){o();var a=e.mapProperties(j.definition);a.cId=i.generateId(),"function"==typeof j.definition.add&&j.definition.add.call(null,a,j.data,j.args.handler);var b=d.getValue(j.data,j.definition.ref,[]);b.push(a),q.put(r+a.cId,!0),j.$emit("saveProperties")}},j.removeItem=function(a){var b=d.getValue(j.data,j.definition.ref,[]),c=b[a];"function"==typeof j.definition.remove&&j.definition.remove.call(null,c,j.data,j.args.handler),b.splice(a,1),j.$emit("saveProperties")};var s=null;j.openContextMenu=function(a,b){var c=g.menu();c.addItem({translation:"Common.Delete",tid:"delete",select:function(){j.removeItem(b.index)}}),s=g.show(c,{position:{x:a.pageX,y:a.pageY},docking:"Top"})},j.sortableItemLists=h.create({options:{direction:"vertical",listKey:"list",listSelector:".pp-expandable-list",itemKey:"item",itemSelector:".qv-pp-sortable",itemDragSelector:".qv-pp-sortable-handle",gesture:{name:"swipe",options:{radiusThreshold:f.treatAsDesktop()?4:0,preventDefault:!1}}},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.addClass("qv-pp-sortable"),a.templateSrc="pp-data-item.ng.html"},onBegin:function(){this._super.apply(this,arguments);var a=k.find(".pp-list-content");a.css("height",a.innerHeight()),o()},removePlaceholder:function(){this._super.apply(this,arguments);var a=k.find(".pp-list-content");a.css("height","")},onMove:function(){this._super.apply(this,arguments);var a=t.get().map(function(a){return a.data});d.setValue(j.data,j.definition.ref,a),j.$emit("saveProperties")}}),j.$watchCollection("data."+j.definition.ref,n),j.addDisabled=function(){var a=d.getValue(j.data,j.definition.ref,[]);return j.definition.allowAdd&&a.length>=p()};var t=j.sortableItemLists.createList(1,{tid:"list"});j.$on("$destroy",function(){s&&(s.destroy(),s=null)})}]};return k}),define("text!client.property-panel/components/measures/measures.ng.html",[],function(){return'<div class="pp-component pp-list-component pp-toplist" tcl="measures">\r\n	<button class="qui-outlinebutton pp-toplist-add-button" ng-class="{\'qui-active\': adding}" qva-activate="addClicked($event)" qv-enter="addClicked($event)"\r\n			ng-disabled="addDisabled() || !definition.allowAdd" q-translation="{{definition.addTranslation}}" tid="add-measure"></button>\r\n\r\n	<ul class="pp-expandable-list pp-toplist-content pp-measure-list" pp-sortable="sortableOptions">\r\n		<li ng-repeat="item in items track by item.id" ng-class="{ \'locked\': item.locked || !definition.allowMove }" class="expandable-list-item">\r\n			<div class="pp-expandable-list-header pp-measure pp-sublist-header" qva-activate="itemClicked( $event, item )" qva-longtapdrag="enableTouchDrag()"\r\n				 ng-class="{ \'expanded\': item.expanded && !item.disabled, \'disabled\': item.disabled, \'invalid\': isInvalid( $index ) }" pp-sortable-handle>\r\n				<i class="toggle-expand {{ item.expanded && !item.disabled ? \'icon-triangle-bottom\' : \'icon-triangle-right\' }}"></i>\r\n				<span class="text">{{item.title()}}</span>\r\n				<span class="icon icon-trash pp-delete-property" ng-if="definition.allowRemove" q-title-translation="Common.Delete"></span>\r\n			</div>\r\n			<div class="pp-expandable-list-content" ng-if="item.expanded && !item.disabled">\r\n				<div include-pp-component x-component="listItemComponent" x-definition="listItemDefinition" x-data="item.data" x-args="args"></div>\r\n			</div>\r\n		</li>\r\n	</ul>\r\n</div>\r\n'}),define("client.property-panel/components/measures/measures",["jquery","touche","client.property-panel/components/components","general.utils/property-resolver","general.services/show-service/show-service","objects.utils/data-properties/library-utils","objects.add-popovers/add-measure-popover","translator","core.utils/resize","text!./measures.ng.html"],function(a,b,c,d,e,f,g,h,i,j){var k={template:j,controller:["$scope","$element","$timeout",function(j,k,l){function m(){var a=j.definition,b=d.getValue(j.data,j.definition.ref,[]),e=b.map(function(b,d){var e=b.qDef.cId;return{title:function(){var a=j.args.handler.getMeasureLayout(e);return a&&a.qError?h.get("Object.ErrorMessage.MissingMeasure"):a&&a.qFallbackTitle||""},component:c.getComponent("items"),definition:a,data:b,id:e,index:d,expanded:r.get(s+e)||!1,disabled:!1}}),g={},i=d.getValue(j.data,j.definition.disabledRef,[]),k=i.map(function(d,e){var i=d.qDef.cId;return{title:function(){var a=d.qLibraryId;return a?"undefined"!=typeof g[a]?null===g[a]?h.get("Object.ErrorMessage.MissingMeasure"):g[a]:f.findLibraryMeasure(a).then(function(b){return b?(g[a]=b.qData.title,g[a]):(g[a]=null,h.get("Object.ErrorMessage.MissingMeasure"))}):d.qDef.qLabel},component:c.getComponent("items"),definition:a,data:d,id:i,index:b.length+e,expanded:r.get(s+i)||!1,disabled:!0}});j.items=e.concat(k)}function n(c){t&&(t.destroy(),t=null),c&&a(c.target).hasClass("pp-toplist-add-button")&&b.preventGestures(),j.adding=!1}function o(){l(function(){var a=k.find(".pp-toplist-content"),b=a.children().last();a[0].scrollTop=b[0].offsetTop-1},100)}function p(a){j.args.handler.addLibraryMeasure(a.libraryId).then(function(a){r.put(s+a.qDef.cId,!0),j.$emit("saveProperties"),n(),o()})}function q(a){j.args.handler.addExpressionMeasure(a.value,"").then(function(a){r.put(s+a.qDef.cId,!0),j.$emit("saveProperties"),n(),o()})}var r=j.args.cache,s="measures_";j.listItemComponent=c.getComponent("items"),j.listItemDefinition={items:j.definition.items||[],grouped:j.definition.grouped},j.$watchCollection("data."+j.definition.ref,function(){m()}),j.$watchCollection("data."+j.definition.disabledRef,function(){m()}),j.isInvalid=function(a){var b=j.args.handler.getMeasureLayouts()[a];return b&&!!b.qError},j.itemClicked=function(b,c){if(a(b.target).hasClass("pp-delete-property"))j.args.handler.removeMeasure(c.index).then(function(){j.$emit("saveProperties")});else{var d=r.get(s+c.data.qDef.cId)||!1;c.disabled||(c.expanded=!d,r.put(s+c.data.qDef.cId,!d))}},j.addDisabled=function(){return j.args.handler.getMeasures().length>=j.args.handler.maxMeasures()};var t=null;j.addClicked=function(b){j.addDisabled()||j.adding||(t=e.show(g,{alignTo:a(b.target),position:"bottom",closeAddPopover:n,addLibraryMeasure:p,addExpressionMeasure:q}),j.adding=!0)},j.sortableOptions={disabled:!j.definition.allowMove,onMove:function(a,b){j.args.handler.moveMeasure(a,b).then(function(){j.$emit("saveProperties")})}},i.on("start",n),j.$on("$destroy",function(){i.off("start",n)})}]};return k}),define("text!client.property-panel/components/number/number.ng.html",[],function(){return'<div class="pp-component pp-number-component" ng-if="visible" tcl="number">\r\n	<div class="label" ng-if="label">{{label}}</div>\r\n\r\n	<div class="value" ng-class="{ \'qui-inputwithicon\': isExpressionDefinition }">\r\n		<input type="text" maxlength="{{maxlength}}" ng-class="{ \'qui-invalid\': invalid, \'qui-input\': !isExpressionDefinition, \'is-expression\': isLocked() }"\r\n			   ng-model="displayValue" pp-model-onblur pp-input-validator ng-readonly="isLocked()" ng-disabled="readOnly" ng-change="change()"\r\n			   pp-expression-editor="value" editor-disabled="!isLocked()" expression-type="{{expressionType}}" tid="{{key}}"/>\r\n\r\n		<i class="icon-expression edit-expression" ng-class="{\'active\': isExpression()}" ng-show="isExpressionDefinition && !readOnly"\r\n		   pp-expression-editor="value" expression-type="{{expressionType}}"\r\n		   q-title-translation="Tooltip.AddExpression"></i>\r\n	</div>\r\n\r\n	<div ng-if="isLocked()" class="hint" q-translation="properties.editInExpressionEditor"></div>\r\n</div>\r\n'}),define("client.property-panel/components/number/number",["client.property-panel/component-utils","general.utils/string-limits","text!./number.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(c){var d=function(){return c.data};c.maxlength=c.definition.maxlength?c.definition.maxlength:b.name,a.defineLabel(c,c.definition,d,c.args.handler),a.defineVisible(c,c.args.handler),a.defineReadOnly(c,c.args.handler),a.defineChange(c,c.args.handler),a.defineValue(c,c.definition,d),a.defineExpression(c,!0)}]};return d}),define("text!client.property-panel/components/slider/slider.ng.html",[],function(){return'<div class="pp-component pp-slider-component" ng-if="visible" tcl="slider">\r\n	<div class="label">{{label}}</div>\r\n\r\n	<div class="value">\r\n		<div class="slider" pp-slider="sliderOptions" ng-model="value" ng-change="change()" ng-disabled="readOnly" ></div>\r\n	</div>\r\n</div>'}),define("client.property-panel/components/slider/slider",["client.property-panel/component-utils","text!./slider.ng.html"],function(a,b){var c={template:b,controller:["$scope",function(b){var c=function(){return b.data};a.defineLabel(b,b.definition,c,b.args.handler),a.defineVisible(b,b.args.handler),a.defineReadOnly(b,b.args.handler),a.defineChange(b,c,b.args.handler),a.defineValue(b,b.definition,c),b.sliderOptions={min:b.definition.min,max:b.definition.max,step:b.definition.step,range:"array"===b.definition.type}}]};return c}),define("text!client.property-panel/components/string/string.ng.html",[],function(){return'<div class="pp-component pp-string-component" ng-if="visible" tcl="string">\r\n	<div class="label" ng-if="label">{{label}}</div>\r\n\r\n	<div class="value" ng-class="{ \'qui-inputwithicon\': isExpressionDefinition }">\r\n		<input type="text" maxlength="{{maxlength}}" ng-class="{ \'qui-invalid\': invalid, \'qui-input\': !isExpressionDefinition, \'is-expression\': isLocked() }"\r\n			ng-model="displayValue" pp-model-onblur pp-input-validator ng-readonly="isLocked()" ng-disabled="readOnly" ng-change="change()"\r\n			pp-expression-editor="value" editor-disabled="!isLocked()" expression-type="{{expressionType}}" tid="{{key}}" />\r\n\r\n		<i class="icon-expression edit-expression" ng-class="{\'active\': isExpression()}" ng-show="isExpressionDefinition && !readOnly"\r\n		   pp-expression-editor="value" expression-type="{{expressionType}}"\r\n		   q-title-translation="Tooltip.AddExpression"></i>\r\n	</div>\r\n\r\n	<div ng-if="isLocked()" class="hint" q-translation="properties.editInExpressionEditor"></div>\r\n</div>\r\n'}),define("client.property-panel/components/string/string",["client.property-panel/component-utils","general.utils/string-limits","text!./string.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(c){var d=function(){return c.data};c.maxlength=c.definition.maxlength?c.definition.maxlength:b.name,a.defineLabel(c,c.definition,d,c.args.handler),a.defineVisible(c,c.args.handler),a.defineReadOnly(c,c.args.handler),a.defineChange(c,c.args.handler),a.defineValue(c,c.definition,d),a.defineExpression(c,!1)}]};return d}),define("text!client.property-panel/components/library-item/library-item.ng.html",[],function(){return'<div class="pp-component pp-string-component pp-library-item-component" ng-if="visible" tcl="library-item">\r\n	<div class="label" ng-if="label">{{label}}</div>\r\n\r\n	<div class="value qui-inputwithicon">\r\n		<input type="text" ng-model="value" disabled="disabled" ng-class="{ \'qui-invalid\': invalid }"/>\r\n		<i class="icon-link edit-expression" q-title-translation="{{toolTopTranslationKey}}" qva-activate="breakLink()" ng-show="!invalid"></i>\r\n	</div>\r\n\r\n</div>'}),define("text!assets/client/dialogs/notification-dialog/notification-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="notification-dialog" qv-cancel="close()" qv-confirm="close()">\r\n    <main class="dm-main">\r\n        <div class="qv-mvc-dialog-content">\r\n            <div class="qv-mvc-dialog-icon icon-{{icon}}" ng-show="icon"></div>\r\n            <p><span q-translation="{{text}}"></span></p>\r\n        </div>\r\n    </main>\r\n    <footer class="dm-footer">\r\n        <qui-button qva-activate="$event.preventDefault(); close()" name="confirm" autofocus q-translation="{{confirmLabel}}"></qui-button>\r\n    </footer>\r\n</qv-modal-dialog>\r\n'}),define("assets/client/dialogs/notification-dialog/notification-dialog",["general.services/show-service/show-service","text!assets/client/dialogs/notification-dialog/notification-dialog.ng.html","assets/client/dialogs/directives/dialog-directives"],function(a,b){function c(b){var c=b.text,e=void 0!==b.icon?b.icon:"cogwheel",f=b.confirm||"Common.OK",g={text:c,icon:e,confirmLabel:f};return a.show(d,g).resultPromise}var d={template:b,scope:{text:"=",icon:"=",confirmLabel:"="},controller:["$scope",function(a){a.close=function(){a.destroyComponent(),a.deferredResult.resolve()}}]};return{show:c}}),define("client.services/link-dimension-service",["util","general.models/library/dimension","assets/client/dialogs/confirm-dialog/confirm-dialog","assets/client/dialogs/notification-dialog/notification-dialog"],function(a,b,c,d){function e(b,c){b.qDef=a.extend(!0,{},b.qDef,c.qDim);for(var d=0;d<b.qDef.qFieldDefs.length;++d)b.qDef.qFieldDefs[d]===b.qDef.qFieldLabels[d]&&(b.qDef.qFieldLabels[d]="");b.qLibraryId=""}function f(a){return b.getProperties(a.qLibraryId).then(function(b){return"N"===b.properties.qDim.qGrouping?c.show({text:"Dimension.Linked.BreakLinkDialog.Text",icon:"link"}).then(function(){e(a,b.properties)}):d.show({text:"Dimension.Linked.BreakLink.Drilldown.Text",icon:"link"})})}return{breakLink:e,showBreakLinkDialog:f}}),define("client.services/link-measure-service",["util","general.models/library/measure","assets/client/dialogs/confirm-dialog/confirm-dialog"],function(a,b,c){function d(b,c){b.qDef?b.qDef=a.extend(!0,{},b.qDef,c.qMeasure):b.qExpr=c.qMeasure.qDef,b.qLibraryId=""}function e(a){return b.getProperties(a.qLibraryId).then(function(b){d(a,b.properties)})}function f(a){return c.show({text:"Measure.Linked.BreakLinkDialog.Text",icon:"link"}).then(function(){return e(a)})}return{breakLink:d,showBreakLinkDialog:f}}),define("client.property-panel/components/library-item/library-item",["client.property-panel/component-utils","general.utils/property-resolver","objects.error-handling/error-translation","text!./library-item.ng.html","client.services/link-dimension-service","client.services/link-measure-service"],function(a,b,c,d,e,f){function g(a,c){var d=c.lastIndexOf(".");return-1!==d&&(c=c.substr(0,d),a=b.getValue(a,c)),a}var h={template:d,controller:["$scope",function(d){function h(){var a,e,f,g,h,i,k=b.getValue(d.data,d.definition.ref),l="";if(j)for(g=d.args.handler.getMeasures(),a=0;a<g.length;++a)g[a].qLibraryId===k&&(e=g[a].qDef?g[a].qDef.cId:void 0,i=d.args.handler.getMeasureLayout(e),i&&(i.qError&&!i.qFallbackTitle?(h=i.qError.qErrorCode,l=c.getMeasureError(h,!0)):l=i.qFallbackTitle?i.qFallbackTitle:"string"==typeof i?i:""));else for(f=d.args.handler.getDimensions(),a=0;a<f.length;++a)(f[a].qLibraryId||f[a].qListObjectDef&&f[a].qListObjectDef.qLibraryId)===k&&(e=f[a].qDef.cId,i=d.args.handler.getDimensionLayout(e),i&&(i.qError&&!i.qFallbackTitle?(h=i.qError.qErrorCode,l=c.getDimensionError(h,!0)):l=i.title||i.qFallbackTitle||""));d.value=l,d.invalid=!!h}var i=function(){return d.data},j="measure"===d.definition.libraryItemType;a.defineLabel(d,d.definition,i,d.args.handler),a.defineVisible(d,d.args.handler),a.defineReadOnly(d,d.args.handler),a.defineChange(d,d.args.handler),d.breakLink=function(){var a=g(d.data,d.definition.ref);j?f.showBreakLinkDialog(a).then(function(){d.change()}):e.showBreakLinkDialog(a).then(function(){d.change()})},d.toolTopTranslationKey=j?"Measure.Unlink":"Dimension.Unlink",d.$on("layoutchanged",function(){h()}),h()}]};return h}),define("text!client.property-panel/components/item-selection-list/item-selection-list.ng.html",[],function(){return'<div class="pp-component pp-selection-list-component" ng-if="visible" tcl="item-selection-list">\r\n	<div class="label" ng-if="label">{{label}}</div>\r\n\r\n	<ul class="pp-item-selection-list" ng-class="{\'vertical\' : !horizontal, \'small\' : small }">\r\n		<li ng-repeat="item in items" qva-activate="onChange(this)" ng-show="itemVisible(item)">\r\n			<div ng-show="item.labelPlacement == \'top\'" class="label">\r\n				<span>{{item.label}}</span>\r\n			</div>\r\n			<button ng-class="{\'item\':true,\'selected\' : item.value == value}" title="{{item.label}}">\r\n				<div include-pp-component x-component="item.component" x-definition="item.definition" x-data="data" x-args="args"></div>\r\n			</button>\r\n			<div ng-show="item.labelPlacement == \'bottom\'" class="label">\r\n				<span>{{item.label}}</span>\r\n			</div>\r\n		</li>\r\n	</ul>\r\n</div>'}),define("client.property-panel/components/item-selection-list/item-selection-list",["client.property-panel/components/components","client.property-panel/component-utils","text!./item-selection-list.ng.html"],function(a,b,c){var d;return d={template:c,controller:["$scope",function(c){var d=c.definition.items||c.definition,e=function(){return c.data};c.items=Object.keys(d).filter(function(a){return d[a]}).map(function(f,g,h){var i,j=d[f];return i={component:a.findComponent(j),definition:j,data:c.data,key:f,value:j.value,show:j.show,labelPlacement:j.labelPlacement||"top",labelStyle:j.labelStyle||""},c.definition.horizontal&&h.length%3===0&&(i.definition.small=!0),b.defineLabel(i,j,e,c.args.handler),i}),c.horizontal=c.definition.horizontal||!1,c.small=c.items.length%3===0,b.defineLabel(c,c.definition,e,c.args.handler),b.defineVisible(c,c.args.handler),b.defineReadOnly(c,c.args.handler),b.defineValue(c,c.definition,e),c.itemVisible=function(a){return"boolean"==typeof a.show?a.show:"function"==typeof a.show?a.show.call(null,c.data,c.args.handler):!0},c.onChange=function(a){c.value=a.item.value,"function"==typeof c.definition.change&&c.definition.change(c.data,c.args.handler),c.$emit("saveProperties")},c.options=[]}]}}),define("text!client.property-panel/components/switch/switch.ng.html",[],function(){return'<div class="pp-component pp-switch-component" ng-if="visible" tcl="switch">\r\n	<div class="label" ng-if="label" ng-disabled="readOnly">\r\n		<div class="title">{{label}}</div>\r\n		<div class="value">{{getDescription(value)}}</div>\r\n	</div>\r\n	<qui-toggle-switch value="switchValue" read-only="readOnly" tid="{{key}}" />\r\n</div>\r\n'}),define("client.property-panel/components/switch/switch",["client.property-panel/component-utils","translator","text!./switch.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(c){var d=function(){return c.data};a.defineLabel(c,c.definition,d,c.args.handler),a.defineVisible(c,c.args.handler),a.defineReadOnly(c,c.args.handler),a.defineChange(c,c.args.handler),a.defineValue(c,c.definition,d);var e,f;"undefined"!=typeof c.definition.trueOption?(e=c.definition.trueOption,f=c.definition.falseOption):c.definition.options[0].value===!0?(e=c.definition.options[0],f=c.definition.options[1]):(e=c.definition.options[1],f=c.definition.options[0]),e.translation&&(e.label=b.get(e.translation),delete e.translation),f.translation&&(f.label=b.get(f.translation),delete f.translation),c.trueOption=e,c.falseOption=f,c.getDescription=function(a){return a===e.value?e.label:f.label},Object.defineProperty(c,"switchValue",{get:function(){return c.value===e.value},set:function(a){c.value=a?e.value:f.value,c.change()}})}]};return d}),define("text!client.property-panel/components/color-scale-sl/color-scale-sl.ng.html",[],function(){return'<div class="pp-component pp-color-scale-component" ng-if="visible" qva-apply-style="style" tcl="color-scale">\r\n</div>'}),define("client.property-panel/components/apply-style",["qvangular"],function(a){a.directive("qvaApplyStyle",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.qvaApplyStyle,function(a){a&&b.attr("style",b.attr("style")?b.attr("style")+a:a)},!1)}}})}),define("client.property-panel/components/color-scale-sl/color-scale-sl",["client.property-panel/component-utils","text!./color-scale-sl.ng.html","client.property-panel/components/apply-style"],function(a,b){function c(a,b,c){var d,j,k;if(j="",k=")",c)if(b)for(d=a.length-1;d>0;d--)j+=", "+a[d]+" "+100/(a.length-1)*(a.length-1-d)+"%";else for(d=a.length-1;d>0;d--)j+=", "+a[d]+" "+100/a.length*(a.length-1-d)+"%",j+=", "+a[d]+" "+100/a.length*(a.length-d)+"%";else if(b)for(d=0;d<a.length;d++)j+=", "+a[d]+" "+100/(a.length-1)*d+"%";else for(d=0;d<a.length;d++)j+=", "+a[d]+" "+100/a.length*d+"%",j+=", "+a[d]+" "+100/a.length*(d+1)+"%";return"background:"+a[a.length/2]+"; background:"+e+j+k+"; background:"+f+j+k+"; background:"+g+j+k+"; background:"+h+j+k+"; background:"+i+j+k+";width: 100%; height: 32px;border-radius:4px;"}var d,e="-moz-linear-gradient(left",f="-webkit-linear-gradient(left",g=" -o-linear-gradient(left",h="-ms-linear-gradient(left",i="linear-gradient(to right";return d={template:b,controller:["$scope",function(b){var d=function(){return b.data},e=function(a){return"boolean"==typeof a.definition.reverse?a.definition.reverse:"function"==typeof a.definition.reverse?a.definition.reverse.call(null,a.data,a.handler):!1};a.defineLabel(b,b.definition,d,b.args.handler),a.defineVisible(b,b.args.handler),a.defineReadOnly(b,b.args.handler),a.defineValue(b,b.definition,d),Object.defineProperty(b,"style",{get:function(){return c(b.definition.colors,"gradient"===b.definition.type,e(b))}})}]}}),define("text!client.property-panel/components/image-item-sl/image-item-sl.ng.html",[],function(){return'<img class="pp-component pp-image-item-component" ng-if="visible" ng-src="{{src}}" qva-apply-style="style" tcl="image-item">\r\n</img>'}),define("client.property-panel/components/image-item-sl/image-item-sl",["client.property-panel/component-utils","text!./image-item-sl.ng.html","client.property-panel/components/apply-style"],function(a,b){var c,d=window.devicePixelRatio||1;return c={template:b,controller:["$scope",function(b){var c=function(){return b.data};b.src=2===d&&b.definition.srcx2?b.definition.srcx2:b.definition.src,b.style=(b.definition.width?"width:"+b.definition.width+"px;":"")+(b.definition.height?"height:"+b.definition.height+"px;":""),a.defineLabel(b,b.definition,c,b.args.handler),a.defineVisible(b,b.args.handler),a.defineReadOnly(b,b.args.handler),a.defineValue(b,b.definition,c)}]}}),define("text!client.property-panel/components/icon-item-sl/icon-item-sl.ng.html",[],function(){return'<div class="pp-component pp-icon-item-component" ng-class="{ \'small\' : small }" ng-if="visible" qva-apply-style="style" tcl="icon-item">\r\n	{{content}}\r\n</div>'}),define("client.property-panel/components/icon-item-sl/icon-item-sl",["client.property-panel/component-utils","text!./icon-item-sl.ng.html","client.property-panel/components/apply-style"],function(a,b){var c={template:b,controller:["$scope",function(b){var c=function(){return b.data};b.content=b.definition.icon,b.small=b.definition.small||!1,a.defineLabel(b,b.definition,c,b.args.handler),a.defineVisible(b,b.args.handler),a.defineReadOnly(b,b.args.handler),a.defineValue(b,b.definition,c)}]};return c}),define("text!client.property-panel/components/color-picker/color-picker.ng.html",[],function(){return'<div class="pp-component pp-color-picker-component" ng-if="visible" tcl="color-picker">\r\n	<div ng-if="label" class="label" style="display:inline-block;">\r\n		{{label}}\r\n	</div>\r\n	<div class="value picker" style="display:inline-block;">\r\n        <div qv-color-picker-button on-close="closeColorpickerFoldout(event)" on-open="openColorPickerFoldout(comp)" ng-model="value" ng-change="change()" palette="palette" ng-disabled="readOnly"></div>\r\n	</div>\r\n</div>'}),define("text!general.views/colorpicker/colorpicker.ng.html",[],function(){return'<button qva-activate="onClick($event)" class="colorpicker-button qui-button" q-title-translation="ColorPicker.Choose">\r\n	<div class="qv-color-picker-preview dropdown" tid="color-picker-preview"></div>\r\n	<i class="icon-triangle-bottom"></i>\r\n</button>'}),define("text!general.views/colorpicker/colorpicker-popup.ng.html",[],function(){return'<immidiate-contextual class="qv-cp-popup qv-color-picker" style="z-index:1200;" width="110" position="\'bottom\'" collision="\'flipfit\'" align-to="$alignToElement" on-close-view="closeView(event)">\r\n	<ul class="qv-colorpicker">\r\n        <li ng-repeat="color in $palette" qva-activate="setColor($event, $index, color)" ng-style="{\'background-color\': color}" ng-class="{\'selected\': foreColor === color, \'selected-w\' : color === \'#ffffff\'}"></li>\r\n	</ul>\r\n</immidiate-contextual>'
}),define("general.views/colorpicker/colorpicker",["jquery","qvangular","core.utils/theme","text!../colorpicker/colorpicker.ng.html","text!../colorpicker/colorpicker-popup.ng.html"],function(a,b,c,d,e){function f(a,b){return b[a]?b[a]:a}function g(a,b,c,d,e){if(i){if(i.element===b)return void h.close(null);h.close(null)}b.addClass("qui-active"),i={model:e,element:b,previewBox:d,scope:a},h=k.showComponent(j,{$alignToElement:b,$palette:a.$eval(c.palette)||m,onClose:function(b){c.onClose&&a.$eval(c.onClose,{event:b})}}),a.$eval(c.onOpen,{comp:h})}var h,i,j,k=a('<div class="qv-cp-popupcontainer"></div>').appendTo(a(document.body)),l=0,m=c.palette;j={template:e,controller:["$scope",function(a){a.foreColor=f(i.model.$viewValue,a.$palette),a.setColor=function(c,d,e){a.foreColor=e,i&&b.$apply(i.scope,function(){i.model.$setViewValue(d),i.previewBox&&i.previewBox.css("background-color",e),h.close(c)})},this.close=a.closeView=function(b){a.onClose&&a.onClose(b),i&&(i.element.removeClass("qui-active"),i=null),b&&"function"==typeof b.preventDefault&&b.preventDefault(),a.destroyComponent()}}]},b.directive("qvColorPickerCustom",function(){return{require:"?ngModel",link:function(b,c,d,e){var f=l++;b.onClick=function(){g(b,c,d,null,e)},a(window).on("resize.colorpicker"+f,function(){i&&h.close({target:null})}),b.$on("$destroy",function(){a(window).off("resize.colorpicker"+f)})}}}),b.directive("qvColorPickerButton",function(){return{require:"?ngModel",replace:!0,template:d,link:function(b,c,d,e){var j=b.$eval(d.palette)||m,k=f(e.$viewValue,j),n=c.find(".qv-color-picker-preview"),o=l++;b.onClick=function(){g(b,c,d,n,e)},a(window).on("resize.colorpicker"+o,function(){i&&h.close({target:null})}),b.$watch(d.ngModel,function(){void 0!==e.$viewValue&&(k=f(e.$viewValue,j),n.css("background-color",k))}),b.$on("$destroy",function(){a(window).off("resize.colorpicker"+o)})}}})}),define("client.property-panel/components/color-picker/color-picker",["touche","core.utils/theme","client.property-panel/component-utils","text!./color-picker.ng.html","jquery","general.views/colorpicker/colorpicker"],function(a,b,c,d,e){var f;return f={template:d,controller:["$scope",function(d){var f,g=function(){return d.data},h=function(){f.close()};c.defineLabel(d,d.definition,g,d.args.handler),c.defineVisible(d,d.args.handler),c.defineReadOnly(d,d.args.handler),c.defineChange(d,d.args.handler),c.defineValue(d,d.definition,g),d.closeColorpickerFoldout=function(b){b&&e(b.target).closest(".colorpicker-button").length&&a.preventGestures(),e(window).off("mousewheel.colorPicker DOMMouseScroll.colorPicker",h),f=void 0},d.openColorPickerFoldout=function(a){f=a,e(window).on("mousewheel.colorPicker DOMMouseScroll.colorPicker",h)},d.palette=b.palette}]}}),define("text!client.property-panel/components/color-scale-creator/color-scale-creator.ng.html",[],function(){return'<div class="pp-component pp-color-scale-creator-component" ng-show="visible" tcl="color-scale-creator">\r\n	<div ng-if="label" class="label" style="display: inline-block;">\r\n		{{label}}\r\n	</div>\r\n	<div ng-if="add" class="add-button">\r\n		<button class="qui-outlinebutton pp-add-property ng-binding" qva-activate="addLimit($event)" ng-disabled="addDisabled(limits)">{{add}}</button>\r\n	</div>\r\n	<div class="color-creator-container">\r\n		<!-- picker -->\r\n		<div class="color-scale-container">\r\n			<div qv-glyph-color-picker-custom\r\n				 ng-if="useGlyph"\r\n				 on-close="closeColorpickerFoldout(event)"\r\n				 class="color-scale"\r\n				 ng-repeat="itemData in sortedSegments"\r\n				 ng-style="getColorScaleStyle(itemData)"\r\n				 qva-apply-style="getColorBackgroundStyle(sortedSegments,$index)"\r\n				 selected-color="itemData.pickerModel.color"\r\n				 selected-icon="itemData.pickerModel.icon"\r\n				 qva-activate="onClick($event)">\r\n				{{itemData.pickerModel.icon}}\r\n			</div>\r\n			<div qv-color-picker-custom\r\n				 ng-if="!useGlyph"\r\n				 on-close="closeColorpickerFoldout(event)"\r\n				 class="color-scale"\r\n				 ng-repeat="itemData in sortedSegments"\r\n				 ng-style="getColorScaleStyle(itemData)"\r\n				 qva-apply-style="getColorBackgroundStyle(sortedSegments,$index)"\r\n				 ng-model="itemData.pickerModel.color"\r\n				 qva-activate="onClick($event)">\r\n			</div>\r\n		</div>\r\n\r\n		<div class="pp-component pp-slider-component" style="margin-bottom:5px;" ng-class="{\'notVisible\': limits.length < 1}">\r\n			<div class="value">\r\n				<div class="slider colorSlider" pp-slider="sliderOptions" ng-model="limits"></div>\r\n			</div>\r\n		</div>\r\n\r\n		<div class="hidden limit-options-arrow" ng-class="{\'notVisible\': limits.length < 1}">\r\n			<div class="limit-options-arrow-fg"></div>\r\n			<div class="limit-options-arrow-bg"></div>\r\n		</div>\r\n\r\n		<div class="limit-options hidden">\r\n			<div ng-repeat="itemData in limits track by $index">\r\n				<div class="limitInput" ng-if="$index == activeIndex" include-pp-component x-component="limitListItemComponent" x-definition="limitlistItemDefinition" x-data="itemData" x-args="args" ng-model="value">\r\n				</div>\r\n				<div tid="limitOptions-gradient" ng-if="$index == activeIndex" include-pp-component x-component="limitGradientCheckBoxComponent" x-definition="limitGradientCheckBoxDefinition" x-data="itemData" x-args="args" ng-model="gradient">\r\n				</div>\r\n				<button tid="limitOptions-remove" ng-if="$index == activeIndex" class="qui-outlinebutton pp-remove-property" qva-activate="removeLimit($index)">\r\n					<div q-translation="properties.colorScaleCreator.removeLimit"></div>\r\n					<div class="icon-bin remove-icon"></div>\r\n				</button>\r\n\r\n			</div>\r\n		</div>\r\n\r\n		<!--\r\n		<div ng-repeat="itemData in colors">\r\n			<div ng-if="$index == activeIndex" include-pp-component x-component="colorListItemComponent" x-definition="colorlistItemDefinition" x-data="itemData" x-args="args"></div>\r\n		</div>\r\n		-->\r\n	</div>\r\n</div>\r\n'}),define("text!general.views/glyphColorPicker/glyphColorPicker-popup.ng.html",[],function(){return'<immidiate-contextual class="qv-gcp-popup qv-color-picker flex" style="z-index:1200;" width="220" position="\'bottom\'" collision="\'flipfit\'" align-to="$alignToElement" on-close-view="closeView(event)">\r\n	<div class="flex column" >\r\n		<div class="title" q-translation="properties.color">Color</div>\r\n		<ul class="qv-colorpicker">\r\n			<li ng-repeat="color in $palette" qva-activate="setColor($event, $index, color)" ng-style="{\'background-color\': color}" ng-class="{\'selected\': foreColor === color, \'selected-w\' : color === \'#ffffff\'}"></li>\r\n		</ul>\r\n	</div>\r\n	<div class="flex column">\r\n		<div class="title" q-translation="properties.glyph"></div>\r\n		<ul class="qv-glyphpicker">\r\n			<li ng-repeat="glyph in $glyphPalette" qva-activate="setGlyph($event, $index, glyph)" ng-class="{\'selected\': glyphIcon === glyph.icon, \'border\': glyph.icon === \'\'}">{{glyph.icon}}</li>\r\n		</ul>\r\n	</div>\r\n\r\n</immidiate-contextual>'}),define("general.views/glyphcolorpicker/glyphcolorpicker",["jquery","qvangular","core.utils/theme","text!../glyphColorPicker/glyphColorPicker-popup.ng.html"],function(a,b,c,d){function e(a,b){return b[a]?b[a]:a}function f(a,b,c,d){if(h){if(h.element===b)return void g.close(null);g.close(null)}b.addClass("qui-active"),h={element:b,previewBox:d,scope:a},g=j.showComponent(i,{$alignToElement:b,$palette:a.$eval(c.palette)||l,$selectedColor:a.$eval(c.selectedColor),$selectedIcon:a.$eval(c.selectedIcon),$glyphPalette:m,$itemData:a.itemData,$onChange:a.onGlyphOrColorChange,onClose:function(b){c.onClose&&a.$eval(c.onClose,{event:b})}}),a.$eval(c.onOpen,{comp:g})}var g,h,i,j=a('<div class="qv-gcp-popupcontainer"></div>').appendTo(a(document.body)),k=0,l=c.palette,m=[{icon:""},{icon:"R"},{icon:"S"},{icon:"P"},{icon:"Q"},{icon:"m"},{icon:""},{icon:""}];i={template:d,controller:["$scope",function(a){a.foreColor=e(a.$selectedColor,a.$palette),a.glyphIcon=a.$selectedIcon,a.setColor=function(c,d,e){a.foreColor=e,h&&b.$apply(h.scope,function(){a.$itemData.pickerModel.color=d,a.$onChange()})},a.setGlyph=function(c,d,e){a.glyphIcon=e.icon,h&&b.$apply(h.scope,function(){a.$itemData.pickerModel.icon=a.glyphIcon,a.$onChange()})},this.close=a.closeView=function(b){a.onClose&&a.onClose(b),h&&(h.element.removeClass("qui-active"),h=null),b&&"function"==typeof b.preventDefault&&b.preventDefault(),a.destroyComponent()}}]},b.directive("qvGlyphColorPickerCustom",function(){return{link:function(b,c,d){var e=k++;b.onClick=function(){f(b,c,d,null)},a(window).on("resize.glyphColorPicker"+e,function(){h&&g.close({target:null})}),b.$on("$destroy",function(){a(window).off("resize.glyphColorPicker"+e)})}}})}),define("client.property-panel/components/color-scale-creator/color-scale-creator",["client.property-panel/components/components","touche","client.property-panel/component-utils","core.utils/theme","text!./color-scale-creator.ng.html","general.utils/color","translator","qvangular","jquery","general.utils/property-resolver","general.views/glyphcolorpicker/glyphcolorpicker"],function(a,b,c,d,e,f,g,h,i,j){function k(a){return d.palette[a]?d.palette[a]:"number"==typeof a?"#000":a}var l;return l={template:e,controller:["$scope","$timeout","$element",function(d,e,l){function m(){d.conditionalColoringProps=j.getValue(y,d.definition.conditionalColoringRef.props,y),d.conditionalColoringProps instanceof Array?d.conditionalColoringProps.forEach(function(a,b){d.conditionalColoringProps[b]===d.data&&(d.conditionalColoringProps=d.conditionalColoringProps[b],d.conditionalColoringLayout=j.getValue(x,d.definition.conditionalColoringRef.layout)[b])}):d.conditionalColoringLayout=j.getValue(x,d.definition.conditionalColoringRef.layout,x),d.layoutLimits=d.conditionalColoringLayout.conditionalColoring?d.conditionalColoringLayout.conditionalColoring.segments.limits:x.segmentInfo.limits,d.layoutColors=d.conditionalColoringLayout.conditionalColoring?d.conditionalColoringLayout.conditionalColoring.segments.colors:x.segmentInfo.colors,s=d.conditionalColoringLayout.measureAxis,t=s.min,u=s.max}function n(){var a=z.children().eq(d.activeIndex).css("left");l.find(".limit-options-arrow-fg").css("left",a),l.find(".limit-options-arrow-bg").css("left",a)}function o(a,b){var c,d,e;if(d="",e=")",b)for(c=0;c<a.length;c++)d+=", "+a[c]+" "+100/(a.length-1)*c+"%";else for(c=0;c<a.length;c++)d+=", "+a[c]+" "+100/a.length*c+"%",d+=", "+a[c]+" "+100/a.length*(c+1)+"%";return"background:"+a[a.length/2]+"; background:"+B+d+e+"; background:"+C+d+e+"; background:"+D+d+e+"; background:"+E+d+e+"; background:"+F+d+e+";"}function p(){d.nrSegmentsInLayoutChanged&&(d.initializeSlider(),r(),d.nrSegmentsChanged=!1,d.nrSegmentsInLayoutChanged=!1),d.checkSliderVisiblility(),q()}function q(){d.sortedSegments=d.getSortedSegments(),!d.layoutLimits||d.layoutLimits.length<1||(d.sliderCreated=!0,z.slider("option",{min:t,max:u,step:(u-t)/1e3}),z.slider("values",d.layoutLimits.map(function(a){return"NaN"!==a.value?a.value:(u+t)/2})),d.sliderOptions.min=t,d.sliderOptions.max=u,d.sliderOptions.step=(u-t)/1e3,n())}function r(a){"number"!=typeof a&&(a=d.layoutLimits.length-1),d.updateSelectedHandle(d.activeIndex,a),-1!==a&&-1===d.activeIndex?(l.find(".limit-options-arrow").removeClass("hidden"),l.find(".limit-options").removeClass("hidden")):-1===a&&(l.find(".limit-options-arrow").addClass("hidden"),l.find(".limit-options").addClass("hidden")),d.activeIndex=a}var s,t,u,v,w=function(){return d.data},x=d.args.model.layout,y=d.args.properties,z=l.find(".colorSlider"),A=[3,4],B="-moz-linear-gradient(left",C="-webkit-linear-gradient(left",D=" -o-linear-gradient(left",E="-ms-linear-gradient(left",F="linear-gradient(to right";d.$watch("removeHandleActive",function(a){z&&!isNaN(a)&&z.children().eq(a).removeClass("active-handle")}),d.activeIndex=-1,d.add=g.get("properties.colorScaleCreator.addLimit"),d.maxSegments=6,d.useGlyph=d.definition.useGlyph?d.definition.useGlyph:!1,d.definition.conditionalColoringRef||(d.definition.conditionalColoringRef={props:"",layout:""}),m(),c.defineLabel(d,d.definition,w,d.args.handler),c.defineVisible(d,d.args.handler),c.defineValue(d,d.definition.items.limits,w,"limits"),c.defineValue(d,d.definition.items.colors,w,"colors"),d.sliderCreated=!1,d.sliderOptions={min:t,max:u,step:(u-t)/1e3,values:d.layoutLimits.map(function(a){return a.value}),stop:function(){h.$apply(d,function(){d.limits.forEach(function(a,b){d.activeIndex===b&&d.slide&&(a.value=d.sliderOptions.values[b],d.slide=!1)}),d.firstClick=!1,d.$emit("saveProperties")})},slide:function(a,b){return d.currentValue+=b.values[d.activeIndex]-d.firstClickValue,d.firstClick&&"object"==typeof d.limits[d.activeIndex].value||Math.abs(d.firstClickValue-d.currentValue)<200*d.sliderOptions.step?!1:(n(),void(d.slide=!0))},change:function(){return!1},start:function(a,b){h.$apply(d,function(){var a=0,c=b.handle;if(c&&"A"===c.tagName){for(;null!=(c=c.previousSibling);)a++;a!==d.activeIndex&&(d.updateSelectedHandle(d.activeIndex,a),r(a),d.firstClick=!0,d.firstClickValue=d.sliderOptions.values[a],d.currentValue=d.firstClickValue),n()}})}},d.updateSelectedHandle=function(a,b){a!==b&&(-1!==a&&z.children().eq(a).removeClass("active-handle"),-1!==b&&z.children().eq(b).addClass("active-handle"))},d.limitGradientCheckBoxComponent=a.getComponent("checkbox"),d.limitGradientCheckBoxDefinition={ref:"gradient",type:"boolean",defaultValue:!1,translation:g.get("properties.gradient")},d.limitListItemComponent=a.getComponent("items"),d.limitlistItemDefinition={items:d.definition.items.limits.items||[]},d.colorListItemComponent=a.getComponent("items"),d.colorlistItemDefinition={items:d.definition.items.colors.items||[]},d.getColorScaleStyle=function(a){var b=Math.min(Math.max(a.startLimit.value,0),1),c=Math.max(Math.min(a.endLimit.value-a.startLimit.value,1-b),0);return{position:"absolute",backgroundColor:k(a.pickerModel.color),color:"#000000"===k(a.pickerModel.color)?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.3)",width:100*c+"%",left:100*b+"%",border:"1px solid #dcdcdd"}},d.getColorBackgroundStyle=function(a,b){var c=a[b].startLimit,d=a[b].endLimit,e=[];return c.gradient&&e.push(new f(k(a[b-1].pickerModel.color)).blend(new f(k(a[b].pickerModel.color)),.5)),e.push(k(a[b].pickerModel.color)),d.gradient&&a[b+1]&&e.push(new f(k(a[b+1].pickerModel.color)).blend(new f(k(a[b].pickerModel.color)),.5)),o(e,c.gradient||d.gradient)},d.getSortedSegments=function(){var a,b,c,e,f,g=d.sortedSegments?d.sortedSegments:[],h=d.layoutLimits.concat().sort(function(a,b){return a.value-b.value}),i=d.layoutColors,j=u,k=t,l={value:0,gradient:!1};for(f=0;f<i.length;f++)b=h[f]?{value:(h[f].value-k)/(j-k),gradient:h[f].gradient}:{value:1,gradient:!1},c=i[f].color,e=i[f].icon,g[f]?(a=g[f],a.startLimit=l,a.endLimit=b):(a={startLimit:l,endLimit:b,pickerModel:{color:c,icon:e}},g.push(a)),l=b;return g},d.onGlyphOrColorChange=function(){d.colors=d.sortedSegments.map(function(a){return{color:a.pickerModel.color,icon:a.pickerModel.icon}}),d.$emit("saveProperties")},d.closeColorpickerFoldout=function(a){d.onGlyphOrColorChange(),i(a.target).closest(".color-scale-container").length&&b.preventGestures()},d.$on("layoutchanged",function(){m(),(d.nrSegmentsChanged||d.limits.length!==d.layoutLimits.length)&&(d.nrSegmentsInLayoutChanged=!0),p()}),d.addLimit=function(a){var b,c,f=d.colors[d.colors.length-1].color===A[0]?A[1]:A[0],g=d.layoutLimits,h=function(a){for(var b=0;a>1;)b++,a/=10;return b};g.length+1>=d.maxSegments||(b=g.length>0?(g[g.length-1].value+u)/2:(u+t)/2,c=1e3/Math.pow(10,h(b)),b=Math.round(b*c)/c,d.limits.push({value:b,gradient:!1}),d.colors.push({color:f}),d.nrSegmentsChanged=!0,e(function(){l.find(".limitInput").focus()}),d.$emit("saveProperties"),a.preventDefault())},d.removeLimit=function(a){d.limits.splice(a,1),d.layoutLimits.splice(a,1),d.colors.splice(a+1,1),d.sortedSegments.splice(a+1,1),d.nrSegmentsChanged=!0,d.$emit("saveProperties")},d.addDisabled=function(a){return a.length+1>=d.maxSegments},d.initializeSlider=function(){d.sliderCreated&&z.slider("destroy"),d.sliderOptions.values=d.layoutLimits.map(function(a){return a.value}),z.slider(d.sliderOptions)},d.checkSliderVisiblility=function(){v=d.layoutLimits,(v.length>0&&z.hasClass("notVisible")||v.length<1&&!z.hasClass("notVisible"))&&z.toggleClass("notVisible")},e(function(){p()})}]}}),define("text!client.property-panel/components/sorting-dimension/sorting-dimension.ng.html",[],function(){return'<div class="" style="position:relative; height: 100%;" tcl="sorting">\n	<div class="pp-component pp-dropdown-component" ng-if="show() && isGroup()" tcl="dropdown">\n		<div class="label" ng-if="label">{{label}}</div>\n\n		<div class="value">\n			<qui-select qui-model="dropdown.activeIndex" qui-disabled="readOnly"\n						qui-options="option.value as option.label for option in dropdown.options" qui-tid="{{key}}">\n			</qui-select>\n		</div>\n	</div>\n\n	<div class="separator"></div>\n\n	<div ng-if="show()" include-pp-component x-component="item.component" x-definition="item.definition" x-data="item.data" x-args="item.args"></div>\n</div>'}),define("client.property-panel/components/sorting-dimension/sorting-dimension",["client.property-panel/components/components","general.utils/property-resolver","text!client.property-panel/components/sorting-dimension/sorting-dimension.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(c){function d(){var a=c.definition.ref;return a?b.getValue(c.data,a):c.data}function e(){var a=[],b=d().qDef.cId,e=c.args.handler.getDimensionLayout(b);e&&"H"===e.qGrouping&&e.qGroupFallbackTitles.forEach(function(b,c){a.push({value:c,label:b})}),c.dropdown.options=a}function f(a,b){for(var c=0;b>=c;c++)a[c]||(a[c]={})}function g(){c.dropdown.activeIndex>=c.dropdown.options.length&&(c.dropdown.activeIndex=0),f(d().qDef.qSortCriterias,c.dropdown.activeIndex),c.item.data=d().qDef.qSortCriterias[c.dropdown.activeIndex]}var h=c.args.cache,i="sorting_dimension_";c.dropdown={activeIndex:h.get(i+d().qDef.cId)||0,options:[]},c.show=function(){var a=d();return!a.qDef.autoSort},c.isGroup=function(){var a=d();if(!a.qLibraryId)return!1;var b=a.qDef.cId,e=c.args.handler.getDimensionLayout(b);return e&&"H"===e.qGrouping},c.item={component:a.getComponent("items"),definition:c.definition.items.dimensionDefinition,args:c.args},c.$watch("dropdown.activeIndex",function(a){h.put(i+d().qDef.cId,a),e(),g()}),c.$on("datachanged",function(){g()}),c.$watch("data",function(){g()})}]};return d}),define("text!client.property-panel/components/text/text.ng.html",[],function(){return'<div class="pp-component pp-text-component" ng-if="visible" tcl="text">\r\n	<div ng-class="style" tid="{{key}}">{{label}}</div>\r\n</div>'}),define("client.property-panel/components/text/text",["client.property-panel/component-utils","text!./text.ng.html"],function(a,b){var c={template:b,controller:["$scope",function(b){var c=function(){return b.data};a.defineLabel(b,b.definition,c,b.args.handler),a.defineVisible(b,b.args.handler),a.defineCustom(b,b.args.handler,"style"),b.style||(b.style="message")}]};return c}),define("text!client.property-panel/components/textarea/textarea.ng.html",[],function(){return'<div class="pp-component pp-textarea-component" ng-if="visible" tcl="textarea">\r\n	<div class="label" ng-if="label">{{label}}</div>\r\n\r\n	<div class="value"ng-if="!isExpressionDefinition">\r\n		<textarea type="text" maxlength="{{definition.maxlength || 255}}" rows="{{definition.rows || 3}}" class="simple-textarea qui-textarea"\r\n			ng-model="value" ng-class="{ \'qui-invalid\': invalid, \'qui-input\': !isExpressionDefinition }" ng-disabled="readOnly" ng-change="change()" ng-readonly="isExpression"\r\n			pp-model-onblur pp-input-validator tid="{{key}}">\r\n		</textarea>\r\n	</div>\r\n\r\n	<div class="value" ng-if="isExpressionDefinition" ng-class="{ \'qui-inputwithicon\': isExpressionDefinition }">\r\n		<div class="wrapper qui-textarea" ng-class="{\'qui-invalid\': invalid, \'qui-active\': active, \'qui-disabled\': readOnly}">\r\n			<div class="textarea-wrapper">\r\n				<textarea type="text" maxlength="{{definition.maxlength || 255}}" rows="{{definition.rows || 3}}" class="wrapped-textarea"\r\n						  ng-model="value" ng-change="change()" ng-readonly="readOnly" ng-focus="focused()" ng-blur="blurred()"\r\n						  pp-model-onblur pp-input-validator expression-type="{{definition.expressionType}}" tid="{{key}}">\r\n				</textarea>\r\n			</div>\r\n\r\n			<i class="icon-expression edit-expression active" ng-show="isExpressionDefinition && !readOnly"\r\n			   pp-expression-editor="value" expression-type="{{definition.expressionType}}"\r\n			   q-title-translation="Tooltip.AddExpression"></i>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("client.property-panel/components/textarea/textarea",["client.property-panel/component-utils","text!./textarea.ng.html"],function(a,b){var c={template:b,controller:["$scope",function(b){var c=function(){return b.data};b.isExpressionDefinition="optional"===b.definition.expression||!!b.definition.expressionType,a.defineLabel(b,b.definition,c,b.args.handler),a.defineVisible(b,b.args.handler),a.defineReadOnly(b,b.args.handler),a.defineChange(b,b.args.handler),a.defineValue(b,b.definition,c),b.focused=function(){b.active=!0},b.blurred=function(){b.active=!1}}]};return c}),define("client.property-panel/components/dimension-dropdown/dimension-dropdown",["client.property-panel/component-utils","translator","text!../dropdown/dropdown.ng.html"],function(a,b,c){var d={template:c,controller:["$scope",function(c){function d(){var a=c.value,d=c.options.some(function(b){return b.value===a});d||c.options.splice(0,0,{value:a,label:b.get("properties.selectValue")})}function e(){var a,b,e,f,g=c.args.handler.getDimensions();for(c.options.splice(0,c.options.length),f=0;f<g.length;++f)a=g[f],e=a.qDef.cId,b=c.args.handler.getDimensionLayout(e),a.qLibraryId&&b&&!b.qError?a.qError||c.options.push({value:e,label:b.title}):c.options.push({value:e,label:b&&b.qFallbackTitle||""});d()}var f=function(){return c.data};a.defineLabel(c,c.definition,f,c.args.handler),a.defineVisible(c,c.args.handler),a.defineChange(c,c.args.handler),a.defineReadOnly(c,c.args.handler),a.defineValue(c,c.definition,f),c.options=[],e(),c.$on("layoutchanged",function(){e()})}]};return d}),define("text!client.property-panel/components/media/media.ng.html",[],function(){return'<div class="pp-component pp-media-component" ng-if="visible" tcl="media">\r\n	<div class="label" ng-if="label">{{label}}</div>\r\n	<div class="value">\r\n		<div class="placeholder">\r\n			<button ng-if="!readOnly" class="qui-iconbtOverlay select-icon" data-icon="image" qva-activate="openMediaLibrary(value)"\r\n					q-title-translation="{{tooltip.select}}"></button>\r\n			<img ng-show="value" ng-src="{{mediaUrl}}" />\r\n			<button ng-if="value && !readOnly" class="qui-iconbtOverlaySmall remove-icon" data-icon="abort" q-title-translation="{{tooltip.remove}}"\r\n					qva-activate="save(null)"></button>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("general.models/media-library",["core.models/base-object","util"],function(a,b){function c(a,b,c){var d={name:a,type:b};return c&&(d.path=c),"folder"===b&&(d.children=[]),d}function d(a,b){a=a.substring(1).split("/").reverse().slice(1).reverse();var d=b;return a.forEach(function(a){var b=!1;if(d.children.forEach(function(c){return c.name===a?(d=c,void(b=!0)):void 0}),!b){var e=c(a,"folder");d.children.push(e),d=e}}),d}function e(a){a.sort(function(a,b){return a.name.localeCompare(b.name)}).reverse(),a.sort(function(a,b){return"folder"===a.type&&"folder"!==b.type?-1:"folder"===a.type&&"folder"===b.type?a.name.localeCompare(b.name):"folder"!==a.type&&"folder"!==b.type?a.name.localeCompare(b.name):1}),a.forEach(function(a){"undefined"!=typeof a.children&&e(a.children)})}var f;return f=a.extend("MediaLibrary",{},{listProperties:{qMediaListDef:{}}}),f.addBasePath=function(a){return b.baseURI+".."+a},f.stripBasePath=function(a){return a=a.replace(b.baseURI,"").replace(/^\.\.\//i,"/"),a=a.replace(location.protocol+"//"+location.host,"")},f.createTree=function(a,b){b=(b||[]).join("|")||".+?";var g=c("/","folder"),h=new RegExp("\\.("+b+")$","i");return a.forEach(function(a){var b,e=a.path;if(e=f.stripBasePath(e),b=decodeURIComponent((e+"").replace(/\+/g,"%20")),b=b.split("/").splice(-1)[0],b.match(h)){var i=d(decodeURIComponent(e).replace(/^(\/content\/default)|(\/content\/Default)/,""),g);i.children.push(c(b,"file",e))}}),e(g.children),g},f}),define("text!general.components/media-library/media-library.ng.html",[],function(){return'<qv-modal-dialog qv-id="media-library-modal" qv-cancel="cancel()" qv-confirm="confirm()">\r\n	<main class="dm-main">\r\n		<p ng-if="rootEntry && !rootEntry.children.length" q-translation="MediaLibrary.NoFilesFound" class="no-files-found"></p>\r\n		<div class="entries" ng-if="rootEntry.children.length">\r\n			<ul>\r\n				<li qva-activate="entry.type === \'file\' && selectFile($event, entry.path)"\r\n					ng-class="{selected: selectedFile === entry.path, folder: entry.type === \'folder\', file: entry.type === \'file\'}"\r\n					ng-repeat="entry in rootEntry.children">\r\n					<a title="{{entry.name}}">\r\n						<i ng-if="entry.type === \'folder\'" class="icon-folder"></i>\r\n						<i ng-if="entry.type === \'file\'" class="icon-file"></i>\r\n						{{entry.name}}\r\n					</a>\r\n					<div ng-if="entry.children.length" ng-include="\'media-library-recursive.ng.html\'"></div>\r\n				</li>\r\n			</ul>\r\n		</div>\r\n		<div class="preview" ng-if="rootEntry.children.length">\r\n			<img ng-if="previewFile" ng-src="{{previewFile}}" ng-class="{scale:scaleToFit}" qva-load="positionFile($event)" />\r\n			<p ng-if="!previewFile" q-translation="MediaLibrary.SelectAnImage"></p>\r\n		</div>\r\n	</main>\r\n\r\n	<qv-confirm-cancel-footer qv-confirm="confirm()" qv-cancel="cancel()" qv-confirm-label="Common.Apply" qv-confirm-disabled="!selectedFile"></qv-confirm-cancel-footer>\r\n</qv-modal-dialog>\r\n'}),define("text!general.components/media-library/media-library-recursive.ng.html",[],function(){return'<ul>\r\n	<li qva-activate="entry.type === \'file\' && selectFile($event, entry.path)"\r\n		ng-class="{selected: entry.type === \'file\' && selectedFile === entry.path, folder: entry.type === \'folder\', file: entry.type === \'file\'}"\r\n		ng-repeat="entry in entry.children">\r\n		<a title="{{entry.name}}">\r\n			<i ng-if="entry.type === \'folder\'" class="icon-folder"></i>\r\n			<i ng-if="entry.type === \'file\'" class="icon-file"></i>\r\n			{{entry.name}}\r\n		</a>\r\n		<div ng-if="entry.children.length" ng-include="\'media-library-recursive.ng.html\'"></div>\r\n	</li>\r\n</ul>\r\n'}),define("general.components/media-library/media-library",["jquery","qvangular","general.models/media-library","text!./media-library.ng.html","text!./media-library-recursive.ng.html","general.services/show-service/show-service"],function(a,b,c,d,e,f){function g(a){var b={onCancel:a.onCancel,onConfirm:a.onConfirm,selectedFile:a.selectedFile};f.show(l,b),k.isShown=!0}function h(){if(k.isShown){var b=a('[qv-id="media-library-modal"]');b.length&&b.scope().cancel()}}function i(){return k.isShown}var j=b.getService("$templateCache"),k={isShown:!1};j.put("media-library-recursive.ng.html",e);var l={template:d,controller:["$scope","$element",function(a){a.selectedFile=a.input.selectedFile||null,a.scaleToFit=!0,a.previewFile=a.selectedFile?c.addBasePath(a.selectedFile):null,a.selectFile=function(b,c){b.preventDefault(),b.stopPropagation(),a.selectedFile===c&&(c=null),a.setSelected(c)},a.setSelected=function(b){b=b||null;var d=b?c.addBasePath(b):null;a.selectedFile=b,a.previewFile=d},a.confirm=function(){a.input.onConfirm(a.selectedFile),a.destroyComponent()},a.cancel=function(){a.input.onCancel(),a.destroyComponent()},c.getList().then(function(b){b.getLayout().then(function(b){var d=c.createTree(b,["png","gif","jpg","jpeg","svg"]);a.rootEntry=d})}),a.$on("$destroy",function(){k.isShown=!1})}]};return{show:g,hide:h,isShown:i}}),define("general.services/media-library/media-library",["general.components/media-library/media-library"],function(a){function b(b){a.show(b)}function c(){a.hide()}function d(){return a.isShown()}return{show:b,hide:c,isShown:d}}),define("client.property-panel/components/media/media",["client.property-panel/component-utils","text!./media.ng.html","general.models/media-library","general.services/media-library/media-library"],function(a,b,c,d){var e={template:b,controller:["$scope",function(b){var e=function(){return b.data};a.defineLabel(b,b.definition,e,b.args.handler),a.defineVisible(b,b.args.handler),a.defineReadOnly(b,b.args.handler),a.defineChange(b,b.args.handler),a.defineValue(b,b.definition,e),a.defineCustom(b,b.args.handler,"tooltip"),b.openMediaLibrary=function(a){d.show({onCancel:function(){},onConfirm:function(a){b.save(a)},selectedFile:a})},b.update=function(){var a=b.value;a?(a=c.stripBasePath(a),b.mediaUrl=c.addBasePath(a)):b.mediaUrl=""},b.save=function(a){a?(a=c.stripBasePath(a),a!==b.value&&(b.value=a,b.$emit("saveProperties"))):(b.value=a,b.$emit("saveProperties")),b.update()},b.update(),b.$on("datachanged",function(){b.update()})}]};return e}),define("text!client.property-panel/components/align-matrix/align-matrix.ng.html",[],function(){return'<div class="pp-component pp-align-matrix" ng-if="visible" tcl="align-matrix">\r\n	<div class="label" ng-if="label">{{label}}</div>\r\n	<div class="matrix">\r\n		<div ng-repeat="position in positions">\r\n			<input id="{{name}}-{{$index}}" type="radio" name="{{name}}" value="{{position}}" ng-model="value" ng-change="update()" />\r\n			<label for="{{name}}-{{$index}}"></label>\r\n		</div>\r\n	</div>\r\n</div>'}),define("client.property-panel/components/align-matrix/align-matrix",["client.property-panel/component-utils","text!./align-matrix.ng.html"],function(a,b){var c={template:b,controller:["$scope",function(b){var c=function(){return b.data};a.defineLabel(b,b.definition,c,b.args.handler),a.defineVisible(b,b.args.handler),a.defineReadOnly(b,b.args.handler),a.defineChange(b,b.args.handler),a.defineValue(b,b.definition,c),b.name="unique"+ +new Date,b.positions=["topLeft","centerLeft","bottomLeft","topCenter","centerCenter","bottomCenter","topRight","centerRight","bottomRight"],b.update=function(){b.$emit("saveProperties")}}]};return c}),define("client.property-panel/components/number-formatter-dropdown/number-formatter-dropdown",["client.property-panel/component-utils","text!client.property-panel/components/dropdown/dropdown.ng.html","objects.utils/number-formatter","objects.utils/date-formatter","general.utils/property-resolver"],function(a,b,c,d,e){function f(a,b,f,g,h,i){var j,n,o,p={};j=b.concat(a.options||[]).filter(function(a){return a.fmt in p?!1:(p[a.fmt]=!0,!0)}),j=j.map(function(a){var b,e,h;switch(a.type){case"D":h=new d(i,"","","","D"),e=m;break;case"M":h=new c(i,"","","","M"),e=k;break;default:h=new c(i,"","","","F"),e=/%$/.test(a.fmt)?l:k}return a.label?b="function"==typeof a.label?a.label.call(null,f,g,i):a.label:(b=h.format(e,a.fmt,a.thousand,a.decimal),a.fmt.indexOf(";")>=0&&(b+="; "+h.format(-e,a.fmt,a.thousand,a.decimal))),{value:a.fmt,label:b,type:a.type}}),n=[e.getValue(f,"qDef.qNumFormat.qType","F")],j=j.filter(function(a){return n.contains(a.type)}),h.splice(0,h.length);for(o=0;o<j.length;++o)h.push(j[o]);return j}function g(a,b){var c=[];a.qDateFmt&&c.push({fmt:a.qDateFmt}),c.push({fmt:"YYYY-MM-DD"}),c.push({fmt:"DD MM YYYY"}),c.push({fmt:"DD MMM YYYY"}),c.push({fmt:"DD MMMM YYYY"}),c.push({fmt:"MM/DD/YYYY"}),c.push({fmt:"MMMM DD, YYYY"}),a.qTimestampFmt&&c.push({fmt:a.qTimestampFmt}),c.push({fmt:"YYYY-MM-DD hh:mm:ss[.fff]"}),a.qTimeFmt&&c.push({fmt:a.qTimeFmt}),c.push({fmt:"hh:mm:ss"}),c.push({fmt:"h:mm:ss tt"}),c.forEach(function(a){a.type="D",b.push(a)})}function h(a,b){var c=[];a.qMoneyFmt&&c.push({fmt:a.qMoneyFmt,type:"M"}),c.forEach(function(c){c.decimal=a.qMoneyDecimalSep,c.thousand=a.qMoneyThousandSep,b.push(c)
})}function i(a,b){var c=[],d=a.qThousandSep,e=a.qDecimalSep||".";a.qThousandSep?(c.push({fmt:"#"+d+"##0"}),c.push({fmt:"#"+d+"##0"+e+"0"}),c.push({fmt:"#"+d+"##0"+e+"00"})):(c.push({fmt:"0"}),c.push({fmt:"0"+e+"0"}),c.push({fmt:"0"+e+"00"})),c.push({fmt:"0%"}),c.push({fmt:"0"+e+"0%"}),c.push({fmt:"0"+e+"00%"}),c.forEach(function(a){a.decimal=e,a.thousand=d,a.type="F",b.push(a)})}function j(a,b){i(a,b),h(a,b),g(a,b)}var k=1000.12,l=.1234,m=new Date(2014,1,17,15,30,40),n={template:b,controller:["$scope",function(b){var c=function(){return b.data},d=[];a.defineLabel(b,b.definition,c,b.args.handler),a.defineVisible(b,b.args.handler),a.defineChange(b,b.args.handler),a.defineReadOnly(b,b.args.handler),a.defineValue(b,b.definition,c),b.options=[],j(b.args.localeInfo,d),f(b.definition,d,b.data,b.args.handler,b.options,b.args.localeInfo),b.$on("datachanged",function(){f(b.definition,d,b.data,b.args.handler,b.options,b.args.localeInfo)})}]};return n}),define("text!client.property-panel/components/number-formatter/number-formatter.ng.html",[],function(){return'<div class="pp-component pp-string-component" ng-if="visible" tcl="string">\r\n	<div class="label" ng-if="label">{{label}}</div>\r\n\r\n	<div class="value">\r\n		<input type="text" class="qui-input" maxlength="{{definition.maxlength || 255}}" tid="{{key}}"\r\n			   ng-model="value" ng-class="{ \'qui-invalid\': invalid }" ng-disabled="readOnly" ng-change="change()"\r\n			   pp-model-onblur pp-model-onkeyup pp-input-validator/>\r\n\r\n	</div>\r\n</div>\r\n<div class="pp-component pp-number-formatter-component">\r\n	<div class="label">{{example_title}}</div>\r\n	<div class="value">{{example}}</div>\r\n</div>\r\n<button class="qui-outlinebutton pp-add-property" qva-activate="reset()" qv-enter="reset()" ng-disabled="isDefaultFormat || resetting"\r\n        ng-show="showReset" q-translation="{{definition.resetTranslation}}"></button>'}),define("client.property-panel/components/number-formatter/number-formatter",["client.property-panel/component-utils","text!./number-formatter.ng.html","translator","objects.utils/number-formatter","objects.utils/date-formatter","general.utils/number-formatting"],function(a,b,c,d,e,f){function g(a,b){var c,d,e,f;switch(a.qDef.qNumFormat.qType){case"D":case"T":case"TS":f=k,c=p;break;case"IV":f=l,c=q;break;case"M":f=m,c=o;break;case"R":e=a.qDef.qNumFormat.qDec||".",d=a.qDef.qNumFormat.qThou;default:f=n,c=o}return f.format(c,"undefined"!=typeof b?b:a.qDef.qNumFormat.qFmt,d,e)}function h(a,b){a.qDef.qNumFormat.qFmt=f.getDefaultNumericFormat(a.qDef.qNumFormat,b)}function i(a,b,c){return a===f.getDefaultNumericFormat(b.qDef.qNumFormat,c)}var j,k,l,m,n,o=1000.12,p=new Date(2014,1,17,15,30,40),q=1.0453718171296298;return j={template:b,controller:["$scope",function(b){function f(){b.example=g(b.data),b.resetting=!1,b.isDefaultFormat=i(b.data.qDef.qNumFormat.qFmt,b.data,b.args.localeInfo),b.showReset="R"===b.data.qDef.qNumFormat.qType}var j=function(){return b.data},o=b.args.localeInfo;k=new e(o,"","","","D"),l=new e(o,"","","","IV"),m=new d(o,"","","","M"),n=new d(o,"","","","F"),a.defineLabel(b,b.definition,j,b.args.handler),a.defineVisible(b,b.args.handler),a.defineReadOnly(b,b.args.handler),a.defineChange(b,b.args.handler),a.defineValue(b,b.definition,j),m.thousandDelimiter=b.args.localeInfo.qMoneyThousandSep||"",m.decimalDelimiter=b.args.localeInfo.qMoneyDecimalSep||".",l.pattern=b.args.localeInfo.qTimeFmt,n.thousandDelimiter=b.args.localeInfo.qThousandSep||"",n.decimalDelimiter=b.args.localeInfo.qDecimalSep||".",b.onkeyup=function(a){b.$apply(function(){b.example=g(b.data,a[0].value)})},b.example_title=c.get("properties.numberFormatting.example"),b.reset=function(){b.resetting||(h(b.data,b.args.localeInfo),b.resetting=!0,b.$emit("saveProperties"))},b.$watch("data",function(){f()}),b.$on("datachanged",function(){f()}),f()}]}}),define("text!client.property-panel/components/tags/tags.ng.html",[],function(){return'<div class="pp-component pp-string-component pp-tags-component" ng-if="visible" tcl="tags">\r\n	<div class="label" ng-if="label">{{label}}</div>\r\n	<div class="tagcloudContainer">\r\n		<qv-tagcloud tags="value" on-change="change()"></qv-tagcloud>\r\n	</div>\r\n</div>\r\n'}),define("text!client.views/tagcloud/tagcloud.ng.html",[],function(){return'<div class="qv-cloud">\r\n	<div class="qv-tageditor">\r\n		<div class="qui-inputwithicon">\r\n			<input ng-model="tagInput" class="qv-tagText" type="text" maxlength="31">\r\n            <i class="icon icon-expand" q-title-translation="Tooltip.AddTag" qva-activate="addTagsAndFocus( $event )"></i>\r\n		</div>\r\n	</div>\r\n	<div class="qv-tagCloud" data-value="tags">\r\n		<span ng-repeat="tag in tags" class="qv-tagItem qui-tag">\r\n			<div class="qv-tagContent">{{tag}}</div>\r\n            <div class="icon icon-trash qv-clearTag" qva-activate="removeTagAt( $index )" q-title-translation="Common.Delete"></div>\r\n		</span>\r\n	</div>\r\n</div>\r\n'}),define("client.views/tagcloud/tagcloud",["assets/qvangular/qvangular-core","text!./tagcloud.ng.html"],function(a,b){var c=30;a.directive("qvTagcloud",["$parse",function(a){return{template:b,replace:!0,restrict:"E",scope:{tags:"=",onChange:"&"},link:function(b,d,e){function f(a){var d=b.tags;a=a.trim(),!a||-1!==d.indexOf(a)||d.length>=c||d.push(a)}b.tagInput="";var g=d.find(".qv-tagText");g.bind("blur",function(){b.$apply(function(){b.addTags()})}),g.bind("keydown",function(a){13===a.which&&(a.stopPropagation(),b.$apply(function(){b.addTags()}))}),b.removeTagAt=function(a){b.tags.splice(a,1),b.onChange()},b.addTags=function(){var a=b.tagInput;if(a){b.tagInput="";var c=a.trim().split(",");c.forEach(f),b.tags.sort(function(a,b){return a.localeCompare(b)}),b.onChange()}},b.addTagsAndFocus=function(a){a.preventDefault(),b.addTags(),g.focus()};var h=a(e.update);h.assign&&h.assign(b.$parent,b.addTags)}}}])}),define("client.property-panel/components/tags/tags",["client.property-panel/component-utils","text!./tags.ng.html","client.views/tagcloud/tagcloud"],function(a,b){var c={template:b,controller:["$scope",function(b){var c=function(){return b.data};a.defineLabel(b,b.definition,c,b.args.handler),a.defineVisible(b,b.args.handler),a.defineChange(b,c,b.args.handler),a.defineValue(b,b.definition,c)}]};return c}),define("client.views/app-overview/app-overview-functions",[],function(){function a(a,b){return a.qData.rank-b.qData.rank}function b(a,b,c){b.aoItems.init(b.models,b.AppOverviewState),a.is.sheet?(a.translations.navigatorHeader="Common.Sheets",c(a,"sheet")&&b.aoItems.initSheet(a,b.commonFunctions.sortArrayByRank)):a.is.story?(a.translations.navigatorHeader="Common.Stories",c(a,"story")&&b.aoItems.initStories(a,b.commonFunctions.sortArrayByRank)):a.is.bookmark&&(a.translations.navigatorHeader="Common.Bookmarks")}function c(a,b){var c=!1;return"sheet"===b?c=!a.approvedSheets.length&&!a.privateSheets.length:"story"===b&&(c=!a.approvedStories.length&&!a.privateStories.length),c}function d(a){a.translations.addNew=a.is.sheet?"AppOverview.Toolbar.CreateNewSheet":"AppOverview.Toolbar.CreateNewStory",a.translations.navigatorHeader=a.is.sheet?"Common.Sheets":"Common.Stories",a.translations.approvedHeader=a.is.sheet?"AppOverview.Content.ApprovedSheets":"AppOverview.Content.ApprovedStories",a.translations.myWorkHeader=a.is.sheet?"AppOverview.Content.MySheets":"AppOverview.Content.MyStories",a.translations.myPublishedHeader=a.is.sheet?"AppOverview.Content.MyPublishedSheets":"AppOverview.Content.MyPublishedStories",a.translations.communityHeader=a.is.sheet?"AppOverview.Content.CommunitySheets":"AppOverview.Content.CommunityStories"}function e(a,b){a.shownav=!0,a.navigationmode=b.navigationMode,a.hasData=!0,a.addingItem=!1,a.is={},a.exp={},a.funcs={},a.translations={},a.sections={approved:{sheets:{expand:b.Sections.approvedSheets},stories:{expand:b.Sections.approvedStories}},myPublished:{sheets:{expand:b.Sections.myPublishedSheets},stories:{expand:b.Sections.myPublishedStories}},myPrivate:{sheets:{expand:b.Sections.privateSheets},stories:{expand:b.Sections.privateStories}},community:{sheets:{expand:b.Sections.communitySheets},stories:{expand:b.Sections.communityStories}}},a.is.smallAppView=!1,a.is.appReadOnly=!1,a.is.grid=b.viewMode===b.ViewMode.grid,a.is.navigator=!1,a.is.smalldevice=!1,a.is.sheet="sheet"===b.navigationMode,a.is.story="story"===b.navigationMode,a.is.bookmark="bookmark"===b.navigationMode,d(a),a.exp.readonly=!1,a.exp.sections=[],a.exp.isAscending=!0,a.exp.hasBookmarks=!1,a.exp.canCreateBookmark=!1,a.exp.showBookmarkSearch=!1,a.approvedSheets=[],a.privateSheets=[],a.myPublishedSheets=[],a.communitySheets=[],a.approvedStories=[],a.privateStories=[],a.myPublishedStories=[],a.communityStories=[]}function f(a,b,c){b.AppOverviewState.setAddingItem(!1),b.AppOverviewState.setDuplicatingItem(!1),a.is.sheet=c===b.AppOverviewState.NavigationMode.sheet,a.is.story=c===b.AppOverviewState.NavigationMode.story,a.is.bookmark=c===b.AppOverviewState.NavigationMode.bookmark,d(a)}function g(a,b,c){var d=a.sort(function(a,c){return b&&(a=a.qMeta[b],c=c.qMeta[b]),a.localeCompare(c)});return c?d.reverse():d}function h(a,b,c){var d=a.sort(function(a,c){if(b){var d=new Date(a.qMeta[b]),e=new Date(c.qMeta[b]);return e>d?1:d>e?-1:0}});return c?d.reverse():d}function i(a,b){var c=new Date(a.qMeta.publishTime),d=new Date(b.qMeta.publishTime);return d>c?1:c>d?-1:0}function j(a,b){return a.qData.rank-b.qData.rank}function k(a){return function(b,c){return 0===a?(b=b.qMeta.title,c=c.qMeta.title,b.localeCompare(c)):i(b,c)}}function l(a){return!a.qMeta.published&&!a.qMeta.approved}function m(a){return a.qMeta.approved}function n(a){return function(b){return b.qMeta.published&&!b.qMeta.approved&&b.qMeta.owner.userId===a.userId}}function o(a){return function(b){return b.qMeta.published&&!b.qMeta.approved&&b.qMeta.owner.userId!==a.userId}}var p={alphabetical:0,publishedDate:1};return{sortArrayByRank:a,setNewAppOverViewMode:b,hasToGet:c,setDefaultScopeVar:e,setNewScopeValOnNavigationChange:f,SortFilterOptions:p,sortAlphabetically:g,sortByPublishedDate:h,sortPublishedTime:i,sortByRank:j,sortCommunity:k,filterPrivate:l,filterApproved:m,filterMyPublished:n,filterCommunity:o}}),define("client.models/sheet",["jquery","core.models/generic-object","general.utils/visualizations","util","core.utils/deferred"],function(a,b,c,d,e){function f(a,b){var c,d;for(c=0;c<a.cells.length;++c)if(d=a.cells[c],d.col===b.col&&d.row===b.row)return c;return-1}function g(a,b,c){var d=f(a,b);if(-1===d){if(c)return null;throw new Error("invalid pos")}return a.cells[d]}function h(a,b){a.col=b.col,a.row=b.row,a.colspan=b.colspan,a.rowspan=b.rowspan}function i(a,b,c,d){var e=g(a,b,!0),f=e?e.name:null;return e?(e.name=c,e.type=d):a.cells.push({name:c,type:d,col:b.col,row:b.row,colspan:b.colspan,rowspan:b.rowspan}),f}function j(a,b){var c={col:a.col,row:a.row,colspan:a.colspan,rowspan:a.rowspan},d={col:a.col,row:a.row,colspan:a.colspan,rowspan:a.rowspan};if("left"===b||"right"===b){var e=Math.ceil(a.colspan/2);c.colspan-=e,d.col+=a.colspan-e,d.colspan=e}if("top"===b||"bottom"===b){var f=Math.ceil(a.rowspan/2);c.rowspan-=f,d.row+=a.rowspan-f,d.rowspan=f}if("top"===b||"left"===b){var g=c;c=d,d=g}return{pos1:c,pos2:d}}function k(a,b,c){var d=g(a,b,!1);if(!d||d.colspan!==b.colspan||d.rowspan!==b.rowspan)return!1;var e=j(d,c);return h(d,e.pos1),e.pos2}function l(a,b){return b.filter(function(b){return b.name===a})[0]}function m(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.qInfo.qId=d.generateId(),a.qChildren.push({qChildren:[],qProperty:e})}}var n;return n=b.extend("Sheet",{edit:function(a){var b=this;return b.getProperties().then(function(c){return a(c),b.save()})},getObject:function(a,b){return this.getLayout().then(function(c){return g(c,a,b)})},moveObject:function(a,b){return this.edit(function(c){var d=g(c,a);return b.split&&(b=k(c,b.pos,b.split),!b)?e.reject():void h(d,b)})},swapObjects:function(a,b){return this.edit(function(c){var d=g(c,a),e=g(c,b,!0);h(d,b),e&&h(e,a)})},addObject:function(a){var b,f=this,g=a.template,h=a.cell.pos,j=c.getType(g),l=a.init,n=a.children||[];return b=l.qExtendsId?e.resolve(d.extend({qInfo:{qType:g}},l)):j.getInitialProperties(l),e.all({initProps:b,props:f.getFullPropertyTree()}).then(function(a){var b=a.initProps,c=a.props;if(h.split&&(h=k(c.qProperty,h.pos,h.split),!h))return e.reject();b.qInfo.qId=d.generateId();var g=i(c.qProperty,h,b.qInfo.qId,b.qInfo.qType);if(g){for(var j=0;j<c.qChildren.length;j++)if(c.qChildren[j].qProperty.qInfo.qId===g){c.qChildren[j].qProperty=b,c.qChildren[j].qChildren=[],m(c.qChildren[j],n);break}}else{var l=c.qChildren.push({qChildren:[],qProperty:b});m(c.qChildren[l-1],n)}return f.saveTree()})},getObjectById:function(a){var b,c,d=this.layout.cells;for(b=0;b<d.length;++b)if(c=d[b],a===c.name)return c;return null},removeObject:function(a){var b=this;return b.getProperties().then(function(c){var d=f(c,a),e=c.cells[d].name;if(-1===d)throw new Error("invalid pos");c.cells.splice(d,1),b.removeChild(e,c)})},setCloneChildrenInfos:function(a){var b=this;return e.all([b.getChildInfos(),a.getChildInfos(),a.getProperties()]).then(function(b){var c=b[0],d=b[1],e=b[2];return c.forEach(function(a,b){var c=l(a.qId,e.cells);c&&(c.name=d[b].qId)}),a.save().then(function(){return a})})},clone:function(){var a=this;return this._super().then(function(b){return a.setCloneChildrenInfos(b)})},draft:function(a){var b=this;return a.rpc("CreateDraft","qDraftId",[this.id]).then(function(a){return n.get(a).then(function(a){return b.setCloneChildrenInfos(a)})})}},{listProperties:{qAppObjectListDef:{qType:"sheet",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}}}),n.create=function(c,d){var e={version:.96,qMetaDef:{title:"",description:""},rank:-1,columns:24,rows:12,cells:[]};return b.create.call(n,a.extend(!0,e,c),d)},n.splitPos=j,n}),define("text!storytelling.views/sheet/sheet-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="storytelling-sheet-dialog">\r\n	<header class="dm-header" q-translation="{{title}}"></header>\r\n	<main class="dm-main ">\r\n\r\n		<div class="qv-sheet-in-story-container">\r\n			<div class="av-container qv-sheet-in-story-overflow">\r\n\r\n				<!-- Approved Header -->\r\n				<h1 class="header approved"\r\n					ng-if="isSheet && sheets.approvedSheets.length">\r\n\r\n					<span class="section-title noArrow"\r\n						  q-translation="AppOverview.Content.ApprovedSheets"></span>\r\n				</h1>\r\n				<!-- Approved Sheets -->\r\n				<ul class="qv-approved qvGrid"\r\n					ng-if="isSheet">\r\n					<li class="av-li"\r\n						ng-repeat="item in sheets.approvedSheets track by item.qInfo.qId">\r\n\r\n						<div class="qv-item"\r\n							 qva-activate="sheetClicked(item)">\r\n							<div class="qv-item-thumb">\r\n								<div qv-ao-thumb item="item" issheet="isSheet" thumbprop="item.qData"></div>\r\n							</div>\r\n							<div class="qv-item-info">\r\n								<div class="grid-title">{{item.qData.title}}</div>\r\n							</div>\r\n						</div>\r\n					</li>\r\n				</ul>\r\n\r\n\r\n				<!-- My Published Header -->\r\n				<div class="section-line my-published" ng-if="sheets.myPublishedSheets.length"></div>\r\n				<h1 class="header my-published" ng-if="isSheet && sheets.myPublishedSheets.length">\r\n					<span class="section-title" q-translation="AppOverview.Content.MyPublishedSheets"></span>\r\n				</h1>\r\n				<!-- My Published Sheets -->\r\n				<ul class="qv-my-published qvGrid"\r\n					ng-if="isSheet">\r\n					<li class="av-li"\r\n						ng-repeat="item in sheets.myPublishedSheets track by item.qInfo.qId">\r\n\r\n						<div class="qv-item"\r\n							 qva-activate="sheetClicked(item)">\r\n							<div class="qv-item-thumb">\r\n								<div qv-ao-thumb item="item" issheet="isSheet" thumbprop="item.qData"></div>\r\n							</div>\r\n							<div class="qv-item-info">\r\n								<div class="grid-title">{{item.qData.title}}</div>\r\n							</div>\r\n						</div>\r\n					</li>\r\n				</ul>\r\n\r\n\r\n				<!-- Private Header -->\r\n				<div class="section-line private" ng-if="sheets.privateSheets.length && !isDesktop"></div>\r\n				<h1 class="header private" ng-if="isSheet && sheets.privateSheets.length && !isDesktop">\r\n					<span class="section-title" q-translation="AppOverview.Content.MySheets">My Sheets</span>\r\n				</h1>\r\n				<!-- Private Sheets -->\r\n				<ul class="qv-private qvGrid"\r\n					ng-if="isSheet">\r\n					<li class="av-li"\r\n						ng-repeat="item in sheets.privateSheets track by item.qInfo.qId">\r\n\r\n						<div class="qv-item"\r\n							 qva-activate="sheetClicked(item)">\r\n							<div class="qv-item-thumb">\r\n								<div qv-ao-thumb item="item" issheet="isSheet" thumbprop="item.qData"></div>\r\n							</div>\r\n							<div class="qv-item-info">\r\n								<div class="grid-title">{{item.qData.title}}</div>\r\n							</div>\r\n						</div>\r\n					</li>\r\n				</ul>\r\n\r\n				<!-- Community Header -->\r\n				<div class="section-line community" ng-if="sheets.communitySheets.length"></div>\r\n				<h1 class="header community" ng-if="isSheet && sheets.communitySheets.length">\r\n					<span class="section-title" q-translation="AppOverview.Content.CommunitySheets"></span>\r\n				</h1>\r\n				<!-- Community Sheets -->\r\n				<ul class="qv-community qvGrid"\r\n					ng-if="isSheet">\r\n					<li class="av-li"\r\n						ng-repeat="item in sheets.communitySheets track by item.qInfo.qId">\r\n\r\n						<div class="qv-item"\r\n							 qva-activate="sheetClicked(item)">\r\n							<div class="qv-item-thumb">\r\n								<div qv-ao-thumb item="item" issheet="isSheet"></div>\r\n							</div>\r\n							<div class="qv-item-info">\r\n								<div class="grid-title">{{item.qData.title}}</div>\r\n							</div>\r\n						</div>\r\n					</li>\r\n				</ul>\r\n\r\n			</div>\r\n		</div>\r\n	</main>\r\n	<footer class="dm-footer">\r\n		<qui-button qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Cancel" tid="2f2a4f"></qui-button>\r\n	</footer>\r\n</qv-modal-dialog>\r\n'}),define("storytelling.views/sheet/directives/sheet-dialog",["qvangular","text!storytelling.views/sheet/sheet-dialog.ng.html","general.services/show-service/show-service","general.utils/responsive-state","assets/client/dialogs/directives/dialog-directives"],function(a,b,c,d){function e(a){var b={title:a.title,sheets:a.sheets,selectSheet:a.selectSheet,isSheet:!0,isGrid:!0,confirmDisabled:!0};return c.show(f,b)}var f={scope:{title:"=",sheets:"=",isSheet:"=",isGrid:"=",confirmDisabled:"=",selectSheet:"="},template:b,controller:["$scope",function(b){b.cancel=function(){b.destroyComponent()},b.sheetClicked=function(a){b.selectSheet(a),b.destroyComponent()},b.isSmallDeviceListner=function(){b.destroyComponent()},b.$on("$destroy",function(){d.ViewChanged.unbind(b.isSmallDeviceListner)}),b.isDesktop=a.$rootScope.isPersonalMode,d.ViewChanged.bind(b.isSmallDeviceListner)}]};return{show:e}}),define("text!client.property-panel/components/sheet-dropdown/sheet-dropdown.ng.html",[],function(){return'<div class="pp-component pp-dropdown-component" ng-if="visible" tcl="dropdown">\n    <div class="label" ng-if="label" ng-class="{ \'disabled\': readOnly }">{{label}}</div>\n\n	<div class="value">\n		<div class="qui-select" qui-disabled="readOnly" qui-tid="{{key}}">\n			<div qva-activate="onSelectSheet()" class="select ng-pristine ng-valid" ng-class="{ \'qui-hover\': hover }" ng-mouseenter="hover = true" ng-mouseleave="hover = false" ng-disabled="readOnly" >\n				{{value.title}}\n			</div>\n			<div class="arrow"></div>\n			<div class="border"></div>\n		</div>\n\n	</div>\n</div>\n'}),define("client.property-panel/components/sheet-dropdown/sheet-dropdown",["translator","client.property-panel/component-utils","core.utils/authentication","client.views/app-overview/app-overview-functions","client.models/sheet","storytelling.views/sheet/directives/sheet-dialog","text!./sheet-dropdown.ng.html"],function(a,b,c,d,e,f,g){function h(a,b){return b.forEach(function(b){var c=b.qMeta.published,d=b.qMeta.approved,e=b.qMeta.owner?b.qMeta.owner.userId===k:!1,f=b.qMeta.owner?b.qMeta.owner.userDirectory===l:!1;c&&d?a.approvedSheets.push(b):c&&!d&&e&&f?a.myPublishedSheets.push(b):c?e&&f||a.communitySheets.push(b):a.privateSheets.push(b)}),a}function i(a,b){f.show({title:"Storytelling.Sheet.SelectSheet",sheets:b,selectSheet:function(b){j(a,b.qInfo.qId,b.qData.title)}})}function j(a,b,c){a.value={id:b,title:c},a.$emit("saveProperties")}var k="",l="",m={template:g,controller:["$scope",function(f){var g=function(){return f.data};f.$on("datachanged",function(){f.data.link&&(f.value.id=f.data.link.id,f.value.title=f.data.link.title)}),c.onDataReceived.then(function(a){"NONE"!==a.userDirectory&&(k=a.userId,l=a.userDirectory)}),f.onSelectSheet=function(){e.getListLayout().then(function(a){var b={approvedSheets:[],myPublishedSheets:[],privateSheets:[],communitySheets:[]};b=h(b,a),b.privateSheets.sort(d.sortByRank),d.sortByPublishedDate(b.myPublishedSheets,"publishTime"),i(f,b)})},b.defineLabel(f,f.definition,g,f.args.handler),b.defineVisible(f,f.args.handler),b.defineReadOnly(f,f.args.handler),b.defineValue(f,f.definition,g),f.value&&f.value.id&&""!==f.value.id||(f.value={id:"",title:a.get("properties.selectSheet")})}]};return m}),define("text!client.property-panel/components/common/data-item.ng.html",[],function(){return'<div class="pp-expandable-list-header qv-pp-sortable" qva-activate="expandClicked($event,item)"\r\n	 ng-style="item.style"\r\n	 qva-context-menu="openContextMenu($event, item)"\r\n	 ng-class="{ \'expanded\': item.expanded, \'invalid\': item.isInvalid(), \'disabled\': item.disabled }">\r\n	<i ng-if="item.markerClass" class="pp-header-marker" ng-class="item.markerClass"></i>\r\n	<i class="toggle-expand {{ item.expanded ? \'icon-triangle-bottom\' : \'icon-triangle-right\' }}"></i>\r\n	<span class="text">{{item.title()}}</span>\r\n	<span class="icon icon-handle pp-move-item qv-pp-sortable-handle" q-title-translation="Common.Move"></span>\r\n</div>\r\n<div class="pp-expandable-list-content" ng-if="item.expanded">\r\n	<div include-pp-component x-component="item.component" x-definition="item.definition" x-data="item.data" x-args="item.args"></div>\r\n	<button class="qui-outlinebutton pp-remove-property" qva-activate="removeItem(item)">\r\n		<div q-translation="Common.Delete"></div>\r\n        <div class="icon-bin remove-icon" q-title-translation="Common.Delete"></div>\r\n	</button>\r\n</div>\r\n'}),define("text!client.property-panel/components/common/pseudo-item.ng.html",[],function(){return'<div class="pp-expandable-list-header pseudo qv-pp-sortable">\r\n	<i class="pp-header-marker pp-measure"></i>\r\n	<span class="text" q-translation="Common.Measures"></span>\r\n	<span class="icon icon-handle pp-move-item qv-pp-sortable-handle" q-title-translation="Common.Move"></span>\r\n</div>\r\n'}),define("text!client.property-panel/components/common/empty-data-item.ng.html",[],function(){return'<div class="pp-data-empty-hint">\r\n	<span q-translation="Common.NoData"></span>\r\n</div>'}),define("text!client.property-panel/components/common/sorting-item.ng.html",[],function(){return'<div class="pp-expandable-list-header" qva-activate="expandClicked($event,item);"\r\n	 ng-style="item.style"\r\n	 ng-class="{ \'expanded\': item.expanded, \'invalid\': item.isInvalid(), \'qv-pp-sortable\': item.sortable }">\r\n	<span class="priority" ng-if="item.showPriority">{{item.priority}}</span>\r\n	<i class="toggle-expand {{ item.expanded ? \'icon-triangle-bottom\' : \'icon-triangle-right\' }}"></i>\r\n	<span class="text">{{item.title()}}</span>\r\n	<span class="icon icon-handle pp-move-item qv-pp-sortable-handle" ng-if="item.sortable" q-title-translation="Common.Move"></span>\r\n</div>\r\n<div class="pp-expandable-list-content" ng-if="item.expanded">\r\n	<div include-pp-component x-component="item.component" x-definition="item.definition" x-data="item.data" x-args="item.args"></div>\r\n</div>'}),define("client.property-panel/components/components",["qvangular","core.utils/deferred"],function(a,b){function c(a){var b=a.component;if("string"==typeof b)return h[b];if("object"==typeof b)return b;switch(a.type){case"items":return h.items;case"string":return h.string;case"integer":return h.integer;case"number":return h.number;case"boolean":return h.checkbox;case"array":return a.items?h.list:h.slider;default:return h.items}}function d(a){return h[a]}function e(a,b){if(g){if(h[a])throw"Property panel component already loaded: "+a;h[a]=b}else i[a]=b}function f(){return j?j.promise:(j=new b,require(["client.property-panel/property-panel","client.property-panel/components/accordion/accordion","client.property-panel/components/checkbox/checkbox","client.property-panel/components/dimensions/dimensions","client.property-panel/components/dropdown/dropdown","client.property-panel/components/expression/expression","client.property-panel/components/buttongroup/buttongroup","client.property-panel/components/radiobuttons/radiobuttons","client.property-panel/components/expandable-items/expandable-items","client.property-panel/components/hypercube-data/hypercube-data","client.property-panel/components/hypercube-sorting/hypercube-sorting","client.property-panel/components/inline-dimension/inline-dimension","client.property-panel/components/inline-measure/inline-measure","client.property-panel/components/integer/integer","client.property-panel/components/items/items","client.property-panel/components/link/link","client.property-panel/components/list/list","client.property-panel/components/measures/measures","client.property-panel/components/number/number","client.property-panel/components/slider/slider","client.property-panel/components/string/string","client.property-panel/components/library-item/library-item","client.property-panel/components/item-selection-list/item-selection-list","client.property-panel/components/switch/switch","client.property-panel/components/color-scale-sl/color-scale-sl","client.property-panel/components/image-item-sl/image-item-sl","client.property-panel/components/icon-item-sl/icon-item-sl","client.property-panel/components/color-picker/color-picker","client.property-panel/components/color-scale-creator/color-scale-creator","client.property-panel/components/sorting-dimension/sorting-dimension","client.property-panel/components/text/text","client.property-panel/components/textarea/textarea","client.property-panel/components/dimension-dropdown/dimension-dropdown","client.property-panel/components/media/media","client.property-panel/components/align-matrix/align-matrix","client.property-panel/components/number-formatter-dropdown/number-formatter-dropdown","client.property-panel/components/number-formatter/number-formatter","client.property-panel/components/tags/tags","client.property-panel/components/sheet-dropdown/sheet-dropdown","text!client.property-panel/components/common/data-item.ng.html","text!client.property-panel/components/common/pseudo-item.ng.html","text!client.property-panel/components/common/empty-data-item.ng.html","text!client.property-panel/components/common/sorting-item.ng.html"],function(b,c,d,f,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W){a.$rootScope.$apply(function(){g=!0,e("accordion",c),e("checkbox",d),e("dimensions",f),e("dropdown",k),e("expression",l),e("buttongroup",m),e("radiobuttons",n),e("expandable-items",o),e("hypercube-data",p),e("hypercube-sorting",q),e("sorting",q),e("inline-dimension",r),e("inline-measure",s),e("integer",t),e("items",u),e("link",v),e("list",w),e("measures",x),e("number",y),e("slider",z),e("string",A),e("library-item",B),e("item-selection-list",C),e("switch",D),e("color-scale",E),e("image-item",F),e("icon-item",G),e("color-picker",H),e("color-scale-creator",I),e("sorting-dimension",J),e("text",K),e("textarea",L),e("dimension-dropdown",M),e("media",N),e("align-matrix",O),e("number-formatter-dropdown",P),e("number-formatter",Q),e("tags",R),e("sheet-dropdown",S);var b=a.getService("$templateCache");b.put("pp-data-item.ng.html",T),b.put("pp-pseudo-item.ng.html",U),b.put("pp-empty-data-item.ng.html",V),b.put("pp-sorting-item.ng.html",W),Object.keys(i).forEach(function(a){e(a,i[a])}),i={},j.resolve(h)})}),j.promise)}var g=!1,h={},i={},j=null;return{loadComponents:f,getComponent:d,findComponent:c,addComponent:e}}),define("extensions.qliktech/straight-table/properties/columns/columns-sorting-util",["general.utils/array-util"],function(a){function b(a){function b(a){var b={},c=!1;a.forEach(function(a){b[a]?c=!0:b[a]=!0}),c=c||d.length+e.length!==Object.keys(b).length;var f=[];Object.keys(b).forEach(function(a){f.push(parseInt(a,10))}),f=f.sort();for(var g=0;g<f.length;++g)c=c||f[g]!==g;return c}function c(){for(var a=[],b=0;b<d.length+e.length;b++)a.push(b);return a}var d=a.qDimensions,e=a.qMeasures;b(a.columnOrder)&&(a.columnOrder=c()),b(a.qInterColumnSortOrder)&&(a.qInterColumnSortOrder=c())}function c(c){function d(){for(var b=0;b<k.length;b++)if(k[b]!==b){var c=k[b],d=k.indexOf(b),e=k[d];a.swap(k,b,d),a.swap(g,c,e),a.swap(i,i.indexOf(c),i.indexOf(e)),a.swap(j,j.indexOf(c),j.indexOf(e))}}function e(){for(var b=0;b<l.length;b++)if(l[b]!==b+g.length){var c=l[b],d=l.indexOf(b+g.length),e=l[d];a.swap(l,b,d),a.swap(h,c-g.length,e-g.length),a.swap(i,i.indexOf(c),i.indexOf(e)),a.swap(j,j.indexOf(c),j.indexOf(e))}}b(c);for(var f,g=c.qDimensions,h=c.qMeasures,i=c.columnOrder,j=c.qInterColumnSortOrder,k=[],l=[],m=0;m<i.length;m++)f=i[m],f<g.length?k.push(f):l.push(f);d(),e()}return{validateTableHyperCube:b,fixTableHypercubeOrders:c}}),define("extensions.qliktech/straight-table/properties/columns/columns",["jquery","touche","client.property-panel/components/components","general.utils/support","objects.error-handling/error-translation","translator","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover","client.property-panel/popovers/type-popover","general.components/context-menu/context-menu-service","general.utils/property-resolver","general.services/show-service/show-service","general.sortable/sortable-item-lists","extensions.qliktech/straight-table/properties/columns/columns-sorting-util","text!client.property-panel/components/common/data.ng.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p={template:o,controller:["$scope","$element","$timeout","qvGridObjectDataService",function(o,p,q,r){function s(b){var c=a(b.currentTarget);H=l.show(i,{items:[{tid:"dimension",select:function(){A("dimension",c)},disabled:function(){return o.args.handler.getDimensions().length>=o.args.handler.maxDimensions()},translation:"Common.Dimension"},{tid:"measure",select:function(){A("measure",c)},disabled:function(){return o.args.handler.getMeasures().length>=o.args.handler.maxMeasures()},translation:"Common.Measure"}],closeTypeFoldout:t,alignTo:c})}function t(c){H&&(H.destroy(),H=null),c&&a(c.target).hasClass("pp-toplist-add-button")&&b.preventGestures(),o.addType=null}function u(){var a=k.getValue(o.data,o.definition.sortIndexRef);void 0===a?(a=r.columnOrder.get(o.args.handler.getDimensionLayouts(),o.args.handler.getMeasureLayouts()),k.setValue(o.data,o.definition.sortIndexRef,a),o.$emit("saveProperties")):a.length&&"number"!=typeof a[0]&&(k.setValue(o.data,o.definition.sortIndexRef,a.map(function(a){return a.dataColIx})),o.$emit("saveProperties"))}function v(){u();var a=k.getValue(o.data,o.definition.sortIndexRef),b=o.data.qHyperCubeDef.qDimensions.length;if(o.sortableItemLists.reset(),a.forEach(function(a,c){var d,f,g,h,i;b>a?(f=a,g=o.data.qHyperCubeDef.qDimensions[f],h="dimension",i=g.qDef.cId,d=o.definition.items.dimensions):(f=a-b,g=o.data.qHyperCubeDef.qMeasures[f],i=g.qDef.cId,h="measure",d=o.definition.items.measures);var j=K.createItem({title:function(){var a;if("dimension"===h){var b=o.args.handler.getDimensionLayout(i);a=b&&b.qError?e.getDimensionError(b.qError.qErrorCode,!0):g.qLibraryId?b&&b.title||"":b&&b.qFallbackTitle||""
}else{var c=o.args.handler.getMeasureLayout(g.qDef.cId);a=c&&c.qError?e.getMeasureError(c.qError.qErrorCode,!0):c&&c.qFallbackTitle||""}return a},isInvalid:function(){if("dimension"===h){var a=o.args.handler.getDimensionLayout(i);return a&&!!a.qError}var b=o.args.handler.getMeasureLayout(i);return b&&!!b.qError},component:G,definition:d.items,data:g,args:o.args,id:i,expanded:E.get(F+i)||!1,index:c,type:h,sourceIndex:f,dataColIx:a,templateSrc:"pp-data-item.ng.html",markerClass:"dimension"===h?"pp-dimension":"pp-measure",sortable:o.definition.allowMove!==!1});K.addItem(j)}),K.isEmpty()){var c=K.createItem({id:"empty-item",templateSrc:"pp-empty-data-item.ng.html",index:-1});K.addItem(c)}}function w(a){o.args.handler.addFieldDimension(a.value,"").then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),B(),C()})}function x(a){o.args.handler.addLibraryDimension(a.libraryId).then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),B(),C()})}function y(a){o.args.handler.addLibraryMeasure(a.libraryId).then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),B(),C()})}function z(a){o.args.handler.addExpressionMeasure(a.value,"").then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),B(),C()})}function A(a,b){o.addType=a,t(),D(),"dimension"===a?(I=l.show(g,{alignTo:b,position:"bottom",closeAddPopover:B,addFieldDimension:w,addLibraryDimension:x}),o.adding=!0):I=l.show(h,{alignTo:b,position:"bottom",closeAddPopover:B,addLibraryMeasure:y,addExpressionMeasure:z})}function B(c){I&&(I.destroy(),I=null),c&&a(c.target).hasClass("pp-toplist-add-button")&&b.preventGestures(),o.adding=!1}function C(){q(function(){var a=p.find(".pp-toplist-content"),b=a.find(".pp-data-list").children().last();a[0].scrollTop=b[0].offsetTop-1},100)}function D(){K.items.forEach(function(a){a.expanded=!1,E.put(F+a.id,!1)})}var E=o.args.cache,F="columns_",G=c.getComponent("items");o.expandClicked=function(b,c){c.disabled||a(b.target).hasClass("pp-move-item")||(c.expanded=!c.expanded,E.put(F+c.id,c.expanded))};var H=null,I=null,J=null;o.addClicked=function(a){s(a)},o.hasMultipleAddOptions=function(){return!0},o.getAddLabel=function(){return f.get("properties.columns.add")},o.removeItem=function(a){"dimension"===a.type?o.args.handler.removeDimension(a.sourceIndex).then(function(){o.$emit("saveProperties")}):o.args.handler.removeMeasure(a.sourceIndex).then(function(){o.$emit("saveProperties")})},o.openContextMenu=function(a,b){var c=j.menu();c.addItem({translation:"Common.Delete",tid:"delete",select:function(){o.removeItem(b)}}),J=j.show(c,{position:{x:a.pageX,y:a.pageY},docking:"Top"})},o.$on("pp-open-path",function(a,b){var c=b.split("."),d=c[0],e=c[1];"columns"===d&&e&&(E.put(F+e,!0),C())}),o.add=function(a){a&&a.trim().length&&("measure"===o.addType?z({value:a,label:a}):"dimension"===o.addType&&w({value:a,label:a}))},o.sortableItemLists=m.create({options:{direction:"vertical",listKey:"list",listSelector:".pp-expandable-list",itemKey:"item",itemSelector:".qv-pp-sortable",itemDragSelector:".qv-pp-sortable-handle",gesture:{name:"swipe",options:{radiusThreshold:d.treatAsDesktop()?4:0,preventDefault:!1}}},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.addClass("qv-pp-sortable"),a.templateSrc="pp-data-item.ng.html"},onBegin:function(){this._super.apply(this,arguments),D()},onMove:function(){this._super.apply(this,arguments),o.data.qHyperCubeDef.columnOrder=K.get().filter(function(a){return"empty-item"!==a.id}).map(function(a){return a.dataColIx}),n.fixTableHypercubeOrders(o.data.qHyperCubeDef),o.$emit("saveProperties")}});var K=o.sortableItemLists.createList(1,{title:f.get("Common.Columns"),tid:"columns"});o.$watchCollection("data.qHyperCubeDef.columnOrder",v),o.$watchCollection("data.qHyperCubeDef.qDimensions",v),o.$watchCollection("data.qHyperCubeDef.qMeasures",v),o.$on("$destroy",function(){t(),B(),J&&J.destroy()})}]};return c.addComponent("columns",p),p}),define("text!extensions.qliktech/straight-table/column-picker/column-picker.ng.html",[],function(){return'<div class="qv-st-column-picker"\r\n	 tid="qv-st-column-picker"\r\n	 qva-activate="interactive && !selections.active && toggleColumnPickerPopover();"\r\n	 qva-outside-ignore-for="{{columnPicker.qvaOutsideIgnoreFor}}"\r\n	 ng-class="{ \'qv-st-column-picker-open\': columnPicker.showPopover }">\r\n	<table>\r\n		<tr>\r\n			<td q-title-translation="{{columnPicker.showPopover ? \'Tooltip.CloseColumnPicker\' : \'Tooltip.ColumnPicker\'}}">\r\n				<div class="qv-st-column-picker-more"></div>\r\n			</td>\r\n		</tr>\r\n	</table>\r\n</div>\r\n'}),define("text!extensions.qliktech/straight-table/column-picker/column-picker-popover.ng.html",[],function(){return'<immidiate-contextual class="qv-st-column-picker-popover"\r\n					  align-to="$alignColumnPickerTo"\r\n					  position="\'left\'"\r\n					  collision="\'flip fit\'"\r\n					  width="180"\r\n					  height="\'auto\'"\r\n					  qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}"\r\n					  on-close-view=" toggleColumnPickerPopover();">\r\n	<div class="qv-st-cp-header-wrapper"><p class="qv-st-cp-header" q-translation="Common.Columns"></p></div>\r\n	<ul class="qv-st-cp-popover-list"\r\n		qv-sortable-list="sortableItemLists">\r\n		<li class="qv-st-cp-popover-list-item"\r\n			draggable="false"\r\n			ng-repeat="col in columnPicker.columns.items track by col.id"\r\n			ng-class="col.classList"\r\n			ng-style="col.style">\r\n			<table class="qv-st-cp-popover-table" ng-if="col.id !== -2">\r\n				<tr>\r\n					<td ng-class="{ \'disabled\': col.disabled }">\r\n						<div class="qv-st-cp-fade-out">{{col.title}}</div>\r\n					</td>\r\n					<td ng-if="col.id >= 0" class="qv-st-cp-handle">\r\n						<div class="icon-handle"></div>\r\n					</td>\r\n				</tr>\r\n			</table>\r\n		</li>\r\n	</ul>\r\n</immidiate-contextual>\r\n'}),define("extensions.qliktech/straight-table/column-picker/column-picker",["jquery","qvangular","text!./column-picker.ng.html","text!./column-picker-popover.ng.html","core.utils/resize","general.sortable/sortable-item-lists","general.sortable/sortable-list"],function(a,b,c,d,e,f){return b.service("qvStraighTableColumnPickerService",["$document",function(b){var c,e,f=b.find("body");return e={show:function(e){return c=b.find(".qv-st-column-picker-popover"),c.length||(c=a("<div>")),c.showComponent({controller:function(){},template:d},e),c.appendTo(f),function(){c.remove()}}}}]),b.directive("qvStraightTableColumnPicker",function(){return{restrict:"A",require:"qvSortableList",link:function(a,b,c,d){a.columnPicker.cancel=function(){d.cancel()}}}}),b.directive("qvStraightTableColumnPickerActivator",["qvStraighTableColumnPickerService",function(a){return{restrict:"E",replace:!0,template:c,require:"^qvStraightTable",link:function(b,c,d,g){function h(){b.columnPicker.columns.get().forEach(function(a,c){a.disabled=b.scrollApi.settings.columnCount<c?!0:!1})}function i(){var a,c,d,e,f=b.layout.qHyperCube.qDimensionInfo,g=b.layout.qHyperCube.qMeasureInfo,i=f.length;b.columnPicker.cancel(),b.columnPicker.columns.reset(),b.layout.qHyperCube.columnOrder.forEach(function(c){a=i>c?f[c].qFallbackTitle:g[c-i].qFallbackTitle,b.columnPicker.columns.add(a,c,["qv-st-cp-sortable"])}),c=b.columnPicker.columns.add("",-2,["qv-st-cp-divider"],32),c.isDivider=!0,d=b.columnPicker.columns.getIndexByItem(c),e=b.scrollApi.settings.columnCount,b.columnPicker.columns.moveItem(d,e),h()}function j(){e.off("start."+b.$id,j),b.columnPicker.showPopover&&(k(),b.columnPicker.showPopover=!1,b.$digest())}var k;b.sortableItemLists=f.create({options:{direction:"vertical",itemKey:"col",itemSelector:".qv-st-cp-sortable",itemDragSelector:".qv-st-cp-handle"},addPlaceholder:function(a,b){var c=this._super.apply(this,arguments);c.style.height=b.height,c.id=-1},onMove:function(){this._super.apply(this,arguments),h(),b.applyColumnOrderSoftPatch(!1,b.columnPicker.columns.get(function(a){return a.id>=0}).map(function(a){return a.id}))}}),b.columnPicker={showPopover:!1,columns:b.sortableItemLists.createList(),qvaOutsideIgnoreFor:"qv-st-column-picker-"+b.$id,cancel:function(){}},g.watchPaint(i),b.toggleColumnPickerPopover=function(){b.$alignColumnPickerTo=c,b.columnPicker.showPopover=!b.columnPicker.showPopover,b.columnPicker.showPopover?(i(),k=a.show({$alignColumnPickerTo:b.$alignColumnPickerTo,columnPicker:b.columnPicker,onMoveBegin:b.onMoveBegin,onMoveEnter:b.onMoveEnter,onMoveCancel:b.onMoveCancel,onMove:b.onMove,toggleColumnPickerPopover:b.toggleColumnPickerPopover,qvaOutsideIgnoreFor:b.columnPicker.qvaOutsideIgnoreFor,sortableItemLists:b.sortableItemLists,hc:b.layout.qHyperCube}),e.on("start."+b.$id,j)):k&&k()}}}}])}),define("extensions.qliktech/straight-table/straight-table",["qvangular","core.utils/deferred","objects.backend-api/hypercube-api","extensions.qliktech/straight-table/straight-table-properties","text!./straight-table.ng.html","objects.extension/base-controller","objects.extension/object-conversion","general.utils/array-util","objects.grid/services/data-service","extensions.qliktech/straight-table/snapshot/snapshot-helper","general.utils/support","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/data-api","objects.utils/event-utils","objects.grid/data-grid","objects.grid/services/selections","extensions.qliktech/straight-table/layout/top/straight-table-top-header","extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell","extensions.qliktech/straight-table/layout/data/straight-table-data","extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell","extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header","extensions.qliktech/straight-table/selections/highlight-column","extensions.qliktech/straight-table/properties/columns/columns","extensions.qliktech/straight-table/column-picker/column-picker","objects/listbox-popover/listbox-popover-service"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r,s,t;return r=l.extend({destroy:function(){this._super.apply(this,arguments),this.$timeout.cancel(this.updateTopBottomPromise)},init:function(a,b,c){this.isSnapshot=c,this.topBottomStyle={},this.alignTotals=!1,this._super.apply(this,arguments)},updateTopBottom:function(){this.updateTopBottomPromise=this.$timeout(function(){var a=this.domApi.getClientWidth(),b=this.domApi.getScrollContentBoundingBox().height,c=this.domApi.getScrollAreaClientHeight(),d=this.domApi.getScrollAreaClientWidth();if(b>c||this.alignBottom?(this.alignTotals=!1,this.topBottomStyle.marginRight=a-d):(this.alignTotals=!0,this.topBottomStyle.marginRight=0),this.virtualScrollEnabled&&!this.isSnapshot){var e=this.dataApi.getRowCount(),f=Math.ceil(c/this.settings.minRowHeight),g=e-(e-f);e>f&&(this.dataApi.getRows().splice(g),this.settings.viewportRowCount=f)}}.bind(this))},updateAlignBottom:function(){this._super(),this.updateTopBottom()}}),s=n.extend({init:function(a){this.visualizationCtrl=a},getRows:function(){return this.visualizationCtrl.getRows()},getRowCount:function(){return this.visualizationCtrl.getRowCount()},getFirstElementIndex:function(){return this.visualizationCtrl.getFirstElementIndex()},getLastElementIndex:function(){return this.visualizationCtrl.getLastElementIndex()},onVirtualScroll:function(a,b){return this.visualizationCtrl.onVirtualScroll(a,b)},onInitialNativeScroll:function(a,b){return this.visualizationCtrl.onInitialNativeScroll(a,b)},onGotoNextBlock:function(a,b){return this.visualizationCtrl.onGotoNextBlock(a,b)},onGotoPreviousBlock:function(a,b){return this.visualizationCtrl.onGotoPreviousBlock(a,b)}}),t=m.extend({init:function(a,b,c,d,e,f){this.snapshotObject=f,this._super.apply(this,arguments)},getBoundingBox:function(){var a;return a=this.snapshotObject.freeResize?this.$element[0].getBoundingClientRect():{height:this.snapshotObject.size.h,width:this.snapshotObject.size.w}}}),q=f.extend({handledColumnOrderMigration:function(){var a=this.$scope;return void 0===a.layout.qHyperCube.columnOrder||a.layout.qHyperCube.columnOrder.length&&"number"!=typeof a.layout.qHyperCube.columnOrder[0]?(this.appliedSoftPatch||(void 0===a.layout.qHyperCube.columnOrder?a.applyColumnOrderSoftPatch(!0,this.dataService.columnOrder.get(a.layout.qHyperCube.qDimensionInfo,a.layout.qHyperCube.qMeasureInfo)):a.applyColumnOrderSoftPatch(!1,a.layout.qHyperCube.columnOrder.map(function(a){return a.dataColIx})),this.appliedSoftPatch=!0),!0):!1},init:function(a,b,c){this.appliedSoftPatch=!1,this._paintWatches=[],this._resizeWatches=[],this.dataService=b,this.selectionService=c,this._super.apply(this,arguments),a.backendApi.setCacheOptions({width:1}),Object.defineProperties(a,{isDesktop:{get:function(){return k.treatAsDesktop()}}})},watchPaint:function(a){var b=this;return b._paintWatches.push(a),function(){var c=b._paintWatches.indexOf(a);b._paintWatches.splice(c,1)}},watchResize:function(a){var b=this;return b._resizeWatches.push(a),function(){var c=b._resizeWatches.indexOf(a);b._resizeWatches.splice(c,1)}},update:function(a,b,c,d,e){var f=this.getDataInfo(a,b);return this.$scope.backendApi.getData(f.rects).then(function(a){this.onUpdateData({dataPages:a,dataInfo:f},c,d,e)}.bind(this))},getDataInfo:function(a,b){var c,d=this.dataService.getStraightMetaHeaders(this.$scope.layout,this.$scope.scrollApi.settings,this.$scope.$id),e=d.length,f=[];for(c=0;e>c;++c)d[c].isSearchIcon||f.push({qLeft:d[c].qLeft,qTop:a||0,qWidth:1,qHeight:b});return f.length||f.push({qTop:0,qLeft:0,qWidth:0,qHeight:0}),{rects:f,metaHeaders:d}},onUpdateData:function(a,b,c,d){c&&a.dataPages.forEach(function(a){a.qMatrix.reverse()}),this.dataService.updateStraightItems(this.$scope,a.dataPages,a.dataInfo.metaHeaders,b,c,d),c&&this.$scope.grid.rows.reverse(),this.selectionService.update(this.$scope.grid,this.$scope.selections,this.$scope.layout.qHyperCube.columnOrder.indexOf(this.$scope.selections.currentDataColIx)),this.$scope.backendApi.isSnapshot&&j.scaleDynamically(this.$scope),this.$scope.scrollApi.updateTopBottom()},setSnapshotData:function(a){var b,c,d=!!a.sourceObjectId,e=this.$scope,f=e.scrollApi.domApi,g=f.getScrollAreaBoundingBox(),h=f.$scrollArea.find(".qv-st-data-row");return b=j.getIndexHeightAndWidth(h,g),c=this.getDataInfo(b.index,b.height),c.rects.splice(b.width),e.backendApi.getData(c.rects).then(function(f){a.qHyperCube.qDataPages=f,a.snapshotData.object.dataTableRowCount=b.height,a.snapshotData.object.dataTableHeight=e.isDesktop?g.height:g.height*(2/3),a.snapshotData.object.size.h*=e.isDesktop?1:2/3;var h=e.layout.qHyperCube.columnOrder.slice(0,c.rects.length);return d||(a.qHyperCube.columnOrder=h),a})},process:function(a,c,d){return this.handledColumnOrderMigration()?b.resolve():this.update(a,c,!1,!1,!1).then(function(){this.$scope.scrollApi.setTotalRows(this.$scope.layout.qHyperCube.qSize.qcy),this.$scope.scrollApi.setVirtualSize(d)}.bind(this))},processPaint:function(){var a,b,c=0;return a=this.$scope.scrollApi.settings.viewportRowCount,b=this.$scope.scrollApi.resetNativeScroll(),this.process(c,a,!1).then(function(){b()})},processResize:function(){var a=this.$scope.grid.rows.length,b=a?this.$scope.grid.rows[0].getIndex():0,c=this.$scope.scrollApi.settings.viewportRowCount;return a>c&&(c=a),this.process(b,c,!0)},onVirtualScroll:function(a,b){return this.update(a,b,!1,!1,!0)},gotoBlock:function(a,b,c){var d=this.$scope.scrollApi.getSpliceArgs(),e=this.$scope.grid.rows,f=this.$scope.grid.getNextRowIx();return c&&e.reverse(),e.splice.apply(e,d),f-=d[1],this.$scope.grid.setNextRowIx(f),this.update(a,b,!0,c,!0)},onGotoNextBlock:function(a,b){return this.gotoBlock(a,b,!1)},onGotoPreviousBlock:function(a,b){return this.gotoBlock(a,b,!0)},getRows:function(){return this.$scope.grid.rows},getRowCount:function(){return this.$scope.grid.rows.length},getFirstElementIndex:function(){return this.$scope.grid.rows[0].getIndex()},getLastElementIndex:function(){return this.$scope.grid.rows.lastElement.getIndex()}}),q.$inject=["$scope","qvGridObjectDataService","qvGridObjectSelectionService"],a.directive("qvStraightTable",["$timeout","qvGridObjectDataService","qvStraightTableHighlightColumnService","qvGridObjectSelectionService","qvListboxPopoverService",function(a,b,c,d,f){return{restrict:"E",replace:!0,template:e,require:["qvStraightTable","^qvObject"],controller:q,link:function(e,g,i,j){function k(a,b){u[a]().then(function(){b.forEach(function(a){a()})})}function l(){b.getColumnCells(e.grid,e.layout.qHyperCube.columnOrder.indexOf(e.selections.currentDataColIx)).forEach(function(a){a.selected=!1,a.selectedHighlighted=!1})}function n(a,b,d){e.object.selectionsClass="",c.show(e.highlightColumn,b,d,e.scrollApi.settings.width,e.layout.qHyperCube.columnOrder.indexOf(a.dataColIx))}var q,u=j[0],v=j[1],w=g.find(".qv-grid-object-scroll-area"),x=w.controller("qvScrollArea"),y=g.find(".qv-scroll-loader:not(.qv-scroll-row-loader)").controller("qvScrollLoader"),z=w.find(".qv-scroll-row-loader").controller("qvScrollLoader"),A={columnCount:0,column:{minWidth:102,minSearchWidth:25,glyphWidth:8,maxMeasureWidth:350},columnPicker:{show:!1,width:21},blockSize:50},B=e.scrollApi=new r(a,A,e.backendApi.isSnapshot),C=new s(u),D=e.backendApi.isSnapshot?new t(g,w,"","",null,e.layout.snapshotData.object):new m(g,w,".qv-grid-object-data-first-row",".qv-grid-object-data-last-row");e.grid=new p,e.$on("$destroy",function(){B.destroy()}),B.initialize(D,C,x,y).then(function(){u.onStateChanged=function(a){u.allowInteraction(a)?(e.interactive=!0,e.scrollApi.activate()):(e.interactive=!1,e.scrollApi.deactivate())},u.setInteraction=function(a){e.scrollApi[a?"activate":"deactivate"]()},u.onPaint=function(){this.$scope.selections.active||k("processPaint",u._paintWatches)},u.onResize=function(){e.scrollApi.updateViewport(),k("processResize",u._resizeWatches)},u.onInitialNativeScroll=function(a,b){return z.fadeIn(null,{width:"100%",height:"30px"},"relative").then(function(){return u.update(a,b,!0,!1,!0).then(function(){return z.fadeOut()})})},v.addChildController(u)}),e.applyColumnOrderSoftPatch=function(a,b){var c=[[],!0],d=a?"add":"replace";c[0][0]={qPath:"/qHyperCubeDef/columnOrder",qOp:d.toString(),qValue:JSON.stringify(b)},e.backendApi.applyPatches(c)},e.highlightColumn={style:{},dimRightStyle:{},dimLeftStyle:{},enabled:!1},e.selections=d.$new(),d.init(e.selectionsApi,e.backendApi,e.selections,function(){c.hide(e.highlightColumn),q&&q()},function(){c.hide(e.highlightColumn),q&&q()},l);var E=e.selectionsApi.ignoreOnOutside;e.selectionsApi.ignoreOnOutside=function(a){return a.closest(".qv-st-dim-columns").length?!0:E(a)||a.closest(".qv-st-selections-active").length?!0:void 0},e.selectionsApi.getMenuMaxHeight=function(){return g.outerHeight()},e.selectWhileLocked=function(){o.showLockedFeedback(e.layout.qHyperCube.qDimensionInfo)},e.selectDimensionValue=function(a,b,c,f){e.scrollApi.updateViewport(),e.selectionsApi.getKeyAsToggleSelected(f)||(l(),d.reset(e.selections)),q=d.selectDimensionValue(e.$id,e.object,e.backendApi,e.selections,e.selectionsApi,a,e.grid),e.selectionsApi.watchActivated(function(){n(a,b,c)})},e.activateSelections=function(a,b,c){e.scrollApi.updateViewport(),q=d.activateSelections(e.$id,e.object,e.backendApi,e.selections,e.selectionsApi,a),e.selectionsApi.watchActivated(function(){n(a,b,c)})},e.multiselectDimensionValues=function(a,c,f){function g(a){d.selectCell(e.backendApi,e.selections,e.selectionsApi,e.grid,a,!1)}var h,i,j=a.dataRowIx,k=c.dataRowIx;if(k>=j)for(h=j;k>=h;++h)i=b.getCellInColumnWithRowIndex(e.grid,f,h),g(i);else if(j>k)for(h=j;h>=k;--h)i=b.getCellInColumnWithRowIndex(e.grid,f,h),g(i)},e.multiselect=function(){e.selections.active&&(e.selectionsApi.selectionsMade=!0,e.backendApi.select(e.selections.rows,e.selections.cols))},e.sort=function(a){var c,d,f,g=a.dataColIx,i=[].concat(e.layout.qHyperCube.qEffectiveInterColumnSortOrder),j=i[0],k="",l=[[],!0];g!==j&&(f=i.indexOf(g),h.move(i,f,0)),l[0][0]={qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:"["+i.join(",")+"]"},g===j&&(k=a.isDimension?"/qHyperCubeDef/qDimensions/":"/qHyperCubeDef/qMeasures/",c=b.getColumnInfo(g,e.layout),a.reversed=!c.qReverseSort,d=a.isDimension?g:g-e.layout.qHyperCube.qDimensionInfo.length,k+=d+"/qDef/qReverseSort",l[0][1]={qPath:k,qOp:"replace",qValue:a.reversed.toString()}),e.backendApi.applyPatches(l)},e.currentHeaderSearch=null,e.search=function(a,b){return e.currentHeaderSearch===b?(b.open=!1,e.currentHeaderSearch=null,void f.close()):(e.currentHeaderSearch&&(e.currentHeaderSearch.open=!1,e.currentHeaderSearch=null),f.showField(b.fieldName,{$alignToElement:a,qvaOutsideIgnoreFor:"qv-st-header-cell-search-"+e.$id,collision:"flipfit"},null,function(){e.currentHeaderSearch&&(e.currentHeaderSearch.open=!1),e.currentHeaderSearch=null}),b.open=!0,void(e.currentHeaderSearch=b))}}}}]),{initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0,qMode:"S",columnOrder:[]}},data:{dimensions:{min:1,max:1e3,add:function(a,b,c){var d=c.hcProperties.columnOrder;return h.indexAdded(d,c.getDimensions().length-1),a},remove:function(a,b,c,d){var e=c.hcProperties.columnOrder;h.indexRemoved(e,d)}},measures:{add:function(a,b,c){var d=c.hcProperties.columnOrder;h.indexAdded(d,c.getDimensions().length+c.getMeasures().length-1)},remove:function(a,b,c,d){var e=c.hcProperties.columnOrder,f=e.indexOf(d);h.indexRemoved(e,f)},min:0,max:1e3}},snapshot:{canTakeSnapshot:!0},type:"table",template:"<qv-straight-table></qv-straight-table>",BackendApi:c,definition:d,importProperties:function(a,b,c){var d=g.hypercube.importProperties(a,b,c),e=d.qProperty.qHyperCubeDef.columnOrder,f=d.qProperty.qHyperCubeDef.qDimensions,h=d.qProperty.qHyperCubeDef.qMeasures;return e.length&&f.length+h.length===e.length||(d.qProperty.qHyperCubeDef.columnOrder=i.columnOrder.get(f,h)),d},exportProperties:g.hypercube.exportProperties}}),define("extensions.qliktech/listbox/listbox-properties",["general.utils/property-resolver"],function(a){var b,c,d,e=[{value:"ascending",translation:"properties.sorting.ascending"},{value:"descending",translation:"properties.sorting.descending"}];return b={uses:"settings",items:{}},c={type:"items",translation:"Common.Dimension",ref:"qListObjectDef",items:{label:{type:"string",ref:"qListObjectDef.qDef.qFieldLabels.0",translation:"Common.Label",show:!1},libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qListObjectDef.qLibraryId",translation:"Common.Dimension",show:function(a){return a.qListObjectDef&&a.qListObjectDef.qLibraryId}},field:{type:"string",expressionType:"dimension",ref:"qListObjectDef.qDef.qFieldDefs.0",translation:"Common.Field",change:function(a){var b=a.qListObjectDef.qDef;b.qFieldLabels||(b.qFieldLabels=[]),b.qFieldLabels[0]=b.qFieldDefs[0]},show:function(a){return a.qListObjectDef&&!a.qListObjectDef.qLibraryId}},autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qListObjectDef.qDef.cId",type:"string",show:!1}}},d={type:"items",translation:"properties.sorting",grouped:!0,schemaIgnore:!0,items:{autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(a,b){return a.qListObjectDef.qDef.autoSort?b.autoSortDimension(a.qListObjectDef):void 0}},expression:{type:"items",show:function(a){return a.qListObjectDef?!a.qListObjectDef.qDef.autoSort:!1},items:{expressionToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",translation:"properties.sorting.sortByExpression",resolveFunctions:"booleanToSortInteger"},expression:{type:"number",component:"expression",ref:"qListObjectDef.qDef.qSortCriterias.0.qExpression",translation:"Common.Expression",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",0)}},expressionOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",options:e,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",0)}}}},frequency:{type:"items",show:function(a){return a.qListObjectDef?!a.qListObjectDef.qDef.autoSort:!1},items:{frequencyToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByFrequency",translation:"properties.sorting.sortByFrequency",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},frequencyOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByFrequency",options:e,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByFrequency",0)}}}},numeric:{type:"items",show:function(a){return a.qListObjectDef?!a.qListObjectDef.qDef.autoSort:!1},items:{numericToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByNumeric",options:e,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByNumeric",0)}}}},ascii:{type:"items",show:function(a){return a.qListObjectDef?!a.qListObjectDef.qDef.autoSort:!1},items:{asciiToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByAscii",options:e,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByAscii",0)}}}}}},{type:"items",component:"accordion",items:{dimension:c,sorting:d,settings:b}}}),define("text!extensions.qliktech/listbox/listbox.ng.html",[],function(){return'<div class="qv-listbox-container" ng-class="{ \'qv-listbox-interactive\': interactive }" tid="qv-listbox-container">\r\n	<div qv-listbox-search ng-show="options.search.show" class="qv-listbox-search">\r\n		<qui-search-field query="query" is-focused="focused" on-escape="onEscape($event);" auto-focus="autoFocus" />\r\n	</div>\r\n	<div class="qv-listbox-wrapper" ng-class="{ \'searchActive\': options.search.show }">\r\n		<qv-scroll-area class="qv-listbox-scroll-area qv-animate" ng-class="{ \'qv-listbox-virtual-scroll-enabled\': scrollApi.virtualScrollEnabled }">\r\n			<ul class="qv-listbox" ng-class="{ \'align-bottom\': scrollApi.alignBottom }"\r\n				qv-selections-select-while-locked="selectWhileLocked()"\r\n				qv-selections-toggle-dimension-value="{ selector: \'li\', itemKey: \'item\' }"\r\n				qv-selections-on-toggle-dimension-value="interactive && select($event, item)"\r\n				qv-selections-multiselect="{ selector: \'li\', itemKey: \'item\' }"\r\n				qv-selections-start-multiselect="interactive && multiselectStart($event)"\r\n				qv-selections-update-multiselect="interactive && multiselectUpdate(start, current)"\r\n				qv-selections-end-multiselect="interactive && multiselectEnd($event)">\r\n				<qv-scroll-load-button tag="li" class="qv-listbox-load-buttons" ng-show="scrollApi.loadPrevious" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true">\r\n				</qv-scroll-load-button>\r\n				<li ng-repeat="item in items" ng-class="item.classNames" tid="listbox.item">\r\n					<div class="qv-listbox-tick"><i class="icon-tick"></i></div>\r\n					<div class="qv-listbox-text" ng-class="{ \'qv-listbox-numeric\' : item.isNumeric }">\r\n						<span ng-attr-title="{{item.text}}">\r\n							<span ng-repeat="textItem in item.textItems" ng-class="{ highlighted: textItem.isHighlighted }">{{textItem.text}}</span>\r\n						</span>\r\n					</div>\r\n				</li>\r\n				<qv-scroll-loader tag="li" class="qv-scroll-row-loader"></qv-scroll-loader>\r\n				<qv-scroll-load-button tag="li" class="qv-listbox-load-buttons" ng-show="scrollApi.loadNext" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\r\n			</ul>\r\n		</qv-scroll-area>\r\n		<qv-scroll-loader></qv-scroll-loader>\r\n	</div>\r\n</div>\r\n'}),define("text!client.services/export-dialog/export-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="export-dialog">\r\n	<div ng-if="state === states.PENDING">\r\n		<header class="dm-header" q-translation="Export.Exporting"></header>\r\n		<main class="dm-main">\r\n			<div class="qv-loader dm-p"></div>\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<qui-button qva-activate="cancel()" q-translation="Common.Cancel"></qui-button>\r\n		</footer>\r\n	</div>\r\n	<div ng-if="state === states.COMPLETED">\r\n		<header class="dm-header" q-translation="Export.Completed"></header>\r\n		<main class="dm-main">\r\n			<p class="dm-p">\r\n				<span q-translation="Export.CompletedDescription"></span>\r\n				<span q-translation="Export.WarningDataTruncated" ng-if="dataIsTruncated"></span>\r\n			</p>\r\n			<p class="dm-p">\r\n				<a ng-href="{{exportUrl}}" target="_blank" q-translation="Export.CompletedLink"></a>\r\n			</p>\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<qui-button qva-activate="close()" q-translation="Common.Close"></qui-button>\r\n		</footer>\r\n	</div>\r\n	<div ng-if="state === states.FAILED">\r\n		<header class="dm-header" q-translation="Export.Failed"></header>\r\n		<main class="dm-main">\r\n			<p class="dm-p" q-translation="{{errorTranslation}}"></p>\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<qui-button qva-activate="close()" q-translation="Common.Close"></qui-button>\r\n		</footer>\r\n	</div>\r\n</qv-modal-dialog>'}),define("client.services/export-dialog/export-dialog",["qvangular","text!./export-dialog.ng.html","general.services/show-service/show-service"],function(a,b,c){var d={template:b,scope:{model:"=",hypercubePath:"="},controller:["$scope",function(a){a.states={FAILED:-1,IDLE:0,PENDING:1,COMPLETED:2},a.state=a.states.PENDING,a.model.getLayout().then(function(b){var c=a.model.exportData(null,a.hypercubePath,b.title||null);a.rpcId=c.rpcId,c.then(function(b){a.exportUrl=".."+b.result.qUrl,a.state=a.states.COMPLETED,b.warnings&&1e3===b.warnings[0]&&(a.dataIsTruncated=!0)},function(b){a.state=a.states.FAILED,a.errorTranslation="ErrorCode."+b.error.code,b.isHandled=!0})}),a.openExportWindow=function(){window.open(a.exportUrl)},a.cancel=function(){a.rpcId?a.model.cancelRequest(a.rpcId)["finally"](a.close):a.close()},a.close=function(){a.destroyComponent()}}]};return a.service("$exportDialog",[function(){return{show:function(a,b){var e={model:a,hypercubePath:b};return c.show(d,e)}}}])}),define("extensions.qliktech/listbox/listbox-search",["qvangular","util","general.utils/support"],function(a,b,c){var d=document.createElement("input");d.type="text",a.directive("qvListboxSearch",["$document","$timeout",function(e,f){return{link:function(g,h){function i(){return e.on("keypress.watchKeyChars"+g.$id,function(a){27!==a.keyCode&&13!==a.keyCode&&(d.value=String.fromCharCode(a.which),d.value.length&&g.$apply(function(){g.options.search.toggle(!0,d.value)}))}),function(){e.off(".watchKeyChars"+g.$id)}}function j(){function a(){return g.$watch("query",function(a,b){void 0!==a&&a!==b&&g.backendApi.search(a)})}function b(){d&&d(),g.query="",d=a()}function c(a){var b=a.split(" ");return b.some(function(a){var b=a.trim()[0];return"<"===b||">"===b})}var d,h;return b(),h=g.$watch("focused",function(a){void 0!==a&&g.selectionsApi.toggleKeyboardAccelerators(!a)}),e.on("keydown.listboxSearch"+g.$id,function(a){g.focused===!0&&f(function(){switch(a.which){case 13:var d,e=g.backendApi.getSize();g.backendApi.isLocked()?g.backendApi.abortSearch():e.qcy>0&&(d=g.selectionsApi.getKeyAsToggleSelected(a),d=c(g.query)?!d:d,g.backendApi.confirmSearch(d),g.selectionsApi.selectionsMade=!0,b());break;case 27:g.backendApi.abortSearch(),b()}})}),function(){d(),h(),e.off(".listboxSearch"+g.$id)
}}var k,l;g.autoFocus=!1,g.selectionsApi.deactivateSearch=function(){k&&k(),l&&l(),a.$apply(g,function(){g.options.search&&g.options.search.toggle(!1)})},g.onEscape=function(a){g.query&&g.query.length?g.query="":(g.backendApi.abortSearch(),g.selectionsApi.cancel()),a.preventDefault()},g.options.search=b.extend(!0,{show:g.options.isPopover,toggle:function(a,b){g.options.search.show=void 0!==a?a:!g.options.search.show,g.options.search.show?(g.query=b,k=j()):(k&&k(),g.backendApi.abortSearch(),g.query="")}},g.options.search),g.options.showSearch=!0,g.$watch("options.search.show",function(a){g.autoFocus=a&&c.treatAsDesktop(),a||h.find("input").blur()}),g.$watch("selectionsApi.active && !focused",function(a){a?l=i():void 0!==a&&l&&l()}),g.$on("$destroy",function(){e.off(".listboxSearch"+g.$id),e.off(".watchKeyChars"+g.$id)}),g.options.isPopover&&g.options.search.toggle(!0,g.options.search.defaultStr)}}}])}),define("extensions.qliktech/listbox/listbox",["qvangular","objects.backend-api/listbox-api","extensions.qliktech/listbox/listbox-properties","general.utils/property-mapper","text!./listbox.ng.html","objects.utils/data-properties/listobject-handler","objects.extension/object-conversion","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/data-api","objects.extension/base-controller","general.utils/support","client.services/export-dialog/export-dialog","objects.extension/default-selection-toolbar","objects.utils/event-utils","general.scroll/scroll-area","objects.grid/directives/selections","./listbox-search"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a,b,c){var d=".selections-keyboard-"+c;return a.on("keyup"+d,function(a){b.focused||(27===a.which?b.selectionsApi.cancel():13===a.which&&b.selectionsApi.confirm())}),function(){a.off(d)}}var q,r;return r=j.extend({init:function(a){this.visualizationCtrl=a},getRows:function(){return this.visualizationCtrl.getRows()},getRowCount:function(){return this.visualizationCtrl.getRowCount()},getFirstElementIndex:function(){return this.visualizationCtrl.getFirstElementIndex()},getLastElementIndex:function(){return this.visualizationCtrl.getLastElementIndex()},onVirtualScroll:function(a,b){return this.visualizationCtrl.onVirtualScroll(a,b)},onInitialNativeScroll:function(a,b){return this.visualizationCtrl.onInitialNativeScroll(a,b)},onGotoNextBlock:function(a,b){return this.visualizationCtrl.onGotoNextBlock(a,b)},onGotoPreviousBlock:function(a,b){return this.visualizationCtrl.onGotoPreviousBlock(a,b)}}),q=k.extend({init:function(a,b){function c(b){b.selected||a.selectedValues.push(b.dataValue),b.selected=!0,b.classNames="selected serverSelected "}this._super.apply(this,arguments);var d;a.selectionsApi.watchDeactivated(function(){a.$emit("childSelectionActive",!1),a.options.search.show=!1,d&&d()}),a.selectionsApi.watchActivated(function(){a.$emit("childSelectionActive",!0),d&&d(),d=p(b,a,a.$id)}),a.selectionsApi.clear=function(){a.selectedValues=[],this.selectionsMade=!0,a.backendApi.clearSelections()},a.selectedValues=[],a.activateSelections=function(){a.selectionsApi.active||(a.selectedValues=[]),a.selectionsApi.activate()},a.selectValues=function(b,c){a.selectionsApi.selectionsMade=!0,a.backendApi.select(0,b,c)},a.select=function(b,c){var d=a.selectionsApi.getKeyAsToggleSelected(b);a.activateSelections(),d||a.items.forEach(function(a){a!==c&&(a.selected=!1,a.classNames="serverOptional")}),c.selected=!c.selected,c.classNames=c.selected?"selected serverSelected":"serverOptional",a.selectValues([c.dataValue],d)},a.multiselectStart=function(b){a.activateSelections(),a.selectionsApi.getKeyAsToggleSelected(b)||a.items.forEach(function(a){a.selected=!1,a.classNames="serverOptional"})},a.multiselectUpdate=function(b,d){var e,f,g,h;if(-1!==a.items.indexOf(d))if(g=a.items.indexOf(b),h=a.items.indexOf(d),h>=g)for(e=g;h>=e;++e)f=a.items[e],c(f);else if(g>h)for(e=g;e>=h;--e)f=a.items[e],c(f)},a.multiselectEnd=function(b){a.selectValues(a.selectedValues,a.selectionsApi.getKeyAsToggleSelected(b))},a.selectWhileLocked=function(){o.showLockedFeedback([a.layout.qListObject.qDimensionInfo])},a.$on("$destroy",function(){d&&d()}),Object.defineProperties(a,{isDesktop:{get:function(){return l.treatAsDesktop()}}})},update:function(a,b,c,d){var e=this.getDataInfo(a,b);return this.$scope.backendApi.getData(e.rects).then(function(a){this.onUpdateData(a,c,d)}.bind(this))},getDataInfo:function(a,b){return a=a||0,{rects:[{qTop:a,qLeft:0,qWidth:1,qHeight:b}]}},stateMap:{S:"Selected",A:"Alternative",O:"Optional",XS:"SelectedExcluded",L:"Locked",X:"Excluded",XL:"ExcludedLock"},getState:function(a){return this.stateMap[a]},isSelected:function(a){return"Selected"===this.getState(a)},updateTextItem:function(a,b){var c,d,e,f,g=b.qHighlightRanges&&b.qHighlightRanges.qRanges.length||0,h=b.qText&&b.qText.split("")||[],i=0;if(a.textItems=[],h.length||a.textItems.push({isHighlighted:!1,text:""}),!g)return void a.textItems.push({isHighlighted:!1,text:b.qText});for(e=b.qHighlightRanges.qRanges.sort(function(a,b){return a.qCharPos-b.qCharPos}),c=0;g>c;++c)d=e[c],f=d.qCharPos,f!==i&&a.textItems.push({isHighlighted:!1,text:h.splice(0,f-i).join("")}),a.textItems.push({isHighlighted:!0,text:h.splice(0,d.qCharCount).join("")}),i=d.qCharPos+d.qCharCount;h.length&&a.textItems.push({isHighlighted:!1,text:h.splice(0,h.length).join("")})},updateItems:function(a,b,c){var d,e,f,g,h,i,j=0,k=a[0].qArea.qTop,l=a[0].qArea.qHeight,m=this.$scope.items,n=a[0].qMatrix;for(c&&n.reverse(),b&&(j=m.length),i=this.$scope.backendApi.isLocked(),d=0,e=n.length;e>d;++d)m[j+d]||(m[j+d]={}),g=m[j+d],f=n[d][0],h=this.getState(f.qState),g.locked=i,g.dataValue=f.qElemNumber,g.dataColIx=0,g.dataRowIx=c?k+l-d-1:k+d,g.isNumeric="NaN"!==f.qNum,g.selected=this.isSelected(f.qState),g.classNames=g.selected?"selected server"+h:"server"+h,g.isDimensionValue=!0,g.text=f.qText,this.updateTextItem(g,f);b||m.splice(d),c&&m.reverse()},onUpdateData:function(a,b,c){this.updateItems(a,b,c),this.$scope.selectedValues=[]},process:function(a,b,c){return this.update(a,b,!1,!1).then(function(){this.$scope.scrollApi.setTotalRows(this.$scope.layout.qListObject.qSize.qcy),this.$scope.scrollApi.setVirtualSize(c)}.bind(this))},processPaint:function(){var a,b,c=0;return a=this.$scope.scrollApi.settings.viewportRowCount,b=this.$scope.scrollApi.resetNativeScroll(),this.process(c,a,!1).then(function(){b()})},processResize:function(){var a=this.$scope.items.length,b=a?this.$scope.items[0].dataRowIx:0,c=this.$scope.scrollApi.settings.viewportRowCount;return a>c&&(c=a),this.process(b,c,!0)},onVirtualScroll:function(a,b){return this.update(a,b,!1,!1)},gotoBlock:function(a,b,c){var d=this.$scope.scrollApi.getSpliceArgs(),e=this.$scope.items;return c&&e.reverse(),e.splice.apply(e,d),this.update(a,b,!0,c)},onGotoNextBlock:function(a,b){return this.gotoBlock(a,b,!1)},onGotoPreviousBlock:function(a,b){return this.gotoBlock(a,b,!0)},getRows:function(){return this.$scope.items},getRowCount:function(){return this.$scope.items.length},getFirstElementIndex:function(){return this.$scope.items[0].dataRowIx},getLastElementIndex:function(){return this.$scope.items.lastElement.dataRowIx},getSelectionToolbar:function(){return new n(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[],[{name:"Selections.All",tid:"selection-toolbar-menu.selectAll",iconClass:"icon-selection-toolbar-selectAll",buttonClass:"",action:function(){this.selectionsApi.selectionsMade=!0,this.backendApi.selectAll()},isDisabled:function(){return!this.hasState(["qOption","qAlternative","qExcluded","qDeselected"])}},{name:"Selections.Possible",tid:"selection-toolbar-menu.selectPossible",iconClass:"icon-selection-toolbar-selectPossible",buttonClass:"",action:function(){this.selectionsApi.selectionsMade=!0,this.backendApi.selectPossible()},isDisabled:function(){return!this.hasState(["qOption"])}},{name:"Selections.Alternative",tid:"selection-toolbar-menu.selectAlternative",iconClass:"icon-selection-toolbar-selectAlternative",buttonClass:"",action:function(){this.selectionsApi.selectionsMade=!0,this.backendApi.selectAlternative()},isDisabled:function(){return!this.hasState(["qAlternative"])}},{name:"Selections.Excluded",tid:"selection-toolbar-menu.selectExcluded",iconClass:"icon-selection-toolbar-selectExcluded",buttonClass:"",action:function(){this.selectionsApi.selectionsMade=!0,this.backendApi.selectExcluded()},isDisabled:function(){return!this.hasState(["qExcluded","qAlternative"])}},{name:"contextMenu.export",tid:"selection-toolbar-menu.exportData",iconClass:"icon-toolbar-sharelist",buttonClass:"",action:function(){m.show(this.backendApi.model)},isDisabled:function(){return!1}}])}}),q.$inject=["$scope","$document"],a.directive("qvListbox",["$timeout",function(a){return{restrict:"E",replace:!0,template:e,require:["qvListbox","^qvObject"],controller:q,link:function(b,c,d,e){var f=e[0],g=e[1],j=c.find(".qv-listbox-scroll-area"),k=j.controller("qvScrollArea"),l=c.find(".qv-scroll-loader:not(.qv-scroll-row-loader)").controller("qvScrollLoader"),m=j.find(".qv-scroll-row-loader").controller("qvScrollLoader"),n={blockSize:200,minRowHeight:30},o=b.scrollApi=new h(a,n,b.backendApi.isSnapshot),p=new r(f),q=new i(c,j,"li:not(.qv-listbox-load-buttons):first","li:not(.qv-listbox-load-buttons):not(.qv-scroll-row-loader):last");b.items=[],b.$on("$destroy",function(){o.destroy()}),o.initialize(q,p,k,l).then(function(){b.options.isPopover&&b.activateSelections(),b.$watch("options.search.show",function(){b.options.isPopover||b.scrollApi.setVirtualSize(!0)}),b.$watch("options.interactionEnabled",function(a){void 0!==a&&b.scrollApi[a?"activate":"deactivate"]()}),f.onStateChanged=function(a){f.allowInteraction(a)?(b.interactive=!0,b.scrollApi.activate()):(b.interactive=!1,b.scrollApi.deactivate())},f.onPaint=function(){return b.selectionsApi.active?f.processResize():void f.processPaint()},f.onResize=function(){b.scrollApi.updateViewport(),f.processResize()},f.onInitialNativeScroll=function(a,b){return m.fadeIn(null,{width:"100%",height:"30px"},"relative").then(function(){return f.update(a,b,!0,!1).then(function(){return m.fadeOut()})})},g.addChildController(f)})}}}]),{type:"listbox",template:"<qv-listbox></qv-listbox>",initialProperties:{version:.96,qListObjectDef:{qShowAlternatives:!0,qInitialDataFetch:[{qTop:0,qLeft:0,qWidth:0,qHeight:0}],qDef:{qSortCriterias:[{qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1}]}}},data:{dimensions:{min:1,max:1}},mapProperties:function(){this.mappedDefinition=d.mapDefinition(this.definition,this.type),this.dimensionDefinition=d.findDefinition(this.mappedDefinition,"qListObjectDef",!0)},getCreatePropertyHandler:function(){var a=this;return a.propertyHandler||(a.propertyHandler=new f(a.dimensionDefinition)),a.propertyHandler},showRequirements:function(){return!1},hasError:function(a){var b=a.layout;return!b.qListObject||!b.qListObject.qDimensionInfo||!!b.qListObject.qDimensionInfo.qError},BackendApi:b,definition:c,options:{search:{},selections:{}},getDropFieldOptions:function(a,b,c,d){a.Add(c,b),a.ReplaceDimensions(c,b),d()},getDropMeasureOptions:function(a,b,c,d){d()},importProperties:g.listbox.importProperties,exportProperties:g.listbox.exportProperties}}),define("objects.backend-api/field-api",["./backend-api"],function(a){var b;return b=a.extend("FieldApi",{init:function(a){this._super(a,"/dimensions"),this.cacheCube.setMethodName("GetListObjectData")},updateCache:function(){},getProperties:function(){return this.model.getProperties()},getData:function(a){return this.cacheCube.getData(a)},getSize:function(){return this.model.layout.qListObject.qSize},isLocked:function(){return this.model.layout.qListObject.qDimensionInfo.qLocked}})}),define("extensions.qliktech/filterpane/filterpane-properties",["client.property-panel/default-sorting-properties","util"],function(a,b){var c,d,e,f;return f={qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1},c={uses:"settings",items:{general:{items:{showTitles:{defaultValue:!1}}}}},d={type:"array",component:"filterpane-data",translation:"Common.Data",allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.dimensions.add",grouped:!0,ref:"qChildListDef",items:{libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qListObjectDef.qLibraryId",translation:"Common.Dimension",show:function(a){return a.qListObjectDef.qLibraryId}},field:{type:"string",component:"expression",expressionType:"dimension",ref:"qListObjectDef.qDef.qFieldDefs.0",translation:"Common.Field",show:function(a){return!a.qListObjectDef.qLibraryId},change:function(a){var b=a.qListObjectDef.qDef;b.qFieldLabels||(b.qFieldLabels=[]),b.qFieldLabels[0]=b.qFieldDefs[0]}},title:{ref:"title",type:"string",expression:"optional",translation:"Common.Title"},autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qListObjectDef.qDef.cId",type:"string",show:!1}}},e={type:"array",component:"filterpane-sorting",translation:"properties.sorting",allowMove:!0,schemaIgnore:!0,items:{autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(a){if(a.qListObjectDef.qDef.autoSort)for(var b=a.qListObjectDef,c=0;c<b.qDef.qSortCriterias.length;c++)b.qDef.qSortCriterias[c]=f}},dimension:{component:"sorting-dimension",type:"items",ref:"qListObjectDef",show:function(a){return!a.qListObjectDef.qDef.autoSort},items:b.extend(!0,{},a.items.dimensions.items.dimension.items,{dimensionDefinition:{items:{frequency:{show:!0}}}})}}},{type:"items",component:"accordion",items:{data:d,sorting:e,settings:c}}}),define("extensions.qliktech/filterpane/filterpane-handler",["objects.utils/data-properties/data-property-handler","objects.utils/data-properties/listobject-util","objects.utils/data-properties/library-utils","util","general.utils/visualizations"],function(a,b,c,d,e){var f=1e3,g=a.extend({init:function(a,b,c){this._super(a,null,b,null),this.model=c,this.dimensionLayout=[],this.dimensions=[]},setProperties:function(a){this._super(a),this.getDimensions().forEach(function(a){void 0!==a.qListObjectDef.autoSort&&(a.qListObjectDef.qDef.autoSort=a.qListObjectDef.autoSort,delete a.qListObjectDef.autoSort)})},autoSortDimension:function(a){return a.qLibraryId?c.findLibraryDimension(a.qLibraryId).then(function(c){return c&&b.autoSortDimension(a,c.qData.info),a}):c.findField(a.qDef.qFieldDefs[0]).then(function(c){return c&&b.autoSortDimension(a,[c]),a})},getDimensions:function(){return this.dimensions||[]},minDimensions:function(){return 1},maxDimensions:function(){return 1e3},setModel:function(a){this.model=a},addDimension:function(a){var b,g,h=this;return a.qDef.cId=d.generateId(),a.qShowAlternatives=!0,this.getDimensions().length<f?(b=e.getType("listbox"),g=b.getInitialProperties({}),g.then(function(b){return h.autoSortDimension(a).then(function(){return b.qListObjectDef=a,a.qLibraryId?c.findLibraryDimension(a.qLibraryId).then(function(a){return b.title=a.qData.title,h.model.createChild(b,h.properties).then(function(){return b.qListObjectDef})}):(b.title=a.qDef.title||a.qDef.qFieldLabels[0]||a.qDef.qFieldDefs[0],h.model.createChild(b,h.properties).then(function(){return b.qListObjectDef}))})})):void 0},removeDimension:function(a){var b=this.layout.qChildList.qItems[a];return this.model.removeChild(b.qInfo.qId,this.properties).then(function(){return b})},getDimensionLayouts:function(){return this.dimensionLayout||[]},getDimensionLayout:function(a){var b=this.getDimensionLayouts();return b[a]?b[a].qListObject.qDimensionInfo:""}});return g}),define("text!extensions.qliktech/filterpane/filterpane.ng.html",[],function(){return'<qv-filterpane class="qv-filterpane" qv-collapsed-listbox-delegated-open outside-ignore-name="outsideIgnoreName">\r\n	<div ng-repeat="column in columns" class="qv-filterpane-column" ng-class="{\'qv-filterpane-column-scroll\' : column.scroll && object.expanded}">\r\n		<div ng-repeat="item in column.items"\r\n			 ng-class="{\'qv-filterpane-collapsed\': !item.expand, \'qv-filterpane-expanded\': item.expand}"\r\n			 ng-style="{height: item.height}"\r\n			 tid="qv-object-filterpane.dimension">\r\n			<qv-object ng-if="item.expand" model="item.model" options="item.options" style="height: 100%; overflow: hidden;"></qv-object>\r\n			<qv-collapsed-listbox ng-if="!item.expand" model="item.model" outside-ignore-name="outsideIgnoreName" responsive-mode="item.responsiveMode"></qv-collapsed-listbox>\r\n		</div>\r\n\r\n		<div ng-if="column.showAll && !options.isOnGrid" class="qv-filterpane-collapsed qv-filterpane-showall">\r\n			<div class="presentation" q-title-translation="Tooltip.Filterpane.NotAllItemsShow"></div>\r\n		</div>\r\n		<div ng-if="column.showAll && options.isOnGrid && object.expanded" class="qv-filterpane-collapsed qv-filterpane-showall">\r\n			<div class="presentation"></div>\r\n		</div>\r\n		<div ng-if="column.showAll && options.isOnGrid && !object.expanded" class="qv-filterpane-collapsed qv-filterpane-fullscreen">\r\n			<!-- options.isOnGrid: Set by GridController when creating options. object.expanded: Set by GridController when zooming -->\r\n			<button class="add-button qui-outlinebutton"\r\n					ng-class="{ \'qirby-disabled\': state.state }"\r\n					qva-activate="triggerFullScreen()"\r\n					q-title-translation="Tooltip.Filterpane.ClickForFullScreen"></button>\r\n		</div>\r\n	</div>\r\n</qv-filterpane>\r\n'}),define("extensions.qliktech/filterpane/filterpane-layout",["qvangular","general.utils/responsive-state","general.utils/property-resolver"],function(a,b,c){var d=34,e=28,f=10,g=89,h=160,i=20,j=27,k=30;a.service("qvFilterpaneLayout",function(){return{getMaxColumns:function(a){return b.isSmallDevice?1:Math.floor((a.width+i)/(h+i))||1},getMaxItemsPerColumn:function(a){return Math.max(1,Math.floor((a.height+f)/(d+f)))},getDimensionCount:function(a){return a.qChildList.qItems.length},getColumnItemsCount:function(a){var b=0;return a.forEach(function(a){b+=a.itemCount}),b},getHeightOf:function(a){var b=(d+f)*a-f;return Math.max(b,0)},getDimensionCardinal:function(a){return c.getValue(a,"model.layout.qListObject.qDimensionInfo.qCardinal",void 0)},getHeightOfExpanded:function(a){var b=a*k+j+3;return b},doesAllFit:function(a,b,c){return a*b>=c},haveRoomToExpandOne:function(a,c){var d=c.itemCount>1?f:0;return b.isSmallDevice?!1:a.height>this.getHeightOf(c.itemCount-1)+g+d},getSize:function(a,b){return{width:a.innerWidth()-1,height:a.innerHeight(),dimensionCount:this.getDimensionCount(b)}},sizeChanged:function(a,b){return!angular.equals(a,b)},calculateColumns:function(a,c){var d=!b.isSmallDevice&&a.height>g,h=this.getMaxColumns(a),i=this.getMaxItemsPerColumn(a),j=this.getColumnItemsCount(c);d&&this.doesAllFit(i,h-c.length-1,a.dimensionCount-j-1)?(c.push({expand:!0,itemCount:1}),j+1<a.dimensionCount&&this.calculateColumns(a,c)):(c.push({expand:!1,itemCount:b.isSmallDevice?a.dimensionCount-j:Math.min(a.dimensionCount-j,i)}),b.isSmallDevice&&(c[c.length-1].scroll=!0),c.length>=h&&i>0&&this.getColumnItemsCount(c)<a.dimensionCount&&(c[c.length-1].showAll=!0,e+f>a.height-this.getHeightOf(i)&&(c[c.length-1].itemCount=Math.max(c[c.length-1].itemCount-1,0))),this.getColumnItemsCount(c)<a.dimensionCount&&c.length<h&&this.calculateColumns(a,c))},balanceColumns:function(a,b){var c,d,e;return c=b.filter(function(a){return a.expand}),d=b.filter(function(a){return a.expand===!1}),d.length>0&&!d.lastElement.showAll&&this.haveRoomToExpandOne(a,d.lastElement)?d[d.length-1].expandLast=!0:(e=this.getColumnItemsCount(d),d.forEach(function(a,b){var c,f;c=b<e%d.length?1:0,f=Math.floor(e/d.length)+c,a.itemCount=f},this)),d.concat(c)},getDimensions:function(a){return a.qChildList.qItems.map(function(a){return{id:a.qInfo.qId,expand:!1,height:void 0,responsiveMode:"full"}})},sortDimensions:function(a,b){var c;return c=a.qChildList.qItems.map(function(a){return a.qInfo.qId}),c.map(function(a){return b.filter(function(b){return b.id===a})[0]})},isValid:function(a){return!!a&&!!a.qChildList&&!!a.qChildList.qItems&&this.getDimensionCount(a)>0},mergeColumnsAndDimensions:function(a,b){return a.forEach(function(a){a.items=b.slice(0,a.itemCount),b=b.slice(a.itemCount)},this),a},reSizeArray:function(a,b,c,d){for(;a.length>b;)a.pop();for(;a.length<b;)a.push(c.extend(!0,{},d))},dimensionsEqual:function(a,b){return a.id===b.id&&a.expand===b.expand&&a.height===b.height},shouldDimensionBeUpdated:function(a,b){return!this.dimensionsEqual(a,b)},patchScope:function(a,b,c){this.resizeScopeArrays(a,b,c),a.columns.forEach(function(c,d,e){var f=b[d];e[d].showAll=f.showAll,e[d].scroll=f.scroll,e[d].expand=f.expand,e[d].expandLast=f.expandLast,e[d].itemCount=f.itemCount,c.items.forEach(function(b,c){this.shouldDimensionBeUpdated(b,f.items[c])&&(delete b.$$hashKey,delete b.model,b.expand||delete b.options,b.expand&&!b.options&&(b.options={isPopover:!1,isReadonly:a.object.isReadonly}),this.copyDimensionValues(f.items[c],b))},this)},this)},calculateExpandPriority:function(a,b){a.forEach(function(a){if(a.expandLast){for(var c=0,e=function(b){for(var d,e,f=a.items.length-1;f>=0;f--)if(d=this.getDimensionCardinal(a.items[f]),d&&5>d&&(e=this.getHeightOfExpanded(d),b>e&&!a.items[f].expand))return a.items[f].expand=!0,a.items[f].height=e+"px",c++,e;return!1},h=b.height-this.getHeightOf(a.itemCount-1)-f,i=0;h>g;){var j=e.call(this,h);if(!j)break;i+=j,h=b.height-this.getHeightOf(a.itemCount-c)-f-i}if(!c||h>g){var k=a.items[a.items.length-1];k.expand||(k.height=b.height-this.getHeightOf(a.itemCount-c-1)-i-f+"px",k.expand=!0)}}a.expand&&(a.items[0].expand=!0),1===a.items.length&&b.height<d-4&&(a.items[0].responsiveMode=b.height<.5*d?"spark":"small",a.items[0].height=b.height+"px")},this)},resolveAllModels:function(a,b,c,d){var e=[];return b.forEach(function(b,d){var f=a.columns[d]||{items:[]};b.items.forEach(function(a,b){var d=f.items[b]||{};(this.shouldDimensionBeUpdated(a,d)||!d.model)&&e.push(c(a))},this)},this),d.all(e)},resizeScopeArrays:function(a,b,c){a.columns.length!==b.length&&this.reSizeArray(a.columns,b.length,c,{items:[]}),a.columns.forEach(function(d,e){d.items.length!==b[e].items.length&&this.reSizeArray(a.columns[e].items,b[e].items.length,c,{})},this)},copyDimensionValues:function(a,b){Object.keys(a).forEach(function(c){b[c]=a[c]})},getResolveModelFunction:function(a,b){return function(c){return this.resolveModel(a,c,b)}.bind(this)},resolveModel:function(a,b,c){var d=a.get(b.id),e=new c;return d.then(function(a){return b.model=a,a.getLayout().then(function(){e.resolve()})}),e.promise}}})}),define("text!extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed.ng.html",[],function(){return'<div class="qv-collapsed-listbox" ng-class="{locked: isLocked, error: hasError, spark: responsiveMode == \'spark\', small: responsiveMode == \'small\'}" qva-outside-ignore-for="{{outsideIgnoreName}}">\r\n	<div class="error-layer"></div>\r\n	<div class="title" title="{{ title }}">\r\n		<span ng-if="isLocked" class="icon-toolbar-locked"></span>\r\n		<span class="title-text">{{ title }}</span>\r\n	</div>\r\n	<qv-state-count-bar ng-if="!hasError" cardinal="cardinal" state-counts="stateCounts"></qv-state-count-bar>\r\n	<i class="icon-triangle-right"></i>\r\n</div>'}),define("extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed",["qvangular","objects.models/listbox","text!./collapsed.ng.html","client.utils/state","client.views/state-count-bar/state-count-bar","objects/listbox-popover/listbox-popover-service"],function(a,b,c,d){a.directive("qvCollapsedListbox",function(){return{restrict:"E",replace:!0,template:c,scope:{model:"=",outsideIgnoreName:"=",responsiveMode:"="},require:"^qv-collapsed-listbox-delegated-open",link:function(c){c.title="",c.hasError=!1,c.isLocked=!1,b.bindLayout(c,"model",function(b){a.$apply(c,function(){var a=b.qListObject.qDimensionInfo;c.hasError=b.qListObject.qError||b.qListObject.qDimensionInfo.qError?!0:!1,c.cardinal=a.qCardinal,c.stateCounts=a.qStateCounts,c.isLocked=a.qStateCounts.qLocked>0,c.title=b.title,c.id=b.qInfo.qId})})}}}),a.directive("qvCollapsedListboxDelegatedOpen",function(){return{restrict:"A",scope:{outsideIgnoreName:"="},controller:["$scope","$element","qvListboxPopoverService",function(a,b,c){function e(a,b){return{left:a.position().left-b.position().left,top:a.position().top-b.position().top,right:b.width()-a.position().left-a.width(),bottom:b.height()-a.position().top-a.height()}}function f(a,b){var c,d=e(a,b);return c=Math.max(d.left,d.right)>Math.max(d.top,d.bottom)?d.left>d.right?"left":"right":d.top>d.bottom?"top":"bottom"}var g;b.on("qv-activate",".qv-collapsed-listbox:not(.error)",function(e){var h=angular.element(e.target).closest(".qv-collapsed-listbox"),i=h.isolateScope().model,j=h.isolateScope().id,k={qvaOutsideIgnoreFor:a.outsideIgnoreName,$alignToElement:h,position:f(h,b),collision:"flipfit"};if(e.preventDefault(),a.$parent.allowInteraction(d)){if(j===g)return c.close(),void(g=void 0);g=j,c.show(i,k,function(){g=void 0})}})}]}})}),define("extensions.qliktech/filterpane/properties/filterpane-data/filterpane-data",["jquery","touche","client.property-panel/components/components","client.property-panel/component-utils","client.property-panel/components/items/items","general.utils/property-resolver","general.utils/support","general.services/show-service/show-service","core.utils/deferred","core.models/rpc-base","objects.models/listbox","objects.utils/data-properties/listobject-handler","objects.error-handling/error-translation","translator","objects.add-popovers/add-dimension-popover","general.components/context-menu/context-menu-service","general.sortable/sortable-item-lists","general.models/library/dimension","text!client.property-panel/components/common/data.ng.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t={template:e.template,controller:["$scope",function(a){var b=a.definition.items||a.definition;a.items=Object.keys(b).filter(function(a){return b[a]}).map(function(a){var d=b[a];return{component:c.findComponent(d),definition:d,key:a}}),j.bindLayout(a,"args.model",function(b){a.args.handler.setLayout(b),a.$broadcast("layoutchanged",b)}),a.$on("saveProperties",function(b){b.stopPropagation(),a.$broadcast("datachanged",a.data),a.args.model.save()}),d.defineVisible(a,a.args.handler),d.defineReadOnly(a,a.args.handler)}]},u={template:s,controller:["$scope","$element","$timeout",function(c,d,e){function j(a){return f.getValue(a,"qListObjectDef.qDef.cId","")}function s(d){D&&(D.destroy(),D=null),d&&a(d.target).hasClass("pp-toplist-add-button")&&b.preventGestures(),c.adding=!1}function u(){e(function(){var a=d.find(".pp-toplist-content"),b=a.find(".pp-data-list").children().last();a[0].scrollTop=b[0].offsetTop-1},100)}function v(a){c.args.handler.setModel(c.args.model),c.args.handler.addFieldDimension(a.value,a.value).then(function(a){A.put(B+a.qDef.cId,!0),s(),u()})}function w(a){c.args.handler.setModel(c.args.model),c.args.handler.addLibraryDimension(a.libraryId).then(function(a){A.put(B+a.qDef.cId,!0),s(),u()})}function x(a){var b=new i,c={},d={};return a.forEach(function(a){c[a]={},d[a]=k.get(a)}),i.all(d).then(function(d){var e={},f={};Object.keys(d).forEach(function(a){var b=d[a];c[a].model=b,e[a]=b.getProperties(),f[a]=b.getLayout()}),i.all(e).then(function(d){a.forEach(function(a){c[a].properties=d[a]}),i.all(f).then(function(d){a.forEach(function(a){c[a].layout=d[a]}),b.resolve(c)})})}),b.promise}function y(a){if(a.qChildList){var b=a.qChildList.qItems.map(function(a){return a.qInfo.qId});r.getListLayout().then(function(a){x(b).then(function(d){if(c.sortableItemLists.reset(),b.forEach(function(b,e){var f=new l(c.definition,a,{}),g=d[b],h=g.properties,i=g.model,k=g.layout.qListObject.qDimensionInfo,n=j(h);f.setProperties(h),f.setLayout(g.layout);var o=F.createItem({title:function(){return k.qError?m.getDimensionError(k.qError.qErrorCode,!0):g.layout.title||k.qFallbackTitle||""},isInvalid:function(){return!!k.qError},data:h,id:b,cId:n,index:e,component:t,definition:C,templateSrc:"pp-data-item.ng.html",markerClass:"pp-dimension",args:{handler:f,cache:A,localeInfo:c.args.localeInfo,properties:h,model:i},expanded:A.get(B+n)||!1,sortable:c.definition.allowMove!==!1});F.addItem(o)}),F.isEmpty()){var e=F.createItem({id:"empty-item",templateSrc:"pp-empty-data-item.ng.html",index:-1});F.addItem(e)}})})}}function z(){F.items.forEach(function(a){a.expanded=!1,A.put(B+a.cId,!1)})}var A=c.args.cache,B="dimensions_",C={items:c.definition.items||[],grouped:c.definition.grouped};c.$on("layoutchanged",function(a){a.preventDefault()}),c.$on("datachanged",function(a){a.preventDefault()}),c.expandClicked=function(b,c){c.disabled||a(b.target).hasClass("pp-move-item")||(c.expanded=!c.expanded,A.put(B+j(c.data),c.expanded))},c.addClicked=function(b){c.addDisabled()||c.adding||(z(),D=h.show(o,{alignTo:a(b.target),position:"bottom",allowExpressionEditor:!0,closeAddPopover:s,addFieldDimension:v,addLibraryDimension:w}))},c.getAddLabel=function(){return n.get("properties.dimensions.add")},c.removeItem=function(a){c.args.handler.setModel(c.args.model),c.args.handler.removeDimension(a.index)},c.addDisabled=function(){return!c.args.handler.canAddDimension()};var D=null,E=null;c.openContextMenu=function(a,b){var d=p.menu();d.addItem({translation:"Common.Delete",tid:"delete",select:function(){c.removeItem(b)}}),E=p.show(d,{position:{x:a.pageX,y:a.pageY},docking:"Top"})},c.$on("layoutchanged",function(a,b){y(b)}),y(c.args.layout),c.sortableItemLists=q.create({options:{direction:"vertical",listKey:"list",listSelector:".pp-expandable-list",itemKey:"item",itemSelector:".qv-pp-sortable",itemDragSelector:".qv-pp-sortable-handle",gesture:{name:"swipe",options:{radiusThreshold:g.treatAsDesktop()?4:0,preventDefault:!1}}},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.addClass("qv-pp-sortable"),a.templateSrc="pp-data-item.ng.html"},onBegin:function(){this._super.apply(this,arguments),z()},onMove:function(){this._super.apply(this,arguments);var a=F.get().filter(function(a){return"empty-item"!==a.id}).map(function(a){return a.id});c.args.model.setChildArrayOrder(a)}});var F=c.sortableItemLists.createList(1,{title:n.get("Common.Dimensions"),tid:"dimensions"});c.$on("pp-open-path",function(a,b){var c=b.split("."),d=c[0],e=c[1];"dimensions"===d&&e&&(A.put(B+e,!0),u())}),c.$on("$destroy",function(){s(),E&&E.destroy()})}]};return c.addComponent("filterpane-data",u),u}),define("extensions.qliktech/filterpane/properties/filterpane-sorting/filterpane-sorting",["jquery","client.property-panel/components/components","client.property-panel/component-utils","client.property-panel/components/items/items","general.utils/property-resolver","core.utils/deferred","core.models/rpc-base","general.utils/support","objects.models/listbox","objects.utils/data-properties/listobject-handler","general.models/library/dimension","general.sortable/sortable-item-lists","objects.error-handling/error-translation","text!client.property-panel/components/common/sorting.ng.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={template:d.template,controller:["$scope",function(a){var d=a.definition.items||a.definition;a.items=Object.keys(d).filter(function(a){return d[a]}).map(function(a){var c=d[a];return{component:b.findComponent(c),definition:c,key:a}}),g.bindLayout(a,"args.model",function(b){a.args.handler.setLayout(b),a.$broadcast("layoutchanged",b)}),a.$on("saveProperties",function(b){b.stopPropagation(),a.$broadcast("datachanged",a.data),a.args.model.save()}),c.defineVisible(a,a.args.handler),c.defineReadOnly(a,a.args.handler)}]},p={template:n,controller:["$scope",function(b){function c(a){var b=new f,c={},d={};return a.forEach(function(a){c[a]={},d[a]=i.get(a)}),f.all(d).then(function(d){var e={},g={};Object.keys(d).forEach(function(a){var b=d[a];c[a].model=b,e[a]=b.getProperties(),g[a]=b.getLayout()}),f.all(e).then(function(d){a.forEach(function(a){c[a].properties=d[a]
}),f.all(g).then(function(d){a.forEach(function(a){c[a].layout=d[a]}),b.resolve(c)})})}),b.promise}function d(a){if(a.qChildList){var d=a.qChildList.qItems.map(function(a){return a.qInfo.qId});k.getListLayout().then(function(a){c(d).then(function(c){b.sortableItemLists.reset();var f=[];Object.keys(c).forEach(function(d,g){var h=new j(b.definition,a,{}),i=c[d],k=i.properties,l=i.model,s=i.layout.qListObject.qDimensionInfo,t=e.getValue(k,"qListObjectDef.qDef.cId");h.setProperties(k),h.setLayout(i.layout);var u;u=s.qError?m.getDimensionError(s.qError.qErrorCode,!0):s.title||s.qFallbackTitle||"",f.push(r.createItem({component:o,definition:q,title:function(){return u},isInvalid:function(){return!!s.qError},data:k,id:d,cId:t,priority:g+1,args:{handler:h,cache:n,localeInfo:b.args.localeInfo,properties:k,model:l},expanded:n.get(p+t)||!1,sortable:!0,templateSrc:"pp-sorting-item.ng.html"}))}),f.sort(function(a,b){var c=d.indexOf(a.id),e=d.indexOf(b.id);return c>e}),f.forEach(function(a){r.addItem(a)})})})}}function g(){r.items.forEach(function(a){a.expanded=!1,n.put(p+a.cId,!1)})}var n=b.args.cache,p="sorting_",q={items:b.definition.items||[],grouped:b.definition.grouped};b.$on("layoutchanged",function(a){a.preventDefault()}),b.$on("datachanged",function(a){a.preventDefault()}),b.expandClicked=function(b,c){c.disabled||a(b.target).hasClass("pp-move-item")||(c.expanded=!c.expanded,n.put(p+c.cId,c.expanded))},b.$on("layoutchanged",function(a,b){d(b)}),b.sortableItemLists=l.create({options:{direction:"vertical",listKey:"list",listSelector:".pp-expandable-list",itemKey:"item",itemSelector:".qv-pp-sortable",itemDragSelector:".qv-pp-sortable-handle",gesture:{name:"swipe",options:{radiusThreshold:h.treatAsDesktop()?4:0,preventDefault:!1}}},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.addClass("qv-pp-sortable"),a.templateSrc="pp-sorting-item.ng.html"},onBegin:function(){this._super.apply(this,arguments),g()},onMove:function(){this._super.apply(this,arguments);var a=r.get().map(function(a){return a.id});b.args.model.setChildArrayOrder(a)}});var r=b.sortableItemLists.createList(1,{tid:"sorting"})}]};return b.addComponent("filterpane-sorting",p),p}),define("extensions.qliktech/filterpane/filterpane",["qvangular","util","core.utils/deferred","objects.backend-api/field-api","extensions.qliktech/filterpane/filterpane-properties","extensions.qliktech/filterpane/filterpane-handler","objects.utils/data-properties/listobject-util","general.utils/property-mapper","objects.models/listbox","text!./filterpane.ng.html","objects.extension/base-controller","objects.extension/export-format","objects.extension/object-conversion","client.utils/state","extensions.qliktech/filterpane/filterpane-layout","extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed","extensions.qliktech/filterpane/properties/filterpane-data/filterpane-data","extensions.qliktech/filterpane/properties/filterpane-sorting/filterpane-sorting"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o,p,q=1e3,r=0,s=function(){return"filterpane-"+ ++r};return p=k.extend({size:{},columns:[],expandable:!1,init:function(a,b,c,d){this.$scope=a,this.$element=b,this.$timeout=c,this.filterpaneLayout=d,a.allowInteraction=this.allowInteraction.bind(this),a.object.throbberApi.off(),this.showThrobberTimeout=c(function(){a.object.throbberApi.show()},1e3),a.outsideIgnoreName=s(),a.columns=[],a.ext.expandable=function(){return this.expandable}.bind(this),a.state=n,a.options||(a.options={}),a.triggerFullScreen=function(){n.state||a.$emit("objectTrigger","zoomOnCell")}},onPaint:function(){this.update(this.$scope.layout)},onResize:function(){this.update(this.$scope.layout)},update:function(a){var d,e=this.size,f=this.$scope,g=this.columns,h=this.$element,j=this.filterpaneLayout,k=j.getSize(h,a),l=j.getResolveModelFunction(i,c);return j.sizeChanged(e,k)&&(this.size=e=k,this.columns=g=this.getColumns(e)),j.isValid(a)?(d=j.getDimensions(a),d=j.sortDimensions(a,d),g=j.mergeColumnsAndDimensions(g,d),void j.resolveAllModels(f,g,l,c).then(function(){j.patchScope(f,g,b),j.calculateExpandPriority(f.columns,e),this.$timeout.cancel(this.showThrobberTimeout),f.object.throbberApi.hide(),this.expandable=!f.columns.some(function(a){return a.items.some(function(a){var b=a.model;return b&&b.layout&&b.layout.qSelectionInfo&&b.layout.qSelectionInfo.qInSelections})})}.bind(this))):void(f.columns=g=[])},getColumns:function(a){var b=[];return this.filterpaneLayout.calculateColumns(a,b),this.filterpaneLayout.balanceColumns(a,b)},setInteraction:function(a){this.$scope.columns.forEach(function(b){b.items.forEach(function(b){b.expand&&(b.options.interactionEnabled=a)})})}}),p.$inject=["$scope","$element","$timeout","qvFilterpaneLayout"],o={type:"filterpane",template:j,BackendApi:d,filterpaneController:p,definition:e,initialProperties:{version:.96,qChildListDef:{qData:{info:"/qInfo"}}},data:{dimensions:{min:1,max:1e3}},expandable:function(){return!1},mapProperties:function(){this.mappedDefinition=h.mapDefinition(this.definition,this.type),this.dimensionDefinition={min:1}},getCreatePropertyHandler:function(){var a=this;return a.propertyHandler||(a.propertyHandler=new f(a.dimensionDefinition)),a.propertyHandler},addFieldDimension:function(b,c){return c.model.getProperties().then(function(d){var e=c.ext.getCreatePropertyHandler();return e.setProperties(d),e.setModel(c.model),e.addFieldDimension(b.value,"").then(function(b){a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)})})},addLibraryDimension:function(b,c){return c.model.getProperties().then(function(d){var e=c.ext.getCreatePropertyHandler();return e.setProperties(d),e.setModel(c.model),e.addLibraryDimension(b.libraryId,b.label).then(function(b){a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)})})},getDropFieldOptions:function(b,c,d){c.getDimensions().length<c.maxDimensions()&&(c.setModel(d),c.addFieldDimension(b.item.name,"").then(function(b){d.save(),a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)}))},getDropDimensionOptions:function(b,c,d){c.getDimensions().length<c.maxDimensions()&&(c.setModel(d),c.addLibraryDimension(b.item.id).then(function(b){d.save(),a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)}))},getDropMeasureOptions:function(a,b,c,d){d()},exportProperties:function(a){var b,c,d,e,f,g=new l,h=a.qProperty,i=g.data[0];for(c=0;c<a.qChildren.length;++c)b=a.qChildren[c].qProperty,i.dimensions.push({qDef:b.qListObjectDef.qDef,qLibraryId:b.qListObjectDef.qLibraryId,qOtherTotalSpec:b.qListObjectDef.qOtherTotalSpec||{qOtherMode:"OTHER_OFF",qOtherCounted:{qv:"10"}},title:b.title});if(h.qLayoutExclude&&h.qLayoutExclude.qHyperCubeDef){if(h.qLayoutExclude.qHyperCubeDef.qDimensions)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qDimensions.length;++c)i.dimensions.push(h.qLayoutExclude.qHyperCubeDef.qDimensions[c]);if(h.qLayoutExclude.qHyperCubeDef.qMeasures)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qMeasures.length;++c)i.measures.push(h.qLayoutExclude.qHyperCubeDef.qMeasures[c])}for(e in h)"qChildListDef"!==e&&(g.properties[e]=h[e]);if(h.qLayoutExclude||(h.qLayoutExclude={}),h.qLayoutExclude.disabled){for(e in h.qLayoutExclude.disabled)f=e,g.properties.hasOwnProperty(f)||(g.properties[f]=h.qLayoutExclude.disabled[e]);h.qLayoutExclude.disabled.previousShowTitles&&(g.properties.showTitles=!0)}for(delete h.qLayoutExclude,c=0;c<i.dimensions.length;++c)for(d=0;d<i.dimensions[c].qDef.qSortCriterias.length;++d)i.dimensions[0].qDef.qSortCriterias[d].qSortByFrequency=0,i.dimensions[0].qDef.qSortCriterias[d].qSortByState=0;return g},importProperties:function(a,c){var d,e,f,h={qChildren:[]},i={},j=a.data[0];d=q,i.qLayoutExclude||(i.qLayoutExclude={}),i.qLayoutExclude.disabled={};for(e in a.properties)"qLayoutExclude"===e?a.properties[e].quarantine&&(i.qLayoutExclude.quarantine=b.extend(!0,{},a.properties[e].quarantine)):c.hasOwnProperty(e)||"qMetaDef"===e?i[e]=a.properties[e]:i.qLayoutExclude.disabled[e]=a.properties[e];for(i=b.extend(!0,{},c,i),f=0;f<j.dimensions.length;++f)h.qChildren.length<d?h.qChildren.push({qProperty:g.createDefaultListBox(j.dimensions[f],j.dimensions[f].title),qChildren:[]}):(i.qLayoutExclude||(i.qLayoutExclude={}),i.qLayoutExclude.qHyperCubeDef||(i.qLayoutExclude.qHyperCubeDef={}),i.qLayoutExclude.qHyperCubeDef.qDimensions||(i.qLayoutExclude.qHyperCubeDef.qDimensions=[]),i.qLayoutExclude.qHyperCubeDef.qDimensions.push(j.dimensions[f]));for(f=0;f<j.measures.length;++f)i.qLayoutExclude||(i.qLayoutExclude={}),i.qLayoutExclude.qHyperCubeDef||(i.qLayoutExclude.qHyperCubeDef={}),i.qLayoutExclude.qHyperCubeDef.qMeasures||(i.qLayoutExclude.qHyperCubeDef.qMeasures=[]),i.qLayoutExclude.qHyperCubeDef.qMeasures.push(j.measures[f]);return m.importCommonProperties(i,a,c),i.showTitles&&(i.qLayoutExclude.disabled.previousShowTitles=!0,i.showTitles=!1),h.qProperty=i,h}},a.directive("qvFilterpane",function(){return{controller:p,require:["qvFilterpane","^qvObject"],replace:!0,restrict:"E",link:function(a,b,c,d){var e=d[0],f=d[1];f.addChildController(e)}}}),o}),define("extensions.qliktech/treemap/treemap-node",["objects.views/charts/shapes/container","objects.views/charts/shapes/display-object","objects.views/charts/renderers/canvas-renderer","objects.views/charts/renderers/canvas/rect","objects.views/charts/shapes/rect","objects.utils/shapes/rect"],function(a,b,c,d,e,f){var g=a.extend("TreemapNode",{init:function(a,b,c){this._super(),this.x=0,this.y=0,this.width=0,this.height=0,this.data.area=0,this.data.value=b||0,this.data.label=a||"",this.data.valueLabel=c||"",f.apply(this,[0,0,0,0])},pointInside:b.prototype.pointInside,containsPoint:e.prototype.containsPoint,intersectsLocalLine:e.prototype.intersectsLocalLine,getLocalPoints:e.prototype.getLocalPoints,getLocalBoundingRect:e.prototype.getLocalBoundingRect});return Object.keys(e.prototype).forEach(function(a){!g.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints"].indexOf(a)<0&&(g.prototype[a]=e.prototype[a])}),c._registerRenderFn(d.render,g),g}),define("extensions.qliktech/treemap/treemap-layout",["core.utils/class","extensions.qliktech/treemap/treemap-node","translator"],function(a,b,c){var d,e=24,f=4,g=8e3,h=4e3,i={NONE:0,NONE_COLLAPSED:.1,LEAF:1,HEADER:2,OVERLAY:3};return d=a.extend("TreemapLayout",{init:function(){this.cellPadding=2,this.collapseHeadersOnSmallBranches=!0,this.labeling={},this.othersLabel=c.get("properties.dimensionLimits.others")},sort:function(){return this},weigh:function(a,c,d){if(!a||!a.length)return this;d=d||0;for(var e,f,g=a.length,h=0,i=0,j=a[0].parent.data.value;g;)h+=a[--g].data.value;for(g=a.length,e=Math.max(h,j);g;)a[--g].data.weight=e?a[g].data.value/e:0,i+=a[g].data.weight,a[g].isBranch&&this.weigh(a[g].children,c,d+1);return 1-i>1e-5&&(f=new b,f.data.label="",f.data.weight=1-i,f.x=0,f.y=0,f.width=0,f.height=0,f.data.qElemNo=-3,f.data.qType="O",f.data.isFakeOthers=!0,f.data.value=j-h,f.data.depth=(a[0].parent.data.depth||0)+1,a[0].parent.addChild(f),a[0].parent.children!==a&&a.push(f)),this},layout:function(){return this},arrange:function(a,b,c,d,g,h){if(!a||!a.length)return this;this.layout(a,b,c,d,g);var j,k,l,m=this.cellPadding;for(l=0;l<a.length;l++)j=a[l],j.visible=j.width>0&&j.height>0,j.isBranch?(j.width=Math.max(0,j.width-m),j.height=Math.max(0,j.height-m),j.x+=.5*m,j.y+=.5*m,j.visible=j.width>0&&j.height>0,j.data.labelType=this._getLabelType(h,!0,j.data.area),k=j.data.labelType!==i.HEADER?0:e,j.data.labelType===i.NONE_COLLAPSED&&(k=f,j.data.labelType=i.NONE),this.arrange(j.children,j.width,j.height-k,j.x,j.y+k,h+1)):j.data.labelType=this._getLabelType(h,!1,j.data.area);return this},_getLabelType:function(a,b,c){return b?a>this.labeling.headers.numLevels?i.NONE:a===this.labeling.headers.numLevels?this.labeling.overlay.show&&c>=h?i.OVERLAY:i.NONE:this.collapseHeadersOnSmallBranches&&g>c?i.NONE_COLLAPSED:h>c?i.NONE:i.HEADER:h>c||"none"===this.labeling.leaves.type?i.NONE:i.LEAF}}),d.LABEL=i,d}),define("extensions.qliktech/treemap/treemap-squarified-layout",["extensions.qliktech/treemap/treemap-layout"],function(a){function b(a,b,c){var d,f,g,h=c.x,i=c.y,j=c.shortSide,k=a.length,l=0;if(c.direction===e){for(;k>l;l++)g=a[l],g.data.area<=0?(f=0,d=j):(f=j*g.data.area/b,d=g.data.area/f),g.x=Number(h.toFixed(5)),g.y=Number(i.toFixed(5)),g.width=Number(d.toFixed(5)),g.height=Number(f.toFixed(5)),i+=f;c.x+=d,c.width-=d}else{for(;k>l;l++)g=a[l],g.data.area<=0?(d=0,f=j):(d=j*g.data.area/b,f=g.data.area/d),g.x=Number(h.toFixed(5)),g.y=Number(i.toFixed(5)),g.width=Number(d.toFixed(5)),g.height=Number(f.toFixed(5)),h+=d;c.y+=f,c.height-=f}}function c(a,b,c,d){for(var e,f,g=Number.MAX_VALUE,h=0,i=b*b,j=c*c,k=a.length;k;)a[--k].data.area<g&&(g=a[k].data.area),a[k].data.area>h&&(h=a[k].data.area);return e=Math.max(i*h/j,j/(i*g)),d.data.area<g&&(g=d.data.area),d.data.area>h&&(h=d.data.area),j=(c+d.data.area)*(c+d.data.area),f=Math.max(i*h/j,j/(i*g)),e>=f}var d,e=0,f=1;return d=a.extend({init:function(){this._super()},sort:function(a){var b,c;if(!a||!a.length)return this;for(a.sort(function(a,b){return"O"===b.data.qType?-1:"O"===a.data.qType?1:b.data.weight-a.data.weight}),c=a.length,b=0;c>b;b++)a[b].isBranch&&this.sort(a[b].children);return this},layout:function(a,d,g,h,i){if(!a||!a.length)return this;var j,k,l,m,n={x:h,y:i,width:d,height:g,direction:d>=g?e:f,shortSide:Math.min(g,d)},o=0,p=[],q=d*g;for(k=a.length;k;)a[--k].data.area=q*a[k].data.weight;for(k=0;k<a.length;)j=a[k],n.direction===e?(m=n.height*j.data.area/(o+j.data.area),l=j.data.area/m):(l=n.width*j.data.area/(o+j.data.area),m=j.data.area/l),!p.length||c(p,n.shortSide,o,j)?(o+=j.data.area,p.push(j),k++):(b(p,o,n),o=0,p=[],n.shortSide=Math.min(n.width,n.height),n.direction=n.height<=n.width?e:f);return p.length&&b(p,o,n),this}})}),define("extensions.qliktech/treemap/treemap-hierarchy",["core.utils/class","extensions.qliktech/treemap/treemap-node"],function(a,b){function c(a,d,e,g,h,i,j){var k,l,m,n,o,p=d?d.length:0;for(g=g||0,j=j||0,o=0;p>o;o++)k=null,m=d[o],l=m.children,m.data.qType===f.PSEUDO&&(j=o),m.data.qType!==f.TOTAL&&(l.length?1===l.length&&l[0].data.qType===f._MEASURE?(n=l[0].children,n=n?n[0]:null,n&&!isNaN(n.data.qValue)&&n.data.qValue>0&&(k=new b(m.data.qText,n.data.qValue,i?i.formatValue(n.data.qValue):n.data.qText),k.data.row=m.data.rowIndex,k.data.qType=m.data.qType,k.data.qElemNo=m.data.qElemNo,m.cacheItem&&m.cacheItem.addShape("dataArea",k),k.data.cacheItem=m.cacheItem)):1===l.length&&l[0].data.qType===f.VALUE?!isNaN(l[0].data.qValue)&&l[0].data.qValue>0&&(k=new b(m.data.qText,l[0].data.qValue,i?i.formatValue(l[0].data.qValue):l[0].data.qText),k.data.row=m.data.rowIndex,k.data.qType=m.data.qType,k.data.qElemNo=m.data.qElemNo,m.cacheItem&&m.cacheItem.addShape("dataArea",k),k.data.cacheItem=m.cacheItem):m.data.qMaxPos>0&&(k=new b(m.data.qText,m.data.qMaxPos),k.data.qElemNo=m.data.qElemNo,k.data.row=m.data.rowIndex,k.data.qType=m.data.qType,k.data.cacheItem=m.cacheItem,k.data.addMeasures=!0,m.cacheItem&&m.cacheItem.addShape("dataArea",k),c(k,l,e,g+1,h,i,j)):!isNaN(m.data.qValue)&&m.data.qValue>0&&(k=new b(m.data.qText,m.data.qValue,m.data.qText),k.data.qType=m.data.qType,k.data.qElemNo=m.data.qElemNo,k.data.row=m.data.rowIndex,k.data.isMeasure=g===e,m.cacheItem&&m.cacheItem.addShape("dataArea",k),k.data.cacheItem=m.cacheItem),k&&(k.data.depth=g,isNaN(j)||(k.data.measureIndex=j),a.addChild(k)))}function d(a){var b=[];return a.forEach(function(a){b=b.concat(a.children)}),b}var e,f={PSEUDO:"P",TOTAL:"T",VALUE:"V",NORMAL:"N",OTHERS:"O",ROOT:"R",_MEASURE:"_M"};return e=a.extend("TreemapHierarchy",{init:function(a){this.root=a||new b,this._pseudoDimPos=0,this.labeling={values:{show:!1}}},setData:function(a,b){this._pseudoDimPos=a.pseudoDimPos||0,this._numMeasures=a.qHyperCube.qMeasureInfo.length,this._numDimensions=a.qHyperCube.qDimensionInfo.length,this._dimensionLocks=a.qHyperCube.qDimensionInfo.map(function(a){return a.qLocked}),this._selectionStates=a.qHyperCube.qDimensionInfo.map(function(a){return a.qStateCounts});var d=this.labeling.values.show&&this.measureFormatters&&this.measureFormatters[0]&&"U"===this.measureFormatters[0].type?this.measureFormatters[0]:null,e=a.qHyperCube.qStackedDataPages[0].qData,g=a.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle}),h=a.qHyperCube.qMeasureInfo.length>1?this._pseudoDimPos:-1;this.root.removeChildren(),e&&e.length&&(this.root.data.value=e[0].qMaxPos,this.root.data.qType=f.ROOT,c(this.root,b.children,h,0,g,d))},getDimensionIndexFromNode:function(a){var b,c,d=0;if(!a)return-2;if(a.data.qType===f.PSEUDO)return-1;for(b=a,c=b.parent;b&&c&&c!==this.root;)b=c,c=b.parent,b.data.qType!==f.PSEUDO&&d++;return d},getSelectableCacheItems:function(a){if(!a||!a.length)return[];var b,c=a[0],e=c.children,g=this.getDimensionIndexFromNode(c);return c.data.qType===f.PSEUDO?e.length?this.getSelectableCacheItems(d(a)):[]:this._dimensionLocks[g]?e.length?this.getSelectableCacheItems(d(a)):[]:(b=this.getCacheItemsFromNodes(a),b.length<=1&&this._selectionStates[g].qSelected&&!this._selectionStates[g].qOption&&e.length?this.getSelectableCacheItems(d(a)):b)},getCacheItemsFromNodes:function(a){var b,c=a?a.length:0,d=[];for(b=0;c>b;b++)a[b].data.cacheItem&&d.indexOf(a[b].data.cacheItem)<0&&d.push(a[b].data.cacheItem);return d}})}),define("extensions.qliktech/treemap/treemap-area",["general.utils/color","./treemap-squarified-layout","./treemap-hierarchy","general.utils/property-resolver","objects.views/charts/renderers/canvas-renderer","objects.views/charts/shapes/rect","objects.views/charts/shapes/container","objects.views/charts/shapes/text","objects.views/charts/components/chart-component","objects.views/charts/chart-style-service"],function(a,b,c,d,e,f,g,h,i,j){function k(b,c){var d=1;return v.width=8*d,v.height=8*d,w.save(),w.fillStyle=a.toRGBA(b),w.strokeStyle=a.toRGBA(b,c),w.lineWidth=2,w.scale(d,d),w.beginPath(),w.moveTo(5,-1),w.lineTo(-1,5),w.moveTo(9,3),w.lineTo(3,9),w.stroke(),w.restore(),w.createPattern(v,"repeat")}function l(b,c){var d,e,f,g,i,j,k,m=b?b.length:0,n="leaf",o=new a(this._style.overlay.label.color.light),p=new a(this._style.overlay.label.color.dark),t=function(a,b){return b.data.isColorDark?a+b.data.value:a};for(d=0;m>d;d++)if(e=b[d],n=e.data.labelType,e.isBranch?(l.apply(this,[b[d].children,c+1]),j=this._branchLabelContainer):j=this._leafLabelContainer,e.data.labelType){switch(g=e.data.label,g&&g.length>512&&(g=g.substr(0,256)),this.labeling.values.show&&1===n&&e.data.valueLabel&&(g=[g,e.data.valueLabel]),e.data.labelShape?e.data.labelShape.parent||j.addChild(e.data.labelShape):(e.data.labelShape=new h,e.data.labelShape.setText(g),j.addChild(e.data.labelShape)),i={x:e.x,y:e.y,width:e.width,height:e.height,maxHeight:e.height-4,maxWidth:e.width-8,align:"left",baseline:"top"},n){case 3:e.data.labelFill||(k=e.descendants,e.data.labelFill=k.reduce(t,0)>e.data.value/2?o:p,e.data.labelStroke=e.data.labelFill===o?"rgba(33, 33, 33, 0.4)":"rgba(230, 230, 230, 0.4)",e.data.labelFill=e.data.labelFill.toRGBA(),e.data.labelShape.strokeFirst=!0),i.fill=e.data.labelFill,i.stroke=e.data.labelStroke,i.maxNumLines=/\s+/.test(e.data.label)?2:1,f=Math.round(.1*Math.sqrt(2*e.data.area)),i.font=this._styleService.getFont(q,"overlay.label",null,null,f),i.strokeWidth=f>64?2:1,i.align="center",i.baseline="middle";break;case 2:i.fill=this._style.branch.label.color,i.x+=4,i.width-=4,i.font=this._style.branch.label.font,i.baseline="middle",i.maxNumLines=1,i.height=r;break;default:i.fill=e.data.isColorDark?this._style.leaf.label.color.light:this._style.leaf.label.color.dark,i.x+=4,i.y+=4,i.width-=4,i.height-=4,i.font=this.labeling.leaves.type===s.DYNAMIC?this._styleService.getFont(q,"leaf.label",null,null,Math.round(.1*Math.sqrt(2*e.area))):this._style.leaf.label.font,i.baseline="top",i.maxNumLines=this.labeling.values.show?[-1,1]:[-1]}e.data.labelShape.attrs(i)}else e.data.labelShape&&e.data.labelShape.detach()}function m(b){var c,d,e,f=b?b.length:0,g=this._colorMap;for(c=0;f>c;c++)b[c].isBranch?(b[c].fill=this._style.branch.fill,b[c].stroke=null,m.call(this,b[c].children)):b[c].data.isInitiated||(e=[],"P"!==b[c].data.qType&&"undefined"!=typeof b[c].data.qElemNo&&e.push(b[c].data.qElemNo),b[c].ancestors.forEach(function(a){["A","N"].contains(a.data.qType)&&e.push(a.data.qElemNo)}),e.reverse(),b[c].data.isInitiated=!0,b[c].data.color=g.getColor(e,b[c].data.value,b[c].data.measureIndex||0,b[c].data.row),d=b[c].data.isFakeOthers?this._branchColorAtDepth[b[c].data.depth]:b[c].data.color,b[c].data.isColorDark=a.getBestContrast(d,t,u)===t,b[c].fill=b[c].data.isFakeOthers?this._fakeOthersPatternAtDepth[b[c].data.depth]:b[c].data.color.toRGBA(),b[c].stroke=this._sheetBackgroundStroke,b[c].strokeWidth=1)}function n(a){var b={backgroundColor:a.getValue(q,null,"backgroundColor"),branch:{fill:a.getValue(q,"branch","fill"),label:{color:a.getValue(q,"branch.label","color"),font:a.getFont(q,"branch.label")}},leaf:{border:{width:{"default":a.getValue(q,"leaf.border","width"),selected:a.getValue(q,"leaf.border","width","selected")},color:{"default":a.getValue(q,"leaf.border","color"),selected:a.getValue(q,"leaf.border","color","selected")}},label:{font:a.getFont(q,"leaf.label"),color:{light:a.getValue(q,"leaf.label","color","light"),dark:a.getValue(q,"leaf.label","color","dark")}}},overlay:{label:{color:{light:a.getValue(q,"overlay.label","color","light"),dark:a.getValue(q,"overlay.label","color","dark")}}}};return b}function o(b,c){var d=b._a+c._a*(1-b._a),e=(b._r*b._a+c._r*c._a*(1-b._a))/d,f=(b._g*b._a+c._g*c._a*(1-b._a))/d,g=(b._b*b._a+c._b*c._a*(1-b._a))/d;return 0===d&&(e=f=g=0),new a(e,f,g,1)}var p,q="treemap",r=24,s={NONE:"none",STATIC:"static",DYNAMIC:"dynamic"},t=new a("#eee"),u=new a("#666"),v=document.createElement("canvas"),w=v.getContext("2d");return p=i.extend("TreeMapArea",{init:function(){this._super.apply(this,arguments),this.renderers={cells:new e(this.container,{name:"cell-layer"}),labels:new e(this.container,{name:"label-layer"}),selections:new e(this.container,{name:"selection-layer"})},this._layout=new b,this._hierarchy=new c(this.renderers.cells.stage),this._pseudoDimPos=0,this._labelSettings={values:{show:!1},headers:{show:!0,numLevels:1},overlay:{show:!0},leaves:{show:!0,type:"static"}},this._styleService=j.getInstance(),this._style=n(this._styleService),this._sheetBackgroundColor=new a(this._style.backgroundColor),this._sheetBackgroundStroke=a.toRGBA(this._sheetBackgroundColor,.5),this.labeling=this._labelSettings},cellPadding:2,setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setPseudoDimPos:function(a){this._pseudoDimPos=a},setDimensionTree:function(a){this._tree=a,this.invalidateProperties(),this.invalidateDisplay()},_updateSize:function(){this.invalidateDisplay()},_updateProperties:function(){if(this._data){d.getValue(this._data,"labels.auto")?(this.labeling.overlay.show=!0,this.labeling.headers.numLevels=0,this.labeling.leaves.type=s.STATIC):(this.labeling.overlay.show=d.getValue(this._data,"labels.overlay",!0),this.labeling.headers.numLevels=d.getValue(this._data,"labels.headers")&&this._layoutMode>3?1:0,this.labeling.leaves.type=d.getValue(this._data,"labels.leaves")?s.STATIC:s.NONE),this.labeling.values.show=d.getValue(this._data,"labels.values",!1),this._layout.labeling=this.labeling,this._hierarchy.measureFormatters=this.measureFormatters;var b=this._hierarchy.root.children;this._hierarchy.labeling=this.labeling,this._hierarchy.setData(this._data,this._tree),this._dimension=0;var c=this.renderers.labels.stage;c.removeChildren();var e=new g;c.addChild(e);var f=new g;c.addChild(f);var h=this._data.qHyperCube.qDimensionInfo.map(function(a){return a.supressOthers});this._layout.othersLabelByDimension=this._data.qHyperCube.qDimensionInfo.map(function(a){return a.othersLabel}),this._layout.weigh(b,h).sort(b),this._leafLabelContainer=e,this._branchLabelContainer=f;var i=this._hierarchy.getSelectableCacheItems(b),j=this.selectionIdentifier?this.selectionIdentifier:"dataArea",l=0,n=0,p=i[0]?i[0].getShapes(j)[0]:null;p&&p.ancestors.forEach(function(a){a.parent&&("N"===a.data.qType&&l++,n++)}),this.setSelectionIndices([l]),this._dimension=n,this.setSelectableShapes(i);var q=new a(this._style.branch.fill),r=this._data.qHyperCube.qDimensionInfo.length+1;this._branchColorAtDepth=[o(q,this._sheetBackgroundColor)],this._fakeOthersPatternAtDepth=[];for(var t=1;r>t;t++)this._branchColorAtDepth.push(o(q,this._branchColorAtDepth[t-1]));for(t=0;r>t;t++)this._fakeOthersPatternAtDepth.push(k(this._colorMap.getColor([-3]),.1));this._dataChanged=!0,m.call(this,b),this.renderers.selections.stage.doInvalidate=!1,this.renderers.selections.stage.removeChildren()}},hasValidData:function(){return this._super()&&this._data},paint:function(){this._super(this._layoutMode,this._data);var a=this._hierarchy.root.children;this.renderers.cells.stage.opacity=this._globalAlpha||1,this.renderers.labels.stage.opacity=this._globalAlpha||1,this.renderers.selections.stage.opacity=1,this._layout.cellPadding=this.cellPadding*Math.sqrt(this.rect.width*this.rect.height)/500,this.labeling.headers.numLevels=(d.getValue(this._data,"labels.auto",!0)||d.getValue(this._data,"labels.headers"))&&this._layoutMode>3?1:0,a.length&&(this._dataChanged||this._oldW!==this.rect.width||this._oldH!==this.rect.height)&&(this._layout.arrange(a,this.rect.width-4,this.rect.height-4,this.rect.x,this.rect.y,0),l.apply(this,[a,0])),this._dataChanged=!1,this._oldW=this.rect.width,this._oldH=this.rect.height,this.renderers.cells.render(),this.renderers.labels.render(),this.renderers.selections.render()},release:function(){for(var a in this.renderers)this.renderers[a].release();this._selectableShapes=[],this.renderers={},this._hierarchy=null,this._layout=null,this._super()},toggleCacheItem:function(a){var b=!0;this.renderers.cells.stage.opacity!==this._globalAlpha?(b=!1,this.renderers.cells.stage.opacity=this._globalAlpha,this.renderers.labels.stage.opacity=this._globalAlpha,this.renderers.selections.stage.doInvalidate=!1):this.renderers.selections.stage.doInvalidate=!0,a.getShapes(this.selectionIdentifier?this.selectionIdentifier:"dataArea").forEach(function(c){a.selected?(c.data.borderShape||(c.data.borderShape=new f(c.x,c.y,c.width,c.height),c.data.borderShape.strokeWidth=this._style.leaf.border.width.selected,c.data.borderShape.stroke=this._style.leaf.border.color.selected,this.renderers.selections.stage.addChild(c.data.borderShape)),c.opacity=1,c.find("[data.labelShape]").forEach(function(a){a.data.labelShape.opacity=1,b&&a.data.labelShape.invalidate()}),c.data.labelShape&&(c.data.labelShape.opacity=1,b&&c.data.labelShape.invalidate())):(c.data.borderShape&&(c.data.borderShape.detach(),c.data.borderShape=null),c.opacity=void 0,c.data.labelShape&&(c.data.labelShape.opacity=void 0,b&&c.data.labelShape.invalidate()),c.find("[data.labelShape]").forEach(function(a){a.data.labelShape.opacity=void 0,b&&a.data.labelShape.invalidate()})),b&&c.invalidate()},this),b||(this.renderers.cells.render(),this.renderers.labels.render(),this.renderers.selections.render())}})}),define("text!extensions.qliktech/treemap/treemap.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNegativeOrZero && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" q-title-translation="Object.Disclaimer.OnlyNegativeOrZeroValues"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData"></span>\r\n<div qva-chart-disclaimer options="dataAttributes" visible="!dataAttributes.onlyNegativeOrZero"></div>'}),define("extensions.qliktech/treemap/treemap-properties",["general.utils/property-resolver"],function(a){function b(b,c){var d=a.getValue(b,"color.auto"),e=a.getValue(b,"color.mode"),f=c.getMeasures(),g=c.getDimensions();return g.length>1&&f.length<=1&&!d&&"byDimension"===e}function c(a,b){var c=b.getDimensions(),d=b.getMeasures();return d.length+c.length>2}var d;d={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!1,items:{labels:{type:"items",items:{auto:{ref:"labels.auto",type:"boolean",translation:"properties.dataPoints.headersAndLabels",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],snapshot:{tid:"property-dataPoints"}},headers:{ref:"labels.headers",translation:"properties.dataPoints.headers",type:"boolean",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b,d){return!a.getValue(b,"labels.auto")&&c(b,d)}},overlay:{ref:"labels.overlay",type:"boolean",component:"switch",translation:"properties.dataPoints.overlayLabels",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b,c){return!a.getValue(b,"labels.auto")&&c.getDimensions().length-(a.getValue(b,"labels.headers")?1:0)>1}},leaves:{ref:"labels.leaves",type:"string",translation:"properties.dataPoints.leafLabels",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b){return!a.getValue(b,"labels.auto")},snapshot:{tid:"property-leafLabels"}},values:{ref:"labels.values",type:"boolean",component:"switch",translation:"properties.dataPoints.labelmode",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b){return a.getValue(b,"labels.auto")||a.getValue(b,"labels.leaves")}}}}}},colorsAndLegend:{uses:"colorsAndLegend",translation:"properties.colors",items:{colors:{items:{dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-dropdown",translation:"properties.colorDimensionId",show:function(a,c){return b(a,c)}}}},legend:{show:!1}}}}};var e={uses:"data",items:{dimensions:{},measures:{}}};return{type:"items",component:"accordion",items:{data:e,settings:d}}}),define("extensions.qliktech/treemap/treemap-data",["general.utils/property-resolver"],function(a){function b(b,c){var d=c.getDimensions(),e=c.getMeasures(),f=a.getValue(b,"color.mode");d.length>1&&b.color&&(b.color.persistent=!0),"byMeasure"===f&&e.length>1?a.setValue(b,"color.mode","byDimension"):"byExpression"===f&&0===e.length&&a.setValue(b,"color.mode","primary")}function c(b,c){a.setValue(c,"color.dimensionId",void 0)}var d={dimensions:{min:1,max:15,add:function(a,c,d){b(c,d)},remove:function(a,d,e){c(a,d,e),b(d,e)},replace:function(b,c,d,e){a.getValue(e,"color.dimensionId")===c.qDef.cId&&a.setValue(e,"color.dimensionId",b.qDef.cId)}},measures:{min:1,max:1,add:function(a,c,d){b(c,d)},remove:function(a,c,d){b(c,d)}}};return d}),define("extensions.qliktech/treemap/treemap",["jquery","./treemap-area","client.utils/state","text!./treemap.ng.html","objects.views/charts/chart","objects.backend-api/stacked-api","objects.views/charts/disclaimers/chart-utils","extensions.qliktech/treemap/treemap-properties","extensions.qliktech/treemap/treemap-data","objects.views/charts/components/chart-component","objects.views/charts/representation/combo-color-map","objects.extension/object-conversion","objects.views/charts/disclaimers/chart-disclaimer-directive","touche"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n=".treemap";return m=e.extend("Treemap",{init:function(c,d,e,f){this._data={},e=a.extend(!0,e||{},{debug:!0,providers:{colorMap:{clazz:k,multiDimScheme:"first"}},components:{dataArea:{clazz:b,show:!0,dock:"center",showFlag:j.prototype.ShowFlags.SPARK},xAxisTitle:{show:!1,order:1,dock:"top",relevantSize:30,showFlag:j.prototype.ShowFlags.SMALL}}}),this._super(c,d,e,f)
},off:function(){Touche(this.container).off("*",n),this._super()},initSelections:function(){this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(function(a){var b=this.components.dataArea._dimension;this._selectedRows.length?this.backendApi.select(this._selectedRows,[b],"L"):a.length&&a.every(function(a){return!a.selected})&&this.backendApi.clearSelections()}.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this))},_paint:function(){if(this._super()===!1)return!1;this.layout();var a;for(a in this.components)this.components[a].invalidateDisplay("Treemap.paint")},prePaint:function(a){g.applyDisclaimerAttributes({title:!0,bottom:!0,overlay:!0,supportNegative:!1},this.$scope.dataAttributes,this.$element,this.$scope,c,a)},_updateData:function(a){this._data=a,this._super(a),this.providers.colorMap.setData(a),this.components.dataArea.setData(a),this.providers.colorMap.setDimensionTree(this._chartContext.getDimensionTree()),this.components.dataArea.setDimensionTree(this._chartContext.getDimensionTree()),this.components.dataArea.cellPadding=2,this.components.dataArea.setPseudoDimPos(0)},toggleCacheItem:function(a){for(var b in this.components)this.components[b].toggleCacheItem?this.components[b].toggleCacheItem(a):this.components[b].invalidateDisplay("Treemap#toggleCacheItem")}}),{type:"treemap",BackendApi:f,template:d,View:m,definition:h,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"K",qNoOfLeftDims:-1,qMaxStackedCells:3e3,qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:3e3,qLeft:0,qWidth:30}],qSuppressZero:!1,qSuppressMissing:!0}},data:i,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},legend:{}}},importProperties:l.colorChart.importProperties.bind(l),exportProperties:l.colorChart.exportProperties.bind(l)}}),define("objects.utils/font-manager",["core.utils/class"],function(a){function b(a,b,c){return b>a?0:a>c?1:(a-b)/(c-b)}var c;return c=a.extend("FontManager",{init:function(){this._minFontSize=10,this._maxFontSize=20,this._minRectSize=100,this._maxRectSize=900,this._fontWeight="normal",this._fontFamily="QlikView Sans",this._fontSize=10},setFontWeight:function(a){this._fontWeight=a},setFontFamily:function(a){this._fontFamily=a},setRectLimits:function(a,b){this._minRectSize=a,this._maxRectSize=b},getFont:function(a,c){var d=Math.min(a.height,a.width),e=c&&c.minFontSize?c.minFontSize:this._minFontSize,f=c&&c.maxFontSize?c.maxFontSize:this._maxFontSize,g=b(d,this._minRectSize,this._maxRectSize);return this._fontSize=e+Math.round(g*(f-e)),this._fontWeight+" "+this._fontSize+"px "+this._fontFamily},getFontSize:function(a,c){var d=Math.min(a.height,a.width),e=c&&c.minFontSize?c.minFontSize:this._minFontSize,f=c&&c.maxFontSize?c.maxFontSize:this._maxFontSize,g=b(d,this._minRectSize,this._maxRectSize);return e+Math.round(g*(f-e))}})}),define("extensions.qliktech/gauge/gauge-helper",["core.utils/class","objects.utils/shapes/rect","objects.utils/shapes/line","objects.utils/shapes/arc","general.utils/color","objects.views/charts/components/axis/radial-axis-helper","objects.views/charts/utils/matrix","objects.utils/font-manager"],function(a,b,c,d,e,f,g,h){function i(a,b,c){return{x0:a.x0,y0:a.y0,x1:a.x1,y1:a.y1,limits:b,colors:c}}var j,k=[0,1],l=[0,.5,1];return j=a.extend("GaugeHelper",{init:function(){this._padding=0,this._colorWidth=50,this._maxWidth=50,this._labelPadding=10,this._fontManager=new h,this._fontManager.setRectLimits(100,1e3),this._bigValuesSettings={minFontSize:12,maxFontSize:60}},createBarSegments:function(a,c,d,f){if(!a||0===a.colors.length)return[];var g,h,j,m,n,o,p,q,r,s,t,u=[],v=a.colors,w=a.limits,x=this._colorWidth,y={value:0,gradient:!1},z=v[0].color;for(w=w.map(function(a){return{value:(a.value-c.getPlotMin())/(c.getPlotMax()-c.getPlotMin()),gradient:a.gradient}}),g=0;g<v.length;g++)o=w[g]?w[g]:{value:1,gradient:!1},r=v[g+1]?v[g+1].color:v[g].color,j=o.value,n=v[g].color,p=c.getPositionOfNormalizedValue(j),q=c.getPositionOfNormalizedValue(0===g?0:w[g-1].value),d?(x=f.width<10?f.width:this._colorWidth,h=new b(this._relevantPos,p,x,q-p)):(x=this._colorWidth,h=new b(q,this._relevantPos,p-q,x)),s={x0:h.x,y0:h.y+(d?h.height:0),x1:h.x+(d?0:h.width),y1:h.y},y&&y.gradient&&!o.gradient?(z=new e(n).blend(new e(z),.5),m={gradient:i(s,k,[z,n])}):o.gradient?(r=new e(n).blend(new e(r),.5),y.gradient?(z=new e(n).blend(new e(z),.5),m={gradient:i(s,l,[z,n,r])}):m={gradient:i(s,k,[n,r])}):m=n,t={type:"rect",shape:h,opacity:1,fill:m,stroke:m},u.push(t),z=n,y=o;return u},createBarProgress:function(a,c,d,f,g){var h,i,j,k,l,m=[],n=new e(d),o=new e(this.style.area.color);return a=isNaN(a)?0:a>1?1:0>a?0:a,j=c.getPositionOfValue((c.getPlotMax()-c.getPlotMin())*a+c.getPlotMin()),this._labelPadding=this._colorWidth/2,k=this._colorWidth,l=this._relevantPos,i=f?new b(l,j,k,g.height):new b(0,l,j,k),h={type:"rect",shape:i,opacity:1,fill:n.toHex(),stroke:n.createShiftedColor().toHex(),strokeWidth:1},m.push(h),i=f?new b(l,0,k,j):new b(j,l,g.width,k),h={type:"rect",shape:i,opacity:1,fill:o.toHex(),stroke:o.createShiftedColor(.1).toHex(),strokeWidth:1},m.push(h),m},createGaugeMeterValue:function(a,b,c,d,e,f,g){var h={x:0,y:0,align:"center",font:g,baseline:"bottom",text:b};return d?(a+f/2>e.height?(h.baseline="bottom",a=e.height):f/2>a?(h.baseline="top",a=0):h.baseline="middle",h.x=this._relevantPos+this._colorWidth+this._labelPadding,h.maxWidth=e.width-h.x,h.y=a,h.align="left"):(h.y=this._relevantPos+this._colorWidth+this._labelPadding+f,h.x=Math.max(Math.min(e.width-c/2,a),c/2),h.align="center"),{type:"text",ColorWidth:200,shape:h,font:g,opacity:1,fill:this.style.value.color}},createGaugeMeterPointer:function(a,b,d,e){var f,g,h=a>1?1:0>a?-1:0,i=[],j=this._relevantPos,k=Math.max(Math.round(this._colorWidth/25),2),l=50,m=l>j?10:this._colorWidth,n=Math.max(m,10)/6,o=this.style.pointer.color,p={type:"polygon",shape:f,opacity:1,fill:e?o:null,stroke:e?null:o,strokeWidth:k},q={type:"line",opacity:1,stroke:e?o:null,strokeWidth:k};return a=a>1?1:0>a?0:a,g=b.getPositionOfValue((b.getPlotMax()-b.getPlotMin())*a+b.getPlotMin()),d?(0!==h&&(f={points:[{x:j+m/2,y:g},{x:j-n+m/2,y:h*n*2+g},{x:j+n+m/2,y:h*n*2+g}]},p.shape=f,i.push(p)),f=new c(j,g,j+m,g)):(0!==h&&(f={points:[{y:j+m/2,x:g},{y:j-n+m/2,x:-h*n*2+g},{y:j+n+m/2,x:-h*n*2+g}]},p.shape=f,i.push(p)),f=new c(g,j,g,j+m)),q.shape=f,i.push(q),i},updateLabelStyle:function(a,b,c,d,e){this._bigValuesSettings={minFontSize:this.style.value.minFontSize,maxFontSize:this.style.value.maxFontSize},a.value.font=c.getFont(d,e,null,null,this._fontManager.getFontSize(b,this._bigValuesSettings))},createRadialSegments:function(a,b){if(!a||a.colors.length<1)return[];var c,f,g,h,j,m,n,o,p,q=[],r=a.limits,s=a.colors,t=this._colorWidth,u=s[0].color,v={value:0,gradient:!1},w=b._radialOptions.start,x=this._paddingToAxis;if(r=r.map(function(a){return{value:(a.value-b.getPlotMin())/(b.getPlotMax()-b.getPlotMin()),gradient:a.gradient}}),t=this._colorWidth*(b._relevantAngle>Math.PI?1:Math.sin(b._relevantAngle/4)),this._colorWidth=t,b._radius-t-x<0)return q;for(c=0;c<a.colors.length;c++)g=r[c]?r[c]:{value:1,gradient:!1},m=s[c+1]?s[c+1].color:s[c].color,f=s[c].color,j=b.getAngleOfNormalizedValue(g.value),h=new d(b._centerPoint.x,b._centerPoint.y,b._radius-t-x,b._radius-x,w,j,0),o={x0:h.x3,y0:h.y3,x1:h.x4,y1:h.y4},v&&v.gradient&&!g.gradient?(m=new e(f).blend(new e(u),.5),n={gradient:i(o,k,[m,f])}):g.gradient?(m=new e(f).blend(new e(m),.5),v.gradient?(u=new e(f).blend(new e(u),.5),n={gradient:i(o,l,[u,f,m])}):n={gradient:i(o,k,[f,m])}):n=f,p={type:"arc",shape:h,opacity:1,fill:n,stroke:n},q.push(p),w=j,v=g,u=f;return q},createRadialGaugeMeter:function(a,b){var c,d,e,h,i=f.getAngleOfNormalizedValue(a,b),j=Math.max(this._colorWidth,10)/6,k=2,l=new g;return l.save(),l.translate(b._centerPoint.x+Math.cos(i)*b._radius,b._centerPoint.y+Math.sin(i)*b._radius),l.rotate(i),a>1||0>a?(d=this._colorWidth*(b._relevantAngle>Math.PI?1:Math.sin(b._relevantAngle/4)),this._colorWidth=d,e=a>1?-1:1,c=-d*e/2,l.rotate(-e*Math.PI/2),h={type:"polygon",shape:{points:[{x:2*j+k,y:c},{x:k,y:j+c},{x:k,y:-j+c}]},opacity:1,transform:l.elements,fill:this.style.pointer.color}):h={type:"polygon",shape:{points:[{x:.5*-j+4,y:0},{x:8*-j,y:j},{x:8*-j,y:-j}]},opacity:1,transform:l.elements,fill:this.style.pointer.color},l.restore(),h},createRadialProgress:function(a,b,c,h){var i,j,k,l,m,n=c._radialOptions.start,o=isNaN(a)?n:f.getAngleOfNormalizedValue(a,c),p=c._radialOptions.end,q=Math.min(h.width,h.height),r=[],s=(q>500?this._maxWidth:Math.max(q/500*this._maxWidth,10))/6,t=2,u=this._paddingToAxis,v=new e(this.style.area.color),w=new g;return b=new e(b),j=this._colorWidth*(c._relevantAngle>Math.PI?1:Math.sin(c._relevantAngle/4)),this._colorWidth=j,c._radius-j-u<0?r:((a>1||0>a)&&(l=a>1?-1:1,k=-j*l/2,w.save(),w.translate(c._centerPoint.x+Math.cos(o)*c._radius,c._centerPoint.y+Math.sin(o)*c._radius),w.rotate(o-l*Math.PI/2),i={type:"polygon",shape:{points:[{x:2*s+t,y:k},{x:t,y:s+k},{x:t,y:-s+k}]},opacity:1,transform:w.elements,fill:b.toHex()},w.restore(),r.push(i)),w.save(),w.translate(c._centerPoint.x,c._centerPoint.y),o>n&&(m=new d(0,0,c._radius-j-u,c._radius-u,n,o,0),i={type:"arc",shape:m,opacity:1,transform:w.elements,fill:b.toHex(),stroke:b.createShiftedColor().toHex()},r.push(i)),p>o&&(m=new d(0,0,c._radius-j-u,c._radius-u,o,p,0),i={type:"arc",shape:m,opacity:1,transform:w.elements,fill:v.toHex(),stroke:v.createShiftedColor(.1).toHex()},r.push(i)),w.restore(),r)},createRadialGaugeValue:function(a,b,c,d,e,f){var g,h={x:d.width/2,y:.5*d.height-f/2+.05*Math.min(d.width,d.height),align:"center",font:e,baseline:"middle",text:b,maxWidth:1.4*c._radius};return g={type:"text",shape:h,opacity:1,fill:this.style.value.color},[g]},createRadialSpark:function(a,b,c,d){var e,h,i=.4*Math.min(d.width,d.height),j=f.getAngleOfNormalizedValue(a,c)+Math.PI/2,k=0,l=new g,m={type:"polygon",shape:{},opacity:1};if(l.translate(c._centerPoint.x,c._centerPoint.y),l.rotate(j),m.transform=l.elements,"string"!=typeof b)if(1===b.colors.length)m.fill=b.colors[0].color;else for(e=0;e<b.colors.length;e++){if(h=b.limits[e]?(b.limits[e].value-c.getPlotMin())/(c.getPlotMax()-c.getPlotMin()):1,a>=k&&h>a){m.fill=b.colors[e].color;break}k=h}else m.fill=b;return m.shape.points=d.width<d.height?[{x:0,y:-i},{x:-i/2,y:+i/2},{x:i/2,y:+i/2},{x:0,y:-i}]:[{x:-i/2,y:i/2},{x:0,y:-i},{x:+i/2,y:i/2},{x:-i/2,y:i/2}],[m]},getGaugeWidth:function(a,b){var c;return a&&(c=b?"width":"height",this._colorWidth=a[c]>500?this._maxWidth:Math.max(a[c]/500*this._maxWidth,10)),this._colorWidth},updateSize:function(a,b,c){var d,e=Math.min(a.width,a.height);d=c?e:b?a.width:a.height,this._colorWidth=d>500?this._maxWidth:Math.max(d/500*this._maxWidth,10),this._relevantPos=(d-this._colorWidth)/2,this._paddingToAxis=Math.min(6,e/200)},getPaddingToAxis:function(){return this._paddingToAxis},getRelevantPos:function(){return this._relevantPos},getPadding:function(){return this._padding}})}),define("extensions.qliktech/gauge/gaugearea",["jquery","objects.views/charts/components/chart-component","objects.views/charts/utils/canvas-renderer","objects.views/charts/chart-style-service","extensions.qliktech/gauge/gauge-helper","core.utils/theme"],function(a,b,c,d,e,f){function g(a,b){if(this._axis&&this._segmentInfo&&void 0!==this._axis.getPlotMin()&&void 0!==this._axis.getPlotMax()){var d=this._axis,e=this._style.value.font,f=d.isVertical(),g=c.getFontHeight(e),h=this._renderer.getTextWidth(a,e),i=this._axis.getPositionOfValue(b),j=(b-d.getPlotMin())/(d.getPlotMax()-d.getPlotMin()),k=[];this._data.useSegments?(k=this._gaugeHelper.createBarSegments(this._segmentInfo,d,f,this.rect),k=k.concat(this._gaugeHelper.createGaugeMeterPointer(j,d,f,!0))):(k=this._gaugeHelper.createBarProgress(j,d,this._progressColor,f,this.rect),(j>1||0>j)&&(k=k.concat(this._gaugeHelper.createGaugeMeterPointer(j,d,f,!1)))),!isNaN(j)&&(f&&this.rect.width>100||!f&&this.rect.height>100)&&k.push(this._gaugeHelper.createGaugeMeterValue(i,a,h,f,this.rect,g,e)),this._renderer.shapes=k,this._renderer.render()}}function h(a,b){if(!(!this._axis||!this._segmentInfo&&this._data.useSegments||this._axis._radius<=0)){var d=this._axis,e=this._style.value.font,f=c.getFontHeight(e),g=Math.min(this.rect.height,this.rect.width),h=(b-d.getPlotMin())/(d.getPlotMax()-d.getPlotMin()),i=[];50>g?i=this._gaugeHelper.createRadialSpark(h,this._data.useSegments?this._segmentInfo:this._progressColor,d,this.rect):(this._data.useSegments?(i=this._gaugeHelper.createRadialSegments(this._segmentInfo,d),isNaN(h)||i.push(this._gaugeHelper.createRadialGaugeMeter(h,d))):i=this._gaugeHelper.createRadialProgress(h,this._progressColor,d,this.rect),i=i.concat(this._gaugeHelper.createRadialGaugeValue(b,a,d,this.rect,e,f))),this._renderer.shapes=i,this._renderer.render()}}function i(a){return f.palette[a]?f.palette[a]:"number"==typeof a?"#000":a}function j(a){var b={value:{color:a.getValue(l,"value","color"),font:a.getFont(l,"value"),minFontSize:a.getValue(l,"value","minFontSize"),maxFontSize:a.getValue(l,"value","maxFontSize")},area:{color:a.getValue(l,"area","backgroundColor")},pointer:{color:a.getValue(l,"pointer","color")}};return b}var k,l="gauge";return k=b.extend({init:function(){this._super.apply(this,arguments),this._gaugeHelper=new e,this._type="bar",this._currentProperties={},this._transitionProperties={},this._inTransition=!1,this._cacheItems=[],this._renderer=new c(this.container),this.renderers={gauge:this._renderer},this._styleService=d.getInstance(),this._style=j(this._styleService),this._gaugeHelper.style=this._style},_updateSize:function(){this.invalidateDisplay("Gauge._updateSize")},_updateProperties:function(){if(this._data){var b=this._data;this._segmentInfo=a.extend(!0,{},b.segmentInfo),this._segmentInfo&&this._segmentInfo.limits&&(this._segmentInfo.limits=this._segmentInfo.limits.concat().sort(function(a,b){return a.value-b.value})),this._segmentInfo&&this._segmentInfo.colors&&(this._segmentInfo.colors=this._segmentInfo.colors.concat().map(function(a){return{color:i(a.color)}})),this._progressColor=i(this._data.progressColor),this._orientation=b.orientation,this._type=b.gaugetype,this._transitionProperties={value:b.qHyperCube.qDataPages[0].qMatrix[0][0].qNum,text:b.qHyperCube.qDataPages[0].qMatrix[0][0].qText},this._super()}},hasValidData:function(){return this._super()&&this._data},setAxis:function(a){this._axis=a,this._axis.listen("changed",function(){this.invalidateDisplay()},this)},setRefLines:function(a){this._refLines=a},setRefLineLabels:function(a){this._refLineLabels=a},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},paint:function(){if(this._axis){this._gaugeHelper.updateSize(this.rect,this._axis.isVertical(),this._axis.isRadial()),this._refLines&&(this._refLines.setPaddingToAxis(this._gaugeHelper.getPaddingToAxis()),this._refLines.setRelevantPos(this._gaugeHelper.getRelevantPos())),this._refLineLabels&&(this._refLineLabels.setPaddingToAxis(this._gaugeHelper.getPaddingToAxis()),this._refLineLabels.setRelevantPos(this._gaugeHelper.getRelevantPos())),this._gaugeHelper.updateLabelStyle(this._style,this.rect,this._styleService,l,"value");var a=this._data.qHyperCube.qDataPages[0].qMatrix[0][0],b=this.measureFormatters[0],c="U"!==b.type?a.qText:b.formatValue(a.qNum),d=this._currentProperties.value;this._inTransition&&(c=b.format(d)),this._axis.isRadial()?h.apply(this,[c,d]):g.apply(this,[c,d]),this._currentValue=d,this._refLines&&this._refLineLabels&&(this._refLines.setGaugeWidth(this._gaugeHelper.getGaugeWidth()),this._refLineLabels.setGaugeWidth(this._gaugeHelper.getGaugeWidth())),this.afterPaint()}},afterPaint:function(){},clear:function(){},getGaugeWidth:function(a,b){return this._gaugeHelper.getGaugeWidth(a,b)}}),Object.defineProperty(k.prototype,"className",{value:"GaugeArea"}),k}),define("extensions.qliktech/gauge/gauge-ref-lines",["objects.views/charts/components/ref-lines","core.utils/theme"],function(a,b){function c(a){return b.palette[a]?b.palette[a]:a}var d;return d=a.extend("GaugeRefLines",{namespace:".gaugereflines",init:function(){this._super.apply(this,arguments),this._width=50},paint:function(){if(this._super.apply(this,[].slice.call(arguments)),this._hasVisibleRefLines){var a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q=[],r=this._paddingToAxis,s=this._relevantPos;for(a=0;a<this._numRefLinesDataAxes;a+=1)for(d=this._data[a],e=this._axes[a],f=this._axisPlotMinValues[a],g=this._axisPlotMaxValues[a],b=0;b<d.length;b+=1)d[b].show&&void 0!==d[b].refLineExpr&&(h=this._currentProperties["value"+a+b],h>g||f>h||(e.isRadial()?(o=e._radius,p=e.getAngleOfValue(h),j=e._centerPoint.x+Math.cos(p)*(o-r),k=e._centerPoint.y+Math.sin(p)*(o-r),l=e._centerPoint.x+Math.cos(p)*(o-r-this._width),m=e._centerPoint.y+Math.sin(p)*(o-r-this._width)):(i=e.getPositionOfValue(h),i=Math.floor(i)-.5,e.isVertical()?(j=s,k=i,l=s+this._width,m=i):(j=i,k=s,l=i,m=s+this._width)),n=void 0!==d[b].color?c(d[b].color):"#000000",q.push({type:"line",stroke:n,strokeWidth:1,shape:{x1:j,y1:k,x2:l,y2:m}})));this.renderer.shapes=q,this.renderer.render()}},setGaugeWidth:function(a){this._width=a,this.updateSize(),this.invalidateDisplay()},setPaddingToAxis:function(a){this._paddingToAxis=a},setRelevantPos:function(a){this._relevantPos=a}})}),define("extensions.qliktech/gauge/gauge-ref-line-labels",["objects.views/charts/components/ref-line-labels","objects.views/charts/utils/canvas-renderer","core.utils/theme"],function(a,b,c){function d(a){return String(void 0!==a.label?a.label:a)}function e(a){return c.palette[a]?c.palette[a]:a}var f;return f=a.extend("GaugeRefLineLabels",{init:function(){this._super.apply(this,arguments)},paint:function(){if(!this._axis)return void this._clearLabels();if(this._axis.updateNow(["properties"]),(this._plotMinValue!==this._axis.getPlotMin()||this._plotMaxValue!==this._axis.getPlotMax())&&(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues.call(this)),!this._hasVisibleRefLines)return void this._clearLabels();var a,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x="bottom",y=this._relevantPos,z=[],A=[],B=this._axis;for(a=0;a<this._data.length;a+=1)this._data[a].show&&void 0!==this._data[a].refLineExpr&&(c=this._currentProperties["value"+a],f=d(this._data[a].refLineExpr),void 0===c||isNaN(c)||c<this._axis.getPlotMin()||c>this._axis.getPlotMax()||(s={font:this._font,maxWidth:this._labelMaxWidthForYAxis,maxNumLines:3},o=f,n=o.replace(/[0-9]|\.|\-|\+|e/g,""),n=n.length?o:B.format(c),j=this._data[a].label+" ("+n+")",k=void 0!==this._data[a].color?e(this._data[a].color):"#000000",s.text=j,u=b.measureTextObject({shape:s}),B.isRadial()?(q=B._radius,r=B.getAngleOfValue(c),h=B._centerPoint.x+Math.cos(r)*q,i=B._centerPoint.y+Math.sin(r)*q,p=r>Math.PI/2&&r<3*Math.PI/2?"right":"left",x=r>Math.PI&&r<2*Math.PI?"bottom":"top",t=u.width,0>h-t?(s.maxWidth+=h-t,h=s.maxWidth):h+t>this.rect.width&&(s.maxWidth=t+(this.rect.width-(h+t)))):(g=B.getPositionOfValue(c),g=Math.floor(g)-.5,w=u.height/2,B.isVertical()?(p="left",x="middle",h=y+this._width+4,i=w>g?g+(w-g+4):g>this.rect.height-w?g-(g-(this.rect.height-w-4)):g):(p="center",i=y+this._width,x="top",v=u.width/2,h=v>g?g+(v-g+4):g>this.rect.width-v?g-(g-(this.rect.width-v-4)):g)),s.x=h,s.y=i,s.align=p,s.baseline=x,l={type:"text",fill:k,shape:s},A.push(l),z.push({position:g,shapeWrapper:l})));return m=z?z.length:0,0===m?void this._clearLabels():(this.renderer.shapes=A,void this.renderer.render())},setGaugeWidth:function(a){this._width=a,this.invalidateDisplay()},setPaddingToAxis:function(a){this._paddingToAxis=a},setRelevantPos:function(a){this._relevantPos=a},_clearLabels:function(){this.renderer.shapes&&this.renderer.shapes.length&&(this.renderer.shapes=[],this.renderer.render())}})}),define("text!extensions.qliktech/gauge/gauge.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<div qva-popup-disclaimer ng-if="!!dataAttributes.popupDisclaimer.show" pop-close="dataAttributes.popupDisclaimer.onPopClose" pop-message="dataAttributes.popupDisclaimer.message" pop-title="dataAttributes.popupDisclaimer.title" />\r\n'}),define("extensions.qliktech/gauge/gauge-properties",["translator","general.utils/property-resolver"],function(a,b){var c,d,e,f;return c={uses:"data"},d={type:"items",uses:"settings",component:"expandable-items",translation:"Common.Appearance",items:{presentation:{type:"items",grouped:!0,translation:"properties.presentation",items:{rangeLimits:{type:"items",items:{text:{component:"text",translation:"properties.axis.rangeLimits",style:"sHeader"},min:{ref:"measureAxis.min",translation:"properties.axis.min",type:"number",expression:"optional",invalid:function(a){return a.measureAxis&&a.measureAxis.min>=a.measureAxis.max},change:function(a){b.setValue(a,"disclaimerClosed",!0)}},max:{ref:"measureAxis.max",translation:"Common.Max",type:"number",expression:"optional",defaultValue:100,invalid:function(a){return a.measureAxis&&a.measureAxis.min>=a.measureAxis.max},change:function(a){b.setValue(a,"disclaimerClosed",!0)}}}},type:{ref:"gaugetype",type:"string",component:"item-selection-list",defaultValue:"radial",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.gauge.radial",value:"radial"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.gauge.bar",value:"bar"}],change:function(a){"radial"===a.gaugetype?(e=a.orientation,a.orientation="horizontal"):a.orientation=e}},autoOrientation:{ref:"autoOrientation",translation:"properties.orientation",type:"boolean",defaultValue:!0,component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:function(a){return"bar"===a.gaugetype}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"horizontal",horizontal:!0,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}],show:function(a){return"bar"===a.gaugetype&&!a.autoOrientation}},angle:{ref:"angle",translation:"properties.gauge.angle",type:"number",component:"slider",min:.2,max:.98,step:.1,defaultValue:.7,show:function(){return!1}},useSegments:{ref:"useSegments",type:"boolean",defaultValue:!1,translation:"properties.gauge.useSegments",change:function(a){a.useSegments&&1===a.segmentInfo.colors.length?a.segmentInfo.colors=[{color:a.progressColor}]:a.progressColor=a.segmentInfo.colors[0].color}},progressColor:{component:"color-picker",translation:"properties.color",ref:"progressColor",type:"integer",defaultValue:3,show:function(a){return!a.useSegments}},valueMode:{ref:"valueMode",translation:"properties.value",type:"string",component:"dropdown",options:[{value:"absolute",translation:"properties.gauge.absolute"},{value:"relative",translation:"properties.gauge.relative"}],show:function(){return!1},defaultValue:"absolute"},maxSegments:{ref:"maxSegments",type:"number",defaultValue:6,show:!1},segmentInfo:{ref:"segments",type:"items",component:"color-scale-creator",show:function(a){return a.useSegments},items:{limits:{ref:"segmentInfo.limits",type:"array",items:{value:{ref:"value",type:"number",expression:"optional",invalid:function(a,b){return"number"==typeof a.value&&(a.value<b.measureAxis.min||a.value>b.measureAxis.max)},defaultValue:1},gradient:{translation:"properties.gradient",ref:"gradient",type:"boolean",show:!1}}},colors:{items:{color:{ref:"color",component:"color-picker",translation:"properties.color",type:"integer",defaultValue:3}},type:"array",ref:"segmentInfo.colors"}}},disclaimerClosed:{ref:"disclaimerClosed",type:"boolean",defaultValue:!1,show:!1}}},measureAxis:{type:"items",label:function(b,c){var d,e=c.getMeasureLayouts()[0];return d=e?a.get("properties.measureAxisWithInfo",[e.qFallbackTitle]):a.get("properties.measureAxis")},grouped:!0,items:{axis:{type:"items",snapshot:{title:"properties.measureAxis",tid:"property-yAxis"},items:{show:{ref:"measureAxis.show",translation:"properties.axis.labelsAndTitle",type:"string",component:"dropdown",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all"},spacing:{ref:"measureAxis.spacing",translation:"properties.axis.scale",type:"number",component:"dropdown",defaultValue:1,show:function(a){return a.measureAxis&&"none"!==a.measureAxis.show&&"title"!==a.measureAxis.show},options:[{value:2,translation:"properties.gridLine.wide"},{value:1,translation:"properties.gridLine.medium"},{value:.5,translation:"properties.gridLine.narrow"}]}}}}}}},f={type:"items",component:"expandable-items",translation:"properties.addons",items:{refLines:{uses:"reflines"}}},{type:"items",component:"accordion",items:{data:c,addons:f,settings:d}}}),define("text!extensions.qliktech/gauge/popup-disclaimer.ng.html",[],function(){return'<div class="qv-popup-disclaimer">\r\n	<div class="icon-close-button" qva-activate="onClose()"></div>\r\n	<header class="dm-header">{{popTitle}}</header>\r\n	<main class="dm-main">\r\n		<p class="dm-p">{{popMessage}}</p>\r\n	</main>\r\n</div>'}),define("extensions.qliktech/gauge/popup-disclaimer",["assets/qvangular/qvangular-core","text!extensions.qliktech/gauge/popup-disclaimer.ng.html"],function(a,b){a.directive("qvaPopupDisclaimer",function(){return{template:b,replace:!0,scope:{popMessage:"=",popTitle:"=",popClose:"="},link:function(a){a.onClose=function(){a.popClose()}}}})}),define("extensions.qliktech/gauge/gauge",["jquery","translator","objects.views/charts/chart","extensions.qliktech/gauge/gaugearea","extensions.qliktech/gauge/gauge-ref-lines","extensions.qliktech/gauge/gauge-ref-line-labels","objects.views/charts/components/chart-component","client.utils/state","objects.backend-api/hypercube-api","text!./gauge.ng.html","extensions.qliktech/gauge/gauge-properties","objects.extension/object-conversion","extensions.qliktech/gauge/popup-disclaimer"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){var b=this.components.dataArea,c=b.rect,d=80,e=a.extend({},c),f=this.components.axis,g=f.relevantSize;"vertical"===this._orientation?(e.x=c.width/2-b.getGaugeWidth(b.rect,"vertical"===this._orientation)/2-g,e.x<0?(e.width=g+e.x,e.x=0):e.width=g):(e.y=c.height/2-b.getGaugeWidth(b.rect,"vertical"===this._orientation)/2-g,e.y<0?(e.height=g+e.y,e.y=0):e.height=g),(c.width<d||c.height<d)&&(e["vertical"===this._orientation?"width":"height"]=0),f.rect=e}var n;return n=c.extend("Gauge",{namespace:".gauge",init:function(c,h,i,j){var k=this;i=a.extend(!0,i||{},{providers:{},components:{axis:{show:!0,order:0,dock:"center",showFlag:g.prototype.ShowFlags.SPARK},dataArea:{show:!0,order:1,dock:"center",clazz:d,showFlag:g.prototype.ShowFlags.SPARK},gaugeRefLines:{sortKey:5,show:!0,dock:"center",showFlag:g.prototype.ShowFlags.XSMALL},gaugeRefLineLabels:{show:!0,dock:"center",order:3,showFlag:g.prototype.ShowFlags.XSMALL}}}),this._type="vertical",this._orientation="horizontal",this._super(c,h,i,j),this.components.dataArea.setAxis(this.components.axis),this.components.axis.setAlignment("near"),this.components.axis.setDataRangeTransition(!0),this.components.axis.setShowLine(!1),this.components.gaugeRefLines=new e(this.container),this.components.gaugeRefLines.showFlag=g.prototype.ShowFlags.XSMALL,this.components.gaugeRefLines.setUseTransition(!0),this.components.dataArea.setRefLines(this.components.gaugeRefLines),this.layoutEngine.addComponent(this.components.gaugeRefLines),this.components.gaugeRefLineLabels=new f(this.container),this.components.gaugeRefLineLabels.showFlag=g.prototype.ShowFlags.SMALL,this.components.gaugeRefLineLabels.setUseTransition(!0),this.components.dataArea.setRefLineLabels(this.components.gaugeRefLineLabels),this.layoutEngine.addComponent(this.components.gaugeRefLineLabels),this.$scope.dataAttributes.popupDisclaimer={show:!1,message:b.get("Object.Gauge.RangeIsDefault"),title:b.get("Object.Gauge.RangeIsDefaultTitle"),onPopClose:function(){k.$scope.backendApi.model.getProperties().then(function(a){a.disclaimerClosed=!0,k.$scope.backendApi.model.save()})}}},_updateData:function(a){if(this._type=a.gaugetype,this._orientation=a.autoOrientation&&"bar"===a.gaugetype?this.components.dataArea.rect.height>this.components.dataArea.rect.width?"vertical":"horizontal":a.orientation,a.refLine){var b={axes:{axis:{component:this.components.axis,data:a.axis,dataIndices:a.qHyperCube.qMeasureInfo.map(function(a,b){return b})}},refLineLabels:{labels:{data:a.refLine.refLines,component:this.components.gaugeRefLineLabels,axis:this.components.axis}},refLines:{component:this.components.gaugeRefLines}};this._super(a,b),this.components.dataArea.setData(a),this.updateAxis(a,this.options),this.updateRefLines(a,b)}else this.components.dataArea.setData(a),this.updateAxis(a,this.options),this._super(a)},updateRefLines:function(a,b){var c,d=b.refLineLabels,e=[],f=[];for(c in d)d[c].component&&(d[c].component.setData(d[c].data),d[c].component.setAxis(d[c].axis),d[c].component.setDock(d[c].axis.getOppositeDock()),f.push(d[c].axis),e.push(d[c].data));b.refLines&&b.refLines.component&&(b.refLines.component.setAxes([b.axes.axis.component]),b.refLines.component.setData([a.refLine.refLines]))},isValid:function(a){var b,c=!1;c=!!a&&!!a.qHyperCube&&a.qHyperCube.qMeasureInfo.length&&!a.qHyperCube.qMeasureInfo.some(function(a){return!!a.qError});for(b in this.components)this.components[b].setHasValidData(c);return c},updateAxis:function(a){var b,c,d,e,f,g,h=a.measureAxis,i=this.components.axis;b=Math.min.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return a.qMin})),c=Math.max.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMax)}).map(function(a){return a.qMax})),f=a.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle}).join(", "),i.setData(a),i.setTitle(f),i.setShowStrategy(h.show),i.setLabelMode(h.label),i.setOrientation("bar"===this._type?this._orientation:"horizontal"),i.setPlotMin&&(g=this.getAxisOptions(h),i.setPlotMin(g.min),i.setPlotMax(g.max),i.setTickMultiplier(h.spacing),i.setLogScale(h.logarithmic)),b===c&&0===c&&(c=1,b=0),c=Math.max(0,c),b=Math.min(0,b),this.setAxisDataRange(i,c,b,g.max,g.min,1),d=-Math.PI*(a.angle+.5),e=Math.PI*(a.angle-.5),e+=0>d?2*Math.PI:0,d+=0>d?2*Math.PI:0,this.components.axis.setRadial("radial"===this._type,{start:d,end:e})},getAxisOptions:function(a){return a?{min:Number(a.min),max:Number(a.max)}:void 0},setAxisDataRange:function(a,b,c,d,e,f){null!==d&&null!==e||null===d&&null===e?a.setDataRange(c,b):null!==d&&c>=d?a.setDataRange(d-f,b):null!==e&&e>=b?a.setDataRange(c,e+f):a.setDataRange(c,b)},_paint:function(){var a;if(this._super()===!1)return!1;if(this.layout(),this.$scope.dataAttributes.popupDisclaimer){var b=this._data.disclaimerClosed||this._data.maxMinChanged;this.$scope.dataAttributes.popupDisclaimer.show=!h.isInEditMode()||this._layoutMode<7||b?!1:!0}for(a in this.components)this.components[a].invalidateDisplay()},layout:function(){var a=this.components.axis,b=a.updateSize;a.updateSize=function(){},this.layoutEngine.layout(this.rect,this._layoutMode,this.containerRect),a.updateSize=b,this._data&&this._data.autoOrientation&&"bar"===this._data.gaugetype&&(this._orientation=this.components.dataArea.rect.height>this.components.dataArea.rect.width?"vertical":"horizontal",this.components.axis.setOrientation(this._orientation)),a.preRelevantSizeCalculation(),a.calculatePreliminaryRelevantSize(this.components.dataArea.rect,this.components.dataArea.rect),a.calculateRelevantSize(this.components.dataArea.rect,this.components.dataArea.rect),this.components.axis.isRadial()||m.call(this),a.updateSize()
}}),{type:"gauge",BackendApi:i,template:j,View:n,definition:k,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:1,qHeight:1}],qSuppressMissing:!0},segmentInfo:{limits:[],colors:[{color:3}]}},data:{measures:{min:1,max:1}},snapshot:{canTakeSnapshot:!0},getDropFieldOptions:function(a,b,c,d,e){a.AddFieldAsMeasure(c,b,e),d()},getDropDimensionOptions:function(a,b,c,d){d()},importProperties:l.axisChart.importProperties.bind(l),exportProperties:l.axisChart.exportProperties.bind(l)}}),define("text!extensions.qliktech/kpi/kpi.ng.html",[],function(){return'<div qv-extension class="kpi qv-viz" qva-activate="onShowVerifyDialog()" ng-class="{link : linkInteractionOn && interactionOn}">\r\n	<div ng-show="baseLayoutInfo.components[0].show" class="measure-wrapper" ng-class="textAlign" ng-style="measureTitleStyle">\r\n		<div class="measure-title ellips-text" title="{{measureTitle}}">\r\n			<span ng-bind="measureTitle"></span>\r\n			<i class="icon-info" ng-if="linkInteractionOn" title="{{sheetLinkTitle}}"></i>\r\n		</div>\r\n	</div>\r\n	<div class="value-wrapper" ng-class="textAlign">\r\n		<div class="ellips-text">\r\n			<qv-kpi-value value="mainValue.value" formatted-value="mainValue.formattedValue" value-style="mainValue.style" formatter="mainValue.formatter" glyph="mainValue.glyph" show-glyph="mainValue.showGlyph" />\r\n		</div>\r\n		<div ng-show="baseLayoutInfo.components[1].components[1].components[0].show" class="secondary-wrapper" ng-repeat="secondaryValue in secondaryValues">\r\n			<qv-kpi-value value="secondaryValue.value" formatted-value="secondaryValue.formattedValue" value-style="secondaryValue.style" title-style="secondaryValue.titleStyle" formatter="secondaryValue.formatter" glyph="secondaryValue.glyph" show-glyph="secondaryValue.showGlyph" measure-title="secondaryValue.measureTitle" />\r\n		</div>\r\n	</div>\r\n	<!--\r\n	<div ng-show="useViz" class="visualization">\r\n		<qv-object class="cell-content" model="viz.model" options="viz.options"></qv-object>\r\n	</div>\r\n	-->\r\n\r\n	<div class="click-again-overlay" ng-class="{show : showVerifyDialog}" ng-style="verifyDialogStyle" qva-activate="linkToSheet()">\r\n		<span q-translation="properties.kpi.verifyToGoSheet"></span>\r\n		<span class="sheetLinkTitle ellips-text" ng-bind="sheetLinkTitle"></span>\r\n	</div>\r\n\r\n</div>\r\n'}),define("extensions.qliktech/kpi/kpi-properties",["general.utils/property-resolver"],function(a){var b,c;return b={uses:"data",addTranslation:"Visualization.Requirements.AddMeasure",items:{measures:{items:{conditionalColoring:{type:"items",ref:"qDef.conditionalColoring",show:function(){return!0},items:{useConditionalColoring:{ref:"qDef.conditionalColoring.useConditionalColoring",component:"checkbox",translation:"properties.kpi.conditionalColoring",defaultValue:!1,change:function(a){a.qDef.conditionalColoring&&a.qDef.conditionalColoring.useConditionalColoring&&1===a.qDef.conditionalColoring.segments.colors.length?(a.qDef.conditionalColoring.segments.colors[0].color=a.qDef.conditionalColoring.singleColor,a.qDef.conditionalColoring.segments.colors[0].icon=a.qDef.conditionalColoring.segments.colors[0].icon):a.qDef.conditionalColoring.singleColor=a.qDef.conditionalColoring.segments.colors[0].color}},singleColorColoring:{component:"color-picker",translation:"properties.color",ref:"qDef.conditionalColoring.singleColor",type:"integer",defaultValue:2,show:function(a){return a.qDef.conditionalColoring&&!a.qDef.conditionalColoring.useConditionalColoring}},rangeLimits:{type:"items",items:{text:{component:"text",translation:"properties.axis.rangeLimits",style:"sHeader"},min:{ref:"qDef.measureAxis.min",translation:"properties.axis.min",type:"number",expression:"optional",invalid:function(a){return a.qDef.measureAxis&&a.qDef.measureAxis.min>=a.qDef.measureAxis.max},change:function(b){a.setValue(b,"disclaimerClosed",!0)}},max:{ref:"qDef.measureAxis.max",translation:"Common.Max",type:"number",expression:"optional",defaultValue:100,invalid:function(a){return a.qDef.measureAxis&&a.qDef.measureAxis.min>=a.qDef.measureAxis.max},change:function(b){a.setValue(b,"disclaimerClosed",!0)}}},show:function(a){return a.qDef.conditionalColoring&&a.qDef.conditionalColoring.useConditionalColoring&&a.qDef.conditionalColoring.segments.limits.length>0}},segmentInfo:{ref:"qDef.conditionalColoring.segments",type:"items",component:"color-scale-creator",conditionalColoringRef:{props:"qHyperCubeDef.qMeasures",layout:"qHyperCube.qMeasureInfo"},useGlyph:!0,show:function(a){return a.qDef.conditionalColoring.useConditionalColoring},items:{limits:{ref:"qDef.conditionalColoring.segments.limits",type:"array",items:{value:{ref:"value",type:"number",expression:"optional",invalid:function(a){return isNaN(a.value)},defaultValue:1},gradient:{translation:"properties.gradient",ref:"gradient",type:"boolean",show:!1}}},colors:{type:"array",ref:"qDef.conditionalColoring.segments.colors",defaultValue:[{color:3}],items:{color:{ref:"color",component:"color-picker",translation:"properties.color",type:"integer",defaultValue:3},icon:{ref:"icon",type:"string",defaultValue:"",show:!1}}}}}}}}}}},c={type:"items",uses:"settings",component:"expandable-items",translation:"Common.Appearance",items:{presentation:{type:"items",grouped:!0,translation:"properties.presentation",items:{showMeasureTitle:{ref:"showMeasureTitle",component:"checkbox",translation:"properties.ShowTitle",defaultValue:!0},textAlign:{ref:"textAlign",type:"string",component:"dropdown",translation:"properties.Alignment",options:[{value:"left",translation:"properties.dock.left"},{value:"center",translation:"Common.Center"},{value:"right",translation:"properties.dock.right"}],defaultValue:"center"},fontSize:{ref:"fontSize",type:"string",component:"dropdown",translation:"MediaTool.Toolbar.FontSize",options:[{value:"S",translation:"Common.Small"},{value:"M",translation:"Common.Medium"},{value:"L",translation:"Common.Large"}],defaultValue:"M"},linkToSheet:{type:"items",items:{useLink:{ref:"useLink",type:"boolean",component:"switch",translation:"properties.kpi.linkToSheet",defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},kpiLink:{ref:"kpiLink",type:"items",component:"sheet-dropdown",items:{id:{ref:"kpiLink.id",type:"string"},title:{ref:"kpiLink.title",type:"string"}},show:function(a){return a.useLink}}}}}}}},{type:"items",component:"accordion",items:{data:b,settings:c}}}),define("client.property-panel/components/color-scale-creator/color-scale-creator-utils",["core.utils/theme","general.utils/color","jquery"],function(a,b,c){function d(a,b,d){var e;return e=c.extend(!0,{},a),e&&e.limits&&(e.limits=e.limits.concat().sort(function(a,b){return a.value-b.value}),e.limits.forEach(function(a){a.value=(a.value-b)/(d-b)})),e&&e.colors&&(e.colors=e.colors.concat().map(function(a){return{color:j.resolveColor(a.color)}})),e}function e(a,b){if(0!==a.limits.length){var c;return c=0===b?a.limits[b].gradient:b===a.colors.length-1?a.limits[b-1].gradient:a.limits[b].gradient||a.limits[b-1].gradient}}function f(a,b,c){if(isNaN(b))return-1;var d,e,f=c?Math.min(c,b):0,g=a.segments.limits,h=a.segments.colors;for(e=0;e<h.length;e++){if(e===h.length-1)return e;if(d=g[e].value,d>b&&b>=f)return e;f=d}return 0}function g(a,b,c){var d,e,f=b>0?a.limits[b-1]:{value:0,gradient:!1},g=a.colors[b-(b>0?1:0)],h=a.limits[b]?a.limits[b]:{value:1,gradient:!1},i=a.colors[b+(b<a.colors.length-1?1:0)],j=c===h.value?1:(c-f.value)/(h.value-f.value);return f&&f.gradient&&h&&h.gradient?c-f.value<h.value-c?(d=g.color,e=.5+j):(d=i.color,e=j-.5):f&&f.gradient?(d=g.color,e=1-(.5+j/2)):h&&h.gradient?(d=i.color,e=j/2):(d=a.colors[b].color,e=c),{color:d,t:e}}function h(b){return a.palette[b]?a.palette[b]:"number"==typeof b?"#000":b}function i(a,c,e,f){var g,h,i,j,k=0,l=d.call(this,a,e,f);if(0>=c)return l.colors[0].color;if(c>=1)return l.colors[l.colors.length-1].color;for(i=0;i<l.colors.length;i++){if(h=l.limits[i]?l.limits[i].value:1,c>=k&&h>c){this.shouldBlend(l,i)?(g=this.getBlendInfo(l,i,c,e,f),j=new b(l.colors[i].color).blend(new b(g.color),g.t)):j=l.colors[i].color;break}k=h}return j}var j={blendValue:i,shouldBlend:e,getBlendInfo:g,resolveColor:h,getSegmentIndex:f};return j}),define("extensions.qliktech/kpi/kpi-layout",["objects.views/charts/utils/canvas-renderer"],function(a){function b(a,b,c){var d,e=a.ratio?a.ratio:1,f=b/c;return d=a.direction===m.ROW?e>f?m.COLUMN:m.ROW:e>f?m.ROW:m.COLUMN}function c(a){if(!a.components||0===a.components.length)return a;var d,e,f,g,h,i=0,j=a.boundingBox.height,k=a.boundingBox.width,l=a.direction,n=b(a,j,k);for(a.components.forEach(function(a){a.direction=a.direction?a.direction:n,d=a.size.min?a.size.min:a.size?a.size:0,"function"==typeof a.isVisible&&!a.isVisible()||d*j<(a.size.treshold&&a.size.treshold.height?a.size.treshold.height:10)||k<(a.size.treshold&&a.size.treshold.width?a.size.treshold.width:10)?a.show=!1:(i+=d,a.show=!0)}),f=a.components.length-1;f>=0;f--)g=a.components[f],1>i?g.size.stretch&&(g.size.value=g.size.min+(1-i)):g.size.value=null;return a.components.forEach(function(a){e=a.size.value?a.size.value:a.size.min?a.size.min:a.size,h={},l===m.ROW?(h.height=j,h.width=k*e):(h.width=k,h.height=j*e),a.boundingBox=h}),a.components.forEach(function(a){c(a)}),a}function d(a,b,c,g,h,i){var j,m,n;m=a.boundingBox.width,n=a.boundingBox.height,a.components&&a.components.forEach(function(b){d(b,a,m,n,h,i)}),"function"==typeof a.getText&&(h===l.MAX?j=f(a.getText(),m,n):h===l.SCALE&&(j=e(a,m,n)),i===k.ADJUSTTOTEXT&&(a.boundingBox={height:j.height,width:j.width}),a.fontSizes||(a.fontSizes={}),a.fontSizes.fontSize=10*j.fontSize+"%")}function e(a,b,c){if(!a.fontSizes)return{fontSize:"10px"};var d=a.getText(),e=a.fontSizes.min,g=a.fontSizes.max,h=a.fontSizes.maxNrChars,i=f(d,b,c,h),j=Math.min((c-e.height)/(g.height-e.height),1),k=e.fontSize+j*(g.fontSize-e.fontSize),l=Math.max(Math.min(i.fontSize,k),e.fontSize);return{fontSize:l}}function f(a,b,c,d){var e=d?d*j:g.getTextWidth(a,h),f=1.2*i,k=Math.min(b/e,c/f);return{fontSize:9*k}}var g=new a,h="10px 'QlikView Sans'",i=g.getFontHeight(h)+1,j=g.getTextWidth("M",h),k={NONE:0,ADJUSTTOTEXT:1},l={NONE:0,SCALE:1,MAX:2},m={ROW:"row",COLUMN:"column"},n={checkLayout:c,getDirection:b,sizeComponent:d,TextScaleMode:l,ElementScaleMode:k,Direction:m};return n}),define("client.utils/routing",["general.controllers/route-controller","util"],function(a,b){var c={getUrlForSheet:function(c,d,e){var f=["sheet",c,"state",d];return e&&f.splice(0,0,!0,"sense","app",b.getParameterByName("app")),a.buildUrl.apply(a,f)},goToOverview:function(){a.setUrl(a.buildUrl())},goToSheet:function(b,d){a.setUrl(c.getUrlForSheet(b,d,!1))},goToStory:function(b,c,d){var e=["story",b,"state",c];d&&e.push("slide",d),a.setUrl(a.buildUrl.apply(a,e))}};return c}),define("text!extensions.qliktech/kpi/value.ng.html",[],function(){return'<div>\r\n	<div class="kpi-value" ng-style="valueStyle">\r\n		<div class="ellips-text">\r\n			<span ng-bind="currentFormattedValue" title="{{currentFormattedValue}}"></span>\r\n		</div>\r\n		<div class="glyph-wrapper">\r\n			<span class="kpi-icon" ng-bind="glyph" ng-if="showGlyph"></span>\r\n		</div>\r\n	</div>\r\n	<div class="kpi-title ellips-text" ng-style="titleStyle" ng-bind="measureTitle"></div>\r\n</div>'}),define("extensions.qliktech/kpi/value",["qvangular","text!./value.ng.html","util","objects.views/charts/utils/tween"],function(a,b,c,d){a.directive("qvKpiValue",[function(){return{replace:!0,template:b,restrict:"E",scope:{value:"=",formattedValue:"=",valueStyle:"=",formatter:"=",glyph:"=",showGlyph:"=",measureTitle:"=",titleStyle:"="},link:function(a){var b=function(b,c,e,f){new d(b,{currentValue:c},400).progress(function(){b.currentFormattedValue=f?f.formatValue(b.currentValue):b.currentValue,a.$digest()}).then(function(){b.currentFormattedValue="U"!==f.type?e:f.formatValue(b.currentValue)})},e=function(){a.formattedValue&&("U"===a.formatter.type?(a.tweenFormatter||(a.tweenFormatter=a.formatter.clone()),a.tweenFormatter.pattern=f(a.formattedValue,!0),a.tweenFormatter.prepare(),b(a,a.value,a.formattedValue,a.tweenFormatter)):b(a,a.value,a.formattedValue,a.formatter))},f=function(a,b){var d,e,f="0",g=a.match(/(?:-?\d+)([^\d](?=\d))/),h=g?g[1]:"",i=0;if(h&&(e=new RegExp("(?:"+c.escapeRegExp(h)+")(\\d+)"),g=a.match(e),i=g?g[1].length:0),i)for(f+=h,d=0;i>d;d++)f+="0";return b&&(f+="A"),f};a.$watch("formattedValue",function(){e()}),a.$watch("formatter",function(){e()})}}}])}),define("extensions.qliktech/kpi/kpi",["jquery","qvangular","translator","objects.extension/default-view","objects.backend-api/hypercube-api","text!./kpi.ng.html","extensions.qliktech/kpi/kpi-properties","objects.views/charts/utils/chart-formatting","client.property-panel/components/color-scale-creator/color-scale-creator-utils","general.utils/visualizations","core.utils/deferred","objects.models/visualization-object","extensions.qliktech/kpi/kpi-layout","client.utils/routing","client.models/sheet","extensions.qliktech/kpi/value"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p,q=b.getService("$timeout");return p=d.extend("kpi",{namespace:".kpi",init:function(a,d,e,f){this._super(a,d,e,f),this._$element=d,this.$scope.mainValueStyle={},this.$scope.measureTitleStyle={},this.$scope.viz={},this.$scope.secondaryValues=[],this.$scope.secondaryLayouts=[],this.$scope.showSecondaryValues=!1,this.$scope.mainValue={formattedValue:"",value:null,style:null},a.showVerifyDialog=!1,a.onShowVerifyDialog=function(){a.linkInteractionOn&&(b.$apply(a,function(){a.showVerifyDialog=!0,a.updateVerifyDialogFontSize()}),q(function(){b.$apply(a,function(){a.showVerifyDialog=!1})},2500))},a.linkToSheet=function(){a.linkInteractionOn&&window.open(n.getUrlForSheet(a.layout.kpiLink.id,"analysis"))},a.updateVerifyDialogFontSize=function(){if(a.showVerifyDialog){var b=a.verifyDialogLayoutInfo.components[0];m.checkLayout(a.verifyDialogLayoutInfo),m.sizeComponent(b,a.verifyDialogLayoutInfo,a.verifyDialogLayoutInfo.boundingBox.width,a.verifyDialogLayoutInfo.boundingBox.height,m.TextScaleMode.SCALE,m.ElementScaleMode.NONE),a.verifyDialogStyle={fontSize:b.fontSizes.fontSize}}};var g=this;this.$scope.baseLayoutInfo={direction:m.Direction.COLUMN,ratio:1e9,boundingBox:{width:d.width(),height:d.height()},components:[{size:{min:.2,treshold:{width:150,height:12}},getText:function(){return a.measureTitle},fontSizes:{maxNrChars:15,min:{fontSize:10,height:15},max:{fontSize:40,height:80}},isVisible:function(){return a.showMeasureTitle}},{size:{min:.8,stretch:!0},ratio:1,components:[{size:{min:.5,stretch:!0},getText:function(){return g.$scope.mainValue.formattedValue+(g.$scope.mainValue.glyph?g.$scope.mainValue.glyph:"")},fontSizes:{maxNrChars:4,min:{fontSize:10,height:20},max:{fontSize:500,height:500}}},{size:.5,components:this.$scope.secondaryLayouts,isVisible:function(){return g.$scope.secondaryLayouts.length>0}}]}]},this.$scope.secondaryLayoutInfo={size:{min:1,treshold:{width:100,height:30}},direction:m.Direction.COLUMN,components:[{size:{min:.6,stretch:!0},fontSizes:{maxNrChars:8,min:{fontSize:10,height:20},max:{fontSize:500,height:500}}},{size:{min:.4},fontSizes:{maxNrChars:15,min:{fontSize:10,height:20},max:{fontSize:30,height:500}}}]},this.$scope.verifyDialogLayoutInfo={size:{min:1,width:20,height:20},boundingBox:{width:0,height:0},components:[{size:{min:.2,treshold:{width:100,height:100}},getText:function(){return c.get("properties.kpi.verifyToGoSheet")},fontSizes:{maxNrChars:16,min:{fontSize:10,height:20},max:{fontSize:13,height:50}}}]}},updateData:function(a){this._data=a;var b,c,d,e,f,g,h,i=a.qHyperCube.qDataPages[0].qMatrix[0],j=a.qHyperCube.qMeasureInfo.length,k=j-1,l=this.getFormatterForMeasures(a.qHyperCube.qMeasureInfo.length),m=this.$scope.secondaryValues,n=this.$scope.secondaryLayouts,p=this,q=function(){return e},r=function(){return g};for(this.$scope.useViz=a.useViz,this.$scope.showMeasureTitle=a.showMeasureTitle,this.$scope.textAlign=a.textAlign,this.$scope.baseLayoutInfo.components[1].components[0].fontSizes.maxNrChars="S"===a.fontSize?7:"L"===a.fontSize?3:4,this.$scope.useLink=a.useLink,a.useLink&&a.kpiLink&&o.get(a.kpiLink.id).then(function(b){b.getLayout().then(function(b){a.kpiLink.title=b&&b.qMeta?b.qMeta.title:"",p.$scope.sheetLinkTitle=a.kpiLink?a.kpiLink.title:""})}),this.$scope.mainValue.value=a.qHyperCube.qDataPages[0].qMatrix[0][0].qNum,this.$scope.mainValue.formattedValue="U"!==l[0].type?a.qHyperCube.qDataPages[0].qMatrix[0][0].qText:l[0].formatValue(this.$scope.mainValue.value),this.$scope.mainValue.formatter=l[0],h=0;k>h;h++)d=i[h+1].qText,f=i[h+1].qNum,e="U"!==l[h+1].type?d:l[h+1].formatValue(f),g=a.qHyperCube.qMeasureInfo[h+1].qFallbackTitle,m[h]||(c=this.createSecondaryValue(q,r),b={style:c.layoutInfo.components[0].fontSizes.value,titleStyle:c.layoutInfo.components[1].fontSizes.value},m.push(b),n.push(c.layoutInfo)),b=m[h],b.value=f,b.formattedValue=e,b.formatter=l[h+1],b.measureTitle=g,n[h].components[0].fontSizes.maxNrChars="S"===a.fontSize?14:"L"===a.fontSize?6:8;m.length>k&&(n.splice(k,m.length-k),m.splice(k,m.length-k)),this.$scope.measureTitle=a.qHyperCube.qMeasureInfo[0].qFallbackTitle,this.$scope.showSecondaryValues=m.length>0,a.useViz&&(this._vizCreated?!this._vizBound&&a.qChildList&&a.qChildList.qItems&&(this.bindVisualization(a.qChildList.qItems[0]),this._vizBound=!0):(this.createVisualization(a.vizType),this._vizCreated=!0))},updateStyles:function(){if(this._data){var a,b,c=this,d=this._data,e=function(a,b){var c=d.qHyperCube.qMeasureInfo[b].conditionalColoring,e=d.qHyperCube.qMeasureInfo[b].measureAxis,f=(a-e.min)/(e.max-e.min),g=i.getSegmentIndex(c,a,e.min),h=c.segments.colors[g]?c.segments.colors[g].icon:"",j=c.useConditionalColoring?i.blendValue(c.segments,f,e.min,e.max):i.resolveColor(c.singleColor);return{color:j,icon:h,useCondColor:c.useConditionalColoring}};this.$scope.linkInteractionOn=this.$scope.interactionOn&&this.$scope.layout.useLink&&this.$scope.layout.kpiLink&&this.$scope.layout.kpiLink.id,this.$scope.verifyDialogLayoutInfo.boundingBox.width=this._$element.width(),this.$scope.verifyDialogLayoutInfo.boundingBox.height=this._$element.height(),this.$scope.baseLayoutInfo.boundingBox=this.getBoundingBox(),m.checkLayout(this.$scope.baseLayoutInfo),this.$scope.baseLayoutInfo.components.forEach(function(a){var b=c.backendApi.isSnapshot&&c._data&&!c._data.snapshotData.object.freeResize,d=b?c._data.snapshotData.isZoomed:c.options.isZoomed;m.sizeComponent(a,c.$scope.baseLayoutInfo,c.$scope.baseLayoutInfo.boundingBox.width,c.$scope.baseLayoutInfo.boundingBox.height,0===c.$scope.secondaryValues.length&&d?m.TextScaleMode.MAX:m.TextScaleMode.SCALE,0===c.$scope.secondaryValues.length&&d?m.ElementScaleMode.ADJUSTTOTEXT:m.ElementScaleMode.NONE)}),b=e(this.$scope.mainValue.value,0),this.$scope.mainValue.glyph=b.icon,this.$scope.mainValue.showGlyph=b.useCondColor&&b.icon&&""!==b.icon,a=this.$scope.baseLayoutInfo.components[1].components[0],this.$scope.mainValue.style={color:b.color,fontSize:a.fontSizes.fontSize},a=this.$scope.baseLayoutInfo.components[0],this.$scope.measureTitleStyle={fontSize:a.fontSizes.fontSize};for(var f=1;f<d.qHyperCube.qMeasureInfo.length;f++)a=this.$scope.baseLayoutInfo.components[1].components[1].components[f-1].components[0],b=e(this.$scope.secondaryValues[f-1].value,f),this.$scope.secondaryValues[f-1].style={color:b.color,fontSize:a.fontSizes.fontSize},a=this.$scope.baseLayoutInfo.components[1].components[1].components[f-1].components[1],this.$scope.secondaryValues[f-1].titleStyle={fontSize:a.fontSizes.fontSize},this.$scope.secondaryValues[f-1].glyph=b.icon,this.$scope.secondaryValues[f-1].showGlyph=b.useCondColor&&b.icon&&""!==b.icon;this.$scope.updateVerifyDialogFontSize()}},bindVisualization:function(a){var b=this;l.get(a.qInfo.qId).then(function(a){b.$scope.viz.model=a})},createSecondaryValue:function(b,c){var d=a.extend({},this.$scope.secondaryLayoutInfo);return d.components[0].getText=b,d.components[1].getText=c,{layoutInfo:d,text:b()}},paint:function(){this.updateStyles()},resize:function(a,b){this.paint(a,b)},getFormatterForMeasures:function(a){for(var b,c,d=this._data,e=new h(this.backendApi.localeInfo,d.qHyperCube.qMeasureInfo),f=[],g=0;a>g;g++)b=d.qHyperCube.qMeasureInfo[g],c=e.getMeasureFormatter(g),"U"===c.type&&(c.pattern=c.createPatternFromRange(b.qMax,b.qMax,!0),Math.floor(Math.log(Math.abs(b.qMax))/Math.log(10))%3===2&&(c.pattern=c.pattern.substr(0,c.pattern.length-2),c.pattern+="A")),c.prepare(),f.push(c);return f},on:function(){this.$scope.interactionOn=!0,this._super(),this.updateStyles()},off:function(){this.$scope.interactionOn=!1,this._super(),this.updateStyles()},createVisualization:function(a){var b=this;k.all({initProps:j.getType(a).getInitialProperties({}),props:b.backendApi.model.getFullPropertyTree()}).then(function(a){var c=a.initProps,d=a.props;c.showTitles=!1,c.gaugetype="bar",c.qHyperCubeDef=d.qProperty.qHyperCubeDef,c.measureAxis.min=d.qProperty.measureAxis.min,c.measureAxis.max=d.qProperty.measureAxis.max,c.useSegments=!1,d.qChildren.push({qChildren:[],qProperty:c}),b.backendApi.model.saveTree()})},getBoundingBox:function(){var a=this.backendApi.isSnapshot&&this._data&&!this._data.snapshotData.object.freeResize;return a&&this._data.snapshotData.elementRatio?{width:this._data.snapshotData.object.size.w,height:this._data.snapshotData.object.size.w*this._data.snapshotData.elementRatio}:{width:this._$element.width(),height:this._$element.height()}},setSnapshotData:function(a){this._super(),a.snapshotData.isZoomed=this.options.isZoomed,a.snapshotData.elementRatio=this._$element.height()/this._$element.width()}}),{type:"kpi",BackendApi:e,template:f,View:p,definition:g,initialProperties:{version:1,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:500,qHeight:10}],qSuppressMissing:!0},showTitles:!1},saveProperties:function(a){var b,c=a.propertyTree;return c.qChildren&&0!==c.qChildren.length?(b=c.qChildren[0].qProperty,b.qHyperCubeDef=c.qProperty.qHyperCubeDef,b.measureAxis.min=c.qProperty.measureAxis.min,b.measureAxis.max=c.qProperty.measureAxis.max,void l.get(a.layout.qChildList.qItems[0].qInfo.qId).then(function(a){a.saveTree()})):void a.save()},data:{measures:{min:1,max:2}},snapshot:{canTakeSnapshot:!0},getDropFieldOptions:function(a,b,c,d,e){a.AddFieldAsMeasure(c,b,e),d()},getDropDimensionOptions:function(a,b,c,d){d()},importProperties:null,exportProperties:null}}),define("text!extensions.qliktech/text-image/text-image.ng.html",[],function(){return'<div qv-extension style=\'width: 100%; height: 100%;\' qva-activate="edit()">\r\n	<div class="qv-media-tool-html" ng-class="[sizeClass, visibilityClass, responsiveClass]" ng-click="clickHtml($event)" ng-if="!editing && !initializing && !saving && !empty" ng-bind-html="html"></div>\r\n	<div class="text-image-hint" ng-if="empty && !editing" ng-class="{ \'selected\': selected }">\r\n		<div class="hint-content" ng-show="!selected || !editmode || object.isLink">\r\n			<i class="hint-icon icon-text-image"></i>\r\n			<div class="text" q-translation="Object.TextImage.EmptyHint"></div>\r\n		</div>\r\n		<div class="hint-content" ng-show="selected && editmode && !object.isLink">\r\n			<i class="hint-icon icon-add"></i>\r\n			<div class="text" q-translation="Object.TextImage.EmptySelectedHint"></div>\r\n		</div>\r\n	</div>\r\n	<div class="qv-media-tool-editor" ng-class="[sizeClass, visibilityClass, responsiveClass]" ng-if="initializing || editing || saving" qv-text-image-editor x-editor-options="editorOptions" x-save="save"></div>\r\n</div>'}),define("extensions.qliktech/text-image/text-image-properties",["general.utils/property-resolver"],function(a){return{type:"items",component:"accordion",items:{data:{uses:"data"},settings:{uses:"settings",items:{general:{items:{showTitles:{defaultValue:!1}}},presentation:{type:"items",translation:"properties.presentation",items:{responsive:{type:"string",component:"dropdown",ref:"responsive",translation:"properties.textImage.responsive",defaultValue:"all",undefinedValue:"none",snapshot:{tid:"property-responsive"},options:[{value:"all",translation:"properties.textImage.responsive.textImages"},{value:"text",translation:"properties.textImage.responsive.text"},{value:"images",translation:"properties.textImage.responsive.images"},{value:"none",translation:"properties.textImage.responsive.none"}]}}},markdown:{type:"string",ref:"markdown",show:!1,defaultValue:""},backgroundImage:{type:"items",translation:"properties.backgroundImage",grouped:!0,items:{useBackgroundImage:{ref:"background.isUsed",type:"boolean",translation:"properties.backgroundImage.use",component:"switch",defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},backgroundUrl:{ref:"background.url",translation:"Common.Image",tooltip:{select:"properties.media.select",remove:"properties.media.removeBackground"},type:"string",component:"media",defaultValue:"",show:function(b){return a.getValue(b,"background.isUsed")}},backgroundSize:{ref:"background.size",translation:"properties.backgroundImage.size",type:"string",component:"dropdown",defaultValue:"auto",options:[{value:"auto",translation:"Common.Auto"},{value:"alwaysFit",translation:"properties.backgroundImage.sizeAlwaysFit"},{value:"fitWidth",translation:"properties.backgroundImage.sizeFitWidth"},{value:"fitHeight",translation:"properties.backgroundImage.sizeFitHeight"},{value:"fill",translation:"properties.backgroundImage.sizeStretch"}],show:function(b){return a.getValue(b,"background.isUsed")&&a.getValue(b,"background.url")}},backgroundPosition:{ref:"background.position",translation:"Common.Position",type:"string",component:"align-matrix",defaultValue:"topLeft",show:function(b){return a.getValue(b,"background.isUsed")&&a.getValue(b,"background.url")}}}}}}}}}),function(){var a=[],b=a.slice,c={on:function(a,b,c){if(!e(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!e(this,"once",a,[b,c])||!b)return this;var d=this,f=_.once(function(){d.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,c)},off:function(a,b,c){var d,f,g,h,i,j,k,l;if(!this._events||!e(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(h=a?[a]:_.keys(this._events),i=0,j=h.length;j>i;i++)if(a=h[i],g=this._events[a]){if(this._events[a]=d=[],b||c)for(k=0,l=g.length;l>k;k++)f=g[k],(b&&b!==f.callback&&b!==f.callback._callback||c&&c!==f.context)&&d.push(f);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var c=b.call(arguments,1);if(!e(this,"trigger",a,c))return this;var d=this._events[a],g=this._events.all;return d&&f(d,c),g&&f(g,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},d=/\s+/,e=function(a,b,c,e){if(!c)return!0;if("object"==typeof c){for(var f in c)a[b].apply(a,[f,c[f]].concat(e));return!1}if(d.test(c)){for(var g=c.split(d),h=0,i=g.length;i>h;h++)a[b].apply(a,[g[h]].concat(e));return!1}return!0},f=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},g={listenTo:"on",listenToOnce:"once"};_.each(g,function(a,b){c[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=_.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),c.bind=c.on,c.unbind=c.off,"undefined"!=typeof define&&"function"==typeof define&&define.amd&&define("eventable",[],function(){return c}),this.Eventable=c}(),/*!
 * Sir Trevor JS v0.3.2
 *
 * Released under the MIT license
 * www.opensource.org/licenses/MIT
 *
 * 2013-12-21
 */
function(a,b){function c(b){return b instanceof a?b:a(b)}var d,e=this;d=e.SirTrevor={},d.DEBUG=!1,d.SKIP_VALIDATION=!1,d.version="0.3.0",d.LANGUAGE="en",d.DEFAULTS={defaultType:!1,spinner:{className:"st-spinner",lines:9,length:8,width:3,radius:6,color:"#000",speed:1.4,trail:57,shadow:!1,left:"50%",top:"50%"},blockLimit:0,blockTypeLimits:{},required:[],uploadUrl:"/attachments",baseImageUrl:"/sir-trevor-uploads/",errorsContainer:void 0},d.BlockMixins={},d.Blocks={},d.Formatters={},d.instances=[],d.Events=Eventable;var f=!1,g={bound:[],_bindFunctions:function(){this.bound.length>0&&b.bindAll.apply(null,b.union([this],this.bound))}},h={tagName:"div",className:"sir-trevor__view",attributes:{},$:function(a){return this.$el.find(a)},render:function(){return this},destroy:function(){b.isUndefined(this.stopListening)||this.stopListening(),this.$el.remove()},_ensureElement:function(){if(this.el)this._setElement(this.el);else{var c,d=b.extend({},b.result(this,"attributes"));this.id&&(d.id=this.id),this.className&&(d["class"]=this.className),d.html&&(c=d.html,delete d.html);var e=a("<"+this.tagName+">").attr(d);c&&e.html(c),this._setElement(e)}},_setElement:function(a){return this.$el=c(a),this.el=this.$el[0],this}};!function(a){function b(a){a.preventDefault()}function c(b){b.originalEvent.dataTransfer.dropEffect="copy",a(b.currentTarget).addClass("st-drag-over"),b.preventDefault()}function d(b){a(b.currentTarget).removeClass("st-drag-over"),b.preventDefault()}a.fn.dropArea=function(){return this.bind("dragenter",b).bind("dragover",c).bind("dragleave",d),this},a.fn.noDropArea=function(){return this.unbind("dragenter").unbind("dragover").unbind("dragleave"),this},a.fn.caretToEnd=function(){var a,b;return a=document.createRange(),a.selectNodeContents(this[0]),a.collapse(!1),b=window.getSelection(),b.removeAllRanges(),b.addRange(a),this}}(jQuery);var i=function(a,c){var d,e=this;d=a&&b.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},b.extend(d,e,c);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&b.extend(d.prototype,a),d.__super__=e.prototype,d};d.log=function(a){!b.isUndefined(console)&&d.DEBUG&&console.log(a)},d.Locales={en:{general:{"delete":"Delete?",drop:"Drag __block__ here",paste:"Or paste URL here",upload:"...or choose a file",close:"close",position:"Position",wait:"Please wait...",link:"Enter a link"},errors:{title:"You have the following errors:",validation_fail:"__type__ block is invalid",block_empty:"__name__ must not be empty",type_missing:"You must have a block of type __type__",required_type_empty:"A required block type __type__ is empty",load_fail:"There was a problem loading the contents of the document"},blocks:{text:{title:"Text"},list:{title:"List"},quote:{title:"Quote",credit_field:"Credit"},image:{title:"Image",upload_error:"There was a problem with your upload"},video:{title:"Video"},tweet:{title:"Tweet",fetch_error:"There was a problem fetching your tweet"},embedly:{title:"Embedly",fetch_error:"There was a problem fetching your embed",key_missing:"An Embedly API key must be present"},heading:{title:"Heading"}}}},void 0===window.i18n?(d.log("Using i18n stub"),window.i18n={t:function(a,c){var e,f,g,h,i=a.split(":");for(f=d.Locales[d.LANGUAGE],h=0;h<i.length;h++)g=i[h],b.isUndefined(f[g])||(f=f[g]);return e=f,b.isString(e)?(e.indexOf("__")>=0&&b.each(c,function(a,b){e=e.replace("__"+b+"__",a)}),e):""}}):(d.log("Using i18next"),i18n.init({resStore:d.Locales,fallbackLng:d.LANGUAGE,ns:{namespaces:["general","blocks"],defaultNs:"general"}})),function(a,b,c){function d(a,c){var d,e=b.createElement(a||"div");for(d in c)e[d]=c[d];return e}function e(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function f(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=k.substring(0,k.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(n.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",0),m[e]=1),e}function g(a,b){var d,e,f=a.style;if(f[b]!==c)return b;for(b=b.charAt(0).toUpperCase()+b.slice(1),e=0;e<l.length;e++)if(d=l[e]+b,f[d]!==c)return d}function h(a,b){for(var c in b)a.style[g(a,c)||c]=b[c];return a}function i(a){for(var b=1;b<arguments.length;b++){var d=arguments[b];for(var e in d)a[e]===c&&(a[e]=d[e])}return a}function j(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}var k,l=["webkit","Moz","ms","O"],m={},n=function(){var a=d("style");return e(b.getElementsByTagName("head")[0],a),a.sheet||a.styleSheet}(),o={lines:12,length:7,width:5,radius:10,rotate:0,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto"},p=function q(a){return this.spin?void(this.opts=i(a||{},q.defaults,o)):new q(a)};p.defaults={},i(p.prototype,{spin:function(a){this.stop();var b,c,e=this,f=e.opts,g=e.el=h(d(0,{className:f.className}),{position:"relative",zIndex:f.zIndex}),i=f.radius+f.length+f.width;if(a&&(a.insertBefore(g,a.firstChild||null),c=j(a),b=j(g),h(g,{left:("auto"==f.left?c.x-b.x+(a.offsetWidth>>1):f.left+i)+"px",top:("auto"==f.top?c.y-b.y+(a.offsetHeight>>1):f.top+i)+"px"})),g.setAttribute("aria-role","progressbar"),e.lines(g,e.opts),!k){var l=0,m=f.fps,n=m/f.speed,o=(1-f.opacity)/(n*f.trail/100),p=n/f.lines;!function q(){l++;for(var a=f.lines;a;a--){var b=Math.max(1-(l+a*p)%n*o,f.opacity);e.opacity(g,f.lines-a,b,f)}e.timeout=e.el&&setTimeout(q,~~(1e3/m))}()}return e},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=c),this},lines:function(a,b){function c(a,c){return h(d(),{position:"absolute",width:b.length+b.width+"px",height:b.width+"px",background:a,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/b.lines*i+b.rotate)+"deg) translate("+b.radius+"px,0)",borderRadius:(b.width>>1)+"px"})}for(var g,i=0;i<b.lines;i++)g=h(d(),{position:"absolute",top:1+~(b.width/2)+"px",transform:b.hwaccel?"translate3d(0,0,0)":"",opacity:b.opacity,animation:k&&f(b.opacity,b.trail,i,b.lines)+" "+1/b.speed+"s linear infinite"}),b.shadow&&e(g,h(c("#000","0 0 4px #000"),{top:"2px"})),e(a,e(g,c(b.color,"0 0 1px rgba(0,0,0,.1)")));return a},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}}),!function(){function a(a,b){return d("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',b)}var b=h(d("group"),{behavior:"url(#default#VML)"});!g(b,"transform")&&b.adj?(n.addRule(".spin-vml","behavior:url(#default#VML)"),p.prototype.lines=function(b,c){function d(){return h(a("group",{coordsize:j+" "+j,coordorigin:-i+" "+-i}),{width:j,height:j})}function f(b,f,g){e(l,e(h(d(),{rotation:360/c.lines*b+"deg",left:~~f}),e(h(a("roundrect",{arcsize:1}),{width:i,height:c.width,left:c.radius,top:-c.width>>1,filter:g}),a("fill",{color:c.color,opacity:c.opacity}),a("stroke",{opacity:0}))))}var g,i=c.length+c.width,j=2*i,k=2*-(c.width+c.length)+"px",l=h(d(),{position:"absolute",top:k,left:k});if(c.shadow)for(g=1;g<=c.lines;g++)f(g,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(g=1;g<=c.lines;g++)f(g);return e(b,l)},p.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}):k=g(b,"animation")}(),a.Spinner=p}(window,document),d.editorStore=function(a,c,e){var f;switch(e=e||{},c){case"create":var g=b.trim(a.$el.val());if(a.dataStore={data:[]},g.length>0)try{var h=JSON.parse(g);b.isUndefined(h.data)||(a.dataStore=h)}catch(i){a.errors.push({text:i18n.t("errors:load_fail")}),a.renderErrors(),d.log("Sorry there has been a problem with parsing the JSON"),d.log(i)}break;case"reset":a.dataStore={data:[]};break;case"add":e.data&&(a.dataStore.data.push(e.data),f=a.dataStore);break;case"save":a.$el.val(a.dataStore.data.length>0?JSON.stringify(a.dataStore):"");break;case"read":f=a.dataStore}return f?f:void 0},d.Submittable=function(a){this.$form=a,this.intialize()},b.extend(d.Submittable.prototype,{intialize:function(){this.$submitBtn=this.$form.find("input[type='submit']");var c=[];b.each(this.$submitBtn,function(b){c.push(a(b).attr("value"))}),this.submitBtnTitles=c,this.canSubmit=!0,this.globalUploadCount=0,this._bindEvents()},setSubmitButton:function(a,b){this.$submitBtn.attr("value",b)},resetSubmitButton:function(){b.each(this.$submitBtn,function(b,c){a(b).attr("value",this.submitBtnTitles[c])},this)},onUploadStart:function(){this.globalUploadCount++,d.log("onUploadStart called "+this.globalUploadCount),1===this.globalUploadCount&&this._disableSubmitButton()},onUploadStop:function(){this.globalUploadCount=this.globalUploadCount<=0?0:this.globalUploadCount-1,d.log("onUploadStop called "+this.globalUploadCount),0===this.globalUploadCount&&this._enableSubmitButton()},onError:function(){d.log("onError called"),this.canSubmit=!1},_disableSubmitButton:function(a){this.setSubmitButton(null,a||i18n.t("general:wait")),this.$submitBtn.attr("disabled","disabled").addClass("disabled")},_enableSubmitButton:function(){this.resetSubmitButton(),this.$submitBtn.removeAttr("disabled").removeClass("disabled")},_events:{disableSubmitButton:"_disableSubmitButton",enableSubmitButton:"_enableSubmitButton",setSubmitButton:"setSubmitButton",resetSubmitButton:"resetSubmitButton",onError:"onError",onUploadStart:"onUploadStart",onUploadStop:"onUploadStop"},_bindEvents:function(){b.forEach(this._events,function(a,b){d.EventBus.on(b,this[a],this)},this)}}),d.fileUploader=function(c,e,f,g){var h=[c.blockID,(new Date).getTime(),"raw"].join("-"),i=new FormData;i.append("attachment[name]",e.name),i.append("attachment[file]",e),i.append("attachment[uid]",h),c.resetMessages();var j=function(a){d.log("Upload callback called"),!b.isUndefined(f)&&b.isFunction(f)&&b.bind(f,c)(a)},k=function(a,e){d.log("Upload callback error called"),!b.isUndefined(g)&&b.isFunction(g)&&b.bind(g,c)(e)},l=a.ajax({url:d.DEFAULTS.uploadUrl,data:i,cache:!1,contentType:!1,processData:!1,dataType:"json",type:"POST"});return c.addQueuedItem(h,l),l.done(j).fail(k).always(b.bind(c.removeQueuedItem,c,h)),l};var j=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;b.mixin({isURI:function(a){return j.test(a)},titleize:function(a){return null===a?"":(a=String(a).toLowerCase(),a.replace(/(?:^|\s|-)\S/g,function(a){return a.toUpperCase()}))},classify:function(a){return b.titleize(String(a).replace(/[\W_]/g," ")).replace(/\s/g,"")},classifyList:function(a){return b.map(a,function(a){return b.classify(a)})},capitalize:function(a){return a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()},underscored:function(a){return b.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},reverse:function(a){return a.split("").reverse().join("")},flattern:function(a){var c={};return b.each(a,function(d,e){c[b.isArray(a)?d:e]=!0}),c},to_slug:function(a){return a.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}}),d.toHTML=function(a,c){c=b.classify(c);var e=a,f="Text"===c;b.isUndefined(f)&&(f=!1),f&&(e="<div>"+e),e=e.replace(/^\> (.+)$/gm,"$1");var g,h;for(g in d.Formatters)d.Formatters.hasOwnProperty(g)&&(h=d.Formatters[g],!b.isUndefined(h.toHTML)&&b.isFunction(h.toHTML)&&(e=h.toHTML(e)));var i;return d.Blocks.hasOwnProperty(c)&&(i=d.Blocks[c],!b.isUndefined(i.prototype.toHTML)&&b.isFunction(i.prototype.toHTML)&&(e=i.prototype.toHTML(e))),f&&(e=e.replace(/\n\n/gm,"</div><div><br></div><div>"),e=e.replace(/\n/gm,"</div><div>")),e=e.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\n/g,"<br>").replace(/\*\*/,"").replace(/__/,""),e=e.replace(/\\\*/g,"*").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\_/g,"_").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\~/g,"~").replace(/\\\-/g,"-"),f&&(e+="</div>"),e},d.toMarkdown=function(a,c){c=b.classify(c);var e=a;e=e.replace(/( class=(")?Mso[a-zA-Z]+(")?)/g,"").replace(/<!--(.*?)-->/g,"").replace(/\/\*(.*?)\*\//g,"").replace(/<(\/)*(meta|link|\\?xml:|st1:|o:)(.*?)>/gi,"");var f,g,h=["style","script","applet","embed","noframes","noscript"];for(g=0;g<h.length;g++)f=new RegExp("<"+h[g]+".*?"+h[g]+"(.*?)>","gi"),e=e.replace(f,"");e=e.replace(/\*/g,"\\*").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\_/g,"\\_").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\~/g,"\\~").replace(/\-/g,"\\-"),e=e.replace(/\u200b/g,"").replace(/<(\w+)(?:\s+\w+="[^"]+(?:"\$[^"]+"[^"]+)?")*>\s*<\/\1>/gim,"").replace(/\n/gm,"");var i,j;for(i in d.Formatters)d.Formatters.hasOwnProperty(i)&&(j=d.Formatters[i],!b.isUndefined(j.toMarkdown)&&b.isFunction(j.toMarkdown)&&(e=j.toMarkdown(e)));e=e.replace(/([^<>]+)(<div>)/g,"$1\n$2").replace(/<div><div>/g,"\n<div>").replace(/(?:<div>)([^<>]+)(?:<div>)/g,"$1\n").replace(/(?:<div>)(?:<br>)?([^<>]+)(?:<br>)?(?:<\/div>)/g,"$1\n").replace(/<\/p>(?!$)/g,"\n").replace(/<(.)?br(.)?>/g,"\n"),e=e.replace(/&nbsp;/g," ");var k;return d.Blocks.hasOwnProperty(c)&&(k=d.Blocks[c],!b.isUndefined(k.prototype.toMarkdown)&&b.isFunction(k.prototype.toMarkdown)&&(e=k.prototype.toMarkdown(e))),e=e.replace(/<\/?[^>]+(>|$)/g,"")},d.EventBus=b.extend({},d.Events),d.BlockMixins.Ajaxable={mixinName:"Ajaxable",ajaxable:!0,initializeAjaxable:function(){this._queued=[]},addQueuedItem:function(a,b){d.log("Adding queued item for "+this.blockID+" called "+a),d.EventBus.trigger("onUploadStart"),this._queued.push({name:a,deffered:b})},removeQueuedItem:function(a){d.log("Removing queued item for "+this.blockID+" called "+a),d.EventBus.trigger("onUploadStop"),this._queued=b.reject(this._queued,function(b){return b.name==a})},hasItemsInQueue:function(){return this._queued.length>0},resolveAllInQueue:function(){b.each(this._queued,function(a){d.log("Aborting queued request: "+a.name),a.deffered.abort()},this)}},d.BlockMixins.Controllable={mixinName:"Controllable",initializeControllable:function(){d.log("Adding controllable to block "+this.blockID),this.$control_ui=a("<div>",{"class":"st-block__control-ui"}),b.each(this.controls,function(a,c){this.addUiControl(c,b.bind(a,this))},this),this.$inner.append(this.$control_ui)},getControlTemplate:function(b){return a("<a>",{"data-icon":b,"class":"st-icon st-block-control-ui-btn st-block-control-ui-btn--"+b})},addUiControl:function(a,b){this.$control_ui.append(this.getControlTemplate(a)),this.$control_ui.on("click",".st-block-control-ui-btn--"+a,b)}},d.BlockMixins.Droppable={mixinName:"Droppable",valid_drop_file_types:["File","Files","text/plain","text/uri-list"],initializeDroppable:function(){d.log("Adding droppable to block "+this.blockID),this.drop_options=b.extend({},d.DEFAULTS.Block.drop_options,this.drop_options);var c=a(b.template(this.drop_options.html,{block:this}));this.$editor.hide(),this.$inputs.append(c),this.$dropzone=c,this.$dropzone.dropArea().bind("drop",b.bind(this._handleDrop,this)),this.$inner.addClass("st-block__inner--droppable")},_handleDrop:function(c){c.preventDefault(),c=c.originalEvent;var e=a(c.target),f=c.dataTransfer.types;e.removeClass("st-dropzone--dragover"),!b.isUndefined(f)&&b.some(f,function(a){return b.include(this.valid_drop_file_types,a)},this)&&this.onDrop(c.dataTransfer),d.EventBus.trigger("block:content:dropped")}},d.BlockMixins.Fetchable={mixinName:"Fetchable",initializeFetchable:function(){this.withMixin(d.BlockMixins.Ajaxable)},fetch:function(c,d,e){var f=b.uniqueId(this.blockID+"_fetch"),g=a.ajax(c);return this.resetMessages(),this.addQueuedItem(f,g),b.isUndefined(d)||g.done(b.bind(d,this)),b.isUndefined(e)||g.fail(b.bind(e,this)),g.always(b.bind(this.removeQueuedItem,this,f)),g}},d.BlockMixins.Pastable={mixinName:"Pastable",initializePastable:function(){d.log("Adding pastable to block "+this.blockID),this.paste_options=b.extend({},d.DEFAULTS.Block.paste_options,this.paste_options),this.$inputs.append(b.template(this.paste_options.html,this)),this.$(".st-paste-block").bind("click",function(){a(this).select()}).bind("paste",this._handleContentPaste).bind("submit",this._handleContentPaste)}},d.BlockMixins.Uploadable={mixinName:"Uploadable",uploadsCount:0,initializeUploadable:function(){d.log("Adding uploadable to block "+this.blockID),this.withMixin(d.BlockMixins.Ajaxable),this.upload_options=b.extend({},d.DEFAULTS.Block.upload_options,this.upload_options),this.$inputs.append(b.template(this.upload_options.html,this))},uploader:function(a,b,c){return d.fileUploader(this,a,b,c)}},d.BlockPositioner=function(){var a=["<div class='st-block-positioner__inner'>","<span class='st-block-positioner__selected-value'></span>","<select class='st-block-positioner__select'></select>","</div>"].join("\n"),c=function(a,b){this.$block=a,this.instanceID=b,this.total_blocks=0,this._ensureElement(),this._bindFunctions(),this.initialize()};return b.extend(c.prototype,g,h,{bound:["onBlockCountChange","onSelectChange","toggle","show","hide"],className:"st-block-positioner",visibleClass:"st-block-positioner--is-visible",initialize:function(){this.$el.append(a),this.$select=this.$(".st-block-positioner__select"),this.$select.on("change",this.onSelectChange),d.EventBus.on(this.instanceID+":blocks:count_update",this.onBlockCountChange)},onBlockCountChange:function(a){a!=this.total_blocks&&(this.total_blocks=a,this.renderPositionList())},onSelectChange:function(){var a=this.$select.val();0!==a&&(d.EventBus.trigger(this.instanceID+":blocks:change_position",this.$block,a,1==a?"before":"after"),this.toggle())},renderPositionList:function(){for(var a="<option value='0'>"+i18n.t("general:position")+"</option>",b=1;b<=this.total_blocks;b++)a+="<option value="+b+">"+b+"</option>";this.$select.html(a)},toggle:function(){this.$select.val(0),this.$el.toggleClass(this.visibleClass)},show:function(){this.$el.addClass(this.visibleClass)},hide:function(){this.$el.removeClass(this.visibleClass)}}),c}(),d.BlockReorder=function(){var c=function(a){this.$block=a,this._ensureElement(),this._bindFunctions(),this.initialize()};return b.extend(c.prototype,g,h,{bound:["onMouseDown","onClick","onDragStart","onDragEnd","onDrag","onDrop"],className:"st-block-ui-btn st-block-ui-btn--reorder st-icon",tagName:"a",attributes:function(){return{html:"reorder",draggable:"true","data-icon":"move"}},initialize:function(){this.$el.bind("mousedown touchstart",this.onMouseDown).bind("click",this.onClick).bind("dragstart",this.onDragStart).bind("dragend touchend",this.onDragEnd).bind("drag touchmove",this.onDrag),this.$block.dropArea().bind("drop",this.onDrop)},onMouseDown:function(){d.EventBus.trigger("block:reorder:down")},onDrop:function(c){c.preventDefault();var e=this.$block,f=c.originalEvent.dataTransfer.getData("text/plain"),g=a("#"+f);b.isUndefined(f)||b.isEmpty(g)||e.attr("id")==f||e.attr("data-instance")!=g.attr("data-instance")||e.after(g),d.EventBus.trigger("block:reorder:dropped",f)},onDragStart:function(b){var c=a(b.currentTarget).parent();b.originalEvent.dataTransfer.setDragImage(this.$block[0],c.position().left,c.position().top),b.originalEvent.dataTransfer.setData("Text",this.$block.attr("id")),d.EventBus.trigger("block:reorder:dragstart"),this.$block.addClass("st-block--dragging")},onDragEnd:function(){d.EventBus.trigger("block:reorder:dragend"),this.$block.removeClass("st-block--dragging")},onDrag:function(){},onClick:function(){},render:function(){return this}}),c}(),d.BlockDeletion=function(){var a=function(){this._ensureElement(),this._bindFunctions()};return b.extend(a.prototype,g,h,{tagName:"a",className:"st-block-ui-btn st-block-ui-btn--delete st-icon",attributes:{html:"delete","data-icon":"bin"}}),a}();var k=function(a){var c=a.attr("data-st-name")||a.attr("name");return c||(c="Field"),b.capitalize(c)};d.BlockValidations={errors:[],valid:function(){return this.performValidations(),0===this.errors.length},performValidations:function(){this.resetErrors();var a=this.$(".st-required");b.each(a,this.validateField,this),b.each(this.validations,this.runValidator,this),this.$el.toggleClass("st-block--with-errors",this.errors.length>0)},validations:[],validateField:function(b){b=a(b);var c=b.attr("contenteditable")?b.text():b.val();0===c.length&&this.setError(b,i18n.t("errors:block_empty",{name:k(b)}))},runValidator:function(a){b.isUndefined(this[a])||this[a].call(this)},setError:function(a,b){var c=this.addMessage(b,"st-msg--error");a.addClass("st-error"),this.errors.push({field:a,reason:b,msg:c})},resetErrors:function(){b.each(this.errors,function(a){a.field.removeClass("st-error"),a.msg.remove()}),this.$messages.removeClass("st-block__messages--is-visible"),this.errors=[]}},d.BlockStore={blockStorage:{},createStore:function(a){this.blockStorage={type:b.underscored(this.type),data:a||{}}},save:function(){this.toData()},saveAndReturnData:function(){return this.save(),this.blockStorage},saveAndGetData:function(){var a=this.saveAndReturnData();return a.data||a},getData:function(){return this.blockStorage.data},setData:function(a){d.log("Setting data for block "+this.blockID),b.extend(this.blockStorage.data,a||{})},setAndRetrieveData:function(a){return this.setData(a),this.getData()},setAndLoadData:function(a){this.setData(a),this.beforeLoadingData()},toData:function(){},loadData:function(){},beforeLoadingData:function(){d.log("loadData for "+this.blockID),d.EventBus.trigger("editor/block/loadData"),this.loadData(this.getData())},_loadData:function(){d.log("_loadData is deprecated and will be removed in the future. Please use beforeLoadingData instead."),this.beforeLoadingData()},checkAndLoadData:function(){b.isEmpty(this.getData())||this.beforeLoadingData()}},d.SimpleBlock=function(){var c=function(a,c){this.createStore(a),this.blockID=b.uniqueId("st-block-"),this.instanceID=c,this._ensureElement(),this._bindFunctions(),this.initialize.apply(this,arguments)};return b.extend(c.prototype,g,d.Events,h,d.BlockStore,{focus:function(){},valid:function(){return!0},className:"st-block",block_template:b.template("<div class='st-block__inner'><%= editor_html %></div>"),attributes:function(){return{id:this.blockID,"data-type":this.type,"data-instance":this.instanceID}},title:function(){return b.titleize(this.type.replace(/[\W_]/g," "))},blockCSSClass:function(){return this.blockCSSClass=b.to_slug(this.type),this.blockCSSClass},type:"","class":function(){return b.classify(this.type)},editorHTML:"",initialize:function(){},onBlockRender:function(){},beforeBlockRender:function(){},_setBlockInner:function(){var a=b.result(this,"editorHTML");this.$el.append(this.block_template({editor_html:a})),this.$inner=this.$el.find(".st-block__inner"),this.$inner.bind("click mouseover",function(a){a.stopPropagation()})},render:function(){return this.beforeBlockRender(),this._setBlockInner(),this._blockPrepare(),this},_blockPrepare:function(){this._initUI(),this._initMessages(),this.checkAndLoadData(),this.$el.addClass("st-item-ready"),this.on("onRender",this.onBlockRender),this.save()},_withUIComponent:function(a,b,c){this.$ui.append(a.render().$el),b&&c&&this.$ui.on("click",b,c)},_initUI:function(){var b=a("<div>",{"class":"st-block__ui"});this.$inner.append(b),this.$ui=b,this._initUIComponents()},_initMessages:function(){var b=a("<div>",{"class":"st-block__messages"});this.$inner.prepend(b),this.$messages=b},addMessage:function(b,c){var d=a("<span>",{html:b,"class":"st-msg "+c});return this.$messages.append(d).addClass("st-block__messages--is-visible"),d},resetMessages:function(){this.$messages.html("").removeClass("st-block__messages--is-visible")},_initUIComponents:function(){this._withUIComponent(new d.BlockReorder(this.$el))}}),c.fn=c.prototype,c.extend=i,c}(),d.Block=function(){var c=function(){d.SimpleBlock.apply(this,arguments)},e=["<div class='st-block__ui-delete-controls'>","<label class='st-block__delete-label'>","<%= i18n.t('general:delete') %>","</label>","<a class='st-block-ui-btn st-block-ui-btn--confirm-delete st-icon' data-icon='tick'></a>","<a class='st-block-ui-btn st-block-ui-btn--deny-delete st-icon' data-icon='close'></a>","</div>"].join("\n"),f={html:['<div class="st-block__dropzone">','<span class="st-icon"><%= _.result(block, "icon_name") %></span>','<p><%= i18n.t("general:drop", { block: "<span>" + _.result(block, "title") + "</span>" }) %>',"</p></div>"].join("\n"),re_render_on_reorder:!1},g={html:['<input type="text" placeholder="<%= i18n.t("general:paste") %>"',' class="st-block__paste-input st-paste-block">'].join("")},h={html:['<div class="st-block__upload-container">','<input type="file" type="st-file-upload">','<button class="st-upload-btn"><%= i18n.t("general:upload") %></button>',"</div>"].join("\n")};return d.DEFAULTS.Block={drop_options:f,paste_options:g,upload_options:h},b.extend(c.prototype,d.SimpleBlock.fn,d.BlockValidations,{bound:["_handleContentPaste","_onFocus","_onBlur","onDrop","onDeleteClick","clearInsertedStyles","getSelectionForFormatter","onBlockRender"],className:"st-block st-icon--add",attributes:function(){return b.extend(d.SimpleBlock.fn.attributes.call(this),{"data-icon-after":"add"})},icon_name:"default",validationFailMsg:function(){return i18n.t("errors:validation_fail",{type:this.title()})},editorHTML:'<div class="st-block__editor"></div>',toolbarEnabled:!0,droppable:!1,pastable:!1,uploadable:!1,fetchable:!1,ajaxable:!1,drop_options:{},paste_options:{},upload_options:{},formattable:!0,_previousSelection:"",initialize:function(){},toMarkdown:function(a){return a},toHTML:function(a){return a},withMixin:function(a){if(b.isObject(a)){var c="initialize"+a.mixinName;b.isUndefined(this[c])&&(b.extend(this,a),this[c]())}},render:function(){if(this.beforeBlockRender(),this._setBlockInner(),this.$editor=this.$inner.children().first(),this.droppable||this.pastable||this.uploadable){var b=a("<div>",{"class":"st-block__inputs"});this.$inner.append(b),this.$inputs=b}return this.hasTextBlock&&this._initTextBlocks(),this.droppable&&this.withMixin(d.BlockMixins.Droppable),this.pastable&&this.withMixin(d.BlockMixins.Pastable),this.uploadable&&this.withMixin(d.BlockMixins.Uploadable),this.fetchable&&this.withMixin(d.BlockMixins.Fetchable),this.controllable&&this.withMixin(d.BlockMixins.Controllable),this.formattable&&this._initFormatting(),this._blockPrepare(),this},remove:function(){this.ajaxable&&this.resolveAllInQueue(),this.$el.remove()},loading:function(){b.isUndefined(this.spinner)||this.ready(),this.spinner=new Spinner(d.DEFAULTS.spinner),this.spinner.spin(this.$el[0]),this.$el.addClass("st--is-loading")},ready:function(){this.$el.removeClass("st--is-loading"),b.isUndefined(this.spinner)||(this.spinner.stop(),delete this.spinner)},toData:function(){d.log("toData for "+this.blockID);var a=(this.$el,{});if(this.hasTextBlock()){var c=this.getTextBlock().html();c.length>0&&(a.text=d.toMarkdown(c,this.type))}this.$(":input").not(".st-paste-block").length>0&&this.$(":input").each(function(b,c){c.getAttribute("name")&&(a[c.getAttribute("name")]=c.value)}),b.isEmpty(a)||this.setData(a)},focus:function(){this.getTextBlock().focus()},blur:function(){this.getTextBlock().blur()},onFocus:function(){this.getTextBlock().bind("focus",this._onFocus)},onBlur:function(){this.getTextBlock().bind("blur",this._onBlur)},_onFocus:function(){this.trigger("blockFocus",this.$el)},_onBlur:function(){},onDrop:function(){},onDeleteClick:function(a){a.preventDefault();var c=function(a){a.preventDefault(),this.trigger("removeBlock",this.blockID)},d=function(a){a.preventDefault(),this.$el.removeClass("st-block--delete-active"),f.remove()};if(this.isEmpty())return void c.call(this,new Event("click"));this.$inner.append(b.template(e)),this.$el.addClass("st-block--delete-active");var f=this.$inner.find(".st-block__ui-delete-controls");this.$inner.on("click",".st-block-ui-btn--confirm-delete",b.bind(c,this)).on("click",".st-block-ui-btn--deny-delete",b.bind(d,this))},pastedMarkdownToHTML:function(a){return d.toHTML(d.toMarkdown(a,this.type),this.type)},onContentPasted:function(a,b){b.html(this.pastedMarkdownToHTML(b[0].innerHTML)),this.getTextBlock().caretToEnd()},beforeLoadingData:function(){this.loading(),(this.droppable||this.uploadable||this.pastable)&&(this.$editor.show(),this.$inputs.hide()),d.SimpleBlock.fn.beforeLoadingData.call(this),this.ready()},_handleContentPaste:function(c){var d=a(c.currentTarget);b.delay(b.bind(this.onContentPasted,this,c,d),0)},_getBlockClass:function(){return"st-block--"+this.className},_initUIComponents:function(){var a=new d.BlockPositioner(this.$el,this.instanceID);this._withUIComponent(a,".st-block-ui-btn--reorder",a.toggle),this._withUIComponent(new d.BlockReorder(this.$el)),this._withUIComponent(new d.BlockDeletion,".st-block-ui-btn--delete",this.onDeleteClick),this.onFocus(),this.onBlur()},_initFormatting:function(){var a;for(var c in d.Formatters)d.Formatters.hasOwnProperty(c)&&(a=d.Formatters[c],b.isUndefined(a.keyCode)||a._bindToBlock(this.$el))},_initTextBlocks:function(){this.getTextBlock().bind("paste",this._handleContentPaste).bind("keyup",this.getSelectionForFormatter).bind("mouseup",this.getSelectionForFormatter).bind("DOMNodeInserted",this.clearInsertedStyles)},getSelectionForFormatter:function(){b.defer(function(){var a=window.getSelection(),b=a.toString().trim();d.EventBus.trigger(""===b?"formatter:hide":"formatter:positon")})},clearInsertedStyles:function(a){var b=a.target;b.removeAttribute("style")},hasTextBlock:function(){return this.getTextBlock().length>0},getTextBlock:function(){return b.isUndefined(this.text_block)&&(this.text_block=this.$(".st-text-block")),this.text_block},isEmpty:function(){return b.isEmpty(this.saveAndGetData())}}),c.extend=i,c}(),d.Formatter=function(){var a=function(a){this.formatId=b.uniqueId("format-"),this._configure(a||{}),this.initialize.apply(this,arguments)},c=["title","className","cmd","keyCode","param","onClick","toMarkdown","toHTML"];return b.extend(a.prototype,{title:"",className:"",cmd:null,keyCode:null,param:null,toMarkdown:function(a){return a},toHTML:function(a){return a},initialize:function(){},_configure:function(a){this.options&&(a=b.extend({},this.options,a));for(var d=0,e=c.length;e>d;d++){var f=c[d];a[f]&&(this[f]=a[f])}this.options=a},isActive:function(){return document.queryCommandState(this.cmd)},_bindToBlock:function(a){var b=this,c=!1;a.on("keyup",".st-text-block",function(a){(17==a.which||224==a.which||91==a.which)&&(c=!1)}).on("keydown",".st-text-block",{formatter:b},function(a){(17==a.which||224==a.which||91==a.which)&&(c=!0),a.which==a.data.formatter.keyCode&&c===!0&&(document.execCommand(a.data.formatter.cmd,!1,!0),a.preventDefault(),c=!1)})}}),a.extend=i,a}(),d.Blocks.Quote=function(){var a=b.template(['<blockquote class="st-required st-text-block" contenteditable="true"></blockquote>','<label class="st-input-label"> <%= i18n.t("blocks:quote:credit_field") %></label>','<input maxlength="140" name="cite" placeholder="<%= i18n.t("blocks:quote:credit_field") %>"',' class="st-input-string st-required js-cite-input" type="text" />'].join("\n"));return d.Block.extend({type:"quote",title:function(){return i18n.t("blocks:quote:title")},icon_name:"quote",editorHTML:function(){return a(this)},loadData:function(a){this.getTextBlock().html(d.toHTML(a.text,this.type)),this.$(".js-cite-input").val(a.cite)},toMarkdown:function(a){return a.replace(/^(.+)$/gm,"> $1")}})}(),d.Blocks.Heading=d.Block.extend({type:"Heading",title:function(){return i18n.t("blocks:heading:title")},editorHTML:'<div class="st-required st-text-block st-text-block--heading" contenteditable="true"></div>',icon_name:"heading",loadData:function(a){this.getTextBlock().html(d.toHTML(a.text,this.type))}}),d.Blocks.Image=d.Block.extend({type:"image",title:function(){return i18n.t("blocks:image:title")},droppable:!0,uploadable:!0,icon_name:"image",loadData:function(b){this.$editor.html(a("<img>",{src:b.file.url}))},onBlockRender:function(){this.$inputs.find("button").bind("click",function(a){a.preventDefault()
}),this.$inputs.find("input").on("change",b.bind(function(a){this.onDrop(a.currentTarget)},this))},onDrop:function(b){var c=b.files[0],d="undefined"!=typeof URL?URL:"undefined"!=typeof webkitURL?webkitURL:null;/image/.test(c.type)&&(this.loading(),this.$inputs.hide(),this.$editor.html(a("<img>",{src:d.createObjectURL(c)})).show(),this.uploader(c,function(a){this.setData(a),this.ready()},function(){this.addMessage(i18n.t("blocks:image:upload_error")),this.ready()}))}}),d.Blocks.Text=d.Block.extend({type:"text",title:function(){return i18n.t("blocks:text:title")},editorHTML:'<div class="st-required st-text-block" contenteditable="true"></div>',icon_name:"text",loadData:function(a){this.getTextBlock().html(d.toHTML(a.text,this.type))}}),d.Blocks.Tweet=function(){var c=b.template(["<blockquote class='twitter-tweet' align='center'>","<p><%= text %></p>","&mdash; <%= user.name %> (@<%= user.screen_name %>)","<a href='<%= status_url %>' data-datetime='<%= created_at %>'><%= created_at %></a>","</blockquote>",'<script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>'].join("\n"));return d.Block.extend({type:"tweet",droppable:!0,pastable:!0,fetchable:!0,drop_options:{re_render_on_reorder:!0},title:function(){return i18n.t("blocks:tweet:title")},fetchUrl:function(a){return"/tweets/?tweet_id="+a},icon_name:"twitter",loadData:function(a){b.isUndefined(a.status_url)&&(a.status_url=""),this.$inner.find("iframe").remove(),this.$inner.prepend(c(a))},onContentPasted:function(b){var c=a(b.target),d=c.val();this.handleTwitterDropPaste(d)},handleTwitterDropPaste:function(a){if(!this.validTweetUrl(a))return void d.log("Invalid Tweet URL");var c=a.match(/[^\/]+$/);if(!b.isEmpty(c)){this.loading(),c=c[0];var e={url:this.fetchUrl(c),dataType:"json"};this.fetch(e,this.onTweetSuccess,this.onTweetFail)}},validTweetUrl:function(a){return b.isURI(a)&&-1!==a.indexOf("twitter")&&-1!==a.indexOf("status")},onTweetSuccess:function(a){var b={user:{profile_image_url:a.user.profile_image_url,profile_image_url_https:a.user.profile_image_url_https,screen_name:a.user.screen_name,name:a.user.name},id:a.id_str,text:a.text,created_at:a.created_at,entities:a.entities,status_url:"https://twitter.com/"+a.user.screen_name+"/status/"+a.id_str};this.setAndLoadData(b),this.ready()},onTweetFail:function(){this.addMessage(i18n.t("blocks:tweet:fetch_error")),this.ready()},onDrop:function(a){var b=a.getData("text/plain");this.handleTwitterDropPaste(b)}})}(),d.Blocks.List=function(){var a='<div class="st-text-block st-required" contenteditable="true"><ul><li></li></ul></div>';return d.Block.extend({type:"list",title:function(){return i18n.t("blocks:list:title")},icon_name:"list",editorHTML:function(){return b.template(a,this)},loadData:function(a){this.getTextBlock().html("<ul>"+d.toHTML(a.text,this.type)+"</ul>")},onBlockRender:function(){this.checkForList=b.bind(this.checkForList,this),this.getTextBlock().on("click keyup",this.checkForList)},checkForList:function(){0===this.$("ul").length&&document.execCommand("insertUnorderedList",!1,!1)},toMarkdown:function(a){return a.replace(/<\/li>/gm,"\n").replace(/<\/?[^>]+(>|$)/g,"").replace(/^(.+)$/gm," - $1")},toHTML:function(a){return a=a.replace(/^ - (.+)$/gm,"<li>$1</li>").replace(/\n/gm,"")},onContentPasted:function(a,b){{var c=this.pastedMarkdownToHTML(b[0].innerHTML);this.$("ul").html(c)}this.getTextBlock().caretToEnd()},isEmpty:function(){return b.isEmpty(this.saveAndGetData().text)}})}(),d.Blocks.Video=function(){return d.Block.extend({providers:{vimeo:{regex:/(?:http[s]?:\/\/)?(?:www.)?vimeo.com\/(.+)/,html:'<iframe src="{{protocol}}//player.vimeo.com/video/{{remote_id}}?title=0&byline=0" width="580" height="320" frameborder="0"></iframe>'},youtube:{regex:/(?:http[s]?:\/\/)?(?:www.)?(?:(?:youtube.com\/watch\?(?:.*)(?:v=))|(?:youtu.be\/))([^&].+)/,html:'<iframe src="{{protocol}}//www.youtube.com/embed/{{remote_id}}" width="580" height="320" frameborder="0" allowfullscreen></iframe>'}},type:"video",title:function(){return i18n.t("blocks:video:title")},droppable:!0,pastable:!0,icon_name:"video",loadData:function(a){if(this.providers.hasOwnProperty(a.source)){this.$editor.addClass(this.providers[a.source].square?"st-block__editor--with-square-media":"st-block__editor--with-sixteen-by-nine-media");var b=this.providers[a.source].html.replace("{{protocol}}",window.location.protocol).replace("{{remote_id}}",a.remote_id).replace("{{width}}",this.$editor.width());this.$editor.html(b)}},onContentPasted:function(b){this.handleDropPaste(a(b.target).val())},handleDropPaste:function(a){if(b.isURI(a)){var c,d;b.each(this.providers,function(e,f){c=e.regex.exec(a),null===c||b.isUndefined(c[1])||(d={source:f,remote_id:c[1]},this.setAndLoadData(d))},this)}},onDrop:function(a){var b=a.getData("text/plain");this.handleDropPaste(b)}})}(),function(){var a=d.Formatter.extend({title:"bold",cmd:"bold",keyCode:66,text:"B"}),b=d.Formatter.extend({title:"italic",cmd:"italic",keyCode:73,text:"i"}),c=d.Formatter.extend({title:"link",iconName:"link",cmd:"CreateLink",text:"link",onClick:function(){var a=prompt(i18n.t("general:link")),b=/((ftp|http|https):\/\/.)|mailto(?=\:[-\.\w]+@)/;a&&a.length>0&&(b.test(a)||(a="http://"+a),document.execCommand(this.cmd,!1,a))},isActive:function(){var a,b=window.getSelection();return b.rangeCount>0&&(a=b.getRangeAt(0).startContainer.parentNode),a&&"A"==a.nodeName}}),e=d.Formatter.extend({title:"unlink",iconName:"link",cmd:"unlink",text:"link"});d.Formatters.Bold=new a,d.Formatters.Italic=new b,d.Formatters.Link=new c,d.Formatters.Unlink=new e}(),d.BlockControl=function(){var a=function(a,b){this.type=a,this.instance_scope=b,this.block_type=d.Blocks[this.type].prototype,this.can_be_rendered=this.block_type.toolbarEnabled,this._ensureElement()};return b.extend(a.prototype,g,h,d.Events,{tagName:"a",className:"st-block-control",attributes:function(){return{"data-type":this.block_type.type}},render:function(){return this.$el.html('<span class="st-icon">'+b.result(this.block_type,"icon_name")+"</span>"+b.result(this.block_type,"title")),this}}),a}(),d.BlockControls=function(){var c=function(a,b){this.instance_scope=b,this.available_types=a||[],this._ensureElement(),this._bindFunctions(),this.initialize()};return b.extend(c.prototype,g,h,d.Events,{bound:["handleControlButtonClick"],block_controls:null,className:"st-block-controls",html:"<a class='st-icon st-icon--close'>"+i18n.t("general:close")+"</a>",initialize:function(){for(var a in this.available_types)if(d.Blocks.hasOwnProperty(a)){var b=new d.BlockControl(a,this.instance_scope);b.can_be_rendered&&this.$el.append(b.render().$el)}this.$el.delegate(".st-block-control","click",this.handleControlButtonClick)},show:function(){this.$el.addClass("st-block-controls--active"),d.EventBus.trigger("block:controls:shown")},hide:function(){this.$el.removeClass("st-block-controls--active"),d.EventBus.trigger("block:controls:hidden")},handleControlButtonClick:function(b){b.stopPropagation(),this.trigger("createBlock",a(b.currentTarget).attr("data-type"))}}),c.extend=i,c}(),d.FloatingBlockControls=function(){var c=function(a,b){this.$wrapper=a,this.instance_id=b,this._ensureElement(),this._bindFunctions(),this.initialize()};return b.extend(c.prototype,g,h,d.Events,{className:"st-block-controls__top",attributes:function(){return{"data-icon":"add"}},bound:["handleBlockMouseOut","handleBlockMouseOver","handleBlockClick","onDrop"],initialize:function(){this.$el.on("click",this.handleBlockClick).dropArea().bind("drop",this.onDrop),this.$wrapper.on("mouseover",".st-block",this.handleBlockMouseOver).on("mouseout",".st-block",this.handleBlockMouseOut).on("click",".st-block--with-plus",this.handleBlockClick)},onDrop:function(c){c.preventDefault();var e=this.$el,f=c.originalEvent.dataTransfer.getData("text/plain"),g=a("#"+f);b.isUndefined(f)||b.isEmpty(g)||e.attr("id")==f||this.instance_id!=g.attr("data-instance")||e.after(g),d.EventBus.trigger("block:reorder:dropped",f)},handleBlockMouseOver:function(b){var c=a(b.currentTarget);c.hasClass("st-block--with-plus")||c.addClass("st-block--with-plus")},handleBlockMouseOut:function(b){var c=a(b.currentTarget);c.hasClass("st-block--with-plus")&&c.removeClass("st-block--with-plus")},handleBlockClick:function(b){b.stopPropagation();var c=a(b.currentTarget);this.trigger("showBlockControls",c)}}),c.extend=i,c}(),d.FormatBar=function(){var c=function(a){this.options=b.extend({},d.DEFAULTS.formatBar,a||{}),this._ensureElement(),this._bindFunctions(),this.initialize.apply(this,arguments)};return b.extend(c.prototype,g,d.Events,h,{className:"st-format-bar",bound:["onFormatButtonClick","renderBySelection","hide"],initialize:function(){var b,c,e;this.$btns=[];for(b in d.Formatters)d.Formatters.hasOwnProperty(b)&&(c=d.Formatters[b],e=a("<button>",{"class":"st-format-btn st-format-btn--"+b+" "+(c.iconName?"st-icon":""),text:c.text,"data-type":b,"data-cmd":c.cmd}),this.$btns.push(e),e.appendTo(this.$el));this.$b=a(document),this.$el.bind("click",".st-format-btn",this.onFormatButtonClick)},hide:function(){this.$el.removeClass("st-format-bar--is-ready")},show:function(){this.$el.addClass("st-format-bar--is-ready")},remove:function(){this.$el.remove()},renderBySelection:function(){var a=window.getSelection(),b=a.getRangeAt(0),c=b.getBoundingClientRect(),d={};d.top=c.top+20+window.pageYOffset-this.$el.height()+"px",d.left=(c.left+c.right)/2-this.$el.width()/2+"px",this.highlightSelectedButtons(),this.show(),this.$el.css(d)},highlightSelectedButtons:function(){var a;b.each(this.$btns,function(b){a=d.Formatters[b.attr("data-type")],b.toggleClass("st-format-btn--is-active",a.isActive())},this)},onFormatButtonClick:function(c){c.stopPropagation();var e=a(c.target),f=d.Formatters[e.attr("data-type")];return b.isUndefined(f)?!1:(!b.isUndefined(f.onClick)&&b.isFunction(f.onClick)?f.onClick():document.execCommand(e.attr("data-cmd"),!1,f.param),this.highlightSelectedButtons(),!1)}}),c.extend=i,c}(),d.Editor=function(){var e=function(a){this.initialize(a)};return b.extend(e.prototype,g,d.Events,{bound:["onFormSubmit","showBlockControls","hideAllTheThings","hideBlockControls","onNewBlockCreated","changeBlockPosition","onBlockDragStart","onBlockDragEnd","removeBlockDragOver","onBlockDropped","createBlock"],events:{"block:reorder:down":"hideBlockControls","block:reorder:dragstart":"onBlockDragStart","block:reorder:dragend":"onBlockDragEnd","block:content:dropped":"removeBlockDragOver","block:reorder:dropped":"onBlockDropped","block:create:new":"onNewBlockCreated"},initialize:function(a){return d.log("Init SirTrevor.Editor"),this.blockTypes={},this.blockCounts={},this.blocks=[],this.errors=[],this.options=b.extend({},d.DEFAULTS,a||{}),this.ID=b.uniqueId("st-editor-"),this._ensureAndSetElements()?(!b.isUndefined(this.options.onEditorRender)&&b.isFunction(this.options.onEditorRender)&&(this.onEditorRender=this.options.onEditorRender),this._setRequired(),this._setBlocksTypes(),this._bindFunctions(),this.store("create"),this.build(),d.instances.push(this),void d.bindFormSubmit(this.$form)):!1},build:function(){this.$el.hide(),this.block_controls=new d.BlockControls(this.blockTypes,this.ID),this.fl_block_controls=new d.FloatingBlockControls(this.$wrapper,this.ID),this.formatBar=new d.FormatBar(this.options.formatBar),this.listenTo(this.block_controls,"createBlock",this.createBlock),this.listenTo(this.fl_block_controls,"showBlockControls",this.showBlockControls),this._setEvents(),d.EventBus.on(this.ID+":blocks:change_position",this.changeBlockPosition),d.EventBus.on("formatter:positon",this.formatBar.renderBySelection),d.EventBus.on("formatter:hide",this.formatBar.hide),this.$wrapper.prepend(this.fl_block_controls.render().$el),a(document.body).append(this.formatBar.render().$el),this.$outer.append(this.block_controls.render().$el),a(window).bind("click",this.hideAllTheThings);var c=this.store("read");c.data.length>0?b.each(c.data,function(a){d.log("Creating: "+a.type),this.createBlock(a.type,a.data)},this):this.options.defaultType!==!1&&this.createBlock(this.options.defaultType,{}),this.$wrapper.addClass("st-ready"),b.isUndefined(this.onEditorRender)||this.onEditorRender()},destroy:function(){this.formatBar.destroy(),this.fl_block_controls.destroy(),this.block_controls.destroy(),b.each(this.blocks,function(a){this.removeBlock(a.blockID)},this),this.stopListening();var a=this.$el.detach();d.instances=b.reject(d.instances,b.bind(function(a){return a.ID==this.ID},this)),this.store("reset"),this.$outer.replaceWith(a)},reinitialize:function(a){this.destroy(),this.initialize(a||this.options)},_setEvents:function(){b.each(this.events,function(a,b){d.EventBus.on(b,this[a],this)},this)},hideAllTheThings:function(){this.block_controls.hide(),this.formatBar.hide(),b.isUndefined(this.block_controls.current_container)||this.block_controls.current_container.removeClass("with-st-controls")},showBlockControls:function(a){b.isUndefined(this.block_controls.current_container)||this.block_controls.current_container.removeClass("with-st-controls"),this.block_controls.show(),a.append(this.block_controls.$el.detach()),a.addClass("with-st-controls"),this.block_controls.current_container=a},store:function(a,b){return d.editorStore(this,a,b||{})},createBlock:function(a,c){if(a=b.classify(a),this._blockLimitReached())return d.log("Cannot add any more blocks. Limit reached."),!1;if(!this._isBlockTypeAvailable(a))return d.log("Block type not available "+a),!1;if(!this._canAddBlockType(a))return d.log("Block Limit reached for type "+a),!1;var e=new d.Blocks[a](c,this.ID);this._renderInPosition(e.render().$el),this.listenTo(e,"removeBlock",this.removeBlock),this.blocks.push(e),this._incrementBlockTypeCount(a),e.focus(),d.EventBus.trigger(c?"block:create:existing":"block:create:new",e),d.log("Block created of type "+a),e.trigger("onRender"),this.$wrapper.toggleClass("st--block-limit-reached",this._blockLimitReached()),this.triggerBlockCountUpdate()},onNewBlockCreated:function(a){this.hideBlockControls(),this.scrollTo(a.$el)},scrollTo:function(b){a("html, body").animate({scrollTop:b.position().top},300,"linear")},blockFocus:function(){this.block_controls.current_container=null},hideBlockControls:function(){b.isUndefined(this.block_controls.current_container)||this.block_controls.current_container.removeClass("with-st-controls"),this.block_controls.hide()},removeBlockDragOver:function(){this.$outer.find(".st-drag-over").removeClass("st-drag-over")},triggerBlockCountUpdate:function(){d.EventBus.trigger(this.ID+":blocks:count_update",this.blocks.length)},changeBlockPosition:function(a,b){b-=1;var c=this.getBlockPosition(a),d=this.$wrapper.find(".st-block").eq(b),e=(this.getBlockPosition(d),c>b?"Before":"After");d&&d.attr("id")!==a.attr("id")&&(this.hideAllTheThings(),a["insert"+e](d),this.scrollTo(a))},onBlockDropped:function(a){this.hideAllTheThings();var c=this.findBlockById(a);b.isUndefined(c)||b.isEmpty(c.getData())||!c.drop_options.re_render_on_reorder||c.beforeLoadingData()},onBlockDragStart:function(){this.hideBlockControls(),this.$wrapper.addClass("st-outer--is-reordering")},onBlockDragEnd:function(){this.removeBlockDragOver(),this.$wrapper.removeClass("st-outer--is-reordering")},_renderInPosition:function(a){this.block_controls.current_container?this.block_controls.current_container.after(a):this.$wrapper.append(a)},_incrementBlockTypeCount:function(a){this.blockCounts[a]=b.isUndefined(this.blockCounts[a])?1:this.blockCounts[a]+1},_getBlockTypeCount:function(a){return b.isUndefined(this.blockCounts[a])?0:this.blockCounts[a]},_canAddBlockType:function(a){var b=this._getBlockTypeLimit(a);return!(0!==b&&this._getBlockTypeCount(a)>=b)},_blockLimitReached:function(){return 0!==this.options.blockLimit&&this.blocks.length>=this.options.blockLimit},removeBlock:function(a){var c=this.findBlockById(a),e=b.classify(c.type),f=c.$el.find(".st-block-controls");f.length&&(this.block_controls.hide(),this.$wrapper.prepend(f)),this.blockCounts[e]=this.blockCounts[e]-1,this.blocks=b.reject(this.blocks,function(a){return a.blockID==c.blockID}),this.stopListening(c),c.remove(),d.EventBus.trigger("block:remove"),this.triggerBlockCountUpdate(),this.$wrapper.toggleClass("st--block-limit-reached",this._blockLimitReached())},performValidations:function(a,c){var e=0;return!d.SKIP_VALIDATION&&c&&(a.valid()||(this.errors.push({text:b.result(a,"validationFailMsg")}),d.log("Block "+a.blockID+" failed validation"),++e)),e},saveBlockStateToStore:function(a){var c=a.saveAndReturnData();c&&!b.isEmpty(c.data)&&(d.log("Adding data for block "+a.blockID+" to block store"),this.store("add",{data:c}))},onFormSubmit:function(a){return a=a===!1?!1:!0,d.log("Handling form submission for Editor "+this.ID),this.removeErrors(),this.store("reset"),this.validateBlocks(a),this.validateBlockTypesExist(a),this.renderErrors(),this.store("save"),this.errors.length},validateBlocks:function(c){if(!this.required&&d.SKIP_VALIDATION&&!c)return!1;var e=function(d){var e=b.find(this.blocks,function(b){return b.blockID==a(d).attr("id")});return b.isUndefined(e)?!1:(this.performValidations(e,c),void this.saveBlockStateToStore(e))};b.each(this.$wrapper.find(".st-block"),e,this)},validateBlockTypesExist:function(a){if(!this.required&&d.SKIP_VALIDATION&&!a)return!1;var c=function(a){if(this._isBlockTypeAvailable(a))if(0===this._getBlockTypeCount(a))d.log("Failed validation on required block type "+a),this.errors.push({text:i18n.t("errors:type_missing",{type:a})});else{var c=b.filter(this.getBlocksByType(a),function(a){return!a.isEmpty()});if(c.length>0)return!1;this.errors.push({text:i18n.t("errors:required_type_empty",{type:a})}),d.log("A required block type "+a+" is empty")}};b.isArray(this.required)&&b.each(this.required,c,this)},renderErrors:function(){if(0===this.errors.length)return!1;b.isUndefined(this.$errors)&&(this.$errors=this._errorsContainer());var a="<ul>";b.each(this.errors,function(b){a+='<li class="st-errors__msg">'+b.text+"</li>"}),a+="</ul>",this.$errors.append(a),this.$errors.show()},_errorsContainer:function(){if(b.isUndefined(this.options.errorsContainer)){var d=a("<div>",{"class":"st-errors",html:"<p>"+i18n.t("errors:title")+" </p>"});return this.$outer.prepend(d),d}return c(this.options.errorsContainer)},removeErrors:function(){return 0===this.errors.length?!1:(this.$errors.hide().find("ul").html(""),void(this.errors=[]))},findBlockById:function(a){return b.find(this.blocks,function(b){return b.blockID==a})},getBlocksByType:function(a){return b.filter(this.blocks,function(c){return b.classify(c.type)==a})},getBlocksByIDs:function(a){return b.filter(this.blocks,function(c){return b.contains(a,c.blockID)})},getBlockPosition:function(a){return this.$wrapper.find(".st-block").index(a)},_getBlockTypeLimit:function(a){return this._isBlockTypeAvailable(a)?parseInt(b.isUndefined(this.options.blockTypeLimits[a])?0:this.options.blockTypeLimits[a],10):0},_isBlockTypeAvailable:function(a){return!b.isUndefined(this.blockTypes[a])},_ensureAndSetElements:function(){if(b.isUndefined(this.options.el)||b.isEmpty(this.options.el))return d.log("You must provide an el"),!1;this.$el=this.options.el,this.el=this.options.el[0],this.$form=this.$el.parents("form");var c=a("<div>").attr({id:this.ID,"class":"st-outer",dropzone:"copy link move"}),e=a("<div>").attr({"class":"st-blocks"});return this.$el.wrap(c).wrap(e),this.$outer=this.$form.find("#"+this.ID),this.$wrapper=this.$outer.find(".st-blocks"),!0},_setBlocksTypes:function(){this.blockTypes=b.flattern(b.isUndefined(this.options.blockTypes)?d.Blocks:this.options.blockTypes)},_setRequired:function(){this.required=b.isArray(this.options.required)&&!b.isEmpty(this.options.required)?this.options.required:!1}}),e}(),d.setDefaults=function(a){d.DEFAULTS=b.extend(d.DEFAULTS,a||{})},d.bindFormSubmit=function(a){f||(new d.Submittable(a),a.bind("submit",this.onFormSubmit),f=!0)},d.onBeforeSubmit=function(a){var c=0;return b.each(d.instances,function(b){c+=b.onFormSubmit(a)}),d.log("Total errors: "+c),c},d.onFormSubmit=function(a){var b=d.onBeforeSubmit();b>0&&(d.EventBus.trigger("onError"),a.preventDefault())},d.getInstance=function(a){return b.isUndefined(a)?this.instances[0]:b.isString(a)?b.find(this.instances,function(b){return b.ID===a}):this.instances[a]},d.setBlockOptions=function(a,c){var e=d.Blocks[a];b.isUndefined(e)||b.extend(e.prototype,c||{})},d.runOnAllInstances=function(a){b.has(d.Editor.prototype,a)?([].unshift.call(arguments,d.instances),b.invoke.apply(b,arguments)):d.log("method doesn't exist")}}(jQuery,_),define("sirtrevor",["eventable","underscore"],function(a){return function(){var b;return b||a.SirTrevor}}(this)),define("text!general.services/media-tool/media-tool.ng.html",[],function(){return'<div class="qv-st-container">\r\n	<form class="qv-st-form">\r\n		<textarea class="qv-st-instance">{{data}}</textarea>\r\n	</form>\r\n</div>'}),define("general.services/media-tool/theme",[],function(){var a=["#b0afae","#7b7a78","#545352","#4477aa","#7db8da","#b6d7ea","#46c646","#f93f17","#ffcf02","#276e27","#ffffff","#000000"],b={1:"XS",2:"S",3:"M",4:"L",5:"XL"},c={10:"1",13:"2",16:"3",22:"4",32:"5"},d={1:1,2:2,3:3,4:4,5:5,6:5},e={1:1,2:2,3:3,4:4,5:5};return{palette:a,fontSizes:b,fontSizesPx:c,htmlSizeToMarkdownSize:d,markdownSizeToHtmlSize:e}}),define("text!general.services/media-tool/toolbar.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" position="\'top\'" collision="\'collision\'" width="options.width" height="48" class="qui-immidiateContextual qv-texttool-toolbar"\r\n					  on-close-view="closeToolbar(event)" ondragstart="return false">\r\n\r\n	<div ng-if="textTool.showUsage" class="usage"><span q-translation="MediaTool.YouHaveUsed"></span> <span>{{textTool.usage}}%</span></div>\r\n\r\n	<div id="qv-toolbar-colorpicker" tid="colorpicker" q-title-translation="MediaTool.Toolbar.FontColor">\r\n		<div qv-color-picker-button on-close="closecolorpickerfoldout(event)" ng-model="color" ng-show="buttons.color" ng-disabled="!haveSelection()"></div>\r\n	</div>\r\n\r\n	<button id="qv-toolbar-fontsize" qva-activate="setActiveFoldout(\'fontSizes\',$event)" ng-show="buttons.fontSize" tid="fontSize" ng-disabled="!haveSelection()"\r\n			ng-class="{\'qui-active\':foldouts.fontSizes}" q-title-translation="MediaTool.Toolbar.FontSize" class="qui-button">\r\n		{{shortFontSize(textTool.fontSize)}}\r\n		<i class="text-size-arrow icon-triangle-bottom"></i>\r\n	</button>\r\n	<immidiate-contextual ng-if="foldouts.fontSizes" width="48" align-to="\'#qv-toolbar-fontsize\'" position="\'bottom\'" collision="\'flipfit\'" on-close-view="closeFontsizeFoldout(event)">\r\n		<ul class="qui-icontextlist qv-media-tool-fontsize">\r\n			<li ng-repeat="size in fontSizes" qva-activate="setFontSize($event, size)" ng-class="{\'active\':textTool.fontSize == size}"><span class="qui-textlist-text">{{shortFontSize(size)}}</span></li>\r\n		</ul>\r\n	</immidiate-contextual>\r\n	\r\n	<div class="qui-buttongroup" ng-show="buttonGroup1">		\r\n		<div ng-class="{\'qui-active\':textTool.states.bold}" ng-show="buttons.bold" tid="bold" ng-disabled="!haveSelection()"\r\n				q-title-translation="MediaTool.Toolbar.Bold" class="qui-button" data-icon="toolbar-bold" qva-press="exec($event,\'bold\')"></div>\r\n		<div ng-class="{\'qui-active\':textTool.states.italic}"  ng-show="buttons.italic" tid="italic" ng-disabled="!haveSelection()"\r\n				q-title-translation="MediaTool.Toolbar.Italic" class="qui-button" data-icon="toolbar-cursive" qva-press="exec($event,\'italic\')"></div>\r\n		<div ng-class="{\'qui-active\':textTool.states.underline}"  ng-show="buttons.underline" tid="underline" ng-disabled="!haveSelection()"\r\n				q-title-translation="MediaTool.Toolbar.Underline" class="qui-button" data-icon="toolbar-underline" qva-press="exec($event,\'underline\')"></div>\r\n	</div>\r\n\r\n	<div class="qui-buttongroup" ng-show="buttonGroup2">\r\n		<button ng-class="{\'qui-active\':textTool.states.justifyLeft}" ng-show="buttons.justifyLeft" tid="justifyLeft"\r\n				class="qui-button" q-title-translation="MediaTool.Toolbar.AlignLeft" data-icon="toolbar-left" qva-activate="exec($event,\'justifyLeft\')"></button>\r\n		<button ng-class="{\'qui-active\':textTool.states.justifyCenter}" ng-show="buttons.justifyCenter" tid="justifyCenter"\r\n				class="qui-button" q-title-translation="MediaTool.Toolbar.AlignCenter" data-icon="toolbar-center" qva-activate="exec($event,\'justifyCenter\')"></button>\r\n		<button ng-class="{\'qui-active\':textTool.states.justifyRight}" ng-show="buttons.justifyRight" tid="justifyRight"\r\n				class="qui-button" q-title-translation="MediaTool.Toolbar.AlignRight" data-icon="toolbar-right" qva-activate="exec($event,\'justifyRight\')"></button>\r\n	</div>\r\n\r\n	<button id="qv-toolbar-link" qva-activate="openLinkFoldout($event)" ng-show="buttons.link" tid="link"\r\n			ng-class="{\'qui-active\':foldouts.link}" class="qui-button" q-title-translation="{{ textTool.states.link ? \'MediaTool.Toolbar.EditURLLink\' : \'MediaTool.Toolbar.CreateURLLink\' }}"\r\n			ng-disabled="linkDisabled()">\r\n		<i class="icon-link" ng-class="{\'active\':textTool.states.link}"></i>\r\n		<i class="icon-triangle-bottom"></i>\r\n	</button>\r\n\r\n	<button id="qv-toolbar-image" qva-activate="openMediaLibrary($event)" ng-class="{\'qui-active\':foldouts.mediaLibrary}" ng-show="buttons.image" tid="image"\r\n			class="qui-button" q-title-translation="MediaTool.Toolbar.InsertImage" data-icon="image"></button>\r\n\r\n</immidiate-contextual>'}),define("general.services/media-tool/text-selection",[],function(){function a(){return window.getSelection()}var b={};return b.createRange=function(a,b,c){var d=document.createRange();return b=b||0,c="undefined"==typeof c?a.childNodes.length:c,d.setStart(a,b),d.setEnd(a,c),d},b.createRangeForElement=function(a){var b=document.createRange();return b.selectNode(a),b},b.addRange=function(b,c){var d=a();c&&d.removeAllRanges(),d.addRange(b)},b.getRange=function(b){var c=window.getSelection();return b=b||0,c.rangeCount>b?a().getRangeAt(b):null},b.rangeEquals=function(a,b){return null===a&&null===b?!0:null===a||null===b?!1:0===a.compareBoundaryPoints(window.Range.START_TO_START,b)&&0===a.compareBoundaryPoints(window.Range.END_TO_END,b)},b}),define("text!general.services/media-tool/link-foldout/link-foldout.ng.html",[],function(){return'<immidiate-contextual width="400" align-to="options.alignTo" position="\'bottom\'" collision="\'flipfit\'" on-close-view="closeFoldout(event)"\r\n					  class="qv-link-foldout qui-immidiateContextual" tid="link-foldout">\r\n\r\n	<div class="link-header">\r\n		<h1 class="link-header-text" ng-if="linkActive" q-translation="MediaTool.Toolbar.InsertUrlLink.Title"></h1>\r\n		<h1 class="link-header-text" ng-if="!linkActive" q-translation="Common.Bookmarks"></h1>\r\n		<div class="link-submenu" ng-if="inStorytelling()">\r\n			<ul>\r\n				<li class="qui-outlinebutton" ng-if="!linkActive" qva-activate="toggleLink(true)" q-translation="Common.URL" ></li>\r\n				<li class="qui-outlinebutton" ng-if="linkActive" qva-activate="toggleLink(false)" q-translation="Common.Bookmarks" ></li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n\r\n	<div class="link-content" ng-if="linkActive">\r\n		<span class="link-label" q-translation="MediaTool.Toolbar.InsertUrlLink.Label"></span>\r\n		<input class="link-input qui-input" maxlength="255" ng-model="link.url" style="margin-bottom: 10px" qv-enter="onEnter($event)"/>\r\n		<div class="link-remove-container" ng-if="showRemove">\r\n			<button class="link-remove qui-button" data-icon="bin" qva-activate="removeLink($event)" q-title-translation="MediaTool.Toolbar.RemoveLink"></button>\r\n		</div>\r\n	</div>\r\n	<div class="bookmark-content" ng-if="!linkActive">\r\n		<ul>\r\n			<li ng-if="bookmarks.length < 1" class="bookmark-link-row">\r\n				<span class="bookmark-link-row-content no-bookmarks" q-translation="Bookmarks.NoBookmarks"></span>\r\n			</li>\r\n			<li class="bookmark-link-row" ng-repeat="bookmark in bookmarks" ng-class="{ active: bookmark.active}">\r\n				<span class="bookmark-link-row-content" qva-activate="insertBookmark($event, bookmark.qInfo.qId)" data-bookmark-id="{{bookmark.qInfo.qId}}">{{bookmark.qData.title}}</span>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n<!--</div>-->\r\n</immidiate-contextual>'}),define("general.services/media-tool/link-foldout/link-foldout",["jquery","text!./link-foldout.ng.html","client.utils/state","client.models/bookmark"],function(a,b,c,d){var e={template:b,scope:{alignTo:"=",options:"="},controller:["$scope","$timeout","$element",function(b,e,f){function g(){!b.link.url&&b.link.bookmark?(b.toggleLink(!1),h()):b.toggleLink(!0)}function h(){d.getList().then(function(a){a.getLayout().then(function(a){b.bookmarks=a,i()})})}function i(){b.bookmarks.forEach(function(a){a.active=a.qInfo.qId===b.link.bookmark?!0:!1})}b.link=b.options.link,b.link.url||(b.link.url=""),b.link.url=decodeURIComponent(b.link.url);var j=b.link.url;b.alignTo=b.options.alignTo,b.linkActive=!0,b.closeFoldout=function(a){var c=b.link.url,d=b.link.$node;return b.closed=!0,c===j?void b.options.onCancel(a):void(c&&c.length>0&&-1===c.indexOf("javascript:")?(0!==c.search("[a-zA-Z0-9]+:")&&(c="http://"+c),b.options.onSave(a,c,d,{cmd:"createLink",formatter:"link"})):b.options.onCancel(a))},b.onEnter=function(a){b.closeFoldout(a)},b.showRemove=!!j,b.removeLink=function(a){b.options.onRemove(a,b.link.$node)},b.inStorytelling=function(){return c.state===c.States.editstory},b.insertBookmark=function(a,c){b.options.onSave(a,c,b.link.$node,{cmd:"createLink",formatter:"bookmark"})},b.toggleLink=function(c){b.linkActive=c,c&&setTimeout(function(){a(".link-input").focus()})},b.exposedApi.closing=function(){b.closed||b.closeFoldout()},b.$on("$destroy",function(){b.closed||b.closeFoldout()}),g(),b.$watch("linkActive",function(){b.linkActive&&h()}),e(function(){f.find(".link-input").focus()})}]};return e}),define("general.services/media-tool/toolbar",["jquery","touche","text!./toolbar.ng.html","general.services/media-tool/theme","general.services/media-tool/text-selection","general.services/media-tool/link-foldout/link-foldout","general.services/media-library/media-library","general.services/show-service/show-service"],function(a,b,c,d,e,f,g,h){var i=d.palette,j=d.fontSizes,k={fontSizes:!1,link:!1,mediaLibrary:!1,colorpicker:!1},l={color:!0,fontSize:!0,bold:!0,italic:!0,underline:!0,justifyLeft:!0,justifyCenter:!0,justifyRight:!0,link:!0,image:!0},m={template:c,scope:{textTool:"=",options:"=",alignTo:"="},controller:["$scope","$timeout",function(c,m){c.palette=i,c.fontSizes=Object.keys(j),c.foldouts=k,"all"===c.options.buttons?(c.buttons=l,c.buttonGroup1=!0,c.buttonGroup2=!0):"object"==typeof c.options.buttons&&(c.buttons=c.options.buttons,c.buttonGroup1=c.buttons.bold||c.buttons.italic||c.buttons.underline,c.buttonGroup2=c.buttons.justifyLeft||c.buttons.justifyCenter||c.buttons.justifyRight),c.exec=function(a,d){a.preventDefault(),a.stopPropagation(),b.preventGestures(),0===d.indexOf("justify")?c.textTool.setJustify(d):c.haveSelection()&&c.textTool.setBIU(d)},c.setActiveFoldout=function(a){Object.keys(c.foldouts).forEach(function(b){c.foldouts[b]=b===a&&c.foldouts[b]?!1:b===a})},c.shortFontSize=function(a){return j[a]||a},c.openMediaLibrary=function(){c.textTool.saveRange(),c.setActiveFoldout("mediaLibrary"),g.show({onCancel:function(){c.setActiveFoldout(),c.textTool.restoreRange(),c.textTool.focus()},onConfirm:function(a){c.setActiveFoldout(),m(function(){a?c.textTool.insertImage(a):(c.textTool.restoreRange(),c.textTool.focus())},100)},selectedFile:null})},c.closeColorpickerFoldout=function(d){a(d.target).closest("#qv-toolbar-colorpicker").length&&b.preventGestures(),c.setActiveFoldout()},c.closeFontsizeFoldout=function(d){a(d.target).closest("#qv-toolbar-fontsize").length&&b.preventGestures(),c.setActiveFoldout()};var n=null;c.openLinkFoldout=function(){var b,d=c.textTool.currentRange,g={};d&&(b=a(d.commonAncestorContainer).closest("a"),b.length&&(g.url=b.attr("href"),g.bookmark=b.attr("data-bookmark-id"),g.$node=b),c.textTool.saveRange(),n=h.show(f,{options:{toolbarScope:c,alignTo:a("#qv-toolbar-link"),link:g,onSave:function(a,b,d,e){var f;
d?(f=document.createRange(),f.setStartBefore(d[0]),f.setEndAfter(d[0]),c.textTool.insertLink(b,f,e)):c.textTool.insertLink(b,null,e),c.closeLinkFoldout(a)},onCancel:function(a){c.closeLinkFoldout(a)},onRemove:function(a,b){if(b){var d=e.createRangeForElement(b[0]);c.textTool.removeLink(d)}c.closeLinkFoldout(a)}}}),c.setActiveFoldout("link"))},c.setFontSize=function(a,b){a.preventDefault(),c.setActiveFoldout(),c.textTool.setFontSize(b)},c.closeLinkFoldout=function(d){d&&a(d.target).closest("#qv-toolbar-link").length&&b.preventGestures(),c.setActiveFoldout(),n&&(n.destroy(),n=null)},c.linkDisabled=function(){var a=c.textTool.currentRange,b=!!c.textTool.states.link;return!b&&(!a||a.collapsed)},c.haveSelection=function(){var a=c.textTool.currentRange;return!(!a||a.collapsed)},Object.defineProperty(c,"color",{get:function(){var a=10;return c.haveSelection()?d.palette.indexOf(c.textTool.color):d.palette[a]},set:function(a){c.textTool.setColor(d.palette[a])}}),c.exposedApi.closing=function(){n&&n.closing()},c.$on("$destroy",function(){c.setActiveFoldout(),n&&(n.destroy(),n=null)}),m(function(){c.textTool.refreshState()})}]};return m}),define("general.services/media-tool/command-queue",[],function(){var a=function(){this.queue=[]};return a.prototype.push=function(a){this.queue.push(a)},a.prototype.execAll=function(a){this.queue.forEach(a)},a.prototype.remove=function(a){var b,c,d=!1;for(b=this.queue.length-1;b>=0;b--)c=this.queue[b],c.cmd===a&&(d=!0,this.queue.splice(b,1));return d},a.prototype.clear=function(){this.queue=[]},a}),define("general.services/media-tool/markdown-html-parser",["util"],function(a){function b(){var b=g.formatters.map(function(b){return b.character?a.escapeRegExp(b.character):""}),c="("+b.join("|")+"){1}\\[",d="\\]\\(([^\\\\)]*(?:\\\\.[^\\\\)]*)*)\\)",e="((?![\\s\\S]*?"+c+"[\\s\\S]*?)[\\s\\S]*?)";g.markdownRegex=new RegExp(c+e+d,"mg")}function c(a,b,d){for(var e=a.exec(b),f=[];e&&!(f.indexOf(e.index)>-1);)f.push(e.index),b=d(b,e),e=a.exec(b);return f.length?c(a,b,d):b}function d(a){return a.split("").reverse().join("")}function e(){var a=g.formatters.filter(function(a){return!!a.toHTML});return a.sort(function(a,b){var c=a.toHTML.priority||0,d=b.toHTML.priority||0;return d-c}),a}function f(){var a=g.formatters.filter(function(a){return!!a.toMarkdown});return a.sort(function(a,b){var c=a.toMarkdown.priority||0,d=b.toMarkdown.priority||0;return d-c}),a}var g={};return g.register=function(a){g.formatters.push(a),b()},g.toHTML=function(a,b){var f=b||e(),h=!1;return a=a.replace(/\$\&amp;/g,"&#36;&amp;"),a=c(g.markdownRegex,a,function(a,b){return a.replace(b[0],g.getFormatter(b[1]).toHTML.callback(b[2],b[4]))}),f.forEach(function(b){b.toHTML&&b.toHTML.regex&&(b.toHTML.reverse&&(a=d(a)),a=c(b.toHTML.regex,a,function(a,c){var d=c.splice(0,1)[0];return h=!0,a.replace(d,b.toHTML.callback.apply(b.toHTML.callback,c))}),b.toHTML.reverse&&(a=d(a)))}),h?g.toHTML(a,b):a},g.toMarkdown=function(a,b){var c=b||f(),d=new Option;return d.innerHTML=a,c.forEach(function(a){a.toMarkdown.tags.forEach(function(b){var c=Array.prototype.slice.call(d.getElementsByTagName(b.name)).reverse();c.forEach(function(c){var d,e=!b.attr.length||b.attr.some(function(a){return c.hasAttribute(a)}),f=b.dontMatchAttr&&b.dontMatchAttr.some(function(a){return c.hasAttribute(a)});if(d=a.toMarkdown.regex?e&&!f&&a.toMarkdown.regex.exec(c.outerHTML.trim()):[c.outerHTML.trim()],!f&&e&&d){var g=document.createElement("span");g.innerHTML=a.toMarkdown.callback.apply(c,d.slice(1)),c.parentNode.replaceChild(g,c)}})})}),d.innerHTML.replace(/<(\/)?span>/g,"")},g.getFormatter=function(a){var b,c=g.formatters;for(b=0;b<c.length;b++)if(c[b].character===a)return c[b];return null},g.escapeMarkdown=function(a){return a.replace(/\*/g,"\\*").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\_/g,"\\_").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\~/g,"\\~").replace(/\-/g,"\\-")},g.unescapeMarkdown=function(a){return a.replace(/\\\*/g,"*").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\_/g,"_").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\~/g,"~").replace(/\\\-/g,"-")},g.reset=function(){g.formatters=[],g.markdownRegex=null},g.reset(),g}),define("general.services/media-tool/formatters/font-color",["sirtrevor","core.utils/theme","general.services/media-tool/theme","general.services/media-tool/markdown-html-parser"],function(a,b,c,d){var e=b.palette;return d.register({name:"font-color",character:"#",toHTML:{callback:function(a,b){return'<font color="'+e[b]+'">'+a+"</font>"}},toMarkdown:{regex:/^<font(?: size="([0-7]|undefined)")? color="(#[a-f0-9]{3,6})"(?: size="([0-7]|undefined)")?.*?>([\s\S]+)<\/font>$/,callback:function(a,b,d,f){if(""===f)return"";var g=a||d;return null!==g&&void 0!==g&&(g=c.htmlSizeToMarkdownSize[g],f="%["+f+"]("+g+")"),-1===e.indexOf(b)?f:"#["+f+"]("+e.indexOf(b)+")"},tags:[{name:"font",attr:["color"]}]}}),a.Formatter.extend({title:"color",cmd:"foreColor",text:"color",onClick:function(a){document.execCommand(a.cmd,!1,a.param)}})}),define("general.services/media-tool/formatters/font-size",["sirtrevor","general.services/media-tool/theme","general.services/media-tool/markdown-html-parser"],function(a,b,c){return c.register({name:"font-size",character:"%",toHTML:{callback:function(a,c){return"<font size='"+b.markdownSizeToHtmlSize[c]+"'>"+a+"</font>"}},toMarkdown:{regex:/^<font size="([0-7])".*?>([\s\S]+)<\/font>$/,callback:function(a,c){return""===c?"":(a>7&&(a=b.fontSizesPx[a]),null!==a&&void 0!==a?(a=b.htmlSizeToMarkdownSize[a],"%["+c+"]("+a+")"):c)},tags:[{name:"font",attr:["size"]}]}}),a.Formatter.extend({title:"fontsize",cmd:"fontSize",text:"fontsize"})}),define("general.services/media-tool/feature-detection",["angular","general.services/media-tool/text-selection"],function(a,b){function c(a,c){var e=document.activeElement;return document.body.appendChild(d),d.innerHTML="Feature detection.",d.focus(),b.addRange(b.createRange(d),!0),document.execCommand(a,!1,c),document.activeElement=e,document.body.removeChild(d),d.innerHTML}var d=a.element("<div contenteditable style='position:absolute;top: -999999px;'>")[0],e=c("justifyCenter").indexOf(" align=")>-1;return{usesAlign:e}}),define("general.services/media-tool/formatters/justify",["sirtrevor","qvangular","encoder","general.services/media-tool/markdown-html-parser","general.services/media-tool/feature-detection"],function(a,b,c,d,e){var f=e.usesAlign;d.register({name:"justify",character:"^",toHTML:{callback:function(a,b){return a||(a="&nbsp;"),f?'<div align="'+c.encodeForAttr2(b)+'">'+a+"</div>":'<div style="text-align: '+c.encodeForAttr2(b)+';">'+a+"</div>"}},toMarkdown:{regex:/^<(?:div|p) (?:style="text(?:\\)?-)?align(?:="|: )(left|center|right|justified)(?:"|;").*?>([\s\S]+)<\/(?:div|p)>$/,callback:function(a,b){return"^["+b+"]("+a+")"},tags:[{name:"div",attr:["align","style"]},{name:"p",attr:["align"]}]}});var g=a.Formatter.extend({title:"align left",cmd:"justifyLeft",text:"left",onClick:function(){var a=b.getService("qvMediaTool").getParagraph().el.style,c=a.direction;"ltr"!==c&&c||(c="ltr",a.direction="rtl"),document.execCommand("justifyLeft",!1),"ltr"===c&&(a.direction="ltr")}}),h=a.Formatter.extend({title:"align center",cmd:"justifyCenter",text:"center",onClick:function(){document.execCommand("justifyCenter",!1)}}),i=a.Formatter.extend({title:"align right",cmd:"justifyRight",text:"right",toMarkdown:function(a){return d.toMarkdown(a)},toHTML:function(a){return d.toHTML(a)},onClick:function(){var a=b.getService("qvMediaTool").getParagraph().el.style,c=a.direction;"rtl"===c&&(a.direction="ltr"),document.execCommand("justifyRight",!1),"rtl"===c&&(a.direction="rtl")}});return{Left:g,Right:i,Center:h}}),define("general.services/media-tool/formatters/bold",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(a,b){return b.register({name:"bold",character:"**",toHTML:{priority:5,regex:/\*\*(?!\\)([\s\S]+?(?!\*\\))\*\*/g,callback:function(a){return">b/<"+a+">b<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<(?:b|strong)>([\s\S]+)<\/(?:b|strong)>$/,callback:function(a){return""===a?"":"**"+a+"**"},tags:[{name:"b",attr:[]},{name:"strong",attr:[]}]}}),a.Formatter.extend({title:"bold",cmd:"bold",text:"B",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag(["b","strong"])||a.hasEndAncestorTag(["b","strong"]):a.hasStartAncestorTag(["b","strong"])&&a.hasEndAncestorTag(["b","strong"])},toMarkdown:function(a){return a},toHTML:function(a){return a}})}),define("general.services/media-tool/formatters/italic",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(a,b){return b.register({name:"italic",character:"_",toHTML:{priority:5,regex:/\_(?!\\)([\s\S]+?(?!\_\\))\_/g,callback:function(a){return">i/<"+a+">i<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<(?:i|em)>([\s\S]+)<\/(?:i|em)>$/,callback:function(a){return""===a?"":"_"+a+"_"},tags:[{name:"i",attr:[]},{name:"em",attr:[]}]}}),a.Formatter.extend({title:"italic",cmd:"italic",text:"I",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag(["i","em"])||a.hasEndAncestorTag(["i","em"]):a.hasStartAncestorTag(["i","em"])&&a.hasEndAncestorTag(["i","em"])},toMarkdown:function(a){return a},toHTML:function(a){return a}})}),define("general.services/media-tool/formatters/underline",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(a,b){return b.register({name:"underline",character:"~",toHTML:{priority:5,regex:/~(?!\\)([\s\S]+?(?!~\\))~/g,callback:function(a){return">u/<"+a+">u<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<u>([\s\S]+)<\/u>$/,callback:function(a){return""===a?"":"~"+a+"~"},tags:[{name:"u",attr:[]}]}}),a.Formatter.extend({title:"underline",cmd:"underline",text:"U",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag("u")||a.hasEndAncestorTag("u"):a.hasStartAncestorTag("u")&&a.hasEndAncestorTag("u")},toMarkdown:function(a){return a},toHTML:function(a){return a}})}),define("general.services/media-tool/formatters/bookmark",["jquery","qvangular","sirtrevor","encoder","general.services/media-tool/markdown-html-parser"],function(a,b,c,d,e){function f(c,d){var e=b.getService("qvMediaTool"),f=e.getRange().commonAncestorContainer,g=a(f).find("a[href="+d+"]");return"#text"===f.nodeName&&(g="A"!==c.nodeName?a(c).find("a[href="+d+"]"):a(c)),0===g.length&&(g=a(f).find("a:not([href])")),g}return e.register({name:"bookmark",character:"$",toHTML:{callback:function(a,b){return'<a href="#" class="bookmark-link" data-bookmark-id="'+d.encodeForAttr2(b)+'">'+a+"</a>"}},toMarkdown:{regex:/^<a (?=.*data\\-bookmark\\-id="([^"]+)").*?>([\s\S]+?)<\/a>$/,callback:function(a,b){return"$["+b+"]("+a+")"},tags:[{name:"a",attr:["data\\-bookmark\\-id"]}]}}),c.Formatter.extend({title:"bookmark",cmd:"createLink",text:"Bookmark",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag("a")||a.hasEndAncestorTag("a"):a.hasStartAncestorTag("a")&&a.hasEndAncestorTag("a")},onClick:function(b){var c=b.url;a(document).on("DOMNodeInserted.bookmark",function(b){var d=f(b.target,c);a.each(d,function(b,d){a(d).hasClass("bookmark-link")||(d.setAttribute("href","#"),d.removeAttribute("_moz_dirty"),d.className+="bookmark-link",d.setAttribute("data-bookmark-id",c))}),setTimeout(function(){a(document).off("DOMNodeInserted.bookmark")},250)}),document.execCommand(this.cmd,!1,c)}})}),define("general.services/media-tool/formatters/link",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(a,b){return b.register({name:"link",character:"@",toHTML:{callback:function(a,b){return 0===b.indexOf("javascript:")&&(b=""),0!==b.search("[a-zA-Z0-9]+:")&&(b="http://"+b),b=b.replace(/\\(["'])/g,"%5C$1").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\$/g,"%24"),"<a href='"+b+"' target='\\_blank'>"+a+"</a>"}},toMarkdown:{regex:/^<a href="(?!#)([^"]+)".*?>([\s\S]+?)<\/a>$/,callback:function(a,b){return"@["+b+"]("+a+")"},tags:[{name:"a",attr:["href"]}]}}),a.Formatter.extend({title:"link",cmd:"createLink",text:"Link",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag("a")||a.hasEndAncestorTag("a"):a.hasStartAncestorTag("a")&&a.hasEndAncestorTag("a")},onClick:function(a){var b=a.url;document.execCommand(this.cmd,!1,b)}})}),define("general.services/media-tool/formatters/unlink",["sirtrevor"],function(a){return a.Formatter.extend({title:"unlink",cmd:"unlink",text:"Unlink",onClick:function(a){var b=a.url;document.execCommand(this.cmd,!1,b)}})}),define("general.services/media-tool/formatters/measure",["qvangular","sirtrevor","util","lz-string","general.utils/array-util","objects.views/charts/utils/canvas-renderer","general.services/media-tool/markdown-html-parser"],function(a,b,c,d,e,f,g){function h(a,b){var c,d=a.qHyperCube.qMeasureInfo;for(c=0;c<d.length;++c)if(d[c].cId===b)return d[c];return null}function i(a,b){var c=h(a,b);return c&&c.qFallbackTitle||""}function j(a,b){var c,d,e,f=a.qHyperCube.qMeasureInfo;for(e=0;e<f.length&&f[e].cId!==b;++e);return e<f.length?(c=f.filter(function(a,b){return!a.qError&&e>=b}).length-1,d=a.qHyperCube.qGrandTotalRow[c],d&&d.qText||null):null}function k(a){var b,c=30,d=f.getDevicePixelToBackingStoreRatio(),e=150,g=.35,h="13px 'QlikView Sans'",i=l.getContext("2d"),j=f.measureTextObject({shape:{text:a,width:112,font:h}});b=Math.ceil(Math.min(j.width+50,e)),l.height=c*d,l.width=b*d,l.style.height=c+"px",l.style.width=b+"px",i.clearRect(0,0,l.width,l.height),i.save(),i.scale(d,d),i.font="24px 'QlikView Icons'",i.globalAlpha=g,i.fillText("3",2,c/2+8),i.globalAlpha=1,i.font="13px 'QlikView Sans'",i.fillText(j.lines[0],32,c/2+5),i.restore();var k=l.toDataURL("image/png"),m=document.createElement("img");return m.setAttribute("src",k),m.setAttribute("class","tokenized-measure"),m.setAttribute("width",b+"px"),m.setAttribute("height",c+"px"),m}var l=document.createElement("canvas");return g.register({name:"measure",character:"=",toHTML:{callback:function(b,c){var e,f,g=a.getService("qvMediaTool");if(g.isActive()){var h,l,m=g.getOptions();if(!m.useMeasures)return"";if(h=m.propertyHandler.getMeasure(c),l=i(m.layout,c),!l&&(l=m.copiedMeasures[c],!l))return"";var n=JSON.stringify(h);f=k(l),f.setAttribute("data-measure-id",c),f.setAttribute("data-measure-name",d.compressToBase64(l)),f.setAttribute("data-measure",d.compressToBase64(n)),f.setAttribute("data-tid","ti-measure")}else{e=g.getCurrentLayout();var o=j(e,c);if(null===o)return"";f=document.createElement("span"),f.setAttribute("data-tid","ti-measure"),f.appendChild(document.createTextNode(o))}return f.outerHTML}},toMarkdown:{callback:function(){var b="",f=this.getAttribute("data\\-measure\\-id"),g=a.getService("qvMediaTool").getOptions();if(!h(g.layout,f)&&!g.copiedMeasures[f]){var i=d.decompressFromBase64(this.getAttribute("data\\-measure")),j=JSON.parse(i);f=c.generateId(),j.qDef.cId=f;var k=g.properties;k.qHyperCubeDef.qMeasures.push(j),e.indexAdded(k.qHyperCubeDef.qInterColumnSortOrder,k.qHyperCubeDef.qDimensions.length+k.qHyperCubeDef.qMeasures.length-1);var l=d.decompressFromBase64(this.getAttribute("data\\-measure\\-name"));g.copiedMeasures[f]=l}return"=["+b+"]("+f+")"},tags:[{name:"img",attr:["data\\-measure\\-id"]}]}}),b.Formatter.extend({title:"measure",cmd:"",text:"measure",toMarkdown:function(a){return a},toHTML:function(a){return a}})}),define("general.services/media-tool/formatters/image",["sirtrevor","general.services/media-tool/markdown-html-parser","general.models/media-library"],function(a,b,c){return b.register({name:"image",character:"!",toHTML:{callback:function(a,b){return b=c.stripBasePath(b),b=b.replace(/\\(["'])/g,"%5C$1").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\$/g,"%24"),"<img src='"+c.addBasePath(b)+"'>"}},toMarkdown:{regex:/^<img.*?src="([^"]+)".*?>$/,callback:function(a){return a=b.unescapeMarkdown(a),a=c.stripBasePath(a),a=b.escapeMarkdown(a),"![image]("+a+")"},tags:[{name:"img",attr:["src"],dontMatchAttr:["data\\-measure\\-id"]}]}}),a.Formatter.extend({title:"image",cmd:"insertImage",text:"image",onClick:function(a){document.execCommand(a.cmd,!1,a.param)}})}),define("general.services/media-tool/formatters/paste",["general.services/media-tool/markdown-html-parser","util"],function(a,b){var c=/color: rgb\\\((\d{1,3}), (\d{1,3}), (\d{1,3})/i,d=/font\\\-size: (\d+)px/i,e=/text\\\-decoration: underline/i,f=/font\\\-weight: bold/i;a.register({name:"paste",character:"`",toMarkdown:{regex:/^<(span|font|i|b|u) style="(.+?)">(.+?)<\/(?:span|font|i|b|u)>$/,callback:function(g,h,i){var j;return c.test(h)&&(h=h.replace(/rgb\\\(/g,"rgb(").replace(/\\\);/g,");"),i=a.getFormatter("#").toMarkdown.callback(null,b.normalizeToHex(h),null,i)),j=d.exec(h),j&&(i=a.getFormatter("%").toMarkdown.callback(j[1],i)),j=e.exec(h),j&&(i=a.getFormatter("~").toMarkdown.callback(i)),j=f.exec(h),j&&(i=a.getFormatter("**").toMarkdown.callback(i)),this.innerHTML=i,this.removeAttribute("style"),a.toMarkdown(this.outerHTML.trim())},tags:[{name:"span",attr:["style"]},{name:"font",attr:["style"]},{name:"b",attr:["style"]},{name:"i",attr:["style"]},{name:"u",attr:["style"]}]}}),a.register({name:"word",character:"``",toMarkdown:{regex:/^.+$/i,callback:function(){return" "},tags:[{name:"style",attr:[]},{name:"w:WordDocument",attr:[]}]}})}),define("general.services/media-tool/sir-trevor-extensions",["jquery","sirtrevor","underscore","general.services/media-tool/text-selection","general.services/media-tool/formatters/font-color","general.services/media-tool/formatters/font-size","general.services/media-tool/formatters/justify","general.services/media-tool/formatters/bold","general.services/media-tool/formatters/italic","general.services/media-tool/formatters/underline","general.services/media-tool/formatters/bookmark","general.services/media-tool/formatters/link","general.services/media-tool/formatters/unlink","general.services/media-tool/formatters/measure","general.services/media-tool/formatters/image","general.utils/string-limits","general.services/media-tool/formatters/paste"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a){for(var b=[],c=0;c<a.childNodes.length;c++)3===a.childNodes[c].nodeType?b.push(a.childNodes[c]):b.push.apply(b,q(a.childNodes[c]));return b}function r(){var a=this,b=a.textContent.length-p.textImage;if(b>0){var c=d.getRange(),e=c.commonAncestorContainer;if(3===e.nodeType){var f=q(document.activeElement),g=f.indexOf(e);f=f.splice(0,g+1),f.reverse().forEach(function(a){return 0>=b?!1:(a.nodeValue.length>b?(a.splitText(a.nodeValue.length-b),a.parentNode.removeChild(a.nextSibling),d.addRange(c,!0)):a.parentNode.removeChild(a),void(b-=a.nodeValue.length))})}}}delete b.Formatters.Bold,delete b.Formatters.Italic,delete b.Formatters.Link,delete b.Formatters.Unlink,b.Formatters.bold=new h,b.Formatters.italic=new i,b.Formatters.underline=new j,b.Formatters.justifyLeft=new g.Left,b.Formatters.justifyCenter=new g.Center,b.Formatters.justifyRight=new g.Right,b.Formatters.fontSize=new f,b.Formatters.foreColor=new e,b.Formatters.bookmark=new k,b.Formatters.link=new l,b.Formatters.unlink=new m,b.Formatters.measure=new n,b.Formatters.insertImage=new o,b.Blocks.Paragraph=function(){return b.Block.extend({type:"paragraph",className:"st-block",icon_name:"paragraph",editorHTML:'<div class="st-required st-text-block" contenteditable="true" autocomplete="off" autocorrect="off"></div>',attributes:function(){return c.extend(b.SimpleBlock.fn.attributes.call(this),{})},title:function(){return"Paragraph"},loadData:function(a){this.getTextBlock().html(b.toHTML(a.text,this.type))},focus:function(){var a=this.getTextBlock();a.focus()},_initTextBlocks:function(){var a=this.getTextBlock();a.bind("input",r).bind("paste",this._handleContentPaste).bind("keyup",this.getSelectionForFormatter).bind("mouseup",this.getSelectionForFormatter)},_initUIComponents:function(){this.onFocus(),this.onBlur()},_blockPrepare:function(){this._initUI(),this._initMessages(),this.checkAndLoadData(),this.$el.addClass("st-item-ready")},toData:function(){b.log("toData for "+this.blockID);var c=this.getTextBlock();c.find("div,p").each(function(){var b=a(this);b.is("[align],[style]")||b.attr("align","left")});var d=c.html();this.setData({text:b.toMarkdown(d,this.type)})}})}(),b.FloatingBlockControls=function(){return b.FloatingBlockControls.extend({className:"",bound:[],initialize:function(){},attributes:function(){}})}(),b.BlockControls=function(){return b.FloatingBlockControls.extend({className:"",bound:[],html:"",initialize:function(){},hide:function(){},show:function(){},handleControlButtonClick:function(){}})}(),b.FormatBar=function(){return b.FormatBar.extend({className:"",initialize:function(){}})}()}),define("general.services/media-tool/media-tool",["jquery","underscore","util","general.utils/dom-util","qvangular","sirtrevor","text!./media-tool.ng.html","general.services/media-tool/theme","general.services/media-tool/toolbar","general.services/media-tool/command-queue","general.services/media-tool/text-selection","general.utils/string-limits","general.models/media-library","general.services/show-service/show-service","general.utils/support","./sir-trevor-extensions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p,q=e.getService("$sce"),r={bold:!1,italic:!1,underline:!1,justifyLeft:!1,justifyCenter:!1,justifyRight:!1,link:!1,fontSize:!1};return p={controller:["$scope","$element","$timeout",function(g,p,s){function t(){u(),y=n.show(i,{textTool:g,options:g.options.toolbar||{},alignTo:g.options.alignTo||p})}function u(){y&&(g.editor.formatBar.$el.remove(),y.destroy(),y=null)}function v(){function a(a){return g.getEditorElement()===a}function b(a,c){return Array.isArray(a)?a.some(function(a){return b(a,c)}):c.some(function(b){return b.nodeName.toLowerCase()===a})}var c=d.getAncestorsUntil(g.currentRange.startContainer,a),e=d.getAncestorsUntil(g.currentRange.endContainer,a);return{rangeCollapsed:g.currentRange.collapsed,hasStartAncestorTag:function(a){return b(a,c)},hasEndAncestorTag:function(a){return b(a,e)}}}function w(b){function c(a){g.saveRange(),g.cmdQueue.clear(),a&&g.refreshState()}var e=!o.treatAsDesktop();a("body").on("mouseup.texttool",function(b){var f=a(b.target);f.closest(".qv-texttool-toolbar, .qui-immidiateContextual, .qv-modal-container-centered").length?d.isInput(document.activeElement)||(g.focus(),g.restoreRange()):e||document.activeElement===g.getEditorElement()[0]&&s(function(){c(!0),g.$apply()})}),e&&a(document).on("selectionchange.texttool",function(){if(document.activeElement===g.getEditorElement()[0]){var a=k.getRange();a&&!k.rangeEquals(a,g.currentRange)&&c(!0)}}),b.on("qv-activate","img",function(a){var b=k.createRangeForElement(a.target);g.focus(),k.addRange(b,!0),g.saveRange(),g.refreshState()}),b.on("scroll",function(){g.saveScroll()}),b.on("keydown input",function(a){13!==a.which&&(g.cmdQueue.execAll(function(a){g.execCustom(a)}),g.cmdQueue.clear()),s(function(){g.$apply()})}),e||b.on("keyup",function(){c(!0)})}var x=q.getTrustedHtml(f.toHTML(g.options.markdown));g.data={data:[{type:"paragraph",data:{text:f.toMarkdown(x)}}]},g.states=r,g.cmdQueue=new j;var y;this.scope=function(){return g},this.closing=function(){y&&(y.closing(),y.destroy())},g.getParagraph=function(){return g.editor.blocks[0]},g.getEditorElement=function(){return g.getParagraph().getTextBlock()},g.destroy=function(){u(),g.destroyComponent()},g.calculateUsage=function(){var a=g.getEditorElement()[0];g.usage=Math.min(100,(a.textContent.length/l.textImage*100).toFixed(0)),g.showUsage=g.usage>=90},g.refreshState=function(){g.currentRange&&e.$apply(g,function(){g.calculateUsage();var a=v();Object.keys(g.states).forEach(function(b){g.states[b]=f.Formatters[b].isActive(a)});var b;g.currentRange&&(b=document.queryCommandValue("foreColor"),"undefined"!=typeof b&&(b=c.normalizeToHex(b))),g.color=b||"#545352";var e,i;g.currentRange&&(i=d.getParentElementWithAttribute(g.currentRange.endContainer,"font","size"),i&&(e=i.getAttribute("size"),e=h.htmlSizeToMarkdownSize[e],e=h.markdownSizeToHtmlSize[e]),"undefined"===e&&(e=null)),g.fontSize=e||3})},g.saveRange=function(){var a=k.getRange();g.currentRange=a?a.cloneRange():null},g.restoreRange=function(){if(g.currentRange){var a=k.getRange();a?a&&(k.rangeEquals(a,g.currentRange)||k.addRange(g.currentRange,!0)):k.addRange(g.currentRange,!0)}},g.saveScroll=function(){g.currentScrollTop=g.getEditorElement()[0].scrollTop},g.restoreScroll=function(){g.currentScrollTop&&(g.getEditorElement()[0].scrollTop=g.currentScrollTop)},g.setJustify=function(a){g.focus(),g.restoreScroll(),g.restoreRange(),g.execCustom({cmd:a}),g.saveRange(),g.refreshState()},g.setBIU=function(a){if(g.focus(),g.restoreScroll(),g.restoreRange(),g.states[a]=!g.states[a],g.currentRange.collapsed){var b=g.cmdQueue.remove(a);b||g.cmdQueue.push({cmd:a})}else g.execCustom({cmd:a});g.saveRange()},g.setFontSize=function(a){g.focus(),g.restoreScroll(),g.restoreRange(),g.currentRange.collapsed?(g.cmdQueue.remove("fontSize"),g.cmdQueue.push({param:a,cmd:"fontSize"})):g.execCustom({param:a,cmd:"fontSize"}),g.saveRange(),g.fontSize=a},g.setColor=function(a){g.focus(),g.restoreScroll(),g.restoreRange(),g.currentRange.collapsed?(g.cmdQueue.remove("foreColor"),g.cmdQueue.push({param:a,cmd:"foreColor"})):g.execCustom({param:a,cmd:"foreColor"}),g.saveRange(),g.color=a},g.insertImage=function(a){var b=m.addBasePath(a);g.focus(),g.restoreRange(),g.execCustom({param:b,cmd:"insertImage"}),g.saveRange(),g.focus()},g.insertLink=function(a,b,c){b?k.addRange(b,!0):g.restoreRange(),g.focus(),g.execCustom({url:a,cmd:c.cmd,formatter:c.formatter}),g.saveRange(),g.refreshState()},g.removeLink=function(a){k.addRange(a,!0),g.execCustom({cmd:"unlink",range:a}),g.saveRange(),g.refreshState(),g.focus()},g.execCustom=function(a){var c=f.Formatters[a.formatter||a.cmd];b.isUndefined(c)||(!b.isUndefined(c.onClick)&&b.isFunction(c.onClick)?c.onClick(a):document.execCommand(a.cmd,!1,a.param))},g.focus=function(){g.getEditorElement().focus()},s(function(){g.editor=new f.Editor({el:p.find("textarea"),defaultType:"paragraph",onEditorRender:function(){var a=p.find(".st-text-block");w(a),"function"==typeof g.options.onOpen&&g.options.onOpen(g),g.options.toolbar&&t(),s(function(){g.refreshState()})}})}),g.$on("$destroy",function(){u(),a("body").off(".texttool"),a(document).off(".texttool")})}],template:g}}),define("general.services/media-tool/media-tool-service",["qvangular","sirtrevor","general.services/media-tool/media-tool"],function(a,b,c){var d=a.getService("$sce"),e=a.service("qvMediaTool",[function(){var a,e,f,g={};return g.show=function(b,d){f=d,a=b.showComponent(c,{options:d})},g.hide=function(){a&&(a.scope().destroy(),a=null,f=null)},g.closing=function(){a&&a.closing()},g.isActive=function(){return f&&"function"==typeof f.isActive?f.isActive():!!a},g.getCurrentLayout=function(){return e},g.getOptions=function(){return f},g.getMarkdown=function(){var b,c=a.scope().getParagraph();return c&&(b=c.saveAndGetData())?b.text:null},g.hasContent=function(a){return a&&"^[\n](left)"!==a},g.getParagraph=function(){return a.scope().getParagraph()},g.getEditorElement=function(){return a.scope().getEditorElement()},g.getRange=function(){return a.scope().currentRange},g.toHTML=function(a,c){if(e=c,a){var f=b.toHTML(a);return a=b.toMarkdown(f),d.getTrustedHtml(b.toHTML(a))}return""},g.toMarkdown=function(a){return a?b.toMarkdown(a):""},g}]);return e}),define("extensions.qliktech/text-image/measure-utils",["general.utils/array-util","util"],function(a,b){function c(a,b){var c,d,e,f=[],g=[];for(c=a.map(function(a){return a.qDef.cId}),d=b.map(function(a){return a.qDef.cId}),e=d.length-1;e>=0;--e)c.contains(d[e])||f.push({index:e,id:d[e],measure:b[e]});for(e=0;e<c.length;++e)d.contains(c[e])?c.lastIndexOf(c[e])!==e&&g.push({index:e,id:c[e],measure:a[e]}):g.push({index:e,id:c[e],measure:a[e]});return{removed:f,added:g}}function d(a,b){return b.replace(/=\[(\w*?)]\((\w*?)\)/g,function(b,c,d){return a===d?"":b})}function e(a,b,c,d){var e=-1;return c.replace(/=\[(\w*?)]\((\w*?)\)/g,function(c,f,g){if(g===a){++e;var h="undefined"!=typeof d;if(!h||h&&e===d)return"=["+f+"]("+b+")"}return c})}function f(d,f){var g=f.qHyperCubeDef.qMeasures,h=c(d,g);h.removed.forEach(function(b){var c=b.index;g.splice(c,1),a.indexRemoved(f.qHyperCubeDef.qInterColumnSortOrder,f.qHyperCubeDef.qDimensions.length+c)}),h.added.forEach(function(c){var d=c.measure.qDef.cId,h=b.generateId();c.measure.qDef.cId=h,g.push(c.measure),a.indexAdded(f.qHyperCubeDef.qInterColumnSortOrder,f.qHyperCubeDef.qDimensions.length+g.length-1),f.markdown=e(d,h,f.markdown,1)})}return{removeMeasure:d,replaceMeasure:e,syncMeasures:f}}),define("extensions.qliktech/text-image/text-image",["jquery","qvangular","lz-string","text!./text-image.ng.html","./text-image-properties","objects.backend-api/hypercube-api","client.utils/state","client.services/grid-service","general.services/media-tool/media-tool-service","general.utils/string-limits","./measure-utils","general.models/media-library","core.utils/resize"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,c){if("none"===a.responsive||"undefined"==typeof a.responsive)a.sizeClass="",a.visibilityClass="",a.responsiveClass="";else{a.sizeClass="",a.visibilityClass="hidden",a.responsiveClass="images"===a.responsive?"responsive-images":"text"===a.responsive?"responsive-text":"responsive-images responsive-text";var d=b.getService("$timeout"),e=c.find(".qv-media-tool-html")[0];if(!e)return void(a.visibilityClass="");d(function(){var b=e.scrollHeight/e.clientHeight;a.sizeClass=b>3?"bp-4":b>2?"bp-3":b>1.5?"bp-2":b>1?"bp-1":"",a.visibilityClass=""},10)}}function o(a){return!i.hasContent(a)||""===a.trim()}var p,q,r=b.getService("$sce");return p={auto:"auto auto",alwaysFit:"contain",fitWidth:"100% auto",fitHeight:"auto 100%",fill:"100% 100%"},q={topLeft:"0% 0%",centerLeft:"50% 0%",bottomLeft:"100% 0%",topCenter:"0% 50%",centerCenter:"50% 50%",bottomCenter:"100% 50%",topRight:"0% 100%",centerRight:"50% 100%",bottomRight:"100% 100%"},b.directive("qvTextImageEditor",[function(){return{restrict:"A",scope:{editorOptions:"=",save:"="},link:function(b,c){i.show(c,b.editorOptions),c.on("qv-outside",function(c){var d=a(c.target);d.closest(".qv-texttool-toolbar, .modal-container, .qui-immidiateContextual").length||b.save()}),b.$on("$destroy",function(){b.save(),i.hide()})}}}]),{type:"text-image",BackendApi:f,definition:e,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[]},markdown:"",background:{url:"",size:"auto"}},data:{measures:{min:0,max:1e3,add:function(a,b){b.markdown+="=[]("+a.qDef.cId+")"},remove:function(a,b){b.markdown=k.removeMeasure(a.qDef.cId,b.markdown)},replace:function(a,b,c,d){d.markdown=k.replaceMeasure(b.qDef.cId,a.qDef.cId,d.markdown)}}},snapshot:{canTakeSnapshot:function(a){return!o(a.layout.markdown)}},exportProperties:null,importProperties:null,template:d,showRequirements:function(){return!1},getDropMeasureOptions:function(a,b,c,d){b.getMeasures().length<b.maxMeasures()?"expression"===a.item.type?b.addExpressionMeasure(a.item.name,"").then(function(){c.save()}):b.addLibraryMeasure(a.item.id).then(function(){c.save()}):(a.ReplaceMeasures(c,b),d())},controller:["$scope",function(d){function e(a){var b=[];return a.find(".tokenized-measure").each(function(a,d){var e=d.getAttribute("data-measure");e=c.decompressFromBase64(e),b.push(JSON.parse(e))}),b}function f(){b.$apply(d,function(){d.editing=!1})}d.$watch(h.getActiveCell,function(a){d.selected=a&&a.id===d.backendApi.model.id}),d.$watch("editing",function(a){d.object.preventDrag=a}),d.edit=function(){!g.isInEditMode()||d.editing||d.object.isLink||d.selected&&(d.saving=!1,d.saved=!1,d.backendApi.getProperties().then(function(a){var b=d.ext.getCreatePropertyHandler();b.setProperties(a),d.editorOptions={markdown:a.markdown,maxlength:j.textImage,toolbar:{buttons:"all",width:564},useMeasures:!0,layout:d.backendApi.model.layout,properties:a,propertyHandler:b,copiedMeasures:[],onOpen:function(a){a.saveRange(),d.$apply(function(){d.editing=!0,d.initializing=!1})},isActive:function(){return d.editing||d.initializing
}},d.initializing=!0}))},d.save=function(){if(!d.saving&&!d.saved){i.closing();var a=i.getMarkdown(),b=i.getEditorElement(),c=e(b);if(null!==a&&a!==d.markdown){d.saving=!0;var f=i.getOptions().properties;f.markdown=a,k.syncMeasures(c,f),d.backendApi.model.save(),d.saved=!0}else d.editing=!1}},d.clickHtml=function(b){var c=g.isInEditMode()||g.state===g.States.snapshot;c&&a(b.target).closest("a").length&&b.preventDefault()},m.on("start",f),d.$on("$destroy",function(){m.off("start",f)})}],view:{paint:function(a,b){function c(){return b.background&&!!b.background.isUsed&&!!b.background.url}var d=this.$scope,e="",f="",g="",h="";d.saving&&(d.editing=!1,d.saving=!1),b.background&&b.background.isUsed&&b.background.url&&(e=b.background.url,l.stripBasePath(e),e=e.replace(/"/g,'\\"'),e=e.replace(/'/g,"\\'"),f="url('"+l.addBasePath(e)+"')",g=p[b.background.size]||p.auto,h=q[b.background.position]||q.topLeft),this.$element.css({backgroundImage:f,backgroundSize:g,backgroundPosition:h,backgroundRepeat:"no-repeat"}),d.empty=o(b.markdown)&&!c(),d.html=r.trustAsHtml(i.toHTML(b.markdown,b)),d.markdown=b.markdown,d.responsive=b.responsive,n(d,this.$element)},resize:function(){this.paint.apply(this,arguments)},onStateChanged:function(){this.$scope.editmode=g.isInEditMode(),this.$scope.editmode||(this.$scope.editing=!1)}},getDropFieldOptions:function(a,b,c,d,e){a.AddFieldAsMeasure(c,b,e),d()},getDropDimensionOptions:function(a,b,c,d){d()}}}),define("objects.backend-api/map-api",["./backend-api","core.models/app"],function(a,b){var c;return c=a.extend("MapApi",{init:function(a){this._super(a)},select:function(a,b,c,d){return b?this.model.rpc(a,null,[b,c,d]):void 0},select2:function(a,b,c,d){return b?this.model.rpc(a,null,[b,c,d]):void 0},selectRange:function(a,b,c){if(!(this.path.indexOf("qHyperCubeDef")<0)){var d,e=this.path.replace("/geodata","");return b=!!b,c=c||[0],d=a.map(function(a){return{qMeasureIx:a.measure,qRange:{qMin:a.range.min,qMax:a.range.max,qMinInclEq:a.range.minInclEq!==!1,qMaxInclEq:a.range.maxInclEq!==!1}}}),this.model.rpc("RangeSelectHyperCubeValues",null,[e,d,c,b])}},updateCache:function(){},setInitialData:function(){},getData:function(a,b,c){return this.model.rpc(a,null,[b,c])},evaluateExpression:function(a){return b.current.evaluateExpression(a)},getSize:function(){var a=this.model.layout,b=a.qListObject?a.qListObject:a.layers[0].qListObject;return b.qSize},isLocked:function(){var a=this.model.layout,b=a.qListObject?a.qListObject:a.layers[0].qListObject;return b&&b.qDimensionInfo.qLocked?!0:!1},getDimensionInfos:function(){var a=this.model.layout,b=a.qListObject?a.qListObject:a.layers[0].qListObject;return[b.qDimensionInfo]},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},beginSelections:function(){var a,c,d,e=this.model,f=[];for(a=0;a<e.layout.layers.length;++a)if(c="/layers/"+a+"/","polygon"===e.layout.layers[a].type&&"3"===e.layout.layers[a].version)d=c+"geodata/",c+="qHyperCubeDef",d+="qHyperCubeDef",f.push(c),f.push(d);else{if(e.layout.layers[a].qHyperCube)c+="qHyperCubeDef";else{if(!e.layout.layers[a].qListObject)continue;c+="qListObjectDef"}f.push(c)}return b.current.switchModal(e,f)}})}),define("text!extensions.qliktech/map/map.ng.html",[],function(){return'	<div qv-extension\r\n        class="qv-viz">\r\n	</div>\r\n<div qva-scatter-navigation>\r\n	</div>\r\n<div qva-chart-disclaimer options="dataAttributes" visible="true"></div>'}),define("extensions.qliktech/map/map-properties",["general.utils/property-resolver","general.services/media-tool/media-tool-service","translator","core.utils/help-url"],function(a,b,c,d){function e(a){if(!a||a.qLibraryId)return!1;var b=a.qDef.qFieldDefs[0];return b&&b.length&&"="===b[0]}function f(b){var c=a.getValue(b,"color.auto"),d=a.getValue(b,"color.mode"),e=a.getValue(b,"color.expressionIsColor");return c||"primary"===d||"byExpression"===d&&(e||void 0===e)}function g(b){return"byExpression"===a.getValue(b,"color.mode")&&a.getValue(b,"color.expressionIsColor")===!0}var h=1,i=[{value:"primary",translation:"properties.colorMode.primary"},{value:"byDimension",translation:"properties.colorMode.byDimension"}],j=i.concat({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),k=j.concat({value:"byExpression",translation:"properties.colorMode.byExpression"}),l={ref:"layers",type:"array",translation:"Common.Data",addTranslation:"properties.layers.add",component:"layers",allowMove:!0,max:h,items:{polygonLayer:{type:"items",component:"expandable-items",grouped:!0,items:{dimensions:{type:"items",items:{field:{ref:"qListObjectDef.qDef.qFieldDefs.0",type:"string",translation:"Common.Field",component:"expression",expressionType:"dimension",show:function(a){var b=a.qListObjectDef;return b&&!b.qLibraryId},readOnly:!0},libraryDimension:{ref:"qListObjectDef.qLibraryId",type:"string",translation:"Common.Dimension",component:"library-item",libraryItemType:"dimension",show:function(a){var b=a.qListObjectDef;return b&&b.qLibraryId}},geodata:{ref:"qListObjectDef.qExpressions.1.qExpr",type:"string",translation:"properties.layers.regionData",component:"expression",expressionType:"measure",show:function(a){return a&&e(a.qListObjectDef)}}}},measure:{type:"items",items:{expression:{ref:"qListObjectDef.qExpressions.0.qExpr",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(b,c,d,e){var f=b.qListObjectDef.qExpressions[0].qExpr;if(f=f.trim(),""===f)"byMeasure"===a.getValue(d,"color.mode")&&(a.setValue(d,"color.mode","primary"),a.getValue(d,"color.auto")===!1&&a.setValue(d,"color.auto",!0));else{var g=d.layers.indexOf(b),h=e.layout.layers[g],i=h.qListObject.qExpressions&&h.qListObject.qExpressions[0]?h.qListObject.qExpressions[0].qExpr:"";i=void 0!==i?i.trim():"",d.color.auto&&"primary"===d.color.mode&&""===i&&(d.color.auto=!1,d.color.mode="byMeasure")}},show:function(b){return!a.getValue(b,"qListObjectDef.qExpressions.0.qLibraryId")}},libraryMeasure:{ref:"qListObjectDef.qExpressions.0.qLibraryId",type:"string",translation:"Common.Measure",component:"library-item",libraryItemType:"measure",show:function(b){return a.getValue(b,"qListObjectDef.qExpressions.0.qLibraryId")}},label:{ref:"qListObjectDef.qExpressions.0.qLabel",type:"string",translation:"Common.Label",show:function(b){return!a.getValue(b,"qListObjectDef.qExpressions.0.qLibraryId")}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{ref:"show",type:"boolean",translation:"Common.Show",defaultValue:!0,show:function(b,c,d){return a.getValue(d.properties,"background.show",!1)}}}}}},polygon2Layer:{type:"items",component:"expandable-items",sourceType:"polygon2Layer",grouped:!0,items:{dimensions:{type:"items",items:{field:{type:"string",component:"expression",expressionType:"dimension",ref:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",translation:"Common.Field",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return!b||!b.qLibraryId},readOnly:!0},libraryDimension:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qHyperCubeDef.qDimensions.0.qLibraryId",translation:"Common.Dimension",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return b&&b.qLibraryId}},geodata:{ref:"qHyperCubeDef.qMeasures.1.qDef.qDef",type:"string",translation:"properties.layers.regionData",component:"expression",expressionType:"measure",show:function(a){return a&&a.qHyperCubeDef&&a.qHyperCubeDef.qDimensions&&e(a.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0}}},measure:{type:"items",items:{expression:{ref:"qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(b,c,d){var e=b.qHyperCubeDef.qMeasures[0],f=d.layers.indexOf(b);if(e&&""===e.qDef.qDef)("byMeasure"===a.getValue(d,"color.mode")||"byExpression"===a.getValue(d,"color.mode"))&&(a.setValue(d,"color.mode","primary"),a.getValue(d,"color.auto")===!1&&a.setValue(d,"color.auto",!0));else{e.qSortBy={qSortByLoadOrder:1};var g=d.layers[f].measureDef;g=void 0!==g?g.trim():"",d.color.auto&&"primary"===d.color.mode&&""===g&&(d.color.auto=!1,d.color.mode="byMeasure")}d.layers[f].measureDef=b.qHyperCubeDef.qMeasures[0].qDef.qDef},show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},libraryMeasure:{type:"string",component:"library-item",libraryItemType:"measure",ref:"qHyperCubeDef.qMeasures.0.qLibraryId",translation:"Common.Measure",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&b.qLibraryId}},label:{ref:"qHyperCubeDef.qMeasures.0.qDef.qLabel",type:"string",translation:"Common.Label",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{type:"boolean",ref:"show",translation:"Common.Show",show:function(b,c,d){return a.getValue(d.properties,"background.show",!1)}}}}}},polygon3Layer:{type:"items",component:"expandable-items",sourceType:"polygon3Layer",grouped:!0,items:{dimensions:{type:"items",items:{field:{type:"string",component:"expression",expressionType:"dimension",ref:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",translation:"Common.Field",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return!b||!b.qLibraryId},readOnly:!0},libraryDimension:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qHyperCubeDef.qDimensions.0.qLibraryId",translation:"Common.Dimension",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return b&&b.qLibraryId}},geodata:{ref:"geodata.qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"properties.layers.regionData",expression:"always",show:function(a){return a&&a.qHyperCubeDef&&a.qHyperCubeDef.qDimensions&&e(a.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"geodata.qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0,change:function(b){var c=a.getValue(b,"geodata.qHyperCubeDef.qDimensions.0.qNullSuppression");a.setValue(b,"qHyperCubeDef.qDimensions.0.qNullSuppression",c)}}}},measure:{type:"items",items:{expression:{ref:"qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"Common.Expression",expression:"always",change:function(b,c,d){var e=b.qHyperCubeDef.qMeasures[0],f=d.layers.indexOf(b);if(e&&""===e.qDef.qDef)("byMeasure"===a.getValue(d,"color.mode")||"byExpression"===a.getValue(d,"color.mode"))&&(a.setValue(d,"color.mode","primary"),a.getValue(d,"color.auto")===!1&&a.setValue(d,"color.auto",!0));else{e.qSortBy={qSortByLoadOrder:1};var g=d.layers[f].measureDef;g=void 0!==g?g.trim():"",d.color.auto&&"primary"===d.color.mode&&""===g&&(d.color.auto=!1,d.color.mode="byMeasure")}d.layers[f].measureDef=b.qHyperCubeDef.qMeasures[0].qDef.qDef},show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},libraryMeasure:{type:"string",component:"library-item",libraryItemType:"measure",ref:"qHyperCubeDef.qMeasures.0.qLibraryId",translation:"Common.Measure",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&b.qLibraryId}},label:{ref:"qHyperCubeDef.qMeasures.0.qDef.qLabel",type:"string",translation:"Common.Label",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{type:"boolean",ref:"show",translation:"Common.Show",show:function(b,c,d){return a.getValue(d.properties,"background.show",!1)}}}}}},pointLayer:{type:"items",component:"expandable-items",grouped:!0,items:{dimensions:{type:"items",items:{field:{ref:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",type:"string",component:"expression",expressionType:"dimension",translation:"Common.Field",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return!b||!b.qLibraryId},readOnly:!0},libraryDimension:{ref:"qHyperCubeDef.qDimensions.0.qLibraryId",type:"string",translation:"Common.Dimension",component:"library-item",libraryItemType:"dimension",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return b&&b.qLibraryId}},geodata:{ref:"qHyperCubeDef.qDimensions.1.qDef.qFieldDefs.0",type:"string",component:"expression",expressionType:"dimension",translation:"properties.layers.pointData",change:function(a){var b=a.qHyperCubeDef.qDimensions[1].qDef;b.qFieldLabels||(b.qFieldLabels=[]),b.qFieldLabels[0]=b.qFieldDefs[0]},show:function(a){return a&&a.qHyperCubeDef&&a.qHyperCubeDef.qDimensions&&e(a.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0}}},measure:{type:"items",items:{expression:{ref:"qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"Common.Expression",expressionType:"dimension",change:function(b,c,d,e){var f=b.qHyperCubeDef.qMeasures[0];if(f&&""===f.qDef.qDef)b.qHyperCubeDef.qMeasures.length=0,("byMeasure"===a.getValue(d,"color.mode")||"byExpression"===a.getValue(d,"color.mode"))&&(a.setValue(d,"color.mode","primary"),a.getValue(d,"color.auto")===!1&&a.setValue(d,"color.auto",!0));else{f.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},2!==b.qHyperCubeDef.qInterColumnSortOrder[0]&&b.qHyperCubeDef.qInterColumnSortOrder.splice(0,0,2);var g=d.layers.indexOf(b),h=e.layout.layers[g],i=h.qHyperCube.qMeasureInfo?h.qHyperCube.qMeasureInfo.length:0;d.color.auto&&"primary"===d.color.mode&&0===i&&(d.color.auto=!1,d.color.mode="byMeasure")}},show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},libraryMeasure:{ref:"qHyperCubeDef.qMeasures.0.qLibraryId",type:"string",translation:"Common.Measure",component:"library-item",libraryItemType:"measure",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&b.qLibraryId}},label:{ref:"qHyperCubeDef.qMeasures.0.qDef.qLabel",type:"string",translation:"Common.Label",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},useSize:{ref:"useSize",type:"boolean",translation:"properties.map.useSize",defaultValue:!0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b}},bubbleSizes:{ref:"bubbleSizes",type:"integer",translation:"properties.dataPoints.bubbleSizes",component:"slider",min:1,max:32,step:1,defaultValue:8,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!(b&&a.useSize)}},rangeBubbleSizes:{ref:"rangeBubbleSizes",type:"array",translation:"properties.dataPoints.bubbleSizes",component:"slider",min:1,max:32,step:1,defaultValue:[1,32],show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.useSize}},customRange:{type:"items",items:{autoMinMax:{ref:"autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.useSize}},customMin:{ref:"customMin",translation:"properties.axis.min",expression:"optional",type:"number",defaultValue:0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.useSize&&a.autoMinMax===!1},invalid:function(b){return"minMax"===a.getValue(b,"minMax")?a.getValue(b,"customMin")>=a.getValue(b,"customMax"):!1}},customMax:{ref:"customMax",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.useSize&&a.autoMinMax===!1},invalid:function(b){return"minMax"===a.getValue(b,"minMax")?a.getValue(b,"customMin")>=a.getValue(b,"customMax"):!1}}}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{ref:"show",type:"boolean",translation:"Common.Show",show:function(b,c,d){return a.getValue(d.properties,"background.show",!1)}}}}}}}},m={component:"items",type:"items",translation:"properties.background",grouped:!0,items:{show:{ref:"background.show",type:"boolean",translation:"properties.show",component:"switch",options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],defaultValue:!1,change:function(b){b.layers.length&&!b.background.show&&(b.layers[0].show=!0),b.background&&b.background.show&&void 0===b.background.defaultMapService&&a.setValue(b,"background.defaultMapService",!0)}},baseLayers:{type:"items",show:function(b){return a.getValue(b,"background.show")},items:{defaultMapService:{ref:"background.defaultMapService",type:"boolean",translation:"properties.mapService",component:"switch",defaultValue:!0,undefinedValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},customMapService:{items:{type:{ref:"background.layers.0.type",type:"string",translation:"properties.type",component:"dropdown",options:[{translation:"properties.layers.type.slippy",value:"XYZ"}],defaultValue:"XYZ"},urls:{ref:"background.layers.0.urls.0",type:"string",translation:"Common.URL",minlength:1},attribution:{ref:"background.layers.0.attribution",type:"string",translation:"properties.attribution",component:"textarea",maxlength:1024,resolveFunctions:{get:function(a,c){var d=a(c.type);return b.toHTML(d)},set:function(a,c,d){var e=b.toMarkdown(a);c(d.type,e)}}},helpLink:{component:"link",url:function(){return d.path+"#"+c.language+"|map.htm"},translation:"properties.background.help"}},show:function(b){var c=a.getValue(b,"background.defaultMapService");return!c}}}}}},n={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},autoZoomOnSelection:{ref:"autoZoomOnSelection",type:"boolean",defaultValue:!0,translation:"properties.autoZoomOnSelection",show:function(a){return a&&a.layers&&a.layers[0]&&"point"===a.layers[0].type}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{colorMode:{options:function(a,b){var c=b.getMeasures(),d=c?c.length:0,e=b.getLayerTypeAndVersion();switch(e[0]){case"point":return d>0?k:i;case"polygon":return"2"===e[1]||"3"===e[1]?d>0?k:i:d>0?j:i}return i}},persistentColors:{show:function(b){return!a.getValue(b,"color.auto")&&"byDimension"===a.getValue(b,"color.mode")&&("polygon"!==b.layers[0].type||"2"!==b.layers[0].version)}},attributeExpression:{ref:"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0.qExpression",change:function(b){var c=a.getValue(b,"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=a.getValue(b,"color");c&&(c.type="colorByExpression",d&&(d.colorExpression=c.qExpression))},globalChange:function(b){var c,d,e,f=a.getValue(b,"layers.0.qHyperCubeDef.qMeasures",[]),g=a.getValue(b,"layers.0.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",[]),h=null,i=function(a,b){"colorByExpression"===a.type&&(d=b)};if(f.length+g.length>1){for(c=g.length-1;c>=0;--c)e=g[c].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);for(c=f.length-1;c>=0;--c)e=f[c].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);!f[0].qAttributeExpressions&&h&&(f[0].qAttributeExpressions=[]),h&&f[0].qAttributeExpressions.splice(0,0,h)}var j=a.getValue(b,"color.colorExpression");1!==f.length||f[0].qAttributeExpressions&&0!==f[0].qAttributeExpressions.length||!j||(f[0].qAttributeExpressions=[{qExpression:j,type:"colorByExpression"}])}},expressionLabel:{change:function(b){var c=a.getValue(b,"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=a.getValue(b,"color");c&&(c.label=a.getValue(b,"color.expressionLabel"),d&&(d.colorExpression=c.qExpression))}}}},legend:{items:{show:{show:function(a){return!f(a)}},showTitle:{show:function(b){return a.getValue(b,"legend.show")&&!f(b)&&!g(b)}},dock:{show:function(b){return a.getValue(b,"legend.show")&&!f(b)}}}}}}}};return{type:"items",component:"accordion",items:{data:l,background:m,settings:n}}}),define("extensions.qliktech/map/projection/unit-projection",["core.utils/class"],function(a){var b;return b=a.extend("UnitProjection",{init:function(){},getProjectionType:function(){return"Unit"},project:function(a){return a},invProject:function(a){return a}})}),define("extensions.qliktech/map/projection/mercator-projection",["core.utils/class","objects.utils/shapes/point"],function(a,b){var c,d=Math.PI,e=d/2,f=d/4,g=d/180,h=Math.max,i=Math.min,j=85.0511287798059*g,k=180/d;return c=a.extend("MercatorProjection",{init:function(){},getProjectionType:function(){return"Mercator"},project:function(a){if(a){var c=h(i(a.y*g,j),-j),d=a.x*g,e=0,l=d-e,m=Math.log(Math.tan(f+c/2));return l*=k,m*=k,new b(l,m)}},invProject:function(a){if(a){var c=a.x*g,d=a.y*g,f=0,h=c+f,i=2*Math.atan(Math.pow(Math.E,d))-e;return h*=k,i*=k,new b(h,i)}}})}),define("extensions.qliktech/map/projection/viewport-projection",["objects.views/charts/events/event-launcher","objects.utils/shapes/point","objects.utils/shapes/rect","extensions.qliktech/map/projection/unit-projection","extensions.qliktech/map/projection/mercator-projection","objects.views/charts/utils/matrix"],function(a,b,c,d,e,f){function g(a){return this._projectedMapOriginalCenterIsZeroPoint?a:new b(a.x-this._projectedMapOriginalCenter.x,a.y-this._projectedMapOriginalCenter.y)}function h(a){return this._projectedMapOriginalCenterIsZeroPoint?a:new b(a.x+this._projectedMapOriginalCenter.x,a.y+this._projectedMapOriginalCenter.y)}function i(a,c){var d=Math.pow(2,c+8)/this._projectedMapSize;return new b(a.x*d,a.y*d)}function j(a,c){var d=Math.pow(2,c+8)/this._projectedMapSize;return new b(a.x/d,a.y/d)}function k(){if(this._projection&&this._projectedMapBoundingBox){var a,b,c,d,e;this._projectedMapSize=Math.max(this._projectedMapBoundingBox.width,this._projectedMapBoundingBox.height),a=Math.pow(2,this._zoomLevel+8)/this._projectedMapSize,this._projectedMapOriginalCenter=this._projectedMapBoundingBox.getCenterPoint(),this._mapOriginialCenter=this._projection.invProject(this._projectedMapOriginalCenter),this._currentMapCenter||(this._currentMapCenter=this._mapOriginialCenter),this._projectedMapOriginalCenterIsZeroPoint=0===this._projectedMapOriginalCenter.x&&0===this._projectedMapOriginalCenter?!0:!1,(!this._projectedCurrentMapCenter||this._projectionChanged||this._currentMapCenterChanged)&&(this._projectedCurrentMapCenter=this._projection.project(this._currentMapCenter)),this._transformMatrixForZoomLevel.identity(),this._transformMatrixForZoomLevel.translate(this._viewportSize.x/2,this._viewportSize.y/2),this._transformMatrixForZoomLevel.scale(1,-1),this._transformMatrixForZoomLevel.scale(a,a),this._transformMatrixForZoomLevel.translate(-this._projectedMapOriginalCenter.x,-this._projectedMapOriginalCenter.y),b=this._transformMatrixForZoomLevel.transformPoint(this._projectedMapOriginalCenter),c=this._transformMatrixForZoomLevel.transformPoint(this._projectedCurrentMapCenter),d=b.x-c.x,e=b.y-c.y,this._transformMatrix.identity(),this._transformMatrix.translate(d,e),this._transformMatrix.multiply(this._transformMatrixForZoomLevel.elements),this._invTransformMatrix=this._transformMatrix.clone(),this._invTransformMatrix.invert(),this._projectionChanged=!1,this._currentMapCenterChanged=!1,this.enabledChangeEvent&&this.fire("changed")}}function l(){this._projection instanceof e&&(this._projectedMapBoundingBox=new c(-180,-85.0511287798059,360,170.1022575596118)),this._projection instanceof d&&(this._projectedMapBoundingBox=new c(-180,-180,360,360)),this._projectedMapSize=Math.max(this._projectedMapBoundingBox.width,this._projectedMapBoundingBox.height)}var m,n=0,o=1e-9,p=new b(0,0),q=Math.log(2);return m=a.extend("ViewportProjection",{init:function(){this._super(),n++,this._fractionalZoomMode=!0,this._viewportSize=new b(256,256),this._zoomLevel=0,this._maxZoomLevel=20,this._minZoomLevel=0,this._translation=new b(0,0),this._unitProjection=new d,this._mercatorProjection=new e,this._projection=this._unitProjection,this._projectedMapOriginalCenter=new b(0,0),l.call(this),this._projectedMapOriginalCenterIsZeroPoint=!0,this._transformMatrixForZoomLevel=new f,this._transformMatrix=new f,this._invTransformMatrix=new f,this.enabledChangeEvent=!0},setProjection:function(a){return this._projection&&a&&this._projection.getProjectionType()===a.getProjectionType()?!1:(this._projection=a,this._projection||(this._projection=this._unitProjection),l.call(this),this._projectionChanged=!0,k.call(this),!0)},getProjection:function(){return this._projection},getUnitProjection:function(){return this._unitProjection},getMercatorProjection:function(){return this._mercatorProjection},setProjectedMapBoundingBox:function(a){this._projectedMapBoundingBox&&this._projectedMapBoundingBox.equal&&this._projectedMapBoundingBox.equal(a)||(this._projectedMapBoundingBox=new c(a.x,a.y,a.width,a.height),k.call(this))},getProjectedMapBoundingBox:function(){return this._projectedMapBoundingBox},setSize:function(a){return this._viewportSize&&this._viewportSize.equal&&this._viewportSize.equal(a)?!1:(this._viewportSize=new b(a.x,a.y),k.call(this),!0)},getSize:function(){return this._viewportSize},setZoomLevel:function(a){return isNaN(a)?!1:(this._fractionalZoomMode||(a=Math.round(a)),a=Math.max(Math.min(a,this._maxZoomLevel),this._minZoomLevel),Math.abs(this._zoomLevel-a)<.001?!1:(this._zoomLevel=a,k.call(this),!0))},getZoomLevel:function(){return this._zoomLevel},setMapCenter:function(a){return a?this._currentMapCenter&&this._currentMapCenter.closeTo&&this._currentMapCenter.closeTo(a,o)?!1:(this._currentMapCenterChanged=!0,this._currentMapCenter=new b(a.x,a.y),k.call(this),!0):!1},getMapCenter:function(){return this._currentMapCenter},setMapCenterInLonLat:function(a){if(!a)return!1;var b=this._projection instanceof d?this._mercatorProjection.project(a):a;return this.setMapCenter(b)},getMapCenterInLonLat:function(){return this._projection instanceof d?this._mercatorProjection.invProject(this._currentMapCenter):this._currentMapCenter},setFractionalZoomMode:function(a){this._fractionalZoomMode=a},getFractionalZoomMode:function(){return this._fractionalZoomMode},project:function(a){var b,c;return b=this._projection.project(a),c=this.transform(b)},invProject:function(a){var b,c;return b=this.invTransform(a),c=this._projection.invProject(b)},fromLonLatToViewport:function(a){var b,c;return b=this._projection instanceof d?this._mercatorProjection.project(a):a,c=this.project(b)},fromViewportToLonLat:function(a){var b,c;return b=this.invProject(a),c=this._projection instanceof d?this._mercatorProjection.invProject(b):b},fromMapRectToViewportRect:function(a){var d,e,f;return d=this.project(new b(a.x,a.y)),e=this.project(new b(a.x+a.width,a.y+a.height)),f=new c(d.x,d.y,e.x-d.x,e.y-d.y)},fromViewportRectToMapRect:function(a){var d,e,f;return d=this.invProject(new b(a.x,a.y)),e=this.invProject(new b(a.x+a.width,a.y+a.height)),f=new c(d.x,d.y,e.x-d.x,e.y-d.y)},getViewRectangleInMapCoordinate:function(){var a,b,d;return a=this.invProject(p),b=this.invProject(this._viewportSize),d=new c(a.x,a.y,b.x-a.x,b.y-a.y)},fromLonLatRectToViewportRect:function(a){var d,e,f;return d=this.fromLonLatToViewport(new b(a.x,a.y)),e=this.fromLonLatToViewport(new b(a.x+a.width,a.y+a.height)),f=new c(d.x,d.y,e.x-d.x,e.y-d.y)},fromViewportRectToLonLatRect:function(a){var d,e,f;return d=this.fromViewportToLonLat(new b(a.x,a.y)),e=this.fromViewportToLonLat(new b(a.x+a.width,a.y+a.height)),f=new c(d.x,d.y,e.x-d.x,e.y-d.y)},transform:function(a){var c=this._transformMatrix.transformPoint(a);return new b(c.x,c.y)},invTransform:function(a){var c=this._invTransformMatrix.transformPoint(a);return new b(c.x,c.y)},fromMapPointToPixel:function(a,c){var d,e,f,h,j=Math.pow(2,c+7);return d=this._projection.project(a),e=g.call(this,d),f=i.apply(this,[e,c]),h=new b(f.x+j,j-f.y)},fromPixelToMapPoint:function(a,c){var d,e,f,g,i=Math.pow(2,c+7);return g=new b(a.x-i,i-a.y),f=j.apply(this,[g,c]),e=h.call(this,f),d=this._projection.invProject(e)},fromLonLatToPixel:function(a,c){var d,e,f,h,j=Math.pow(2,c+7);return d=this._mercatorProjection.project(a),e=g.call(this,d),f=i.apply(this,[e,c]),h=new b(f.x+j,j-f.y)},fromPixelToLonLat:function(a,c){var d,e,f,g,i=Math.pow(2,c+7);return g=new b(a.x-i,i-a.y),f=j.apply(this,[g,c]),e=h.call(this,f),d=this._mercatorProjection.invProject(e)},calculateZoomLevelForMapRectangle:function(a){if(a){var c,d,e,f,g,h,i,j,k,l;return c=new b(a.x,a.y),d=new b(a.x+a.width,a.y+a.height),e=this.fromMapPointToPixel(c,0),f=this.fromMapPointToPixel(d,0),g=Math.abs(e.x-f.x),h=Math.abs(e.y-f.y),i=0===g?Number.MAX_VALUE:this._viewportSize.x/g,j=0===h?Number.MAX_VALUE:this._viewportSize.y/h,k=Math.min(i,j),k===Number.MAX_VALUE?20:l=Math.log(k)/Math.LN2}},calculateCenterPointForMapRectangle:function(a){if(a){var c,d,e,f,g,h;return c=new b(a.x,a.y),d=new b(a.x+a.width,a.y+a.height),e=this.fromMapPointToPixel(c,0),f=this.fromMapPointToPixel(d,0),g=new b((e.x+f.x)/2,(e.y+f.y)/2),h=this.fromPixelToMapPoint(g,0)}},moveViewport:function(a,c){this.setMapCenter(this.invProject(new b(this._viewportSize.x/2-a,this._viewportSize.y/2-c)))},zoom:function(a){a>0&&this.setZoomLevel(this.getZoomLevel()+Math.log(a)/Math.LN2)},zoomOnPixel:function(a,b){if(b>0){var c,d,e;c=this.invTransform(a),e=Math.log(b)/Math.LN2,this.setZoomLevel(this.getZoomLevel()+e),d=this.transform(c),this.moveViewport(a.x-d.x,a.y-d.y)}},zoomOnMapRectangle:function(a,b){if(a){var c,d;c=this.calculateZoomLevelForMapRectangle(a),this._fractionalZoomMode||(c=b?Math.round(c):Math.floor(c)),this.setZoomLevel(c),d=this.calculateCenterPointForMapRectangle(a),this.setMapCenter(d)}},setMaxZoomLevel:function(a){this._maxZoomLevel=a},setMinZoomLevel:function(a){this._minZoomLevel=a},getViewRectangleInLonLat:function(){var a,b;return a=this.fromViewportToLonLat(p),b=this.fromViewportToLonLat(this._viewportSize),new c(Math.min(a.x,b.x),Math.min(a.y,b.y),Math.abs(a.x-b.x),Math.abs(a.y-b.y))},getTransformMatrix:function(){return this._transformMatrix},setTransformMatrix:function(a){var c,d,e;this._invTransformMatrix=a.clone().invert(),c=Math.abs(a.elements[0][0]),d=Math.log(c*this._projectedMapSize)/q-8,e=this.invProject(new b(this._viewportSize.x/2,this._viewportSize.y/2)),this.setZoomLevel(d),this.setMapCenter(e)},getInvTransformMatrix:function(){return this._invTransformMatrix}})}),define("extensions.qliktech/map/map-layer",["objects.views/charts/components/chart-component","objects.views/charts/utils/canvas-renderer"],function(a,b){function c(){this._viewportProjectionChanged=!0,this._shouldPaintOnDataChanged||this.invalidateDisplay("onViewportProjectionChanged")}function d(){this._viewportProjectionChanged=!0,this.paint()}function e(){void 0!==this._layerData.opacity&&(this.container.style.opacity=this._layerData.opacity,this.container.style.filter="alpha(opacity="+100*this._layerData.opacity+")")}function f(){this._toggledOnCacheItems.forEach(function(a){a.selected=!1}),this._toggledOnCacheItems=[],this._selectedRows=[]}function g(a){var b=this,c=this._toggledOnCacheItems.map(function(a){return a.row});this.updateBackendApi(),this.backendApi.select2("SelectHyperCubeCells",this._layerPath,c,a).then(function(a){b._selectionFailed=!a.qSuccess,b._selectionFailed&&f.call(b)})}var h;return h=a.extend("MapLayer",{init:function(){this._super.apply(this,arguments),this._viewportProjectionChanged=!1,this._data=void 0,this._layerData=void 0,this._qData=void 0,this._qMatrix=void 0,this._qSelectionInfo=void 0,this._numItems=0,this._layoutMode=void 0,this._selectableShapes=[],this._shapes=[],this._cacheItems=[],this._colorMap=void 0,this._layerBounds=void 0,this._cacheItems=null,this._renderer=new b(this.container),this._firstAutoZoomed=!1,this._numPoints=0,this._toggledOnCacheItems=[],this._selectedRows=[]
},setData:function(a,b){var c;this._skipInvalidateOnGlobalOpacityChange=!0,this._data=a,this._layerData=b,this._toggledOnCacheItems=[],this._selectedRows=[],c=this._layerData?this._layerData.show:!1,c?this.showComponent():this.hideComponent(),this._qSelectionInfo=this._data?this._data.qSelectionInfo:void 0,e.call(this)},getData:function(){return this._data},getLayerData:function(){return this._layerData},setLayerIndex:function(a){this._layerIndex=a},getLayerIndex:function(){return this._layerIndex},setLayerType:function(a){this._layerType=a},getLayerType:function(){return this._layerType},setVersion:function(a){this._version=a},getVersion:function(){return this._version},setFirstAutoZoomed:function(a){this._firstAutoZoomed=a},getFirstAutoZoomed:function(){return this._firstAutoZoomed},getLayerPath:function(){return this._layerPath},getNumPoints:function(){return this._numPoints},getLayerBounds:function(){return this._layerBounds},setViewportProjection:function(a){this._viewportProjection!==a&&(this._viewportProjection&&(this._viewportProjection.stopListen("changed",c,this),this._viewportProjection.stopListen("changedByInteraction",d,this)),this._viewportProjection=a,this._viewportProjection&&(this._viewportProjection.listen("changed",c,this),this._viewportProjection.listen("changedByInteraction",d,this)))},setBackendApi:function(a){this.backendApi=a},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},getLayerOutputData:function(){return this._layerData?this._layerData.qHyperCube?{color:this._data.color,qSelectionInfo:this._data.qSelectionInfo,qHyperCube:this._layerData.qHyperCube}:this._layerData.qListObject?{color:this._data.color,qSelectionInfo:this._data.qSelectionInfo,qListObject:this._layerData.qListObject}:void 0:void 0},getMeasureInfo:function(){return this._layerData?this._layerData.qHyperCube?this._layerData.qHyperCube.qMeasureInfo:this._layerData.qListObject?this._layerData.qListObject.qMeasureInfo:void 0:void 0},getSelectedRows:function(){return this._toggleOnCacheItemsChanged&&(this._selectedRows=this._toggledOnCacheItems.map(function(a){return a.row}),this._toggleOnCacheItemsChanged=!1),this._selectedRows},setGlobalOpacity:function(a,b){var c=this;this._skipInvalidateOnGlobalOpacityChange=!1,this._globalAlpha=a,b||setTimeout(function(){c._skipInvalidateOnGlobalOpacityChange||(f.call(c),c.invalidateDisplay("MapLayer.setGlobalOpacity"),c._skipInvalidateOnGlobalOpacityChange=!0)},100)},setPreselectionMode:function(a){this._preselectionMode=a},toggleShapes:function(a){var b,c,d,e=a?a.length:0;if(this.isVisible()&&0!==e)for(this._skipInvalidateOnGlobalOpacityChange=!0,b=0;e>b;b++)d=a[b],(-3===d.id||d.id>=0)&&(d.selected&&this._toggledOnCacheItems.indexOf(d)<0?(this._toggledOnCacheItems[this._toggledOnCacheItems.length]=d,this._toggleOnCacheItemsChanged=!0):d.selected||(c=this._toggledOnCacheItems.indexOf(d),c>=0&&(this._toggledOnCacheItems.splice(c,1),this._toggleOnCacheItemsChanged=!0)))},selectOnLayer:function(a,b){this.isVisible()&&(this._toggledOnCacheItems.length?g.call(this,b):a&&a.length&&a.every(function(a){return!a.selected})&&this.clearSelections())},clearSelections:function(){this.updateBackendApi(),this.backendApi.clearSelections()},updateBackendApi:function(){this.backendApi&&this.backendApi.path!==this._layerPath&&(this.backendApi.path=this._layerPath,this.backendApi.path&&(this.backendApi.dataPath=this.backendApi.path.slice(1,-3)))},afterPaint:function(){},clear:function(){},updateSize:function(){this._super(),this.rect.x*=this.layoutToContainerRatios.x||1,this.rect.width*=this.layoutToContainerRatios.x||1,this.rect.y*=this.layoutToContainerRatios.y||1,this.rect.height*=this.layoutToContainerRatios.y||1,this.layoutToContainerRatios={x:1,y:1};for(var a in this.renderers)this.renderers[a].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[a].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1)},release:function(){this._super(),this._viewportProjection&&(this._viewportProjection.stopListen("changed"),this._viewportProjection.stopListen("changedByInteraction")),this._viewportProjection=null,this.backendApi=null}})}),define("extensions.qliktech/map/geo-region",["objects.utils/shapes/rect","objects.utils/shapes/geometry-math"],function(a,b){function c(a,b){var c=a?a.length:0,d=[];return this._id=b,0===c?void this.setGeoPolygons(d):void this.setGeoPolygons(a)}return c.prototype={setId:function(a){this._id=a},getId:function(){return this._id},setGeoPolygons:function(a){this.geopolygons!==a&&(this.geopolygons=a,this._numGeoPolygons=this.geopolygons?this.geopolygons.length:0,this._numPoints=0,this._centerPoint=null,this._boundsNeedToUpdate=!0,this._pointsNeedToUpdate=!0,this._numPointsNeedToUpdate=!0)},validateGeoPolygons:function(){var a;for(a=0;a<this._numGeoPolygons;a++)this.geopolygons[a].validatePolygons()},getGeoPolygons:function(){return this.geopolygons},getNumGeoPolygons:function(){return this._numGeoPolygons},getNumPoints:function(){if(this._numPointsNeedToUpdate){var a,b=0;for(a=0;a<this._numGeoPolygons;a++)b+=this.geopolygons[a].getNumPoints();this._numPoints=b,this._numPointsNeedToUpdate=!1}return this._numPoints},getPoints:function(){if(this._pointsNeedToUpdate){this.points=[];var a;for(a=0;a<this._numGeoPolygons;a++)this.geopolygons[a]&&(this.points=this.points.concat(this.geopolygons[a].getPoints()))}return this.points},pointInside:function(a,b){if(this.calculateBounds(),void 0===this._bounds||a<=this._bounds.x||a>=this._bounds.x+this._bounds.width||b<=this._bounds.y||b>=this._bounds.y+this._bounds.height)return!1;var c;for(c=0;c<this._numGeoPolygons;c++)if(this.geopolygons[c].pointInside(a,b))return!0;return!1},intersectsLine:function(a){if(!a)return!1;var b;for(b=0;b<this._numGeoPolygons;b++)if(this.geopolygons[b].intersectsLine(a))return!0;return!1},intersectsRect:function(a){if(!a)return!1;var b;for(b=0;b<this._numGeoPolygons;b++)if(this.geopolygons[b].intersectsRect(a))return!0;return!1},calculateBounds:function(){if(this._boundsNeedToUpdate||!this._bounds){if(this._boundsNeedToUpdate=!1,0===this._numGeoPolygons)return null;var c=b.calculateBounds(this.geopolygons);this._bounds=new a(c.x,c.y,c.width,c.height)}return this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var a,b="";for(a=0;a<this._numGeoPolygons-1;a++)b+=this.geopolygons[a].toString()+";";return b+=this.geopolygons[this._numGeoPolygons-1].toString()}},c}),define("extensions.qliktech/map/geo-regions-data",["core.utils/class","objects.utils/shapes/point","objects.utils/shapes/rect","objects.utils/shapes/geometry-math","extensions.qliktech/map/projection/unit-projection"],function(a,b,c,d,e){function f(){var a,b,c,d,e,f,g,h,i,j;for(this._projectedGeoRegions&&this._projectedGeoRegions.length===this._numGeoRegions||(this._projectedGeoRegions=new Array(this._numGeoRegions)),a=0;a<this._numGeoRegions;a++)for(e=this._geoRegions[a].getGeoPolygons(),f=e?e.length:0,this._projectedGeoRegions[a]&&this._projectedGeoRegions[a].length===f||(this._projectedGeoRegions[a]=new Array(f)),b=0;f>b;b++)for(g=e[b].getPolygons(),h=g?g.length:0,this._projectedGeoRegions[a][b]&&this._projectedGeoRegions[a][b].length===h||(this._projectedGeoRegions[a][b]=new Array(h)),c=0;h>c;c++)for(i=g[c].points,j=i?i.length:0,this._projectedGeoRegions[a][b][c]&&this._projectedGeoRegions[a][b][c].length===j||(this._projectedGeoRegions[a][b][c]=new Array(j)),d=0;j>d;d++)this._projectedGeoRegions[a][b][c][d]=this._projection.project(i[d])}function g(){var a;for(this._regionIdToRegionIndexMapping={},a=0;a<this._numGeoRegions;a++)this._regionIdToRegionIndexMapping[this._geoRegions[a].getId()]=a}var h;return h=a.extend("GeoRegionsData",{init:function(){this._numGeoRegions=0,this._mapBoundsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0,this._regionIdToRegionIndexMappingNeedToUpdate=!0,this._projectedGeoRegionsNeedToUpdate=!1,this._projection=new e,this._numPointsNeedToUpdate=!0},getNumGeoRegions:function(){return this._numGeoRegions},getNumPoints:function(){if(this._numPointsNeedToUpdate){var a,b=0;for(a=0;a<this._numGeoRegions;a++)b+=this._geoRegions[a].getNumPoints();this._numPoints=b,this._numPointsNeedToUpdate=!1}return this._numPoints},setGeoRegions:function(a){this._geoRegions=a,this._numGeoRegions=this._geoRegions?this._geoRegions.length:0,this._projectedGeoRegionsNeedToUpdate=!0,this._mapBoundsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0,this._regionIdToRegionIndexMappingNeedToUpdate=!0},getGeoRegions:function(){return this._geoRegions},getGeoRegionById:function(a){this._regionIdToRegionIndexMappingNeedToUpdate&&(g.call(this),this._regionIdToRegionIndexMappingNeedToUpdate=!1);var b=this._regionIdToRegionIndexMapping[a];return this._geoRegions[b]},setProjection:function(a){this._projection&&a&&this._projection.getProjectionType()===a.getProjectionType()||(this._projection=a,this._projectedGeoRegionsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0)},getProjection:function(){return this._projection},getProjectedGeoRegions:function(){return this._projectedGeoRegionsNeedToUpdate&&this._projection&&(f.call(this),this._projectedGeoRegionsNeedToUpdate=!1),this._projectedGeoRegions},getProjectedGeoRegionById:function(a){this._regionIdToRegionIndexMappingNeedToUpdate&&(g.call(this),this._regionIdToRegionIndexMappingNeedToUpdate=!1),this._projectedGeoRegionsNeedToUpdate&&this._projection&&(f.call(this),this._projectedGeoRegionsNeedToUpdate=!1);var b=this._regionIdToRegionIndexMapping[a];return this._projectedGeoRegions[b]},calculateBounds:function(){if(this._mapBoundsNeedToUpdate){this._mapBoundsNeedToUpdate=!1;var a=d.calculateBounds(this._geoRegions);this._mapBounds=a?new c(a.x,a.y,a.width,a.height):null}return this._mapBounds},calculateProjectedBounds:function(){if(this._projectedMapBoundsNeedToUpdate){this._projectedMapBoundsNeedToUpdate=!1;var a,d,e=this.calculateBounds();e?(a=this._projection.project(new b(e.x,e.y)),d=this._projection.project(new b(e.x+e.width,e.y+e.height)),this._projectedMapBounds=new c(a.x,a.y,d.x-a.x,d.y-a.y)):this._projectedMapBounds=null}return this._projectedMapBounds}})}),define("extensions.qliktech/map/geo-polygon",["objects.utils/shapes/polygon","objects.utils/shapes/rect","objects.utils/shapes/line","objects.utils/shapes/point","objects.utils/shapes/geometry-math"],function(a,b,c,d,e){function f(a){var b,c=a?a.length:0,e=Math.floor(c/2),f=new Array(e);for(b=0;e>b;b++)f[b]=new d(a[2*b],a[2*b+1]);return f}function g(a,b){var c,d=b-1;if(0===b)return-1;for(c=0;d>c;)if(a[c].x+180<o){if(a[c+1].x+180<o)return c;c+=2}else c++;return-1}function h(a,b,c){var d,e;return d=a[c],e=a[c+1],180-Math.abs(d.x)<o&&180-Math.abs(e.x)<o?!0:!1}function i(a,b){return 0>b?b+a:b>=a?b-a:b}function j(a,b,c){var d=b-1;if(h(a,b,i(d,c+2))){if(0===c){if(a[b-2].x>=0)return!0}else if(c===b-2){if(a[b-3].x>=0)return!0}else if(a[c-1].x>=0)return!0}else if(h(a,b,i(d,c-2))){if(0===c){if(a[2].x>=0)return!0}else if(c===b-2){if(a[1].x>=0)return!0}else if(a[c+2].x>=0)return!0}else if(0===c){if(a[b-2].x>=0&&a[2].x>=0)return!0}else if(c===b-2){if(a[b-3].x>=0&&a[1].x>=0)return!0}else if(a[c-1].x>=0&&a[c+2].x>=0)return!0;return!1}function k(a,b,c){0===c?(a[c].x=180,a[c+1].x=180,a[b-1].x=180):c===b-2?(a[c].x=180,a[c+1].x=180,a[0].x=180):(a[c].x=180,a[c+1].x=180)}function l(a){var b,c=a?a.points:null,d=c?c.length:0;b=g(c,d),0>b||j(c,d,b)&&k(c,d,b)}function m(a){var b,c=a?a.length:0;for(b=0;c>b;b++)l(a[b])}function n(b){var c,d=b?b.length:0,e=[];if(0===d)return void this.setPolygons(e);if(b[0].getPoints)this.setPolygons(b);else{for(c=0;d>c;c++)b[c]&&b[c].length&&e.push(new a(f(b[c])));this.setPolygons(e)}}var o=1e-5;return n.prototype={setPolygons:function(a){this.polygons!==a&&(this.polygons=a,this._numPolygons=this.polygons?this.polygons.length:0,this._numPoints=0,this._centerPoint=null,this._boundsNeedToUpdate=!0,this._pointsNeedToUpdate=!0,this._numPointsNeedToUpdate=!0)},validatePolygons:function(){m(this.polygons)},getPolygons:function(){return this.polygons},getNumPolygons:function(){return this._numPolygons},getPoints:function(){if(this._pointsNeedToUpdate){this.points=[];var a;for(a=0;a<this._numPolygons;a++)this.polygons[a]&&(this.points=this.points.concat(this.polygons[a].getPoints()))}return this.points},getNumPoints:function(){if(this._numPointsNeedToUpdate){var a,b=0;for(a=0;a<this._numPolygons;a++)b+=this.polygons[a].getNumPoints();this._numPoints=b,this._numPointsNeedToUpdate=!1}return this._numPoints},pointInside:function(a,b){if(this.calculateBounds(),void 0===this._bounds||a<=this._bounds.x||a>=this._bounds.x+this._bounds.width||b<=this._bounds.y||b>=this._bounds.y+this._bounds.height)return!1;var c,d,e;if(0===this._numPolygons)return!1;if(this.polygons[0].pointInside(a,b)){for(d=this._innerPolygons?this._innerPolygons.length:0,c=0;d>c;c++)if(this.polygons[this._innerPolygons[c]].pointInside(a,b))return!1;return!0}for(e=this._outerPolygons?this._outerPolygons.length:0,c=0;e>c;c++)if(this.polygons[this._outerPolygons[c]].pointInside(a,b))return!0;return!1},intersectsLine:function(a){if(!a)return!1;if(this.pointInside(a.x1,a.y1)||this.pointInside(a.x2,a.y2))return!0;var b;for(b=0;b<this._numPolygons;b++)if(this.polygons[b].intersectsLine(a))return!0;return!1},intersectsLines:function(a){var b,c=a?a.length:0;for(b=0;c>b;b++)if(this.intersectsLine(a[b]))return!0;return!1},intersectsRect:function(a){if(!a)return!1;if(this.calculateBounds(),!this._bounds)return!1;if(a.rectInside(this._bounds))return!0;if(!this._bounds.intersectsWith(a))return!1;var b,d,e,f,g;return b=a.x,d=a.getRight(),e=a.y,f=a.getBottom(),this.pointInside(b,e)||this.pointInside(d,e)||this.pointInside(d,f)||this.pointInside(b,f)?!0:(g=[new c(b,e,d,e),new c(b,f,d,f),new c(b,e,b,f),new c(d,e,d,f)],this.intersectsLines(g))},calculateBounds:function(){if(this._boundsNeedToUpdate||!this._bounds){if(this._boundsNeedToUpdate=!1,0===this._numPolygons)return null;var a,c,d,f=e.calculateBounds(this.polygons);for(this._bounds=new b(f.x,f.y,f.width,f.height),a=this.polygons[0].calculateBounds(),this._innerPolygons=[],this._outerPolygons=[],d=1;d<this._numPolygons;d++)c=this.polygons[d].calculateBounds(),a.rectInside(c)&&this.polygons[0].pointInside(this.polygons[d].points[0].x,this.polygons[d].points[0].y)?this._innerPolygons.push(d):this._outerPolygons.push(d)}return this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var a,b="";for(a=0;a<this._numPolygons-1;a++)b+=this.polygons[a].toString()+";";return b+=this.polygons[this._numPolygons-1].toString()}},n}),define("extensions.qliktech/map/map-polygon-layer",["extensions.qliktech/map/map-layer","objects.views/selections/cache-item-base","general.utils/color","objects.utils/shapes/point","objects.utils/shapes/polygon","extensions.qliktech/map/geo-region","extensions.qliktech/map/geo-regions-data","extensions.qliktech/map/geo-polygon"],function(a,b,c,d,e,f,g,h){function i(){return this._dimensionTitle!==this._qData.qDimensionInfo.qFallbackTitle?(this._dimensionTitle=this._qData.qDimensionInfo.qFallbackTitle,!0):!1}function j(){var a=this._qData.qExpressions.length;return JSON.stringify(this._geometryMeasureInfo)!==JSON.stringify(this._qData.qExpressions[a-1])?(this._geometryMeasureInfo=this._qData.qExpressions[a-1],!0):this._rawGeoRegions||this._loadingGeometryData?!1:!0}function k(a){var b,c=a?a.length:0;for(b=0;c>b;b++)a[b]=new d(a[b][0],a[b][1]);return new e(a)}function l(a){var b,c=a?a.length:0,d=new Array(c);for(b=0;c>b;b++)d[b]=k(a[b]);return new h(d)}function m(a,b){var c,d,e="-"===b?[]:JSON.parse(b),g=e.length;for(c=0;g>c;c++)e[c]=l(e[c]);return d=new f(e,a)}function n(a){this._rawGeoRegions=a,this._geoRegionsData.setGeoRegions(a),"$mercator"!==this._qExpressions[1].projection?(this._geoRegionsData.setProjection(this._viewportProjection.getMercatorProjection()),this._layerBounds=this._geoRegionsData.calculateProjectedBounds()):this._layerBounds=this._geoRegionsData.calculateBounds(),this.fire("boundsChanged",[this]),this._regionsChanged=!0}function o(){var a=this,b=this._layerIndex,c=this._qData.qSize.qcy||500;this._loadingGeometryData=!0,this.backendApi.getData("GetListObjectData","/layers/"+b+"/qListObjectDef",[{qTop:0,qLeft:0,qWidth:3,qHeight:c}]).then(function(b){a._loadingGeometryData=!1,a._rawGeoRegions={};var c,d,e,f,g,h=0,i=b?b.qDataPages:void 0,j=i?i instanceof Array&&i[0]?i[0].qMatrix:i.qMatrix:void 0;if(j&&0!==j.length){for(a._geometryDimensionIdx=2,g=j?j.length:0,e=new Array(g),c=0;g>c;c++)f=j[c][0].qText,d=j[c][a._geometryDimensionIdx].qText,e[c]=m(f,d),e[c].validateGeoPolygons(),h+=e[c].getNumPoints();n.call(a,e),a._dataChanged=!0,a.fire("dataChanged"),a._numPoints!==h&&(a._numPoints=h,a.fire("numPointsChanged",[a])),a.invalidateProperties("MapPolygonLayer.setGeoRegionsData"),a.invalidateDisplay("MapPolygonLayer.setGeoRegionsData")}})}function p(a){var b,c,d,e,f,g,h=a.qExpressions,i=a.qDimensionInfo,j=a.qDataPages[0]?a.qDataPages[0].qMatrix:void 0,k=j?j.length:0,l=-Number.MAX_VALUE,m=Number.MAX_VALUE;if(!this._hasMeasure)return void(a.qMeasureInfo=[]);for(b={qFallbackTitle:void 0===h[0].qLabel?h[0].qExpr:h[0].qLabel},c=0;k>c;c++)d=j[c],e=d[0].qState,f="S"===e||"O"===e||"L"===e,f?(g=d[1].qNum,g>l&&(l=g),m>g&&(m=g)):d[1].qNum=0/0;b.qMax=l===-Number.MAX_VALUE?0/0:l,b.qMin=m===Number.MAX_VALUE?0/0:m,b.qNumFormat=i.qNumFormat,b.qIsAutoFormat=i.qIsAutoFormat,a.qMeasureInfo=[b]}function q(a,b){var c,d,f,g,i,j,k,l,m,n=a?a.length:0,o=new Array(n);for(j=0;n>j;j++){for(c=a[j],d=c?c.length:0,m=new Array(d),k=0;d>k;k++){for(f=c[k],i=f?f.length:0,g=new Array(i),l=0;i>l;l++)g[l]=this._viewportProjection.project(f[l]);m[k]=new e(g)}o[j]=new h(m)}b.setGeoPolygons(o)}function r(){this._toggledOnCacheItems.forEach(function(a){a.selected=!1}),this._toggledOnCacheItems=[],this._selectedRows=[]}function s(){var a=this,b=this.getSelectedRows();this.updateBackendApi(),this.backendApi.select("SelectListObjectValues",this._layerPath,b,!1).then(function(b){a._selectionFailed=!b.qSuccess,a._selectionFailed&&r.call(a)})}var t,u="#ddd",v=new c(u),w="#333",x="#333";return t=a.extend("MapPolygonLayer",{init:function(){this._super.apply(this,arguments),this._geoRegionsData=new g,this.renderers={polygonlayer:this._renderer}},setLayerIndex:function(a){this._layerIndex=a,this._layerPath="/layers/"+this._layerIndex+"/qListObjectDef"},getDataType:function(){return"listObject"},setData:function(a,b){this._super(a,b),this._qData=this._layerData?this._layerData.qListObject:void 0,this._qMatrix=this._qData&&this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._numItems=this._qMatrix?this._qMatrix.length:0,this._qExpressions=this._qData?this._qData.qExpressions:void 0,this._hasMeasure=this._qExpressions&&this._qExpressions[0]&&this._qExpressions[0].qExpr?!0:!1,p.call(this,this._qData),this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this.show&&this._qExpressions&&this._qExpressions[1]&&this._qExpressions[1].qExpr&&(i.call(this)||j.call(this))?o.call(this):(this._dataChanged=!0,this.fire("dataChanged"),this.invalidateProperties("MapPolygonLayer.setData"))},hasValidData:function(){return this._super()&&this._layerData},getSelectedRows:function(){return this._toggleOnCacheItemsChanged&&(this._selectedRows=this._toggledOnCacheItems.map(function(a){return a.id}),this._toggleOnCacheItemsChanged=!1),this._selectedRows},selectOnLayer:function(a){if(this.isVisible()){var b,c,d,e;if(this._singleSelectedItemClicked=!1,this._toggledOnCacheItems.length){if(1===this._toggledOnCacheItems.length&&1===this._numSelectedItems&&0===this._numSelectedExcludedItems&&this._selectedCacheItem===this._toggledOnCacheItems[0])return void(this._singleSelectedItemClicked=!0);s.call(this)}else{if(a&&1===a.length&&!a[0].selected&&(b=a[0].row,c=this._qMatrix[b],d=c[0].qState,e="S"===d||"L"===d))return;a&&a.length&&a.every(function(a){return!a.selected})&&this.clearSelections()}}},paint:function(){if(this._super(this._layoutMode,this._layerData),this._rawGeoRegions){if(!this.show||!this._viewportProjection||0===this._qExpressions.length||""===this._qExpressions[1].qExpr||void 0===this._qExpressions[1].qExpr||null===this._qExpressions[1].qExpr)return this._regionsChanged=!1,this._viewportProjectionChanged=!1,void this.clear();if(void 0===this._nodes&&this._updateProperties(),0!==this._numItems){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=this._qMatrix,p=this._hasMeasure?0:-1,r=[],s=[],t=0,u=0;for(this._skipInvalidateOnGlobalOpacityChange=!0,this._selectionByLayer=this._preselectionMode||this._qSelectionInfo&&this._qSelectionInfo.qInSelections,this._selectionByLayer||this._nodes.some(function(a){return a.cacheItem.selected})&&(this._singleSelectedItemClicked?(this._nodes.forEach(function(a){a.cacheItem.selected=!1}),this._singleSelectedItemClicked=!1):this._selectionByLayer=!0),a=0;a<this._numItems;a++)b=o[a],c=b[0],d=c.qState,e=c.qText,f=this._nodes[a],g=f.shapeWrapper,h=g.shape,i=this._geoRegionsData.getProjectedGeoRegionById(e),q.apply(this,[i,h]),j=f.cacheItem,k="S"===d||"O"===d||"L"===d,n=f.color,!k&&j.selected&&(m=this._hasMeasure?b[1].qNum:null,n=this._colorMap.getColor(c.qElemNumber,m,p,a)),g.fill=n.toRGBA(),this._selectionByLayer?(l=j.selected,g.stroke=l?x:w,g.strokeWidth=l?2:1):(l=k,g.stroke=w,g.strokeWidth=1),l?(g.opacity=1,s[u++]=g):(g.opacity=this._globalAlpha,r[t++]=g);this._rendererShapes=0===this._numItems?[]:r.concat(s),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._regionsChanged=!1,this._viewportProjectionChanged=!1,this._selectionFailed=!1,this.afterPaint()}}},getSnapshotLayerData:function(a){var b=this._qData.qSize.qcy||500;return this.backendApi.getData("GetListObjectData","/layers/"+this._layerIndex+"/qListObjectDef",[{qTop:0,qLeft:0,qWidth:3,qHeight:b}]).then(function(b){a.qListObject.qDataPages=b.qDataPages})},_updateProperties:function(){if(this.show&&this._layerData&&this._dataChanged&&this._rawGeoRegions){var a,c,d,e,g,h,i,j,k,l,m,n,o,p,q=this._qMatrix,r=this._hasMeasure?0:-1,s=this._hasMeasure?this._qMeasureInfo[0].qFallbackTitle:"";for(this._singleSelectedItemClicked=!1,this._regionsChanged=!0,this._numSelectedItems=0,this._numSelectedExcludedItems=0,this._nodes=new Array(this._numItems),m=new Array(this._numItems),a=0;a<this._numItems;a++)c=q[a],d=c[0],e=c[1],g=d.qState,h=d.qText,i=d.qElemNumber||0,j=new f(void 0,h),j.rowIndex=a,l=new b([h],[],[],[],a,0,i),l.selected=!1,l.layerIndex=this._layerIndex,l.addShape("dataArea",j,!0),n="S"===g||"O"===g||"L"===g,o=this._hasMeasure?e.qNum:null,p=n?this._colorMap.getColor(d.qElemNumber,o,r,a):v,this._hasMeasure&&n&&l.addMeasure(s,o,e.qText),m[a]=l,k={type:"multipolygon",shape:j},this._nodes[a]={shapeWrapper:k,cacheItem:l,color:p},"S"===g&&(this._numSelectedItems++,this._selectedCacheItem=l),"XS"===g&&this._numSelectedExcludedItems++;this.setSelectableShapes(m),this.fire("selectableShapesChanged"),this._dataChanged=!1}}})}),define("extensions.qliktech/map/map-polygon2-layer",["extensions.qliktech/map/map-layer","objects.views/selections/cache-item-base","general.utils/color","objects.utils/shapes/point","objects.utils/shapes/polygon","extensions.qliktech/map/geo-region","extensions.qliktech/map/geo-regions-data","extensions.qliktech/map/geo-polygon"],function(a,b,c,d,e,f,g,h){function i(){return this._dimensionTitle!==this._qData.qDimensionInfo[0].qFallbackTitle?(this._dimensionTitle=this._qData.qDimensionInfo[0].qFallbackTitle,!0):!1}function j(){var a=this._qData.qMeasureInfo.length;return JSON.stringify(this._geometryMeasureInfo)!==JSON.stringify(this._qData.qMeasureInfo[a-1])?(this._geometryMeasureInfo=this._qData.qMeasureInfo[a-1],!0):this._rawGeoRegions||this._loadingGeometryData?!1:!0}function k(a){var b,c=a?a.length:0;for(b=0;c>b;b++)a[b]=new d(a[b][0],a[b][1]);return new e(a)}function l(a){var b,c=a?a.length:0,d=new Array(c);for(b=0;c>b;b++)d[b]=k(a[b]);return new h(d)}function m(a,b){var c,d,e="-"===b?[]:JSON.parse(b),g=e.length;for(c=0;g>c;c++)e[c]=l(e[c]);return d=new f(e,a)}function n(a){this._rawGeoRegions=a,this._geoRegionsData.setGeoRegions(a),"$mercator"!==this._qMeasureInfo[1].projection?(this._geoRegionsData.setProjection(this._viewportProjection.getMercatorProjection()),this._layerBounds=this._geoRegionsData.calculateProjectedBounds()):this._layerBounds=this._geoRegionsData.calculateBounds(),this.fire("boundsChanged",[this]),this._regionsChanged=!0}function o(a){var b,c,d;if(a.qNum=0/0,a.qAttrExps&&a.qAttrExps.qValues)for(b=a.qAttrExps.qValues,d=b.length,c=0;d>c;c++)b[c]=0/0}function p(){var a,b,c,d,e,f=this._qData.qDataPages[0],g=this._qData.qMeasureInfo[0],h=g.qMax,i=g.qMin,j=f?f.qMatrix:void 0,k=j?j.length:0,l=-Number.MAX_VALUE,m=Number.MAX_VALUE;if(0===h||0===i){if(0===h&&0!==i){for(a=0;k>a;a++)b=j[a],c=b[0].qState,d="S"===c||"O"===c||"L"===c,d?(e=b[1].qNum,e>l&&(l=e)):o(b[1]);return void(g.qMax=l)}if(0!==h&&0===i){for(a=0;k>a;a++)b=j[a],c=b[0].qState,d="S"===c||"O"===c||"L"===c,d?(e=b[1].qNum,m>e&&(m=e)):o(b[1]);return void(g.qMin=m)}if(0===h&&0===i){for(a=0;k>a;a++)b=j[a],c=b[0].qState,d="S"===c||"O"===c||"L"===c,d?(e=b[1].qNum,e>l&&(l=e),m>e&&(m=e)):o(b[1]);g.qMax=l,g.qMin=m}}else for(a=0;k>a;a++)b=j[a],c=b[0].qState,d="S"===c||"O"===c||"L"===c,d||o(b[1])}function q(){var a=this,b=this._layerIndex,c=this._qData.qSize.qcy||500,d=[],e=this._dimensionChanged||this._geometryMeasureChanged;d.push(this._hasMeasure?{qTop:0,qLeft:0,qWidth:2,qHeight:c}:{qTop:0,qLeft:0,qWidth:1,qHeight:c}),e&&d.push({qTop:0,qLeft:2,qWidth:1,qHeight:c}),this._loadingGeometryData=e,this.backendApi.getData("GetHyperCubeData","/layers/"+b+"/qHyperCubeDef",d).then(function(b){a._loadingGeometryData=!1,a._rawGeoRegions={};var c,d,f,g,h,i,j,k=0,l=b?b.qDataPages:void 0;if(h=a._qMatrix=l?l instanceof Array&&l[0]?l[0].qMatrix:l.qMatrix:void 0,j=h?h.length:0,l&&l[0]&&(a._qData.qDataPages[0]=l[0],2===l[0].qArea.qWidth&&p.call(a)),e){for(i=l?l instanceof Array&&l[1]?l[1].qMatrix:l.qMatrix:void 0,l&&l[1]&&(a._qData.qDataPages[1]=l[1]),f=new Array(j),c=0;j>c;c++)g=h[c][0].qText,d=i[c][0].qText,f[c]=m(g,d),f[c].validateGeoPolygons(),k+=f[c].getNumPoints();n.call(a,f)}a._dataChanged=!0,a.fire("dataChanged"),e&&a._numPoints!==k&&(a._numPoints=k,a.fire("numPointsChanged",[a])),a.invalidateProperties("MapPolygon2Layer.getAllData"),a.invalidateDisplay("MapPolygon2Layer.getAllData")})}function r(){if(!this._layerData)return[];var a=this._layerData.qHyperCube,b=this._hasMeasure?[a.qMeasureInfo[0]]:[];return b}function s(a,b){var c,d,f,g,i,j,k,l,m,n=a?a.length:0,o=new Array(n);for(j=0;n>j;j++){for(c=a[j],d=c?c.length:0,m=new Array(d),k=0;d>k;k++){for(f=c[k],i=f?f.length:0,g=new Array(i),l=0;i>l;l++)g[l]=this._viewportProjection.project(f[l]);m[k]=new e(g)}o[j]=new h(m)}b.setGeoPolygons(o)}function t(a){return void 0===a||null===a||""===a}var u,v="#ddd",w=new c(v),x="#333",y="#333";return u=a.extend("MapPolygon2Layer",{init:function(){this._super.apply(this,arguments),this._geoRegionsData=new g,this.renderers={polygonlayer:this._renderer}},setLayerIndex:function(a){this._layerIndex=a,this._layerPath="/layers/"+this._layerIndex+"/qHyperCubeDef"},getDataType:function(){return"hyperCube"},setData:function(a,b){this._super(a,b),this._qData=this._layerData?this._layerData.qHyperCube:void 0,this._qDimensionInfo=this._qData?this._qData.qDimensionInfo:void 0,this._hasMeasure=void 0!==this._layerData.measureDef&&""!==this._layerData.measureDef.trim()||void 0!==this._layerData.measureLibraryId&&""!==this._layerData.measureLibraryId?!0:!1,this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this._adaptedMeasureInfo=r.call(this),this._numMeasures=this._hasMeasure?1:0,this.show&&(this._dimensionChanged=i.call(this),this._geometryMeasureChanged=j.call(this),q.apply(this))},hasValidData:function(){return this._super()&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qMeasureInfo&&this._qMeasureInfo[1]&&this._qMeasureInfo[1].qFallbackTitle},select:function(a,b){this.updateBackendApi(),this.backendApi.select2("SelectHyperCubeCells",this._layerPath,a,b)},getNumSelectedItems:function(){return this._numSelectedItems},getSelectedCacheItem:function(){return this._selectedCacheItem},getLayerOutputData:function(){if(this._layerData){var a,b,c,d;return a=this._layerData.qHyperCube,b=void 0!==this._layerData.measureDef&&""!==this._layerData.measureDef.trim()||void 0!==this._layerData.measureLibraryId&&""!==this._layerData.measureLibraryId?[a.qMeasureInfo[0]]:[],c={qcx:b.length+1,qcy:a.qSize.qcy},d={qDataPages:a.qDataPages,qDimensionInfo:a.qDimensionInfo,qMeasureInfo:b,qSize:c},{color:this._data.color,qSelectionInfo:this._data.qSelectionInfo,qHyperCube:d}}},getMeasureInfo:function(){return this._adaptedMeasureInfo},paint:function(){if(this._super(this._layoutMode,this._layerData),this._rawGeoRegions){if(!this.show||!this._viewportProjection||t(this._qMeasureInfo[1].qFallbackTitle))return this._regionsChanged=!1,this._viewportProjectionChanged=!1,void this.clear();if(void 0===this._nodes&&this._updateProperties(),0!==this._numItems){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=this._qMatrix,p=this._hasMeasure?0:-1,q=[],r=[],u=0,v=0;for(this._selectionByLayer=this._preselectionMode||this._qSelectionInfo&&this._qSelectionInfo.qInSelections||this._nodes.some(function(a){return a.cacheItem.selected}),a=0;a<this._numItems;a++)b=o[a],c=b[0],d=c.qState,e=c.qText,f=this._nodes[a],g=f.shapeWrapper,h=g.shape,i=this._geoRegionsData.getProjectedGeoRegionById(e),s.apply(this,[i,h]),j=f.cacheItem,k="S"===d||"O"===d||"L"===d,n=f.color,!k&&j.selected&&(m=this._hasMeasure?b[1].qNum:null,n=this._colorMap.getColor(c.qElemNumber,m,p,a)),g.fill=n.toRGBA(),this._selectionByLayer?(l=j.selected,g.stroke=l?y:x,g.strokeWidth=l?2:1):(l=k,g.stroke=x,g.strokeWidth=1),l?(g.opacity=1,r[v++]=f.shapeWrapper):(g.opacity=this._globalAlpha,q[u++]=f.shapeWrapper);this._rendererShapes=0===this._numItems?[]:q.concat(r),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._regionsChanged=!1,this._viewportProjectionChanged=!1,this.afterPaint()}}},_updateProperties:function(){if(this.show&&this._layerData&&this._dataChanged&&this._rawGeoRegions){var a,c,d,e,g,h,i,j,k,l,m,n,o,p,q=this._qMatrix,r=this._hasMeasure?0:-1,s=this._qMeasureInfo[0].qFallbackTitle;for(this._numItems=q?q.length:0,this._regionsChanged=!0,this._numSelectedItems=0,this._nodes=new Array(this._numItems),m=new Array(this._numItems),a=0;a<this._numItems;a++)c=q[a],d=c[0],e=c[1],g=d.qState,h=d.qText,i=d.qElemNumber||0,j=new f(void 0,h),j.rowIndex=a,l=new b([h],[],[],[],a,0,i),l.selected=!1,l.layerIndex=this._layerIndex,l.addShape("dataArea",j,!0),n="S"===g||"O"===g||"L"===g,o=this._hasMeasure?e.qNum:null,p=n?this._colorMap.getColor(d.qElemNumber,o,r,a):w,this._hasMeasure&&n&&l.addMeasure(s,o,e.qText),m[a]=l,k={type:"multipolygon",shape:j},this._nodes[a]={shapeWrapper:k,cacheItem:l,color:p},n&&(this._numSelectedItems++,this._selectedCacheItem=l);this.setSelectableShapes(m),this.fire("selectableShapesChanged"),this._dataChanged=!1}}})}),define("extensions.qliktech/map/map-polygon3-layer",["extensions.qliktech/map/map-layer","objects.views/selections/cache-item-base","general.utils/color","objects.utils/shapes/point","objects.utils/shapes/polygon","extensions.qliktech/map/geo-region","extensions.qliktech/map/geo-regions-data","extensions.qliktech/map/geo-polygon"],function(a,b,c,d,e,f,g,h){function i(){return this._dimensionTitle!==this._qData.qDimensionInfo.qFallbackTitle?(this._dimensionTitle=this._qData.qDimensionInfo.qFallbackTitle,!0):!1}function j(){var a=this._geoData.qMeasureInfo.length;return JSON.stringify(this._geometryMeasureInfo)!==JSON.stringify(this._geoData.qMeasureInfo[a-1])?(this._geometryMeasureInfo=this._geoData.qMeasureInfo[a-1],!0):this._rawGeoRegions||this._loadingGeometryData?!1:!0}function k(a){var b,c=a?a.length:0;for(b=0;c>b;b++)a[b]=new d(a[b][0],a[b][1]);
return new e(a)}function l(a){var b,c=a?a.length:0,d=new Array(c);for(b=0;c>b;b++)d[b]=k(a[b]);return new h(d)}function m(a,b){var c,d,e="-"===b?[]:JSON.parse(b),g=e.length;for(c=0;g>c;c++)e[c]=l(e[c]);return d=new f(e,a)}function n(a){this._rawGeoRegions=a,this._geoRegionsData.setGeoRegions(a),"$mercator"!==this._geoData.qMeasureInfo[0].projection?(this._geoRegionsData.setProjection(this._viewportProjection.getMercatorProjection()),this._layerBounds=this._geoRegionsData.calculateProjectedBounds()):this._layerBounds=this._geoRegionsData.calculateBounds(),this.fire("boundsChanged",[this]),this._regionsChanged=!0}function o(){var a=this,b=this._layerIndex,c=this._geoData.qSize.qcy||500,d=[{qTop:0,qLeft:0,qWidth:2,qHeight:c}];this._loadingGeometryData=!0,this.backendApi.getData("GetHyperCubeData","/layers/"+b+"/geodata/qHyperCubeDef",d).then(function(b){a._loadingGeometryData=!1,a._rawGeoRegions={};var c,d,e,f,g,h=0,i=b?b.qDataPages:void 0,j=i?i instanceof Array&&i[0]?i[0].qMatrix:i.qMatrix:void 0;for(g=j?j.length:0,a._qMatrix2=j,a._numRegions=g,a._geometryDimensionIdx=1,e=new Array(g),c=0;g>c;c++)f=j[c][0].qText,d=j[c][a._geometryDimensionIdx].qText,e[c]=m(f,d),e[c].validateGeoPolygons(),h+=e[c].getNumPoints();n.call(a,e),a._dataChanged=!0,a.fire("dataChanged"),a._numPoints!==h&&(a._numPoints=h,a.fire("numPointsChanged",[a])),a.invalidateProperties("MapPolygon3Layer.setGeoRegionsData"),a.invalidateDisplay("MapPolygon3Layer.setGeoRegionsData")})}function p(a,b){var c,d,f,g,i,j,k,l,m,n=a?a.length:0,o=new Array(n);for(j=0;n>j;j++){for(c=a[j],d=c?c.length:0,m=new Array(d),k=0;d>k;k++){for(f=c[k],i=f?f.length:0,g=new Array(i),l=0;i>l;l++)g[l]=this._viewportProjection.project(f[l]);m[k]=new e(g)}o[j]=new h(m)}b.setGeoPolygons(o)}function q(a){return void 0===a||null===a||""===a}var r,s="#ddd",t=new c(s),u="#333",v="#333";return r=a.extend("MapPolygon3Layer",{init:function(){this._super.apply(this,arguments),this._geoRegionsData=new g,this.renderers={polygonlayer:this._renderer},this._numRegions=0},setLayerIndex:function(a){this._layerIndex=a,this._layerPath="/layers/"+this._layerIndex+"/geodata/qHyperCubeDef"},getDataType:function(){return"hyperCube"},setData:function(a,b){this._super(a,b),this._qData=this._layerData?this._layerData.qHyperCube:void 0,this._geoData=this._layerData?this._layerData.geodata.qHyperCube:void 0,this._qMatrix=this._qData&&this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._numItems=this._qMatrix?this._qMatrix.length:0,this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this._hasMeasure=this._qMeasureInfo&&this._qMeasureInfo.length>0,this._geoDataHeight=this._geoData&&this._geoData.qSize?this._geoData.qSize.qcy:0,this.show&&(this._geoDataHeight!==this._numRegions||i.call(this)||j.call(this))?o.call(this):(this._dataChanged=!0,this.fire("dataChanged"),this.invalidateProperties("MapPolygon3Layer.setData"))},hasValidData:function(){return this._super()&&this._layerData},getNumSelectedItems:function(){return this._numSelectedItems},getSelectedCacheItem:function(){return this._selectedCacheItem},paint:function(){if(this._super(this._layoutMode,this._layerData),this._rawGeoRegions){if(!this.show||!this._viewportProjection||!this._geoData||!this._geoData.qMeasureInfo||0===this._geoData.qMeasureInfo.length||q(this._geoData.qMeasureInfo[0].qFallbackTitle))return this._regionsChanged=!1,this._viewportProjectionChanged=!1,void this.clear();if(void 0===this._nodes&&this._updateProperties(),0!==this._numRegions){var a,b,c,d,e,f,g,h,i,j,k,l,m=this._qMatrix2,n=this._hasMeasure?0:-1,o=[],r=[],s=0,t=0;for(this._selectionByLayer=this._preselectionMode||this._qSelectionInfo&&this._qSelectionInfo.qInSelections||this._nodes.some(function(a){return a.cacheItem.selected}),a=0;a<this._numRegions;a++)b=m[a],c=b[0],d=c.qText,e=this._nodes[a],f=e.shapeWrapper,g=f.shape,h=this._geoRegionsData.getProjectedGeoRegionById(d),p.apply(this,[h,g]),i=e.cacheItem,j=-1!==e.index,l=e.color,!j&&i.selected&&(l=this._colorMap.getColor(c.qElemNumber,0/0,n,a)),f.fill=l.toRGBA(),this._selectionByLayer?(k=i.selected,f.stroke=k?v:u,f.strokeWidth=k?2:1):(k=j,f.stroke=u,f.strokeWidth=1),k?(f.opacity=1,r[t++]=f):(f.opacity=this._globalAlpha,o[s++]=f);this._rendererShapes=0===this._numItems?[]:o.concat(r),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._regionsChanged=!1,this._viewportProjectionChanged=!1,this.afterPaint()}}},getSnapshotLayerData:function(a){var b=this._geoData.qSize.qcy||500;return this.backendApi.getData("GetHyperCubeData","/layers/"+this._layerIndex+"/geodata/qHyperCubeDef",[{qTop:0,qLeft:0,qWidth:2,qHeight:b}]).then(function(b){a.geodata.qHyperCube.qDataPages=b.qDataPages})},_updateProperties:function(){if(this.show&&this._layerData&&this._dataChanged&&this._rawGeoRegions){var a,c,d,e,g,h,i,j,k,l,m,n,o=this._qMatrix2,p=this._hasMeasure?0:-1,q=this._hasMeasure?this._qMeasureInfo[0].qFallbackTitle:"";for(this._regionsChanged=!0,this._numSelectedItems=0,this._nodes=new Array(this._numRegions),this._nodeMap={},l=new Array(this._numRegions),a=0;a<this._numRegions;a++)c=o[a],d=c[0],g=d.qText,h=d.qElemNumber||0,i=new f(void 0,g),i.rowIndex=a,k=new b([g],[],[],[],a,0,h),k.selected=!1,k.layerIndex=this._layerIndex,k.addShape("dataArea",i,!0),l[a]=k,j={type:"multipolygon",shape:i},this._nodeMap[g]=this._nodes[a]={shapeWrapper:j,cacheItem:k,color:t,index:-1};for(o=this._qMatrix,a=0;a<this._numItems;a++)c=o[a],d=c[0],e=c[1],g=d.qText,n=this._nodeMap[g],n&&(k=n.cacheItem,m=this._hasMeasure?e.qNum:null,n.color=this._colorMap.getColor(d.qElemNumber,m,p,a),this._hasMeasure&&k.addMeasure(q,m,e.qText),n.index=a,this._selectedCacheItem=k);this._numSelectedItems=this._numItems,this.setSelectableShapes(l),this.fire("selectableShapesChanged"),this._dataChanged=!1}}})}),define("extensions.qliktech/map/map-glyph-layer",["extensions.qliktech/map/map-layer","extensions.qliktech/scatterplot/scatter-helper","objects.views/selections/cache-item-combo","objects.utils/shapes/rect"],function(a,b,c,d){function e(){var a,b,c,e,f,g=Number.MAX_VALUE,h=Number.MAX_VALUE,i=-Number.MAX_VALUE,j=-Number.MAX_VALUE;for(a=0;a<this._numItems;a++)b=this._nodes[a].shapeWrapper.shape,c=b.position,!c||isNaN(c.x)||isNaN(c.y)||(g=Math.min(g,c.x),h=Math.min(h,c.y),i=Math.max(i,c.x),j=Math.max(j,c.y));return g===Number.MAX_VALUE||h===Number.MAX_VALUE||i===-Number.MAX_VALUE||j===-Number.MAX_VALUE?void 0:(e=i-g,f=j-h,new d(g,h,e,f))}function f(){var a,c,d,e,f,g=3,h=1;for(a=0;a<this._numItems;a++)if(d=this._nodes[a].shapeWrapper.shape)if(0===d.type)d.position?(e=this._viewportProjection.project(d.position),d.setPosition(e.x,e.y)):d.setPosition(0/0,0/0);else if(d.position){if(e=this._viewportProjection.project(d.position),f=d.points,!f||13!==f.length)for(f=new Array(13),c=0;13>c;c++)f[c]={};f=b.updateCross(f,e.x,e.y,g,h),d.set(f)}else d.set([])}function g(){this._hasMeasure?void 0===this._layerData.autoMinMax||this._layerData.autoMinMax===!0?(this._qMin=this._qMeasureInfo[0].qMin,this._qMax=this._qMeasureInfo[0].qMax):(this._qMin=this._layerData.customMin,this._qMax=this._layerData.customMax):(this._qMin=void 0,this._qMax=void 0)}function h(){return isNaN(this._qMin)||void 0===this._qMin||null===this._qMin?!1:isNaN(this._qMax)||void 0===this._qMax||null===this._qMax?!1:this._qMax<this._qMin?!1:!0}var i,j="#333";return i=a.extend("MapPointLayer",{init:function(){this._super.apply(this,arguments),this.renderers={pointlayer:this._renderer},this._layerBounds=void 0,this._useSize=!0},setLayerIndex:function(a){this._layerIndex=a,this._layerPath="/layers/"+this._layerIndex+"/qHyperCubeDef"},getDataType:function(){return"hyperCube"},setData:function(a,b){this._super(a,b),this._qData=this._layerData?this._layerData.qHyperCube:void 0,this._qMatrix=this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._qDimensionInfo=this._qData?this._qData.qDimensionInfo:void 0,this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this._numMeasures=this._qMeasureInfo?this._qMeasureInfo.length:0,this._hasMeasure=this._numMeasures>0&&this._qMeasureInfo[0].qFallbackTitle?!0:!1,g.call(this),this._isValidMinMax=h.call(this),this._qRange=this._qMax-this._qMin,this._numItems=this._qMatrix?this._qMatrix.length:0,this._needUpdateProperties=!0,this._needPaint=!0,this._maxDotSize=this._hasMeasure&&this._useSize?this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[1]?this._layerData.rangeBubbleSizes[1]:32:this._layerData.bubbleSizes?this._layerData.bubbleSizes:8,this.fire("dataChanged"),this.invalidateProperties("MapPointLayer.setData")},hasValidData:function(){return this._super()&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle},getNumSelectedItems:function(){return this._numItems},getLayerBounds:function(){var a,b,c,d,e;return a=this._viewportProjection.getSize(),this._layerBounds?(this._layerBounds2=this._layerBounds.clone(),a&&(e=2*(this._maxDotSize+1),c=a.x-e,d=a.y-e,b=Math.min(c/this._layerBounds.width,d/this._layerBounds.height),c=b*this._layerBounds.width,d=b*this._layerBounds2.height,b=Math.min(a.x/c,a.y/d),this._layerBounds2.scale(b)),this._layerBounds2):this._layerBounds},paint:function(){if(this._super(this._layoutMode,this._data),!(this.show&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle&&this._viewportProjection&&0!==this._qMatrix.length&&void 0!==this._qMatrix[0][1]))return this._glyphsChanged=!1,this._viewportProjectionChanged=!1,this._needPaint=!1,void this.clear();if(void 0===this._nodes&&this._updateProperties(),void 0!==this._nodes){var a,b,c,d,e,g,h,i,k,l=[],m=[],n=0,o=0;for((this._glyphsChanged||this._viewportProjectionChanged)&&f.call(this),a=0;a<this._numItems;a++)b=this._nodes[a],i=b.shapeWrapper,k=i.shape,k&&k.position&&(c=b.color,d=b.cacheItem.selected,d?(e=j,g=2,h=1,m[o++]=i):(e=c.createShiftedColor().toRGBA(),g=1,h=this._globalAlpha,l[n++]=i),i.stroke=e,i.strokeWidth=g,i.opacity=h);this._rendererShapes=0===this._numItems?[]:l.concat(m),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._glyphsChanged=!1,this._viewportProjectionChanged=!1,this._needPaint=!1,this.afterPaint()}},setRect:function(a,b,c,d){this._super(a,b,c,d),!this._layerBounds||0===this._layerBounds.width&&0===this._layerBounds.height||this.fire("boundsChanged",[this])},getSnapshotLayerData:function(a){var b=this._qData.qSize.qcy||500;return this.backendApi.getData("GetHyperCubeData","/layers/"+this._layerIndex+"/qHyperCubeDef",[{qTop:0,qLeft:0,qWidth:3,qHeight:b}]).then(function(b){a.qHyperCube.qDataPages=b.qDataPages})},_updateProperties:function(){if(this.show&&this._needUpdateProperties&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle){var a,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=this._qMatrix,x=this._hasMeasure?0:-1,y="polygon",z="circle";for(t=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[0]?this._layerData.rangeBubbleSizes[0]:2,u=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[1]?this._layerData.rangeBubbleSizes[1]:32,s=this._layerData.bubbleSizes?this._layerData.bubbleSizes:8,this._useSize=this._layerData.useSize,this._glyphsChanged=!0,this._nodes=new Array(this._numItems),l=[],m={},n=0,this._geoDataIsProjected=this._qDimensionInfo&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qTags&&this._qDimensionInfo[1].qTags.indexOf("$mercator")>-1,q=this._viewportProjection.getMercatorProjection(),v=this._hasMeasure&&this._useSize,a=0;a<this._numItems;a++)f=w[a][0].qText,g=w[a][0].qElemNumber||0,h=w[a][2]?w[a][2].qNum:void 0,v?this._isValidMinMax?(r=b.getDotRadius(h,this._qMin,this._qMax,t,u),isNaN(r)?(i=b.createShape(y),i.type=1,j=y):(i=b.createShape(z,[0,0,r,0]),i.type=0,j=z)):(i=b.createShape(y),i.type=1,j=y):(i=b.createShape(z,[0,0,s,0]),i.type=0,j=z),"-"===w[a][1].qText?i.position=void 0:(d=JSON.parse(w[a][1].qText),i.position=this._geoDataIsProjected?{x:d[0],y:d[1]}:q.project({x:d[0],y:d[1]})),i.rowIndex=a,m[f]?k=m[f].cacheItem:(k=new c([f],[],[],[],a,0,g),k.selected=!1,k.layerIndex=this._layerIndex,m[f]={cacheItem:k,numShapes:0},l[n++]=k),k.addShape("dataArea",i,!0,[m[f].numShapes]),m[f].numShapes++,this._hasMeasure&&k.addMeasure(this._qMeasureInfo[0].qFallbackTitle,w[a][2].qNum,w[a][2].qText),p=this._colorMap.getColor([w[a][0].qElemNumber,w[a][1].qElemNumber],h,x,a),o={type:j,fill:p.toRGBA(),shape:i},this._nodes[a]={shapeWrapper:o,cacheItem:k,color:p};this.setSelectableShapes(l),this.fire("selectableShapesChanged"),this._dimensionTitle=this._qDimensionInfo[0].qFallbackTitle,this._needUpdateProperties=!1,this._layerBounds=e.call(this),!this._layerBounds||0===this._layerBounds.width&&0===this._layerBounds.height||this.fire("boundsChanged",[this])}}})});var OpenLayers={VERSION_NUMBER:"Release 2.13.1",singleFile:!0,_getScriptLocation:function(){for(var a,b,c=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),d=document.getElementsByTagName("script"),e="",f=0,g=d.length;g>f;f++)if(a=d[f].getAttribute("src"),a&&(b=a.match(c))){e=b[1];break}return function(){return e}}(),ImgPath:""};OpenLayers.Class=function(){var a=arguments.length,b=arguments[0],c=arguments[a-1],d="function"==typeof c.initialize?c.initialize:function(){b.prototype.initialize.apply(this,arguments)};if(a>1){var e=[d,b].concat(Array.prototype.slice.call(arguments).slice(1,a-1),c);OpenLayers.inherit.apply(null,e)}else d.prototype=c;return d},OpenLayers.inherit=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c;var d,e,f;for(d=2,e=arguments.length;e>d;d++)f=arguments[d],"function"==typeof f&&(f=f.prototype),OpenLayers.Util.extend(a.prototype,f)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(a,b){if(a=a||{},b){for(var c in b){var d=b[c];void 0!==d&&(a[c]=d)}var e="function"==typeof window.Event&&b instanceof window.Event;!e&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&(a.toString=b.toString)}return a},OpenLayers.String={startsWith:function(a,b){return 0==a.indexOf(b)},contains:function(a,b){return-1!=a.indexOf(b)},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(a){for(var b=a.split("-"),c=b[0],d=1,e=b.length;e>d;d++){var f=b[d];c+=f.charAt(0).toUpperCase()+f.substring(1)}return c},format:function(a,b,c){b||(b=window);var d=function(a,d){for(var e,f=d.split(/\.+/),g=0;g<f.length&&(0==g&&(e=b),void 0!==e);g++)e=e[f[g]];return"function"==typeof e&&(e=c?e.apply(null,c):e()),"undefined"==typeof e?"undefined":e};return a.replace(OpenLayers.String.tokenRegEx,d)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a)},numericIf:function(a,b){var c=a;return b===!0&&null!=a&&a.replace&&(a=a.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(a)?parseFloat(a):c}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,b){var c=0;return b>0&&(c=parseFloat(a.toPrecision(b))),c},format:function(a,b,c,d){b="undefined"!=typeof b?b:0,c="undefined"!=typeof c?c:OpenLayers.Number.thousandsSeparator,d="undefined"!=typeof d?d:OpenLayers.Number.decimalSeparator,null!=b&&(a=parseFloat(a.toFixed(b)));var e=a.toString().split(".");1==e.length&&null==b&&(b=0);var f=e[0];if(c)for(var g=/(-?[0-9]+)([0-9]{3})/;g.test(f);)f=f.replace(g,"$1"+c+"$2");var h;if(0==b)h=f;else{var i=e.length>1?e[1]:"0";null!=b&&(i+=new Array(b-i.length+1).join("0")),h=f+d+i}return h},zeroPad:function(a,b,c){for(var d=a.toString(c||10);d.length<b;)d="0"+d;return d}},OpenLayers.Function={bind:function(a,b){var c=Array.prototype.slice.apply(arguments,[2]);return function(){var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)}},bindAsEventListener:function(a,b){return function(c){return a.call(b,c||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(a,b,c){var d=[];if(Array.prototype.filter)d=a.filter(b,c);else{var e=a.length;if("function"!=typeof b)throw new TypeError;for(var f=0;e>f;f++)if(f in a){var g=a[f];b.call(c,g,f,a)&&d.push(g)}}return d}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(a,b,c,d){OpenLayers.Util.isArray(a)&&(d=a[3],c=a[2],b=a[1],a=a[0]),null!=a&&(this.left=OpenLayers.Util.toFloat(a)),null!=b&&(this.bottom=OpenLayers.Util.toFloat(b)),null!=c&&(this.right=OpenLayers.Util.toFloat(c)),null!=d&&(this.top=OpenLayers.Util.toFloat(d))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(a){var b=!1;return null!=a&&(b=this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom),b},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(a){return a===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(a,b){null==a&&(a=6);var c=Math.pow(10,a),d=Math.round(this.left*c)/c,e=Math.round(this.bottom*c)/c,f=Math.round(this.right*c)/c,g=Math.round(this.top*c)/c;return b===!0?e+","+d+","+g+","+f:d+","+e+","+f+","+g},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(a,b){null==b&&(b=this.getCenterLonLat());var c,d;"OpenLayers.LonLat"==b.CLASS_NAME?(c=b.lon,d=b.lat):(c=b.x,d=b.y);var e=(this.left-c)*a+c,f=(this.bottom-d)*a+d,g=(this.right-c)*a+c,h=(this.top-d)*a+d;return new OpenLayers.Bounds(e,f,g,h)},add:function(a,b){if(null==a||null==b)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+a,this.bottom+b,this.right+a,this.top+b)},extend:function(a){if(a)switch(a.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(a.lon,a.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(a.x,a.y);break;case"OpenLayers.Bounds":this.centerLonLat=null,(null==this.left||a.left<this.left)&&(this.left=a.left),(null==this.bottom||a.bottom<this.bottom)&&(this.bottom=a.bottom),(null==this.right||a.right>this.right)&&(this.right=a.right),(null==this.top||a.top>this.top)&&(this.top=a.top)}},extendXY:function(a,b){this.centerLonLat=null,(null==this.left||a<this.left)&&(this.left=a),(null==this.bottom||b<this.bottom)&&(this.bottom=b),(null==this.right||a>this.right)&&(this.right=a),(null==this.top||b>this.top)&&(this.top=b)},containsLonLat:function(a,b){"boolean"==typeof b&&(b={inclusive:b}),b=b||{};var c=this.contains(a.lon,a.lat,b.inclusive),d=b.worldBounds;if(d&&!c){var e=d.getWidth(),f=(d.left+d.right)/2,g=Math.round((a.lon-f)/e);c=this.containsLonLat({lon:a.lon-g*e,lat:a.lat},{inclusive:b.inclusive})}return c},containsPixel:function(a,b){return this.contains(a.x,a.y,b)},contains:function(a,b,c){if(null==c&&(c=!0),null==a||null==b)return!1;a=OpenLayers.Util.toFloat(a),b=OpenLayers.Util.toFloat(b);var d=!1;return d=c?a>=this.left&&a<=this.right&&b>=this.bottom&&b<=this.top:a>this.left&&a<this.right&&b>this.bottom&&b<this.top},intersectsBounds:function(a,b){if("boolean"==typeof b&&(b={inclusive:b}),b=b||{},b.worldBounds){var c=this.wrapDateLine(b.worldBounds);a=a.wrapDateLine(b.worldBounds)}else c=this;null==b.inclusive&&(b.inclusive=!0);var d=!1,e=c.left==a.right||c.right==a.left||c.top==a.bottom||c.bottom==a.top;if(b.inclusive||!e){var f=a.bottom>=c.bottom&&a.bottom<=c.top||c.bottom>=a.bottom&&c.bottom<=a.top,g=a.top>=c.bottom&&a.top<=c.top||c.top>a.bottom&&c.top<a.top,h=a.left>=c.left&&a.left<=c.right||c.left>=a.left&&c.left<=a.right,i=a.right>=c.left&&a.right<=c.right||c.right>=a.left&&c.right<=a.right;d=(f||g)&&(h||i)}if(b.worldBounds&&!d){var j=b.worldBounds,k=j.getWidth(),l=!j.containsBounds(c),m=!j.containsBounds(a);l&&!m?(a=a.add(-k,0),d=c.intersectsBounds(a,{inclusive:b.inclusive})):m&&!l&&(c=c.add(-k,0),d=a.intersectsBounds(c,{inclusive:b.inclusive}))}return d},containsBounds:function(a,b,c){null==b&&(b=!1),null==c&&(c=!0);var d=this.contains(a.left,a.bottom,c),e=this.contains(a.right,a.bottom,c),f=this.contains(a.left,a.top,c),g=this.contains(a.right,a.top,c);return b?d||e||f||g:d&&e&&f&&g},determineQuadrant:function(a){var b="",c=this.getCenterLonLat();return b+=a.lat<c.lat?"b":"t",b+=a.lon<c.lon?"l":"r"},transform:function(a,b){this.centerLonLat=null;var c=OpenLayers.Projection.transform({x:this.left,y:this.bottom},a,b),d=OpenLayers.Projection.transform({x:this.right,y:this.bottom},a,b),e=OpenLayers.Projection.transform({x:this.left,y:this.top},a,b),f=OpenLayers.Projection.transform({x:this.right,y:this.top},a,b);return this.left=Math.min(c.x,e.x),this.bottom=Math.min(c.y,d.y),this.right=Math.max(d.x,f.x),this.top=Math.max(e.y,f.y),this},wrapDateLine:function(a,b){b=b||{};var c=b.leftTolerance||0,d=b.rightTolerance||0,e=this.clone();if(a){for(var f=a.getWidth();e.left<a.left&&e.right-d<=a.left;)e=e.add(f,0);for(;e.left+c>=a.right&&e.right>a.right;)e=e.add(-f,0);var g=e.left+c;g<a.right&&g>a.left&&e.right-d>a.right&&(e=e.add(-f,0))}return e},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(a,b){var c=a.split(",");return OpenLayers.Bounds.fromArray(c,b)},OpenLayers.Bounds.fromArray=function(a,b){return b===!0?new OpenLayers.Bounds(a[1],a[0],a[3],a[2]):new OpenLayers.Bounds(a[0],a[1],a[2],a[3])},OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(a){var b="";return b+="t"==a.charAt(0)?"b":"t",b+="l"==a.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(a){return"none"!=OpenLayers.Util.getElement(a).style.display},toggle:function(){for(var a=0,b=arguments.length;b>a;a++){var c=OpenLayers.Util.getElement(arguments[a]),d=OpenLayers.Element.visible(c)?"none":"";c.style.display=d}},remove:function(a){a=OpenLayers.Util.getElement(a),a.parentNode.removeChild(a)},getHeight:function(a){return a=OpenLayers.Util.getElement(a),a.offsetHeight},hasClass:function(a,b){var c=a.className;return!!c&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},addClass:function(a,b){return OpenLayers.Element.hasClass(a,b)||(a.className+=(a.className?" ":"")+b),a},removeClass:function(a,b){var c=a.className;return c&&(a.className=OpenLayers.String.trim(c.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," "))),a},toggleClass:function(a,b){return OpenLayers.Element.hasClass(a,b)?OpenLayers.Element.removeClass(a,b):OpenLayers.Element.addClass(a,b),a},getStyle:function(a,b){a=OpenLayers.Util.getElement(a);var c=null;if(a&&a.style){if(c=a.style[OpenLayers.String.camelize(b)],!c)if(document.defaultView&&document.defaultView.getComputedStyle){var d=document.defaultView.getComputedStyle(a,null);c=d?d.getPropertyValue(b):null}else a.currentStyle&&(c=a.currentStyle[OpenLayers.String.camelize(b)]);var e=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(e,b)&&"static"==OpenLayers.Element.getStyle(a,"position")&&(c="auto")}return"auto"==c?null:c}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(a,b){OpenLayers.Util.isArray(a)&&(b=a[1],a=a[0]),this.lon=OpenLayers.Util.toFloat(a),this.lat=OpenLayers.Util.toFloat(b)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(a,b){if(null==a||null==b)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(a),this.lat+OpenLayers.Util.toFloat(b))},equals:function(a){var b=!1;return null!=a&&(b=this.lon==a.lon&&this.lat==a.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(a.lon)&&isNaN(a.lat)),b},transform:function(a,b){var c=OpenLayers.Projection.transform({x:this.lon,y:this.lat},a,b);return this.lon=c.x,this.lat=c.y,this},wrapDateLine:function(a){var b=this.clone();if(a){for(;b.lon<a.left;)b.lon+=a.getWidth();for(;b.lon>a.right;)b.lon-=a.getWidth()}return b},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(a){var b=a.split(",");return new OpenLayers.LonLat(b[0],b[1])},OpenLayers.LonLat.fromArray=function(a){var b=OpenLayers.Util.isArray(a),c=b&&a[0],d=b&&a[1];return new OpenLayers.LonLat(c,d)},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a),this.y=parseFloat(b)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(a){var b=!1;return null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)),b},distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},add:function(a,b){if(null==a||null==b)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+a,this.y+b)},offset:function(a){var b=this.clone();return a&&(b=this.add(a.x,a.y)),b},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a),this.h=parseFloat(b)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(a){var b=!1;return null!=a&&(b=this.w==a.w&&this.h==a.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(a.w)&&isNaN(a.h)),b},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;c>b;++b)if(-1!=a[b].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(a){var b;a||(a="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var c=a.split("-");if(c[0]=c[0].toLowerCase(),"object"==typeof OpenLayers.Lang[c[0]]&&(b=c[0]),c[1]){var d=c[0]+"-"+c[1].toUpperCase();"object"==typeof OpenLayers.Lang[d]&&(b=d)}b||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+c.join("-")+" dictionary, falling back to default language"),b=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=b},translate:function(a,b){var c=OpenLayers.Lang[OpenLayers.Lang.getCode()],d=c&&c[a];return d||(d=a),b&&(d=OpenLayers.String.format(d,b)),d}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var a=[],b=0,c=arguments.length;c>b;b++){var d=arguments[b];if("string"==typeof d&&(d=document.getElementById(d)),1==arguments.length)return d;a.push(d)}return a},OpenLayers.Util.isElement=function(a){return!(!a||1!==a.nodeType)},OpenLayers.Util.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},OpenLayers.Util.removeItem=function(a,b){for(var c=a.length-1;c>=0;c--)a[c]==b&&a.splice(c,1);return a},OpenLayers.Util.indexOf=function(a,b){if("function"==typeof a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;c++)if(a[c]==b)return c;return-1},OpenLayers.Util.dotless=/\./g,OpenLayers.Util.modifyDOMElement=function(a,b,c,d,e,f,g,h){b&&(a.id=b.replace(OpenLayers.Util.dotless,"_")),c&&(a.style.left=c.x+"px",a.style.top=c.y+"px"),d&&(a.style.width=d.w+"px",a.style.height=d.h+"px"),e&&(a.style.position=e),f&&(a.style.border=f),g&&(a.style.overflow=g),parseFloat(h)>=0&&parseFloat(h)<1?(a.style.filter="alpha(opacity="+100*h+")",a.style.opacity=h):1==parseFloat(h)&&(a.style.filter="",a.style.opacity="")},OpenLayers.Util.createDiv=function(a,b,c,d,e,f,g,h){var i=document.createElement("div");return d&&(i.style.backgroundImage="url("+d+")"),a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv")),e||(e="absolute"),OpenLayers.Util.modifyDOMElement(i,a,b,c,e,f,g,h),i},OpenLayers.Util.createImage=function(a,b,c,d,e,f,g,h){function i(){j.style.display="",OpenLayers.Event.stopObservingElement(j)}var j=document.createElement("img");return a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv")),e||(e="relative"),OpenLayers.Util.modifyDOMElement(j,a,b,c,e,f,null,g),h&&(j.style.display="none",OpenLayers.Event.observe(j,"load",i),OpenLayers.Event.observe(j,"error",i)),j.style.alt=a,j.galleryImg="no",d&&(j.src=d),j},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var a=navigator.appVersion.split("MSIE"),b=parseFloat(a[1]),c=!1;try{c=!!document.body.filters}catch(d){}OpenLayers.Util.alphaHackNeeded=c&&b>=5.5&&7>b}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){OpenLayers.Util.modifyDOMElement(a,b,c,d,f,null,null,i);var j=a.childNodes[0];e&&(j.src=e),OpenLayers.Util.modifyDOMElement(j,a.id+"_innerImage",null,d,"relative",g),OpenLayers.Util.alphaHack()&&("none"!=a.style.display&&(a.style.display="inline-block"),null==h&&(h="scale"),a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+j.src+"', sizingMethod='"+h+"')",parseFloat(a.style.opacity)>=0&&parseFloat(a.style.opacity)<1&&(a.style.filter+=" alpha(opacity="+100*a.style.opacity+")"),j.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){var j=OpenLayers.Util.createDiv(),k=OpenLayers.Util.createImage(null,null,null,null,null,null,null,i);return k.className="olAlphaImg",j.appendChild(k),OpenLayers.Util.modifyAlphaImageDiv(j,a,b,c,d,e,f,g,h),j},OpenLayers.Util.upperCaseObject=function(a){var b={};for(var c in a)b[c.toUpperCase()]=a[c];return b},OpenLayers.Util.applyDefaults=function(a,b){a=a||{};var c="function"==typeof window.Event&&b instanceof window.Event;for(var d in b)(void 0===a[d]||!c&&b.hasOwnProperty&&b.hasOwnProperty(d)&&!a.hasOwnProperty(d))&&(a[d]=b[d]);return!c&&b&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&!a.hasOwnProperty("toString")&&(a.toString=b.toString),a},OpenLayers.Util.getParameterString=function(a){var b=[];for(var c in a){var d=a[c];if(null!=d&&"function"!=typeof d){var e;if("object"==typeof d&&d.constructor==Array){for(var f,g=[],h=0,i=d.length;i>h;h++)f=d[h],g.push(encodeURIComponent(null===f||void 0===f?"":f));e=g.join(",")}else e=encodeURIComponent(d);b.push(encodeURIComponent(c)+"="+e)}}return b.join("&")},OpenLayers.Util.urlAppend=function(a,b){var c=a;if(b){var d=(a+" ").split(/[?&]/);c+=" "===d.pop()?b:d.length?"&"+b:"?"+b}return c},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(a){return OpenLayers.Util.getImagesLocation()+a},OpenLayers.Util.Try=function(){for(var a=null,b=0,c=arguments.length;c>b;b++){var d=arguments[b];try{a=d();break}catch(e){}}return a},OpenLayers.Util.getXmlNodeValue=function(a){var b=null;return OpenLayers.Util.Try(function(){b=a.text,b||(b=a.textContent),b||(b=a.firstChild.nodeValue)},function(){b=a.textContent}),b},OpenLayers.Util.mouseLeft=function(a,b){for(var c=a.relatedTarget?a.relatedTarget:a.toElement;c!=b&&null!=c;)c=c.parentNode;
return c!=b},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(a,b){return null==b&&(b=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof a&&(a=parseFloat(a)),0===b?a:parseFloat(a.toPrecision(b))},OpenLayers.Util.rad=function(a){return a*Math.PI/180},OpenLayers.Util.deg=function(a){return 180*a/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(a,b){for(var c=OpenLayers.Util.VincentyConstants,d=c.a,e=c.b,f=c.f,g=OpenLayers.Util.rad(b.lon-a.lon),h=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(a.lat))),i=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(b.lat))),j=Math.sin(h),k=Math.cos(h),l=Math.sin(i),m=Math.cos(i),n=g,o=2*Math.PI,p=20;Math.abs(n-o)>1e-12&&--p>0;){var q=Math.sin(n),r=Math.cos(n),s=Math.sqrt(m*q*m*q+(k*l-j*m*r)*(k*l-j*m*r));if(0==s)return 0;var t=j*l+k*m*r,u=Math.atan2(s,t),v=Math.asin(k*m*q/s),w=Math.cos(v)*Math.cos(v),x=t-2*j*l/w,y=f/16*w*(4+f*(4-3*w));o=n,n=g+(1-y)*f*Math.sin(v)*(u+y*s*(x+y*t*(-1+2*x*x)))}if(0==p)return 0/0;var z=w*(d*d-e*e)/(e*e),A=1+z/16384*(4096+z*(-768+z*(320-175*z))),B=z/1024*(256+z*(-128+z*(74-47*z))),C=B*s*(x+B/4*(t*(-1+2*x*x)-B/6*x*(-3+4*s*s)*(-3+4*x*x))),D=e*A*(u-C),E=D.toFixed(3)/1e3;return E},OpenLayers.Util.destinationVincenty=function(a,b,c){for(var d=OpenLayers.Util,e=d.VincentyConstants,f=e.a,g=e.b,h=e.f,i=a.lon,j=a.lat,k=c,l=d.rad(b),m=Math.sin(l),n=Math.cos(l),o=(1-h)*Math.tan(d.rad(j)),p=1/Math.sqrt(1+o*o),q=o*p,r=Math.atan2(o,n),s=p*m,t=1-s*s,u=t*(f*f-g*g)/(g*g),v=1+u/16384*(4096+u*(-768+u*(320-175*u))),w=u/1024*(256+u*(-128+u*(74-47*u))),x=k/(g*v),y=2*Math.PI;Math.abs(x-y)>1e-12;){var z=Math.cos(2*r+x),A=Math.sin(x),B=Math.cos(x),C=w*A*(z+w/4*(B*(-1+2*z*z)-w/6*z*(-3+4*A*A)*(-3+4*z*z)));y=x,x=k/(g*v)+C}{var D=q*A-p*B*n,E=Math.atan2(q*B+p*A*n,(1-h)*Math.sqrt(s*s+D*D)),F=Math.atan2(A*m,p*B-q*A*n),G=h/16*t*(4+h*(4-3*t)),H=F-(1-G)*h*s*(x+G*A*(z+G*B*(-1+2*z*z)));Math.atan2(s,-D)}return new OpenLayers.LonLat(i+d.deg(H),d.deg(E))},OpenLayers.Util.getParameters=function(a,b){b=b||{},a=null===a||void 0===a?window.location.href:a;var c="";if(OpenLayers.String.contains(a,"?")){var d=a.indexOf("?")+1,e=OpenLayers.String.contains(a,"#")?a.indexOf("#"):a.length;c=a.substring(d,e)}for(var f={},g=c.split(/[&;]/),h=0,i=g.length;i>h;++h){var j=g[h].split("=");if(j[0]){var k=j[0];try{k=decodeURIComponent(k)}catch(l){k=unescape(k)}var m=(j[1]||"").replace(/\+/g," ");try{m=decodeURIComponent(m)}catch(l){m=unescape(m)}b.splitArgs!==!1&&(m=m.split(",")),1==m.length&&(m=m[0]),f[k]=m}}return f},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(a){return a=null==a?"id_":a.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,a+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(a){var b=a>1?1/a:a;return b},OpenLayers.Util.getResolutionFromScale=function(a,b){var c;if(a){null==b&&(b="degrees");var d=OpenLayers.Util.normalizeScale(a);c=1/(d*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH)}return c},OpenLayers.Util.getScaleFromResolution=function(a,b){null==b&&(b="degrees");var c=a*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH;return c},OpenLayers.Util.pagePosition=function(a){var b=[0,0],c=OpenLayers.Util.getViewportElement();if(!a||a==window||a==c)return b;var d,e=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(a,"position")&&(""==a.style.top||""==a.style.left),f=null;if(a.getBoundingClientRect){d=a.getBoundingClientRect();var g=window.pageYOffset||c.scrollTop,h=window.pageXOffset||c.scrollLeft;b[0]=d.left+h,b[1]=d.top+g}else if(document.getBoxObjectFor&&!e){d=document.getBoxObjectFor(a);var i=document.getBoxObjectFor(c);b[0]=d.screenX-i.screenX,b[1]=d.screenY-i.screenY}else{if(b[0]=a.offsetLeft,b[1]=a.offsetTop,f=a.offsetParent,f!=a)for(;f;)b[0]+=f.offsetLeft,b[1]+=f.offsetTop,f=f.offsetParent;var j=OpenLayers.BROWSER_NAME;for(("opera"==j||"safari"==j&&"absolute"==OpenLayers.Element.getStyle(a,"position"))&&(b[1]-=document.body.offsetTop),f=a.offsetParent;f&&f!=document.body;)b[0]-=f.scrollLeft,("opera"!=j||"TR"!=f.tagName)&&(b[1]-=f.scrollTop),f=f.offsetParent}return b},OpenLayers.Util.getViewportElement=function(){var a=arguments.callee.viewportElement;return void 0==a&&(a="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=a),a},OpenLayers.Util.isEquivalentUrl=function(a,b,c){c=c||{},OpenLayers.Util.applyDefaults(c,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var d=OpenLayers.Util.createUrlObject(a,c),e=OpenLayers.Util.createUrlObject(b,c);for(var f in d)if("args"!==f&&d[f]!=e[f])return!1;for(var f in d.args){if(d.args[f]!=e.args[f])return!1;delete e.args[f]}for(var f in e.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(a,b){if(b=b||{},!/^\w+:\/\//.test(a)){var c=window.location,d=c.port?":"+c.port:"",e=c.protocol+"//"+c.host.split(":").shift()+d;if(0===a.indexOf("/"))a=e+a;else{var f=c.pathname.split("/");f.pop(),a=e+f.join("/")+"/"+a}}b.ignoreCase&&(a=a.toLowerCase());var g=document.createElement("a");g.href=a;var h={};h.host=g.host.split(":").shift(),h.protocol=g.protocol,h.port=b.ignorePort80?"80"==g.port||"0"==g.port?"":g.port:""==g.port||"0"==g.port?"80":g.port,h.hash=b.ignoreHash||"#"===g.hash?"":g.hash;var i=g.search;if(!i){var j=a.indexOf("?");i=-1!=j?a.substr(j):""}return h.args=OpenLayers.Util.getParameters(i,{splitArgs:b.splitArgs}),h.pathname="/"==g.pathname.charAt(0)?g.pathname:"/"+g.pathname,h},OpenLayers.Util.removeTail=function(a){var b=null,c=a.indexOf("?"),d=a.indexOf("#");return b=-1==c?-1!=d?a.substr(0,d):a:-1!=d?a.substr(0,Math.min(c,d)):a.substr(0,c)},OpenLayers.IS_GECKO=function(){var a=navigator.userAgent.toLowerCase();return-1==a.indexOf("webkit")&&-1!=a.indexOf("gecko")}(),OpenLayers.CANVAS_SUPPORTED=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var a="",b=navigator.userAgent.toLowerCase();return-1!=b.indexOf("opera")?a="opera":-1!=b.indexOf("msie")?a="msie":-1!=b.indexOf("safari")?a="safari":-1!=b.indexOf("mozilla")&&(a=-1!=b.indexOf("firefox")?"firefox":"mozilla"),a}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(a,b,c){var d,e,f=document.createElement("div");f.style.visibility="hidden";for(var g=c&&c.containerElement?c.containerElement:document.body,h=!1,i=null,j=g;j&&"body"!=j.tagName.toLowerCase();){var k=OpenLayers.Element.getStyle(j,"position");if("absolute"==k){h=!0;break}if(k&&"static"!=k)break;j=j.parentNode}!h||0!==g.clientHeight&&0!==g.clientWidth||(i=document.createElement("div"),i.style.visibility="hidden",i.style.position="absolute",i.style.overflow="visible",i.style.width=document.body.clientWidth+"px",i.style.height=document.body.clientHeight+"px",i.appendChild(f)),f.style.position="absolute",b&&(b.w?(d=b.w,f.style.width=d+"px"):b.h&&(e=b.h,f.style.height=e+"px")),c&&c.displayClass&&(f.className=c.displayClass);var l=document.createElement("div");if(l.innerHTML=a,l.style.overflow="visible",l.childNodes)for(var m=0,n=l.childNodes.length;n>m;m++)l.childNodes[m].style&&(l.childNodes[m].style.overflow="visible");return f.appendChild(l),g.appendChild(i?i:f),d||(d=parseInt(l.scrollWidth),f.style.width=d+"px"),e||(e=parseInt(l.scrollHeight)),f.removeChild(l),i?(i.removeChild(f),g.removeChild(i)):g.removeChild(f),new OpenLayers.Size(d,e)},OpenLayers.Util.getScrollbarWidth=function(){var a=OpenLayers.Util._scrollbarWidth;if(null==a){var b=null,c=null,d=0,e=0;b=document.createElement("div"),b.style.position="absolute",b.style.top="-1000px",b.style.left="-1000px",b.style.width="100px",b.style.height="50px",b.style.overflow="hidden",c=document.createElement("div"),c.style.width="100%",c.style.height="200px",b.appendChild(c),document.body.appendChild(b),d=c.offsetWidth,b.style.overflow="scroll",e=c.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=d-e,a=OpenLayers.Util._scrollbarWidth}return a},OpenLayers.Util.getFormattedLonLat=function(a,b,c){c||(c="dms"),a=(a+540)%360-180;var d=Math.abs(a),e=Math.floor(d),f=(d-e)/(1/60),g=f;f=Math.floor(f);var h=(g-f)/(1/60);h=Math.round(10*h),h/=10,h>=60&&(h-=60,f+=1,f>=60&&(f-=60,e+=1)),10>e&&(e="0"+e);var i=e+"";return c.indexOf("dm")>=0&&(10>f&&(f="0"+f),i+=f+"'",c.indexOf("dms")>=0&&(10>h&&(h="0"+h),i+=h+'"')),i+=OpenLayers.i18n("lon"==b?0>a?"W":"E":0>a?"S":"N")},OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(a){OpenLayers.Util.extend(this,a),this.options=a},destroy:function(){},read:function(){throw new Error("Read not implemented.")},write:function(){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.CSWGetRecords=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetRecords.DEFAULTS);var b=OpenLayers.Format.CSWGetRecords["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSWGetRecords version: "+a.version;return new b(a)},OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"},OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,a),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&"function"==typeof this.handlers[a].destroy&&this.handlers[a].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(a){this.map=a,this.handler&&this.handler.setMap(a)},draw:function(a){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title)),null!=a&&(this.position=a.clone()),this.moveTo(this.position),this.div},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+"px",this.div.style.top=a.y+"px")},activate:function(){return this.active?!1:(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isSingleTouch:function(a){return a.touches&&1==a.touches.length},isMultiTouch:function(a){return a.touches&&a.touches.length>1},isLeftClick:function(a){return a.which&&1==a.which||a.button&&1==a.button},isRightClick:function(a){return a.which&&3==a.which||a.button&&2==a.button},stop:function(a,b){b||OpenLayers.Event.preventDefault(a),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},findElement:function(a,b){for(var c=OpenLayers.Event.element(a);c.parentNode&&(!c.tagName||c.tagName.toUpperCase()!=b.toUpperCase());)c=c.parentNode;return c},observe:function(a,b,c,d){var e=OpenLayers.Util.getElement(a);if(d=d||!1,"keypress"==b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.attachEvent)&&(b="keydown"),this.observers||(this.observers={}),!e._eventCacheID){var f="eventCacheID_";e.id&&(f=e.id+"_"+f),e._eventCacheID=OpenLayers.Util.createUniqueID(f)}var g=e._eventCacheID;this.observers[g]||(this.observers[g]=[]),this.observers[g].push({element:e,name:b,observer:c,useCapture:d}),e.addEventListener?e.addEventListener(b,c,d):e.attachEvent&&e.attachEvent("on"+b,c)},stopObservingElement:function(a){var b=OpenLayers.Util.getElement(a),c=b._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[c])},_removeElementObservers:function(a){if(a)for(var b=a.length-1;b>=0;b--){var c=a[b];OpenLayers.Event.stopObserving.apply(this,[c.element,c.name,c.observer,c.useCapture])}},stopObserving:function(a,b,c,d){d=d||!1;var e=OpenLayers.Util.getElement(a),f=e._eventCacheID;"keypress"==b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.detachEvent)&&(b="keydown");var g=!1,h=OpenLayers.Event.observers[f];if(h)for(var i=0;!g&&i<h.length;){var j=h[i];if(j.name==b&&j.observer==c&&j.useCapture==d){h.splice(i,1),0==h.length&&delete OpenLayers.Event.observers[f],g=!0;break}i++}return g&&(e.removeEventListener?e.removeEventListener(b,c,d):e&&e.detachEvent&&e.detachEvent("on"+b,c)),g},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers){var b=OpenLayers.Event.observers[a];OpenLayers.Event._removeElementObservers.apply(this,[b])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(a,b,c,d,e){OpenLayers.Util.extend(this,e),this.object=a,this.fallThrough=d,this.listeners={},this.extensions={},this.extensionCount={},this._msTouches=[],null!=b&&this.attachToElement(b)},destroy:function(){for(var a in this.extensions)"boolean"!=typeof this.extensions[a]&&this.extensions[a].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(){},attachToElement:function(a){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=a;for(var b,c=!!window.navigator.msMaxTouchPoints,d=0,e=this.BROWSER_EVENTS.length;e>d;d++)b=this.BROWSER_EVENTS[d],OpenLayers.Event.observe(a,b,this.eventHandler),c&&0===b.indexOf("touch")&&this.addMsTouchListener(a,b,this.eventHandler);OpenLayers.Event.observe(a,"dragstart",OpenLayers.Event.stop)},on:function(a){for(var b in a)"scope"!=b&&a.hasOwnProperty(b)&&this.register(b,a.scope,a[b])},register:function(a,b,c,d){if(a in OpenLayers.Events&&!this.extensions[a]&&(this.extensions[a]=new OpenLayers.Events[a](this)),null!=c){null==b&&(b=this.object);var e=this.listeners[a];e||(e=[],this.listeners[a]=e,this.extensionCount[a]=0);var f={obj:b,func:c};d?(e.splice(this.extensionCount[a],0,f),"object"==typeof d&&d.extension&&this.extensionCount[a]++):e.push(f)}},registerPriority:function(a,b,c){this.register(a,b,c,!0)},un:function(a){for(var b in a)"scope"!=b&&a.hasOwnProperty(b)&&this.unregister(b,a.scope,a[b])},unregister:function(a,b,c){null==b&&(b=this.object);var d=this.listeners[a];if(null!=d)for(var e=0,f=d.length;f>e;e++)if(d[e].obj==b&&d[e].func==c){d.splice(e,1);break}},remove:function(a){null!=this.listeners[a]&&(this.listeners[a]=[])},triggerEvent:function(a,b){var c=this.listeners[a];if(!c||0==c.length)return void 0;null==b&&(b={}),b.object=this.object,b.element=this.element,b.type||(b.type=a),c=c.slice();for(var d,e=0,f=c.length;f>e;e++){var g=c[e];if(d=g.func.apply(g.obj,[b]),void 0!=d&&0==d)break}return this.fallThrough||OpenLayers.Event.stop(b,!0),d},handleBrowserEvent:function(a){var b=a.type,c=this.listeners[b];if(c&&0!=c.length){var d=a.touches;if(d&&d[0]){for(var e,f=0,g=0,h=d.length,i=0;h>i;++i)e=this.getTouchClientXY(d[i]),f+=e.clientX,g+=e.clientY;a.clientX=f/h,a.clientY=g/h}this.includeXY&&(a.xy=this.getMousePosition(a)),this.triggerEvent(b,a)}},getTouchClientXY:function(a){var b=window.olMockWin||window,c=b.pageXOffset,d=b.pageYOffset,e=a.clientX,f=a.clientY;return 0===a.pageY&&Math.floor(f)>Math.floor(a.pageY)||0===a.pageX&&Math.floor(e)>Math.floor(a.pageX)?(e-=c,f-=d):(f<a.pageY-d||e<a.pageX-c)&&(e=a.pageX-c,f=a.pageY-d),a.olClientX=e,a.olClientY=f,{clientX:e,clientY:f}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(a){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var b=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||b.scrollLeft,window.pageYOffset||b.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(a.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],a.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(a,b,c){function d(a){c(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var a=e.length-1;a>=0;--a)e[a].stopPropagation()},preventDefault:function(){for(var a=e.length-1;a>=0;--a)e[a].preventDefault()},type:b},a))}var e=(this.eventHandler,this._msTouches);switch(b){case"touchstart":return this.addMsTouchListenerStart(a,b,d);case"touchend":return this.addMsTouchListenerEnd(a,b,d);case"touchmove":return this.addMsTouchListenerMove(a,b,d);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(a,b,c){var d=this._msTouches,e=function(a){for(var b=!1,e=0,f=d.length;f>e;++e)if(d[e].pointerId==a.pointerId){b=!0;break}b||d.push(a),a.touches=d.slice(),c(a)};OpenLayers.Event.observe(a,"MSPointerDown",e);var f=function(a){for(var b=0,c=d.length;c>b;++b)if(d[b].pointerId==a.pointerId){d.splice(b,1);break}};OpenLayers.Event.observe(a,"MSPointerUp",f)},addMsTouchListenerMove:function(a,b,c){var d=this._msTouches,e=function(a){if(!(a.pointerType==a.MSPOINTER_TYPE_MOUSE&&0==a.buttons||1==d.length&&d[0].pageX==a.pageX&&d[0].pageY==a.pageY)){for(var b=0,e=d.length;e>b;++b)if(d[b].pointerId==a.pointerId){d[b]=a;break}a.touches=d.slice(),c(a)}};OpenLayers.Event.observe(a,"MSPointerMove",e)},addMsTouchListenerEnd:function(a,b,c){var d=this._msTouches,e=function(a){for(var b=0,e=d.length;e>b;++b)if(d[b].pointerId==a.pointerId){d.splice(b,1);break}a.touches=d.slice(),c(a)};OpenLayers.Event.observe(a,"MSPointerUp",e)},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(a){this.target=a;for(var b=this.events.length-1;b>=0;--b)this.target.register(this.events[b],this,this.buttonClick,{extension:!0})},destroy:function(){for(var a=this.events.length-1;a>=0;--a)this.target.unregister(this.events[a],this,this.buttonClick);delete this.target},getPressedButton:function(a){var b,c=3;do{if(OpenLayers.Element.hasClass(a,"olButton")){b=a;break}a=a.parentNode}while(--c>0&&a);return b},ignore:function(a){var b=3,c=!1;do{if("a"===a.nodeName.toLowerCase()){c=!0;break}a=a.parentNode}while(--b>0&&a);return c},buttonClick:function(a){var b=!0,c=OpenLayers.Event.element(a);if(c&&(OpenLayers.Event.isLeftClick(a)||!~a.type.indexOf("mouse"))){var d=this.getPressedButton(c);if(d){if("keydown"===a.type)switch(a.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:d}),OpenLayers.Event.stop(a),b=!1}else if(this.startEvt){if(this.completeRegEx.test(a.type)){var e=OpenLayers.Util.pagePosition(d),f=OpenLayers.Util.getViewportElement(),g=window.pageYOffset||f.scrollTop,h=window.pageXOffset||f.scrollLeft;e[0]=e[0]-h,e[1]=e[1]-g,this.target.triggerEvent("buttonclick",{buttonElement:d,buttonXY:{x:this.startEvt.clientX-e[0],y:this.startEvt.clientY-e[1]}})}this.cancelRegEx.test(a.type)&&delete this.startEvt,OpenLayers.Event.stop(a),b=!1}this.startRegEx.test(a.type)&&(this.startEvt=a,OpenLayers.Event.stop(a),b=!1)}else b=!this.ignore(OpenLayers.Event.element(a)),delete this.startEvt}return b}}),OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.vendorPrefix=function(){function a(a){return a?a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function b(b){if(void 0===g[b]){var c=b.replace(/(-[\s\S])/g,function(a){return a.charAt(1).toUpperCase()}),e=d(c);g[b]=a(e)}return g[b]}function c(a,b){if(void 0===h[b]){var c,d,f=0,g=e.length,i="undefined"!=typeof a.cssText;for(h[b]=null;g>f;f++)if(d=e[f],d?(i||(d=d.toLowerCase()),c=d+b.charAt(0).toUpperCase()+b.slice(1)):c=b,void 0!==a[c]){h[b]=c;break}}return h[b]}function d(a){return c(f,a)}var e=["","O","ms","Moz","Webkit"],f=document.createElement("div").style,g={},h={};return{css:b,js:c,style:d,cssCache:g,jsCache:h}}(),OpenLayers.Animation=function(a){function b(a,b,c){b=b>0?b:Number.POSITIVE_INFINITY;var d=++g,e=+new Date;return h[d]=function(){h[d]&&+new Date-e<=b?(a(),h[d]&&f(h[d],c)):delete h[d]},f(h[d],c),d}function c(a){delete h[a]}var d=OpenLayers.Util.vendorPrefix.js(a,"requestAnimationFrame"),e=!!d,f=function(){var b=a[d]||function(b){a.setTimeout(b,16)};return function(c,d){b.apply(a,[c,d])}}(),g=0,h={};return{isNative:e,requestFrame:f,start:b,stop:c}}(window),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(a){this.easing=a?a:OpenLayers.Easing.Expo.easeOut},start:function(a,b,c,d){this.playing=!0,this.begin=a,this.finish=b,this.duration=c,this.callbacks=d.callbacks,this.minFrameRate=d.minFrameRate||30,this.time=0,this.startTime=(new Date).getTime(),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var a={};for(var b in this.begin){var c=this.begin[b],d=this.finish[b];if(null==c||null==d||isNaN(c)||isNaN(d))throw new TypeError("invalid value for Tween");var e=d-c;a[b]=this.easing.apply(this,[this.time,c,e,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,a),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(a,b,c,d){return c*a/d+b},easeOut:function(a,b,c,d){return c*a/d+b},easeInOut:function(a,b,c,d){return c*a/d+b},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b},easeOut:function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},easeInOut:function(a,b,c,d){return 0==a?b:a==d?b+c:(a/=d/2)<1?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(a,b){OpenLayers.Util.extend(this,b),this.projCode=a,"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(a))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){var b=a,c=!1;if(b)if(b instanceof OpenLayers.Projection||(b=new OpenLayers.Projection(b)),"object"==typeof Proj4js&&this.proj.defData&&b.proj.defData)c=this.proj.defData.replace(this.titleRegEx,"")==b.proj.defData.replace(this.titleRegEx,"");else if(b.getCode){var d=this.getCode(),e=b.getCode();c=d==e||!!OpenLayers.Projection.transforms[d]&&OpenLayers.Projection.transforms[d][e]===OpenLayers.Projection.nullTransform}return c},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}},OpenLayers.Projection.addTransform=function(a,b,c){if(c===OpenLayers.Projection.nullTransform){var d=OpenLayers.Projection.defaults[a];d&&!OpenLayers.Projection.defaults[b]&&(OpenLayers.Projection.defaults[b]=d)}OpenLayers.Projection.transforms[a]||(OpenLayers.Projection.transforms[a]={}),OpenLayers.Projection.transforms[a][b]=c},OpenLayers.Projection.transform=function(a,b,c){if(b&&c)if(b instanceof OpenLayers.Projection||(b=new OpenLayers.Projection(b)),c instanceof OpenLayers.Projection||(c=new OpenLayers.Projection(c)),b.proj&&c.proj)a=Proj4js.transform(b.proj,c.proj,a);else{var d=b.getCode(),e=c.getCode(),f=OpenLayers.Projection.transforms;f[d]&&f[d][e]&&f[d][e](a)}return a},OpenLayers.Projection.nullTransform=function(a){return a},function(){function a(a){return a.x=180*a.x/e,a.y=180/Math.PI*(2*Math.atan(Math.exp(a.y/e*Math.PI))-Math.PI/2),a}function b(a){a.x=a.x*e/180;var b=Math.log(Math.tan((90+a.y)*Math.PI/360))/Math.PI*e;return a.y=Math.max(-20037508.34,Math.min(b,20037508.34)),a}function c(c,d){var e,f,g,h,i,j=OpenLayers.Projection.addTransform,k=OpenLayers.Projection.nullTransform;for(e=0,f=d.length;f>e;++e)for(g=d[e],j(c,g,b),j(g,c,a),i=e+1;f>i;++i)h=d[i],j(g,h,k),j(h,g,k)}var d,e=20037508.34,f=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],g=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(d=f.length-1;d>=0;--d)c(f[d],g);for(d=g.length-1;d>=0;--d)c(g[d],f)}(),OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(a,b){1===arguments.length&&"object"==typeof a&&(b=a,a=b&&b.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.options=OpenLayers.Util.extend({},b),OpenLayers.Util.extend(this,b);
var c=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[c]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(a),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");var d=this.id+"_OpenLayers_ViewPort";if(this.viewPortDiv=OpenLayers.Util.createDiv(d,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this)),d=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(d),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.layerContainerOriginPx={x:0,y:0},this.applyTransform(),this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),this.autoUpdateSize===!0&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var e=!0,f=document.getElementsByTagName("link"),g=0,h=f.length;h>g;++g)if(OpenLayers.Util.isEquivalentUrl(f.item(g).href,this.theme)){e=!1;break}if(e){var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(i)}}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));for(var g=0,h=this.controls.length;h>g;g++)this.addControlToMap(this.controls[g]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),b&&b.layers&&(delete this.center,delete this.zoom,this.addLayers(b.layers),b.center&&!this.getCenter()&&this.setCenter(b.center,b.zoom)),this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod)),this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(a){this.div=OpenLayers.Util.getElement(a),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),this.zoomTween&&(this.zoomTween.stop(),this.zoomTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,null!=this.controls){for(var a=this.controls.length-1;a>=0;--a)this.controls[a].destroy();this.controls=null}if(null!=this.layers){for(var a=this.layers.length-1;a>=0;--a)this.layers[a].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null),this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.events=null,this.options=null},setOptions:function(a){var b=this.minPx&&a.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,a),b&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(a,b,c){var d="function"==typeof c.test,e=OpenLayers.Array.filter(this[a],function(a){return a[b]==c||d&&c.test(a[b])});return e},getLayersBy:function(a,b){return this.getBy("layers",a,b)},getLayersByName:function(a){return this.getLayersBy("name",a)},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a)},getControlsBy:function(a,b){return this.getBy("controls",a,b)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},getLayer:function(a){for(var b=null,c=0,d=this.layers.length;d>c;c++){var e=this.layers[c];if(e.id==a){b=e;break}}return b},setLayerZIndex:function(a,b){a.setZIndex(this.Z_INDEX_BASE[a.isBaseLayer?"BaseLayer":"Overlay"]+5*b)},resetLayersZIndex:function(){for(var a=0,b=this.layers.length;b>a;a++){var c=this.layers[a];this.setLayerZIndex(c,a)}},addLayer:function(a){for(var b=0,c=this.layers.length;c>b;b++)if(this.layers[b]==a)return!1;return this.events.triggerEvent("preaddlayer",{layer:a})===!1?!1:(this.allOverlays&&(a.isBaseLayer=!1),a.div.className="olLayerDiv",a.div.style.overflow="",this.setLayerZIndex(a,this.layers.length),a.isFixed?this.viewPortDiv.appendChild(a.div):this.layerContainerDiv.appendChild(a.div),this.layers.push(a),a.setMap(this),a.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(a):a.setVisibility(!1):a.redraw(),this.events.triggerEvent("addlayer",{layer:a}),a.events.triggerEvent("added",{map:this,layer:a}),a.afterAdd(),!0)},addLayers:function(a){for(var b=0,c=a.length;c>b;b++)this.addLayer(a[b])},removeLayer:function(a,b){if(this.events.triggerEvent("preremovelayer",{layer:a})!==!1){if(null==b&&(b=!0),a.isFixed?this.viewPortDiv.removeChild(a.div):this.layerContainerDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.layers,a),a.removeMap(this),a.map=null,this.baseLayer==a&&(this.baseLayer=null,b))for(var c=0,d=this.layers.length;d>c;c++){var e=this.layers[c];if(e.isBaseLayer||this.allOverlays){this.setBaseLayer(e);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:a}),a.events.triggerEvent("removed",{map:this,layer:a})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a)},setLayerIndex:function(a,b){var c=this.getLayerIndex(a);if(0>b?b=0:b>this.layers.length&&(b=this.layers.length),c!=b){this.layers.splice(c,1),this.layers.splice(b,0,a);for(var d=0,e=this.layers.length;e>d;d++)this.setLayerZIndex(this.layers[d],d);this.events.triggerEvent("changelayer",{layer:a,property:"order"}),this.allOverlays&&(0===b?this.setBaseLayer(a):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(a,b){var c=this.getLayerIndex(a)+b;this.setLayerIndex(a,c)},setBaseLayer:function(a){if(a!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,a)){var b=this.getCachedCenter(),c=OpenLayers.Util.getResolutionFromScale(this.getScale(),a.units);if(null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=a,(!this.allOverlays||this.baseLayer.visibility)&&(this.baseLayer.setVisibility(!0),this.baseLayer.inRange===!1&&this.baseLayer.redraw()),null!=b){var d=this.getZoomForResolution(c||this.resolution,!0);this.setCenter(b,d,!1,!0)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(a,b){this.controls.push(a),this.addControlToMap(a,b)},addControls:function(a,b){for(var c=1===arguments.length?[]:b,d=0,e=a.length;e>d;d++){var f=a[d],g=c[d]?c[d]:null;this.addControl(f,g)}},addControlToMap:function(a,b){a.outsideViewport=null!=a.div,this.displayProjection&&!a.displayProjection&&(a.displayProjection=this.displayProjection),a.setMap(this);var c=a.draw(b);c&&(a.outsideViewport||(c.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(c))),a.autoActivate&&a.activate()},getControl:function(a){for(var b=null,c=0,d=this.controls.length;d>c;c++){var e=this.controls[c];if(e.id==a){b=e;break}}return b},removeControl:function(a){a&&a==this.getControl(a.id)&&(a.div&&a.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.controls,a))},addPopup:function(a,b){if(b)for(var c=this.popups.length-1;c>=0;--c)this.removePopup(this.popups[c]);a.map=this,this.popups.push(a);var d=a.draw();d&&(d.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(d))},removePopup:function(a){if(OpenLayers.Util.removeItem(this.popups,a),a.div)try{this.layerContainerDiv.removeChild(a.div)}catch(b){}a.map=null},getSize:function(){var a=null;return null!=this.size&&(a=this.size.clone()),a},updateSize:function(){var a=this.getCurrentSize();if(a&&!isNaN(a.h)&&!isNaN(a.w)){this.events.clearMouseCache();var b=this.getSize();if(null==b&&(this.size=b=a),!a.equals(b)){this.size=a;for(var c=0,d=this.layers.length;d>c;c++)this.layers[c].onMapResize();var e=this.getCachedCenter();if(null!=this.baseLayer&&null!=e){var f=this.getZoom();this.zoom=null,this.setCenter(e,f)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))&&(a.w=this.div.offsetWidth,a.h=this.div.offsetHeight),(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))&&(a.w=parseInt(this.div.style.width),a.h=parseInt(this.div.style.height)),a},calculateBounds:function(a,b){var c=null;if(null==a&&(a=this.getCachedCenter()),null==b&&(b=this.getResolution()),null!=a&&null!=b){var d=this.size.w*b/2,e=this.size.h*b/2;c=new OpenLayers.Bounds(a.lon-d,a.lat-e,a.lon+d,a.lat+e)}return c},getCenter:function(){var a=null,b=this.getCachedCenter();return b&&(a=b.clone()),a},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(a,b,c){if(c=OpenLayers.Util.applyDefaults(c,{animate:!0,dragging:!1}),c.dragging)(0!=a||0!=b)&&this.moveByPx(a,b);else{var d=this.getViewPortPxFromLonLat(this.getCachedCenter()),e=d.add(a,b);if(this.dragging||!e.equals(d)){var f=this.getLonLatFromViewPortPx(e);c.animate?this.panTo(f):(this.moveTo(f),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(a){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(a)){var b=this.getCachedCenter();if(a.equals(b))return;var c=this.getPixelFromLonLat(b),d=this.getPixelFromLonLat(a),e={x:d.x-c.x,y:d.y-c.y},f={x:0,y:0};this.panTween.start({x:0,y:0},e,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(a){var b=a.x-f.x,c=a.y-f.y;this.moveByPx(b,c),f.x=Math.round(a.x),f.y=Math.round(a.y)},this),done:OpenLayers.Function.bind(function(){this.moveTo(a),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}else this.setCenter(a)},setCenter:function(a,b,c,d){this.panTween&&this.panTween.stop(),this.zoomTween&&this.zoomTween.stop(),this.moveTo(a,b,{dragging:c,forceZoomChange:d})},moveByPx:function(a,b){var c=this.size.w/2,d=this.size.h/2,e=c+a,f=d+b,g=this.baseLayer&&this.baseLayer.wrapDateLine,h=0,i=0;if(this.restrictedExtent&&(h=c,i=d,g=!1),a=g||e<=this.maxPx.x-h&&e>=this.minPx.x+h?Math.round(a):0,b=f<=this.maxPx.y-i&&f>=this.minPx.y+i?Math.round(b):0,a||b){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,a&&(this.layerContainerOriginPx.x-=a,this.minPx.x-=a,this.maxPx.x-=a),b&&(this.layerContainerOriginPx.y-=b,this.minPx.y-=b,this.maxPx.y-=b),this.applyTransform();var j,k,l;for(k=0,l=this.layers.length;l>k;++k)j=this.layers[k],j.visibility&&(j===this.baseLayer||j.inRange)&&(j.moveByPx(a,b),j.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(a){if(this.baseLayer&&this.baseLayer.wrapDateLine){var b=this.baseLayer.resolutions,c=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(a)>c)if(this.fractionalZoom)a=this.getZoomForResolution(c);else for(var d=0|a,e=b.length;e>d;++d)if(b[d]<=c){a=d;break}}return a},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(a,b,c){null==a||a instanceof OpenLayers.LonLat||(a=new OpenLayers.LonLat(a)),c||(c={}),null!=b&&(b=parseFloat(b),this.fractionalZoom||(b=Math.round(b)));var d=b;b=this.adjustZoom(b),b!==d&&(a=this.getCenter());var e=c.dragging||this.dragging,f=c.forceZoomChange;if(this.getCachedCenter()||this.isValidLonLat(a)||(a=this.maxExtent.getCenterLonLat(),this.center=a.clone()),null!=this.restrictedExtent){null==a&&(a=this.center),null==b&&(b=this.getZoom());var g=this.getResolutionForZoom(b),h=this.calculateBounds(a,g);if(!this.restrictedExtent.containsBounds(h)){var i=this.restrictedExtent.getCenterLonLat();h.getWidth()>this.restrictedExtent.getWidth()?a=new OpenLayers.LonLat(i.lon,a.lat):h.left<this.restrictedExtent.left?a=a.add(this.restrictedExtent.left-h.left,0):h.right>this.restrictedExtent.right&&(a=a.add(this.restrictedExtent.right-h.right,0)),h.getHeight()>this.restrictedExtent.getHeight()?a=new OpenLayers.LonLat(a.lon,i.lat):h.bottom<this.restrictedExtent.bottom?a=a.add(0,this.restrictedExtent.bottom-h.bottom):h.top>this.restrictedExtent.top&&(a=a.add(0,this.restrictedExtent.top-h.top))}}var j=f||this.isValidZoomLevel(b)&&b!=this.getZoom(),k=this.isValidLonLat(a)&&!a.equals(this.center);if(j||k||e){e||this.events.triggerEvent("movestart",{zoomChanged:j}),k&&(!j&&this.center&&this.centerLayerContainer(a),this.center=a.clone());var l=j?this.getResolutionForZoom(b):this.getResolution();if(j||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerOriginPx.x=0,this.layerContainerOriginPx.y=0,this.applyTransform();var m=this.getMaxExtent({restricted:!0}),n=m.getCenterLonLat(),o=this.center.lon-n.lon,p=n.lat-this.center.lat,q=Math.round(m.getWidth()/l),r=Math.round(m.getHeight()/l);this.minPx={x:(this.size.w-q)/2-o/l,y:(this.size.h-r)/2-p/l},this.maxPx={x:this.minPx.x+Math.round(m.getWidth()/l),y:this.minPx.y+Math.round(m.getHeight()/l)}}j&&(this.zoom=b,this.resolution=l);var s=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(s,j,c.dragging),c.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:j})),s=this.baseLayer.getExtent();for(var t=this.layers.length-1;t>=0;--t){var u=this.layers[t];if(u!==this.baseLayer&&!u.isBaseLayer){var v=u.calculateInRange();u.inRange!=v&&(u.inRange=v,v||u.display(!1),this.events.triggerEvent("changelayer",{layer:u,property:"visibility"})),v&&u.visibility&&(u.moveTo(s,j,c.dragging),c.dragging||u.events.triggerEvent("moveend",{zoomChanged:j}))}}if(this.events.triggerEvent("move"),e||this.events.triggerEvent("moveend"),j){for(var t=0,w=this.popups.length;w>t;t++)this.popups[t].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(a){var b=this.getViewPortPxFromLonLat(this.layerContainerOrigin),c=this.getViewPortPxFromLonLat(a);if(null!=b&&null!=c){var d=this.layerContainerOriginPx.x,e=this.layerContainerOriginPx.y,f=Math.round(b.x-c.x),g=Math.round(b.y-c.y);this.applyTransform(this.layerContainerOriginPx.x=f,this.layerContainerOriginPx.y=g);var h=d-f,i=e-g;this.minPx.x-=h,this.maxPx.x-=h,this.minPx.y-=i,this.maxPx.y-=i}},isValidZoomLevel:function(a){return null!=a&&a>=0&&a<this.getNumZoomLevels()},isValidLonLat:function(a){var b=!1;if(null!=a){var c=this.getMaxExtent(),d=this.baseLayer&&this.baseLayer.wrapDateLine&&c;b=c&&c.containsLonLat(a,{worldBounds:d})}return b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null},getProjectionObject:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.projection),a},getMaxResolution:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.maxResolution),a},getMaxExtent:function(a){var b=null;return a&&a.restricted&&this.restrictedExtent?b=this.restrictedExtent:null!=this.baseLayer&&(b=this.baseLayer.maxExtent),b},getNumZoomLevels:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.numZoomLevels),a},getExtent:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.getExtent()),a},getResolution:function(){var a=null;return null!=this.baseLayer?a=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(a=this.layers[0].getResolution()),a},getUnits:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.units),a},getScale:function(){var a=null;if(null!=this.baseLayer){var b=this.getResolution(),c=this.baseLayer.units;a=OpenLayers.Util.getScaleFromResolution(b,c)}return a},getZoomForExtent:function(a,b){var c=null;return null!=this.baseLayer&&(c=this.baseLayer.getZoomForExtent(a,b)),c},getResolutionForZoom:function(a){var b=null;return this.baseLayer&&(b=this.baseLayer.getResolutionForZoom(a)),b},getZoomForResolution:function(a,b){var c=null;return null!=this.baseLayer&&(c=this.baseLayer.getZoomForResolution(a,b)),c},zoomTo:function(a,b){var c=this;if(c.isValidZoomLevel(a))if(c.baseLayer.wrapDateLine&&(a=c.adjustZoom(a)),c.zoomTween){var d=c.getResolution(),e=c.getResolutionForZoom(a),f={scale:1},g={scale:d/e};if(c.zoomTween.playing&&c.zoomTween.duration<3*c.zoomDuration)c.zoomTween.finish={scale:c.zoomTween.finish.scale*g.scale};else{if(!b){var h=c.getSize();b={x:h.w/2,y:h.h/2}}c.zoomTween.start(f,g,c.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(a){var d=c.layerContainerOriginPx,e=a.scale,f=(e-1)*(d.x-b.x)|0,g=(e-1)*(d.y-b.y)|0;c.applyTransform(d.x+f,d.y+g,e)},done:function(a){c.applyTransform();var d=c.getResolution()/a.scale,e=c.getZoomForResolution(d,!0);c.moveTo(c.getZoomTargetCenter(b,d),e,!0)}}})}}else{var i=b?c.getZoomTargetCenter(b,c.getResolutionForZoom(a)):null;c.setCenter(i,a)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(a,b){a instanceof OpenLayers.Bounds||(a=new OpenLayers.Bounds(a));var c=a.getCenterLonLat();if(this.baseLayer&&this.baseLayer.wrapDateLine){var d=this.getMaxExtent();for(a=a.clone();a.right<a.left;)a.right+=d.getWidth();c=a.getCenterLonLat().wrapDateLine(d)}this.setCenter(c,this.getZoomForExtent(a,b))},zoomToMaxExtent:function(a){var b=a?a.restricted:!0,c=this.getMaxExtent({restricted:b});this.zoomToExtent(c)},zoomToScale:function(a,b){var c=OpenLayers.Util.getResolutionFromScale(a,this.baseLayer.units),d=this.size.w*c/2,e=this.size.h*c/2,f=this.getCachedCenter(),g=new OpenLayers.Bounds(f.lon-d,f.lat-e,f.lon+d,f.lat+e);this.zoomToExtent(g,b)},getLonLatFromViewPortPx:function(a){var b=null;return null!=this.baseLayer&&(b=this.baseLayer.getLonLatFromViewPortPx(a)),b},getViewPortPxFromLonLat:function(a){var b=null;return null!=this.baseLayer&&(b=this.baseLayer.getViewPortPxFromLonLat(a)),b},getZoomTargetCenter:function(a,b){var c=null,d=this.getSize(),e=d.w/2-a.x,f=a.y-d.h/2,g=this.getLonLatFromPixel(a);return g&&(c=new OpenLayers.LonLat(g.lon+e*b,g.lat+f*b)),c},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(a){var b=this.getViewPortPxFromLonLat(a);return b.x=Math.round(b.x),b.y=Math.round(b.y),b},getGeodesicPixelSize:function(a){var b=a?this.getLonLatFromPixel(a):this.getCachedCenter()||new OpenLayers.LonLat(0,0),c=this.getResolution(),d=b.add(-c/2,0),e=b.add(c/2,0),f=b.add(0,-c/2),g=b.add(0,c/2),h=new OpenLayers.Projection("EPSG:4326"),i=this.getProjectionObject()||h;return i.equals(h)||(d.transform(i,h),e.transform(i,h),f.transform(i,h),g.transform(i,h)),new OpenLayers.Size(OpenLayers.Util.distVincenty(d,e),OpenLayers.Util.distVincenty(f,g))},getViewPortPxFromLayerPx:function(a){var b=null;if(null!=a){var c=this.layerContainerOriginPx.x,d=this.layerContainerOriginPx.y;b=a.add(c,d)}return b},getLayerPxFromViewPortPx:function(a){var b=null;if(null!=a){var c=-this.layerContainerOriginPx.x,d=-this.layerContainerOriginPx.y;b=a.add(c,d),(isNaN(b.x)||isNaN(b.y))&&(b=null)}return b},getLonLatFromLayerPx:function(a){return a=this.getViewPortPxFromLayerPx(a),this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(a){var b=this.getPixelFromLonLat(a);return this.getLayerPxFromViewPortPx(b)},applyTransform:function(a,b,c){c=c||1;var d=this.layerContainerOriginPx,e=1!==c;a=a||d.x,b=b||d.y;var f=this.layerContainerDiv.style,g=this.applyTransform.transform,h=this.applyTransform.template;if(void 0===g&&(g=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=g,g)){var i=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));i&&"none"===i||(h=["translate3d(",",0) ","scale3d(",",1)"],f[g]=[h[0],"0,0",h[1]].join("")),h&&~f[g].indexOf(h[0])||(h=["translate(",") ","scale(",")"]),this.applyTransform.template=h}null===g||"translate3d("!==h[0]&&e!==!0?(f.left=a+"px",f.top=b+"px",null!==g&&(f[g]="")):(e===!0&&"translate("===h[0]&&(a-=d.x,b-=d.y,f.left=d.x+"px",f.top=d.y+"px"),f[g]=[h[0],a,"px,",b,"px",h[1],h[2],c,",",c,h[3]].join(""))},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(a,b,c){OpenLayers.Util.extend(this,c),this.control=a,this.callbacks=b;var d=this.map||a.map;d&&this.setMap(d),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a},checkModifiers:function(a){if(null==this.keyMask)return!0;var b=(a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0)|(a.metaKey?OpenLayers.Handler.MOD_META:0);return b==this.keyMask},activate:function(){if(this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;c>b;b++)this[a[b]]&&this.register(a[b],this[a[b]]);return this.active=!0,!0},deactivate:function(){if(!this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;c>b;b++)this[a[b]]&&this.unregister(a[b],this[a[b]]);return this.touch=!1,this.active=!1,!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var a=["mousedown","mouseup","mousemove","click","dblclick","mouseout"],b=0,c=a.length;c>b;b++)this[a[b]]&&this.unregister(a[b],this[a[b]])}},callback:function(a,b){a&&this.callbacks[a]&&this.callbacks[a].apply(this.control,b)},register:function(a,b){this.map.events.registerPriority(a,this,b),this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b),this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){return this.evt=a,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.MOD_META=8,OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(a){return this.startTouch(),this.down=this.getEventInfo(a),this.last=this.getEventInfo(a),!0},touchmove:function(a){return this.last=this.getEventInfo(a),!0},touchend:function(a){return this.down&&(a.xy=this.last.xy,a.lastTouches=this.last.touches,this.handleSingle(a),this.down=null),!0},mousedown:function(a){return this.down=this.getEventInfo(a),this.last=this.getEventInfo(a),!0},mouseup:function(a){var b=!0;return this.checkModifiers(a)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(a)&&(b=this.rightclick(a)),b},rightclick:function(a){if(this.passesTolerance(a)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[a]),!this.stopDouble;var b=this["double"]?OpenLayers.Util.extend({},a):this.callback("rightclick",[a]),c=OpenLayers.Function.bind(this.delayedRightCall,this,b);this.rightclickTimerId=window.setTimeout(c,this.delay)}return!this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null,a&&this.callback("rightclick",[a])},click:function(a){return this.last||(this.last=this.getEventInfo(a)),this.handleSingle(a),!this.stopSingle},dblclick:function(a){return this.handleDouble(a),!this.stopDouble},handleDouble:function(a){this.passesDblclickTolerance(a)&&(this["double"]&&this.callback("dblclick",[a]),this.clearTimer())},handleSingle:function(a){if(this.passesTolerance(a))if(null!=this.timerId)this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.preventDefault(a),this.handleDouble(a)),this.last.touches&&2===this.last.touches.length||this.clearTimer();else{this.first=this.getEventInfo(a);var b=this.single?OpenLayers.Util.extend({},a):null;this.queuePotentialClick(b)}},queuePotentialClick:function(a){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)},passesTolerance:function(a){var b=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(b=this.pixelTolerance>=this.down.xy.distanceTo(a.xy),b&&this.touch&&this.down.touches.length===this.last.touches.length))for(var c=0,d=this.down.touches.length;d>c;++c)if(this.getTouchDistance(this.down.touches[c],this.last.touches[c])>this.pixelTolerance){b=!1;break}return b},getTouchDistance:function(a,b){return Math.sqrt(Math.pow(a.clientX-b.clientX,2)+Math.pow(a.clientY-b.clientY,2))},passesDblclickTolerance:function(){var a=!0;return this.down&&this.first&&(a=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),a},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(a){this.timerId=null,a&&this.callback("click",[a])},getEventInfo:function(a){var b;if(a.touches){var c=a.touches.length;b=new Array(c);for(var d,e=0;c>e;e++)d=a.touches[e],b[e]={clientX:d.olClientX,clientY:d.olClientY}}return{xy:a.xy,touches:b}},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.down=null,this.first=null,this.last=null,a=!0),a},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.documentDrag===!0){var a=this;this._docMove=function(b){a.mousemove({xy:{x:b.clientX,y:b.clientY},element:document})},this._docUp=function(b){a.mouseup({xy:{x:b.clientX,y:b.clientY}})}}},dragstart:function(a){var b=!0;return this.dragging=!1,this.checkModifiers(a)&&(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))?(this.started=!0,this.start=a.xy,this.last=a.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(a),this.callback("down",[a.xy]),OpenLayers.Event.preventDefault(a),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,b=!this.stopDown):(this.started=!1,this.start=null,this.last=null),b},dragmove:function(a){return this.lastMoveEvt=a,!this.started||this.timeoutId||a.xy.x==this.last.x&&a.xy.y==this.last.y||(this.documentDrag===!0&&this.documentEvents&&(a.element===document?(this.adjustXY(a),this.setEvent(a)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(a),this.callback("move",[a.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=a.xy),!0},dragend:function(a){if(this.started){this.documentDrag===!0&&this.documentEvents&&(this.adjustXY(a),this.removeDocumentEvents());var b=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(a),this.callback("up",[a.xy]),b&&this.callback("done",[a.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(a){return this.dragstart(a)},touchstart:function(a){return this.startTouch(),this.dragstart(a)},mousemove:function(a){return this.dragmove(a)},touchmove:function(a){return this.dragmove(a)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(a){return this.dragend(a)},touchend:function(a){return a.xy=this.last,this.dragend(a)},mouseout:function(a){if(this.started&&OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var b=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(a),this.callback("out",[]),b&&this.callback("done",[a.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(){return this.start==this.last},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.dragging=!1,this.start=null,this.last=null,a=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),a},adjustXY:function(a){var b=OpenLayers.Util.pagePosition(this.map.viewPortDiv);a.xy.x-=b[0],a.xy.y-=b[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(a){this.layers=[],this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))
},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),0===this.layers.length){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var a=this.map.baseLayer.clone();this.layers=[a]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var b=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,b,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton",this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle),this.div.appendChild(this.maximizeDiv);var b=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,b,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton",this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle),this.div.appendChild(this.minimizeDiv),this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this}),this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw(),this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(a){var b=this.handlers.drag.last.x-a.x,c=this.handlers.drag.last.y-a.y;if(0!=b||0!=c){var d=this.rectPxBounds.top,e=this.rectPxBounds.left,f=Math.abs(this.rectPxBounds.getHeight()),g=this.rectPxBounds.getWidth(),h=Math.max(0,d-c);h=Math.min(h,this.ovmap.size.h-this.hComp-f);var i=Math.max(0,e-b);i=Math.min(i,this.ovmap.size.w-this.wComp-g),this.setRectPxBounds(new OpenLayers.Bounds(i,h+f,i+g,h))}},mapDivClick:function(a){var b=this.rectPxBounds.getCenterPixel(),c=a.xy.x-b.x,d=a.xy.y-b.y,e=this.rectPxBounds.top,f=this.rectPxBounds.left,g=Math.abs(this.rectPxBounds.getHeight()),h=this.rectPxBounds.getWidth(),i=Math.max(0,e+d);i=Math.min(i,this.ovmap.size.h-g);var j=Math.max(0,f+c);j=Math.min(j,this.ovmap.size.w-h),this.setRectPxBounds(new OpenLayers.Bounds(j,i+g,j+h,i)),this.updateMapToRect()},onButtonClick:function(a){a.buttonElement===this.minimizeDiv?this.minimizeControl():a.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(a){this.element.style.display="",this.showToggle(!1),null!=a&&OpenLayers.Event.stop(a)},minimizeControl:function(a){this.element.style.display="none",this.showToggle(!0),null!=a&&OpenLayers.Event.stop(a)},showToggle:function(a){this.maximizeDiv&&(this.maximizeDiv.style.display=a?"":"none"),this.minimizeDiv&&(this.minimizeDiv.style.display=a?"none":"")},update:function(){null==this.ovmap&&this.createMap(),(this.autoPan||!this.isSuitableOverview())&&this.updateOverview(),this.updateRectToMap()},isSuitableOverview:function(){var a=this.map.getExtent(),b=this.map.getMaxExtent(),c=new OpenLayers.Bounds(Math.max(a.left,b.left),Math.max(a.bottom,b.bottom),Math.min(a.right,b.right),Math.min(a.top,b.top));this.ovmap.getProjection()!=this.map.getProjection()&&(c=c.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var d=this.ovmap.getResolution()/this.map.getResolution();return d>this.minRatio&&d<=this.maxRatio&&this.ovmap.getExtent().containsBounds(c)},updateOverview:function(){var a=this.map.getResolution(),b=this.ovmap.getResolution(),c=b/a;c>this.maxRatio?b=this.minRatio*a:c<=this.minRatio&&(b=this.maxRatio*a);var d;this.ovmap.getProjection()!=this.map.getProjection()?(d=this.map.center.clone(),d.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):d=this.map.center,this.ovmap.setCenter(d,this.ovmap.getZoomForResolution(b*this.resolutionFactor)),this.updateRectToMap()},createMap:function(){var a=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);if(this.ovmap=new OpenLayers.Map(this.mapDiv,a),this.ovmap.viewPortDiv.appendChild(this.extentRectangle),OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy),this.ovmap.addLayers(this.layers),this.ovmap.zoomToMaxExtent(),this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")),this.wComp=this.wComp?this.wComp:2,this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")),this.hComp=this.hComp?this.hComp:2,this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap}),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap}),this.handlers.click.activate(),this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0),this.rectEvents.register("mouseover",this,function(){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()}),this.rectEvents.register("mouseout",this,function(){this.handlers.drag.dragging||this.handlers.drag.deactivate()}),this.ovmap.getProjection()!=this.map.getProjection()){var b=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,c=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=b&&c?OpenLayers.INCHES_PER_UNIT[b]/OpenLayers.INCHES_PER_UNIT[c]:1}},updateRectToMap:function(){var a;a=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();var b=this.getRectBoundsFromMapBounds(a);b&&this.setRectPxBounds(b)},updateMapToRect:function(){var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(a){var b=Math.max(a.top,0),c=Math.max(a.left,0),d=Math.min(a.top+Math.abs(a.getHeight()),this.ovmap.size.h-this.hComp),e=Math.min(a.left+a.getWidth(),this.ovmap.size.w-this.wComp),f=Math.max(e-c,0),g=Math.max(d-b,0);if(f<this.minRectSize||g<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var h=c+f/2-this.minRectSize/2,i=b+g/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(i)+"px",this.extentRectangle.style.left=Math.round(h)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"}else this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(b)+"px",this.extentRectangle.style.left=Math.round(c)+"px",this.extentRectangle.style.height=Math.round(g)+"px",this.extentRectangle.style.width=Math.round(f)+"px";this.rectPxBounds=new OpenLayers.Bounds(Math.round(c),Math.round(d),Math.round(e),Math.round(b))},getRectBoundsFromMapBounds:function(a){var b=this.getOverviewPxFromLonLat({lon:a.left,lat:a.bottom}),c=this.getOverviewPxFromLonLat({lon:a.right,lat:a.top}),d=null;return b&&c&&(d=new OpenLayers.Bounds(b.x,b.y,c.x,c.y)),d},getMapBoundsFromRectBounds:function(a){var b=this.getLonLatFromOverviewPx({x:a.left,y:a.bottom}),c=this.getLonLatFromOverviewPx({x:a.right,y:a.top});return new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat)},getLonLatFromOverviewPx:function(a){var b=this.ovmap.size,c=this.ovmap.getResolution(),d=this.ovmap.getExtent().getCenterLonLat(),e=a.x-b.w/2,f=a.y-b.h/2;return{lon:d.lon+e*c,lat:d.lat-f*c}},getOverviewPxFromLonLat:function(a){var b=this.ovmap.getResolution(),c=this.ovmap.getExtent();return c?{x:Math.round(1/b*(a.lon-c.left)),y:Math.round(1/b*(c.top-a.lat))}:void 0},CLASS_NAME:"OpenLayers.Control.OverviewMap"}),OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(a,b){this.metadata={},b=OpenLayers.Util.extend({},b),null!=this.alwaysInRange&&(b.alwaysInRange=this.alwaysInRange),this.addOptions(b),this.name=a,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object&&this.events.on(this.eventListeners))},destroy:function(a){null==a&&(a=!0),null!=this.map&&this.map.removeLayer(this,a),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(a){return null==a&&(a=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(a,this),a.map=null,a},getOptions:function(){var a={};for(var b in this.options)a[b]=this[b];return a},setName:function(a){a!=this.name&&(this.name=a,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(a,b){if(null==this.options&&(this.options={}),a&&("string"==typeof a.projection&&(a.projection=new OpenLayers.Projection(a.projection)),a.projection&&OpenLayers.Util.applyDefaults(a,OpenLayers.Projection.defaults[a.projection.getCode()]),!a.maxExtent||a.maxExtent instanceof OpenLayers.Bounds||(a.maxExtent=new OpenLayers.Bounds(a.maxExtent)),!a.minExtent||a.minExtent instanceof OpenLayers.Bounds||(a.minExtent=new OpenLayers.Bounds(a.minExtent))),OpenLayers.Util.extend(this.options,a),OpenLayers.Util.extend(this,a),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var c=this.map.getResolution(),d=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var e in a)if(a.hasOwnProperty(e)&&OpenLayers.Util.indexOf(d,e)>=0){this.initResolutions(),b&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(c),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var a=!1;if(this.map){this.inRange=this.calculateInRange();var b=this.getExtent();if(b&&this.inRange&&this.visibility){var c=!0;this.moveTo(b,c,!1),this.events.triggerEvent("moveend",{zoomChanged:c}),a=!0}}return a},moveTo:function(){var a=this.visibility;this.isBaseLayer||(a=a&&this.inRange),this.display(a)},moveByPx:function(){},setMap:function(a){if(null==this.map){if(this.map=a,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var b=this.visibility&&this.inRange;this.div.style.display=b?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(a){var b=a?a:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=b,this.gutter&&(this.imageSize=new OpenLayers.Size(b.w+2*this.gutter,b.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(a){a!=this.visibility&&(this.visibility=a,this.display(a),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(a){a!=("none"!=this.div.style.display)&&(this.div.style.display=a&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var a=!1;if(this.alwaysInRange)a=!0;else if(this.map){var b=this.map.getResolution();a=b>=this.minResolution&&b<=this.maxResolution}return a},setIsBaseLayer:function(a){a!=this.isBaseLayer&&(this.isBaseLayer=a,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var a,b,c,d={},e=!0;for(a=0,b=this.RESOLUTION_PROPERTIES.length;b>a;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=this.options[c],e&&this.options[c]&&(e=!1);if(null==this.options.alwaysInRange&&(this.alwaysInRange=e),null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales)),null==d.resolutions&&(d.resolutions=this.calculateResolutions(d)),null==d.resolutions){for(a=0,b=this.RESOLUTION_PROPERTIES.length;b>a;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=null!=this.options[c]?this.options[c]:this.map[c];null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales)),null==d.resolutions&&(d.resolutions=this.calculateResolutions(d))}var f;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(f=this.options.maxResolution),this.options.minScale&&(f=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var g;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(g=this.options.minResolution),this.options.maxScale&&(g=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),d.resolutions&&(d.resolutions.sort(function(a,b){return b-a}),f||(f=d.resolutions[0]),!g)){var h=d.resolutions.length-1;g=d.resolutions[h]}if(this.resolutions=d.resolutions,this.resolutions){for(b=this.resolutions.length,this.scales=new Array(b),a=0;b>a;a++)this.scales[a]=OpenLayers.Util.getScaleFromResolution(this.resolutions[a],this.units);this.numZoomLevels=b}this.minResolution=g,g&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(g,this.units)),this.maxResolution=f,f&&(this.minScale=OpenLayers.Util.getScaleFromResolution(f,this.units))},resolutionsFromScales:function(a){if(null!=a){var b,c,d;for(d=a.length,b=new Array(d),c=0;d>c;c++)b[c]=OpenLayers.Util.getResolutionFromScale(a[c],this.units);return b}},calculateResolutions:function(a){var b,c,d,e=a.maxResolution;null!=a.minScale?e=OpenLayers.Util.getResolutionFromScale(a.minScale,this.units):"auto"==e&&null!=this.maxExtent&&(b=this.map.getSize(),c=this.maxExtent.getWidth()/b.w,d=this.maxExtent.getHeight()/b.h,e=Math.max(c,d));var f=a.minResolution;if(null!=a.maxScale?f=OpenLayers.Util.getResolutionFromScale(a.maxScale,this.units):"auto"==a.minResolution&&null!=this.minExtent&&(b=this.map.getSize(),c=this.minExtent.getWidth()/b.w,d=this.minExtent.getHeight()/b.h,f=Math.max(c,d)),"number"!=typeof e&&"number"!=typeof f&&null!=this.maxExtent){var g=this.map.getTileSize();e=Math.max(this.maxExtent.getWidth()/g.w,this.maxExtent.getHeight()/g.h)}var h=a.maxZoomLevel,i=a.numZoomLevels;if("number"==typeof f&&"number"==typeof e&&void 0===i){var j=e/f;i=Math.floor(Math.log(j)/Math.log(2))+1}else void 0===i&&null!=h&&(i=h+1);if(!("number"!=typeof i||0>=i||"number"!=typeof e&&"number"!=typeof f)){var k=new Array(i),l=2;"number"==typeof f&&"number"==typeof e&&(l=Math.pow(e/f,1/(i-1)));var m;if("number"==typeof e)for(m=0;i>m;m++)k[m]=e/Math.pow(l,m);else for(m=0;i>m;m++)k[i-1-m]=f*Math.pow(l,m);return k}},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(a,b){var c=this.map.getSize(),d=Math.max(a.getWidth()/c.w,a.getHeight()/c.h);return this.getZoomForResolution(d,b)},getDataExtent:function(){},getResolutionForZoom:function(a){a=Math.max(0,Math.min(a,this.resolutions.length-1));var b;if(this.map.fractionalZoom){var c=Math.floor(a),d=Math.ceil(a);b=this.resolutions[c]-(a-c)*(this.resolutions[c]-this.resolutions[d])}else b=this.resolutions[Math.round(a)];return b},getZoomForResolution:function(a,b){var c,d,e;if(this.map.fractionalZoom){var f,g=0,h=this.resolutions.length-1,i=this.resolutions[g],j=this.resolutions[h];for(d=0,e=this.resolutions.length;e>d;++d)if(f=this.resolutions[d],f>=a&&(i=f,g=d),a>=f){j=f,h=d;break}var k=i-j;c=k>0?g+(i-a)/k:g}else{var l,m=Number.POSITIVE_INFINITY;for(d=0,e=this.resolutions.length;e>d;d++)if(b){if(l=Math.abs(this.resolutions[d]-a),l>m)break;m=l}else if(this.resolutions[d]<a)break;c=Math.max(0,d-1)}return c},getLonLatFromViewPortPx:function(a){var b=null,c=this.map;if(null!=a&&c.minPx){var d=c.getResolution(),e=c.getMaxExtent({restricted:!0}),f=(a.x-c.minPx.x)*d+e.left,g=(c.minPx.y-a.y)*d+e.top;b=new OpenLayers.LonLat(f,g),this.wrapDateLine&&(b=b.wrapDateLine(this.maxExtent))}return b},getViewPortPxFromLonLat:function(a,b){var c=null;if(null!=a){b=b||this.map.getResolution();var d=this.map.calculateBounds(null,b);c=new OpenLayers.Pixel(1/b*(a.lon-d.left),1/b*(d.top-a.lat))}return c},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=this.div.childNodes,c=0,d=b.length;d>c;++c){var e=b[c].firstChild||b[c],f=b[c].lastChild;f&&"iframe"===f.nodeName.toLowerCase()&&(e=f.parentNode),OpenLayers.Util.modifyDOMElement(e,null,null,null,null,null,null,a)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=a},adjustBounds:function(a){if(this.gutter){var b=this.gutter*this.map.getResolution();a=new OpenLayers.Bounds(a.left-b,a.bottom-b,a.right+b,a.top+b)}if(this.wrapDateLine){var c={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};a=a.wrapDateLine(this.maxExtent,c)}return a},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Layer.SphericalMercator={getExtent:function(){var a=null;return a=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var a=156543.03390625,b=0;b<=this.MAX_ZOOM_LEVEL;++b)this.RESOLUTIONS[b]=a/Math.pow(2,b);this.units="m",this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913");return function(c,d){var e=OpenLayers.Projection.transform({x:c,y:d},a,b);return new OpenLayers.LonLat(e.x,e.y)}}(),inverseMercator:function(){var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913");return function(c,d){var e=OpenLayers.Projection.transform({x:c,y:d},b,a);return new OpenLayers.LonLat(e.x,e.y)}}()},OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(){OpenLayers.Layer.prototype.initialize.apply(this,arguments),null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.mapObject=null,this.pane=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1,this.pane.style.display=this.div.style.display,this.pane.style.width="100%",this.pane.style.height="100%","msie"==OpenLayers.BROWSER_NAME&&(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")"),this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane),this.loadMapObject(),null==this.mapObject&&this.loadWarningMessage()},removeMap:function(){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane),OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var a=this.map.getSize(),b=Math.min(a.w,300),c=Math.min(a.h,200),d=new OpenLayers.Size(b,c),e=new OpenLayers.Pixel(a.w/2,a.h/2),f=e.add(-d.w/2,-d.h/2),g=OpenLayers.Util.createDiv(this.name+"_warning",f,d,null,null,null,"auto");g.style.padding="7px",g.style.backgroundColor="yellow",g.innerHTML=this.getWarningHTML(),this.div.appendChild(g)},getWarningHTML:function(){return""},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments),this.pane.style.display=this.div.style.display},setZIndex:function(){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(a,b){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments),this.dragPanMapObject?this.dragPanMapObject(a,-b):this.moveTo(this.map.getCachedCenter())},moveTo:function(a,b,c){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),null!=this.mapObject){var d=this.map.getCenter(),e=this.map.getZoom();if(null!=d){var f=this.getMapObjectCenter(),g=this.getOLLonLatFromMapObjectLonLat(f),h=this.getMapObjectZoom(),i=this.getOLZoomFromMapObjectZoom(h);if(!d.equals(g)||e!=i)if(!b&&g&&this.dragPanMapObject&&this.smoothDragPan){var j=this.map.getViewPortPxFromLonLat(g),k=this.map.getViewPortPxFromLonLat(d);this.dragPanMapObject(k.x-j.x,j.y-k.y)}else{var l=this.getMapObjectLonLatFromOLLonLat(d),m=this.getMapObjectZoomFromOLZoom(e);this.setMapObjectCenter(l,m,c)}}}},getLonLatFromViewPortPx:function(a){var b=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var c=this.getMapObjectPixelFromOLPixel(a),d=this.getMapObjectLonLatFromMapObjectPixel(c);b=this.getOLLonLatFromMapObjectLonLat(d)}return b},getViewPortPxFromLonLat:function(a){var b=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var c=this.getMapObjectLonLatFromOLLonLat(a),d=this.getMapObjectPixelFromMapObjectLonLat(c);b=this.getOLPixelFromMapObjectPixel(d)}return b},getOLLonLatFromMapObjectLonLat:function(a){var b=null;if(null!=a){var c=this.getLongitudeFromMapObjectLonLat(a),d=this.getLatitudeFromMapObjectLonLat(a);b=new OpenLayers.LonLat(c,d)}return b},getMapObjectLonLatFromOLLonLat:function(a){var b=null;return null!=a&&(b=this.getMapObjectLonLatFromLonLat(a.lon,a.lat)),b},getOLPixelFromMapObjectPixel:function(a){var b=null;if(null!=a){var c=this.getXFromMapObjectPixel(a),d=this.getYFromMapObjectPixel(a);b=new OpenLayers.Pixel(c,d)}return b},getMapObjectPixelFromOLPixel:function(a){var b=null;return null!=a&&(b=this.getMapObjectPixelFromXY(a.x,a.y)),b},CLASS_NAME:"OpenLayers.Layer.EventPane"}),OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var a=["minZoomLevel","maxZoomLevel","numZoomLevels"],b=0,c=a.length;c>b;b++){var d=a[b];this[d]=null!=this.options[d]?this.options[d]:this.map[d]}(null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL)&&(this.minZoomLevel=this.MIN_ZOOM_LEVEL);var e,f=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(e=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels,this.numZoomLevels=null!=e?Math.min(e,f):f,this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1,null!=this.RESOLUTIONS){var g=0;this.resolutions=[];for(var b=this.minZoomLevel;b<=this.maxZoomLevel;b++)this.resolutions[g++]=this.RESOLUTIONS[b];this.maxResolution=this.resolutions[0],this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getResolution.apply(this,arguments);var a=null,b=this.map.getSize(),c=this.getExtent();return null!=b&&null!=c&&(a=Math.max(c.getWidth()/b.w,c.getHeight()/b.h)),a},getExtent:function(){var a=this.map.getSize(),b=this.getLonLatFromViewPortPx({x:0,y:0}),c=this.getLonLatFromViewPortPx({x:a.w,y:a.h});return null!=b&&null!=c?new OpenLayers.Bounds(b.lon,c.lat,c.lon,b.lat):null},getZoomForResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments);var a=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(a)},getOLZoomFromMapObjectZoom:function(a){var b=null;return null!=a&&(b=a-this.minZoomLevel,this.map.baseLayer!==this&&(b=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(b)))),b},getMapObjectZoomFromOLZoom:function(a){var b=null;return null!=a&&(b=a+this.minZoomLevel,this.map.baseLayer!==this&&(b=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(b)))),b},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"}),OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20,536441802978515e-20,268220901489257e-20,1341104507446289e-21,6.705522537231445e-7],type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(a,b){b=b||{},b.version||(b.version="function"==typeof GMap2?"2":"3");var c=OpenLayers.Layer.Google["v"+b.version.replace(/\./g,"_")];if(!c)throw"Unsupported Google Maps API version: "+b.version;OpenLayers.Util.applyDefaults(b,c),OpenLayers.Util.applyDefaults(b,c.DEFAULTS),b.maxExtent&&(b.maxExtent=b.maxExtent.clone()),OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[a,b]),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[a,b]),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(){var a=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments),this.setOpacity(a)},display:function(a){this._dragging||this.setGMapVisibility(a),OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(a,b,c){this._dragging=c,OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments),delete this._dragging},setOpacity:function(a){if(a!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=a),this.getVisibility()){var b=this.getMapContainer();OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,a)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var a=OpenLayers.Layer.Google.cache[this.map.id];a&&a.count<=1&&this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var a=OpenLayers.Layer.Google.cache[this.map.id];if(a){var b=this.mapObject&&this.getMapContainer();b&&b.parentNode&&b.parentNode.removeChild(b);var c=a.termsOfUse;c&&c.parentNode&&c.parentNode.removeChild(c);var d=a.poweredBy;d&&d.parentNode&&d.parentNode.removeChild(d),this.mapObject&&window.google&&google.maps&&google.maps.event&&google.maps.event.clearListeners&&google.maps.event.clearListeners(this.mapObject,"tilesloaded")}},removeMap:function(a){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var b=OpenLayers.Layer.Google.cache[a.id];b&&(b.count<=1?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[a.id]):--b.count),delete this.termsOfUse,delete this.poweredBy,delete this.mapObject,delete this.dragObject,OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(a){var b=null;if(null!=a){var c=a.getSouthWest(),d=a.getNorthEast();this.sphericalMercator?(c=this.forwardMercator(c.lng(),c.lat()),d=this.forwardMercator(d.lng(),d.lat())):(c=new OpenLayers.LonLat(c.lng(),c.lat()),d=new OpenLayers.LonLat(d.lng(),d.lat())),b=new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)}return b},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lon:a.lng()},getLatitudeFromMapObjectLonLat:function(a){var b=this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lat:a.lat();return b},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},CLASS_NAME:"OpenLayers.Layer.Google"}),OpenLayers.Layer.Google.cache={},OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){this.type||(this.type=G_NORMAL_MAP);var a,b,c,d=OpenLayers.Layer.Google.cache[this.map.id];if(d)a=d.mapObject,b=d.termsOfUse,c=d.poweredBy,++d.count;else{var e=this.map.viewPortDiv,f=document.createElement("div");f.id=this.map.id+"_GMap2Container",f.style.position="absolute",f.style.width="100%",f.style.height="100%",e.appendChild(f);try{a=new GMap2(f),b=f.lastChild,e.appendChild(b),b.style.zIndex="1100",b.style.right="",b.style.bottom="",b.className="olLayerGoogleCopyright",c=f.lastChild,e.appendChild(c),c.style.zIndex="1100",c.style.right="",c.style.bottom="",c.className="olLayerGooglePoweredBy gmnoprint"}catch(g){throw g}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:a,termsOfUse:b,poweredBy:c,count:1}}this.mapObject=a,this.termsOfUse=b,this.poweredBy=c,-1===OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)&&this.mapObject.addMapType(this.type),"function"==typeof a.getDragObject?this.dragObject=a.getDragObject():this.dragPanMapObject=null,this.isBaseLayer===!1&&this.setGMapVisibility("none"!==this.div.style.display)},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded())this.mapObject.checkResize();else{if(!this._resized)var a=this,b=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(b),delete a._resized,a.mapObject.checkResize(),a.moveTo(a.map.getCenter(),a.map.getZoom())});this._resized=!0}},setGMapVisibility:function(a){var b=OpenLayers.Layer.Google.cache[this.map.id];if(b){var c=this.mapObject.getContainer();a===!0?(this.mapObject.setMapType(this.type),c.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",b.displayed=this.id):(b.displayed===this.id&&delete b.displayed,b.displayed||(c.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(a){var b=null;if(null!=a){var c=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),d=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right);b=new GLatLngBounds(new GLatLng(c.lat,c.lon),new GLatLng(d.lat,d.lon))}return b},setMapObjectCenter:function(a,b){this.mapObject.setCenter(a,b)
},dragPanMapObject:function(a,b){this.dragObject.moveBy(new GSize(-a,b))},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.fromContainerPixelToLatLng(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.fromLatLngToContainerPixel(a)},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(a,b){var c;if(this.sphericalMercator){var d=this.inverseMercator(a,b);c=new GLatLng(d.lat,d.lon)}else c=new GLatLng(b,a);return c},getMapObjectPixelFromXY:function(a,b){return new GPoint(a,b)}},OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[a]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={};for(var b in this.namespaces)this.namespaceAlias[this.namespaces[b]]=b},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(a,b){this.namespaces[a]=b,this.namespaceAlias[b]=a},read:function(a){var b=a.indexOf("<");b>0&&(a=a.substring(b));var c=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var b;return b=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,b.loadXML(a),b},this),function(){return(new DOMParser).parseFromString(a,"text/xml")},function(){var b=new XMLHttpRequest;return b.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(a),!1),b.overrideMimeType&&b.overrideMimeType("text/xml"),b.send(null),b.responseXML});return this.keepData&&(this.data=c),c},write:function(a){var b;if(this.xmldom)b=a.xml;else{var c=new XMLSerializer;if(1==a.nodeType){var d=document.implementation.createDocument("","",null);d.importNode&&(a=d.importNode(a,!0)),d.appendChild(a),b=c.serializeToString(d)}else b=c.serializeToString(a)}return b},createElementNS:function(a,b){var c;return c=this.xmldom?"string"==typeof a?this.xmldom.createNode(1,b,a):this.xmldom.createNode(1,b,""):document.createElementNS(a,b)},createDocumentFragment:function(){var a;return a=this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(a){var b;return"string"!=typeof a&&(a=String(a)),b=this.xmldom?this.xmldom.createTextNode(a):document.createTextNode(a)},getElementsByTagNameNS:function(a,b,c){var d=[];if(a.getElementsByTagNameNS)d=a.getElementsByTagNameNS(b,c);else for(var e,f,g=a.getElementsByTagName("*"),h=0,i=g.length;i>h;++h)e=g[h],f=e.prefix?e.prefix+":"+c:c,("*"==c||f==e.nodeName)&&("*"==b||b==e.namespaceURI)&&d.push(e);return d},getAttributeNodeNS:function(a,b,c){var d=null;if(a.getAttributeNodeNS)d=a.getAttributeNodeNS(b,c);else for(var e,f,g=a.attributes,h=0,i=g.length;i>h;++h)if(e=g[h],e.namespaceURI==b&&(f=e.prefix?e.prefix+":"+c:c,f==e.nodeName)){d=e;break}return d},getAttributeNS:function(a,b,c){var d="";if(a.getAttributeNS)d=a.getAttributeNS(b,c)||"";else{var e=this.getAttributeNodeNS(a,b,c);e&&(d=e.nodeValue)}return d},getChildValue:function(a,b){var c=b||"";if(a)for(var d=a.firstChild;d;d=d.nextSibling)switch(d.nodeType){case 3:case 4:c+=d.nodeValue}return c},isSimpleContent:function(a){for(var b=!0,c=a.firstChild;c;c=c.nextSibling)if(1===c.nodeType){b=!1;break}return b},contentType:function(a){for(var b=!1,c=!1,d=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,e=a.firstChild;e;e=e.nextSibling){switch(e.nodeType){case 1:c=!0;break;case 8:break;default:b=!0}if(c&&b)break}if(c&&b)d=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(c)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(b)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return d},hasAttributeNS:function(a,b,c){var d=!1;return d=a.hasAttributeNS?a.hasAttributeNS(b,c):!!this.getAttributeNodeNS(a,b,c)},setAttributeNS:function(a,b,c,d){if(a.setAttributeNS)a.setAttributeNS(b,c,d);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(b){var e=a.ownerDocument.createNode(2,c,b);e.nodeValue=d,a.setAttributeNode(e)}else a.setAttribute(c,d)}},createElementNSPlus:function(a,b){b=b||{};var c=b.uri||this.namespaces[b.prefix];if(!c){var d=a.indexOf(":");c=this.namespaces[a.substring(0,d)]}c||(c=this.namespaces[this.defaultPrefix]);var e=this.createElementNS(c,a);b.attributes&&this.setAttributes(e,b.attributes);var f=b.value;return null!=f&&e.appendChild(this.createTextNode(f)),e},setAttributes:function(a,b){var c,d;for(var e in b)null!=b[e]&&b[e].toString&&(c=b[e].toString(),d=this.namespaces[e.substring(0,e.indexOf(":"))]||null,this.setAttributeNS(a,d,e,c))},readNode:function(a,b){b||(b={});var c=this.readers[a.namespaceURI?this.namespaceAlias[a.namespaceURI]:this.defaultPrefix];if(c){var d=a.localName||a.nodeName.split(":").pop(),e=c[d]||c["*"];e&&e.apply(this,[a,b])}return b},readChildNodes:function(a,b){b||(b={});for(var c,d=a.childNodes,e=0,f=d.length;f>e;++e)c=d[e],1==c.nodeType&&this.readNode(c,b);return b},writeNode:function(a,b,c){var d,e,f=a.indexOf(":");f>0?(d=a.substring(0,f),e=a.substring(f+1)):(d=c?this.namespaceAlias[c.namespaceURI]:this.defaultPrefix,e=a);var g=this.writers[d][e].apply(this,[b]);return c&&c.appendChild(g),g},getChildEl:function(a,b,c){return a&&this.getThisOrNextEl(a.firstChild,b,c)},getNextEl:function(a,b,c){return a&&this.getThisOrNextEl(a.nextSibling,b,c)},getThisOrNextEl:function(a,b,c){a:for(var d=a;d;d=d.nextSibling)switch(d.nodeType){case 1:if(!(b&&b!==(d.localName||d.nodeName.split(":").pop())||c&&c!==d.namespaceURI))break a;d=null;break a;case 3:if(/^\s*$/.test(d.nodeValue))break;case 4:case 6:case 12:case 10:case 11:d=null;break a}return d||null},lookupNamespaceURI:function(a,b){var c=null;if(a)if(a.lookupNamespaceURI)c=a.lookupNamespaceURI(b);else a:switch(a.nodeType){case 1:if(null!==a.namespaceURI&&a.prefix===b){c=a.namespaceURI;break a}var d=a.attributes.length;if(d)for(var e,f=0;d>f;++f){if(e=a.attributes[f],"xmlns"===e.prefix&&e.name==="xmlns:"+b){c=e.value||null;break a}if("xmlns"===e.name&&null===b){c=e.value||null;break a}}c=this.lookupNamespaceURI(a.parentNode,b);break a;case 2:c=this.lookupNamespaceURI(a.ownerElement,b);break a;case 9:c=this.lookupNamespaceURI(a.documentElement,b);break a;case 6:case 12:case 10:case 11:break a;default:c=this.lookupNamespaceURI(a.parentNode,b)}return c},getXMLDoc:function(){return OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype),OpenLayers.Format.XML.document=null,OpenLayers.Format.WFST=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.WFST.DEFAULTS);var b=OpenLayers.Format.WFST["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFST version: "+a.version;return new b(a)},OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"},OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(a,b,c){this.layer=a,this.lonlat=b,this.data=null!=c?c:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.layer=null,this.id=null,this.lonlat=null,this.data=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var a=!1;if(null!=this.layer&&null!=this.layer.map){var b=this.layer.map.getExtent();a=b.containsLonLat(this.lonlat)}return a},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(a){if(null!=this.lonlat){if(!this.popup){var b=this.marker?this.marker.icon:null,c=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new c(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,b,a)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(a,b,c){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,b]),this.lonlat=null,this.geometry=a?a:null,this.state=null,this.attributes={},b&&(this.attributes=OpenLayers.Util.extend(this.attributes,b)),this.style=c?c:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,this.modified=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(a){var b=!1;if(this.layer&&this.layer.map){var c=this.layer.map.getExtent();if(a){var d=this.geometry.getBounds();b=c.intersectsBounds(d)}else{var e=c.toGeometry();b=e.intersects(this.geometry)}}return b},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(a,b,c){var d=!1;return this.geometry&&(d=this.geometry.atPoint(a,b,c)),d},destroyPopup:function(){},move:function(a){if(!this.layer||!this.geometry.move)return void 0;var b;b="OpenLayers.LonLat"==a.CLASS_NAME?this.layer.getViewPortPxFromLonLat(a):a;var c=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),d=this.layer.map.getResolution();return this.geometry.move(d*(b.x-c.x),d*(c.y-b.y)),this.layer.drawFeature(this),c},toState:function(a){if(a==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(a==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a}else if(a==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a}else a==OpenLayers.State.UNKNOWN&&(this.state=a)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}},OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(a,b){OpenLayers.Util.extend(this,b),this.rules=[],b&&b.rules&&this.addRules(b.rules),this.setDefaultStyle(a||OpenLayers.Feature.Vector.style["default"]),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a=0,b=this.rules.length;b>a;a++)this.rules[a].destroy(),this.rules[a]=null;this.rules=null,this.defaultStyle=null},createSymbolizer:function(a){for(var b,c=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),a),d=this.rules,e=[],f=!1,g=0,h=d.length;h>g;g++){b=d[g];var i=b.evaluate(a);i&&(b instanceof OpenLayers.Rule&&b.elseFilter?e.push(b):(f=!0,this.applySymbolizer(b,c,a)))}if(0==f&&e.length>0){f=!0;for(var g=0,h=e.length;h>g;g++)this.applySymbolizer(e[g],c,a)}return d.length>0&&0==f&&(c.display="none"),null!=c.label&&"string"!=typeof c.label&&(c.label=String(c.label)),c},applySymbolizer:function(a,b,c){var d=c.geometry?this.getSymbolizerPrefix(c.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],e=a.symbolizer[d]||a.symbolizer;if(this.defaultsPerSymbolizer===!0){var f=this.defaultStyle;OpenLayers.Util.applyDefaults(e,{pointRadius:f.pointRadius}),(e.stroke===!0||e.graphic===!0)&&OpenLayers.Util.applyDefaults(e,{strokeWidth:f.strokeWidth,strokeColor:f.strokeColor,strokeOpacity:f.strokeOpacity,strokeDashstyle:f.strokeDashstyle,strokeLinecap:f.strokeLinecap}),(e.fill===!0||e.graphic===!0)&&OpenLayers.Util.applyDefaults(e,{fillColor:f.fillColor,fillOpacity:f.fillOpacity}),e.graphic===!0&&OpenLayers.Util.applyDefaults(e,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(b,e),c)},createLiterals:function(a,b){var c=OpenLayers.Util.extend({},b.attributes||b.data);OpenLayers.Util.extend(c,this.context);for(var d in this.propertyStyles)a[d]=OpenLayers.Style.createLiteral(a[d],c,b,d);return a},findPropertyStyles:function(){var a={},b=this.defaultStyle;this.addPropertyStyles(a,b);for(var c,d,e=this.rules,f=0,g=e.length;g>f;f++){c=e[f].symbolizer;for(var h in c){if(d=c[h],"object"!=typeof d){this.addPropertyStyles(a,c);break}this.addPropertyStyles(a,d)}}return a},addPropertyStyles:function(a,b){var c;for(var d in b)c=b[d],"string"==typeof c&&c.match(/\$\{\w+\}/)&&(a[d]=!0);return a},addRules:function(a){Array.prototype.push.apply(this.rules,a),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(a){for(var b=OpenLayers.Style.SYMBOLIZER_PREFIXES,c=0,d=b.length;d>c;c++)if(-1!=a.CLASS_NAME.indexOf(b[c]))return b[c]},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;c>b;++b)a.rules.push(this.rules[b].clone())}a.context=this.context&&OpenLayers.Util.extend({},this.context);var d=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(d,a)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(a,b,c,d){return"string"==typeof a&&-1!=a.indexOf("${")&&(a=OpenLayers.String.format(a,b,[c,d]),a=isNaN(a)||!a?a:parseFloat(a)),a},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a)},destroy:function(){},evaluate:function(){return!0},clone:function(){return null},toString:function(){var a;return a=OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"}),OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(a){var b=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(a.geometry){var c=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(c=this.value.toGeometry()),a.geometry.intersects(c)&&(b=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return b},clone:function(){var a=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(a)},CLASS_NAME:"OpenLayers.Filter.Spatial"}),OpenLayers.Filter.Spatial.BBOX="BBOX",OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS",OpenLayers.Filter.Spatial.DWITHIN="DWITHIN",OpenLayers.Filter.Spatial.WITHIN="WITHIN",OpenLayers.Filter.Spatial.CONTAINS="CONTAINS",OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(a){this.fids=[],OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(a){for(var b=0,c=this.fids.length;c>b;b++){var d=a.fid||a.id;if(d==this.fids[b])return!0}return!1},clone:function(){var a=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(a,this),a.fids=this.fids.slice(),a},CLASS_NAME:"OpenLayers.Filter.FeatureId"}),OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(a){this.stateName={},this.stateName[OpenLayers.State.INSERT]="wfs:Insert",this.stateName[OpenLayers.State.UPDATE]="wfs:Update",this.stateName[OpenLayers.State.DELETE]="wfs:Delete",OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},getSrsName:function(a,b){var c=b&&b.srsName;return c||(c=a&&a.layer?a.layer.projection.getCode():this.srsName),c},read:function(a,b){b=b||{},OpenLayers.Util.applyDefaults(b,{output:"features"}),"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var c={};return a&&this.readNode(a,c,!0),c.features&&"features"===b.output&&(c=c.features),c},readers:{wfs:{FeatureCollection:function(a,b){b.features=[],this.readChildNodes(a,b)}}},write:function(a,b){var c=this.writeNode("wfs:Transaction",{features:a,options:b}),d=this.schemaLocationAttr();return d&&this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",d),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{wfs:{GetFeature:function(a){var b=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:a&&a.handle,outputFormat:a&&a.outputFormat,maxFeatures:a&&a.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(a)}});if("string"==typeof this.featureType)this.writeNode("Query",a,b);else for(var c=0,d=this.featureType.length;d>c;c++)a.featureType=this.featureType[c],this.writeNode("Query",a,b);return b},Transaction:function(a){a=a||{};var b,c,d=a.options||{},e=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:d.handle}}),f=a.features;if(f){d.multi===!0&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===!0?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===!0?"MultiSurface":"MultiPolygon"});var g,h;for(b=0,c=f.length;c>b;++b)h=f[b],g=this.stateName[h.state],g&&this.writeNode(g,{feature:h,options:d},e);d.multi===!0&&this.setGeometryTypes()}if(d.nativeElements)for(b=0,c=d.nativeElements.length;c>b;++b)this.writeNode("wfs:Native",d.nativeElements[b],e);return e},Native:function(a){var b=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:a.vendorId,safeToIgnore:a.safeToIgnore},value:a.value});return b},Insert:function(a){var b=a.feature,c=a.options,d=this.createElementNSPlus("wfs:Insert",{attributes:{handle:c&&c.handle}});return this.srsName=this.getSrsName(b),this.writeNode("feature:_typeName",b,d),d},Update:function(a){var b=a.feature,c=a.options,d=this.createElementNSPlus("wfs:Update",{attributes:{handle:c&&c.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var e=b.modified;null===this.geometryName||e&&void 0===e.geometry||(this.srsName=this.getSrsName(b),this.writeNode("Property",{name:this.geometryName,value:b.geometry},d));for(var f in b.attributes)void 0===b.attributes[f]||e&&e.attributes&&(!e.attributes||void 0===e.attributes[f])||this.writeNode("Property",{name:f,value:b.attributes[f]},d);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),d),d},Property:function(a){var b=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",a.name,b),null!==a.value&&this.writeNode("Value",a.value,b),b},Name:function(a){return this.createElementNSPlus("wfs:Name",{value:a})},Value:function(a){var b;if(a instanceof OpenLayers.Geometry){b=this.createElementNSPlus("wfs:Value");var c=this.writeNode("feature:_geometry",a).firstChild;b.appendChild(c)}else b=this.createElementNSPlus("wfs:Value",{value:a});return b},Delete:function(a){var b=a.feature,c=a.options,d=this.createElementNSPlus("wfs:Delete",{attributes:{handle:c&&c.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),d),d}}},schemaLocationAttr:function(a){a=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},a);var b=OpenLayers.Util.extend({},this.schemaLocations);a.schema&&(b[a.featurePrefix]=a.schema);var c,d=[];for(var e in b)c=this.namespaces[e],c&&d.push(c+" "+b[e]);var f=d.join(" ")||void 0;return f},setFilterProperty:function(a){if(a.filters)for(var b=0,c=a.filters.length;c>b;++b)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,a.filters[b]);else a instanceof OpenLayers.Filter.Spatial&&!a.property&&(a.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"}),OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a.documentElement,c={exceptionReport:null};return b&&(this.readChildNodes(a,c),null===c.exceptionReport&&(c=(new OpenLayers.Format.OWSCommon).read(a))),c},readers:{ogc:{ServiceExceptionReport:function(a,b){b.exceptionReport={exceptions:[]},this.readChildNodes(a,b.exceptionReport)},ServiceException:function(a,b){var c={code:a.getAttribute("code"),locator:a.getAttribute("locator"),text:this.getChildValue(a)};b.exceptions.push(c)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"}),OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);var b=this.CLASS_NAME;this.name=b.substring(b.lastIndexOf(".")+1)},getVersion:function(a,b){var c;return a?(c=this.version,c||(c=a.getAttribute("version"),c||(c=this.defaultVersion))):c=b&&b.version||this.version||this.defaultVersion,c},getParser:function(a){a=a||this.defaultVersion;var b=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=a){var c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")+b];if(!c&&(""!==b&&this.allowFallback&&(b="",c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")]),!c))throw"Can't find a "+this.name+" parser for version "+a+b;this.parser=new c(this.options)}return this.parser},write:function(a,b){var c=this.getVersion(null,b);this.parser=this.getParser(c);var d=this.parser.write(a,b);return this.stringifyOutput===!1?d:OpenLayers.Format.XML.prototype.write.apply(this,[d])},read:function(a,b){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var c=a.documentElement,d=this.getVersion(c);this.parser=this.getParser(d);var e=this.parser.read(a,b),f=this.parser.errorProperty||null;if(null!==f&&void 0===e[f]){var g=new OpenLayers.Format.OGCExceptionReport;e.error=g.read(a)}return e.version=d,e},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"}),OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[],OpenLayers.Filter.prototype.initialize.apply(this,[a])},destroy:function(){this.filters=null,OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(a){var b,c;switch(this.type){case OpenLayers.Filter.Logical.AND:for(b=0,c=this.filters.length;c>b;b++)if(0==this.filters[b].evaluate(a))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(b=0,c=this.filters.length;c>b;b++)if(1==this.filters[b].evaluate(a))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(a)}return void 0},clone:function(){for(var a=[],b=0,c=this.filters.length;c>b;++b)a.push(this.filters[b].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:a})},CLASS_NAME:"OpenLayers.Filter.Logical"}),OpenLayers.Filter.Logical.AND="&&",OpenLayers.Filter.Logical.OR="||",OpenLayers.Filter.Logical.NOT="!",OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a]),this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===a.matchCase&&(this.matchCase=null)},evaluate:function(a){a instanceof OpenLayers.Feature.Vector&&(a=a.attributes);var b,c=!1,d=a[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:b=this.value,c=this.matchCase||"string"!=typeof d||"string"!=typeof b?d==b:d.toUpperCase()==b.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:b=this.value,c=this.matchCase||"string"!=typeof d||"string"!=typeof b?d!=b:d.toUpperCase()!=b.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:c=d<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:c=d>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:c=d<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:c=d>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:c=d>=this.lowerBoundary&&d<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:var e=new RegExp(this.value,"gi");c=e.test(d);break;case OpenLayers.Filter.Comparison.IS_NULL:c=null===d}return c},value2regex:function(a,b,c){if("."==a)throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");return a=a?a:"*",b=b?b:".",c=c?c:"!",this.value=this.value.replace(new RegExp("\\"+c+"(.|$)","g"),"\\$1"),this.value=this.value.replace(new RegExp("\\"+b,"g"),"."),this.value=this.value.replace(new RegExp("\\"+a,"g"),".*"),this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+a),this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+b),this.value},regex2value:function(){var a=this.value;return a=a.replace(/!/g,"!!"),a=a.replace(/(\\)?\\\./g,function(a,b){return b?a:"!."}),a=a.replace(/(\\)?\\\*/g,function(a,b){return b?a:"!*"}),a=a.replace(/\\\\/g,"\\"),a=a.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"}),OpenLayers.Filter.Comparison.EQUAL_TO="==",OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=",OpenLayers.Filter.Comparison.LESS_THAN="<",OpenLayers.Filter.Comparison.GREATER_THAN=">",OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",OpenLayers.Filter.Comparison.BETWEEN="..",OpenLayers.Filter.Comparison.LIKE="~",OpenLayers.Filter.Comparison.IS_NULL="NULL",OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"}),OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"}),OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){return"toISOString"in Date.prototype?function(a){return a.toISOString()}:function(a){var b;return b=isNaN(a.getTime())?"Invalid Date":a.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(a.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(a.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(a.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(a.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(a.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(a.getUTCMilliseconds(),3)+"Z"}}(),parse:function(a){var b,c=a.match(this.dateRegEx);if(c&&(c[1]||c[7])){var d=parseInt(c[1],10)||0,e=parseInt(c[2],10)-1||0,f=parseInt(c[3],10)||1;b=new Date(Date.UTC(d,e,f));var g=c[7];if(g){var h=parseInt(c[4],10),i=parseInt(c[5],10),j=parseFloat(c[6]),k=0|j,l=Math.round(1e3*(j-k));if(b.setUTCHours(h,i,k,l),"Z"!==g){var m=parseInt(g,10),n=parseInt(c[8],10)||0,o=-1e3*(3600*m+60*n);b=new Date(b.getTime()+o)}}}else b=new Date("invalid");return b}},OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){var b={};return this.readers.ogc.Filter.apply(this,[a,b]),b.filter},readers:{ogc:{_expression:function(a){for(var b,c="",d=a.firstChild;d;d=d.nextSibling)switch(d.nodeType){case 1:b=this.readNode(d),b.property?c+="${"+b.property+"}":void 0!==b.value&&(c+=b.value);break;case 3:case 4:c+=d.nodeValue}return c},Filter:function(a,b){var c={fids:[],filters:[]};this.readChildNodes(a,c),c.fids.length>0?b.filter=new OpenLayers.Filter.FeatureId({fids:c.fids}):c.filters.length>0&&(b.filter=c.filters[0])},FeatureId:function(a,b){var c=a.getAttribute("fid");c&&b.fids.push(c)},And:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(a,c),b.filters.push(c)},Or:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(a,c),b.filters.push(c)},Not:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLessThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsGreaterThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(a,c),b.filters.push(c)
},PropertyIsLessThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsGreaterThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsBetween:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(a,c),b.filters.push(c)},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a),!0)},PropertyName:function(a,b){b.property=this.getChildValue(a)},LowerBoundary:function(a,b){b.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a),!0)},UpperBoundary:function(a,b){b.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a),!0)},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a)),b.distanceUnits=a.getAttribute("units")},Function:function(){},PropertyIsNull:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(a,c),b.filters.push(c)}}},readSpatial:function(a,b,c){var d=new OpenLayers.Filter.Spatial({type:c});this.readChildNodes(a,d),d.value=d.components[0],delete d.components,b.filters.push(d)},encodeLiteral:function(a){return a instanceof Date&&(a=OpenLayers.Date.toISOString(a)),a},writeOgcExpression:function(a,b){return a instanceof OpenLayers.Filter.Function?this.writeNode("Function",a,b):this.writeNode("Literal",a,b),b},write:function(a){return this.writers.ogc.Filter.apply(this,[a])},writers:{ogc:{Filter:function(a){var b=this.createElementNSPlus("ogc:Filter");return this.writeNode(this.getFilterType(a),a,b),b},_featureIds:function(a){for(var b=this.createDocumentFragment(),c=0,d=a.fids.length;d>c;++c)this.writeNode("ogc:FeatureId",a.fids[c],b);return b},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}})},And:function(a){for(var b,c=this.createElementNSPlus("ogc:And"),d=0,e=a.filters.length;e>d;++d)b=a.filters[d],this.writeNode(this.getFilterType(b),b,c);return c},Or:function(a){for(var b,c=this.createElementNSPlus("ogc:Or"),d=0,e=a.filters.length;e>d;++d)b=a.filters[d],this.writeNode(this.getFilterType(b),b,c);return c},Not:function(a){var b=this.createElementNSPlus("ogc:Not"),c=a.filters[0];return this.writeNode(this.getFilterType(c),c,b),b},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsGreaterThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",a,b),this.writeNode("LowerBoundary",a,b),this.writeNode("UpperBoundary",a,b),b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})},Literal:function(a){var b=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:b(a)})},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(a.lowerBoundary,b),b},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",a.upperBoundary,b),b},INTERSECTS:function(a){return this.writeSpatial(a,"Intersects")},WITHIN:function(a){return this.writeSpatial(a,"Within")},CONTAINS:function(a){return this.writeSpatial(a,"Contains")},DWITHIN:function(a){var b=this.writeSpatial(a,"DWithin");return this.writeNode("Distance",a,b),b},Distance:function(a){return this.createElementNSPlus("ogc:Distance",{attributes:{units:a.distanceUnits},value:a.distance})},Function:function(a){for(var b=this.createElementNSPlus("ogc:Function",{attributes:{name:a.name}}),c=a.params,d=0,e=c.length;e>d;d++)this.writeOgcExpression(c[d],b);return b},PropertyIsNull:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNull");return this.writeNode("PropertyName",a,b),b}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b)throw"Filter writing not supported for rule type: "+a.type;return b},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"}),OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(a){a&&(this.bounds=a.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(a){var b=this.getBounds();b?this.bounds.extend(a):this.setBounds(a)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(a,b,c){var d=!1,e=this.getBounds();if(null!=e&&null!=a){var f=null!=b?b:0,g=null!=c?c:0,h=new OpenLayers.Bounds(this.bounds.left-f,this.bounds.bottom-g,this.bounds.right+f,this.bounds.top+g);d=h.containsLonLat(a)}return d},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var a;return a=OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(a){var b;if(OpenLayers.Format&&OpenLayers.Format.WKT){var c=OpenLayers.Geometry.fromWKT.format;c||(c=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=c);var d=c.read(a);if(d instanceof OpenLayers.Feature.Vector)b=d.geometry;else if(OpenLayers.Util.isArray(d)){for(var e=d.length,f=new Array(e),g=0;e>g;++g)f[g]=d[g].geometry;b=new OpenLayers.Geometry.Collection(f)}}return b},OpenLayers.Geometry.segmentsIntersect=function(a,b,c){var d=c&&c.point,e=c&&c.tolerance,f=!1,g=a.x1-b.x1,h=a.y1-b.y1,i=a.x2-a.x1,j=a.y2-a.y1,k=b.y2-b.y1,l=b.x2-b.x1,m=k*i-l*j,n=l*h-k*g,o=i*h-j*g;if(0==m)0==n&&0==o&&(f=!0);else{var p=n/m,q=o/m;if(p>=0&&1>=p&&q>=0&&1>=q)if(d){var r=a.x1+p*i,s=a.y1+p*j;f=new OpenLayers.Geometry.Point(r,s)}else f=!0}if(e){var t;if(f){if(d){var u,r,s,v=[a,b];a:for(var w=0;2>w;++w){u=v[w];for(var x=1;3>x;++x)if(r=u["x"+x],s=u["y"+x],t=Math.sqrt(Math.pow(r-f.x,2)+Math.pow(s-f.y,2)),e>t){f.x=r,f.y=s;break a}}}}else{var y,z,r,s,A,B,v=[a,b];a:for(var w=0;2>w;++w){y=v[w],z=v[(w+1)%2];for(var x=1;3>x;++x)if(A={x:y["x"+x],y:y["y"+x]},B=OpenLayers.Geometry.distanceToSegment(A,z),B.distance<e){f=d?new OpenLayers.Geometry.Point(A.x,A.y):!0;break a}}}}return f},OpenLayers.Geometry.distanceToSegment=function(a,b){var c=OpenLayers.Geometry.distanceSquaredToSegment(a,b);return c.distance=Math.sqrt(c.distance),c},OpenLayers.Geometry.distanceSquaredToSegment=function(a,b){var c,d,e=a.x,f=a.y,g=b.x1,h=b.y1,i=b.x2,j=b.y2,k=i-g,l=j-h,m=(k*(e-g)+l*(f-h))/(Math.pow(k,2)+Math.pow(l,2));return 0>=m?(c=g,d=h):m>=1?(c=i,d=j):(c=g+m*k,d=h+m*l),{distance:Math.pow(c-e,2)+Math.pow(d-f,2),x:c,y:d,along:m}},OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(a),this.y=parseFloat(b)},clone:function(a){return null==a&&(a=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(a,this),a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(a,b){var c,d,e,f,g,h,i=!(b&&b.edge===!1),j=i&&b&&b.details;return a instanceof OpenLayers.Geometry.Point?(d=this.x,e=this.y,f=a.x,g=a.y,c=Math.sqrt(Math.pow(d-f,2)+Math.pow(e-g,2)),h=j?{x0:d,y0:e,x1:f,y1:g,distance:c}:c):(h=a.distanceTo(this,b),j&&(h={x0:h.x1,y0:h.y1,x1:h.x0,y1:h.y0,distance:h.distance})),h},equals:function(a){var b=!1;return null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)),b},toShortString:function(){return this.x+", "+this.y},move:function(a,b){this.x=this.x+a,this.y=this.y+b,this.clearBounds()},rotate:function(a,b){a*=Math.PI/180;var c=this.distanceTo(b),d=a+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+c*Math.cos(d),this.y=b.y+c*Math.sin(d),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(a,b,c){return c=void 0==c?1:c,this.x=b.x+a*c*(this.x-b.x),this.y=b.y+a*(this.y-b.y),this.clearBounds(),this},intersects:function(a){var b=!1;return b="OpenLayers.Geometry.Point"==a.CLASS_NAME?this.equals(a):a.intersects(this)},transform:function(a,b){return a&&b&&(OpenLayers.Projection.transform(this,a,b),this.bounds=null),this},getVertices:function(){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=a&&this.addComponents(a)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;len>i;i++)geometry.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var a=[],b=0,c=this.components.length;c>b;b++)a.push(this.components[b].toShortString());return a.join(",")},calculateBounds:function(){this.bounds=null;var a=new OpenLayers.Bounds,b=this.components;if(b)for(var c=0,d=b.length;d>c;c++)a.extend(b[c].getBounds());null!=a.left&&null!=a.bottom&&null!=a.right&&null!=a.top&&this.setBounds(a)},addComponents:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;c>b;b++)this.addComponent(a[b])},addComponent:function(a,b){var c=!1;if(a&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,a.CLASS_NAME)>-1)){if(null!=b&&b<this.components.length){var d=this.components.slice(0,b),e=this.components.slice(b,this.components.length);d.push(a),this.components=d.concat(e)}else this.components.push(a);a.parent=this,this.clearBounds(),c=!0}return c},removeComponents:function(a){var b=!1;OpenLayers.Util.isArray(a)||(a=[a]);for(var c=a.length-1;c>=0;--c)b=this.removeComponent(a[c])||b;return b},removeComponent:function(a){return OpenLayers.Util.removeItem(this.components,a),this.clearBounds(),!0},getLength:function(){for(var a=0,b=0,c=this.components.length;c>b;b++)a+=this.components[b].getLength();return a},getArea:function(){for(var a=0,b=0,c=this.components.length;c>b;b++)a+=this.components[b].getArea();return a},getGeodesicArea:function(a){for(var b=0,c=0,d=this.components.length;d>c;c++)b+=this.components[c].getGeodesicArea(a);return b},getCentroid:function(a){if(!a)return this.components.length&&this.components[0].getCentroid();var b=this.components.length;if(!b)return!1;for(var c,d=[],e=[],f=0,g=Number.MAX_VALUE,h=0;b>h;++h){c=this.components[h];var i=c.getArea(),j=c.getCentroid(!0);isNaN(i)||isNaN(j.x)||isNaN(j.y)||(d.push(i),f+=i,g=g>i&&i>0?i:g,e.push(j))}if(b=d.length,0===f){for(var h=0;b>h;++h)d[h]=1;f=d.length}else{for(var h=0;b>h;++h)d[h]/=g;f/=g}for(var j,i,k=0,l=0,h=0;b>h;++h)j=e[h],i=d[h],k+=j.x*i,l+=j.y*i;return new OpenLayers.Geometry.Point(k/f,l/f)},getGeodesicLength:function(a){for(var b=0,c=0,d=this.components.length;d>c;c++)b+=this.components[c].getGeodesicLength(a);return b},move:function(a,b){for(var c=0,d=this.components.length;d>c;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;d>c;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0;d<this.components.length;++d)this.components[d].resize(a,b,c);return this},distanceTo:function(a,b){for(var c,d,e,f=!(b&&b.edge===!1),g=f&&b&&b.details,h=Number.POSITIVE_INFINITY,i=0,j=this.components.length;j>i&&(c=this.components[i].distanceTo(a,b),e=g?c.distance:c,!(h>e&&(h=e,d=c,0==h)));++i);return d},equals:function(a){var b=!0;if(a&&a.CLASS_NAME&&this.CLASS_NAME==a.CLASS_NAME)if(OpenLayers.Util.isArray(a.components)&&a.components.length==this.components.length){for(var c=0,d=this.components.length;d>c;++c)if(!this.components[c].equals(a.components[c])){b=!1;break}}else b=!1;else b=!1;return b},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;d>c;c++){var e=this.components[c];e.transform(a,b)}this.bounds=null}return this},intersects:function(a){for(var b=!1,c=0,d=this.components.length;d>c&&!(b=a.intersects(this.components[c]));++c);return b},getVertices:function(a){for(var b=[],c=0,d=this.components.length;d>c;++c)Array.prototype.push.apply(b,this.components[c].getVertices(a));return b},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var a=0;if(this.components&&this.components.length>1)for(var b=1,c=this.components.length;c>b;b++)a+=this.components[b-1].distanceTo(this.components[b]);return a},getGeodesicLength:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))}var d=0;if(b.components&&b.components.length>1)for(var e,f,g=1,h=b.components.length;h>g;g++)e=b.components[g-1],f=b.components[g],d+=OpenLayers.Util.distVincenty({lon:e.x,lat:e.y},{lon:f.x,lat:f.y});return 1e3*d},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(){var a=this.components&&this.components.length>2;return a&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),a},intersects:function(a){var b=!1,c=a.CLASS_NAME;if("OpenLayers.Geometry.LineString"==c||"OpenLayers.Geometry.LinearRing"==c||"OpenLayers.Geometry.Point"==c){var d,e=this.getSortedSegments();d="OpenLayers.Geometry.Point"==c?[{x1:a.x,y1:a.y,x2:a.x,y2:a.y}]:a.getSortedSegments();var f,g,h,i,j,k,l,m;a:for(var n=0,o=e.length;o>n;++n){f=e[n],g=f.x1,h=f.x2,i=f.y1,j=f.y2;for(var p=0,q=d.length;q>p&&(k=d[p],!(k.x1>h));++p)if(!(k.x2<g||(l=k.y1,m=k.y2,Math.min(l,m)>Math.max(i,j)||Math.max(l,m)<Math.min(i,j)||!OpenLayers.Geometry.segmentsIntersect(f,k)))){b=!0;break a}}}else b=a.intersects(this);return b},getSortedSegments:function(){function a(a,b){return a.x1-b.x1}for(var b,c,d=this.components.length-1,e=new Array(d),f=0;d>f;++f)b=this.components[f],c=this.components[f+1],e[f]=b.x<c.x?{x1:b.x,y1:b.y,x2:c.x,y2:c.y}:{x1:c.x,y1:c.y,x2:b.x,y2:b.y};return e.sort(a)},splitWithSegment:function(a,b){for(var c,d,e,f,g,h=!(b&&b.edge===!1),i=b&&b.tolerance,j=[],k=this.getVertices(),l=[],m=[],n=!1,o={point:!0,tolerance:i},p=null,q=0,r=k.length-2;r>=q;++q)if(c=k[q],l.push(c.clone()),d=k[q+1],g={x1:c.x,y1:c.y,x2:d.x,y2:d.y},e=OpenLayers.Geometry.segmentsIntersect(a,g,o),e instanceof OpenLayers.Geometry.Point&&(f=e.x===a.x1&&e.y===a.y1||e.x===a.x2&&e.y===a.y2||e.equals(c)||e.equals(d)?!0:!1,f||h)){if(e.equals(m[m.length-1])||m.push(e.clone()),0===q&&e.equals(c))continue;if(e.equals(d))continue;n=!0,e.equals(c)||l.push(e),j.push(new OpenLayers.Geometry.LineString(l)),l=[e.clone()]}if(n&&(l.push(d.clone()),j.push(new OpenLayers.Geometry.LineString(l))),m.length>0){var s=a.x1<a.x2?1:-1,t=a.y1<a.y2?1:-1;p={lines:j,points:m.sort(function(a,b){return s*a.x-s*b.x||t*a.y-t*b.y})}}return p},split:function(a,b){var c,d,e,f,g=null,h=b&&b.mutual;if(a instanceof OpenLayers.Geometry.LineString){var i,j,k,l,m,n,o=this.getVertices(),p=[];e=[];for(var q=0,r=o.length-2;r>=q;++q){i=o[q],j=o[q+1],k={x1:i.x,y1:i.y,x2:j.x,y2:j.y},f=f||[a],h&&p.push(i.clone());for(var s=0;s<f.length;++s)if(l=f[s].splitWithSegment(k,b),l&&(m=l.lines,m.length>0&&(m.unshift(s,1),Array.prototype.splice.apply(f,m),s+=m.length-2),h))for(var t=0,u=l.points.length;u>t;++t)n=l.points[t],n.equals(i)||(p.push(n),e.push(new OpenLayers.Geometry.LineString(p)),p=n.equals(j)?[]:[n.clone()])}h&&e.length>0&&p.length>0&&(p.push(j.clone()),e.push(new OpenLayers.Geometry.LineString(p)))}else g=a.splitWith(this,b);return f&&f.length>1?d=!0:f=[],e&&e.length>1?c=!0:e=[],(d||c)&&(g=h?[e,f]:f),g},splitWith:function(a,b){return a.split(this,b)},getVertices:function(a){var b;return b=a===!0?[this.components[0],this.components[this.components.length-1]]:a===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(a,b){var c,d=!(b&&b.edge===!1),e=d&&b&&b.details,f={},g=Number.POSITIVE_INFINITY;if(a instanceof OpenLayers.Geometry.Point){for(var h,i=this.getSortedSegments(),j=a.x,k=a.y,l=0,m=i.length;m>l;++l)if(h=i[l],c=OpenLayers.Geometry.distanceToSegment(a,h),c.distance<g){if(g=c.distance,f=c,0===g)break}else if(h.x2>j&&(k>h.y1&&k<h.y2||k<h.y1&&k>h.y2))break;f=e?{distance:f.distance,x0:f.x,y0:f.y,x1:j,y1:k}:f.distance}else if(a instanceof OpenLayers.Geometry.LineString){var n,o,p,q,r,s=this.getSortedSegments(),t=a.getSortedSegments(),u=t.length,v={point:!0};a:for(var l=0,m=s.length;m>l;++l){n=s[l],q=n.x1,r=n.y1;for(var w=0;u>w;++w){if(o=t[w],p=OpenLayers.Geometry.segmentsIntersect(n,o,v)){g=0,f={distance:0,x0:p.x,y0:p.y,x1:p.x,y1:p.y};break a}c=OpenLayers.Geometry.distanceToSegment({x:q,y:r},o),c.distance<g&&(g=c.distance,f={distance:g,x0:q,y0:r,x1:c.x,y1:c.y})}}if(e||(f=f.distance),0!==g&&n){c=a.distanceTo(new OpenLayers.Geometry.Point(n.x2,n.y2),b);var x=e?c.distance:c;g>x&&(f=e?{distance:g,x0:c.x1,y0:c.y1,x1:c.x0,y1:c.y0}:x)}}else f=a.distanceTo(this,b),e&&(f={distance:f.distance,x0:f.x1,y0:f.y1,x1:f.x0,y1:f.y0});return f},simplify:function(a){if(this&&null!==this){var b=this.getVertices();if(b.length<3)return this;var c=function(a,b){return a-b},d=function(a,b,c,f){for(var g,i=0,j=0,k=b;c>k;k++)g=e(a[b],a[c],a[k]),g>i&&(i=g,j=k);i>f&&j!=b&&(h.push(j),d(a,b,j,f),d(a,j,c,f))},e=function(a,b,c){var d=Math.abs(.5*(a.x*b.y+b.x*c.y+c.x*a.y-b.x*a.y-c.x*b.y-a.x*c.y)),e=Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)),f=d/e*2;return f},f=0,g=b.length-1,h=[];for(h.push(f),h.push(g);b[f].equals(b[g]);)g--,h.push(g);d(b,f,g,a);var i=[];h.sort(c);for(var j=0;j<h.length;j++)i.push(b[h[j]]);return new OpenLayers.Geometry.LineString(i)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(a,b){for(var c,d,e,f,g,h=null,i=b&&b.mutual,j=[],k=[a],l=0,m=this.components.length;m>l;++l){d=this.components[l],f=!1;for(var n=0;n<k.length;++n)if(c=d.split(k[n],b)){if(i){e=c[0];for(var o=0,p=e.length;p>o;++o)0===o&&j.length?j[j.length-1].addComponent(e[o]):j.push(new OpenLayers.Geometry.MultiLineString([e[o]]));f=!0,c=c[1]}if(c.length){c.unshift(n,1),Array.prototype.splice.apply(k,c);break}}f||(j.length?j[j.length-1].addComponent(d.clone()):j=[new OpenLayers.Geometry.MultiLineString(d.clone())])}return j&&j.length>1?f=!0:j=[],k&&k.length>1?g=!0:k=[],(f||g)&&(h=i?[j,k]:k),h},splitWith:function(a,b){var c,d,e,f,g,h,i,j=null,k=b&&b.mutual;if(a instanceof OpenLayers.Geometry.LineString){i=[],h=[a];for(var l=0,m=this.components.length;m>l;++l){g=!1,d=this.components[l];for(var n=0;n<h.length;++n)if(c=h[n].split(d,b)){k&&(e=c[0],e.length&&(e.unshift(n,1),Array.prototype.splice.apply(h,e),n+=e.length-2),c=c[1],0===c.length&&(c=[d.clone()]));for(var o=0,p=c.length;p>o;++o)0===o&&i.length?i[i.length-1].addComponent(c[o]):i.push(new OpenLayers.Geometry.MultiLineString([c[o]]));g=!0}g||(i.length?i[i.length-1].addComponent(d.clone()):i=[new OpenLayers.Geometry.MultiLineString([d.clone()])])}}else j=a.split(this);return h&&h.length>1?f=!0:h=[],i&&i.length>1?g=!0:i=[],(f||g)&&(j=k?[h,i]:i),j},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(a,b){var c=!1,d=this.components.pop();null==b&&a.equals(d)||(c=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var e=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[e]),c},removeComponent:function(){var a=this.components&&this.components.length>3;if(a){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var b=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[b])}return a},move:function(a,b){for(var c=0,d=this.components.length;d-1>c;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;d-1>c;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0,e=this.components.length;e-1>d;++d)this.components[d].resize(a,b,c);return this},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;d-1>c;c++){var e=this.components[c];e.transform(a,b)}this.bounds=null}return this},getCentroid:function(){if(this.components){var a=this.components.length;if(a>0&&2>=a)return this.components[0].clone();if(a>2){var b=0,c=0,d=this.components[0].x,e=this.components[0].y,f=-1*this.getArea();if(0!=f){for(var g=0;a-1>g;g++){var h=this.components[g],i=this.components[g+1];b+=(h.x+i.x-2*d)*((h.x-d)*(i.y-e)-(i.x-d)*(h.y-e)),c+=(h.y+i.y-2*e)*((h.x-d)*(i.y-e)-(i.x-d)*(h.y-e))}var j=d+b/(6*f),k=e+c/(6*f)}else{for(var g=0;a-1>g;g++)b+=this.components[g].x,c+=this.components[g].y;var j=b/(a-1),k=c/(a-1)}return new OpenLayers.Geometry.Point(j,k)}return null}},getArea:function(){var a=0;if(this.components&&this.components.length>2){for(var b=0,c=0,d=this.components.length;d-1>c;c++){var e=this.components[c],f=this.components[c+1];b+=(e.x+f.x)*(f.y-e.y)}a=-b/2}return a},getGeodesicArea:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))}var d=0,e=b.components&&b.components.length;if(e>2){for(var f,g,h=0;e-1>h;h++)f=b.components[h],g=b.components[h+1],d+=OpenLayers.Util.rad(g.x-f.x)*(2+Math.sin(OpenLayers.Util.rad(f.y))+Math.sin(OpenLayers.Util.rad(g.y)));d=6378137*d*6378137/2}return d},containsPoint:function(a){function b(a,b,c,d,e){return(a-e)*((d-b)/(e-c))+d}for(var c,d,e,f,g,h,i,j=OpenLayers.Number.limitSigDigs,k=14,l=j(a.x,k),m=j(a.y,k),n=this.components.length-1,o=0,p=0;n>p;++p)if(c=this.components[p],e=j(c.x,k),f=j(c.y,k),d=this.components[p+1],g=j(d.x,k),h=j(d.y,k),f!=h){if(i=j(b(m,e,f,g,h),k),i==l&&(h>f&&m>=f&&h>=m||f>h&&f>=m&&m>=h)){o=-1;break}l>=i||e!=g&&(i<Math.min(e,g)||i>Math.max(e,g))||(h>f&&m>=f&&h>m||f>h&&f>m&&m>=h)&&++o}else if(m==f&&(g>=e&&l>=e&&g>=l||e>=g&&e>=l&&l>=g)){o=-1;break}var q=-1==o?1:!!(1&o);return q},intersects:function(a){var b=!1;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)b=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME)b=a.intersects(this);else if("OpenLayers.Geometry.LinearRing"==a.CLASS_NAME)b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[a]);else for(var c=0,d=a.components.length;d>c&&!(b=a.components[c].intersects(this));++c);return b},getVertices:function(a){return a===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var a=0;if(this.components&&this.components.length>0){a+=Math.abs(this.components[0].getArea());for(var b=1,c=this.components.length;c>b;b++)a-=Math.abs(this.components[b].getArea())}return a},getGeodesicArea:function(a){var b=0;if(this.components&&this.components.length>0){b+=Math.abs(this.components[0].getGeodesicArea(a));for(var c=1,d=this.components.length;d>c;c++)b-=Math.abs(this.components[c].getGeodesicArea(a))}return b},containsPoint:function(a){var b=this.components.length,c=!1;if(b>0&&(c=this.components[0].containsPoint(a),1!==c&&c&&b>1))for(var d,e=1;b>e;++e)if(d=this.components[e].containsPoint(a)){c=1===d?1:!1;break}return c},intersects:function(a){var b,c,d=!1;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)d=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME){for(b=0,c=this.components.length;c>b&&!(d=a.intersects(this.components[b]));++b);if(!d)for(b=0,c=a.components.length;c>b&&!(d=this.containsPoint(a.components[b]));++b);}else for(b=0,c=a.components.length;c>b&&!(d=this.intersects(a.components[b]));++b);if(!d&&"OpenLayers.Geometry.Polygon"==a.CLASS_NAME){var e=this.components[0];for(b=0,c=e.components.length;c>b&&!(d=a.containsPoint(e.components[b]));++b);}return d},distanceTo:function(a,b){var c,d=!(b&&b.edge===!1);return c=!d&&this.intersects(a)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[a,b])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(a,b,c,d){var e=Math.PI*(1/c-.5);d&&(e+=d/180*Math.PI);for(var f,g,h,i=[],j=0;c>j;++j)f=e+2*j*Math.PI/c,g=a.x+b*Math.cos(f),h=a.y+b*Math.sin(f),i.push(new OpenLayers.Geometry.Point(g,h));var k=new OpenLayers.Geometry.LinearRing(i);return new OpenLayers.Geometry.Polygon([k])},OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(a){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b=this.getElementsByTagNameNS(a.documentElement,this.gmlns,this.featureName),c=[],d=0;d<b.length;d++){var e=this.parseFeature(b[d]);e&&c.push(e)}return c},parseFeature:function(a){for(var b,c,d,e,f=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],g=0;g<f.length;++g)if(b=f[g],c=this.getElementsByTagNameNS(a,this.gmlns,b),c.length>0){if(e=this.parseGeometry[b.toLowerCase()],!e)throw new TypeError("Unsupported geometry type: "+b);d=e.apply(this,[c[0]]),this.internalProjection&&this.externalProjection&&d.transform(this.externalProjection,this.internalProjection);break}var h,i=this.getElementsByTagNameNS(a,this.gmlns,"Box");for(g=0;g<i.length;++g){var j=i[g],k=this.parseGeometry.box.apply(this,[j]),l=j.parentNode,m=l.localName||l.nodeName.split(":").pop();"boundedBy"===m?h=k:d=k.toGeometry()}var n;this.extractAttributes&&(n=this.parseAttributes(a));var o=new OpenLayers.Feature.Vector(d,n);o.bounds=h,o.gml={featureType:a.firstChild.nodeName.split(":")[1],featureNS:a.firstChild.namespaceURI,featureNSPrefix:a.firstChild.prefix};for(var p,q=a.firstChild;q&&(1!=q.nodeType||!(p=q.getAttribute("fid")||q.getAttribute("id")));)q=q.nextSibling;return o.fid=p,o},parseGeometry:{point:function(a){var b,c,d=[],b=this.getElementsByTagNameNS(a,this.gmlns,"pos");if(b.length>0&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),d=c.split(this.regExes.splitSpace)),0==d.length&&(b=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),b.length>0&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.removeSpace,""),d=c.split(","))),0==d.length&&(b=this.getElementsByTagNameNS(a,this.gmlns,"coord"),b.length>0)){var e=this.getElementsByTagNameNS(b[0],this.gmlns,"X"),f=this.getElementsByTagNameNS(b[0],this.gmlns,"Y");e.length>0&&f.length>0&&(d=[e[0].firstChild.nodeValue,f[0].firstChild.nodeValue])}return 2==d.length&&(d[2]=null),this.xy?new OpenLayers.Geometry.Point(d[0],d[1],d[2]):new OpenLayers.Geometry.Point(d[1],d[0],d[2])},multipoint:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"Point"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)d=this.parseGeometry.point.apply(this,[b[e]]),d&&c.push(d);return new OpenLayers.Geometry.MultiPoint(c)},linestring:function(a,b){var c,d,e=[],f=[];if(c=this.getElementsByTagNameNS(a,this.gmlns,"posList"),c.length>0){d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,""),e=d.split(this.regExes.splitSpace);for(var g,h,i,j,k=parseInt(c[0].getAttribute("dimension")),l=0;l<e.length/k;++l)g=l*k,h=e[g],i=e[g+1],j=2==k?null:e[g+2],f.push(this.xy?new OpenLayers.Geometry.Point(h,i,j):new OpenLayers.Geometry.Point(i,h,j))}if(0==e.length&&(c=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),c.length>0)){d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,""),d=d.replace(this.regExes.trimComma,",");for(var m=d.split(this.regExes.splitSpace),l=0;l<m.length;++l)e=m[l].split(","),2==e.length&&(e[2]=null),f.push(this.xy?new OpenLayers.Geometry.Point(e[0],e[1],e[2]):new OpenLayers.Geometry.Point(e[1],e[0],e[2]))}var n=null;return 0!=f.length&&(n=b?new OpenLayers.Geometry.LinearRing(f):new OpenLayers.Geometry.LineString(f)),n},multilinestring:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"LineString"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)d=this.parseGeometry.linestring.apply(this,[b[e]]),d&&c.push(d);return new OpenLayers.Geometry.MultiLineString(c)},polygon:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"LinearRing"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)d=this.parseGeometry.linestring.apply(this,[b[e],!0]),d&&c.push(d);return new OpenLayers.Geometry.Polygon(c)},multipolygon:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"Polygon"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)d=this.parseGeometry.polygon.apply(this,[b[e]]),d&&c.push(d);return new OpenLayers.Geometry.MultiPolygon(c)},envelope:function(a){var b,c,d=[],e=this.getElementsByTagNameNS(a,this.gmlns,"lowerCorner");if(e.length>0){var f=[];if(e.length>0&&(b=e[0].firstChild.nodeValue,b=b.replace(this.regExes.trimSpace,""),f=b.split(this.regExes.splitSpace)),2==f.length&&(f[2]=null),this.xy)var g=new OpenLayers.Geometry.Point(f[0],f[1],f[2]);else var g=new OpenLayers.Geometry.Point(f[1],f[0],f[2])}var h=this.getElementsByTagNameNS(a,this.gmlns,"upperCorner");if(h.length>0){var f=[];if(h.length>0&&(b=h[0].firstChild.nodeValue,b=b.replace(this.regExes.trimSpace,""),f=b.split(this.regExes.splitSpace)),2==f.length&&(f[2]=null),this.xy)var i=new OpenLayers.Geometry.Point(f[0],f[1],f[2]);else var i=new OpenLayers.Geometry.Point(f[1],f[0],f[2])
}if(g&&i){d.push(new OpenLayers.Geometry.Point(g.x,g.y)),d.push(new OpenLayers.Geometry.Point(i.x,g.y)),d.push(new OpenLayers.Geometry.Point(i.x,i.y)),d.push(new OpenLayers.Geometry.Point(g.x,i.y)),d.push(new OpenLayers.Geometry.Point(g.x,g.y));var j=new OpenLayers.Geometry.LinearRing(d);c=new OpenLayers.Geometry.Polygon([j])}return c},box:function(a){var b,c,d=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),e=null,f=null;return d.length>0&&(b=d[0].firstChild.nodeValue,c=b.split(" "),2==c.length&&(e=c[0].split(","),f=c[1].split(","))),null!==e&&null!==f?new OpenLayers.Bounds(parseFloat(e[0]),parseFloat(e[1]),parseFloat(f[0]),parseFloat(f[1])):void 0}},parseAttributes:function(a){for(var b,c,d,e,f,g,h,i={},j=a.firstChild;j;){if(1==j.nodeType){for(b=j.childNodes,c=0;c<b.length;++c)d=b[c],1==d.nodeType&&(e=d.childNodes,1==e.length?(f=e[0],(3==f.nodeType||4==f.nodeType)&&(g=d.prefix?d.nodeName.split(":")[1]:d.nodeName,h=f.nodeValue.replace(this.regExes.trimSpace,""),i[g]=h)):i[d.nodeName.split(":").pop()]=null);break}j=j.nextSibling}return i},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),c=0;c<a.length;c++)b.appendChild(this.createFeatureXML(a[c]));return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=a.geometry,c=this.buildGeometryNode(b),d=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);d.appendChild(c);var e=this.createElementNS(this.gmlns,"gml:"+this.featureName),f=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),g=a.fid||a.id;f.setAttribute("fid",g),f.appendChild(d);for(var h in a.attributes){var i=this.createTextNode(a.attributes[h]),j=h.substring(h.lastIndexOf(":")+1),k=this.createElementNS(this.featureNS,this.featurePrefix+":"+j);k.appendChild(i),f.appendChild(k)}return e.appendChild(f),e},buildGeometryNode:function(a){this.externalProjection&&this.internalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME,c=b.substring(b.lastIndexOf(".")+1),d=this.buildGeometry[c.toLowerCase()];return d.apply(this,[a])},buildGeometry:{point:function(a){var b=this.createElementNS(this.gmlns,"gml:Point");return b.appendChild(this.buildCoordinatesNode(a)),b},multipoint:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:MultiPoint"),e=a.components,f=0;f<e.length;f++)b=this.createElementNS(this.gmlns,"gml:pointMember"),c=this.buildGeometry.point.apply(this,[e[f]]),b.appendChild(c),d.appendChild(b);return d},linestring:function(a){var b=this.createElementNS(this.gmlns,"gml:LineString");return b.appendChild(this.buildCoordinatesNode(a)),b},multilinestring:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:MultiLineString"),e=a.components,f=0;f<e.length;++f)b=this.createElementNS(this.gmlns,"gml:lineStringMember"),c=this.buildGeometry.linestring.apply(this,[e[f]]),b.appendChild(c),d.appendChild(b);return d},linearring:function(a){var b=this.createElementNS(this.gmlns,"gml:LinearRing");return b.appendChild(this.buildCoordinatesNode(a)),b},polygon:function(a){for(var b,c,d,e=this.createElementNS(this.gmlns,"gml:Polygon"),f=a.components,g=0;g<f.length;++g)d=0==g?"outerBoundaryIs":"innerBoundaryIs",b=this.createElementNS(this.gmlns,"gml:"+d),c=this.buildGeometry.linearring.apply(this,[f[g]]),b.appendChild(c),e.appendChild(b);return e},multipolygon:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:MultiPolygon"),e=a.components,f=0;f<e.length;++f)b=this.createElementNS(this.gmlns,"gml:polygonMember"),c=this.buildGeometry.polygon.apply(this,[e[f]]),b.appendChild(c),d.appendChild(b);return d},bounds:function(a){var b=this.createElementNS(this.gmlns,"gml:Box");return b.appendChild(this.buildCoordinatesNode(a)),b}},buildCoordinatesNode:function(a){var b=this.createElementNS(this.gmlns,"gml:coordinates");b.setAttribute("decimal","."),b.setAttribute("cs",","),b.setAttribute("ts"," ");var c=[];if(a instanceof OpenLayers.Bounds)c.push(a.left+","+a.bottom),c.push(a.right+","+a.top);else for(var d=a.components?a.components:[a],e=0;e<d.length;e++)c.push(d[e].x+","+d[e].y);var f=this.createTextNode(c.join(" "));return b.appendChild(f),b},CLASS_NAME:"OpenLayers.Format.GML"}),OpenLayers.Format.GML||(OpenLayers.Format.GML={}),OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),this.setGeometryTypes(),a&&a.featureNS&&this.setNamespace("feature",a.featureNS),this.singleFeatureType=!a||"string"==typeof a.featureType},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b=[];if(this.readNode(a,{features:b},!0),0==b.length){var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember");if(c.length)for(var d=0,e=c.length;e>d;++d)this.readNode(c[d],{features:b},!0);else{var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMembers");c.length&&this.readNode(c[0],{features:b},!0)}}return b},readNode:function(a,b,c){return c===!0&&this.autoConfig===!0&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||a.prefix in this.namespaces||a.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(a.parentNode.nodeName)||(this.featureType=a.nodeName.split(":").pop(),this.setNamespace("feature",a.namespaceURI),this.featureNS=a.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[a,b])},readers:{gml:{_inherit:function(){},featureMember:function(a,b){this.readChildNodes(a,b)},featureMembers:function(a,b){this.readChildNodes(a,b)},name:function(a,b){b.name=this.getChildValue(a)},boundedBy:function(a,b){var c={};this.readChildNodes(a,c),c.components&&c.components.length>0&&(b.bounds=c.components[0])},Point:function(a,b){var c={points:[]};this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(c.points[0])},coordinates:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");for(var d,e=c.split(this.regExes.splitSpace),f=e.length,g=new Array(f),h=0;f>h;++h)d=e[h].split(","),g[h]=this.xy?new OpenLayers.Geometry.Point(d[0],d[1],d[2]):new OpenLayers.Geometry.Point(d[1],d[0],d[2]);b.points=g},coord:function(a,b){var c={};this.readChildNodes(a,c),b.points||(b.points=[]),b.points.push(new OpenLayers.Geometry.Point(c.x,c.y,c.z))},X:function(a,b){b.x=this.getChildValue(a)},Y:function(a,b){b.y=this.getChildValue(a)},Z:function(a,b){b.z=this.getChildValue(a)},MultiPoint:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiPoint(c.components)]},pointMember:function(a,b){this.readChildNodes(a,b)},LineString:function(a,b){var c={};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.LineString(c.points))},MultiLineString:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiLineString(c.components)]},lineStringMember:function(a,b){this.readChildNodes(a,b)},Polygon:function(a,b){var c={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),c.inner.unshift(c.outer),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.Polygon(c.inner))},LinearRing:function(a,b){var c={};this.readers.gml._inherit.apply(this,[a,c]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.LinearRing(c.points)]},MultiPolygon:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]},polygonMember:function(a,b){this.readChildNodes(a,b)},GeometryCollection:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.Collection(c.components)]},geometryMember:function(a,b){this.readChildNodes(a,b)}},feature:{"*":function(a,b){var c,d=a.localName||a.nodeName.split(":").pop();b.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,d)?d===this.featureType&&(c="_typeName"):c="_typeName":0==a.childNodes.length||1==a.childNodes.length&&3==a.firstChild.nodeType?this.extractAttributes&&(c="_attribute"):c="_geometry",c&&this.readers.feature[c].apply(this,[a,b])},_typeName:function(a,b){var c={components:[],attributes:{}};this.readChildNodes(a,c),c.name&&(c.attributes.name=c.name);var d=new OpenLayers.Feature.Vector(c.components[0],c.attributes);this.singleFeatureType||(d.type=a.nodeName.split(":").pop(),d.namespace=a.namespaceURI);var e=a.getAttribute("fid")||this.getAttributeNS(a,this.namespaces.gml,"id");e&&(d.fid=e),this.internalProjection&&this.externalProjection&&d.geometry&&d.geometry.transform(this.externalProjection,this.internalProjection),c.bounds&&(d.bounds=c.bounds),b.features.push(d)},_geometry:function(a,b){this.geometryName||(this.geometryName=a.nodeName.split(":").pop()),this.readChildNodes(a,b)},_attribute:function(a,b){var c=a.localName||a.nodeName.split(":").pop(),d=this.getChildValue(a);b.attributes[c]=d}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,b)}}},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"featureMembers":"featureMember";var c=this.writeNode("gml:"+b,a);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",a,b),b},MultiPoint:function(a){for(var b=this.createElementNSPlus("gml:MultiPoint"),c=a.components||[a],d=0,e=c.length;e>d;++d)this.writeNode("pointMember",c[d],b);return b},pointMember:function(a){var b=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",a,b),b},MultiLineString:function(a){for(var b=this.createElementNSPlus("gml:MultiLineString"),c=a.components||[a],d=0,e=c.length;e>d;++d)this.writeNode("lineStringMember",c[d],b);return b},lineStringMember:function(a){var b=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",a,b),b},MultiPolygon:function(a){for(var b=this.createElementNSPlus("gml:MultiPolygon"),c=a.components||[a],d=0,e=c.length;e>d;++d)this.writeNode("polygonMember",c[d],b);return b},polygonMember:function(a){var b=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",a,b),b},GeometryCollection:function(a){for(var b=this.createElementNSPlus("gml:GeometryCollection"),c=0,d=a.components.length;d>c;++c)this.writeNode("geometryMember",a.components[c],b);return b},geometryMember:function(a){var b=this.createElementNSPlus("gml:geometryMember"),c=this.writeNode("feature:_geometry",a);return b.appendChild(c.firstChild),b}},feature:{_typeName:function(a){var b=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:a.fid}});a.geometry&&this.writeNode("feature:_geometry",a.geometry,b);for(var c in a.attributes){var d=a.attributes[c];null!=d&&this.writeNode("feature:_attribute",{name:c,value:d},b)}return b},_geometry:function(a){this.externalProjection&&this.internalProjection&&(a=a.clone().transform(this.internalProjection,this.externalProjection));var b=this.createElementNSPlus("feature:"+this.geometryName),c=this.geometryTypes[a.CLASS_NAME],d=this.writeNode("gml:"+c,a,b);return this.srsName&&d.setAttribute("srsName",this.srsName),b},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value})}},wfs:{FeatureCollection:function(a){for(var b=this.createElementNSPlus("wfs:FeatureCollection"),c=0,d=a.length;d>c;++c)this.writeNode("gml:featureMember",a[c],b);return b}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"}),OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(a,b,c){var d=parseInt(a.getAttribute("srsDimension"),10)||c&&c.srsDimension;d&&(b.srsDimension=d)},featureMembers:function(a,b){this.readChildNodes(a,b)},Curve:function(a,b){var c={points:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.LineString(c.points))},segments:function(a,b){this.readChildNodes(a,b)},LineStringSegment:function(a,b){var c={};this.readChildNodes(a,c),c.points&&Array.prototype.push.apply(b.points,c.points)},pos:function(a,b){var c,d=this.getChildValue(a).replace(this.regExes.trimSpace,""),e=d.split(this.regExes.splitSpace);c=this.xy?new OpenLayers.Geometry.Point(e[0],e[1],e[2]):new OpenLayers.Geometry.Point(e[1],e[0],e[2]),b.points=[c]},posList:function(a,b){for(var c,d,e,f=this.getChildValue(a).replace(this.regExes.trimSpace,""),g=f.split(this.regExes.splitSpace),h=b.srsDimension||parseInt(a.getAttribute("srsDimension")||a.getAttribute("dimension"),10)||2,i=g.length/h,j=new Array(i),k=0,l=g.length;l>k;k+=h)c=g[k],d=g[k+1],e=2==h?void 0:g[k+2],j[k/h]=this.xy?new OpenLayers.Geometry.Point(c,d,e):new OpenLayers.Geometry.Point(d,c,e);b.points=j},Surface:function(a,b){this.readChildNodes(a,b)},patches:function(a,b){this.readChildNodes(a,b)},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b])},exterior:function(a,b){var c={};this.readChildNodes(a,c),b.outer=c.components[0]},interior:function(a,b){var c={};this.readChildNodes(a,c),b.inner.push(c.components[0])},MultiCurve:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),c.components.length>0&&(b.components=[new OpenLayers.Geometry.MultiLineString(c.components)])},curveMember:function(a,b){this.readChildNodes(a,b)},MultiSurface:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),c.components.length>0&&(b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)])},surfaceMember:function(a,b){this.readChildNodes(a,b)},surfaceMembers:function(a,b){this.readChildNodes(a,b)},pointMembers:function(a,b){this.readChildNodes(a,b)},lineStringMembers:function(a,b){this.readChildNodes(a,b)},polygonMembers:function(a,b){this.readChildNodes(a,b)},geometryMembers:function(a,b){this.readChildNodes(a,b)},Envelope:function(a,b){var c={points:new Array(2)};this.readChildNodes(a,c),b.components||(b.components=[]);var d=c.points[0],e=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,e.x,e.y))},lowerCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]),b.points[0]=c.points[0]},upperCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]),b.points[1]=c.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"featureMembers":"featureMember";var c=this.writeNode("gml:"+b,a);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a){for(var b=this.createElementNSPlus("gml:featureMembers"),c=0,d=a.length;d>c;++c)this.writeNode("feature:_typeName",a[c],b);return b},Point:function(a){var b=this.createElementNSPlus("gml:Point");return this.writeNode("pos",a,b),b},pos:function(a){var b=this.xy?a.x+" "+a.y:a.y+" "+a.x;return this.createElementNSPlus("gml:pos",{value:b})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",a.components,b),b},Curve:function(a){var b=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",a,b),b},segments:function(a){var b=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",a,b),b},LineStringSegment:function(a){var b=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",a.components,b),b},posList:function(a){for(var b,c=a.length,d=new Array(c),e=0;c>e;++e)b=a[e],d[e]=this.xy?b.x+" "+b.y:b.y+" "+b.x;return this.createElementNSPlus("gml:posList",{value:d.join(" ")})},Surface:function(a){var b=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",a,b),b},patches:function(a){var b=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",a,b),b},PolygonPatch:function(a){var b=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;d>c;++c)this.writeNode("interior",a.components[c],b);return b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;d>c;++c)this.writeNode("interior",a.components[c],b);return b},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",a,b),b},interior:function(a){var b=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",a,b),b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",a.components,b),b},MultiCurve:function(a){for(var b=this.createElementNSPlus("gml:MultiCurve"),c=a.components||[a],d=0,e=c.length;e>d;++d)this.writeNode("curveMember",c[d],b);return b},curveMember:function(a){var b=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",a,b):this.writeNode("LineString",a,b),b},MultiSurface:function(a){for(var b=this.createElementNSPlus("gml:MultiSurface"),c=a.components||[a],d=0,e=c.length;e>d;++d)this.writeNode("surfaceMember",c[d],b);return b},surfaceMember:function(a){var b=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",a,b):this.writeNode("Polygon",a,b),b},Envelope:function(a){var b=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",a,b),this.writeNode("upperCorner",a,b),this.srsName&&b.setAttribute("srsName",this.srsName),b},lowerCorner:function(a){var b=this.xy?a.left+" "+a.bottom:a.bottom+" "+a.left;return this.createElementNSPlus("gml:lowerCorner",{value:b})},upperCorner:function(a){var b=this.xy?a.right+" "+a.top:a.top+" "+a.right;return this.createElementNSPlus("gml:upperCorner",{value:b})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===!0?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===!1?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===!0?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===!1?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"}),OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=a.getAttribute("matchCase"),d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===c||"0"===c)});this.readChildNodes(a,d),b.filters.push(d)},PropertyIsNotEqualTo:function(a,b){var c=a.getAttribute("matchCase"),d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===c||"0"===c)});this.readChildNodes(a,d),b.filters.push(d)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escapeChar");c.value2regex(d,e,f),b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:a.matchCase}});return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:a.matchCase}});return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:a.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",a,b),this.writeNode("Literal",a.regex2value(),b),b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Envelope",a.value);return a.projection&&c.setAttribute("srsName",a.projection),b.appendChild(c),b},SortBy:function(a){for(var b=this.createElementNSPlus("ogc:SortBy"),c=0,d=a.length;d>c;c++)this.writeNode("ogc:SortProperty",a[c],b);return b},SortProperty:function(a){var b=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",a,b),this.writeNode("ogc:SortOrder","DESC"==a.order?"DESC":"ASC",b),b},SortOrder:function(a){var b=this.createElementNSPlus("ogc:SortOrder",{value:a});return b}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);if(this.writeNode("PropertyName",a,c),a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Envelope",a.value),a.projection&&d.setAttribute("srsName",a.projection),c.appendChild(d)}return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"}),OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(a){var b=this.version;if(!b){var c=a.getAttribute("xmlns:ows");c&&"1.1"===c.substring(c.lastIndexOf("/")+1)&&(b="1.1.0"),b||(b=this.defaultVersion)}return b},CLASS_NAME:"OpenLayers.Format.OWSCommon"}),OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c={};return this.readChildNodes(a,c),c},readers:{ows:{Exception:function(a,b){var c={code:a.getAttribute("exceptionCode"),locator:a.getAttribute("locator"),texts:[]};b.exceptions.push(c),this.readChildNodes(a,c)},ExceptionText:function(a,b){var c=this.getChildValue(a);b.texts.push(c)},ServiceIdentification:function(a,b){b.serviceIdentification={},this.readChildNodes(a,b.serviceIdentification)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},Keywords:function(a,b){b.keywords={},this.readChildNodes(a,b.keywords)},Keyword:function(a,b){b[this.getChildValue(a)]=!0},ServiceType:function(a,b){b.serviceType={codeSpace:a.getAttribute("codeSpace"),value:this.getChildValue(a)}},ServiceTypeVersion:function(a,b){b.serviceTypeVersion=this.getChildValue(a)},Fees:function(a,b){b.fees=this.getChildValue(a)},AccessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ServiceProvider:function(a,b){b.serviceProvider={},this.readChildNodes(a,b.serviceProvider)},ProviderName:function(a,b){b.providerName=this.getChildValue(a)},ProviderSite:function(a,b){b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,"href")},ServiceContact:function(a,b){b.serviceContact={},this.readChildNodes(a,b.serviceContact)},IndividualName:function(a,b){b.individualName=this.getChildValue(a)},PositionName:function(a,b){b.positionName=this.getChildValue(a)},ContactInfo:function(a,b){b.contactInfo={},this.readChildNodes(a,b.contactInfo)},Phone:function(a,b){b.phone={},this.readChildNodes(a,b.phone)},Voice:function(a,b){b.voice=this.getChildValue(a)},Address:function(a,b){b.address={},this.readChildNodes(a,b.address)},DeliveryPoint:function(a,b){b.deliveryPoint=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},AdministrativeArea:function(a,b){b.administrativeArea=this.getChildValue(a)},PostalCode:function(a,b){b.postalCode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ElectronicMailAddress:function(a,b){b.electronicMailAddress=this.getChildValue(a)},Role:function(a,b){b.role=this.getChildValue(a)},OperationsMetadata:function(a,b){b.operationsMetadata={},this.readChildNodes(a,b.operationsMetadata)},Operation:function(a,b){var c=a.getAttribute("name");b[c]={},this.readChildNodes(a,b[c])},DCP:function(a,b){b.dcp={},this.readChildNodes(a,b.dcp)},HTTP:function(a,b){b.http={},this.readChildNodes(a,b.http)},Get:function(a,b){b.get||(b.get=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,"href")};this.readChildNodes(a,c),b.get.push(c)},Post:function(a,b){b.post||(b.post=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,"href")};this.readChildNodes(a,c),b.post.push(c)},Parameter:function(a,b){b.parameters||(b.parameters={});var c=a.getAttribute("name");b.parameters[c]={},this.readChildNodes(a,b.parameters[c])},Constraint:function(a,b){b.constraints||(b.constraints={});var c=a.getAttribute("name");b.constraints[c]={},this.readChildNodes(a,b.constraints[c])},Value:function(a,b){b[this.getChildValue(a)]=!0},OutputFormat:function(a,b){b.formats.push({value:this.getChildValue(a)}),this.readChildNodes(a,b)},WGS84BoundingBox:function(a,b){var c={};c.crs=a.getAttribute("crs"),b.BoundingBox?b.BoundingBox.push(c):(b.projection=c.crs,c=b),this.readChildNodes(a,c)},BoundingBox:function(a,b){this.readers.ows.WGS84BoundingBox.apply(this,[a,b])},LowerCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");var d=c.split(this.regExes.splitSpace);b.left=d[0],b.bottom=d[1]},UpperCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");var d=c.split(this.regExes.splitSpace);b.right=d[0],b.top=d[1],b.bounds=new OpenLayers.Bounds(b.left,b.bottom,b.right,b.top),delete b.left,delete b.bottom,delete b.right,delete b.top},Language:function(a,b){b.language=this.getChildValue(a)}}},writers:{ows:{BoundingBox:function(a,b){var c=this.createElementNSPlus(b||"ows:BoundingBox",{attributes:{crs:a.projection}});return this.writeNode("ows:LowerCorner",a,c),this.writeNode("ows:UpperCorner",a,c),c},LowerCorner:function(a){var b=this.createElementNSPlus("ows:LowerCorner",{value:a.bounds.left+" "+a.bounds.bottom});return b},UpperCorner:function(a){var b=this.createElementNSPlus("ows:UpperCorner",{value:a.bounds.right+" "+a.bounds.top});return b},Identifier:function(a){var b=this.createElementNSPlus("ows:Identifier",{value:a});return b},Title:function(a){var b=this.createElementNSPlus("ows:Title",{value:a});return b},Abstract:function(a){var b=this.createElementNSPlus("ows:Abstract",{value:a});return b},OutputFormat:function(a){var b=this.createElementNSPlus("ows:OutputFormat",{value:a});return b}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"}),OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.success=!1,b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("language"),exceptions:[]},this.readChildNodes(a,b.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"}),OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[a]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,b){b.numberOfFeatures=parseInt(a.getAttribute("numberOfFeatures")),OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(a,b){b.insertIds=[],b.success=!1,this.readChildNodes(a,b)},TransactionSummary:function(a,b){b.success=!0},InsertResults:function(a,b){this.readChildNodes(a,b)},Feature:function(a,b){var c={fids:[]};this.readChildNodes(a,c),b.insertIds.push(c.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(a){var b=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return a&&this.setAttributes(b,{resultType:a.resultType,startIndex:a.startIndex,count:a.count}),b},Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},a);var b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b?b+":":"")+a.featureType,srsName:a.srsName}});if(a.featureNS&&c.setAttribute("xmlns:"+b,a.featureNS),a.propertyNames)for(var d=0,e=a.propertyNames.length;e>d;d++)this.writeNode("wfs:PropertyName",{property:a.propertyNames[d]},c);return a.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,a.filter),this.writeNode("ogc:Filter",a.filter,c)),c},PropertyName:function(a){return this.createElementNSPlus("wfs:PropertyName",{value:a.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"}),OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(a){a=a||{},OpenLayers.Util.extend(this,a),this.options=a
},mergeWithDefaultFilter:function(a){var b;return b=a&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,a]}):a||this.defaultFilter||void 0},destroy:function(){this.options=null,this.format=null},read:function(a){a=a||{},a.filter=this.mergeWithDefaultFilter(a.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(){},createCallback:function(a,b,c){return OpenLayers.Function.bind(function(){a.apply(this,[b,c])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(a){OpenLayers.Util.extend(this,a)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(a,b){if(b&&"object"==typeof b)for(var c in b)b.hasOwnProperty(c)&&(b[c]=walk(c,b[c]));return filter(a,b)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter&&(object=walk("",object)))}catch(e){}return this.keepData&&(this.data=object),object},write:function(a,b){this.pretty=!!b;var c=null,d=typeof a;if(this.serialize[d])try{c=!this.pretty&&this.nativeJSON?JSON.stringify(a):this.serialize[d].apply(this,[a])}catch(e){OpenLayers.Console.error("Trouble serializing: "+e)}return c},writeIndent:function(){var a=[];if(this.pretty)for(var b=0;b<this.level;++b)a.push(this.indent);return a.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(a){if(null==a)return"null";if(a.constructor==Date)return this.serialize.date.apply(this,[a]);if(a.constructor==Array)return this.serialize.array.apply(this,[a]);var b=["{"];this.level+=1;var c,d,e,f=!1;for(c in a)a.hasOwnProperty(c)&&(d=OpenLayers.Format.JSON.prototype.write.apply(this,[c,this.pretty]),e=OpenLayers.Format.JSON.prototype.write.apply(this,[a[c],this.pretty]),null!=d&&null!=e&&(f&&b.push(","),b.push(this.writeNewline(),this.writeIndent(),d,":",this.writeSpace(),e),f=!0));return this.level-=1,b.push(this.writeNewline(),this.writeIndent(),"}"),b.join("")},array:function(a){var b,c=["["];this.level+=1;for(var d=0,e=a.length;e>d;++d)b=OpenLayers.Format.JSON.prototype.write.apply(this,[a[d],this.pretty]),null!=b&&(d>0&&c.push(","),c.push(this.writeNewline(),this.writeIndent(),b));return this.level-=1,c.push(this.writeNewline(),this.writeIndent(),"]"),c.join("")},string:function(a){var b={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(a)?'"'+a.replace(/([\x00-\x1f\\"])/g,function(a,c){var d=b[c];return d?d:(d=c.charCodeAt(),"\\u00"+Math.floor(d/16).toString(16)+(d%16).toString(16))})+'"':'"'+a+'"'},number:function(a){return isFinite(a)?String(a):"null"},"boolean":function(a){return String(a)},date:function(a){function b(a){return 10>a?"0"+a:a}return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(a,b,c){b=b?b:"FeatureCollection";var d=null,e=null;if(e="string"==typeof a?OpenLayers.Format.JSON.prototype.read.apply(this,[a,c]):a){if("string"!=typeof e.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+a);else if(this.isValidType(e,b))switch(b){case"Geometry":try{d=this.parseGeometry(e)}catch(f){OpenLayers.Console.error(f)}break;case"Feature":try{d=this.parseFeature(e),d.type="Feature"}catch(f){OpenLayers.Console.error(f)}break;case"FeatureCollection":switch(d=[],e.type){case"Feature":try{d.push(this.parseFeature(e))}catch(f){d=null,OpenLayers.Console.error(f)}break;case"FeatureCollection":for(var g=0,h=e.features.length;h>g;++g)try{d.push(this.parseFeature(e.features[g]))}catch(f){d=null,OpenLayers.Console.error(f)}break;default:try{var i=this.parseGeometry(e);d.push(new OpenLayers.Feature.Vector(i))}catch(f){d=null,OpenLayers.Console.error(f)}}}}else OpenLayers.Console.error("Bad JSON: "+a);return d},isValidType:function(a,b){var c=!1;switch(b){case"Geometry":-1==OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],a.type)?OpenLayers.Console.error("Unsupported geometry type: "+a.type):c=!0;break;case"FeatureCollection":c=!0;break;default:a.type==b?c=!0:OpenLayers.Console.error("Cannot convert types from "+a.type+" to "+b)}return c},parseFeature:function(a){var b,c,d,e;d=a.properties?a.properties:{},e=a.geometry&&a.geometry.bbox||a.bbox;try{c=this.parseGeometry(a.geometry)}catch(f){throw f}return b=new OpenLayers.Feature.Vector(c,d),e&&(b.bounds=OpenLayers.Bounds.fromArray(e)),a.id&&(b.fid=a.id),b},parseGeometry:function(a){if(null==a)return null;var b,c=!1;if("GeometryCollection"==a.type){if(!OpenLayers.Util.isArray(a.geometries))throw"GeometryCollection must have geometries array: "+a;for(var d=a.geometries.length,e=new Array(d),f=0;d>f;++f)e[f]=this.parseGeometry.apply(this,[a.geometries[f]]);b=new OpenLayers.Geometry.Collection(e),c=!0}else{if(!OpenLayers.Util.isArray(a.coordinates))throw"Geometry must have coordinates array: "+a;if(!this.parseCoords[a.type.toLowerCase()])throw"Unsupported geometry type: "+a.type;try{b=this.parseCoords[a.type.toLowerCase()].apply(this,[a.coordinates])}catch(g){throw g}}return this.internalProjection&&this.externalProjection&&!c&&b.transform(this.externalProjection,this.internalProjection),b},parseCoords:{point:function(a){if(0==this.ignoreExtraDims&&2!=a.length)throw"Only 2D points are supported: "+a;return new OpenLayers.Geometry.Point(a[0],a[1])},multipoint:function(a){for(var b=[],c=null,d=0,e=a.length;e>d;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(a){for(var b=[],c=null,d=0,e=a.length;e>d;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.LineString(b)},multilinestring:function(a){for(var b=[],c=null,d=0,e=a.length;e>d;++d){try{c=this.parseCoords.linestring.apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.MultiLineString(b)},polygon:function(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e){try{c=this.parseCoords.linestring.apply(this,[a[e]])}catch(g){throw g}b=new OpenLayers.Geometry.LinearRing(c.components),d.push(b)}return new OpenLayers.Geometry.Polygon(d)},multipolygon:function(a){for(var b=[],c=null,d=0,e=a.length;e>d;++d){try{c=this.parseCoords.polygon.apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.MultiPolygon(b)},box:function(a){if(2!=a.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])}},write:function(a,b){var c={type:null};if(OpenLayers.Util.isArray(a)){c.type="FeatureCollection";var d=a.length;c.features=new Array(d);for(var e=0;d>e;++e){var f=a[e];if(!f instanceof OpenLayers.Feature.Vector){var g="FeatureCollection only supports collections of features: "+f;throw g}c.features[e]=this.extract.feature.apply(this,[f])}}else 0==a.CLASS_NAME.indexOf("OpenLayers.Geometry")?c=this.extract.geometry.apply(this,[a]):a instanceof OpenLayers.Feature.Vector&&(c=this.extract.feature.apply(this,[a]),a.layer&&a.layer.projection&&(c.crs=this.createCRSObject(a)));return OpenLayers.Format.JSON.prototype.write.apply(this,[c,b])},createCRSObject:function(a){var b=a.layer.projection.toString(),c={};if(b.match(/epsg:/i)){var d=parseInt(b.substring(b.indexOf(":")+1));c=4326==d?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+d}}}return c},extract:{feature:function(a){var b=this.extract.geometry.apply(this,[a.geometry]),c={type:"Feature",properties:a.attributes,geometry:b};return null!=a.fid&&(c.id=a.fid),c},geometry:function(a){if(null==a)return null;this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b,c=a.CLASS_NAME.split(".")[2],d=this.extract[c.toLowerCase()].apply(this,[a]);return b="Collection"==c?{type:"GeometryCollection",geometries:d}:{type:c,coordinates:d}},point:function(a){return[a.x,a.y]},multipoint:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},linestring:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},polygon:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.polygon.apply(this,[a.components[c]]));return b},collection:function(a){for(var b=a.components.length,c=new Array(b),d=0;b>d;++d)c[d]=this.extract.geometry.apply(this,[a.components[d]]);return c}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(a){if(a=a||{},this.params={},this.pendingRequests={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),this.format||(this.format=new OpenLayers.Format.GeoJSON),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(a,c){return b.write(a,c)}}},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=OpenLayers.Util.applyDefaults(a,this.options),a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params),a.filter&&this.filterToParams&&(a.params=this.filterToParams(a.filter,a.params));var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.createRequest(a.url,a.params,OpenLayers.Function.bind(function(c){b.data=c,this.handleRead(b,a)},this));return b.priv=c,b},createRequest:function(a,b,c){var d=OpenLayers.Protocol.Script.register(c),e=OpenLayers.String.format(this.callbackTemplate,{id:d});b=OpenLayers.Util.extend({},b),b[this.callbackKey]=this.callbackPrefix+e,a=OpenLayers.Util.urlAppend(a,OpenLayers.Util.getParameterString(b));var f=document.createElement("script");f.type="text/javascript",f.src=a,f.id="OpenLayers_Protocol_Script_"+d,this.pendingRequests[f.id]=f;var g=document.getElementsByTagName("head")[0];return g.appendChild(f),f},destroyRequest:function(a){OpenLayers.Protocol.Script.unregister(a.id.split("_").pop()),delete this.pendingRequests[a.id],a.parentNode&&a.parentNode.removeChild(a)},handleRead:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){b.callback&&(a.data?(a.features=this.parseFeatures(a.data),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(a.priv),b.callback.call(b.scope,a))},parseFeatures:function(a){return this.format.read(a)},abort:function(a){if(a)this.destroyRequest(a.priv);else for(var b in this.pendingRequests)this.destroyRequest(this.pendingRequests[b])},destroy:function(){this.abort(),delete this.params,delete this.format,OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"}),function(){var a=OpenLayers.Protocol.Script,b=0;a.registry={},a.register=function(c){var d="c"+ ++b;return a.registry[d]=function(){c.apply(this,arguments)},d},a.unregister=function(b){delete a.registry[b]}}(),OpenLayers.Format.EncodedPolyline=OpenLayers.Class(OpenLayers.Format,{geometryType:"linestring",initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b;if("linestring"==this.geometryType)b=OpenLayers.Geometry.LineString;else if("linearring"==this.geometryType)b=OpenLayers.Geometry.LinearRing;else if("multipoint"==this.geometryType)b=OpenLayers.Geometry.MultiPoint;else if("point"!=this.geometryType&&"polygon"!=this.geometryType)return null;for(var c=this.decodeDeltas(a,2),d=c.length,e=[],f=0;d>f+1;){var g=c[f++],h=c[f++];e.push(new OpenLayers.Geometry.Point(h,g))}return new OpenLayers.Feature.Vector("point"==this.geometryType?e[0]:"polygon"==this.geometryType?new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(e)]):new b(e))},decode:function(a,b,c){for(var d=c||1e5,e=this.decodeDeltas(a,b,d),f=e.length,g=[],h=0;f>h+(b-1);){for(var i=[],j=0;b>j;++j)i.push(e[h++]);g.push(i)}return g},write:function(a){var b;b=a.constructor==Array?a[0]:a;var c,d=b.geometry,e=d.CLASS_NAME.split(".")[2].toLowerCase();if("point"==e)c=new Array(d);else if("linestring"==e||"linearring"==e||"multipoint"==e)c=d.components;else{if("polygon"!=e)return null;c=d.components[0].components}for(var f=[],g=c.length,h=0;g>h;++h){var i=c[h];f.push(i.y),f.push(i.x)}return this.encodeDeltas(f,2)},encode:function(a,b,c){for(var d=c||1e5,e=[],f=a.length,g=0;f>g;++g)for(var h=a[g],i=0;b>i;++i)e.push(h[i]);return this.encodeDeltas(e,b,d)},encodeDeltas:function(a,b,c){var d,e=c||1e5,f=new Array(b);for(d=0;b>d;++d)f[d]=0;for(var g=a.length,h=0;g>h;)for(d=0;b>d;++d,++h){var i=a[h],j=i-f[d];f[d]=i,a[h]=j}return this.encodeFloats(a,e)},decodeDeltas:function(a,b,c){var d,e=c||1e5,f=new Array(b);for(d=0;b>d;++d)f[d]=0;for(var g=this.decodeFloats(a,e),h=g.length,i=0;h>i;)for(d=0;b>d;++d,++i)f[d]+=g[i],g[i]=f[d];return g},encodeFloats:function(a,b){for(var c=b||1e5,d=a.length,e=0;d>e;++e)a[e]=Math.round(a[e]*c);return this.encodeSignedIntegers(a)},decodeFloats:function(a,b){for(var c=b||1e5,d=this.decodeSignedIntegers(a),e=d.length,f=0;e>f;++f)d[f]/=c;return d},encodeSignedIntegers:function(a){for(var b=a.length,c=0;b>c;++c){var d=a[c],e=d<<1;0>d&&(e=~e),a[c]=e}return this.encodeUnsignedIntegers(a)},decodeSignedIntegers:function(a){for(var b=this.decodeUnsignedIntegers(a),c=b.length,d=0;c>d;++d){var e=b[d];b[d]=1&e?~(e>>1):e>>1}return b},encodeUnsignedIntegers:function(a){for(var b="",c=a.length,d=0;c>d;++d)b+=this.encodeUnsignedInteger(a[d]);return b},decodeUnsignedIntegers:function(a){for(var b=[],c=0,d=0,e=a.length,f=0;e>f;++f){var g=a.charCodeAt(f)-63;c|=(31&g)<<d,32>g?(b.push(c),c=0,d=0):d+=5}return b},encodeFloat:function(a,b){return a=Math.round(a*(b||1e5)),this.encodeSignedInteger(a)},decodeFloat:function(a,b){var c=this.decodeSignedInteger(a);return c/(b||1e5)},encodeSignedInteger:function(a){var b=a<<1;return 0>a&&(b=~b),this.encodeUnsignedInteger(b)},decodeSignedInteger:function(a){var b=this.decodeUnsignedInteger(a);return 1&b?~(b>>1):b>>1},encodeUnsignedInteger:function(a){for(var b,c="";a>=32;)b=(32|31&a)+63,c+=String.fromCharCode(b),a>>=5;return b=a+63,c+=String.fromCharCode(b)},decodeUnsignedInteger:function(a){for(var b=0,c=0,d=a.length,e=0;d>e;++e){var f=a.charCodeAt(e)-63;if(b|=(31&f)<<c,32>f)break;c+=5}return b},CLASS_NAME:"OpenLayers.Format.EncodedPolyline"}),OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.controls=[],this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a,b=this.controls.length-1;b>=0;b--)a=this.controls[b],a.events&&a.events.un({activate:this.iconOn,deactivate:this.iconOff}),a.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var a,b=0,c=this.controls.length;c>b;b++)a=this.controls[b],(a===this.defaultControl||this.saveState&&this.activeState[a.id])&&a.activate();return this.saveState===!0&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var a,b=0,c=this.controls.length;c>b;b++)a=this.controls[b],this.activeState[a.id]=a.deactivate();return this.redraw(),!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick),this.addControlsToMap(this.controls),this.div},redraw:function(){for(var a=this.div.childNodes.length,b=a-1;b>=0;b--)this.div.removeChild(this.div.childNodes[b]);if(this.div.innerHTML="",this.active)for(var b=0,c=this.controls.length;c>b;b++)this.div.appendChild(this.controls[b].panel_div)},activateControl:function(a){if(!this.active)return!1;if(a.type==OpenLayers.Control.TYPE_BUTTON)return void a.trigger();if(a.type==OpenLayers.Control.TYPE_TOGGLE)return void(a.active?a.deactivate():a.activate());if(this.allowDepress&&a.active)a.deactivate();else{for(var b,c=0,d=this.controls.length;d>c;c++)b=this.controls[c],b==a||b.type!==OpenLayers.Control.TYPE_TOOL&&null!=b.type||b.deactivate();a.activate()}},addControls:function(a){OpenLayers.Util.isArray(a)||(a=[a]),this.controls=this.controls.concat(a);for(var b=0,c=a.length;c>b;b++){var d=a[b],e=this.createControlMarkup(d);OpenLayers.Element.addClass(e,d.displayClass+"ItemInactive"),OpenLayers.Element.addClass(e,"olButton"),""==d.title||e.title||(e.title=d.title),d.panel_div=e}this.map&&(this.addControlsToMap(a),this.redraw())},createControlMarkup:function(){return document.createElement("div")},addControlsToMap:function(a){for(var b,c=0,d=a.length;d>c;c++)b=a[c],b.autoActivate===!0?(b.autoActivate=!1,this.map.addControl(b),b.autoActivate=!0):(this.map.addControl(b),b.deactivate()),b.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var a=this.panel_div,b=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");a.className=a.className.replace(b,"$1Active")},iconOff:function(){var a=this.panel_div,b=new RegExp("\\b("+this.displayClass+"Item)Active\\b");a.className=a.className.replace(b,"$1Inactive")},onButtonClick:function(a){for(var b=this.controls,c=a.buttonElement,d=b.length-1;d>=0;--d)if(b[d].panel_div===c){this.activateControl(b[d]);break}},getControlsBy:function(a,b){var c="function"==typeof b.test,d=OpenLayers.Array.filter(this.controls,function(d){return d[a]==b||c&&b.test(d[a])});return d},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"OpenLayers.Control.Panel"}),OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"}),OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"}),OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"}),OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"}),OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(a,b,c,d){OpenLayers.Layer.prototype.initialize.apply(this,[a,d]),this.url=b,this.params||(this.params=OpenLayers.Util.extend({},c))},destroy:function(){this.url=null,this.params=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setUrl:function(a){this.url=a},mergeNewParams:function(a){this.params=OpenLayers.Util.extend(this.params,a);var b=this.redraw();return null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),b},redraw:function(a){return a?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(a,b){for(var c=1,d=0,e=a.length;e>d;d++)c*=a.charCodeAt(d)*this.URL_HASH_FACTOR,c-=Math.floor(c);return b[Math.floor(c*b.length)]},getFullRequestString:function(a,b){var c=b||this.url,d=OpenLayers.Util.extend({},this.params);d=OpenLayers.Util.extend(d,a);var e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&&(c=this.selectUrl(e,c));var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(var g in d)g.toUpperCase()in f&&delete d[g];return e=OpenLayers.Util.getParameterString(d),OpenLayers.Util.urlAppend(c,e)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(a,b,c,d,e,f){this.layer=a,this.position=b.clone(),this.setBounds(c),this.url=d,e&&(this.size=e.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,f),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null,this.bounds=null,this.size=null,this.position=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.eventListeners=null,this.events=null},draw:function(a){a||this.clear();var b=this.shouldDraw();return b&&!a&&this.events.triggerEvent("beforedraw")===!1&&(b=null),b},shouldDraw:function(){var a=!1,b=this.layer.maxExtent;if(b){var c=this.layer.map,d=c.baseLayer.wrapDateLine&&c.getMaxExtent();this.bounds.intersectsBounds(b,{inclusive:!1,worldBounds:d})&&(a=!0)}return a||this.layer.displayOutsideMaxExtent},setBounds:function(a){if(a=a.clone(),this.layer.map.baseLayer.wrapDateLine){var b=this.layer.map.getMaxExtent(),c=this.layer.map.getResolution();a=a.wrapDateLine(b,{leftTolerance:c,rightTolerance:c})}this.bounds=a},moveTo:function(a,b,c){null==c&&(c=!0),this.setBounds(a),this.position=b.clone(),c&&this.draw()},clear:function(){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(a,b,c,d){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=d,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.imgDiv=null,this.frame=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);return a?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):a===!1&&this.unload(),a},renderTile:function(){if(this.layer.async){var a=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(b){a==this.asyncRequestId&&(this.url=b,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var a=this.getTile().style,b=this.frame?this.size:this.layer.getImageSize(this.bounds),c=1;this.layer instanceof OpenLayers.Layer.Grid&&(c=this.layer.getServerResolution()/this.layer.map.getResolution()),a.left=this.position.x+"px",a.top=this.position.y+"px",a.width=Math.round(c*b.w)+"px",a.height=Math.round(c*b.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var a=this.imgDiv;if(a){var b=this.getTile();b.parentNode===this.layer.div&&this.layer.div.removeChild(b),this.setImgSrc(),this.layerAlphaHack===!0&&(a.style.filter=""),OpenLayers.Element.removeClass(a,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var a=this.imgDiv.style;if(this.frame){var b=0,c=0;this.layer.gutter&&(b=this.layer.gutter/this.layer.tileSize.w*100,c=this.layer.gutter/this.layer.tileSize.h*100),a.left=-b+"%",a.top=-c+"%",a.width=2*b+100+"%",a.height=2*c+100+"%"}a.visibility="hidden",a.opacity=0,this.layer.opacity<1&&(a.filter="alpha(opacity="+100*this.layer.opacity+")"),a.position="absolute",this.layerAlphaHack&&(a.paddingTop=a.height,a.height="0",a.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(a){this.imgDiv=a},initImage:function(){if(!this.url&&!this.imgDiv)return void(this.isLoading=!1);this.events.triggerEvent("beforeload"),this.layer.div.appendChild(this.getTile()),this.events.triggerEvent(this._loadEvent);var a=this.getImage(),b=a.getAttribute("src")||"";this.url&&OpenLayers.Util.isEquivalentUrl(b,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&&a.removeAttribute("crossorigin"),OpenLayers.Event.observe(a,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(a,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))},setImgSrc:function(a){var b=this.imgDiv;a?(b.style.visibility="hidden",b.style.opacity=0,this.crossOriginKeyword&&("data:"!==a.substr(0,5)?b.setAttribute("crossorigin",this.crossOriginKeyword):b.removeAttribute("crossorigin")),b.src=a):(this.stopLoading(),this.imgDiv=null,b.parentNode&&b.parentNode.removeChild(b))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var a;return this.frame?(a=this.frame.cloneNode(!1),a.appendChild(this.imgDiv)):a=this.imgDiv,this.imgDiv=null,a}},onImageLoad:function(){var a=this.imgDiv;this.stopLoading(),a.style.visibility="inherit",a.style.opacity=this.layer.opacity,this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),this.layerAlphaHack===!0&&(a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a.src+"', sizingMethod='scale')")},onImageError:function(){var a=this.imgDiv;null!=a.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(a,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),window.clearTimeout(this._loadTimeout),delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var a=document.createElement("canvas");a.width=this.size.w,a.height=this.size.h,this.canvasContext=a.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.IMAGE=function(){var a=new Image;return a.className="olTileImage",a.galleryImg="no",a}(),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this),this.initProperties(),this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(a){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,a),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var a=0,b=this.grid.length;b>a;a++)for(var c=this.grid[a],d=0,e=c.length;e>d;d++){var f=c[d];this.destroyTile(f)}this.grid=[],this.gridResolution=null,this.gridLayout=null}},addOptions:function(a){var b=void 0!==a.singleTile&&a.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments),this.map&&b&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.moveTo(null,!0))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]),null!=this.tileSize&&(a.tileSize=this.tileSize.clone()),a.grid=[],a.gridResolution=null,a.backBuffer=null,a.backBufferTimerId=null,a.loading=!1,a.numLoadingTiles=0,a},moveTo:function(a,b,c){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),a=a||this.map.getExtent(),null!=a){{var d=!this.grid.length||b,e=this.getTilesBounds(),f=this.map.getResolution();this.getServerResolution(f)}this.singleTile?(d||!c&&!e.containsBounds(a))&&(b&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),b&&"resize"!==this.transitionEffect||this.applyBackBuffer(f),this.initSingleTile(a)):(d=d||!e.intersectsBounds(a,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),d?(!b||"resize"!==this.transitionEffect&&this.gridResolution!==f||this.applyBackBuffer(f),this.initGriddedTiles(a)):this.moveGriddedTiles())}},getTileData:function(a){var b=null,c=a.lon,d=a.lat,e=this.grid.length;if(this.map&&e){var f=this.map.getResolution(),g=this.tileSize.w,h=this.tileSize.h,i=this.grid[0][0].bounds,j=i.left,k=i.top;if(j>c&&this.map.baseLayer.wrapDateLine){var l=this.map.getMaxExtent().getWidth(),m=Math.ceil((j-c)/l);
c+=l*m}var n=(c-j)/(f*g),o=(k-d)/(f*h),p=Math.floor(n),q=Math.floor(o);if(q>=0&&e>q){var r=this.grid[q][p];r&&(b={tile:r,i:Math.floor((n-p)*g),j:Math.floor((o-q)*h)})}}return b},destroyTile:function(a){this.removeTileMonitoringHooks(a),a.destroy()},getServerResolution:function(a){var b=Number.POSITIVE_INFINITY;if(a=a||this.map.getResolution(),this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,a)){var c,d,e,f;for(c=this.serverResolutions.length-1;c>=0&&(e=this.serverResolutions[c],d=Math.abs(e-a),!(d>b));c--)b=d,f=e;a=f}return a},getServerZoom:function(){var a=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,a):this.map.getZoomForResolution(a)+(this.zoomOffset||0)},applyBackBuffer:function(a){null!==this.backBufferTimerId&&this.removeBackBuffer();var b=this.backBuffer;if(!b){if(b=this.createBackBuffer(),!b)return;a===this.gridResolution?this.div.insertBefore(b,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(b,this.map.baseLayer.div),this.backBuffer=b;var c=this.grid[0][0].bounds;this.backBufferLonLat={lon:c.left,lat:c.top},this.backBufferResolution=this.gridResolution}for(var d,e=this.backBufferResolution/a,f=b.childNodes,g=f.length-1;g>=0;--g)d=f[g],d.style.top=(e*d._i*d._h|0)+"px",d.style.left=(e*d._j*d._w|0)+"px",d.style.width=Math.round(e*d._w)+"px",d.style.height=Math.round(e*d._h)+"px";var h=this.getViewPortPxFromLonLat(this.backBufferLonLat,a),i=this.map.layerContainerOriginPx.x,j=this.map.layerContainerOriginPx.y;b.style.left=Math.round(h.x-i)+"px",b.style.top=Math.round(h.y-j)+"px"},createBackBuffer:function(){var a;if(this.grid.length>0){a=document.createElement("div"),a.id=this.div.id+"_bb",a.className="olBackBuffer",a.style.position="absolute";var b=this.map;a.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:b.Z_INDEX_BASE.BaseLayer-(b.getNumLayers()-b.getLayerIndex(this));for(var c=0,d=this.grid.length;d>c;c++)for(var e=0,f=this.grid[c].length;f>e;e++){var g=this.grid[c][e],h=this.grid[c][e].createBackBuffer();h&&(h._i=c,h._j=e,h._w=g.size.w,h._h=g.size.h,h.id=g.id+"_bb",a.appendChild(h))}}return a},removeBackBuffer:function(){if(this._transitionElement){for(var a=this.transitionendEvents.length-1;a>=0;--a)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[a],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBuffer=null,this.backBufferResolution=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(){this.singleTile||this.moveGriddedTiles()},setTileSize:function(a){this.singleTile&&(a=this.map.getSize(),a.h=parseInt(a.h*this.ratio,10),a.w=parseInt(a.w*this.ratio,10)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getTilesBounds:function(){var a=null,b=this.grid.length;if(b){var c=this.grid[b-1][0].bounds,d=this.grid[0].length*c.getWidth(),e=this.grid.length*c.getHeight();a=new OpenLayers.Bounds(c.left,c.bottom,c.left+d,c.bottom+e)}return a},initSingleTile:function(a){this.events.triggerEvent("retile");var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio,d=a.getHeight()*this.ratio,e=new OpenLayers.Bounds(b.lon-c/2,b.lat-d/2,b.lon+c/2,b.lat+d/2),f=this.map.getLayerPxFromLonLat({lon:e.left,lat:e.top});this.grid.length||(this.grid[0]=[]);var g=this.grid[0][0];g?g.moveTo(e,f):(g=this.addTile(e,f),this.addTileMonitoringHooks(g),g.draw(),this.grid[0][0]=g),this.removeExcessTiles(1,1),this.gridResolution=this.getServerResolution()},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w,e=c*this.tileSize.h,f=a.left-b.lon,g=Math.floor(f/d)-this.buffer,h=this.rowSign,i=h*(b.lat-a.top+e),j=Math[~h?"floor":"ceil"](i/e)-this.buffer*h;return{tilelon:d,tilelat:e,startcol:g,startrow:j}},getTileOrigin:function(){var a=this.tileOrigin;if(!a){var b=this.getMaxExtent(),c={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];a=new OpenLayers.LonLat(b[c[0]],b[c[1]])}return a},getTileBoundsForGridIndex:function(a,b){var c=this.getTileOrigin(),d=this.gridLayout,e=d.tilelon,f=d.tilelat,g=d.startcol,h=d.startrow,i=this.rowSign;return new OpenLayers.Bounds(c.lon+(g+b)*e,c.lat-(h+a*i)*f*i,c.lon+(g+b+1)*e,c.lat-(h+(a-1)*i)*f*i)},initGriddedTiles:function(a){this.events.triggerEvent("retile");var b=this.map.getSize(),c=this.getTileOrigin(),d=this.map.getResolution(),e=this.getServerResolution(),f=d/e,g={w:this.tileSize.w/f,h:this.tileSize.h/f},h=Math.ceil(b.h/g.h)+2*this.buffer+1,i=Math.ceil(b.w/g.w)+2*this.buffer+1,j=this.calculateGridLayout(a,c,e);this.gridLayout=j;var k=j.tilelon,l=j.tilelat,m=this.map.layerContainerOriginPx.x,n=this.map.layerContainerOriginPx.y,o=this.getTileBoundsForGridIndex(0,0),p=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(o.left,o.top));p.x=Math.round(p.x)-m,p.y=Math.round(p.y)-n;var q=[],r=this.map.getCenter(),s=0;do{var t=this.grid[s];t||(t=[],this.grid.push(t));var u=0;do{o=this.getTileBoundsForGridIndex(s,u);var v=p.clone();v.x=v.x+u*Math.round(g.w),v.y=v.y+s*Math.round(g.h);var w=t[u];w?w.moveTo(o,v,!1):(w=this.addTile(o,v),this.addTileMonitoringHooks(w),t.push(w));var x=o.getCenterLonLat();q.push({tile:w,distance:Math.pow(x.lon-r.lon,2)+Math.pow(x.lat-r.lat,2)}),u+=1}while(o.right<=a.right+k*this.buffer||i>u);s+=1}while(o.bottom>=a.bottom-l*this.buffer||h>s);this.removeExcessTiles(s,u);var d=this.getServerResolution();this.gridResolution=d,q.sort(function(a,b){return a.distance-b.distance});for(var y=0,z=q.length;z>y;++y)q[y].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(a,b){var c=new this.tileClass(this,b,a,null,this.tileSize,this.tileOptions);return this.events.triggerEvent("addtile",{tile:c}),c},addTileMonitoringHooks:function(a){var b="olTileReplacing";a.onLoadStart=function(){this.loading===!1&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:a}),this.numLoadingTiles++,!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(a.getTile(),b)},a.onLoadEnd=function(c){this.numLoadingTiles--;var d="unload"===c.type;if(this.events.triggerEvent("tileloaded",{tile:a,aborted:d}),!this.singleTile&&!d&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var e=a.getTile();if("none"===OpenLayers.Element.getStyle(e,"display")){var f=document.getElementById(a.id+"_bb");f&&f.parentNode.removeChild(f)}OpenLayers.Element.removeClass(e,b)}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=d?this.div.lastChild:a.imgDiv;for(var g=this.transitionendEvents,h=g.length-1;h>=0;--h)OpenLayers.Event.observe(this._transitionElement,g[h],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1,this.events.triggerEvent("loadend")}},a.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:a})},a.events.on({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},removeTileMonitoringHooks:function(a){a.unload(),a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},moveGriddedTiles:function(){for(var a=this.buffer+1;;){var b=this.grid[0][0],c={x:b.position.x+this.map.layerContainerOriginPx.x,y:b.position.y+this.map.layerContainerOriginPx.y},d=this.getServerResolution()/this.map.getResolution(),e={w:Math.round(this.tileSize.w*d),h:Math.round(this.tileSize.h*d)};if(c.x>-e.w*(a-1))this.shiftColumn(!0,e);else if(c.x<-e.w*a)this.shiftColumn(!1,e);else if(c.y>-e.h*(a-1))this.shiftRow(!0,e);else{if(!(c.y<-e.h*a))break;this.shiftRow(!1,e)}}},shiftRow:function(a,b){var c=this.grid,d=a?0:c.length-1,e=a?-1:1,f=this.rowSign,g=this.gridLayout;g.startrow+=e*f;for(var h=c[d],i=c[a?"pop":"shift"](),j=0,k=i.length;k>j;j++){var l=i[j],m=h[j].position.clone();m.y+=b.h*e,l.moveTo(this.getTileBoundsForGridIndex(d,j),m)}c[a?"unshift":"push"](i)},shiftColumn:function(a,b){var c=this.grid,d=a?0:c[0].length-1,e=a?-1:1,f=this.gridLayout;f.startcol+=e;for(var g=0,h=c.length;h>g;g++){var i=c[g],j=i[d].position.clone(),k=i[a?"pop":"shift"]();j.x+=b.w*e,k.moveTo(this.getTileBoundsForGridIndex(g,d),j),i[a?"unshift":"push"](k)}},removeExcessTiles:function(a,b){for(var c,d;this.grid.length>a;){var e=this.grid.pop();for(c=0,d=e.length;d>c;c++){var f=e[c];this.destroyTile(f)}}for(c=0,d=this.grid.length;d>c;c++)for(;this.grid[c].length>b;){var e=this.grid[c],f=e.pop();this.destroyTile(f)}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(a){var b=this.maxExtent,c=this.getResolution(),d=c*this.tileSize.w,e=c*this.tileSize.h,f=this.getLonLatFromViewPortPx(a),g=b.left+d*Math.floor((f.lon-b.left)/d),h=b.bottom+e*Math.floor((f.lat-b.bottom)/e);return new OpenLayers.Bounds(g,h,g+d,h+e)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:["antialiasing","blockout","font","fontcolor","fontsize","fontstyle","glowing","interval","outline","printmode","shadow","transparency"],request:null,response:null,initialize:function(a){if(this.request=new OpenLayers.Format.ArcXML.Request,this.response=new OpenLayers.Format.ArcXML.Response,a)if("feature"==a.requesttype){this.request.get_image=null;var b=this.request.get_feature.query;this.addCoordSys(b.featurecoordsys,a.featureCoordSys),this.addCoordSys(b.filtercoordsys,a.filterCoordSys),a.polygon?(b.isspatial=!0,b.spatialfilter.polygon=a.polygon):a.envelope&&(b.isspatial=!0,b.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(b.spatialfilter.envelope,a.envelope))}else if("image"==a.requesttype){this.request.get_feature=null;var c=this.request.get_image.properties;this.parseEnvelope(c.envelope,a.envelope),this.addLayers(c.layerlist,a.layers),this.addImageSize(c.imagesize,a.tileSize),this.addCoordSys(c.featurecoordsys,a.featureCoordSys),this.addCoordSys(c.filtercoordsys,a.filterCoordSys)}else this.request=null;OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},parseEnvelope:function(a,b){b&&4==b.length&&(a.minx=b[0],a.miny=b[1],a.maxx=b[2],a.maxy=b[3])},addLayers:function(a,b){for(var c=0,d=b.length;d>c;c++)a.push(b[c])},addImageSize:function(a,b){null!==b&&(a.width=b.w,a.height=b.h,a.printwidth=b.w,a.printheight=b.h)},addCoordSys:function(a,b){"string"==typeof b?(a.id=parseInt(b),a.string=b):"object"==typeof b&&null!==b.proj?(a.id=b.proj.srsProjNumber,a.string=b.proj.srsCode):a=b},iserror:function(a){var b=null;if(a){a=OpenLayers.Format.XML.prototype.read.apply(this,[a]);var c=a.documentElement.getElementsByTagName("ERROR");b=null!==c&&c.length>0}else b=""!==this.response.error;return b},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null;if(a&&a.documentElement&&(b="ARCXML"==a.documentElement.nodeName?a.documentElement:a.documentElement.getElementsByTagName("ARCXML")[0]),!b||"parsererror"===b.firstChild.nodeName){var c,d;try{c=a.firstChild.nodeValue,d=a.firstChild.childNodes[1].firstChild.nodeValue}catch(e){}throw{message:"Error parsing the ArcXML request",error:c,source:d}}var f=this.parseResponse(b);return f},write:function(a){a||(a=this.request);var b=this.createElementNS("","ARCXML");b.setAttribute("version","1.1");var c=this.createElementNS("","REQUEST");if(null!=a.get_image){var d=this.createElementNS("","GET_IMAGE");c.appendChild(d);var e=this.createElementNS("","PROPERTIES");d.appendChild(e);var f=a.get_image.properties;if(null!=f.featurecoordsys){var g=this.createElementNS("","FEATURECOORDSYS");e.appendChild(g),0===f.featurecoordsys.id?g.setAttribute("string",f.featurecoordsys.string):g.setAttribute("id",f.featurecoordsys.id)}if(null!=f.filtercoordsys){var h=this.createElementNS("","FILTERCOORDSYS");e.appendChild(h),0===f.filtercoordsys.id?h.setAttribute("string",f.filtercoordsys.string):h.setAttribute("id",f.filtercoordsys.id)}if(null!=f.envelope){var i=this.createElementNS("","ENVELOPE");e.appendChild(i),i.setAttribute("minx",f.envelope.minx),i.setAttribute("miny",f.envelope.miny),i.setAttribute("maxx",f.envelope.maxx),i.setAttribute("maxy",f.envelope.maxy)}var j=this.createElementNS("","IMAGESIZE");if(e.appendChild(j),j.setAttribute("height",f.imagesize.height),j.setAttribute("width",f.imagesize.width),(f.imagesize.height!=f.imagesize.printheight||f.imagesize.width!=f.imagesize.printwidth)&&(j.setAttribute("printheight",f.imagesize.printheight),j.setArrtibute("printwidth",f.imagesize.printwidth)),null!=f.background){var k=this.createElementNS("","BACKGROUND");e.appendChild(k),k.setAttribute("color",f.background.color.r+","+f.background.color.g+","+f.background.color.b),null!==f.background.transcolor&&k.setAttribute("transcolor",f.background.transcolor.r+","+f.background.transcolor.g+","+f.background.transcolor.b)}if(null!=f.layerlist&&f.layerlist.length>0){var l=this.createElementNS("","LAYERLIST");e.appendChild(l);for(var m=0;m<f.layerlist.length;m++){var n=this.createElementNS("","LAYERDEF");if(l.appendChild(n),n.setAttribute("id",f.layerlist[m].id),n.setAttribute("visible",f.layerlist[m].visible),"object"==typeof f.layerlist[m].query){var o=f.layerlist[m].query;if(o.where.length<0)continue;var p=null;p="boolean"==typeof o.spatialfilter&&o.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),p.setAttribute("where",o.where),"number"==typeof o.accuracy&&o.accuracy>0&&p.setAttribute("accuracy",o.accuracy),"number"==typeof o.featurelimit&&o.featurelimit<2e3&&p.setAttribute("featurelimit",o.featurelimit),"string"==typeof o.subfields&&"#ALL#"!=o.subfields&&p.setAttribute("subfields",o.subfields),"string"==typeof o.joinexpression&&o.joinexpression.length>0&&p.setAttribute("joinexpression",o.joinexpression),"string"==typeof o.jointables&&o.jointables.length>0&&p.setAttribute("jointables",o.jointables),n.appendChild(p)}"object"==typeof f.layerlist[m].renderer&&this.addRenderer(n,f.layerlist[m].renderer)}}}else if(null!=a.get_feature){var d=this.createElementNS("","GET_FEATURES");if(d.setAttribute("outputmode","newxml"),d.setAttribute("checkesc","true"),a.get_feature.geometry?d.setAttribute("geometry",a.get_feature.geometry):d.setAttribute("geometry","false"),a.get_feature.compact&&d.setAttribute("compact",a.get_feature.compact),"number"==a.get_feature.featurelimit&&d.setAttribute("featurelimit",a.get_feature.featurelimit),d.setAttribute("globalenvelope","true"),c.appendChild(d),null!=a.get_feature.layer&&a.get_feature.layer.length>0){var q=this.createElementNS("","LAYER");q.setAttribute("id",a.get_feature.layer),d.appendChild(q)}var r=a.get_feature.query;if(null!=r){var s=null;if(s=r.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),d.appendChild(s),"number"==typeof r.accuracy&&s.setAttribute("accuracy",r.accuracy),null!=r.featurecoordsys){var t=this.createElementNS("","FEATURECOORDSYS");0==r.featurecoordsys.id?t.setAttribute("string",r.featurecoordsys.string):t.setAttribute("id",r.featurecoordsys.id),s.appendChild(t)}if(null!=r.filtercoordsys){var u=this.createElementNS("","FILTERCOORDSYS");0===r.filtercoordsys.id?u.setAttribute("string",r.filtercoordsys.string):u.setAttribute("id",r.filtercoordsys.id),s.appendChild(u)}if(r.buffer>0){var v=this.createElementNS("","BUFFER");v.setAttribute("distance",r.buffer),s.appendChild(v)}if(r.isspatial){var w=this.createElementNS("","SPATIALFILTER");if(w.setAttribute("relation",r.spatialfilter.relation),s.appendChild(w),r.spatialfilter.envelope){var x=this.createElementNS("","ENVELOPE");x.setAttribute("minx",r.spatialfilter.envelope.minx),x.setAttribute("miny",r.spatialfilter.envelope.miny),x.setAttribute("maxx",r.spatialfilter.envelope.maxx),x.setAttribute("maxy",r.spatialfilter.envelope.maxy),w.appendChild(x)}else"object"==typeof r.spatialfilter.polygon&&w.appendChild(this.writePolygonGeometry(r.spatialfilter.polygon))}null!=r.where&&r.where.length>0&&s.setAttribute("where",r.where)}}return b.appendChild(c),OpenLayers.Format.XML.prototype.write.apply(this,[b])},addGroupRenderer:function(a,b){var c=this.createElementNS("","GROUPRENDERER");a.appendChild(c);for(var d=0;d<b.length;d++){var e=b[d];this.addRenderer(c,e)}},addRenderer:function(a,b){if(OpenLayers.Util.isArray(b))this.addGroupRenderer(a,b);else{var c=this.createElementNS("",b.type.toUpperCase()+"RENDERER");a.appendChild(c),"VALUEMAPRENDERER"==c.tagName?this.addValueMapRenderer(c,b):"VALUEMAPLABELRENDERER"==c.tagName?this.addValueMapLabelRenderer(c,b):"SIMPLELABELRENDERER"==c.tagName?this.addSimpleLabelRenderer(c,b):"SCALEDEPENDENTRENDERER"==c.tagName&&this.addScaleDependentRenderer(c,b)}},addScaleDependentRenderer:function(a,b){("string"==typeof b.lower||"number"==typeof b.lower)&&a.setAttribute("lower",b.lower),("string"==typeof b.upper||"number"==typeof b.upper)&&a.setAttribute("upper",b.upper),this.addRenderer(a,b.renderer)},addValueMapLabelRenderer:function(a,b){if(a.setAttribute("lookupfield",b.lookupfield),a.setAttribute("labelfield",b.labelfield),"object"==typeof b.exacts)for(var c=0,d=b.exacts.length;d>c;c++){var e=b.exacts[c],f=this.createElementNS("","EXACT");if("string"==typeof e.value&&f.setAttribute("value",e.value),"string"==typeof e.label&&f.setAttribute("label",e.label),"string"==typeof e.method&&f.setAttribute("method",e.method),a.appendChild(f),"object"==typeof e.symbol){var g=null;if("text"==e.symbol.type&&(g=this.createElementNS("","TEXTSYMBOL")),null!=g){for(var h=this.fontStyleKeys,i=0,j=h.length;j>i;i++){var k=h[i];e.symbol[k]&&g.setAttribute(k,e.symbol[k])}f.appendChild(g)}}}},addValueMapRenderer:function(a,b){if(a.setAttribute("lookupfield",b.lookupfield),"object"==typeof b.ranges)for(var c=0,d=b.ranges.length;d>c;c++){var e=b.ranges[c],f=this.createElementNS("","RANGE");if(f.setAttribute("lower",e.lower),f.setAttribute("upper",e.upper),a.appendChild(f),"object"==typeof e.symbol){var g=null;"simplepolygon"==e.symbol.type&&(g=this.createElementNS("","SIMPLEPOLYGONSYMBOL")),null!=g&&("string"==typeof e.symbol.boundarycolor&&g.setAttribute("boundarycolor",e.symbol.boundarycolor),"string"==typeof e.symbol.fillcolor&&g.setAttribute("fillcolor",e.symbol.fillcolor),"number"==typeof e.symbol.filltransparency&&g.setAttribute("filltransparency",e.symbol.filltransparency),f.appendChild(g))}}else if("object"==typeof b.exacts)for(var h=0,i=b.exacts.length;i>h;h++){var j=b.exacts[h],k=this.createElementNS("","EXACT");if("string"==typeof j.value&&k.setAttribute("value",j.value),"string"==typeof j.label&&k.setAttribute("label",j.label),"string"==typeof j.method&&k.setAttribute("method",j.method),a.appendChild(k),"object"==typeof j.symbol){var g=null;"simplemarker"==j.symbol.type&&(g=this.createElementNS("","SIMPLEMARKERSYMBOL")),null!=g&&("string"==typeof j.symbol.antialiasing&&g.setAttribute("antialiasing",j.symbol.antialiasing),"string"==typeof j.symbol.color&&g.setAttribute("color",j.symbol.color),"string"==typeof j.symbol.outline&&g.setAttribute("outline",j.symbol.outline),"string"==typeof j.symbol.overlap&&g.setAttribute("overlap",j.symbol.overlap),"string"==typeof j.symbol.shadow&&g.setAttribute("shadow",j.symbol.shadow),"number"==typeof j.symbol.transparency&&g.setAttribute("transparency",j.symbol.transparency),"string"==typeof j.symbol.usecentroid&&g.setAttribute("usecentroid",j.symbol.usecentroid),"number"==typeof j.symbol.width&&g.setAttribute("width",j.symbol.width),k.appendChild(g))}}},addSimpleLabelRenderer:function(a,b){a.setAttribute("field",b.field);for(var c=["featureweight","howmanylabels","labelbufferratio","labelpriorities","labelweight","linelabelposition","rotationalangles"],d=0,e=c.length;e>d;d++){var f=c[d];b[f]&&a.setAttribute(f,b[f])}if("text"==b.symbol.type){var g=b.symbol,h=this.createElementNS("","TEXTSYMBOL");a.appendChild(h);for(var c=this.fontStyleKeys,d=0,e=c.length;e>d;d++){var f=c[d];g[f]&&h.setAttribute(f,b[f])}}},writePolygonGeometry:function(a){if(!(a instanceof OpenLayers.Geometry.Polygon))throw{message:"Cannot write polygon geometry to ArcXML with an "+a.CLASS_NAME+" object.",geometry:a};for(var b=this.createElementNS("","POLYGON"),c=0,d=a.components.length;d>c;c++){for(var e=a.components[c],f=this.createElementNS("","RING"),g=0,h=e.components.length;h>g;g++){var i=e.components[g],j=this.createElementNS("","POINT");j.setAttribute("x",i.x),j.setAttribute("y",i.y),f.appendChild(j)}b.appendChild(f)}return b},parseResponse:function(a){if("string"==typeof a){var b=new OpenLayers.Format.XML;a=b.read(a)}var c=new OpenLayers.Format.ArcXML.Response,d=a.getElementsByTagName("ERROR");if(null!=d&&d.length>0)c.error=this.getChildValue(d,"Unknown error.");else{var e=a.getElementsByTagName("RESPONSE");if(null==e||0==e.length)return c.error="No RESPONSE tag found in ArcXML response.",c;var f=e[0].firstChild.nodeName;if("#text"==f&&(f=e[0].firstChild.nextSibling.nodeName),"IMAGE"==f){var g=a.getElementsByTagName("ENVELOPE"),h=a.getElementsByTagName("OUTPUT");if(null==g||0==g.length)c.error="No ENVELOPE tag found in ArcXML response.";else if(null==h||0==h.length)c.error="No OUTPUT tag found in ArcXML response.";else{var i=this.parseAttributes(g[0]),j=this.parseAttributes(h[0]);c.image="string"==typeof j.type?{envelope:i,output:{type:j.type,data:this.getChildValue(h[0])}}:{envelope:i,output:j}}}else if("FEATURES"==f){var k=e[0].getElementsByTagName("FEATURES"),l=k[0].getElementsByTagName("FEATURECOUNT");if(c.features.featurecount=l[0].getAttribute("count"),c.features.featurecount>0){var m=k[0].getElementsByTagName("ENVELOPE");c.features.envelope=this.parseAttributes(m[0],"number");for(var n=k[0].getElementsByTagName("FEATURE"),o=0;o<n.length;o++){for(var p=new OpenLayers.Feature.Vector,q=n[o].getElementsByTagName("FIELD"),r=0;r<q.length;r++){var s=q[r].getAttribute("name"),t=q[r].getAttribute("value");p.attributes[s]=t}var u=n[o].getElementsByTagName("POLYGON");if(u.length>0){for(var v=u[0].getElementsByTagName("RING"),w=[],x=0;x<v.length;x++){var y=[];y.push(this.parsePointGeometry(v[x]));for(var z=v[x].getElementsByTagName("HOLE"),A=0;A<z.length;A++)y.push(this.parsePointGeometry(z[A]));z=null,w.push(new OpenLayers.Geometry.Polygon(y)),y=null}v=null,p.geometry=1==w.length?w[0]:new OpenLayers.Geometry.MultiPolygon(w)}c.features.feature.push(p)}}}else c.error="Unidentified response type."}return c},parseAttributes:function(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].nodeName]="number"==b?parseFloat(a.attributes[d].nodeValue):a.attributes[d].nodeValue;return c},parsePointGeometry:function(a){var b=[],c=a.getElementsByTagName("COORDS");if(c.length>0){var d=this.getChildValue(c[0]);d=d.split(/;/);for(var e=0;e<d.length;e++){var f=d[e].split(/ /);b.push(new OpenLayers.Geometry.Point(f[0],f[1]))}c=null}else{var g=a.getElementsByTagName("POINT");if(g.length>0)for(var h=0;h<g.length;h++)b.push(new OpenLayers.Geometry.Point(parseFloat(g[h].getAttribute("x")),parseFloat(g[h].getAttribute("y"))));g=null}return new OpenLayers.Geometry.LinearRing(b)},CLASS_NAME:"OpenLayers.Format.ArcXML"}),OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(){var a={get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:!1,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]};return OpenLayers.Util.extend(this,a)},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"}),OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(){var a={image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""};return OpenLayers.Util.extend(this,a)},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"}),function(){function a(){this._object=h&&!k?new h:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function b(){return new a}function c(a){if(a._object.send(a._data),i&&!a._async)for(a.readyState=b.OPENED,f(a);a.readyState<b.DONE;)if(a.readyState++,d(a),a._aborted)return}function d(a){b.onreadystatechange&&b.onreadystatechange.apply(a),a.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function e(a){var b=a.responseXML,c=a.responseText;return j&&c&&b&&!b.documentElement&&a.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(b=new window.ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.validateOnParse=!1,b.loadXML(c)),b&&(j&&0!=b.parseError||!b.documentElement||b.documentElement&&"parsererror"==b.documentElement.tagName)?null:b}function f(a){try{a.responseText=a._object.responseText}catch(b){}try{a.responseXML=e(a._object)}catch(b){}try{a.status=a._object.status}catch(b){}try{a.statusText=a._object.statusText}catch(b){}}function g(a){a._object.onreadystatechange=new window.Function}var h=window.XMLHttpRequest,i=!!window.controllers,j=window.document.all&&!window.opera,k=j&&window.navigator.userAgent.match(/MSIE 7.0/);b.prototype=a.prototype,i&&h.wrapped&&(b.wrapped=h.wrapped),b.UNSENT=0,b.OPENED=1,b.HEADERS_RECEIVED=2,b.LOADING=3,b.DONE=4,b.prototype.readyState=b.UNSENT,b.prototype.responseText="",b.prototype.responseXML=null,b.prototype.status=0,b.prototype.statusText="",b.prototype.priority="NORMAL",b.prototype.onreadystatechange=null,b.onreadystatechange=null,b.onopen=null,b.onsend=null,b.onabort=null,b.prototype.open=function(a,c,e,h,k){delete this._headers,arguments.length<3&&(e=!0),this._async=e;var l,m=this,n=this.readyState;j&&e&&(l=function(){n!=b.DONE&&(g(m),m.abort())},window.attachEvent("onunload",l)),b.onopen&&b.onopen.apply(this,arguments),arguments.length>4?this._object.open(a,c,e,h,k):arguments.length>3?this._object.open(a,c,e,h):this._object.open(a,c,e),this.readyState=b.OPENED,d(this),this._object.onreadystatechange=function(){if(!i||e){if(m.readyState=m._object.readyState,f(m),m._aborted)return void(m.readyState=b.UNSENT);m.readyState==b.DONE&&(delete m._data,g(m),j&&e&&window.detachEvent("onunload",l)),n!=m.readyState&&d(m),n=m.readyState}}},b.prototype.send=function(a){b.onsend&&b.onsend.apply(this,arguments),arguments.length||(a=null),a&&a.nodeType&&(a=window.XMLSerializer?(new window.XMLSerializer).serializeToString(a):a.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=a,c(this)},b.prototype.abort=function(){b.onabort&&b.onabort.apply(this,arguments),this.readyState>b.UNSENT&&(this._aborted=!0),this._object.abort(),g(this),this.readyState=b.UNSENT,delete this._data},b.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},b.prototype.getResponseHeader=function(a){return this._object.getResponseHeader(a)},b.prototype.setRequestHeader=function(a,b){return this._headers||(this._headers={}),this._headers[a]=b,this._object.setRequestHeader(a,b)},b.prototype.addEventListener=function(a,b,c){for(var d,e=0;d=this._listeners[e];e++)if(d[0]==a&&d[1]==b&&d[2]==c)return;this._listeners.push([a,b,c])},b.prototype.removeEventListener=function(a,b,c){for(var d,e=0;(d=this._listeners[e])&&(d[0]!=a||d[1]!=b||d[2]!=c);e++);d&&this._listeners.splice(e,1)},b.prototype.dispatchEvent=function(a){var b={type:a.type,target:this,currentTarget:this,eventPhase:2,bubbles:a.bubbles,cancelable:a.cancelable,timeStamp:a.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==b.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[b]);for(var c,d=0;c=this._listeners[d];d++)c[0]!=b.type||c[2]||(c[1].handleEvent||c[1]).apply(this,[b])},b.prototype.toString=function(){return"[object XMLHttpRequest]"},b.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(a,b){b||(b=[]),a.__func=this,a.__func(b[0],b[1],b[2],b[3],b[4]),delete a.__func}),OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Request.XMLHttpRequest=b}(),OpenLayers.ProxyHost="",OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(a,b){var c=0!==a.indexOf("http"),d=!c&&a.match(this.URL_SPLIT_REGEX);if(d){var e=window.location;c=d[1]==e.protocol&&d[3]==e.hostname;var f=d[4],g=e.port;(80!=f&&""!=f||"80"!=g&&""!=g)&&(c=c&&f==g)}return c||b&&(a="function"==typeof b?b(a):b+encodeURIComponent(a)),a},issue:function(a){var b=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});a=a||{},a.headers=a.headers||{},a=OpenLayers.Util.applyDefaults(a,b),a.headers=OpenLayers.Util.applyDefaults(a.headers,b.headers);var c,d=!1;for(c in a.headers)a.headers.hasOwnProperty(c)&&"x-requested-with"===c.toLowerCase()&&(d=!0);d===!1&&(a.headers["X-Requested-With"]="XMLHttpRequest");var e=new OpenLayers.Request.XMLHttpRequest,f=OpenLayers.Util.urlAppend(a.url,OpenLayers.Util.getParameterString(a.params||{}));f=OpenLayers.Request.makeSameOrigin(f,a.proxy),e.open(a.method,f,a.async,a.user,a.password);for(var g in a.headers)e.setRequestHeader(g,a.headers[g]);var h=this.events,i=this;return e.onreadystatechange=function(){if(e.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var b=h.triggerEvent("complete",{request:e,config:a,requestUrl:f});b!==!1&&i.runCallbacks({request:e,config:a,requestUrl:f})}},a.async===!1?e.send(a.data):window.setTimeout(function(){0!==e.readyState&&e.send(a.data)},0),e},runCallbacks:function(a){var b,c=a.request,d=a.config,e=d.scope?OpenLayers.Function.bind(d.callback,d.scope):d.callback;d.success&&(b=d.scope?OpenLayers.Function.bind(d.success,d.scope):d.success);var f;d.failure&&(f=d.scope?OpenLayers.Function.bind(d.failure,d.scope):d.failure),"file:"==OpenLayers.Util.createUrlObject(d.url).protocol&&c.responseText&&(c.status=200),e(c),(!c.status||c.status>=200&&c.status<300)&&(this.events.triggerEvent("success",a),b&&b(c)),c.status&&(c.status<200||c.status>=300)&&(this.events.triggerEvent("failure",a),f&&f(c))},GET:function(a){return a=OpenLayers.Util.extend(a,{method:"GET"}),OpenLayers.Request.issue(a)},POST:function(a){return a=OpenLayers.Util.extend(a,{method:"POST"}),a.headers=a.headers?a.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(a)},PUT:function(a){return a=OpenLayers.Util.extend(a,{method:"PUT"}),a.headers=a.headers?a.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(a)},DELETE:function(a){return a=OpenLayers.Util.extend(a,{method:"DELETE"}),OpenLayers.Request.issue(a)},HEAD:function(a){return a=OpenLayers.Util.extend(a,{method:"HEAD"}),OpenLayers.Request.issue(a)},OPTIONS:function(a){return a=OpenLayers.Util.extend(a,{method:"OPTIONS"}),OpenLayers.Request.issue(a)}}),OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"},initialize:function(a,b,c){this.tileSize=new OpenLayers.Size(512,512),this.params=OpenLayers.Util.applyDefaults({ServiceName:c.serviceName},this.DEFAULT_PARAMS),this.options=OpenLayers.Util.applyDefaults(c,this.DEFAULT_OPTIONS),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,this.params,c]),this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.format&&(this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png")),null===this.options.layers&&(this.options.layers=[])
},getURL:function(a){var b="";a=this.adjustBounds(a);var c=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:a.toArray(),tileSize:this.tileSize})),d=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:c.write(),async:!1});if(null!=d){var e=d.responseXML;e&&e.documentElement||(e=d.responseText);var f=new OpenLayers.Format.ArcXML,g=f.read(e);b=this.getUrlOrImage(g.image.output)}return b},getURLasync:function(a,b,c){a=this.adjustBounds(a);var d=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:a.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:!0,data:d.write(),callback:function(a){var d=a.responseXML;d&&d.documentElement||(d=a.responseText);var e=new OpenLayers.Format.ArcXML,f=e.read(d);b.call(c,this.getUrlOrImage(f.image.output))},scope:this})},getUrlOrImage:function(a){var b="";return a.url?b=a.url:a.data&&(b="data:image/"+a.type+";base64,"+a.data),b},setLayerQuery:function(a,b){for(var c=0;c<this.options.layers.length;c++)if(a==this.options.layers[c].id)return void(this.options.layers[c].query=b);this.options.layers.push({id:a,visible:!0,query:b})},getFeatureInfo:function(a,b,c){var d=c.buffer||1,e=c.callback||function(){},f=c.scope||window,g={};OpenLayers.Util.extend(g,this.options),g.requesttype="feature",a instanceof OpenLayers.LonLat?(g.polygon=null,g.envelope=[a.lon-d,a.lat-d,a.lon+d,a.lat+d]):a instanceof OpenLayers.Geometry.Polygon&&(g.envelope=null,g.polygon=a);var h=new OpenLayers.Format.ArcXML(g);if(OpenLayers.Util.extend(h.request.get_feature,c),h.request.get_feature.layer=b.id,"number"==typeof b.query.accuracy)h.request.get_feature.query.accuracy=b.query.accuracy;else{var i=this.map.getCenter(),j=this.map.getViewPortPxFromLonLat(i);j.x++;var k=this.map.getLonLatFromPixel(j);h.request.get_feature.query.accuracy=k.lon-i.lon}h.request.get_feature.query.where=b.query.where,h.request.get_feature.query.spatialfilter.relation="area_intersection",OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:h.write(),callback:function(a){var b=h.parseResponse(a.responseText);h.iserror()?e.call(f,null):e.call(f,b.features)}})},clone:function(a){return null==a&&(a=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.ArcIMS"}),OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y),OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),this.removeButtons(),this.buttons=null,this.position=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments),a=this.position,this.buttons=[];var b={w:18,h:18},c=new OpenLayers.Pixel(a.x+b.w/2,a.y);return this._addButton("panup","north-mini.png",c,b),a.y=c.y+b.h,this._addButton("panleft","west-mini.png",a,b),this._addButton("panright","east-mini.png",a.add(b.w,0),b),this._addButton("pandown","south-mini.png",c.add(0,2*b.h),b),this._addButton("zoomin","zoom-plus-mini.png",c.add(0,3*b.h+5),b),this._addButton("zoomworld","zoom-world-mini.png",c.add(0,4*b.h+5),b),this._addButton("zoomout","zoom-minus-mini.png",c.add(0,5*b.h+5),b),this.div},_addButton:function(a,b,c,d){var e=OpenLayers.Util.getImageLocation(b),f=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,c,d,e,"absolute");return f.style.cursor="pointer",this.div.appendChild(f),f.action=a,f.className="olButton",this.buttons.push(f),f},_removeButton:function(a){this.div.removeChild(a),OpenLayers.Util.removeItem(this.buttons,a)},removeButtons:function(){for(var a=this.buttons.length-1;a>=0;--a)this._removeButton(this.buttons[a])},onButtonClick:function(a){var b=a.buttonElement;switch(b.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"}),OpenLayers.Control.PanZoom.X=4,OpenLayers.Control.PanZoom.Y=4,OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw()},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments),a=this.position.clone(),this.buttons=[];var b={w:18,h:18};if(this.panIcons){var c=new OpenLayers.Pixel(a.x+b.w/2,a.y),d=b.w;this.zoomWorldIcon&&(c=new OpenLayers.Pixel(a.x+b.w,a.y)),this._addButton("panup","north-mini.png",c,b),a.y=c.y+b.h,this._addButton("panleft","west-mini.png",a,b),this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",a.add(b.w,0),b),d*=2),this._addButton("panright","east-mini.png",a.add(d,0),b),this._addButton("pandown","south-mini.png",c.add(0,2*b.h),b),this._addButton("zoomin","zoom-plus-mini.png",c.add(0,3*b.h+5),b),c=this._addZoomBar(c.add(0,4*b.h+5)),this._addButton("zoomout","zoom-minus-mini.png",c,b)}else this._addButton("zoomin","zoom-plus-mini.png",a,b),c=this._addZoomBar(a.add(0,b.h)),this._addButton("zoomout","zoom-minus-mini.png",c,b),this.zoomWorldIcon&&(c=c.add(0,b.h+3),this._addButton("zoomworld","zoom-world-mini.png",c,b));return this.div},_addZoomBar:function(a){var b=OpenLayers.Util.getImageLocation("slider.png"),c=this.id+"_"+this.map.id,d=this.map.getMinZoom(),e=this.map.getNumZoomLevels()-1-this.map.getZoom(),f=OpenLayers.Util.createAlphaImageDiv(c,a.add(-1,e*this.zoomStopHeight),{w:20,h:9},b,"absolute");f.style.cursor="move",this.slider=f,this.sliderEvents=new OpenLayers.Events(this,f,null,!0,{includeXY:!0}),this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var g={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-d)},b=OpenLayers.Util.getImageLocation("zoombar.png"),h=null;if(OpenLayers.Util.alphaHack()){var c=this.id+"_"+this.map.id;h=OpenLayers.Util.createAlphaImageDiv(c,a,{w:g.w,h:this.zoomStopHeight},b,"absolute",null,"crop"),h.style.height=g.h+"px"}else h=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,g,b);return h.style.cursor="pointer",h.className="olButton",this.zoombarDiv=h,this.div.appendChild(h),this.startTop=parseInt(h.style.top),this.div.appendChild(f),this.map.events.register("zoomend",this,this.moveZoomBar),a=a.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-d))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider),this.slider=null,this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(a){if(OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments),a.buttonElement===this.zoombarDiv){var b=a.buttonXY.y/this.zoomStopHeight;(this.forceFixedZoomLevel||!this.map.fractionalZoom)&&(b=Math.floor(b));var c=this.map.getNumZoomLevels()-1-b;c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1),this.map.zoomTo(c)}},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},zoomBarDown:function(a){(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))&&(this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=a.xy.clone(),this.zoomStart=a.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(a))},zoomBarDrag:function(a){if(null!=this.mouseDragStart){var b=this.mouseDragStart.y-a.xy.y,c=OpenLayers.Util.pagePosition(this.zoombarDiv);if(a.clientY-c[1]>0&&a.clientY-c[1]<parseInt(this.zoombarDiv.style.height)-2){var d=parseInt(this.slider.style.top)-b;this.slider.style.top=d+"px",this.mouseDragStart=a.xy.clone()}this.deltaY=this.zoomStart.y-a.xy.y,OpenLayers.Event.stop(a)}},zoomBarUp:function(a){if((OpenLayers.Event.isLeftClick(a)||"touchend"===a.type)&&this.mouseDragStart){this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var b=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(b+=this.deltaY/this.zoomStopHeight,b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1)):(b+=this.deltaY/this.zoomStopHeight,b=Math.max(Math.round(b),0)),this.map.zoomTo(b),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(a)}},moveZoomBar:function(){var a=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"}),OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"}),OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"featureTypeList",defaultPrefix:"wfs",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{wfs:{WFS_Capabilities:function(a,b){this.readChildNodes(a,b)},FeatureTypeList:function(a,b){b.featureTypeList={featureTypes:[]},this.readChildNodes(a,b.featureTypeList)},FeatureType:function(a,b){var c={};this.readChildNodes(a,c),b.featureTypes.push(c)},Name:function(a,b){var c=this.getChildValue(a);if(c){var d=c.split(":");b.name=d.pop(),d.length>0&&(b.featureNS=this.lookupNamespaceURI(a,d[0]))}},Title:function(a,b){var c=this.getChildValue(a);c&&(b.title=c)},Abstract:function(a,b){var c=this.getChildValue(a);c&&(b["abstract"]=c)}}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"}),OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(a,b){var c=this.getChildValue(a);c&&(b.srs=c)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"}),OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(a,b,c,d,e){this.url=b,this.extent=c,this.maxExtent=c,this.size=d,OpenLayers.Layer.prototype.initialize.apply(this,[a,e]),this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null),OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setMap:function(){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w),OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(a,b){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var c=null==this.tile;if(b||c){this.setTileSize();var d=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});c?(this.tile=new OpenLayers.Tile.Image(this,d,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=d.clone()),this.tile.draw()}},setTileSize:function(){var a=this.extent.getWidth()/this.map.getResolution(),b=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(a,b)},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("loadstart")},a.events.register("loadstart",this,a.onLoadStart),a.onLoadEnd=function(){this.events.triggerEvent("loadend")},a.events.register("loadend",this,a.onLoadEnd),a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload(),a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},setUrl:function(a){this.url=a,this.tile.draw()},getURL:function(){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(a){OpenLayers.Util.extend(this,a),this.options=a,this.active=!1},destroy:function(){this.deactivate(),this.layer=null,this.options=null},setLayer:function(a){this.layer=a},activate:function(){return this.active?!1:(this.active=!0,!0)},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:!1,timer:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a]),this.events=new OpenLayers.Events(this)},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&this.auto&&("number"==typeof this.auto?this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1e3*this.auto):this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.auto&&("number"==typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),a},triggerSave:function(a){var b=a.feature;(b.state===OpenLayers.State.INSERT||b.state===OpenLayers.State.UPDATE||b.state===OpenLayers.State.DELETE)&&this.save([a.feature])},save:function(a){a||(a=this.layer.features),this.events.triggerEvent("start",{features:a});var b=this.layer.projection,c=this.layer.map.getProjectionObject();if(!c.equals(b)){for(var d,e,f=a.length,g=new Array(f),h=0;f>h;++h)d=a[h],e=d.clone(),e.fid=d.fid,e.state=d.state,d.url&&(e.url=d.url),e._original=d,e.geometry.transform(c,b),g[h]=e;a=g}this.layer.protocol.commit(a,{callback:this.onCommit,scope:this})},onCommit:function(a){var b={response:a};if(a.success()){for(var c,d,e=a.reqFeatures,f=[],g=a.insertIds||[],h=0,i=0,j=e.length;j>i;++i)d=e[i],d=d._original||d,c=d.state,c&&(c==OpenLayers.State.DELETE?f.push(d):c==OpenLayers.State.INSERT&&(d.fid=g[h],++h),d.state=null);f.length>0&&this.layer.destroyFeatures(f),this.events.triggerEvent("success",b)}else this.events.triggerEvent("fail",b)},CLASS_NAME:"OpenLayers.Strategy.Save"}),OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(a){if(this.target=a,a.object instanceof OpenLayers.Map)this.setMap(a.object);else{if(!(a.object instanceof OpenLayers.Layer.Vector))throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances";a.object.map?this.setMap(a.object.map):a.object.events.register("added",this,function(){this.setMap(a.object.map)})}for(var b=this.provides.length-1;b>=0;--b)a.extensions[this.provides[b]]=!0},setMap:function(a){this.map=a,this.cache={},a.events.register("mousedown",this,this.start,{extension:!0}),a.events.register("mouseup",this,this.onClick,{extension:!0}),a.events.register("touchstart",this,this.start,{extension:!0}),a.events.register("touchmove",this,this.cancel,{extension:!0}),a.events.register("touchend",this,this.onClick,{extension:!0}),a.events.register("mousemove",this,this.onMousemove,{extension:!0})},start:function(a){this.startEvt=a},cancel:function(){delete this.startEvt},onClick:function(a){if(this.startEvt&&("touchend"===a.type||OpenLayers.Event.isLeftClick(a))){var b=this.getFeatures(this.startEvt);delete this.startEvt;for(var c,d,e,f={},g=0,h=b.length;h>g&&(c=b[g],d=c.layer,f[d.id]=!0,e=this.triggerEvent("featureclick",{feature:c}),e!==!1);++g);for(g=0,h=this.map.layers.length;h>g;++g)d=this.map.layers[g],d instanceof OpenLayers.Layer.Vector&&!f[d.id]&&this.triggerEvent("nofeatureclick",{layer:d})}},onMousemove:function(a){delete this.startEvt;for(var b,c=this.getFeatures(a),d={},e=[],f=0,g=c.length;g>f;++f)b=c[f],d[b.id]=b,this.cache[b.id]||e.push(b);var h=[];for(var i in this.cache)b=this.cache[i],b.layer&&b.layer.map?d[b.id]||h.push(b):delete this.cache[i];var j;for(f=0,g=e.length;g>f&&(b=e[f],this.cache[b.id]=b,j=this.triggerEvent("featureover",{feature:b}),j!==!1);++f);for(f=0,g=h.length;g>f&&(b=h[f],delete this.cache[b.id],j=this.triggerEvent("featureout",{feature:b}),j!==!1);++f);},triggerEvent:function(a,b){var c=b.feature?b.feature.layer:b.layer,d=this.target.object;return d instanceof OpenLayers.Map||d===c?this.target.triggerEvent(a,b):void 0},getFeatures:function(a){var b,c,d,e,f,g=a.clientX,h=a.clientY,i=[],j=[],k=[];for(e=this.map.layers.length-1;e>=0;--e)if(b=this.map.layers[e],"none"!==b.div.style.display)if(b.renderer instanceof OpenLayers.Renderer.Elements){if(b instanceof OpenLayers.Layer.Vector)for(c=document.elementFromPoint(g,h);c&&c._featureId;)d=b.getFeatureById(c._featureId),d?(i.push(d),c.style.display="none",j.push(c),c=document.elementFromPoint(g,h)):c=!1;k.push(b),b.div.style.display="none"}else b.renderer instanceof OpenLayers.Renderer.Canvas&&(d=b.renderer.getFeatureIdFromEvent(a),d&&(i.push(d),k.push(b)));for(e=0,f=j.length;f>e;++e)j[e].style.display="";for(e=k.length-1;e>=0;--e)k[e].div.style.display="block";return i},destroy:function(){for(var a=this.provides.length-1;a>=0;--a)delete this.target.extensions[this.provides[a]];this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this}),delete this.cache,delete this.map,delete this.target}}),OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick,OpenLayers.Events.featureover=OpenLayers.Events.featureclick,OpenLayers.Events.featureout=OpenLayers.Events.featureclick,OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:"No description available",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(a){this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=[];if(this.extractTracks)for(var c=a.getElementsByTagName("trk"),d=0,e=c.length;e>d;d++){var f={};this.extractAttributes&&(f=this.parseAttributes(c[d]));for(var g=this.getElementsByTagNameNS(c[d],c[d].namespaceURI,"trkseg"),h=0,i=g.length;i>h;h++){var j=this.extractSegment(g[h],"trkpt");b.push(new OpenLayers.Feature.Vector(j,f))}}if(this.extractRoutes)for(var k=a.getElementsByTagName("rte"),l=0,m=k.length;m>l;l++){var f={};this.extractAttributes&&(f=this.parseAttributes(k[l]));var n=this.extractSegment(k[l],"rtept");b.push(new OpenLayers.Feature.Vector(n,f))}if(this.extractWaypoints)for(var o=a.getElementsByTagName("wpt"),p=0,e=o.length;e>p;p++){var f={};this.extractAttributes&&(f=this.parseAttributes(o[p]));var q=new OpenLayers.Geometry.Point(o[p].getAttribute("lon"),o[p].getAttribute("lat"));b.push(new OpenLayers.Feature.Vector(q,f))}if(this.internalProjection&&this.externalProjection)for(var r=0,s=b.length;s>r;r++)b[r].geometry.transform(this.externalProjection,this.internalProjection);return b},extractSegment:function(a,b){for(var c=this.getElementsByTagNameNS(a,a.namespaceURI,b),d=[],e=0,f=c.length;f>e;e++)d.push(new OpenLayers.Geometry.Point(c[e].getAttribute("lon"),c[e].getAttribute("lat")));return new OpenLayers.Geometry.LineString(d)},parseAttributes:function(a){for(var b,c,d={},e=a.firstChild;e;)1==e.nodeType&&e.firstChild&&(b=e.firstChild,(3==b.nodeType||4==b.nodeType)&&(c=e.prefix?e.nodeName.split(":")[1]:e.nodeName,"trkseg"!=c&&"rtept"!=c&&(d[c]=b.nodeValue))),e=e.nextSibling;return d},write:function(a,b){a=OpenLayers.Util.isArray(a)?a:[a];var c=this.createElementNS(this.namespaces.gpx,"gpx");c.setAttribute("version","1.1"),c.setAttribute("creator",this.creator),this.setAttributes(c,{"xsi:schemaLocation":this.schemaLocation}),b&&"object"==typeof b&&c.appendChild(this.buildMetadataNode(b));for(var d=0,e=a.length;e>d;d++)c.appendChild(this.buildFeatureNode(a[d]));return OpenLayers.Format.XML.prototype.write.apply(this,[c])},buildMetadataNode:function(a){for(var b=["name","desc","author"],c=this.createElementNS(this.namespaces.gpx,"metadata"),d=0;d<b.length;d++){var e=b[d];if(a[e]){var f=this.createElementNS(this.namespaces.gpx,e);f.appendChild(this.createTextNode(a[e])),c.appendChild(f)}}return c},buildFeatureNode:function(a){var b=a.geometry;if(b=b.clone(),this.internalProjection&&this.externalProjection&&b.transform(this.internalProjection,this.externalProjection),"OpenLayers.Geometry.Point"==b.CLASS_NAME){var c=this.buildWptNode(b);return this.appendAttributesNode(c,a),c}var d=this.createElementNS(this.namespaces.gpx,"trk");this.appendAttributesNode(d,a);var e=this.buildTrkSegNode(b);e=OpenLayers.Util.isArray(e)?e:[e];for(var f=0,g=e.length;g>f;f++)d.appendChild(e[f]);return d},buildTrkSegNode:function(a){var b,c,d,e,f;if("OpenLayers.Geometry.LineString"==a.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME){for(b=this.createElementNS(this.namespaces.gpx,"trkseg"),c=0,d=a.components.length;d>c;c++)e=a.components[c],b.appendChild(this.buildTrkPtNode(e));return b}for(f=[],c=0,d=a.components.length;d>c;c++)f.push(this.buildTrkSegNode(a.components[c]));return f},buildTrkPtNode:function(a){var b=this.createElementNS(this.namespaces.gpx,"trkpt");return b.setAttribute("lon",a.x),b.setAttribute("lat",a.y),b},buildWptNode:function(a){var b=this.createElementNS(this.namespaces.gpx,"wpt");return b.setAttribute("lon",a.x),b.setAttribute("lat",a.y),b},appendAttributesNode:function(a,b){var c=this.createElementNS(this.namespaces.gpx,"name");c.appendChild(this.createTextNode(b.attributes.name||b.id)),a.appendChild(c);var d=this.createElementNS(this.namespaces.gpx,"desc");d.appendChild(this.createTextNode(b.attributes.description||this.defaultDesc)),a.appendChild(d)},CLASS_NAME:"OpenLayers.Format.GPX"}),OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"}),OpenLayers.Format.WMSDescribeLayer.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(a){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b,c,d=a.documentElement,e=d.childNodes,f={layerDescriptions:[]},g=0;g<e.length;++g)if(b=e[g],c=b.nodeName,"LayerDescription"==c){var h=b.getAttribute("name"),i="",j="",k="";b.getAttribute("owsType")?(i=b.getAttribute("owsType"),j=b.getAttribute("owsURL")):""!=b.getAttribute("wfs")?(i="WFS",j=b.getAttribute("wfs")):""!=b.getAttribute("wcs")&&(i="WCS",j=b.getAttribute("wcs"));var l=b.getElementsByTagName("Query");l.length>0&&(k=l[0].getAttribute("typeName"),k||(k=l[0].getAttribute("typename")));var m={layerName:h,owsType:i,owsURL:j,typeName:k};f.layerDescriptions.push(m),f.length=f.layerDescriptions.length,f[f.length-1]=m}else if("ServiceException"==c){var n=new OpenLayers.Format.OGCExceptionReport;return{error:n.read(a)}}return f},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1_1"}),OpenLayers.Format.WMSDescribeLayer.v1_1_0=OpenLayers.Format.WMSDescribeLayer.v1_1_1,OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(a,b,c){(c&&c.sphericalMercator||this.sphericalMercator)&&(c=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},c)),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a||this.name,b||this.url,{},c])},clone:function(a){return null==a&&(a=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b=this.getXYZ(a),c=this.url;if(OpenLayers.Util.isArray(c)){var d=""+b.x+b.y+b.z;c=this.selectUrl(d,c)}return OpenLayers.String.format(c,b)},getXYZ:function(a){var b=this.getServerResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.getServerZoom();if(this.wrapDateLine){var f=Math.pow(2,e);c=(c%f+f)%f}return{x:c,y:d,z:e}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a),OpenLayers.Util.extend(this,b)},destroy:function(){this.container=null,this.extent=null,this.size=null,this.resolution=null,this.map=null},supported:function(){return!1},setExtent:function(a,b){if(this.extent=a.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var c=a.getWidth()/this.map.getExtent().getWidth(),a=a.scale(1/c);this.extent=a.wrapDateLine(this.map.getMaxExtent()).scale(c)}return b&&(this.resolution=null),!0},setSize:function(a){this.size=a.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(a,b){if(null==b&&(b=a.style),a.geometry){var c=a.geometry.getBounds();if(c){var d;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent()),c.intersectsBounds(this.extent,{worldBounds:d})?this.calculateFeatureDx(c,d):b={display:"none"};var e=this.drawGeometry(a.geometry,b,a.id);if("none"!=b.display&&b.label&&e!==!1){var f=a.geometry.getCentroid();if(b.labelXOffset||b.labelYOffset){var g=isNaN(b.labelXOffset)?0:b.labelXOffset,h=isNaN(b.labelYOffset)?0:b.labelYOffset,i=this.getResolution();f.move(g*i,h*i)}this.drawText(a.id,b,f)}else this.removeText(a.id);return e}}},calculateFeatureDx:function(a,b){if(this.featureDx=0,b){var c=b.getWidth(),d=(this.extent.left+this.extent.right)/2,e=(a.left+a.right)/2,f=Math.round((e-d)/c);this.featureDx=f*c}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;c>b;++b){var d=a[b];this.eraseGeometry(d.geometry,d.id),this.removeText(d.id)}},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(a){var b=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return a.stroke===!1&&(delete b.strokeWidth,delete b.strokeColor),a.fill===!1&&delete b.fillColor,OpenLayers.Util.extend(b,a),b},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(a,b){this.eraseFeatures(this.features[b][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(a){this.size=a.clone();var b=this.root;if(b.style.width=a.w+"px",b.style.height=a.h+"px",b.width=a.w,b.height=a.h,this.resolution=null,this.hitDetection){var c=this.hitCanvas;c.style.width=a.w+"px",c.style.height=a.h+"px",c.width=a.w,c.height=a.h}},drawFeature:function(a,b){var c;if(a.geometry){b=this.applyDefaultSymbolizer(b||a.style);var d,e=a.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent());var f=e&&e.intersectsBounds(this.extent,{worldBounds:d});c="none"!==b.display&&!!e&&f,c?this.features[a.id]=[a,b]:delete this.features[a.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),c},drawGeometry:function(a,b,c){var d=a.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=d&&"OpenLayers.Geometry.MultiPoint"!=d&&"OpenLayers.Geometry.MultiLineString"!=d&&"OpenLayers.Geometry.MultiPolygon"!=d)switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(a,b,c);break;case"OpenLayers.Geometry.LineString":this.drawLineString(a,b,c);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(a,b,c);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(a,b,c)
}else for(var e=0;e<a.components.length;e++)this.drawGeometry(a.components[e],b,c)},drawExternalGraphic:function(a,b,c){var d=new Image,e=b.title||b.graphicTitle;e&&(d.title=e);var f=b.graphicWidth||b.graphicHeight,g=b.graphicHeight||b.graphicWidth;f=f?f:2*b.pointRadius,g=g?g:2*b.pointRadius;var h=void 0!=b.graphicXOffset?b.graphicXOffset:-(.5*f),i=void 0!=b.graphicYOffset?b.graphicYOffset:-(.5*g),j=b.graphicOpacity||b.fillOpacity,k=function(){if(this.features[c]){var b=this.getLocalXY(a),e=b[0],k=b[1];if(!isNaN(e)&&!isNaN(k)){var l=e+h|0,m=k+i|0,n=this.canvas;n.globalAlpha=j;var o=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);n.drawImage(d,l*o,m*o,f*o,g*o),this.hitDetection&&(this.setHitContextStyle("fill",c),this.hitContext.fillRect(l,m,f,g))}}};d.onload=OpenLayers.Function.bind(k,this),d.src=b.externalGraphic},drawNamedSymbol:function(a,b,c){var d,e,f,g,h,i,j,k,l,m=Math.PI/180,n=OpenLayers.Renderer.symbol[b.graphicName];if(!n)throw new Error(b.graphicName+" is not a valid symbol name");if(n.length&&!(n.length<2)){var o=this.getLocalXY(a),p=o[0],q=o[1];if(!isNaN(p)&&!isNaN(q)){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),b.graphicName in this.cachedSymbolBounds)i=this.cachedSymbolBounds[b.graphicName];else{for(i=new OpenLayers.Bounds,h=0;h<n.length;h+=2)i.extend(new OpenLayers.LonLat(n[h],n[h+1]));this.cachedSymbolBounds[b.graphicName]=i}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(p,q),this.hitDetection&&this.hitContext.translate(p,q),k=m*b.rotation,isNaN(k)||(this.canvas.rotate(k),this.hitDetection&&this.hitContext.rotate(k)),j=2*b.pointRadius/Math.max(i.getWidth(),i.getHeight()),this.canvas.scale(j,j),this.hitDetection&&this.hitContext.scale(j,j),f=i.getCenterLonLat().lon,g=i.getCenterLonLat().lat,this.canvas.translate(-f,-g),this.hitDetection&&this.hitContext.translate(-f,-g),l=b.strokeWidth,b.strokeWidth=l/j,b.fill!==!1){for(this.setCanvasStyle("fill",b),this.canvas.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",c,b),this.hitContext.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.canvas.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath(),this.hitContext.fill()}}if(b.stroke!==!1){for(this.setCanvasStyle("stroke",b),this.canvas.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",c,b,j),this.hitContext.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.hitContext.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath(),this.hitContext.stroke()}}b.strokeWidth=l,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}}},setCanvasStyle:function(a,b){"fill"===a?(this.canvas.globalAlpha=b.fillOpacity,this.canvas.fillStyle=b.fillColor):"stroke"===a?(this.canvas.globalAlpha=b.strokeOpacity,this.canvas.strokeStyle=b.strokeColor,this.canvas.lineWidth=b.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(a){var b=Number(a.split("_").pop())+1;b>=16777216&&(this.hitOverflow=b-16777215,b=b%16777216+1);var c="000000"+b.toString(16),d=c.length;return c="#"+c.substring(d-6,d)},setHitContextStyle:function(a,b,c,d){var e=this.featureIdToHex(b);"fill"==a?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=e):"stroke"==a?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=e,"undefined"==typeof d?this.hitContext.lineWidth=c.strokeWidth+2:isNaN(d)||(this.hitContext.lineWidth=c.strokeWidth+2/d)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(a,b,c){if(b.graphic!==!1)if(b.externalGraphic)this.drawExternalGraphic(a,b,c);else if(b.graphicName&&"circle"!=b.graphicName)this.drawNamedSymbol(a,b,c);else{var d=this.getLocalXY(a),e=d[0],f=d[1];if(!isNaN(e)&&!isNaN(f)){var g=2*Math.PI,h=b.pointRadius;b.fill!==!1&&(this.setCanvasStyle("fill",b),this.canvas.beginPath(),this.canvas.arc(e,f,h,0,g,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",c,b),this.hitContext.beginPath(),this.hitContext.arc(e,f,h,0,g,!0),this.hitContext.fill())),b.stroke!==!1&&(this.setCanvasStyle("stroke",b),this.canvas.beginPath(),this.canvas.arc(e,f,h,0,g,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",c,b),this.hitContext.beginPath(),this.hitContext.arc(e,f,h,0,g,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(a,b,c){b=OpenLayers.Util.applyDefaults({fill:!1},b),this.drawLinearRing(a,b,c)},drawLinearRing:function(a,b,c){b.fill!==!1&&(this.setCanvasStyle("fill",b),this.renderPath(this.canvas,a,b,c,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",c,b),this.renderPath(this.hitContext,a,b,c,"fill"))),b.stroke!==!1&&(this.setCanvasStyle("stroke",b),this.renderPath(this.canvas,a,b,c,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",c,b),this.renderPath(this.hitContext,a,b,c,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(a,b,c,d,e){var f=b.components,g=f.length;a.beginPath();var h=this.getLocalXY(f[0]),i=h[0],j=h[1];if(!isNaN(i)&&!isNaN(j)){a.moveTo(h[0],h[1]);for(var k=1;g>k;++k){var l=this.getLocalXY(f[k]);a.lineTo(l[0],l[1])}"fill"===e?a.fill():a.stroke()}},drawPolygon:function(a,b,c){var d=a.components,e=d.length;this.drawLinearRing(d[0],b,c);for(var f=1;e>f;++f)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(d[f],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},b),c),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(d[f],OpenLayers.Util.applyDefaults({fill:!1},b),c)},drawText:function(a,b){var c=this.getLocalXY(a);this.setCanvasStyle("reset"),this.canvas.fillStyle=b.fontColor,this.canvas.globalAlpha=b.fontOpacity||1;var d=[b.fontStyle?b.fontStyle:"normal","normal",b.fontWeight?b.fontWeight:"normal",b.fontSize?b.fontSize:"1em",b.fontFamily?b.fontFamily:"sans-serif"].join(" "),e=b.label.split("\n"),f=e.length;if(this.canvas.fillText){this.canvas.font=d,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[1]]||"middle";var g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];null==g&&(g=-.5);var h=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;c[1]+=h*g*(f-1);for(var i=0;f>i;i++)b.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=b.labelOutlineOpacity||b.fontOpacity||1,this.canvas.strokeStyle=b.labelOutlineColor,this.canvas.lineWidth=b.labelOutlineWidth,this.canvas.strokeText(e[i],c[0],c[1]+h*i+1),this.canvas.restore()),this.canvas.fillText(e[i],c[0],c[1]+h*i)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=d;var j=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[0]];null==j&&(j=-.5);var g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];null==g&&(g=-.5);var h=this.canvas.mozMeasureText("xx");c[1]+=h*(1+g*f);for(var i=0;f>i;i++){var k=c[0]+j*this.canvas.mozMeasureText(e[i]),l=c[1]+i*h;this.canvas.translate(k,l),this.canvas.mozDrawText(e[i]),this.canvas.translate(-k,-l)}}this.setCanvasStyle("reset")},getLocalXY:function(a){var b=this.getResolution(),c=this.extent,d=(a.x-this.featureDx)/b+-c.left/b,e=c.top/b-a.y/b;return[d,e]},clear:function(){var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,b,a)},getFeatureIdFromEvent:function(a){var b,c;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var d=a.xy,e=0|d.x,f=0|d.y,g=this.hitContext.getImageData(e,f,1,1).data;if(255===g[3]){var h=g[2]+256*(g[1]+256*g[0]);if(h){b="OpenLayers_Feature_Vector_"+(h-1+this.hitOverflow);try{c=this.features[b][0]}catch(i){}}}}return c},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0;b<a.length;++b)delete this.features[a[b].id];this.redraw()},redraw:function(){if(!this.locked){var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a),this.hitDetection&&this.hitContext.clearRect(0,0,b,a);var c,d,e,f=[],g=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var h in this.features)this.features.hasOwnProperty(h)&&(c=this.features[h][0],d=c.geometry,this.calculateFeatureDx(d.getBounds(),g),e=this.features[h][1],this.drawGeometry(d,e,c.id),e.label&&f.push([c,e]));for(var i,j=0,k=f.length;k>j;++j)i=f[j],this.drawText(i[0].geometry.getCentroid(),i[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(a){var b={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};b=OpenLayers.Util.extend(b,a);for(var c={},d=0;d<b.interestingTagsExclude.length;d++)c[b.interestingTagsExclude[d]]=!0;b.interestingTagsExclude=c;for(var e={},d=0;d<b.areaTags.length;d++)e[b.areaTags[d]]=!0;b.areaTags=e,this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b=this.getNodes(a),c=this.getWays(a),d=new Array(c.length),e=0;e<c.length;e++){for(var f=new Array(c[e].nodes.length),g=this.isWayArea(c[e])?1:0,h=0;h<c[e].nodes.length;h++){var i=b[c[e].nodes[h]],j=new OpenLayers.Geometry.Point(i.lon,i.lat);j.osm_id=parseInt(c[e].nodes[h]),f[h]=j,i.used=!0}var k=null;k=g?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(f)):new OpenLayers.Geometry.LineString(f),this.internalProjection&&this.externalProjection&&k.transform(this.externalProjection,this.internalProjection);var l=new OpenLayers.Feature.Vector(k,c[e].tags);l.osm_id=parseInt(c[e].id),l.fid="way."+l.osm_id,d[e]=l}for(var m in b){var i=b[m];if(!i.used||this.checkTags){var n=null;if(this.checkTags){var o=this.getTags(i.node,!0);if(i.used&&!o[1])continue;n=o[0]}else n=this.getTags(i.node);var l=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(i.lon,i.lat),n);this.internalProjection&&this.externalProjection&&l.geometry.transform(this.externalProjection,this.internalProjection),l.osm_id=parseInt(m),l.fid="node."+l.osm_id,d.push(l)}i.node=null}return d},getNodes:function(a){for(var b=a.getElementsByTagName("node"),c={},d=0;d<b.length;d++){var e=b[d],f=e.getAttribute("id");c[f]={lat:e.getAttribute("lat"),lon:e.getAttribute("lon"),node:e}}return c},getWays:function(a){for(var b=a.getElementsByTagName("way"),c=[],d=0;d<b.length;d++){var e=b[d],f={id:e.getAttribute("id")};f.tags=this.getTags(e);var g=e.getElementsByTagName("nd");f.nodes=new Array(g.length);for(var h=0;h<g.length;h++)f.nodes[h]=g[h].getAttribute("ref");c.push(f)}return c},getTags:function(a,b){for(var c=a.getElementsByTagName("tag"),d={},e=!1,f=0;f<c.length;f++){var g=c[f].getAttribute("k");d[g]=c[f].getAttribute("v"),b&&(this.interestingTagsExclude[g]||(e=!0))}return b?[d,e]:d},isWayArea:function(a){var b=!1,c=!1;if(a.nodes[0]==a.nodes[a.nodes.length-1]&&(b=!0),this.checkTags)for(var d in a.tags)if(this.areaTags[d]){c=!0;break}return b&&(this.checkTags?c:!0)},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]),this.osm_id=1,this.created_nodes={};var b=this.createElementNS(null,"osm");b.setAttribute("version","0.5"),b.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var c=a.length-1;c>=0;c--)for(var d=this.createFeatureNodes(a[c]),e=0;e<d.length;e++)b.appendChild(d[e]);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureNodes:function(a){var b=[],c=a.geometry.CLASS_NAME,d=c.substring(c.lastIndexOf(".")+1);d=d.toLowerCase();var e=this.createXML[d];return e&&(b=e.apply(this,[a])),b},createXML:{point:function(a){var b=null,c=a.geometry?a.geometry:a;this.internalProjection&&this.externalProjection&&(c=c.clone(),c.transform(this.internalProjection,this.externalProjection));var d=!1;if(a.osm_id?(b=a.osm_id,this.created_nodes[b]&&(d=!0)):(b=-this.osm_id,this.osm_id++),d)e=this.created_nodes[b];else var e=this.createElementNS(null,"node");return this.created_nodes[b]=e,e.setAttribute("id",b),e.setAttribute("lon",c.x),e.setAttribute("lat",c.y),a.attributes&&this.serializeTags(a,e),this.setState(a,e),d?[]:[e]},linestring:function(a){var b,c=[],d=a.geometry;a.osm_id?b=a.osm_id:(b=-this.osm_id,this.osm_id++);var e=this.createElementNS(null,"way");e.setAttribute("id",b);for(var f=0;f<d.components.length;f++){var g=this.createXML.point.apply(this,[d.components[f]]);if(g.length){g=g[0];var h=g.getAttribute("id");c.push(g)}else h=d.components[f].osm_id,g=this.created_nodes[h];this.setState(a,g);var i=this.createElementNS(null,"nd");i.setAttribute("ref",h),e.appendChild(i)}return this.serializeTags(a,e),c.push(e),c},polygon:function(a){var b=OpenLayers.Util.extend({area:"yes"},a.attributes),c=new OpenLayers.Feature.Vector(a.geometry.components[0],b);return c.osm_id=a.osm_id,this.createXML.linestring.apply(this,[c])}},serializeTags:function(a,b){for(var c in a.attributes){var d=this.createElementNS(null,"tag");d.setAttribute("k",c),d.setAttribute("v",a.attributes[c]),b.appendChild(d)}},setState:function(a,b){if(a.state){var c=null;switch(a.state){case OpenLayers.State.UPDATE:c="modify";case OpenLayers.State.DELETE:c="delete"}c&&b.setAttribute("action",c)}},CLASS_NAME:"OpenLayers.Format.OSM"}),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var a=0,b=this.KEY_EVENTS.length;b>a;a++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[a],this.eventListener);return!0}return!1},deactivate:function(){var a=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var b=0,c=this.KEY_EVENTS.length;c>b;b++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[b],this.eventListener);a=!0}return a},handleKeyEvent:function(a){this.checkModifiers(a)&&this.callback(a.type,[a])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(a,b){b=b||{},this.layer=a,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,b.vertexRenderIntent)),this.virtualStyle.fillOpacity=.3,this.virtualStyle.strokeOpacity=.3,this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[b]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var c={down:function(){this.vertex=null;var a=this.layer.getFeatureFromEvent(this.handlers.drag.evt);a?this.dragStart(a):this.clickout&&(this._unselect=this.feature)},move:function(a){delete this._unselect,this.vertex&&this.dragVertex(this.vertex,a)},up:function(){this.handlers.drag.stopDown=!1,this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(){this.vertex&&this.dragComplete(this.vertex)}},d={documentDrag:this.documentDrag,stopDown:!1},e={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,e),drag:new OpenLayers.Handler.Drag(this,c,d)}},destroy:function(){this.map&&this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.handlers.keyboard.activate()&&this.handlers.drag.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var a=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.moveLayerBack(),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate();var b=this.feature;b&&b.geometry&&b.layer&&this.unselectFeature(b),a=!0}return a},beforeSelectFeature:function(a){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:a})},selectFeature:function(a){if(!(this.feature===a||this.geometryTypes&&-1==OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME))){this.beforeSelectFeature(a)!==!1&&(this.feature&&this.unselectFeature(this.feature),this.feature=a,this.layer.selectedFeatures.push(a),this.layer.drawFeature(a,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var b=a.modified;!a.geometry||b&&b.geometry||(this._originalGeometry=a.geometry.clone())}},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle),this.layer.drawFeature(this.feature,"default"),this.feature=null,OpenLayers.Util.removeItem(this.layer.selectedFeatures,a),this.onModificationEnd(a),this.layer.events.triggerEvent("afterfeaturemodified",{feature:a,modified:this.modified}),this.modified=!1},dragStart:function(a){var b="OpenLayers.Geometry.Point"==a.geometry.CLASS_NAME;this.standalone||(a._sketch||!b)&&a._sketch||(this.toggle&&this.feature===a&&(this._unselect=a),this.selectFeature(a)),(a._sketch||b)&&(this.vertex=a,this.handlers.drag.stopDown=!0)},dragVertex:function(a,b){var c=this.map.getLonLatFromViewPortPx(b),d=a.geometry;d.move(c.lon-d.x,c.lat-d.y),this.modified=!0,"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b}):(a._index?(a.geometry.parent.addComponent(a.geometry,a._index),delete a._index,OpenLayers.Util.removeItem(this.virtualVertices,a),this.vertices.push(a)):a==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):a!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b}),this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:"select")),this.layer.drawFeature(a)},dragComplete:function(){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var a=this.feature;a.modified=OpenLayers.Util.extend(a.modified,{geometry:this._originalGeometry}),delete this._originalGeometry}},resetVertices:function(){this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(a){var b=a.keyCode;if(this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,b)){var c=this.layer.getFeatureFromEvent(this.handlers.drag.evt);c&&-1!=OpenLayers.Util.indexOf(this.vertices,c)&&!this.handlers.drag.dragging&&c.geometry.parent&&(c.geometry.parent.removeComponent(c.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:c.geometry,feature:this.feature,pixel:a.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))}},collectVertices:function(){function a(c){var d,e,f,g;if("OpenLayers.Geometry.Point"==c.CLASS_NAME)e=new OpenLayers.Feature.Vector(c),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e);else{var h=c.components.length;for("OpenLayers.Geometry.LinearRing"==c.CLASS_NAME&&(h-=1),d=0;h>d;++d)f=c.components[d],"OpenLayers.Geometry.Point"==f.CLASS_NAME?(e=new OpenLayers.Feature.Vector(f),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e)):a(f);if(b.createVertices&&"OpenLayers.Geometry.MultiPoint"!=c.CLASS_NAME)for(d=0,g=c.components.length;g-1>d;++d){var i=c.components[d],j=c.components[d+1];if("OpenLayers.Geometry.Point"==i.CLASS_NAME&&"OpenLayers.Geometry.Point"==j.CLASS_NAME){var k=(i.x+j.x)/2,l=(i.y+j.y)/2,m=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(k,l),null,b.virtualStyle);m.geometry.parent=c,m._index=d+1,m._sketch=!0,b.virtualVertices.push(m)}}}}this.vertices=[],this.virtualVertices=[];var b=this;a.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var a=this.feature.geometry,b=a.getBounds().getCenterLonLat(),c=new OpenLayers.Geometry.Point(b.lon,b.lat),d=new OpenLayers.Feature.Vector(c);c.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c),a.move(b,c)},d._sketch=!0,this.dragHandle=d,this.dragHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var a=this.feature.geometry,b=a.getBounds(),c=b.getCenterLonLat(),d=new OpenLayers.Geometry.Point(c.lon,c.lat),e=new OpenLayers.Geometry.Point(b.right,b.bottom),f=new OpenLayers.Feature.Vector(e),g=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,h=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,i=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;e.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c);var e=this.x-d.x,f=this.y-d.y,j=e-b,k=f-c;if(i){var l=Math.atan2(k,j),m=Math.atan2(f,e),n=m-l;n*=180/Math.PI,a.rotate(n,d)}if(g){var o,p;if(h)o=f/k,p=e/j/o;else{var q=Math.sqrt(j*j+k*k),r=Math.sqrt(e*e+f*f);o=r/q}a.resize(o,d,p)}},f._sketch=!0,this.radiusHandle=f,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(a){this.handlers.drag.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(a){("removelayer"==a.type||"order"==a.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(a){a=OpenLayers.Util.applyDefaults({sphericalMercator:!0},a);var b=a.name||"Bing "+(a.type||this.type),c=[b,null,a];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,c),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions),this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_"),window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var a=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),b=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(a),c=document.createElement("script");c.type="text/javascript",c.src=b,c.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(c)},initLayer:function(){var a=this.metadata.resourceSets[0].resources[0],b=a.imageUrl.replace("{quadkey}","${quadkey}");b=b.replace("{culture}",this.culture),b=b.replace(this.protocolRegex,this.protocol),this.url=[];for(var c=0;c<a.imageUrlSubdomains.length;++c)this.url.push(b.replace("{subdomain}",a.imageUrlSubdomains[c]));this.addOptions({maxResolution:Math.min(this.serverResolutions[a.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(a.zoomMax+1-a.zoomMin,this.numZoomLevels)},!0),this.isBaseLayer||this.redraw(),this.updateAttribution()},getURL:function(a){if(this.url){for(var b=this.getXYZ(a),c=b.x,d=b.y,e=b.z,f=[],g=e;g>0;--g){var h="0",i=1<<g-1;0!=(c&i)&&h++,0!=(d&i)&&(h++,h++),f.push(h)}var j=f.join(""),k=this.selectUrl(""+c+d+e,this.url);return OpenLayers.String.format(k,{quadkey:j})}},updateAttribution:function(){var a=this.metadata;if(a.resourceSets&&this.map&&this.map.center){var b,c,d,e,f,g,h,i=a.resourceSets[0].resources[0],j=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),k=i.imageryProviders||[],l=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),m="";for(c=0,d=k.length;d>c;++c)for(b=k[c],e=0,f=b.coverageAreas.length;f>e;++e)h=b.coverageAreas[e],g=OpenLayers.Bounds.fromArray(h.bbox,!0),j.intersectsBounds(g)&&l<=h.zoomMax&&l>=h.zoomMin&&(m+=b.attribution+" ");var n=a.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:n,copyrights:m}),this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments),this.map.events.register("moveend",this,this.updateAttribution)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Bing(this.options)),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution),OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"}),OpenLayers.Layer.Bing.processMetadata=function(a){this.metadata=a,this.initLayer();var b=document.getElementById(this._callbackId);b.parentNode.removeChild(b),window[this._callbackId]=void 0,delete this._callbackId},OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(a,b){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},a instanceof OpenLayers.Style)this.styles["default"]=a,this.styles.select=a,this.styles.temporary=a,this.styles["delete"]=a;else if("object"==typeof a)for(var c in a)if(a[c]instanceof OpenLayers.Style)this.styles[c]=a[c];else{if("object"!=typeof a[c]){this.styles["default"]=new OpenLayers.Style(a),this.styles.select=new OpenLayers.Style(a),this.styles.temporary=new OpenLayers.Style(a),this.styles["delete"]=new OpenLayers.Style(a);break}this.styles[c]=new OpenLayers.Style(a[c])}OpenLayers.Util.extend(this,b)},destroy:function(){for(var a in this.styles)this.styles[a].destroy();this.styles=null},createSymbolizer:function(a,b){a||(a=new OpenLayers.Feature.Vector),this.styles[b]||(b="default"),a.renderIntent=b;var c={};return this.extendDefault&&"default"!=b&&(c=this.styles["default"].createSymbolizer(a)),OpenLayers.Util.extend(c,this.styles[b].createSymbolizer(a))},addUniqueValueRules:function(a,b,c,d){var e=[];for(var f in c)e.push(new OpenLayers.Rule({symbolizer:c[f],context:d,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:f})}));this.styles[a].addRules(e)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var a=0,b=this.strategies.length;b>a;a++)this.strategies[a].setLayer(this)},destroy:function(){if(this.strategies){var a,b,c;for(b=0,c=this.strategies.length;c>b;b++)a=this.strategies[b],a.autoDestroy&&a.destroy();
this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.features=null,this.selectedFeatures=null,this.unrenderedFeatures=null,this.renderer&&this.renderer.destroy(),this.renderer=null,this.geometryType=null,this.drawn=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.Vector(this.name,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a]);for(var b=this.features,c=b.length,d=new Array(c),e=0;c>e;++e)d[e]=b[e].clone();return a.features=d,a},refresh:function(a){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",a)},assignRenderer:function(){for(var a=0,b=this.renderers.length;b>a;a++){var c=this.renderers[a],d="function"==typeof c?c:OpenLayers.Renderer[c];if(d&&d.prototype.supported()){this.renderer=new d(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var a=this.map.getSize();a.w=a.w*this.ratio,a.h=a.h*this.ratio,this.renderer.setSize(a)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var a,b,c;for(b=0,c=this.strategies.length;c>b;b++)a=this.strategies[b],a.autoActivate&&a.activate()}},removeMap:function(){if(this.drawn=!1,this.strategies){var a,b,c;for(b=0,c=this.strategies.length;c>b;b++)a=this.strategies[b],a.autoActivate&&a.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var a=this.map.getSize();a.w=a.w*this.ratio,a.h=a.h*this.ratio,this.renderer.setSize(a)},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=!0;if(!c){this.renderer.root.style.visibility="hidden";var e=this.map.getSize(),f=e.w,g=e.h,h=f/2*this.ratio-f/2,i=g/2*this.ratio-g/2;h+=this.map.layerContainerOriginPx.x,h=-Math.round(h),i+=this.map.layerContainerOriginPx.y,i=-Math.round(i),this.div.style.left=h+"px",this.div.style.top=i+"px";var j=this.map.getExtent().scale(this.ratio);if(d=this.renderer.setExtent(j,b),this.renderer.root.style.visibility="visible",OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft),!b&&d)for(var k in this.unrenderedFeatures){var l=this.unrenderedFeatures[k];this.drawFeature(l)}}if(!this.drawn||b||!d){this.drawn=!0;for(var l,k=0,m=this.features.length;m>k;k++)this.renderer.locked=k!==m-1,l=this.features[k],this.drawFeature(l)}},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments);var a=this.div.style.display;a!=this.renderer.root.style.display&&(this.renderer.root.style.display=a)},addFeatures:function(a,b){OpenLayers.Util.isArray(a)||(a=[a]);var c=!b||!b.silent;if(c){var d={features:a},e=this.events.triggerEvent("beforefeaturesadded",d);if(e===!1)return;a=d.features}for(var f=[],g=0,h=a.length;h>g;g++){this.renderer.locked=g!=a.length-1?!0:!1;var i=a[g];if(this.geometryType&&!(i.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(i.layer=this,!i.style&&this.style&&(i.style=OpenLayers.Util.extend({},this.style)),c){if(this.events.triggerEvent("beforefeatureadded",{feature:i})===!1)continue;this.preFeatureInsert(i)}f.push(i),this.features.push(i),this.drawFeature(i),c&&(this.events.triggerEvent("featureadded",{feature:i}),this.onFeatureInsert(i))}c&&this.events.triggerEvent("featuresadded",{features:f})},removeFeatures:function(a,b){if(a&&0!==a.length){if(a===this.features)return this.removeAllFeatures(b);OpenLayers.Util.isArray(a)||(a=[a]),a===this.selectedFeatures&&(a=a.slice());var c=!b||!b.silent;c&&this.events.triggerEvent("beforefeaturesremoved",{features:a});for(var d=a.length-1;d>=0;d--){this.renderer.locked=0!=d&&a[d-1].geometry?!0:!1;var e=a[d];delete this.unrenderedFeatures[e.id],c&&this.events.triggerEvent("beforefeatureremoved",{feature:e}),this.features=OpenLayers.Util.removeItem(this.features,e),e.layer=null,e.geometry&&this.renderer.eraseFeatures(e),-1!=OpenLayers.Util.indexOf(this.selectedFeatures,e)&&OpenLayers.Util.removeItem(this.selectedFeatures,e),c&&this.events.triggerEvent("featureremoved",{feature:e})}c&&this.events.triggerEvent("featuresremoved",{features:a})}},removeAllFeatures:function(a){var b=!a||!a.silent,c=this.features;b&&this.events.triggerEvent("beforefeaturesremoved",{features:c});for(var d,e=c.length-1;e>=0;e--)d=c[e],b&&this.events.triggerEvent("beforefeatureremoved",{feature:d}),d.layer=null,b&&this.events.triggerEvent("featureremoved",{feature:d});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],b&&this.events.triggerEvent("featuresremoved",{features:c})},destroyFeatures:function(a,b){var c=void 0==a;if(c&&(a=this.features),a){this.removeFeatures(a,b);for(var d=a.length-1;d>=0;d--)a[d].destroy()}},drawFeature:function(a,b){if(this.drawn){if("object"!=typeof b){b||a.state!==OpenLayers.State.DELETE||(b="delete");var c=b||a.renderIntent;b=a.style||this.style,b||(b=this.styleMap.createSymbolizer(a,c))}var d=this.renderer.drawFeature(a,b);d===!1||null===d?this.unrenderedFeatures[a.id]=a:delete this.unrenderedFeatures[a.id]}},eraseFeatures:function(a){this.renderer.eraseFeatures(a)},getFeatureFromEvent:function(a){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var b=null,c=this.renderer.getFeatureIdFromEvent(a);return c&&(b="string"==typeof c?this.getFeatureById(c):c),b},getFeatureBy:function(a,b){for(var c=null,d=0,e=this.features.length;e>d;++d)if(this.features[d][a]==b){c=this.features[d];break}return c},getFeatureById:function(a){return this.getFeatureBy("id",a)},getFeatureByFid:function(a){return this.getFeatureBy("fid",a)},getFeaturesByAttribute:function(a,b){var c,d,e=this.features.length,f=[];for(c=0;e>c;c++)d=this.features[c],d&&d.attributes&&d.attributes[a]===b&&f.push(d);return f},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var a=null,b=this.features;if(b&&b.length>0)for(var c=null,d=0,e=b.length;e>d;d++)c=b[d].geometry,c&&(null===a&&(a=new OpenLayers.Bounds),a.extend(c.getBounds()));return a},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(a){a=a||{},OpenLayers.Layer.Vector.prototype.initialize.apply(this,[a.name,a])},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),a.events.register("moveend",this,this.onMoveEnd)},removeMap:function(a){a.events.unregister("moveend",this,this.onMoveEnd),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(a){this.ratio=a,this.updateGrid(!0)},setMaxFeatures:function(a){this.maxFeatures=a,this.updateGrid(!0)},setSpacing:function(a,b){this.dx=a,this.dy=b||a,this.updateGrid(!0)},setOrigin:function(a){this.origin=a,this.updateGrid(!0)},getOrigin:function(){return this.origin||(this.origin=this.map.getExtent().getCenterLonLat()),this.origin},setRotation:function(a){this.rotation=a,this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var a=this.map.getExtent();if(this.rotation){var b=this.getOrigin(),c=new OpenLayers.Geometry.Point(b.lon,b.lat),d=a.toGeometry();d.rotate(-this.rotation,c),a=d.getBounds()}return a},updateGrid:function(a){if(a||this.invalidBounds()){var b=this.getViewBounds(),c=this.getOrigin(),d=new OpenLayers.Geometry.Point(c.lon,c.lat),e=b.getWidth(),f=b.getHeight(),g=e/f,h=Math.sqrt(this.dx*this.dy*this.maxFeatures/g),i=h*g,j=Math.min(e*this.ratio,i),k=Math.min(f*this.ratio,h),l=b.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(l.lon-j/2,l.lat-k/2,l.lon+j/2,l.lat+k/2);for(var m,n,o,p=Math.floor(k/this.dy),q=Math.floor(j/this.dx),r=c.lon+this.dx*Math.ceil((this.gridBounds.left-c.lon)/this.dx),s=c.lat+this.dy*Math.ceil((this.gridBounds.bottom-c.lat)/this.dy),t=new Array(p*q),u=0;q>u;++u){m=r+u*this.dx;for(var v=0;p>v;++v)n=s+v*this.dy,o=new OpenLayers.Geometry.Point(m,n),this.rotation&&o.rotate(this.rotation,d),t[u*p+v]=new OpenLayers.Feature.Vector(o)}this.destroyFeatures(this.features,{silent:!0}),this.addFeatures(t,{silent:!0})}},invalidBounds:function(){return!this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"}),OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(a){if(this.map&&this.checkModifiers(a)){for(var b=!1,c=!1,d=!1,e=OpenLayers.Event.element(a);null!=e&&!d&&!b;){if(!b)try{var f;if(e.currentStyle)f=e.currentStyle.overflow;else{var g=document.defaultView.getComputedStyle(e,null);f=g.getPropertyValue("overflow")}b=f&&"auto"==f||"scroll"==f}catch(h){}if(!c&&(c=OpenLayers.Element.hasClass(e,"olScrollable"),!c))for(var i=0,j=this.map.layers.length;j>i;i++){var k=this.map.layers[i];if(e==k.div||e==k.pane){c=!0;break}}d=e==this.map.div,e=e.parentNode}if(!b&&d){if(c){var l=0;if(a.wheelDelta?(l=a.wheelDelta,l%160===0&&(l=.75*l),l/=120):a.detail&&(l=-(a.detail/Math.abs(a.detail))),this.delta+=l,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var m=OpenLayers.Util.extend({},a);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(m)},this),this.interval)}else this.wheelZoom(a)}OpenLayers.Event.stop(a)}}},wheelZoom:function(a){var b=this.delta;this.delta=0,b&&(a.xy=this.map.events.getMousePosition(a),0>b?this.callback("down",[a,this.cumulative?Math.max(-this.maxDelta,b):-1]):this.callback("up",[a,this.cumulative?Math.min(this.maxDelta,b):1]))},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var a=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",a),OpenLayers.Event.observe(window,"mousewheel",a),OpenLayers.Event.observe(document,"mousewheel",a),!0}return!1},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var a=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",a),OpenLayers.Event.stopObserving(window,"mousewheel",a),OpenLayers.Event.stopObserving(document,"mousewheel",a),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"}),OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(a){OpenLayers.Util.extend(this,a)},clone:function(){var Type=eval(this.CLASS_NAME);return new Type(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"}),OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"}),OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={},OpenLayers.Util.extend(this,a),this.symbolizers&&delete this.symbolizer,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a in this.symbolizer)this.symbolizer[a]=null;this.symbolizer=null,delete this.symbolizers},evaluate:function(a){var b=this.getContext(a),c=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var d=a.layer.map.getScale();return this.minScaleDenominator&&(c=d>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b)),c&&this.maxScaleDenominator&&(c=d<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b)),c&&this.filter&&(c=this.filter.evaluate("OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?a:b)),c},getContext:function(a){var b=this.context;return b||(b=a.attributes||a.data),"function"==typeof this.context&&(b=this.context(a)),b},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.symbolizers){var b=this.symbolizers.length;a.symbolizers=new Array(b);for(var c=0;b>c;++c)a.symbolizers[c]=this.symbolizers[c].clone()}else{a.symbolizer={};var d,e;for(var f in this.symbolizer)d=this.symbolizer[f],e=typeof d,"object"===e?a.symbolizer[f]=OpenLayers.Util.extend({},d):"string"===e&&(a.symbolizer[f]=d)}return a.filter=this.filter&&this.filter.clone(),a.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(a)},CLASS_NAME:"OpenLayers.Rule"}),OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"}),OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"}),OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c),b.outer=c.components[0]},innerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c),b.inner.push(c.components[0])},Box:function(a,b){var c={};this.readChildNodes(a,c),b.components||(b.components=[]);var d=c.points[0],e=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,e.x,e.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"wfs:FeatureCollection":"gml:featureMember";var c=this.writeNode(b,a);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(a){var b=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[a],b),b},coordinates:function(a){for(var b,c=a.length,d=new Array(c),e=0;c>e;++e)b=a[e],d[e]=this.xy?b.x+","+b.y:b.y+","+b.x,void 0!=b.z&&(d[e]+=","+b.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==c?d[0]:d.join(" ")})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",a.components,b),b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",a.components[0],b);for(var c=1;c<a.components.length;++c)this.writeNode("innerBoundaryIs",a.components[c],b);return b},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",a,b),b},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",a,b),b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",a.components,b),b},Box:function(a){var b=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:a.left,y:a.bottom},{x:a.right,y:a.top}],b),this.srsName&&b.setAttribute("srsName",this.srsName),b}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"}),OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsNotEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escape");c.value2regex(d,e,f),b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",a,b),this.writeNode("Literal",a.regex2value(),b),b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Box",a.value,b);return a.projection&&c.setAttribute("srsName",a.projection),b}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);if(this.writeNode("PropertyName",a,c),a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Box",a.value),a.projection&&d.setAttribute("srsName",a.projection),c.appendChild(d)}return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"}),OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(a,b){b.insertIds=[],b.success=!1,this.readChildNodes(a,b)},InsertResult:function(a,b){var c={fids:[]};this.readChildNodes(a,c),b.insertIds=b.insertIds.concat(c.fids)},TransactionResult:function(a,b){this.readChildNodes(a,b)},Status:function(a,b){this.readChildNodes(a,b)},SUCCESS:function(a,b){b.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},a);var b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b?b+":":"")+a.featureType}});if(a.srsNameInQuery&&a.srsName&&c.setAttribute("srsName",a.srsName),a.featureNS&&c.setAttribute("xmlns:"+b,a.featureNS),a.propertyNames)for(var d=0,e=a.propertyNames.length;e>d;d++)this.writeNode("ogc:PropertyName",{property:a.propertyNames[d]},c);return a.filter&&(this.setFilterProperty(a.filter),this.writeNode("ogc:Filter",a.filter,c)),c}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"}),OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(a){this.exists(a)&&this.remove(a);var b=a.id;this.determineZIndex(a);for(var c,d=-1,e=this.order.length;e-d>1;){c=parseInt((d+e)/2);var f=this.compare(this,a,OpenLayers.Util.getElement(this.order[c]));f>0?d=c:e=c}return this.order.splice(e,0,b),this.indices[b]=this.getZIndex(a),this.getNextElement(e)},remove:function(a){var b=a.id,c=OpenLayers.Util.indexOf(this.order,b);if(c>=0)if(this.order.splice(c,1),delete this.indices[b],this.order.length>0){var d=this.order[this.order.length-1];this.maxZIndex=this.indices[d]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(a){return null!=this.indices[a.id]},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=a._style.graphicZIndex;null==b?(b=this.maxZIndex,a._style.graphicZIndex=b):b>this.maxZIndex&&(this.maxZIndex=b)},getNextElement:function(a){var b=a+1;if(b<this.order.length){var c=OpenLayers.Util.getElement(this.order[b]);return void 0==c&&(c=this.getNextElement(b)),c}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(a,b,c){var d=a.getZIndex(b),e=0;if(c){var f=a.getZIndex(c);e=d-f}return e},Z_ORDER_DRAWING_ORDER:function(a,b,c){var d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);return c&&0==d&&(d=1),d},Z_ORDER_Y_ORDER:function(a,b,c){var d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);if(c&&0===d){var e=c._boundsBottom-b._boundsBottom;d=0===e?1:e}return d}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),b&&(b.zIndexing||b.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var a,b=this.vectorRoot;if(b)for(;a=b.firstChild;)b.removeChild(a);if(b=this.textRoot)for(;a=b.firstChild;)b.removeChild(a);this.indexer&&this.indexer.clear()},setExtent:function(a,b){var c=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),d=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var e,f=a.getWidth()/this.map.getExtent().getWidth(),a=a.scale(1/f),g=this.map.getMaxExtent();g.right>a.left&&g.right<a.right?e=!0:g.left>a.left&&g.left<a.right&&(e=!1),(e!==this.rightOfDateLine||b)&&(c=!1,this.xOffset=e===!0?g.getWidth()/d:0),this.rightOfDateLine=e}return c},getNodeType:function(){},drawGeometry:function(a,b,c){var d=a.CLASS_NAME,e=!0;if("OpenLayers.Geometry.Collection"==d||"OpenLayers.Geometry.MultiPoint"==d||"OpenLayers.Geometry.MultiLineString"==d||"OpenLayers.Geometry.MultiPolygon"==d){for(var f=0,g=a.components.length;g>f;f++)e=this.drawGeometry(a.components[f],b,c)&&e;return e}e=!1;var h=!1;if("none"!=b.display&&(b.backgroundGraphic?this.redrawBackgroundNode(a.id,a,b,c):h=!0,e=this.redrawNode(a.id,a,b,c)),0==e){var i=document.getElementById(a.id);i&&(i._style.backgroundGraphic&&(h=!0),i.parentNode.removeChild(i))}if(h){var i=document.getElementById(a.id+this.BACKGROUND_ID_SUFFIX);i&&i.parentNode.removeChild(i)}return e},redrawNode:function(a,b,c,d){c=this.applyDefaultSymbolizer(c);var e=this.nodeFactory(a,this.getNodeType(b,c));e._featureId=d,e._boundsBottom=b.getBounds().bottom,e._geometryClass=b.CLASS_NAME,e._style=c;var f=this.drawGeometryNode(e,b,c);if(f===!1)return!1;if(e=f.node,this.indexer){var g=this.indexer.insert(e);g?this.vectorRoot.insertBefore(e,g):this.vectorRoot.appendChild(e)}else e.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(e);return this.postDraw(e),f.complete},redrawBackgroundNode:function(a,b,c){var d=OpenLayers.Util.extend({},c);return d.externalGraphic=d.backgroundGraphic,d.graphicXOffset=d.backgroundXOffset,d.graphicYOffset=d.backgroundYOffset,d.graphicZIndex=d.backgroundGraphicZIndex,d.graphicWidth=d.backgroundWidth||d.graphicWidth,d.graphicHeight=d.backgroundHeight||d.graphicHeight,d.backgroundGraphic=null,d.backgroundXOffset=null,d.backgroundYOffset=null,d.backgroundGraphicZIndex=null,this.redrawNode(a+this.BACKGROUND_ID_SUFFIX,b,d,null)},drawGeometryNode:function(a,b,c){c=c||a._style;var d,e={isFilled:void 0===c.fill?!0:c.fill,isStroked:void 0===c.stroke?!!c.strokeWidth:c.stroke};switch(b.CLASS_NAME){case"OpenLayers.Geometry.Point":c.graphic===!1&&(e.isFilled=!1,e.isStroked=!1),d=this.drawPoint(a,b);break;case"OpenLayers.Geometry.LineString":e.isFilled=!1,d=this.drawLineString(a,b);break;case"OpenLayers.Geometry.LinearRing":d=this.drawLinearRing(a,b);break;case"OpenLayers.Geometry.Polygon":d=this.drawPolygon(a,b);break;case"OpenLayers.Geometry.Rectangle":d=this.drawRectangle(a,b)}return a._options=e,0!=d?{node:this.setStyle(a,c,e,b),complete:d}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},removeText:function(a){var b=document.getElementById(a+this.LABEL_ID_SUFFIX);b&&this.textRoot.removeChild(b);var c=document.getElementById(a+this.LABEL_OUTLINE_SUFFIX);c&&this.textRoot.removeChild(c)},getFeatureIdFromEvent:function(a){var b=a.target,c=b&&b.correspondingUseElement,d=c?c:b||a.srcElement;return d._featureId},eraseGeometry:function(a,b){if("OpenLayers.Geometry.MultiPoint"==a.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==a.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==a.CLASS_NAME||"OpenLayers.Geometry.Collection"==a.CLASS_NAME)for(var c=0,d=a.components.length;d>c;c++)this.eraseGeometry(a.components[c],b);else{var e=OpenLayers.Util.getElement(a.id);if(e&&e.parentNode&&(e.geometry&&(e.geometry.destroy(),e.geometry=null),e.parentNode.removeChild(e),this.indexer&&this.indexer.remove(e),e._style.backgroundGraphic)){var f=a.id+this.BACKGROUND_ID_SUFFIX,g=OpenLayers.Util.getElement(f);g&&g.parentNode&&g.parentNode.removeChild(g)}}},nodeFactory:function(a,b){var c=OpenLayers.Util.getElement(a);return c?this.nodeTypeCompare(c,b)||(c.parentNode.removeChild(c),c=this.nodeFactory(a,b)):c=this.createNode(b,a),c},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(a){var b=this.root;a.root.parentNode==this.rendererRoot&&(b=a.root),b.parentNode.removeChild(b),a.rendererRoot.appendChild(b)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(a){return"circle"!=a&&!!a},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(a){a=a||window.location.href;var b=OpenLayers.Util.getParameters(a),c=a.indexOf("#");return c>0&&(a="?"+a.substring(c+1,a.length),OpenLayers.Util.extend(b,OpenLayers.Util.getParameters(a))),b},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var a=0,b=this.map.controls.length;b>a;a++){var c=this.map.controls[a];if(c!=this&&"OpenLayers.Control.ArgParser"==c.CLASS_NAME){c.displayProjection!=this.displayProjection&&(this.displayProjection=c.displayProjection);break}}if(a==this.map.controls.length){var d=this.getParameters();d.layers&&(this.layers=d.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),d.lat&&d.lon&&(this.center=new OpenLayers.LonLat(parseFloat(d.lon),parseFloat(d.lat)),d.zoom&&(this.zoom=parseFloat(d.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter())}},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var a=0,b=this.layers.length;b>a;a++){var c=this.map.layers[a],d=this.layers.charAt(a);"B"==d?this.map.setBaseLayer(c):("T"==d||"F"==d)&&c.setVisibility("T"==d)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"}),OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(a,b,c){null===a||"object"!=typeof a||OpenLayers.Util.isElement(a)?(OpenLayers.Control.prototype.initialize.apply(this,[c]),this.element=OpenLayers.Util.getElement(a),this.base=b||document.location.href):(c=a,this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[c]),null!=this.element&&(this.element=OpenLayers.Util.getElement(this.element)))},destroy:function(){this.element&&this.element.parentNode==this.div&&(this.div.removeChild(this.element),this.element=null),this.map&&this.map.events.unregister("moveend",this,this.updateLink),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var a=0,b=this.map.controls.length;b>a;a++){var c=this.map.controls[a];if(c.CLASS_NAME==this.argParserClass.CLASS_NAME){c.displayProjection!=this.displayProjection&&(this.displayProjection=c.displayProjection);break}}a==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||this.anchor||(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element)),this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this}),this.updateLink(),this.div},updateLink:function(){var a=this.anchor?"#":"?",b=this.base,c=null;-1!=b.indexOf("#")&&0==this.anchor&&(c=b.substring(b.indexOf("#"),b.length)),-1!=b.indexOf(a)&&(b=b.substring(0,b.indexOf(a)));var d=b.split("#");b=d[0]+a+OpenLayers.Util.getParameterString(this.createParams()),c&&(b+=c),this.anchor&&!this.element?window.location.href=b:this.element.href=b},createParams:function(a,b,c){a=a||this.map.getCenter();var d=OpenLayers.Util.getParameters(this.base);if(a){d.zoom=b||this.map.getZoom();var e=a.lat,f=a.lon;if(this.displayProjection){var g=OpenLayers.Projection.transform({x:f,y:e},this.map.getProjectionObject(),this.displayProjection);f=g.x,e=g.y}d.lat=Math.round(1e5*e)/1e5,d.lon=Math.round(1e5*f)/1e5,c=c||this.map.layers,d.layers="";for(var h=0,i=c.length;i>h;h++){var j=c[h];d.layers+=j.isBaseLayer?j==this.map.baseLayer?"B":"0":j.getVisibility()?"T":"F"}}return d},CLASS_NAME:"OpenLayers.Control.Permalink"}),OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(a,b,c){var d=[];
d.push(a,b,{},c),OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),d=Math.round((a.bottom-this.tileOrigin.lat)/(b*this.tileSize.h)),e=this.getServerZoom(),f=this.serviceVersion+"/"+this.layername+"/"+e+"/"+c+"/"+d+"."+this.type,g=this.url;return OpenLayers.Util.isArray(g)&&(g=this.selectUrl(f,g)),g+f},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"}),OpenLayers.Format.WCSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WCSCapabilities"}),OpenLayers.Format.WCSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,splitSpace:/\s+/},defaultPrefix:"wcs",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1"}),OpenLayers.Format.WCSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"service",readers:{wcs:{WCS_Capabilities:function(a,b){this.readChildNodes(a,b)},Service:function(a,b){b.service={},this.readChildNodes(a,b.service)},name:function(a,b){b.name=this.getChildValue(a)},label:function(a,b){b.label=this.getChildValue(a)},keywords:function(a,b){b.keywords=[],this.readChildNodes(a,b.keywords)},keyword:function(a,b){b.push(this.getChildValue(a))},responsibleParty:function(a,b){b.responsibleParty={},this.readChildNodes(a,b.responsibleParty)},individualName:function(a,b){b.individualName=this.getChildValue(a)},organisationName:function(a,b){b.organisationName=this.getChildValue(a)},positionName:function(a,b){b.positionName=this.getChildValue(a)},contactInfo:function(a,b){b.contactInfo={},this.readChildNodes(a,b.contactInfo)},phone:function(a,b){b.phone={},this.readChildNodes(a,b.phone)},voice:function(a,b){b.voice=this.getChildValue(a)},facsimile:function(a,b){b.facsimile=this.getChildValue(a)},address:function(a,b){b.address={},this.readChildNodes(a,b.address)},deliveryPoint:function(a,b){b.deliveryPoint=this.getChildValue(a)},city:function(a,b){b.city=this.getChildValue(a)},postalCode:function(a,b){b.postalCode=this.getChildValue(a)},country:function(a,b){b.country=this.getChildValue(a)},electronicMailAddress:function(a,b){b.electronicMailAddress=this.getChildValue(a)},fees:function(a,b){b.fees=this.getChildValue(a)},accessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ContentMetadata:function(a,b){b.contentMetadata=[],this.readChildNodes(a,b.contentMetadata)},CoverageOfferingBrief:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)},name:function(a,b){b.name=this.getChildValue(a)},label:function(a,b){b.label=this.getChildValue(a)},lonLatEnvelope:function(a,b){var c=this.getElementsByTagNameNS(a,"http://www.opengis.net/gml","pos");if(2==c.length){var d={},e={};OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[c[0],d]),OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[c[1],e]),b.lonLatEnvelope={},b.lonLatEnvelope.srsName=a.getAttribute("srsName"),b.lonLatEnvelope.min=d.points[0],b.lonLatEnvelope.max=e.points[0]}}}},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_0_0"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return a&&(this.layer.events.on({refresh:this.load,scope:this}),1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this})),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),a},load:function(a){var b=this.layer;b.events.triggerEvent("loadstart",{filter:b.filter}),b.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:b.filter,scope:this},a)),b.events.un({visibilitychanged:this.load,scope:this})},merge:function(a){var b=this.layer;b.destroyFeatures();var c=a.features;if(c&&c.length>0){var d=b.projection,e=b.map.getProjectionObject();if(!e.equals(d))for(var f,g=0,h=c.length;h>g;++g)f=c[g].geometry,f&&f.transform(d,e);b.addFeatures(c)}b.events.triggerEvent("loadend",{response:a})},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"",zoomOutId:"olZoomOutLink",draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this),b=this.getOrCreateLinks(a),c=b.zoomIn,d=b.zoomOut,e=this.map.events;return d.parentNode!==a&&(e=this.events,e.attachToElement(d.parentNode)),e.register("buttonclick",this,this.onZoomClick),this.zoomInLink=c,this.zoomOutLink=d,a},getOrCreateLinks:function(a){var b=document.getElementById(this.zoomInId),c=document.getElementById(this.zoomOutId);return b||(b=document.createElement("a"),b.href="#zoomIn",b.appendChild(document.createTextNode(this.zoomInText)),b.className="olControlZoomIn",a.appendChild(b)),OpenLayers.Element.addClass(b,"olButton"),c||(c=document.createElement("a"),c.href="#zoomOut",c.appendChild(document.createTextNode(this.zoomOutText)),c.className="olControlZoomOut",a.appendChild(c)),OpenLayers.Element.addClass(c,"olButton"),{zoomIn:b,zoomOut:c}},onZoomClick:function(a){var b=a.buttonElement;b===this.zoomInLink?this.map.zoomIn():b===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick),delete this.zoomInLink,delete this.zoomOutLink,OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"}),OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(a,b){if(a.length<2)throw new Error("At least two point features have to be added to create a line from");for(var c,d,e,f=new Array(a.length-1),g=0,h=a.length;h>g;g++){if(c=a[g],e=c.geometry){if("OpenLayers.Geometry.Point"!=e.CLASS_NAME)throw new TypeError("Only features with point geometries are supported.")}else{var i=c.lonlat;e=new OpenLayers.Geometry.Point(i.lon,i.lat)}if(g>0){var j=null!=this.dataFrom?a[g+this.dataFrom].data||a[g+this.dataFrom].attributes:null,k=null!=this.styleFrom?a[g+this.styleFrom].style:null,l=new OpenLayers.Geometry.LineString([d,e]);f[g-1]=new OpenLayers.Feature.Vector(l,j,k)}d=e}this.addFeatures(f,b)},CLASS_NAME:"OpenLayers.Layer.PointTrack"}),OpenLayers.Layer.PointTrack.SOURCE_NODE=-1,OpenLayers.Layer.PointTrack.TARGET_NODE=0,OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0},OpenLayers.Protocol.WFS=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.WFS.DEFAULTS);var b=OpenLayers.Protocol.WFS["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFS version: "+a.version;return new b(a)},OpenLayers.Protocol.WFS.fromWMSLayer=function(a,b){var c,d,e=a.params.LAYERS,f=(OpenLayers.Util.isArray(e)?e[0]:e).split(":");f.length>1&&(d=f[0]),c=f.pop();var g={url:a.url,featureType:c,featurePrefix:d,srsName:a.projection&&a.projection.getCode()||a.map&&a.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(b,g))},OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"},OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(){OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.markers=[]},destroy:function(){this.clearMarkers(),this.markers=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=0,c=this.markers.length;c>b;b++)this.markers[b].setOpacity(this.opacity)}},moveTo:function(a,b){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),b||!this.drawn){for(var c=0,d=this.markers.length;d>c;c++)this.drawMarker(this.markers[c]);this.drawn=!0}},addMarker:function(a){this.markers.push(a),this.opacity<1&&a.setOpacity(this.opacity),this.map&&this.map.getExtent()&&(a.map=this.map,this.drawMarker(a))},removeMarker:function(a){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,a),a.erase())},clearMarkers:function(){if(null!=this.markers)for(;this.markers.length>0;)this.removeMarker(this.markers[0])},drawMarker:function(a){var b=this.map.getLayerPxFromLonLat(a.lonlat);if(null==b)a.display(!1);else if(a.isDrawn())a.icon&&a.icon.moveTo(b);else{var c=a.draw(b);this.div.appendChild(c)}},getDataExtent:function(){var a=null;if(this.markers&&this.markers.length>0)for(var a=new OpenLayers.Bounds,b=0,c=this.markers.length;c>b;b++){var d=this.markers[b];a.extend(d.lonlat)}return a},CLASS_NAME:"OpenLayers.Layer.Markers"}),OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(a,b){this.direction=a,this.CLASS_NAME+=this.direction,OpenLayers.Control.prototype.initialize.apply(this,[b])},trigger:function(){if(this.map){var a=OpenLayers.Function.bind(function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-a("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,a("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-a("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(a("w"),0)}}},CLASS_NAME:"OpenLayers.Control.Pan"}),OpenLayers.Control.Pan.NORTH="North",OpenLayers.Control.Pan.SOUTH="South",OpenLayers.Control.Pan.EAST="East",OpenLayers.Control.Pan.WEST="West",OpenLayers.Format.CSWGetDomain=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetDomain.DEFAULTS);var b=OpenLayers.Format.CSWGetDomain["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSWGetDomain version: "+a.version;return new b(a)},OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"},OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{csw:{GetDomainResponse:function(a,b){this.readChildNodes(a,b)},DomainValues:function(a,b){OpenLayers.Util.isArray(b.DomainValues)||(b.DomainValues=[]);for(var c=a.attributes,d={},e=0,f=c.length;f>e;++e)d[c[e].name]=c[e].nodeValue;this.readChildNodes(a,d),b.DomainValues.push(d)},PropertyName:function(a,b){b.PropertyName=this.getChildValue(a)},ParameterName:function(a,b){b.ParameterName=this.getChildValue(a)},ListOfValues:function(a,b){OpenLayers.Util.isArray(b.ListOfValues)||(b.ListOfValues=[]),this.readChildNodes(a,b.ListOfValues)},Value:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;f>e;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a),b.push({Value:d})},ConceptualScheme:function(a,b){b.ConceptualScheme={},this.readChildNodes(a,b.ConceptualScheme)},Name:function(a,b){b.Name=this.getChildValue(a)},Document:function(a,b){b.Document=this.getChildValue(a)},Authority:function(a,b){b.Authority=this.getChildValue(a)},RangeOfValues:function(a,b){b.RangeOfValues={},this.readChildNodes(a,b.RangeOfValues)},MinValue:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;f>e;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a),b.MinValue=d},MaxValue:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;f>e;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a),b.MaxValue=d}}},write:function(a){var b=this.writeNode("csw:GetDomain",a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetDomain:function(a){var b=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});return a.PropertyName||this.PropertyName?this.writeNode("csw:PropertyName",a.PropertyName||this.PropertyName,b):(a.ParameterName||this.ParameterName)&&this.writeNode("csw:ParameterName",a.ParameterName||this.ParameterName,b),this.readChildNodes(b,a),b},PropertyName:function(a){var b=this.createElementNSPlus("csw:PropertyName",{value:a});return b},ParameterName:function(a){var b=this.createElementNSPlus("csw:ParameterName",{value:a});return b}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"}),OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(a){var b=new OpenLayers.Format.ArcXML,c=b.read(a);return c.features.feature}}),OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.options=a||{},this.options.layer&&this.setLayer(this.options.layer);var b=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(b,this.DEFAULTS),this.setTargets(this.options.targets),0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer),this.geoToleranceCache={}},setLayer:function(a){this.active?(this.deactivate(),this.layer=a,this.activate()):this.layer=a},setTargets:function(a){if(this.targets=[],a&&a.length)for(var b,c=0,d=a.length;d>c;++c)b=a[c],b instanceof OpenLayers.Layer.Vector?this.addTargetLayer(b):this.addTarget(b)},addTargetLayer:function(a){this.addTarget({layer:a})},addTarget:function(a){a=OpenLayers.Util.applyDefaults(a,this.defaults),a.nodeTolerance=a.nodeTolerance||a.tolerance,a.vertexTolerance=a.vertexTolerance||a.tolerance,a.edgeTolerance=a.edgeTolerance||a.tolerance,this.targets.push(a)},removeTargetLayer:function(a){for(var b,c=this.targets.length-1;c>=0;--c)b=this.targets[c],b.layer===a&&this.removeTarget(b)},removeTarget:function(a){return OpenLayers.Util.removeItem(this.targets,a)},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);return a&&this.layer&&this.layer.events&&this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);return a&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),this.feature=null,this.point=null,a},onSketchModified:function(a){this.feature=a.feature,this.considerSnapping(a.vertex,a.vertex)},onVertexModified:function(a){this.feature=a.feature;var b=this.layer.map.getLonLatFromViewPortPx(a.pixel);this.considerSnapping(a.vertex,new OpenLayers.Geometry.Point(b.lon,b.lat))},considerSnapping:function(a,b){for(var c,d,e={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},f=!1,g=0,h=this.targets.length;h>g;++g)if(d=this.targets[g],c=this.testTarget(d,b)){if(this.greedy){e=c,e.target=d,f=!0;break}(c.rank<e.rank||c.rank===e.rank&&c.dist<e.dist)&&(e=c,e.target=d,f=!0)}if(f){var i=this.events.triggerEvent("beforesnap",{point:a,x:e.x,y:e.y,distance:e.dist,layer:e.target.layer,snapType:this.precedence[e.rank]});i!==!1?(a.x=e.x,a.y=e.y,this.point=a,this.events.triggerEvent("snap",{point:a,snapType:this.precedence[e.rank],layer:e.target.layer,distance:e.dist})):f=!1}this.point&&!f&&(a.x=b.x,a.y=b.y,this.point=null,this.events.triggerEvent("unsnap",{point:a}))},testTarget:function(a,b){var c=this.layer.map.getResolution();if("minResolution"in a&&c<a.minResolution)return null;if("maxResolution"in a&&c>=a.maxResolution)return null;for(var d,e,f,g,h,i,j,k={node:this.getGeoTolerance(a.nodeTolerance,c),vertex:this.getGeoTolerance(a.vertexTolerance,c),edge:this.getGeoTolerance(a.edgeTolerance,c)},l=Math.max(k.node,k.vertex,k.edge),m={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},n=!1,o=a.layer.features,p=this.precedence.length,q=new OpenLayers.LonLat(b.x,b.y),r=0,s=o.length;s>r;++r)if(d=o[r],d!==this.feature&&!d._sketch&&d.state!==OpenLayers.State.DELETE&&(!a.filter||a.filter.evaluate(d))&&d.atPoint(q,l,l))for(var t=0,u=Math.min(m.rank+1,p);u>t;++t)if(e=this.precedence[t],a[e])if("edge"===e){if(h=d.geometry.distanceTo(b,{details:!0}),i=h.distance,i<=k[e]&&i<m.dist){m={rank:t,dist:i,x:h.x0,y:h.y0},n=!0;break}}else{f=d.geometry.getVertices("node"===e),j=!1;for(var v=0,w=f.length;w>v;++v)g=f[v],i=g.distanceTo(b),i<=k[e]&&(t<m.rank||t===m.rank&&i<m.dist)&&(m={rank:t,dist:i,x:g.x,y:g.y},n=!0,j=!0);if(j)break}return n?m:null},getGeoTolerance:function(a,b){b!==this.resolution&&(this.resolution=b,this.geoToleranceCache={});var c=this.geoToleranceCache[a];return void 0===c&&(c=a*b,this.geoToleranceCache[a]=c),c},destroy:function(){this.active&&this.deactivate(),delete this.layer,delete this.targets,OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"}),OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(a,b.exceptionReport)},AllowedValues:function(a,b){b.allowedValues={},this.readChildNodes(a,b.allowedValues)},AnyValue:function(a,b){b.anyValue=!0},DataType:function(a,b){b.dataType=this.getChildValue(a)},Range:function(a,b){b.range={},this.readChildNodes(a,b.range)},MinimumValue:function(a,b){b.minValue=this.getChildValue(a)},MaximumValue:function(a,b){b.maxValue=this.getChildValue(a)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},SupportedCRS:function(a,b){b.supportedCRS=this.getChildValue(a)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(a){var b=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":a.closure}});return this.writeNode("ows:MinimumValue",a.minValue,b),this.writeNode("ows:MaximumValue",a.maxValue,b),b},MinimumValue:function(a){var b=this.createElementNSPlus("ows:MinimumValue",{value:a});return b},MaximumValue:function(a){var b=this.createElementNSPlus("ows:MaximumValue",{value:a});return b},Value:function(a){var b=this.createElementNSPlus("ows:Value",{value:a});return b}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"}),OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(a){var b=this.writeNode("wcs:GetCoverage",a);return this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{wcs:{GetCoverage:function(a){var b=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:a.version||this.VERSION,service:"WCS"}});return this.writeNode("ows:Identifier",a.identifier,b),this.writeNode("wcs:DomainSubset",a.domainSubset,b),this.writeNode("wcs:Output",a.output,b),b},DomainSubset:function(a){var b=this.createElementNSPlus("wcs:DomainSubset",{});return this.writeNode("ows:BoundingBox",a.boundingBox,b),a.temporalSubset&&this.writeNode("wcs:TemporalSubset",a.temporalSubset,b),b},TemporalSubset:function(a){for(var b=this.createElementNSPlus("wcs:TemporalSubset",{}),c=0,d=a.timePeriods.length;d>c;++c)this.writeNode("wcs:TimePeriod",a.timePeriods[c],b);return b},TimePeriod:function(a){var b=this.createElementNSPlus("wcs:TimePeriod",{});return this.writeNode("wcs:BeginPosition",a.begin,b),this.writeNode("wcs:EndPosition",a.end,b),a.resolution&&this.writeNode("wcs:TimeResolution",a.resolution,b),b},BeginPosition:function(a){var b=this.createElementNSPlus("wcs:BeginPosition",{value:a});return b},EndPosition:function(a){var b=this.createElementNSPlus("wcs:EndPosition",{value:a});return b},TimeResolution:function(a){var b=this.createElementNSPlus("wcs:TimeResolution",{value:a});return b},Output:function(a){var b=this.createElementNSPlus("wcs:Output",{attributes:{format:a.format,store:a.store}});return a.gridCRS&&this.writeNode("wcs:GridCRS",a.gridCRS,b),b},GridCRS:function(a){var b=this.createElementNSPlus("wcs:GridCRS",{});return this.writeNode("wcs:GridBaseCRS",a.baseCRS,b),a.type&&this.writeNode("wcs:GridType",a.type,b),a.origin&&this.writeNode("wcs:GridOrigin",a.origin,b),this.writeNode("wcs:GridOffsets",a.offsets,b),a.CS&&this.writeNode("wcs:GridCS",a.CS,b),b},GridBaseCRS:function(a){return this.createElementNSPlus("wcs:GridBaseCRS",{value:a})},GridOrigin:function(a){return this.createElementNSPlus("wcs:GridOrigin",{value:a})},GridType:function(a){return this.createElementNSPlus("wcs:GridType",{value:a})},GridOffsets:function(a){return this.createElementNSPlus("wcs:GridOffsets",{value:a})},GridCS:function(a){return this.createElementNSPlus("wcs:GridCS",{value:a})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"}),OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(a){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g},this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){this.features=[],this.styles={},this.fetched={};var b={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(a,b)},parseData:function(a,b){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var c=["Link","NetworkLink","Style","StyleMap","Placemark"],d=0,e=c.length;e>d;++d){var f=c[d],g=this.getElementsByTagNameNS(a,"*",f);if(0!=g.length)switch(f.toLowerCase()){case"link":case"networklink":this.parseLinks(g,b);break;case"style":this.extractStyles&&this.parseStyles(g,b);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(g,b);break;case"placemark":this.parseFeatures(g,b)}}return this.features},parseLinks:function(a,b){if(b.depth>=this.maxDepth)return!1;var c=OpenLayers.Util.extend({},b);c.depth++;for(var d=0,e=a.length;e>d;d++){var f=this.parseProperty(a[d],"*","href");if(f&&!this.fetched[f]){this.fetched[f]=!0;var g=this.fetchLink(f);g&&this.parseData(g,c)}}},fetchLink:function(a){var b=OpenLayers.Request.GET({url:a,async:!1});return b?b.responseText:void 0},parseStyles:function(a,b){for(var c=0,d=a.length;d>c;c++){var e=this.parseStyle(a[c]);if(e){var f=(b.styleBaseUrl||"")+"#"+e.id;this.styles[f]=e}}},parseKmlColor:function(a){var b=null;if(a){var c=a.match(this.regExes.kmlColor);c&&(b={color:"#"+c[4]+c[3]+c[2],opacity:parseInt(c[1],16)/255})}return b},parseStyle:function(a){for(var b,c,d={},e=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],f=0,g=e.length;g>f;++f)if(b=e[f],c=this.getElementsByTagNameNS(a,"*",b)[0])switch(b.toLowerCase()){case"linestyle":var h=this.parseProperty(c,"*","color"),i=this.parseKmlColor(h);i&&(d.strokeColor=i.color,d.strokeOpacity=i.opacity);var j=this.parseProperty(c,"*","width");j&&(d.strokeWidth=j);break;case"polystyle":var h=this.parseProperty(c,"*","color"),i=this.parseKmlColor(h);i&&(d.fillOpacity=i.opacity,d.fillColor=i.color);var k=this.parseProperty(c,"*","fill");"0"==k&&(d.fillColor="none");var l=this.parseProperty(c,"*","outline");"0"==l&&(d.strokeWidth="0");break;case"iconstyle":var m=parseFloat(this.parseProperty(c,"*","scale")||1),j=32*m,n=32*m,o=this.getElementsByTagNameNS(c,"*","Icon")[0];if(o){var p=this.parseProperty(o,"*","href");if(p){var q=this.parseProperty(o,"*","w"),r=this.parseProperty(o,"*","h"),s="http://maps.google.com/mapfiles/kml";!OpenLayers.String.startsWith(p,s)||q||r||(q=64,r=64,m/=2),q=q||r,r=r||q,q&&(j=parseInt(q)*m),r&&(n=parseInt(r)*m);var t=p.match(this.regExes.kmlIconPalette);if(t){var u=t[1],v=t[2],w=this.parseProperty(o,"*","x"),x=this.parseProperty(o,"*","y"),y=w?w/32:0,z=x?7-x/32:7,A=8*z+y;p="http://maps.google.com/mapfiles/kml/pal"+u+"/icon"+A+v}d.graphicOpacity=1,d.externalGraphic=p}}var B=this.getElementsByTagNameNS(c,"*","hotSpot")[0];if(B){var w=parseFloat(B.getAttribute("x")),x=parseFloat(B.getAttribute("y")),C=B.getAttribute("xunits");"pixels"==C?d.graphicXOffset=-w*m:"insetPixels"==C?d.graphicXOffset=-j+w*m:"fraction"==C&&(d.graphicXOffset=-j*w);var D=B.getAttribute("yunits");"pixels"==D?d.graphicYOffset=-n+x*m+1:"insetPixels"==D?d.graphicYOffset=-(x*m)+1:"fraction"==D&&(d.graphicYOffset=-n*(1-x)+1)}d.graphicWidth=j,d.graphicHeight=n;break;case"balloonstyle":var E=OpenLayers.Util.getXmlNodeValue(c);E&&(d.balloonStyle=E.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":var h=this.parseProperty(c,"*","color"),i=this.parseKmlColor(h);i&&(d.fontColor=i.color,d.fontOpacity=i.opacity)}!d.strokeColor&&d.fillColor&&(d.strokeColor=d.fillColor);var F=a.getAttribute("id");return F&&d&&(d.id=F),d},parseStyleMaps:function(a,b){for(var c=0,d=a.length;d>c;c++)for(var e=a[c],f=this.getElementsByTagNameNS(e,"*","Pair"),g=e.getAttribute("id"),h=0,i=f.length;i>h;h++){var j=f[h],k=this.parseProperty(j,"*","key"),l=this.parseProperty(j,"*","styleUrl");l&&"normal"==k&&(this.styles[(b.styleBaseUrl||"")+"#"+g]=this.styles[(b.styleBaseUrl||"")+l])}},parseFeatures:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++){var f=a[d],g=this.parseFeature.apply(this,[f]);if(!g)throw"Bad Placemark: "+d;if(this.extractStyles&&g.attributes&&g.attributes.styleUrl&&(g.style=this.getStyle(g.attributes.styleUrl,b)),this.extractStyles){var h=this.getElementsByTagNameNS(f,"*","Style")[0];if(h){var i=this.parseStyle(h);i&&(g.style=OpenLayers.Util.extend(g.style,i))}}if(this.extractTracks){var j=this.getElementsByTagNameNS(f,this.namespaces.gx,"Track");if(j&&j.length>0){var k=j[0],l={features:[],feature:g};this.readNode(k,l),l.features.length>0&&c.push.apply(c,l.features)}}else c.push(g)}this.features=this.features.concat(c)},readers:{kml:{when:function(a,b){b.whens.push(OpenLayers.Date.parse(this.getChildValue(a)))},_trackPointAttribute:function(a,b){var c=a.nodeName.split(":").pop();b.attributes[c].push(this.getChildValue(a))}},gx:{Track:function(a,b){var c={whens:[],points:[],angles:[]};if(this.trackAttributes){var d;c.attributes={};for(var e=0,f=this.trackAttributes.length;f>e;++e)d=this.trackAttributes[e],c.attributes[d]=[],d in this.readers.kml||(this.readers.kml[d]=this.readers.kml._trackPointAttribute)}if(this.readChildNodes(a,c),c.whens.length!==c.points.length)throw new Error("gx:Track with unequal number of when ("+c.whens.length+") and gx:coord ("+c.points.length+") elements.");var g=c.angles.length>0;if(g&&c.whens.length!==c.angles.length)throw new Error("gx:Track with unequal number of when ("+c.whens.length+") and gx:angles ("+c.angles.length+") elements.");for(var h,i,j,e=0,f=c.whens.length;f>e;++e){if(h=b.feature.clone(),h.fid=b.feature.fid||b.feature.id,i=c.points[e],h.geometry=i,"z"in i&&(h.attributes.altitude=i.z),this.internalProjection&&this.externalProjection&&h.geometry.transform(this.externalProjection,this.internalProjection),this.trackAttributes)for(var k=0,l=this.trackAttributes.length;l>k;++k){var d=this.trackAttributes[k];h.attributes[d]=c.attributes[d][e]}h.attributes.when=c.whens[e],h.attributes.trackId=b.feature.id,g&&(j=c.angles[e],h.attributes.heading=parseFloat(j[0]),h.attributes.tilt=parseFloat(j[1]),h.attributes.roll=parseFloat(j[2])),b.features.push(h)}},coord:function(a,b){var c=this.getChildValue(a),d=c.replace(this.regExes.trimSpace,"").split(/\s+/),e=new OpenLayers.Geometry.Point(d[0],d[1]);d.length>2&&(e.z=parseFloat(d[2])),b.points.push(e)},angles:function(a,b){var c=this.getChildValue(a),d=c.replace(this.regExes.trimSpace,"").split(/\s+/);b.angles.push(d)}}},parseFeature:function(a){for(var b,c,d,e,f=["MultiGeometry","Polygon","LineString","Point"],g=0,h=f.length;h>g;++g)if(b=f[g],this.internalns=a.namespaceURI?a.namespaceURI:this.kmlns,c=this.getElementsByTagNameNS(a,this.internalns,b),c.length>0){var e=this.parseGeometry[b.toLowerCase()];if(!e)throw new TypeError("Unsupported geometry type: "+b);d=e.apply(this,[c[0]]),this.internalProjection&&this.externalProjection&&d.transform(this.externalProjection,this.internalProjection);break}var i;this.extractAttributes&&(i=this.parseAttributes(a));var j=new OpenLayers.Feature.Vector(d,i),k=a.getAttribute("id")||a.getAttribute("name");return null!=k&&(j.fid=k),j},getStyle:function(a,b){var c=OpenLayers.Util.removeTail(a),d=OpenLayers.Util.extend({},b);if(d.depth++,d.styleBaseUrl=c,!this.styles[a]&&!OpenLayers.String.startsWith(a,"#")&&d.depth<=this.maxDepth&&!this.fetched[c]){var e=this.fetchLink(c);e&&this.parseData(e,d)}var f=OpenLayers.Util.extend({},this.styles[a]);return f},parseGeometry:{point:function(a){var b=this.getElementsByTagNameNS(a,this.internalns,"coordinates"),c=[];if(b.length>0){var d=b[0].firstChild.nodeValue;d=d.replace(this.regExes.removeSpace,""),c=d.split(",")}var e=null;if(!(c.length>1))throw"Bad coordinate string: "+d;return 2==c.length&&(c[2]=null),e=new OpenLayers.Geometry.Point(c[0],c[1],c[2])},linestring:function(a,b){var c=this.getElementsByTagNameNS(a,this.internalns,"coordinates"),d=null;if(c.length>0){var e=this.getChildValue(c[0]);e=e.replace(this.regExes.trimSpace,""),e=e.replace(this.regExes.trimComma,",");for(var f,g,h=e.split(this.regExes.splitSpace),i=h.length,j=new Array(i),k=0;i>k;++k){if(f=h[k].split(","),g=f.length,!(g>1))throw"Bad LineString point coordinates: "+h[k];2==f.length&&(f[2]=null),j[k]=new OpenLayers.Geometry.Point(f[0],f[1],f[2])}if(!i)throw"Bad LineString coordinates: "+e;d=b?new OpenLayers.Geometry.LinearRing(j):new OpenLayers.Geometry.LineString(j)}return d},polygon:function(a){var b=this.getElementsByTagNameNS(a,this.internalns,"LinearRing"),c=b.length,d=new Array(c);if(c>0)for(var e,f=0,g=b.length;g>f;++f){if(e=this.parseGeometry.linestring.apply(this,[b[f],!0]),!e)throw"Bad LinearRing geometry: "+f;d[f]=e}return new OpenLayers.Geometry.Polygon(d)},multigeometry:function(a){for(var b,c,d=[],e=a.childNodes,f=0,g=e.length;g>f;++f)if(b=e[f],1==b.nodeType){var h=b.prefix?b.nodeName.split(":")[1]:b.nodeName,c=this.parseGeometry[h.toLowerCase()];c&&d.push(c.apply(this,[b]))}return new OpenLayers.Geometry.Collection(d)}},parseAttributes:function(a){var b={},c=a.getElementsByTagName("ExtendedData");c.length&&(b=this.parseExtendedData(c[0]));
for(var d,e,f,g=a.childNodes,h=0,i=g.length;i>h;++h)if(d=g[h],1==d.nodeType&&(e=d.childNodes,e.length>=1&&e.length<=3)){var f;switch(e.length){case 1:f=e[0];break;case 2:var j=e[0],k=e[1];f=3==j.nodeType||4==j.nodeType?j:k;break;case 3:default:f=e[1]}if(3==f.nodeType||4==f.nodeType){var l=d.prefix?d.nodeName.split(":")[1]:d.nodeName,m=OpenLayers.Util.getXmlNodeValue(f);m&&(m=m.replace(this.regExes.trimSpace,""),b[l]=m)}}return b},parseExtendedData:function(a){var b,c,d,e,f={},g=a.getElementsByTagName("Data");for(b=0,c=g.length;c>b;b++){d=g[b],e=d.getAttribute("name");var h={},i=d.getElementsByTagName("value");if(i.length&&(h.value=this.getChildValue(i[0])),this.kvpAttributes)f[e]=h.value;else{var j=d.getElementsByTagName("displayName");j.length&&(h.displayName=this.getChildValue(j[0])),f[e]=h}}var k=a.getElementsByTagName("SimpleData");for(b=0,c=k.length;c>b;b++){var h={};d=k[b],e=d.getAttribute("name"),h.value=this.getChildValue(d),this.kvpAttributes?f[e]=h.value:(h.displayName=e,f[e]=h)}return f},parseProperty:function(a,b,c){var d,e=this.getElementsByTagNameNS(a,b,c);try{d=OpenLayers.Util.getXmlNodeValue(e[0])}catch(f){d=null}return d},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS(this.kmlns,"kml"),c=this.createFolderXML(),d=0,e=a.length;e>d;++d)c.appendChild(this.createPlacemarkXML(a[d]));return b.appendChild(c),OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFolderXML:function(){var a=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var b=this.createElementNS(this.kmlns,"name"),c=this.createTextNode(this.foldersName);b.appendChild(c),a.appendChild(b)}if(this.foldersDesc){var d=this.createElementNS(this.kmlns,"description"),e=this.createTextNode(this.foldersDesc);d.appendChild(e),a.appendChild(d)}return a},createPlacemarkXML:function(a){var b=this.createElementNS(this.kmlns,"name"),c=a.style&&a.style.label?a.style.label:a.id,d=a.attributes.name||c;b.appendChild(this.createTextNode(d));var e=this.createElementNS(this.kmlns,"description"),f=a.attributes.description||this.placemarksDesc;e.appendChild(this.createTextNode(f));var g=this.createElementNS(this.kmlns,"Placemark");null!=a.fid&&g.setAttribute("id",a.fid),g.appendChild(b),g.appendChild(e);var h=this.buildGeometryNode(a.geometry);if(g.appendChild(h),a.attributes){var i=this.buildExtendedData(a.attributes);i&&g.appendChild(i)}return g},buildGeometryNode:function(a){var b=a.CLASS_NAME,c=b.substring(b.lastIndexOf(".")+1),d=this.buildGeometry[c.toLowerCase()],e=null;return d&&(e=d.apply(this,[a])),e},buildGeometry:{point:function(a){var b=this.createElementNS(this.kmlns,"Point");return b.appendChild(this.buildCoordinatesNode(a)),b},multipoint:function(a){return this.buildGeometry.collection.apply(this,[a])},linestring:function(a){var b=this.createElementNS(this.kmlns,"LineString");return b.appendChild(this.buildCoordinatesNode(a)),b},multilinestring:function(a){return this.buildGeometry.collection.apply(this,[a])},linearring:function(a){var b=this.createElementNS(this.kmlns,"LinearRing");return b.appendChild(this.buildCoordinatesNode(a)),b},polygon:function(a){for(var b,c,d,e=this.createElementNS(this.kmlns,"Polygon"),f=a.components,g=0,h=f.length;h>g;++g)d=0==g?"outerBoundaryIs":"innerBoundaryIs",b=this.createElementNS(this.kmlns,d),c=this.buildGeometry.linearring.apply(this,[f[g]]),b.appendChild(c),e.appendChild(b);return e},multipolygon:function(a){return this.buildGeometry.collection.apply(this,[a])},collection:function(a){for(var b,c=this.createElementNS(this.kmlns,"MultiGeometry"),d=0,e=a.components.length;e>d;++d)b=this.buildGeometryNode.apply(this,[a.components[d]]),b&&c.appendChild(b);return c}},buildCoordinatesNode:function(a){var b,c=this.createElementNS(this.kmlns,"coordinates"),d=a.components;if(d){for(var e,f=d.length,g=new Array(f),h=0;f>h;++h)e=d[h],g[h]=this.buildCoordinates(e);b=g.join(" ")}else b=this.buildCoordinates(a);var i=this.createTextNode(b);return c.appendChild(i),c},buildCoordinates:function(a){return this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection)),a.x+","+a.y},buildExtendedData:function(a){var b=this.createElementNS(this.kmlns,"ExtendedData");for(var c in a)if(a[c]&&"name"!=c&&"description"!=c&&"styleUrl"!=c){var d=this.createElementNS(this.kmlns,"Data");d.setAttribute("name",c);var e=this.createElementNS(this.kmlns,"value");if("object"==typeof a[c]){if(a[c].value&&e.appendChild(this.createTextNode(a[c].value)),a[c].displayName){var f=this.createElementNS(this.kmlns,"displayName");f.appendChild(this.getXMLDoc().createCDATASection(a[c].displayName)),d.appendChild(f)}}else e.appendChild(this.createTextNode(a[c]));d.appendChild(e),b.appendChild(d)}return this.isSimpleContent(b)?null:b},CLASS_NAME:"OpenLayers.Format.KML"}),OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"}),OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a;a&&9==a.nodeType&&(a=a.documentElement);var c={};if(this.readNode(a,c),void 0===c.service){var d=new OpenLayers.Format.OGCExceptionReport;c.error=d.read(b)}return c},readers:{wms:{Service:function(a,b){b.service={},this.readChildNodes(a,b.service)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},BoundingBox:function(a){var b={};b.bbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))];var c={x:parseFloat(a.getAttribute("resx")),y:parseFloat(a.getAttribute("resy"))};return isNaN(c.x)&&isNaN(c.y)||(b.res=c),b},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},ContactInformation:function(a,b){b.contactInformation={},this.readChildNodes(a,b.contactInformation)},ContactPersonPrimary:function(a,b){b.personPrimary={},this.readChildNodes(a,b.personPrimary)},ContactPerson:function(a,b){b.person=this.getChildValue(a)},ContactOrganization:function(a,b){b.organization=this.getChildValue(a)},ContactPosition:function(a,b){b.position=this.getChildValue(a)},ContactAddress:function(a,b){b.contactAddress={},this.readChildNodes(a,b.contactAddress)},AddressType:function(a,b){b.type=this.getChildValue(a)},Address:function(a,b){b.address=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},StateOrProvince:function(a,b){b.stateOrProvince=this.getChildValue(a)},PostCode:function(a,b){b.postcode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ContactVoiceTelephone:function(a,b){b.phone=this.getChildValue(a)},ContactFacsimileTelephone:function(a,b){b.fax=this.getChildValue(a)},ContactElectronicMailAddress:function(a,b){b.email=this.getChildValue(a)},Fees:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.fees=c)},AccessConstraints:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.accessConstraints=c)},Capability:function(a,b){b.capability={nestedLayers:[],layers:[]},this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={},this.readChildNodes(a,b.request)},GetCapabilities:function(a,b){b.getcapabilities={formats:[]},this.readChildNodes(a,b.getcapabilities)},Format:function(a,b){OpenLayers.Util.isArray(b.formats)?b.formats.push(this.getChildValue(a)):b.format=this.getChildValue(a)},DCPType:function(a,b){this.readChildNodes(a,b)},HTTP:function(a,b){this.readChildNodes(a,b)},Get:function(a,b){b.get={},this.readChildNodes(a,b.get),b.href||(b.href=b.get.href)},Post:function(a,b){b.post={},this.readChildNodes(a,b.post),b.href||(b.href=b.get.href)},GetMap:function(a,b){b.getmap={formats:[]},this.readChildNodes(a,b.getmap)},GetFeatureInfo:function(a,b){b.getfeatureinfo={formats:[]},this.readChildNodes(a,b.getfeatureinfo)},Exception:function(a,b){b.exception={formats:[]},this.readChildNodes(a,b.exception)},Layer:function(a,b){var c,d;b.capability?(d=b.capability,c=b):d=b;var e=a.getAttributeNode("queryable"),f=e&&e.specified?a.getAttribute("queryable"):null;e=a.getAttributeNode("cascaded");var g=e&&e.specified?a.getAttribute("cascaded"):null;e=a.getAttributeNode("opaque");var h=e&&e.specified?a.getAttribute("opaque"):null,i=a.getAttribute("noSubsets"),j=a.getAttribute("fixedWidth"),k=a.getAttribute("fixedHeight"),l=c||{},m=OpenLayers.Util.extend,n={nestedLayers:[],styles:c?[].concat(c.styles):[],srs:c?m({},l.srs):{},metadataURLs:[],bbox:c?m({},l.bbox):{},llbbox:l.llbbox,dimensions:c?m({},l.dimensions):{},authorityURLs:c?m({},l.authorityURLs):{},identifiers:{},keywords:[],queryable:f&&""!==f?"1"===f||"true"===f:l.queryable||!1,cascaded:null!==g?parseInt(g):l.cascaded||0,opaque:h?"1"===h||"true"===h:l.opaque||!1,noSubsets:null!==i?"1"===i||"true"===i:l.noSubsets||!1,fixedWidth:null!=j?parseInt(j):l.fixedWidth||0,fixedHeight:null!=k?parseInt(k):l.fixedHeight||0,minScale:l.minScale,maxScale:l.maxScale,attribution:l.attribution};if(b.nestedLayers.push(n),n.capability=d,this.readChildNodes(a,n),delete n.capability,n.name){var o=n.name.split(":"),p=d.request,q=p.getfeatureinfo;o.length>0&&(n.prefix=o[0]),d.layers.push(n),void 0===n.formats&&(n.formats=p.getmap.formats),void 0===n.infoFormats&&q&&(n.infoFormats=q.formats)}},Attribution:function(a,b){b.attribution={},this.readChildNodes(a,b.attribution)},LogoURL:function(a,b){b.logo={width:a.getAttribute("width"),height:a.getAttribute("height")},this.readChildNodes(a,b.logo)},Style:function(a,b){var c={};b.styles.push(c),this.readChildNodes(a,c)},LegendURL:function(a,b){var c={width:a.getAttribute("width"),height:a.getAttribute("height")};b.legend=c,this.readChildNodes(a,c)},MetadataURL:function(a,b){var c={type:a.getAttribute("type")};b.metadataURLs.push(c),this.readChildNodes(a,c)},DataURL:function(a,b){b.dataURL={},this.readChildNodes(a,b.dataURL)},FeatureListURL:function(a,b){b.featureListURL={},this.readChildNodes(a,b.featureListURL)},AuthorityURL:function(a,b){var c=a.getAttribute("name"),d={};this.readChildNodes(a,d),b.authorityURLs[c]=d.href},Identifier:function(a,b){var c=a.getAttribute("authority");b.identifiers[c]=this.getChildValue(a)},KeywordList:function(a,b){this.readChildNodes(a,b)},SRS:function(a,b){b.srs[this.getChildValue(a)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"}),OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(a,b){this.readChildNodes(a,b)},Keyword:function(a,b){b.keywords&&b.keywords.push(this.getChildValue(a))},DescribeLayer:function(a,b){b.describelayer={formats:[]},this.readChildNodes(a,b.describelayer)},GetLegendGraphic:function(a,b){b.getlegendgraphic={formats:[]},this.readChildNodes(a,b.getlegendgraphic)},GetStyles:function(a,b){b.getstyles={formats:[]},this.readChildNodes(a,b.getstyles)},PutStyles:function(a,b){b.putstyles={formats:[]},this.readChildNodes(a,b.putstyles)},UserDefinedSymbolization:function(a,b){var c={supportSLD:1==parseInt(a.getAttribute("SupportSLD")),userLayer:1==parseInt(a.getAttribute("UserLayer")),userStyle:1==parseInt(a.getAttribute("UserStyle")),remoteWFS:1==parseInt(a.getAttribute("RemoteWFS"))};b.userSymbols=c},LatLonBoundingBox:function(a,b){b.llbbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))]},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("SRS"),b.bbox[c.srs]=c},ScaleHint:function(a,b){var c=a.getAttribute("min"),d=a.getAttribute("max"),e=Math.pow(2,.5),f=OpenLayers.INCHES_PER_UNIT.m;0!=c&&(b.maxScale=parseFloat((c/e*f*OpenLayers.DOTS_PER_INCH).toPrecision(13))),d!=Number.POSITIVE_INFINITY&&(b.minScale=parseFloat((d/e*f*OpenLayers.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(a,b){var c=a.getAttribute("name").toLowerCase(),d={name:c,units:a.getAttribute("units"),unitsymbol:a.getAttribute("unitSymbol")};b.dimensions[d.name]=d},Extent:function(a,b){var c=a.getAttribute("name").toLowerCase();if(c in b.dimensions){var d=b.dimensions[c];d.nearestVal="1"===a.getAttribute("nearestValue"),d.multipleVal="1"===a.getAttribute("multipleValues"),d.current="1"===a.getAttribute("current"),d["default"]=a.getAttribute("default")||"";var e=this.getChildValue(a);d.values=e.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){for(var c=this.getChildValue(a),d=c.split(/ +/),e=0,f=d.length;f>e;e++)b.srs[d[e]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"}),OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]),a.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!a.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=OpenLayers.Util.extend({},a),OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",a)]);return b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c}),b},setFeatureType:function(a){this.featureType=a,this.format.featureType=a},setGeometryName:function(a){this.geometryName=a,this.format.geometryName=a},handleRead:function(a,b){if(b=OpenLayers.Util.extend({},b),OpenLayers.Util.applyDefaults(b,this.options),b.callback){var c=a.priv;if(c.status>=200&&c.status<300){var d=this.parseResponse(c,b.readOptions);d&&d.success!==!1?(b.readOptions&&"object"==b.readOptions.output?OpenLayers.Util.extend(a,d):a.features=d,a.code=OpenLayers.Protocol.Response.SUCCESS):(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=d)}else a.code=OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)}},parseResponse:function(a,b){var c=a.responseXML;if(c&&c.documentElement||(c=a.responseText),!c||c.length<=0)return null;var d=null!==this.readFormat?this.readFormat.read(c):this.format.read(c,b);if(!this.featureNS){var e=this.readFormat||this.format;this.featureNS=e.featureNS,e.autoConfig=!1,this.geometryName||this.setGeometryName(e.geometryName)}return d},commit:function(a,b){b=OpenLayers.Util.extend({},b),OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:a});return c.priv=OpenLayers.Request.POST({url:b.url,headers:b.headers,data:this.format.write(a,b),callback:this.createCallback(this.handleCommit,c,b)}),c},handleCommit:function(a,b){if(b.callback){var c=a.priv,d=c.responseXML;d&&d.documentElement||(d=c.responseText);var e=this.format.read(d)||{};a.insertIds=e.insertIds||[],e.success?a.code=OpenLayers.Protocol.Response.SUCCESS:(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=e),b.callback.call(b.scope,a)}},filterDelete:function(a,b){b=OpenLayers.Util.extend({},b),OpenLayers.Util.applyDefaults(b,this.options);var c=(new OpenLayers.Protocol.Response({requestType:"commit"}),this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}})),d=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(b.featureNS?this.featurePrefix+":":"")+b.featureType}});b.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,b.featureNS);var e=this.format.writeNode("ogc:Filter",a);d.appendChild(e),c.appendChild(d);var f=OpenLayers.Format.XML.prototype.write.apply(this.format,[c]);return OpenLayers.Request.POST({url:this.url,callback:b.callback||function(){},data:f})},abort:function(a){a&&a.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(a,b,c,d){OpenLayers.Handler.prototype.initialize.apply(this,[a,c,d]),this.layer=b},touchstart:function(a){return this.startTouch(),OpenLayers.Event.isMultiTouch(a)?!0:this.mousedown(a)},touchmove:function(a){OpenLayers.Event.preventDefault(a)},mousedown:function(a){return(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))&&(this.down=a.xy),this.handle(a)?!this.stopDown:!0},mouseup:function(a){return this.up=a.xy,this.handle(a)?!this.stopUp:!0},click:function(a){return this.handle(a)?!this.stopClick:!0},mousemove:function(a){return this.callbacks.over||this.callbacks.out?(this.handle(a),!0):!0},dblclick:function(a){return!this.handle(a)},geometryTypeMatches:function(a){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)>-1},handle:function(a){this.feature&&!this.feature.layer&&(this.feature=null);var b=a.type,c=!1,d=!!this.feature,e="click"==b||"dblclick"==b||"touchstart"==b;if(this.feature=this.layer.getFeatureFromEvent(a),this.feature&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature){"touchstart"===b&&OpenLayers.Event.preventDefault(a);var f=this.feature!=this.lastFeature;this.geometryTypeMatches(this.feature)?(d&&f?(this.lastFeature&&this.triggerCallback(b,"out",[this.lastFeature]),this.triggerCallback(b,"in",[this.feature])):(!d||e)&&this.triggerCallback(b,"in",[this.feature]),this.lastFeature=this.feature,c=!0):(this.lastFeature&&(d&&f||e)&&this.triggerCallback(b,"out",[this.lastFeature]),this.feature=null)}else this.lastFeature&&(d||e)&&this.triggerCallback(b,"out",[this.lastFeature]);return c},triggerCallback:function(a,b,c){var d=this.EVENTMAP[a][b];if(d)if("click"==a&&this.up&&this.down){var e=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));e<=this.clickTolerance&&this.callback(d,c),this.up=this.down=null}else this.callback(d,c)},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.feature=null,this.lastFeature=null,this.down=null,this.up=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0),a},handleMapEvents:function(a){("removelayer"==a.type||"order"==a.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(a){for(var b,c=this.layers,d=0;d<c.length;d++)if(b=c[d].getFeatureFromEvent(a))return b},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),a.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(a){a.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var a,b=0;b<this.map.layers.length;++b)a=this.map.layers[b],-1!=OpenLayers.Util.indexOf(this.layers,a)&&a.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var a,b=0;b<this.layers.length;++b)a=this.layers[b],this.renderer&&a.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(a.renderer)},handleChangeLayer:function(a){var b=a.layer;"order"==a.property&&-1!=OpenLayers.Util.indexOf(this.layers,b)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),null===this.scope&&(this.scope=this),this.initLayer(a);var c={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(c.over=this.overFeature,c.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(c,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(a){OpenLayers.Util.isArray(a)?(this.layers=a,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:a})):this.layer=a},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(a){var b,c,d,e,f=this.layers||[this.layer];for(d=0;d<f.length;++d)if(b=f[d],e=0,null!=b.selectedFeatures)for(;b.selectedFeatures.length>e;)c=b.selectedFeatures[e],a&&a.except==c?++e:this.unselect(c)},clickFeature:function(a){if(!this.hover){var b=OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)>-1;b?this.toggleSelect()?this.unselect(a):this.multipleSelect()||this.unselectAll({except:a}):(this.multipleSelect()||this.unselectAll({except:a}),this.select(a))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(a){var b=a.layer;this.hover&&(this.highlightOnly?this.highlight(a):-1==OpenLayers.Util.indexOf(b.selectedFeatures,a)&&this.select(a))},outFeature:function(a){if(this.hover)if(this.highlightOnly){if(a._lastHighlighter==this.id)if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);b&&b.highlight(a)}else this.unhighlight(a)}else this.unselect(a)},highlight:function(a){var b=a.layer,c=this.events.triggerEvent("beforefeaturehighlighted",{feature:a});if(c!==!1){a._prevHighlighter=a._lastHighlighter,a._lastHighlighter=this.id;var d=this.selectStyle||this.renderIntent;b.drawFeature(a,d),this.events.triggerEvent("featurehighlighted",{feature:a})}},unhighlight:function(a){var b=a.layer;void 0==a._prevHighlighter?delete a._lastHighlighter:a._prevHighlighter==this.id?delete a._prevHighlighter:(a._lastHighlighter=a._prevHighlighter,delete a._prevHighlighter),b.drawFeature(a,a.style||a.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:a})},select:function(a){var b=this.onBeforeSelect.call(this.scope,a),c=a.layer;b!==!1&&(b=c.events.triggerEvent("beforefeatureselected",{feature:a}),b!==!1&&(c.selectedFeatures.push(a),this.highlight(a),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=c.selectedFeatures[0]),c.events.triggerEvent("featureselected",{feature:a}),this.onSelect.call(this.scope,a)))},unselect:function(a){var b=a.layer;this.unhighlight(a),OpenLayers.Util.removeItem(b.selectedFeatures,a),b.events.triggerEvent("featureunselected",{feature:a}),this.onUnselect.call(this.scope,a)},selectBox:function(a){if(a instanceof OpenLayers.Bounds){var b=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),c=this.map.getLonLatFromPixel({x:a.right,y:a.top}),d=new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat);this.multipleSelect()||this.unselectAll();var e=this.multiple;this.multiple=!0;var f=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:f});for(var g,h=0;h<f.length;++h){g=f[h];for(var i=0,j=g.features.length;j>i;++i){var k=g.features[i];k.getVisibility()&&(null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,k.geometry.CLASS_NAME)>-1)&&d.toGeometry().intersects(k.geometry)&&-1==OpenLayers.Util.indexOf(g.selectedFeatures,k)&&this.select(k)}}this.multiple=e,this.events.triggerEvent("boxselectionend",{layers:f})}},setMap:function(a){this.handlers.feature.setMap(a),this.box&&this.handlers.box.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(a){var b=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(a),this.handlers.feature.layer=this.layer,b&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a),this.map.addLayer(this.layer),!0},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(c),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,!0):!1},destroyFeature:function(a){!this.layer||!a&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var a=this.layer;a&&a.features.length>1&&this.layer.features[0].destroy()},finalize:function(a){var b=a?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(b,[this.geometryClone()]),this.destroyFeature(a)},cancel:function(){this.finalize(!0)},click:function(a){return OpenLayers.Event.stop(a),!1},dblclick:function(a){return OpenLayers.Event.stop(a),!1},modifyFeature:function(a){this.point||this.createFeature(a);var b=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=b.lon,this.point.geometry.y=b.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point&&this.point.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiPoint([a])),a},geometryClone:function(){var a=this.getGeometry();return a&&a.clone()},mousedown:function(a){return this.down(a)},touchstart:function(a){return this.startTouch(),this.lastTouchPx=a.xy,this.down(a)},mousemove:function(a){return this.move(a)},touchmove:function(a){return this.lastTouchPx=a.xy,this.move(a)},mouseup:function(a){return this.up(a)},touchend:function(a){return a.xy=this.lastTouchPx,this.up(a)},down:function(a){return this.mouseDown=!0,this.lastDown=a.xy,this.touch||this.modifyFeature(a.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(a){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy),!0},up:function(a){return this.mouseDown=!1,this.stoppedDown=this.stopDown,this.checkModifiers(a)?this.lastUp&&this.lastUp.equals(a.xy)?!0:this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)?(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.finalize(),!this.stopUp):!0:!0},mouseout:function(a){OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(a,b,c){var d=!0;if(null!=c&&a&&b){var e=a.distanceTo(b);e>c&&(d=!1)}return d},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(c),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(a){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,a),this.line=null},destroyPersistedFeature:function(){var a=this.layer;a&&a.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(a){this.layer.removeFeatures([this.point]);var b=this.layer.getLonLatFromViewPortPx(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(a,b){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(a,b),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(a,b){var c=this.getCurrentPointIndex()-1,d=this.line.geometry.components[c];
!d||isNaN(d.x)||isNaN(d.y)||this.insertXY(d.x+a,d.y+b)},insertDirectionLength:function(a,b){a*=Math.PI/180;var c=b*Math.cos(a),d=b*Math.sin(a);this.insertDeltaXY(c,d)},insertDeflectionLength:function(a,b){var c=this.getCurrentPointIndex()-1;if(c>0){var d=this.line.geometry.components[c],e=this.line.geometry.components[c-1],f=Math.atan2(d.y-e.y,d.x-e.x);this.insertDirectionLength(180*f/Math.PI+a,b)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var a=this.line.geometry,b=a.components,c=this.getCurrentPointIndex()-1,d=b[c],e=a.removeComponent(d);if(e){if(this.touch&&c>0){b=a.components;var f=b[c-1],g=this.getCurrentPointIndex(),h=b[g];h.x=f.x,h.y=f.y}this.redoStack||(this.redoStack=[]),this.redoStack.push(d),this.drawFeature()}return e},redo:function(){var a=this.redoStack&&this.redoStack.pop();return a&&(this.line.geometry.addComponent(a,this.getCurrentPointIndex()),this.drawFeature()),!!a},freehandMode:function(a){return this.freehandToggle&&a[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(a,b){this.line||this.createFeature(a);var c=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=c.lon,this.point.geometry.y=c.lat,this.callback("modify",[this.point.geometry,this.getSketch(),b]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var a=this.line&&this.line.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiLineString([a])),a},touchstart:function(a){return this.timerId&&this.passesTolerance(this.lastTouchPx,a.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,a))},down:function(a){var b=this.stopDown;return this.freehandMode(a)&&(b=!0,this.touch&&(this.modifyFeature(a.xy,!!this.lastUp),OpenLayers.Event.stop(a))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)||this.modifyFeature(a.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=a.xy,this.stoppedDown=b,!b},move:function(a){return this.stoppedDown&&this.freehandMode(a)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(a.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy,!!this.lastUp),!0)},up:function(a){return!this.mouseDown||this.lastUp&&this.lastUp.equals(a.xy)||(this.stoppedDown&&this.freehandMode(a)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(a.xy),this.lastUp=a.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){var a=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[a]),this.removePoint(),this.finalize()},dblclick:function(a){return this.freehandMode(a)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Spherical=OpenLayers.Spherical||{},OpenLayers.Spherical.DEFAULT_RADIUS=6378137,OpenLayers.Spherical.computeDistanceBetween=function(a,b,c){var d=c||OpenLayers.Spherical.DEFAULT_RADIUS,e=Math.sin(Math.PI*(b.lon-a.lon)/360),f=Math.sin(Math.PI*(b.lat-a.lat)/360),g=f*f+e*e*Math.cos(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180);return 2*d*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))},OpenLayers.Spherical.computeHeading=function(a,b){var c=Math.sin(Math.PI*(a.lon-b.lon)/180)*Math.cos(Math.PI*b.lat/180),d=Math.cos(Math.PI*a.lat/180)*Math.sin(Math.PI*b.lat/180)-Math.sin(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180)*Math.cos(Math.PI*(a.lon-b.lon)/180);return 180*Math.atan2(c,d)/Math.PI},OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:"image/png",quotaRegEx:/quota/i,setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);var b,c=this.layers||a.layers;for(b=c.length-1;b>=0;--b)this.addLayer({layer:c[b]});this.layers||a.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(a){a.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},removeLayer:function(a){a.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},makeSameOrigin:function(a){if(this.active){var b=a.tile;if(b instanceof OpenLayers.Tile.Image&&!b.crossOriginKeyword&&"data:"!==b.url.substr(0,5)){var c=OpenLayers.Request.makeSameOrigin(b.url,OpenLayers.ProxyHost);OpenLayers.Control.CacheWrite.urlMap[c]=b.url,b.url=c}}},onTileLoaded:function(a){this.active&&!a.aborted&&a.tile instanceof OpenLayers.Tile.Image&&"data:"!==a.tile.url.substr(0,5)&&(this.cache({tile:a.tile}),delete OpenLayers.Control.CacheWrite.urlMap[a.tile.url])},cache:function(a){if(window.localStorage){var b=a.tile;try{var c=b.getCanvasContext();if(c){var d=OpenLayers.Control.CacheWrite.urlMap,e=d[b.url]||b.url;window.localStorage.setItem("olCache_"+e,c.canvas.toDataURL(this.imageFormat))}}catch(f){var g=f.name||f.message;g&&this.quotaRegEx.test(g)?this.events.triggerEvent("cachefull",{tile:b}):OpenLayers.Console.error(f.toString())}}},destroy:function(){if(this.layers||this.map){var a,b=this.layers||this.map.layers;for(a=b.length-1;a>=0;--a)this.removeLayer({layer:b[a]})}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheWrite"}),OpenLayers.Control.CacheWrite.clearCache=function(){if(window.localStorage){var a,b;for(a=window.localStorage.length-1;a>=0;--a)b=window.localStorage.key(a),"olCache_"===b.substr(0,8)&&window.localStorage.removeItem(b)}},OpenLayers.Control.CacheWrite.urlMap={},OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(a,b){var c,d=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(b&&b.map)if(this.context=d,b.map instanceof OpenLayers.Map)c=this.mergeContextToMap(d,b.map);else{var e=b.map;(OpenLayers.Util.isElement(e)||"string"==typeof e)&&(e={div:e}),c=this.contextToMap(d,e)}else c=d;return c},getLayerFromContext:function(a){var b,c,d={queryable:a.queryable,visibility:a.visibility,maxExtent:a.maxExtent,metadata:OpenLayers.Util.applyDefaults(a.metadata,{styles:a.styles,formats:a.formats,"abstract":a["abstract"],dataURL:a.dataURL}),numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:a.tileSize?new OpenLayers.Size(a.tileSize.width,a.tileSize.height):void 0,minScale:a.minScale||a.maxScaleDenominator,maxScale:a.maxScale||a.minScaleDenominator,srs:a.srs,dimensions:a.dimensions,metadataURL:a.metadataURL};this.layerOptions&&OpenLayers.Util.applyDefaults(d,this.layerOptions);var e={layers:a.name,transparent:a.transparent,version:a.version};if(a.formats&&a.formats.length>0)for(e.format=a.formats[0].value,b=0,c=a.formats.length;c>b;b++){var f=a.formats[b];if(1==f.current){e.format=f.value;break}}if(a.styles&&a.styles.length>0)for(b=0,c=a.styles.length;c>b;b++){var g=a.styles[b];if(1==g.current){g.href?e.sld=g.href:g.body?e.sld_body=g.body:e.styles=g.name;break}}this.layerParams&&OpenLayers.Util.applyDefaults(e,this.layerParams);var h=null,i=a.service;return i==OpenLayers.Format.Context.serviceTypes.WFS?(d.strategies=[new OpenLayers.Strategy.BBOX],d.protocol=new OpenLayers.Protocol.WFS({url:a.url,featurePrefix:a.name.split(":")[0],featureType:a.name.split(":").pop()}),h=new OpenLayers.Layer.Vector(a.title||a.name,d)):i==OpenLayers.Format.Context.serviceTypes.KML?(d.strategies=[new OpenLayers.Strategy.Fixed],d.protocol=new OpenLayers.Protocol.HTTP({url:a.url,format:new OpenLayers.Format.KML}),h=new OpenLayers.Layer.Vector(a.title||a.name,d)):i==OpenLayers.Format.Context.serviceTypes.GML?(d.strategies=[new OpenLayers.Strategy.Fixed],d.protocol=new OpenLayers.Protocol.HTTP({url:a.url,format:new OpenLayers.Format.GML}),h=new OpenLayers.Layer.Vector(a.title||a.name,d)):a.features?(h=new OpenLayers.Layer.Vector(a.title||a.name,d),h.addFeatures(a.features)):a.categoryLayer!==!0&&(h=new OpenLayers.Layer.WMS(a.title||a.name,a.url,e,d)),h},getLayersFromContext:function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=this.getLayerFromContext(a[c]);null!==e&&b.push(e)}return b},contextToMap:function(a,b){b=OpenLayers.Util.applyDefaults({maxExtent:a.maxExtent,projection:a.projection,units:a.units},b),b.maxExtent&&(b.maxResolution=b.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);var c={contactInformation:a.contactInformation,"abstract":a["abstract"],keywords:a.keywords,logo:a.logo,descriptionURL:a.descriptionURL};b.metadata=c;var d=new OpenLayers.Map(b);return d.addLayers(this.getLayersFromContext(a.layersContext)),d.setCenter(a.bounds.getCenterLonLat(),d.getZoomForExtent(a.bounds,!0)),d},mergeContextToMap:function(a,b){return b.addLayers(this.getLayersFromContext(a.layersContext)),b},write:function(a){return a=this.toContext(a),OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"}),OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"},OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(a){var b=this.getParser(),c={queryable:a.queryable,visibility:a.visibility,name:a.params.LAYERS,title:a.name,"abstract":a.metadata["abstract"],dataURL:a.metadata.dataURL,metadataURL:a.metadataURL,server:{version:a.params.VERSION,url:a.url},maxExtent:a.maxExtent,transparent:a.params.TRANSPARENT,numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:1==a.opacity?void 0:a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:a.singleTile||!a.tileSize?void 0:{width:a.tileSize.w,height:a.tileSize.h},minScale:a.options.resolutions||a.options.scales||a.options.maxResolution||a.options.minScale?a.minScale:void 0,maxScale:a.options.resolutions||a.options.scales||a.options.minResolution||a.options.maxScale?a.maxScale:void 0,formats:[],styles:[],srs:a.srs,dimensions:a.dimensions};if(a.metadata.servertitle&&(c.server.title=a.metadata.servertitle),a.metadata.formats&&a.metadata.formats.length>0)for(var d=0,e=a.metadata.formats.length;e>d;d++){var f=a.metadata.formats[d];c.formats.push({value:f.value,current:f.value==a.params.FORMAT})}else c.formats.push({value:a.params.FORMAT,current:!0});if(a.metadata.styles&&a.metadata.styles.length>0)for(var d=0,e=a.metadata.styles.length;e>d;d++){var g=a.metadata.styles[d];g.current=g.href==a.params.SLD||g.body==a.params.SLD_BODY||g.name==a.params.STYLES?!0:!1,c.styles.push(g)}else c.styles.push({href:a.params.SLD,body:a.params.SLD_BODY,name:a.params.STYLES||b.defaultStyleName,title:b.defaultStyleTitle,current:!0});return c},toContext:function(a){var b={},c=a.layers;if("OpenLayers.Map"==a.CLASS_NAME){var d=a.metadata||{};b.size=a.getSize(),b.bounds=a.getExtent(),b.projection=a.projection,b.title=a.title,b.keywords=d.keywords,b["abstract"]=d["abstract"],b.logo=d.logo,b.descriptionURL=d.descriptionURL,b.contactInformation=d.contactInformation,b.maxExtent=a.maxExtent}else OpenLayers.Util.applyDefaults(b,a),void 0!=b.layers&&delete b.layers;if(void 0==b.layersContext&&(b.layersContext=[]),void 0!=c&&OpenLayers.Util.isArray(c))for(var e=0,f=c.length;f>e;e++){var g=c[e];g instanceof OpenLayers.Layer.WMS&&b.layersContext.push(this.layerToContext(g))}return b},CLASS_NAME:"OpenLayers.Format.WMC"}),OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(a){var b=null;if(null==a)b=this.namespaces[this.defaultPrefix];else for(b in this.namespaces)if(this.namespaces[b]==a)break;return b},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a.documentElement;this.rootPrefix=b.prefix;var c={version:b.getAttribute("version")};return this.runChildNodes(c,b),c},runChildNodes:function(a,b){for(var c,d,e,f,g=b.childNodes,h=0,i=g.length;i>h;++h)c=g[h],1==c.nodeType&&(e=this.getNamespacePrefix(c.namespaceURI),f=c.nodeName.split(":").pop(),d=this["read_"+e+"_"+f],d&&d.apply(this,[a,c]))},read_wmc_General:function(a,b){this.runChildNodes(a,b)},read_wmc_BoundingBox:function(a,b){a.projection=b.getAttribute("SRS"),a.bounds=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"))},read_wmc_LayerList:function(a,b){a.layersContext=[],this.runChildNodes(a,b)},read_wmc_Layer:function(a,b){var c={visibility:"1"!=b.getAttribute("hidden"),queryable:"1"==b.getAttribute("queryable"),formats:[],styles:[],metadata:{}};this.runChildNodes(c,b),a.layersContext.push(c)},read_wmc_Extension:function(a,b){this.runChildNodes(a,b)},read_ol_units:function(a,b){a.units=this.getChildValue(b)},read_ol_maxExtent:function(a,b){var c=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"));a.maxExtent=c},read_ol_transparent:function(a,b){a.transparent=this.getChildValue(b)},read_ol_numZoomLevels:function(a,b){a.numZoomLevels=parseInt(this.getChildValue(b))},read_ol_opacity:function(a,b){a.opacity=parseFloat(this.getChildValue(b))},read_ol_singleTile:function(a,b){a.singleTile="true"==this.getChildValue(b)},read_ol_tileSize:function(a,b){var c={width:b.getAttribute("width"),height:b.getAttribute("height")};a.tileSize=c},read_ol_isBaseLayer:function(a,b){a.isBaseLayer="true"==this.getChildValue(b)},read_ol_displayInLayerSwitcher:function(a,b){a.displayInLayerSwitcher="true"==this.getChildValue(b)},read_wmc_Server:function(a,b){a.version=b.getAttribute("version"),a.url=this.getOnlineResource_href(b),a.metadata.servertitle=b.getAttribute("title")},read_wmc_FormatList:function(a,b){this.runChildNodes(a,b)},read_wmc_Format:function(a,b){var c={value:this.getChildValue(b)};"1"==b.getAttribute("current")&&(c.current=!0),a.formats.push(c)},read_wmc_StyleList:function(a,b){this.runChildNodes(a,b)},read_wmc_Style:function(a,b){var c={};this.runChildNodes(c,b),"1"==b.getAttribute("current")&&(c.current=!0),a.styles.push(c)},read_wmc_SLD:function(a,b){this.runChildNodes(a,b)},read_sld_StyledLayerDescriptor:function(a,b){var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c},read_sld_FeatureTypeStyle:function(a,b){var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c},read_wmc_OnlineResource:function(a,b){a.href=this.getAttributeNS(b,this.namespaces.xlink,"href")},read_wmc_Name:function(a,b){var c=this.getChildValue(b);c&&(a.name=c)},read_wmc_Title:function(a,b){var c=this.getChildValue(b);c&&(a.title=c)},read_wmc_MetadataURL:function(a,b){a.metadataURL=this.getOnlineResource_href(b)},read_wmc_KeywordList:function(a,b){a.keywords=[],this.runChildNodes(a.keywords,b)},read_wmc_Keyword:function(a,b){a.push(this.getChildValue(b))},read_wmc_Abstract:function(a,b){var c=this.getChildValue(b);c&&(a["abstract"]=c)},read_wmc_LogoURL:function(a,b){a.logo={width:b.getAttribute("width"),height:b.getAttribute("height"),format:b.getAttribute("format"),href:this.getOnlineResource_href(b)}},read_wmc_DescriptionURL:function(a,b){a.descriptionURL=this.getOnlineResource_href(b)},read_wmc_ContactInformation:function(a,b){var c={};this.runChildNodes(c,b),a.contactInformation=c},read_wmc_ContactPersonPrimary:function(a,b){var c={};this.runChildNodes(c,b),a.personPrimary=c},read_wmc_ContactPerson:function(a,b){var c=this.getChildValue(b);c&&(a.person=c)},read_wmc_ContactOrganization:function(a,b){var c=this.getChildValue(b);c&&(a.organization=c)},read_wmc_ContactPosition:function(a,b){var c=this.getChildValue(b);c&&(a.position=c)},read_wmc_ContactAddress:function(a,b){var c={};this.runChildNodes(c,b),a.contactAddress=c},read_wmc_AddressType:function(a,b){var c=this.getChildValue(b);c&&(a.type=c)},read_wmc_Address:function(a,b){var c=this.getChildValue(b);c&&(a.address=c)},read_wmc_City:function(a,b){var c=this.getChildValue(b);c&&(a.city=c)},read_wmc_StateOrProvince:function(a,b){var c=this.getChildValue(b);c&&(a.stateOrProvince=c)},read_wmc_PostCode:function(a,b){var c=this.getChildValue(b);c&&(a.postcode=c)},read_wmc_Country:function(a,b){var c=this.getChildValue(b);c&&(a.country=c)},read_wmc_ContactVoiceTelephone:function(a,b){var c=this.getChildValue(b);c&&(a.phone=c)},read_wmc_ContactFacsimileTelephone:function(a,b){var c=this.getChildValue(b);c&&(a.fax=c)},read_wmc_ContactElectronicMailAddress:function(a,b){var c=this.getChildValue(b);c&&(a.email=c)},read_wmc_DataURL:function(a,b){a.dataURL=this.getOnlineResource_href(b)},read_wmc_LegendURL:function(a,b){var c={width:b.getAttribute("width"),height:b.getAttribute("height"),format:b.getAttribute("format"),href:this.getOnlineResource_href(b)};a.legend=c},read_wmc_DimensionList:function(a,b){a.dimensions={},this.runChildNodes(a.dimensions,b)},read_wmc_Dimension:function(a,b){var c=b.getAttribute("name").toLowerCase(),d={name:c,units:b.getAttribute("units")||"",unitSymbol:b.getAttribute("unitSymbol")||"",userValue:b.getAttribute("userValue")||"",nearestValue:"1"===b.getAttribute("nearestValue"),multipleValues:"1"===b.getAttribute("multipleValues"),current:"1"===b.getAttribute("current"),"default":b.getAttribute("default")||""},e=this.getChildValue(b);d.values=e.split(","),a[d.name]=d},write:function(a,b){var c=this.createElementDefaultNS("ViewContext");return this.setAttributes(c,{version:this.VERSION,id:b&&"string"==typeof b.id?b.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")}),this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),c.appendChild(this.write_wmc_General(a)),c.appendChild(this.write_wmc_LayerList(a)),OpenLayers.Format.XML.prototype.write.apply(this,[c])},createElementDefaultNS:function(a,b,c){var d=this.createElementNS(this.namespaces[this.defaultPrefix],a);return b&&d.appendChild(this.createTextNode(b)),c&&this.setAttributes(d,c),d},setAttributes:function(a,b){var c;for(var d in b)c=b[d].toString(),c.match(/[A-Z]/)?this.setAttributeNS(a,null,d,c):a.setAttribute(d,c)},write_wmc_General:function(a){var b=this.createElementDefaultNS("General");a.size&&b.appendChild(this.createElementDefaultNS("Window",null,{width:a.size.w,height:a.size.h}));var c=a.bounds;return b.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18),SRS:a.projection})),b.appendChild(this.createElementDefaultNS("Title",a.title)),a.keywords&&b.appendChild(this.write_wmc_KeywordList(a.keywords)),a["abstract"]&&b.appendChild(this.createElementDefaultNS("Abstract",a["abstract"])),a.logo&&b.appendChild(this.write_wmc_URLType("LogoURL",a.logo.href,a.logo)),a.descriptionURL&&b.appendChild(this.write_wmc_URLType("DescriptionURL",a.descriptionURL)),a.contactInformation&&b.appendChild(this.write_wmc_ContactInformation(a.contactInformation)),b.appendChild(this.write_ol_MapExtension(a)),b},write_wmc_KeywordList:function(a){for(var b=this.createElementDefaultNS("KeywordList"),c=0,d=a.length;d>c;c++)b.appendChild(this.createElementDefaultNS("Keyword",a[c]));return b},write_wmc_ContactInformation:function(a){var b=this.createElementDefaultNS("ContactInformation");return a.personPrimary&&b.appendChild(this.write_wmc_ContactPersonPrimary(a.personPrimary)),a.position&&b.appendChild(this.createElementDefaultNS("ContactPosition",a.position)),a.contactAddress&&b.appendChild(this.write_wmc_ContactAddress(a.contactAddress)),a.phone&&b.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",a.phone)),a.fax&&b.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",a.fax)),a.email&&b.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",a.email)),b},write_wmc_ContactPersonPrimary:function(a){var b=this.createElementDefaultNS("ContactPersonPrimary");return a.person&&b.appendChild(this.createElementDefaultNS("ContactPerson",a.person)),a.organization&&b.appendChild(this.createElementDefaultNS("ContactOrganization",a.organization)),b},write_wmc_ContactAddress:function(a){var b=this.createElementDefaultNS("ContactAddress");return a.type&&b.appendChild(this.createElementDefaultNS("AddressType",a.type)),a.address&&b.appendChild(this.createElementDefaultNS("Address",a.address)),a.city&&b.appendChild(this.createElementDefaultNS("City",a.city)),a.stateOrProvince&&b.appendChild(this.createElementDefaultNS("StateOrProvince",a.stateOrProvince)),a.postcode&&b.appendChild(this.createElementDefaultNS("PostCode",a.postcode)),a.country&&b.appendChild(this.createElementDefaultNS("Country",a.country)),b},write_ol_MapExtension:function(a){var b=this.createElementDefaultNS("Extension"),c=a.maxExtent;if(c){var d=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(d,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18)}),b.appendChild(d)}return b},write_wmc_LayerList:function(a){for(var b=this.createElementDefaultNS("LayerList"),c=0,d=a.layersContext.length;d>c;++c)b.appendChild(this.write_wmc_Layer(a.layersContext[c]));return b},write_wmc_Layer:function(a){var b=this.createElementDefaultNS("Layer",null,{queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1"});return b.appendChild(this.write_wmc_Server(a)),b.appendChild(this.createElementDefaultNS("Name",a.name)),b.appendChild(this.createElementDefaultNS("Title",a.title)),a["abstract"]&&b.appendChild(this.createElementDefaultNS("Abstract",a["abstract"])),a.dataURL&&b.appendChild(this.write_wmc_URLType("DataURL",a.dataURL)),a.metadataURL&&b.appendChild(this.write_wmc_URLType("MetadataURL",a.metadataURL)),b},write_wmc_LayerExtension:function(a){var b=this.createElementDefaultNS("Extension"),c=a.maxExtent,d=this.createElementNS(this.namespaces.ol,"ol:maxExtent");if(this.setAttributes(d,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18)}),b.appendChild(d),a.tileSize&&!a.singleTile){var e=this.createElementNS(this.namespaces.ol,"ol:tileSize");this.setAttributes(e,a.tileSize),b.appendChild(e)}for(var f,g=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"],h=0,i=g.length;i>h;++h)f=this.createOLPropertyNode(a,g[h]),f&&b.appendChild(f);return b},createOLPropertyNode:function(a,b){var c=null;return null!=a[b]&&(c=this.createElementNS(this.namespaces.ol,"ol:"+b),c.appendChild(this.createTextNode(a[b].toString()))),c},write_wmc_Server:function(a){var b=a.server,c=this.createElementDefaultNS("Server"),d={service:"OGC:WMS",version:b.version};return b.title&&(d.title=b.title),this.setAttributes(c,d),c.appendChild(this.write_wmc_OnlineResource(b.url)),c},write_wmc_URLType:function(a,b,c){var d=this.createElementDefaultNS(a);if(d.appendChild(this.write_wmc_OnlineResource(b)),c)for(var e=["width","height","format"],f=0;f<e.length;f++)e[f]in c&&d.setAttribute(e[f],c[e[f]]);return d},write_wmc_DimensionList:function(a){var b=this.createElementDefaultNS("DimensionList");for(var c in a.dimensions){var d={},e=a.dimensions[c];for(var f in e)d[f]="boolean"==typeof e[f]?Number(e[f]):e[f];var g="";d.values&&(g=d.values.join(","),delete d.values),b.appendChild(this.createElementDefaultNS("Dimension",g,d))}return b},write_wmc_FormatList:function(a){for(var b=this.createElementDefaultNS("FormatList"),c=0,d=a.formats.length;d>c;c++){var e=a.formats[c];b.appendChild(this.createElementDefaultNS("Format",e.value,e.current&&1==e.current?{current:"1"}:null))}return b},write_wmc_StyleList:function(a){var b=this.createElementDefaultNS("StyleList"),c=a.styles;if(c&&OpenLayers.Util.isArray(c))for(var d,e=0,f=c.length;f>e;e++){var g=c[e],h=this.createElementDefaultNS("Style",null,g.current&&1==g.current?{current:"1"}:null);if(g.href){d=this.createElementDefaultNS("SLD"),g.name&&d.appendChild(this.createElementDefaultNS("Name",g.name)),g.title&&d.appendChild(this.createElementDefaultNS("Title",g.title)),g.legend&&d.appendChild(this.write_wmc_URLType("LegendURL",g.legend.href,g.legend));var i=this.write_wmc_OnlineResource(g.href);d.appendChild(i),h.appendChild(d)}else if(g.body){d=this.createElementDefaultNS("SLD"),g.name&&d.appendChild(this.createElementDefaultNS("Name",g.name)),g.title&&d.appendChild(this.createElementDefaultNS("Title",g.title)),g.legend&&d.appendChild(this.write_wmc_URLType("LegendURL",g.legend.href,g.legend));var j=OpenLayers.Format.XML.prototype.read.apply(this,[g.body]),k=j.documentElement;d.ownerDocument&&d.ownerDocument.importNode&&(k=d.ownerDocument.importNode(k,!0)),d.appendChild(k),h.appendChild(d)}else h.appendChild(this.createElementDefaultNS("Name",g.name)),h.appendChild(this.createElementDefaultNS("Title",g.title)),g["abstract"]&&h.appendChild(this.createElementDefaultNS("Abstract",g["abstract"])),g.legend&&h.appendChild(this.write_wmc_URLType("LegendURL",g.legend.href,g.legend));b.appendChild(h)}return b},write_wmc_OnlineResource:function(a){var b=this.createElementDefaultNS("OnlineResource");return this.setAttributeNS(b,this.namespaces.xlink,"xlink:type","simple"),this.setAttributeNS(b,this.namespaces.xlink,"xlink:href",a),b},getOnlineResource_href:function(a){var b={},c=a.getElementsByTagName("OnlineResource");return c.length>0&&this.read_wmc_OnlineResource(b,c[0]),b.href},CLASS_NAME:"OpenLayers.Format.WMC.v1"}),OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);var a={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,a)])},CLASS_NAME:"OpenLayers.Control.PanPanel"}),OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this}),this.updateAttribution(),this.div},updateAttribution:function(){var a=[];if(this.map&&this.map.layers){for(var b=0,c=this.map.layers.length;c>b;b++){var d=this.map.layers[b];d.attribution&&d.getVisibility()&&-1===OpenLayers.Util.indexOf(a,d.attribution)&&a.push(d.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:a.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"}),OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(a){OpenLayers.Util.extend(this,a)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(a){this.points.unshift({xy:a,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(a){for(var b,c,d=(new Date).getTime(),e=0,f=this.points.length;f>e&&(c=this.points[e],!(d-c.tick>this.delay));e++)b=c;if(b){var g=(new Date).getTime()-b.tick,h=Math.sqrt(Math.pow(a.x-b.xy.x,2)+Math.pow(a.y-b.xy.y,2)),i=h/g;if(!(0==i||i<this.threshold)){var j=Math.asin((a.y-b.xy.y)/h);return b.xy.x<=a.x&&(j=Math.PI-j),{speed:i,theta:j}}}},move:function(a,b){var c=a.speed,d=Math.cos(a.theta),e=-Math.sin(a.theta),f=(new Date).getTime(),g=0,h=0,i=function(){if(null!=this.timerId){var a=(new Date).getTime()-f,i=-this.deceleration*Math.pow(a,2)/2+c*a,j=i*d,k=i*e,l={};l.end=!1;var m=-this.deceleration*a+c;0>=m&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,l.end=!0),l.x=j-g,l.y=k-h,g=j,h=k,b(l.x,l.y,l.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(i,this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,OpenLayers.Format.Filter.v1_1_0,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(){return void 0},write:function(a){var b;window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),this.xmldom=b):b=document.implementation.createDocument("","",null);var c=this.writeNode("wps:Execute",a,b);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},writers:{wps:{Execute:function(a){var b=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});return this.writeNode("ows:Identifier",a.identifier,b),this.writeNode("wps:DataInputs",a.dataInputs,b),this.writeNode("wps:ResponseForm",a.responseForm,b),b},ResponseForm:function(a){var b=this.createElementNSPlus("wps:ResponseForm",{});return a.rawDataOutput&&this.writeNode("wps:RawDataOutput",a.rawDataOutput,b),a.responseDocument&&this.writeNode("wps:ResponseDocument",a.responseDocument,b),b},ResponseDocument:function(a){var b=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:a.storeExecuteResponse,lineage:a.lineage,status:a.status}});if(a.outputs)for(var c=0,d=a.outputs.length;d>c;c++)this.writeNode("wps:Output",a.outputs[c],b);return b},Output:function(a){var b=this.createElementNSPlus("wps:Output",{attributes:{asReference:a.asReference,mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}});return this.writeNode("ows:Identifier",a.identifier,b),this.writeNode("ows:Title",a.title,b),this.writeNode("ows:Abstract",a["abstract"],b),b},RawDataOutput:function(a){var b=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}});return this.writeNode("ows:Identifier",a.identifier,b),b},DataInputs:function(a){for(var b=this.createElementNSPlus("wps:DataInputs",{}),c=0,d=a.length;d>c;++c)this.writeNode("wps:Input",a[c],b);
return b},Input:function(a){var b=this.createElementNSPlus("wps:Input",{});return this.writeNode("ows:Identifier",a.identifier,b),a.title&&this.writeNode("ows:Title",a.title,b),a.data&&this.writeNode("wps:Data",a.data,b),a.reference&&this.writeNode("wps:Reference",a.reference,b),a.boundingBoxData&&this.writeNode("wps:BoundingBoxData",a.boundingBoxData,b),b},Data:function(a){var b=this.createElementNSPlus("wps:Data",{});return a.literalData?this.writeNode("wps:LiteralData",a.literalData,b):a.complexData?this.writeNode("wps:ComplexData",a.complexData,b):a.boundingBoxData&&this.writeNode("ows:BoundingBox",a.boundingBoxData,b),b},LiteralData:function(a){var b=this.createElementNSPlus("wps:LiteralData",{attributes:{uom:a.uom},value:a.value});return b},ComplexData:function(a){var b=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}}),c=a.value;return b.appendChild("string"==typeof c?this.getXMLDoc().createCDATASection(a.value):c),b},Reference:function(a){var b=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:a.mimeType,"xlink:href":a.href,method:a.method,encoding:a.encoding,schema:a.schema}});return a.body&&this.writeNode("wps:Body",a.body,b),b},BoundingBoxData:function(a,b){this.writers.ows.BoundingBox.apply(this,[a,b,"wps:BoundingBoxData"])},Body:function(a){var b=this.createElementNSPlus("wps:Body",{});return a.wcs?this.writeNode("wcs:GetCoverage",a.wcs,b):a.wfs?(this.featureType=a.wfs.featureType,this.version=a.wfs.version,this.writeNode("wfs:GetFeature",a.wfs,b)):this.writeNode("wps:Execute",a,b),b}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(a,b){b.executeResponse={lang:a.getAttribute("lang"),statusLocation:a.getAttribute("statusLocation"),serviceInstance:a.getAttribute("serviceInstance"),service:a.getAttribute("service")},this.readChildNodes(a,b.executeResponse)},Process:function(a,b){b.process={},this.readChildNodes(a,b.process)},Status:function(a,b){b.status={creationTime:a.getAttribute("creationTime")},this.readChildNodes(a,b.status)},ProcessSucceeded:function(a,b){b.processSucceeded=!0},ProcessOutputs:function(a,b){b.processOutputs=[],this.readChildNodes(a,b.processOutputs)},Output:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)},Reference:function(a,b){b.reference={href:a.getAttribute("href"),mimeType:a.getAttribute("mimeType"),encoding:a.getAttribute("encoding"),schema:a.getAttribute("schema")}},Data:function(a,b){b.data={},this.readChildNodes(a,b)},LiteralData:function(a,b){b.literalData={dataType:a.getAttribute("dataType"),uom:a.getAttribute("uom"),value:this.getChildValue(a)}},ComplexData:function(a,b){if(b.complexData={mimeType:a.getAttribute("mimeType"),schema:a.getAttribute("schema"),encoding:a.getAttribute("encoding"),value:""},this.isSimpleContent(a)){var c;for(c=a.firstChild;c;c=c.nextSibling)switch(c.nodeType){case 3:case 4:b.complexData.value+=c.nodeValue}}else for(c=a.firstChild;c;c=c.nextSibling)1==c.nodeType&&(b.complexData.value=c)},BoundingBox:function(a,b){b.boundingBoxData={dimensions:a.getAttribute("dimensions"),crs:a.getAttribute("crs")},this.readChildNodes(a,b.boundingBoxData)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"}),OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(a,b,c){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[a,c]),this.location=b,this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(a){var b=a.responseXML;if(b&&b.documentElement||(b=OpenLayers.Format.XML.prototype.read(a.responseText)),this.useFeedTitle){var c=null;try{c=b.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(d){c=b.getElementsByTagName("title")[0].firstChild.nodeValue}c&&this.setName(c)}var e={};OpenLayers.Util.extend(e,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(e.externalProjection=this.projection,e.internalProjection=this.map.getProjectionObject());for(var f=new OpenLayers.Format.GeoRSS(e),g=f.read(b),h=0,i=g.length;i>h;h++){var j={},k=g[h];if(k.geometry){var l=k.attributes.title?k.attributes.title:"Untitled",m=k.attributes.description?k.attributes.description:"No description.",n=k.attributes.link?k.attributes.link:"",o=k.geometry.getBounds().getCenterLonLat();if(j.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone(),j.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120),l||m){j.title=l,j.description=m;var p='<div class="olLayerGeoRSSClose">[x]</div>';p+='<div class="olLayerGeoRSSTitle">',n&&(p+='<a class="link" href="'+n+'" target="_blank">'),p+=l,n&&(p+="</a>"),p+="</div>",p+='<div style="" class="olLayerGeoRSSDescription">',p+=m,p+="</div>",j.popupContentHTML=p}var k=new OpenLayers.Feature(this,o,j);this.features.push(k);var q=k.createMarker();q.events.register("click",k,this.markerClick),this.addMarker(q)}}this.events.triggerEvent("loadend")},markerClick:function(a){var b=this==this.layer.selectedFeature;this.layer.selectedFeature=b?null:this;for(var c=0,d=this.layer.map.popups.length;d>c;c++)this.layer.map.removePopup(this.layer.map.popups[c]);if(!b){var e=this.createPopup();OpenLayers.Event.observe(e.div,"click",OpenLayers.Function.bind(function(){for(var a=0,b=this.layer.map.popups.length;b>a;a++)this.layer.map.removePopup(this.layer.map.popups[a])},this)),this.layer.map.addPopup(e)}OpenLayers.Event.stop(a)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a),a.destroy()}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"}),OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"}),OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"}),OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"}),OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c={namedLayers:b.namedLayersAsArray===!0?[]:{}};return this.readChildNodes(a,c),c},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version"),this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(a,b){var c={userStyles:[],namedStyles:[]};this.readChildNodes(a,c);for(var d=0,e=c.userStyles.length;e>d;++d)c.userStyles[d].layerName=c.name;OpenLayers.Util.isArray(b.namedLayers)?b.namedLayers.push(c):b.namedLayers[c.name]=c},NamedStyle:function(a,b){b.namedStyles.push(this.getChildName(a.firstChild))},UserStyle:function(a,b){var c={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1,this.readChildNodes(a,c);var d;this.multipleSymbolizers?(delete c.defaultsPerSymbolizer,d=new OpenLayers.Style2(c)):d=new OpenLayers.Style(this.defaultSymbolizer,c),b.userStyles.push(d)},IsDefault:function(a,b){"1"==this.getChildValue(a)&&(b.isDefault=!0)},FeatureTypeStyle:function(a,b){++this.featureTypeCounter;var c={rules:this.multipleSymbolizers?b.rules:[]};this.readChildNodes(a,c),this.multipleSymbolizers||(b.rules=c.rules)},Rule:function(a,b){var c;this.multipleSymbolizers&&(c={symbolizers:[]});var d=new OpenLayers.Rule(c);this.readChildNodes(a,d),b.rules.push(d)},ElseFilter:function(a,b){b.elseFilter=!0},MinScaleDenominator:function(a,b){b.minScaleDenominator=parseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},TextSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Text(c))):b.symbolizer.Text=OpenLayers.Util.applyDefaults(c,b.symbolizer.Text)},LabelPlacement:function(a,b){this.readChildNodes(a,b)},PointPlacement:function(a,b){var c={};this.readChildNodes(a,c),c.labelRotation=c.rotation,delete c.rotation;var d,e=b.labelAnchorPointX,f=b.labelAnchorPointY;1/3>=e?d="l":e>1/3&&2/3>e?d="c":e>=2/3&&(d="r"),1/3>=f?d+="b":f>1/3&&2/3>f?d+="m":f>=2/3&&(d+="t"),c.labelAlign=d,OpenLayers.Util.applyDefaults(b,c)},AnchorPoint:function(a,b){this.readChildNodes(a,b)},AnchorPointX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointX=c)},AnchorPointY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointY=c)},Displacement:function(a,b){this.readChildNodes(a,b)},DisplacementX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelXOffset=c)},DisplacementY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelYOffset=c)},LinePlacement:function(a,b){this.readChildNodes(a,b)},PerpendicularOffset:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelPerpendicularOffset=c)},Label:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.label=c)},Font:function(a,b){this.readChildNodes(a,b)},Halo:function(a,b){var c={};this.readChildNodes(a,c),b.haloRadius=c.haloRadius,b.haloColor=c.fillColor,b.haloOpacity=c.fillOpacity},Radius:function(a,b){var c=this.readers.ogc._expression.call(this,a);null!=c&&(b.haloRadius=c)},RasterSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Raster(c))):b.symbolizer.Raster=OpenLayers.Util.applyDefaults(c,b.symbolizer.Raster)},Geometry:function(a,b){b.geometry={},this.readChildNodes(a,b.geometry)},ColorMap:function(a,b){b.colorMap=[],this.readChildNodes(a,b.colorMap)},ColorMapEntry:function(a,b){var c=a.getAttribute("quantity"),d=a.getAttribute("opacity");b.push({color:a.getAttribute("color"),quantity:null!==c?parseFloat(c):void 0,label:a.getAttribute("label")||void 0,opacity:null!==d?parseFloat(d):void 0})},LineSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Line(c))):b.symbolizer.Line=OpenLayers.Util.applyDefaults(c,b.symbolizer.Line)},PolygonSymbolizer:function(a,b){var c={fill:!1,stroke:!1};this.multipleSymbolizers||(c=b.symbolizer.Polygon||c),this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Polygon(c))):b.symbolizer.Polygon=c},PointSymbolizer:function(a,b){var c={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(c=b.symbolizer.Point||c),this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Point(c))):b.symbolizer.Point=c},Stroke:function(a,b){b.stroke=!0,this.readChildNodes(a,b)},Fill:function(a,b){b.fill=!0,this.readChildNodes(a,b)},CssParameter:function(a,b){var c=a.getAttribute("name"),d=this.cssMap[c];if(b.label&&("fill"===c?d="fontColor":"fill-opacity"===c&&(d="fontOpacity")),d){var e=this.readers.ogc._expression.call(this,a);e&&(b[d]=e)}},Graphic:function(a,b){b.graphic=!0;var c={};this.readChildNodes(a,c);for(var d,e,f=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"],g=0,h=f.length;h>g;++g)d=f[g],e=c[d],void 0!=e&&(b[d]=e);if(void 0!=c.opacity&&(b.graphicOpacity=c.opacity),void 0!=c.size){var i=c.size/2;isNaN(i)?b.graphicWidth=c.size:b.pointRadius=c.size/2}void 0!=c.href&&(b.externalGraphic=c.href),void 0!=c.rotation&&(b.rotation=c.rotation)},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.opacity=c)},Size:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.size=c)},Rotation:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.rotation=c)},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(a){var b=null;for(var c in this.cssMap)if(this.cssMap[c]==a){b=c;break}return b},getGraphicFormat:function(a){var b;for(var c in this.graphicFormats)if(this.graphicFormats[c].test(a)){b=c;break}return b||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(a,b){var c=this.createElementNSPlus(a),d="string"==typeof b?b.split("${"):[b];c.appendChild(this.createTextNode(d[0]));for(var e,f,g=1,h=d.length;h>g;g++)e=d[g],f=e.indexOf("}"),f>0?(this.writeNode("ogc:PropertyName",{property:e.substring(0,f)},c),c.appendChild(this.createTextNode(e.substring(++f)))):c.appendChild(this.createTextNode("${"+e));return c},StyledLayerDescriptor:function(a){var b=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});if(b.setAttribute("xmlns:ogc",this.namespaces.ogc),b.setAttribute("xmlns:gml",this.namespaces.gml),a.name&&this.writeNode("Name",a.name,b),a.title&&this.writeNode("Title",a.title,b),a.description&&this.writeNode("Abstract",a.description,b),OpenLayers.Util.isArray(a.namedLayers))for(var c=0,d=a.namedLayers.length;d>c;++c)this.writeNode("NamedLayer",a.namedLayers[c],b);else for(var e in a.namedLayers)this.writeNode("NamedLayer",a.namedLayers[e],b);return b},Name:function(a){return this.createElementNSPlus("sld:Name",{value:a})},Title:function(a){return this.createElementNSPlus("sld:Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("sld:Abstract",{value:a})},NamedLayer:function(a){var b=this.createElementNSPlus("sld:NamedLayer");if(this.writeNode("Name",a.name,b),a.namedStyles)for(var c=0,d=a.namedStyles.length;d>c;++c)this.writeNode("NamedStyle",a.namedStyles[c],b);if(a.userStyles)for(var c=0,d=a.userStyles.length;d>c;++c)this.writeNode("UserStyle",a.userStyles[c],b);return b},NamedStyle:function(a){var b=this.createElementNSPlus("sld:NamedStyle");return this.writeNode("Name",a,b),b},UserStyle:function(a){var b=this.createElementNSPlus("sld:UserStyle");if(a.name&&this.writeNode("Name",a.name,b),a.title&&this.writeNode("Title",a.title,b),a.description&&this.writeNode("Abstract",a.description,b),a.isDefault&&this.writeNode("IsDefault",a.isDefault,b),this.multipleSymbolizers&&a.rules){for(var c,d,e,f,g,h={0:[]},i=[0],j=0,k=a.rules.length;k>j;++j)if(c=a.rules[j],c.symbolizers){d={};for(var l=0,m=c.symbolizers.length;m>l;++l)e=c.symbolizers[l],f=e.zIndex,f in d||(g=c.clone(),g.symbolizers=[],d[f]=g),d[f].symbolizers.push(e.clone());for(f in d)f in h||(i.push(f),h[f]=[]),h[f].push(d[f])}else h[0].push(c.clone());i.sort();for(var n,j=0,k=i.length;k>j;++j)n=h[i[j]],n.length>0&&(g=a.clone(),g.rules=h[i[j]],this.writeNode("FeatureTypeStyle",g,b))}else this.writeNode("FeatureTypeStyle",a,b);return b},IsDefault:function(a){return this.createElementNSPlus("sld:IsDefault",{value:a?"1":"0"})},FeatureTypeStyle:function(a){for(var b=this.createElementNSPlus("sld:FeatureTypeStyle"),c=0,d=a.rules.length;d>c;++c)this.writeNode("Rule",a.rules[c],b);return b},Rule:function(a){var b=this.createElementNSPlus("sld:Rule");a.name&&this.writeNode("Name",a.name,b),a.title&&this.writeNode("Title",a.title,b),a.description&&this.writeNode("Abstract",a.description,b),a.elseFilter?this.writeNode("ElseFilter",null,b):a.filter&&this.writeNode("ogc:Filter",a.filter,b),void 0!=a.minScaleDenominator&&this.writeNode("MinScaleDenominator",a.minScaleDenominator,b),void 0!=a.maxScaleDenominator&&this.writeNode("MaxScaleDenominator",a.maxScaleDenominator,b);var c,d;if(this.multipleSymbolizers&&a.symbolizers)for(var d,e=0,f=a.symbolizers.length;f>e;++e)d=a.symbolizers[e],c=d.CLASS_NAME.split(".").pop(),this.writeNode(c+"Symbolizer",d,b);else for(var g=OpenLayers.Style.SYMBOLIZER_PREFIXES,e=0,h=g.length;h>e;++e)c=g[e],d=a.symbolizer[c],d&&this.writeNode(c+"Symbolizer",d,b);return b},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(a){return this.createElementNSPlus("sld:MinScaleDenominator",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus("sld:LineSymbolizer");return this.writeNode("Stroke",a,b),b},Stroke:function(a){var b=this.createElementNSPlus("sld:Stroke");return void 0!=a.strokeColor&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeColor"},b),void 0!=a.strokeOpacity&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeOpacity"},b),void 0!=a.strokeWidth&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeWidth"},b),void 0!=a.strokeDashstyle&&"solid"!==a.strokeDashstyle&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeDashstyle"},b),void 0!=a.strokeLinecap&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeLinecap"},b),b},CssParameter:function(a){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(a.key)},value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus("sld:TextSymbolizer");return null!=a.label&&this.writeNode("Label",a.label,b),(null!=a.fontFamily||null!=a.fontSize||null!=a.fontWeight||null!=a.fontStyle)&&this.writeNode("Font",a,b),(null!=a.labelAnchorPointX||null!=a.labelAnchorPointY||null!=a.labelAlign||null!=a.labelXOffset||null!=a.labelYOffset||null!=a.labelRotation||null!=a.labelPerpendicularOffset)&&this.writeNode("LabelPlacement",a,b),(null!=a.haloRadius||null!=a.haloColor||null!=a.haloOpacity)&&this.writeNode("Halo",a,b),(null!=a.fontColor||null!=a.fontOpacity)&&this.writeNode("Fill",{fillColor:a.fontColor,fillOpacity:a.fontOpacity},b),b},LabelPlacement:function(a){var b=this.createElementNSPlus("sld:LabelPlacement");return null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign&&null==a.labelXOffset&&null==a.labelYOffset&&null==a.labelRotation||null!=a.labelPerpendicularOffset||this.writeNode("PointPlacement",a,b),null!=a.labelPerpendicularOffset&&this.writeNode("LinePlacement",a,b),b},LinePlacement:function(a){var b=this.createElementNSPlus("sld:LinePlacement");return this.writeNode("PerpendicularOffset",a.labelPerpendicularOffset,b),b},PerpendicularOffset:function(a){return this.createElementNSPlus("sld:PerpendicularOffset",{value:a})},PointPlacement:function(a){var b=this.createElementNSPlus("sld:PointPlacement");return(null!=a.labelAnchorPointX||null!=a.labelAnchorPointY||null!=a.labelAlign)&&this.writeNode("AnchorPoint",a,b),(null!=a.labelXOffset||null!=a.labelYOffset)&&this.writeNode("Displacement",a,b),null!=a.labelRotation&&this.writeNode("Rotation",a.labelRotation,b),b},AnchorPoint:function(a){var b=this.createElementNSPlus("sld:AnchorPoint"),c=a.labelAnchorPointX,d=a.labelAnchorPointY;if(null!=c&&this.writeNode("AnchorPointX",c,b),null!=d&&this.writeNode("AnchorPointY",d,b),null==c&&null==d){var e=a.labelAlign.substr(0,1),f=a.labelAlign.substr(1,1);"l"===e?c=0:"c"===e?c=.5:"r"===e&&(c=1),"b"===f?d=0:"m"===f?d=.5:"t"===f&&(d=1),this.writeNode("AnchorPointX",c,b),this.writeNode("AnchorPointY",d,b)}return b},AnchorPointX:function(a){return this.createElementNSPlus("sld:AnchorPointX",{value:a})},AnchorPointY:function(a){return this.createElementNSPlus("sld:AnchorPointY",{value:a})},Displacement:function(a){var b=this.createElementNSPlus("sld:Displacement");return null!=a.labelXOffset&&this.writeNode("DisplacementX",a.labelXOffset,b),null!=a.labelYOffset&&this.writeNode("DisplacementY",a.labelYOffset,b),b},DisplacementX:function(a){return this.createElementNSPlus("sld:DisplacementX",{value:a})},DisplacementY:function(a){return this.createElementNSPlus("sld:DisplacementY",{value:a})},Font:function(a){var b=this.createElementNSPlus("sld:Font");return a.fontFamily&&this.writeNode("CssParameter",{symbolizer:a,key:"fontFamily"},b),a.fontSize&&this.writeNode("CssParameter",{symbolizer:a,key:"fontSize"},b),a.fontWeight&&this.writeNode("CssParameter",{symbolizer:a,key:"fontWeight"},b),a.fontStyle&&this.writeNode("CssParameter",{symbolizer:a,key:"fontStyle"},b),b},Label:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Label",a)},Halo:function(a){var b=this.createElementNSPlus("sld:Halo");return a.haloRadius&&this.writeNode("Radius",a.haloRadius,b),(a.haloColor||a.haloOpacity)&&this.writeNode("Fill",{fillColor:a.haloColor,fillOpacity:a.haloOpacity},b),b},Radius:function(a){return this.createElementNSPlus("sld:Radius",{value:a})},RasterSymbolizer:function(a){var b=this.createElementNSPlus("sld:RasterSymbolizer");return a.geometry&&this.writeNode("Geometry",a.geometry,b),a.opacity&&this.writeNode("Opacity",a.opacity,b),a.colorMap&&this.writeNode("ColorMap",a.colorMap,b),b},Geometry:function(a){var b=this.createElementNSPlus("sld:Geometry");return a.property&&this.writeNode("ogc:PropertyName",a,b),b},ColorMap:function(a){for(var b=this.createElementNSPlus("sld:ColorMap"),c=0,d=a.length;d>c;++c)this.writeNode("ColorMapEntry",a[c],b);return b},ColorMapEntry:function(a){var b=this.createElementNSPlus("sld:ColorMapEntry"),c=a;return b.setAttribute("color",c.color),void 0!==c.opacity&&b.setAttribute("opacity",parseFloat(c.opacity)),void 0!==c.quantity&&b.setAttribute("quantity",parseFloat(c.quantity)),void 0!==c.label&&b.setAttribute("label",c.label),b},PolygonSymbolizer:function(a){var b=this.createElementNSPlus("sld:PolygonSymbolizer");return a.fill!==!1&&this.writeNode("Fill",a,b),a.stroke!==!1&&this.writeNode("Stroke",a,b),b},Fill:function(a){var b=this.createElementNSPlus("sld:Fill");return a.fillColor&&this.writeNode("CssParameter",{symbolizer:a,key:"fillColor"},b),null!=a.fillOpacity&&this.writeNode("CssParameter",{symbolizer:a,key:"fillOpacity"},b),b},PointSymbolizer:function(a){var b=this.createElementNSPlus("sld:PointSymbolizer");return this.writeNode("Graphic",a,b),b},Graphic:function(a){var b=this.createElementNSPlus("sld:Graphic");return void 0!=a.externalGraphic?this.writeNode("ExternalGraphic",a,b):this.writeNode("Mark",a,b),void 0!=a.graphicOpacity&&this.writeNode("Opacity",a.graphicOpacity,b),void 0!=a.pointRadius?this.writeNode("Size",2*a.pointRadius,b):void 0!=a.graphicWidth&&this.writeNode("Size",a.graphicWidth,b),void 0!=a.rotation&&this.writeNode("Rotation",a.rotation,b),b},ExternalGraphic:function(a){var b=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",a.externalGraphic,b);var c=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);return this.writeNode("Format",c,b),b},Mark:function(a){var b=this.createElementNSPlus("sld:Mark");return a.graphicName&&this.writeNode("WellKnownName",a.graphicName,b),a.fill!==!1&&this.writeNode("Fill",a,b),a.stroke!==!1&&this.writeNode("Stroke",a,b),b},WellKnownName:function(a){return this.createElementNSPlus("sld:WellKnownName",{value:a})},Opacity:function(a){return this.createElementNSPlus("sld:Opacity",{value:a})},Size:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Size",a)},Rotation:function(a){return this.createElementNSPlus("sld:Rotation",{value:a})},OnlineResource:function(a){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":a}})},Format:function(a){return this.createElementNSPlus("sld:Format",{value:a})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"}),OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c),parseFloat(c.VERSION)>=1.3&&!c.EXCEPTIONS&&(c.EXCEPTIONS="INIMAGE"),e.push(a,b,c,d),OpenLayers.Layer.Grid.prototype.initialize.apply(this,e),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},reverseAxisOrder:function(){var a=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[a]||OpenLayers.Projection.defaults[a]&&OpenLayers.Projection.defaults[a].yx)},getURL:function(a){a=this.adjustBounds(a);var b=this.getImageSize(),c={},d=this.reverseAxisOrder();c.BBOX=this.encodeBBOX?a.toBBOX(null,d):a.toArray(d),c.WIDTH=b.w,c.HEIGHT=b.h;var e=this.getFullRequestString(c);return e},mergeNewParams:function(a){var b=OpenLayers.Util.upperCaseObject(a),c=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,c)},getFullRequestString:function(a){var b=this.map.getProjectionObject(),c=this.projection&&this.projection.equals(b)?this.projection.getCode():b.getCode(),d="none"==c?null:c;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=d:this.params.SRS=d,"boolean"==typeof this.params.TRANSPARENT&&(a.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"}),OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(a){a=this.adjustBounds(a);var b=this.map.getResolution(),c=Math.round(1e4*this.map.getScale())/1e4,d=Math.round(a.left/b),e=-Math.round(a.top/b);return this.getFullRequestString({t:e,l:d,s:c})},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w,e=c*this.tileSize.h,f=a.left,g=Math.floor(f/d)-this.buffer,h=a.top,i=Math.floor(h/e)+this.buffer;return{tilelon:d,tilelat:e,startcol:g,startrow:i}},getTileBoundsForGridIndex:function(a,b){var c=(this.getTileOrigin(),this.gridLayout),d=c.tilelon,e=c.tilelat,f=(c.startcol+b)*d,g=(c.startrow-a)*e;return new OpenLayers.Bounds(f,g,f+d,g+e)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]),null!=this.tileSize&&(a.tileSize=this.tileSize.clone()),a.grid=[],a},getTileBounds:function(a){var b=this.getResolution(),c=b*this.tileSize.w,d=b*this.tileSize.h,e=this.getLonLatFromViewPortPx(a),f=c*Math.floor(e.lon/c),g=d*Math.floor(e.lat/d);return new OpenLayers.Bounds(f,g,f+c,g+d)},CLASS_NAME:"OpenLayers.Layer.KaMap"}),OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_sld_MinScaleDenominator:function(a,b){var c=parseFloat(this.getChildValue(b));c>0&&(a.maxScale=c)},read_sld_MaxScaleDenominator:function(a,b){a.minScale=parseFloat(this.getChildValue(b))},read_wmc_SRS:function(a,b){"srs"in a||(a.srs={}),a.srs[this.getChildValue(b)]=!0},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);if(a.maxScale){var c=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");c.appendChild(this.createTextNode(a.maxScale.toPrecision(16))),b.appendChild(c)}if(a.minScale){var d=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");d.appendChild(this.createTextNode(a.minScale.toPrecision(16))),b.appendChild(d)}if(a.srs)for(var e in a.srs)b.appendChild(this.createElementDefaultNS("SRS",e));return b.appendChild(this.write_wmc_FormatList(a)),b.appendChild(this.write_wmc_StyleList(a)),a.dimensions&&b.appendChild(this.write_wmc_DimensionList(a)),b.appendChild(this.write_wmc_LayerExtension(a)),b},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"}),OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"}),OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},xy:!0,defaultPrefix:"xls",schemaLocation:null,read:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c={};return this.readChildNodes(a,c),c},readers:{xls:{XLS:function(a,b){b.version=a.getAttribute("version"),this.readChildNodes(a,b)},Response:function(a,b){this.readChildNodes(a,b)},GeocodeResponse:function(a,b){b.responseLists=[],this.readChildNodes(a,b)},GeocodeResponseList:function(a,b){var c={features:[],numberOfGeocodedAddresses:parseInt(a.getAttribute("numberOfGeocodedAddresses"))};b.responseLists.push(c),this.readChildNodes(a,c)},GeocodedAddress:function(a,b){var c=new OpenLayers.Feature.Vector;b.features.push(c),this.readChildNodes(a,c),c.geometry=c.components[0]},GeocodeMatchCode:function(a,b){b.attributes.matchCode={accuracy:parseFloat(a.getAttribute("accuracy")),matchType:a.getAttribute("matchType")}},Address:function(a,b){var c={countryCode:a.getAttribute("countryCode"),addressee:a.getAttribute("addressee"),street:[],place:[]};b.attributes.address=c,this.readChildNodes(a,c)},freeFormAddress:function(a,b){b.freeFormAddress=this.getChildValue(a)},StreetAddress:function(a,b){this.readChildNodes(a,b)},Building:function(a,b){b.building={number:a.getAttribute("number"),subdivision:a.getAttribute("subdivision"),buildingName:a.getAttribute("buildingName")}},Street:function(a,b){b.street.push(this.getChildValue(a))},Place:function(a,b){b.place[a.getAttribute("type")]=this.getChildValue(a)
},PostalCode:function(a,b){b.postalCode=this.getChildValue(a)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(a){return this.writers.xls.XLS.apply(this,[a])},writers:{xls:{XLS:function(a){var b=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});return this.writeNode("RequestHeader",a.header,b),this.writeNode("Request",a,b),b},RequestHeader:function(){return this.createElementNSPlus("xls:RequestHeader")},Request:function(a){var b=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:a.requestID||"",version:this.VERSION}});return this.writeNode("GeocodeRequest",a.addresses,b),b},GeocodeRequest:function(a){for(var b=this.createElementNSPlus("xls:GeocodeRequest"),c=0,d=a.length;d>c;c++)this.writeNode("Address",a[c],b);return b},Address:function(a){var b=this.createElementNSPlus("xls:Address",{attributes:{countryCode:a.countryCode}});return a.freeFormAddress?this.writeNode("freeFormAddress",a.freeFormAddress,b):(a.street&&this.writeNode("StreetAddress",a,b),a.municipality&&this.writeNode("Municipality",a.municipality,b),a.countrySubdivision&&this.writeNode("CountrySubdivision",a.countrySubdivision,b),a.postalCode&&this.writeNode("PostalCode",a.postalCode,b)),b},freeFormAddress:function(a){return this.createElementNSPlus("freeFormAddress",{value:a})},StreetAddress:function(a){var b=this.createElementNSPlus("xls:StreetAddress");a.building&&this.writeNode(b,"Building",a.building);var c=a.street;OpenLayers.Util.isArray(c)||(c=[c]);for(var d=0,e=c.length;e>d;d++)this.writeNode("Street",c[d],b);return b},Building:function(a){return this.createElementNSPlus("xls:Building",{attributes:{number:a.number,subdivision:a.subdivision,buildingName:a.buildingName}})},Street:function(a){return this.createElementNSPlus("xls:Street",{value:a})},Municipality:function(a){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:a})},CountrySubdivision:function(a){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:a})},PostalCode:function(a){return this.createElementNSPlus("xls:PostalCode",{value:a})}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"}),OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"}),OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0,OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1"))},inValidRange:function(a,b,c){var d=a+(c?0:this.translationParameters.x),e=b+(c?0:this.translationParameters.y);return d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL&&e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=-a.left/d,f=a.top/d;if(b){this.left=e,this.top=f;var g="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",g),this.translate(this.xOffset,0),!0}var h=this.translate(e-this.left+this.xOffset,f-this.top);return h||this.setExtent(a,!0),c&&h},translate:function(a,b){if(this.inValidRange(a,b,!0)){var c="";return(a||b)&&(c="translate("+a+","+b+")"),this.root.setAttributeNS(null,"transform",c),this.translationParameters={x:a,y:b},!0}return!1},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":c=b.externalGraphic?"image":this.isComplexSymbol(b.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":c="rect";break;case"OpenLayers.Geometry.LineString":c="polyline";break;case"OpenLayers.Geometry.LinearRing":c="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":c="path"}return c},setStyle:function(a,b,c){b=b||a._style,c=c||a._options;var d=b.title||b.graphicTitle;if(d){a.setAttributeNS(null,"title",d);var e=a.getElementsByTagName("title");if(e.length>0)e[0].firstChild.textContent=d;else{var f=this.nodeFactory(null,"title");f.textContent=d,a.appendChild(f)}}var g,h=parseFloat(a.getAttributeNS(null,"r")),i=1;if("OpenLayers.Geometry.Point"==a._geometryClass&&h){if(a.style.visibility="",b.graphic===!1)a.style.visibility="hidden";else if(b.externalGraphic){g=this.getPosition(a),b.graphicWidth&&b.graphicHeight&&a.setAttributeNS(null,"preserveAspectRatio","none");var j=b.graphicWidth||b.graphicHeight,k=b.graphicHeight||b.graphicWidth;j=j?j:2*b.pointRadius,k=k?k:2*b.pointRadius;var l=void 0!=b.graphicXOffset?b.graphicXOffset:-(.5*j),m=void 0!=b.graphicYOffset?b.graphicYOffset:-(.5*k),n=b.graphicOpacity||b.fillOpacity;a.setAttributeNS(null,"x",(g.x+l).toFixed()),a.setAttributeNS(null,"y",(g.y+m).toFixed()),a.setAttributeNS(null,"width",j),a.setAttributeNS(null,"height",k),a.setAttributeNS(this.xlinkns,"xlink:href",b.externalGraphic),a.setAttributeNS(null,"style","opacity: "+n),a.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(b.graphicName)){var o=3*b.pointRadius,p=2*o,q=this.importSymbol(b.graphicName);g=this.getPosition(a),i=3*this.symbolMetrics[q.id][0]/p;var r=a.parentNode,s=a.nextSibling;r&&r.removeChild(a),a.firstChild&&a.removeChild(a.firstChild),a.appendChild(q.firstChild.cloneNode(!0)),a.setAttributeNS(null,"viewBox",q.getAttributeNS(null,"viewBox")),a.setAttributeNS(null,"width",p),a.setAttributeNS(null,"height",p),a.setAttributeNS(null,"x",g.x-o),a.setAttributeNS(null,"y",g.y-o),s?r.insertBefore(a,s):r&&r.appendChild(a)}else a.setAttributeNS(null,"r",b.pointRadius);var t=b.rotation;if((void 0!==t||void 0!==a._rotation)&&g)if(a._rotation=t,t|=0,"svg"!==a.nodeName)a.setAttributeNS(null,"transform","rotate("+t+" "+g.x+" "+g.y+")");else{var u=this.symbolMetrics[q.id];a.firstChild.setAttributeNS(null,"transform","rotate("+t+" "+u[1]+" "+u[2]+")")}}return c.isFilled?(a.setAttributeNS(null,"fill",b.fillColor),a.setAttributeNS(null,"fill-opacity",b.fillOpacity)):a.setAttributeNS(null,"fill","none"),c.isStroked?(a.setAttributeNS(null,"stroke",b.strokeColor),a.setAttributeNS(null,"stroke-opacity",b.strokeOpacity),a.setAttributeNS(null,"stroke-width",b.strokeWidth*i),a.setAttributeNS(null,"stroke-linecap",b.strokeLinecap||"round"),a.setAttributeNS(null,"stroke-linejoin","round"),b.strokeDashstyle&&a.setAttributeNS(null,"stroke-dasharray",this.dashStyle(b,i))):a.setAttributeNS(null,"stroke","none"),b.pointerEvents&&a.setAttributeNS(null,"pointer-events",b.pointerEvents),null!=b.cursor&&a.setAttributeNS(null,"cursor",b.cursor),a},dashStyle:function(a,b){var c=a.strokeWidth*b,d=a.strokeDashstyle;switch(d){case"solid":return"none";case"dot":return[1,4*c].join();case"dash":return[4*c,4*c].join();case"dashdot":return[4*c,4*c,1,4*c].join();case"longdash":return[8*c,4*c].join();case"longdashdot":return[8*c,4*c,1,4*c].join();default:return OpenLayers.String.trim(d).replace(/\s+/g,",")}},createNode:function(a,b){var c=document.createElementNS(this.xmlns,a);return b&&c.setAttributeNS(null,"id",b),c},nodeTypeCompare:function(a,b){return b==a.nodeName},createRenderRoot:function(){var a=this.nodeFactory(this.container.id+"_svgRoot","svg");return a.style.display="block",a},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(a),a},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){var d=this.getResolution(),e=(b.x-this.featureDx)/d+this.left,f=this.top-b.y/d;return this.inValidRange(e,f)?(a.setAttributeNS(null,"cx",e),a.setAttributeNS(null,"cy",f),a.setAttributeNS(null,"r",c),a):!1},drawLineString:function(a,b){var c=this.getComponentsString(b.components);return c.path?(a.setAttributeNS(null,"points",c.path),c.complete?a:null):!1},drawLinearRing:function(a,b){var c=this.getComponentsString(b.components);return c.path?(a.setAttributeNS(null,"points",c.path),c.complete?a:null):!1},drawPolygon:function(a,b){for(var c,d,e="",f=!0,g=!0,h=0,i=b.components.length;i>h;h++)e+=" M",c=this.getComponentsString(b.components[h].components," "),d=c.path,d?(e+=" "+d,g=c.complete&&g):f=!1;return e+=" z",f?(a.setAttributeNS(null,"d",e),a.setAttributeNS(null,"fill-rule","evenodd"),g?a:null):!1},drawRectangle:function(a,b){var c=this.getResolution(),d=(b.x-this.featureDx)/c+this.left,e=this.top-b.y/c;return this.inValidRange(d,e)?(a.setAttributeNS(null,"x",d),a.setAttributeNS(null,"y",e),a.setAttributeNS(null,"width",b.width/c),a.setAttributeNS(null,"height",b.height/c),a):!1},drawText:function(a,b,c){var d=!!b.labelOutlineWidth;if(d){var e=OpenLayers.Util.extend({},b);e.fontColor=e.labelOutlineColor,e.fontStrokeColor=e.labelOutlineColor,e.fontStrokeWidth=b.labelOutlineWidth,b.labelOutlineOpacity&&(e.fontOpacity=b.labelOutlineOpacity),delete e.labelOutlineWidth,this.drawText(a,e,c)}var f=this.getResolution(),g=(c.x-this.featureDx)/f+this.left,h=c.y/f-this.top,i=d?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,j=this.nodeFactory(a+i,"text");j.setAttributeNS(null,"x",g),j.setAttributeNS(null,"y",-h),b.fontColor&&j.setAttributeNS(null,"fill",b.fontColor),b.fontStrokeColor&&j.setAttributeNS(null,"stroke",b.fontStrokeColor),b.fontStrokeWidth&&j.setAttributeNS(null,"stroke-width",b.fontStrokeWidth),b.fontOpacity&&j.setAttributeNS(null,"opacity",b.fontOpacity),b.fontFamily&&j.setAttributeNS(null,"font-family",b.fontFamily),b.fontSize&&j.setAttributeNS(null,"font-size",b.fontSize),b.fontWeight&&j.setAttributeNS(null,"font-weight",b.fontWeight),b.fontStyle&&j.setAttributeNS(null,"font-style",b.fontStyle),b.labelSelect===!0?(j.setAttributeNS(null,"pointer-events","visible"),j._featureId=a):j.setAttributeNS(null,"pointer-events","none");var k=b.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;j.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[k[0]]||"middle"),OpenLayers.IS_GECKO===!0&&j.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[k[1]]||"central");for(var l=b.label.split("\n"),m=l.length;j.childNodes.length>m;)j.removeChild(j.lastChild);for(var n=0;m>n;n++){var o=this.nodeFactory(a+i+"_tspan_"+n,"tspan");if(b.labelSelect===!0&&(o._featureId=a,o._geometry=c,o._geometryClass=c.CLASS_NAME),OpenLayers.IS_GECKO===!1&&o.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[k[1]]||"-35%"),o.setAttribute("x",g),0==n){var p=OpenLayers.Renderer.SVG.LABEL_VFACTOR[k[1]];null==p&&(p=-.5),o.setAttribute("dy",p*(m-1)+"em")}else o.setAttribute("dy","1em");o.textContent=""===l[n]?" ":l[n],o.parentNode||j.appendChild(o)}j.parentNode||this.textRoot.appendChild(j)},getComponentsString:function(a,b){for(var c,d,e=[],f=!0,g=a.length,h=[],i=0;g>i;i++)d=a[i],e.push(d),c=this.getShortString(d),c?h.push(c):(i>0&&this.getShortString(a[i-1])&&h.push(this.clipLine(a[i],a[i-1])),g-1>i&&this.getShortString(a[i+1])&&h.push(this.clipLine(a[i],a[i+1])),f=!1);return{path:h.join(b||","),complete:f}},clipLine:function(a,b){if(b.equals(a))return"";var c,d=this.getResolution(),e=this.MAX_PIXEL-this.translationParameters.x,f=this.MAX_PIXEL-this.translationParameters.y,g=(b.x-this.featureDx)/d+this.left,h=this.top-b.y/d,i=(a.x-this.featureDx)/d+this.left,j=this.top-a.y/d;return(-e>i||i>e)&&(c=(j-h)/(i-g),i=0>i?-e:e,j=h+(i-g)*c),(-f>j||j>f)&&(c=(i-g)/(j-h),j=0>j?-f:f,i=g+(j-h)*c),i+","+j},getShortString:function(a){var b=this.getResolution(),c=(a.x-this.featureDx)/b+this.left,d=this.top-a.y/b;return this.inValidRange(c,d)?c+","+d:!1},getPosition:function(a){return{x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))}},importSymbol:function(a){this.defs||(this.defs=this.createDefs());var b=this.container.id+"-"+a,c=document.getElementById(b);if(null!=c)return c;var d=OpenLayers.Renderer.symbol[a];if(!d)throw new Error(a+" is not a valid symbol name");var e=this.nodeFactory(b,"symbol"),f=this.nodeFactory(null,"polygon");e.appendChild(f);for(var g,h,i=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),j=[],k=0;k<d.length;k+=2)g=d[k],h=d[k+1],i.left=Math.min(i.left,g),i.bottom=Math.min(i.bottom,h),i.right=Math.max(i.right,g),i.top=Math.max(i.top,h),j.push(g,",",h);f.setAttributeNS(null,"points",j.join(" "));var l=i.getWidth(),m=i.getHeight(),n=[i.left-l,i.bottom-m,3*l,3*m];return e.setAttributeNS(null,"viewBox",n.join(" ")),this.symbolMetrics[b]=[Math.max(l,m),i.getCenterLonLat().lon,i.getCenterLonLat().lat],this.defs.appendChild(e),e},getFeatureIdFromEvent:function(a){var b=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!b){var c=a.target;b=c.parentNode&&c!=this.rendererRoot?c.parentNode._featureId:void 0}return b},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(a){OpenLayers.Event.preventDefault(a)},OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"}),OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(){var a=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);return"0.3.0"===a&&(a=this.defaultVersion),a},toContext:function(a){var b={};return"OpenLayers.Map"==a.CLASS_NAME&&(b.bounds=a.getExtent(),b.maxExtent=a.maxExtent,b.projection=a.projection,b.size=a.getSize(),b.layers=a.layers),b},CLASS_NAME:"OpenLayers.Format.OWSContext"}),OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(a){if(a.layersContext)for(var b=0,c=a.layersContext.length;c>b;b++){var d=a.layersContext[b],e=[],f=a.title||"";a.metadata&&a.metadata.nestingPath&&(e=a.metadata.nestingPath.slice()),""!=f&&e.push(f),d.metadata.nestingPath=e,d.layersContext&&this.setNestingPath(d)}},decomposeNestingPath:function(a){var b=[];if(OpenLayers.Util.isArray(a)){for(var c=a.slice();c.length>0;)b.push(c.slice()),c.pop();b.reverse()}return b},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b),this.setNestingPath({layersContext:b.layersContext});var c=[];return this.processLayer(c,b),delete b.layersContext,b.layersContext=c,b},processLayer:function(a,b){if(b.layersContext)for(var c=0,d=b.layersContext.length;d>c;c++){var e=b.layersContext[c];a.push(e),e.layersContext&&this.processLayer(a,e)}},write:function(a,b){var c="OWSContext";this.nestingLayerLookup={},b=b||{},OpenLayers.Util.applyDefaults(b,a);var d=this.writeNode(c,b);return this.nestingLayerLookup=null,this.setAttributeNS(d,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[d])},readers:{kml:{Document:function(a,b){b.features=new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0}).read(a)}},owc:{OWSContext:function(a,b){this.readChildNodes(a,b)},General:function(a,b){this.readChildNodes(a,b)},ResourceList:function(a,b){this.readChildNodes(a,b)},Layer:function(a,b){var c={metadata:{},visibility:"1"!=a.getAttribute("hidden"),queryable:"1"==a.getAttribute("queryable"),opacity:null!=a.getAttribute("opacity")?parseFloat(a.getAttribute("opacity")):null,name:a.getAttribute("name"),categoryLayer:null==a.getAttribute("name"),formats:[],styles:[]};b.layersContext||(b.layersContext=[]),b.layersContext.push(c),this.readChildNodes(a,c)},InlineGeometry:function(a,b){b.features=[];var c,d=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember");if(d.length>=1&&(c=d[0]),c&&c.firstChild){var e=c.firstChild.nextSibling?c.firstChild.nextSibling:c.firstChild;this.setNamespace("feature",e.namespaceURI),this.featureType=e.localName||e.nodeName.split(":").pop(),this.readChildNodes(a,b)}},Server:function(a,b){(!b.service&&!b.version||b.service!=OpenLayers.Format.Context.serviceTypes.WMS)&&(b.service=a.getAttribute("service"),b.version=a.getAttribute("version"),this.readChildNodes(a,b))},Name:function(a,b){b.name=this.getChildValue(a),this.readChildNodes(a,b)},Title:function(a,b){b.title=this.getChildValue(a),this.readChildNodes(a,b)},StyleList:function(a,b){this.readChildNodes(a,b.styles)},Style:function(a,b){var c={};b.push(c),this.readChildNodes(a,c)},LegendURL:function(a,b){var c={};b.legend=c,this.readChildNodes(a,c)},OnlineResource:function(a,b){b.url=this.getAttributeNS(a,this.namespaces.xlink,"href"),this.readChildNodes(a,b)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(a){var b=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:a.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});return this.writeNode("General",a,b),this.writeNode("ResourceList",a,b),b},General:function(a){var b=this.createElementNSPlus("General");return this.writeNode("ows:BoundingBox",a,b),this.writeNode("ows:Title",a.title||"OpenLayers OWSContext",b),b},ResourceList:function(a){for(var b=this.createElementNSPlus("ResourceList"),c=0,d=a.layers.length;d>c;c++){var e=a.layers[c],f=this.decomposeNestingPath(e.metadata.nestingPath);this.writeNode("_Layer",{layer:e,subPaths:f},b)}return b},Server:function(a){var b=this.createElementNSPlus("Server",{attributes:{version:a.version,service:a.service}});return this.writeNode("OnlineResource",a,b),b},OnlineResource:function(a){var b=this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":a.url}});return b},InlineGeometry:function(a){var b=this.createElementNSPlus("InlineGeometry"),c=a.getDataExtent();null!==c&&this.writeNode("gml:boundedBy",c,b);for(var d=0,e=a.features.length;e>d;d++)this.writeNode("gml:featureMember",a.features[d],b);return b},StyleList:function(a){for(var b=this.createElementNSPlus("StyleList"),c=0,d=a.length;d>c;c++)this.writeNode("Style",a[c],b);return b},Style:function(a){var b=this.createElementNSPlus("Style");return this.writeNode("Name",a,b),this.writeNode("Title",a,b),a.legend&&this.writeNode("LegendURL",a,b),b},Name:function(a){var b=this.createElementNSPlus("Name",{value:a.name});return b},Title:function(a){var b=this.createElementNSPlus("Title",{value:a.title});return b},LegendURL:function(a){var b=this.createElementNSPlus("LegendURL");return this.writeNode("OnlineResource",a.legend,b),b},_WMS:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:a.params.LAYERS,queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1",opacity:a.hasOwnProperty("opacity")?a.opacity:null}});return this.writeNode("ows:Title",a.name,b),this.writeNode("ows:OutputFormat",a.params.FORMAT,b),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:a.params.VERSION,url:a.url},b),a.metadata.styles&&a.metadata.styles.length>0&&this.writeNode("StyleList",a.metadata.styles,b),b},_Layer:function(a){var b,c,d,e;if(b=a.layer,c=a.subPaths,d=null,e=null,c.length>0){var f=c[0].join("/"),g=f.lastIndexOf("/");return d=this.nestingLayerLookup[f],e=g>0?f.substring(g+1,f.length):f,d||(d=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",e,d),this.nestingLayerLookup[f]=d),a.subPaths.shift(),this.writeNode("_Layer",a,d),d}return b instanceof OpenLayers.Layer.WMS?d=this.writeNode("_WMS",b):b instanceof OpenLayers.Layer.Vector&&(b.protocol instanceof OpenLayers.Protocol.WFS.v1?d=this.writeNode("_WFS",b):b.protocol instanceof OpenLayers.Protocol.HTTP?b.protocol.format instanceof OpenLayers.Format.GML?(b.protocol.format.version="2.1.2",d=this.writeNode("_GML",b)):b.protocol.format instanceof OpenLayers.Format.KML&&(b.protocol.format.version="2.2",d=this.writeNode("_KML",b)):(this.setNamespace("feature",this.featureNS),d=this.writeNode("_InlineGeometry",b))),b.options.maxScale&&this.writeNode("sld:MinScaleDenominator",b.options.maxScale,d),b.options.minScale&&this.writeNode("sld:MaxScaleDenominator",b.options.minScale,d),this.nestingLayerLookup[b.name]=d,d},_WFS:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:a.protocol.featurePrefix+":"+a.protocol.featureType,hidden:a.visibility?"0":"1"}});return this.writeNode("ows:Title",a.name,b),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:a.protocol.version,url:a.protocol.url},b),b},_InlineGeometry:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:a.visibility?"0":"1"}});return this.writeNode("ows:Title",a.name,b),this.writeNode("InlineGeometry",a,b),b},_GML:function(a){var b=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",a.name,b),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:a.protocol.url,version:a.protocol.format.version},b),b},_KML:function(a){var b=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",a.name,b),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:a.protocol.format.version,url:a.protocol.url},b),b}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(a){var b=this.createElementNSPlus("gml:boundedBy");return this.writeNode("gml:Box",a,b),b}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"}),OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(a,b,c,d,e,f){null==a&&(a=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=a,this.lonlat=b,this.contentSize=null!=c?c:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=d&&(this.contentHTML=d),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.className=this.displayClass;var g=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(g,null,null,null,"relative",null,"hidden");var a=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(a,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),this.div.appendChild(this.groupDiv),e&&this.addCloseBox(f),this.registerEvents()},destroy:function(){this.id=null,this.lonlat=null,this.size=null,this.contentHTML=null,this.backgroundColor=null,this.opacity=null,this.border=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.div.removeChild(this.groupDiv),this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.map=null,this.div=null,this.autoSize=null,this.minSize=null,this.maxSize=null,this.padding=null,this.panMapIfOutOfView=null},draw:function(a){return null==a&&null!=this.lonlat&&null!=this.map&&(a=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var a=document.defaultView.getComputedStyle(this.contentDiv,null),b=a.getPropertyValue("overflow");"hidden"!=b&&(this.contentDiv._oldOverflow=b,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var a=this.contentDiv._oldOverflow;a&&(this.contentDiv.style.overflow=a,this.contentDiv._oldOverflow=null)})),this.moveTo(a),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var a=this.map.getLayerPxFromLonLat(this.lonlat);a&&this.moveTo(a)}},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+"px",this.div.style.top=a.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="",this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(a){this.size=a.clone();var b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;if(this.fixPadding(),c+=this.padding.left+this.padding.right,d+=this.padding.top+this.padding.bottom,this.closeDiv){var e=parseInt(this.closeDiv.style.width);c+=e+b.right}this.size.w+=c,this.size.h+=d,"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=b.left+b.right,this.contentSize.h+=b.bottom+b.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=a.w+"px",this.contentDiv.style.height=a.h+"px")},updateSize:function(){var a="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",b=this.map?this.map.div:document.body,c=OpenLayers.Util.getRenderedDimensions(a,null,{displayClass:this.displayClass,containerElement:b}),d=this.getSafeContentSize(c),e=null;if(d.equals(c))e=c;else{var f={w:d.w<c.w?d.w:null,h:d.h<c.h?d.h:null};if(f.w&&f.h)e=d;else{var g=OpenLayers.Util.getRenderedDimensions(a,f,{displayClass:this.contentDisplayClass,containerElement:b}),h=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if("hidden"!=h&&g.equals(d)){var i=OpenLayers.Util.getScrollbarWidth();f.w?g.h+=i:g.w+=i}e=this.getSafeContentSize(g)}}this.setSize(e)},setBackgroundColor:function(a){void 0!=a&&(this.backgroundColor=a),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(a){void 0!=a&&(this.opacity=a),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(a){void 0!=a&&(this.border=a),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(a){null!=a&&(this.contentHTML=a),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var a=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},b=this.contentDiv.getElementsByTagName("img"),c=0,d=b.length;d>c;c++){var e=b[c];if(0==e.width||0==e.height){var f={popup:this,img:e};e._onImgLoad=OpenLayers.Function.bind(a,f),OpenLayers.Event.observe(e,"load",e._onImgLoad)}}},getSafeContentSize:function(a){var b=a.clone(),c=this.getContentDivPadding(),d=c.left+c.right,e=c.top+c.bottom;if(this.fixPadding(),d+=this.padding.left+this.padding.right,e+=this.padding.top+this.padding.bottom,this.closeDiv){var f=parseInt(this.closeDiv.style.width);d+=f+c.right}if(this.minSize&&(b.w=Math.max(b.w,this.minSize.w-d),b.h=Math.max(b.h,this.minSize.h-e)),this.maxSize&&(b.w=Math.min(b.w,this.maxSize.w-d),b.h=Math.min(b.h,this.maxSize.h-e)),this.map&&this.map.size){var g=0,h=0;if(this.keepInMap&&!this.panMapIfOutOfView){var i=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":g=i.x,h=this.map.size.h-i.y;break;case"tl":g=this.map.size.w-i.x,h=this.map.size.h-i.y;break;case"bl":g=this.map.size.w-i.x,h=i.y;break;case"br":g=i.x,h=i.y;break;default:g=i.x,h=this.map.size.h-i.y}}var j=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-e-h,k=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-d-g;b.w=Math.min(b.w,k),b.h=Math.min(b.h,j)}return b},getContentDivPadding:function(){var a=this._contentDivPadding;return a||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=a,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),a},addCloseBox:function(a){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px",this.closeDiv.style.top=b.top+"px",this.groupDiv.appendChild(this.closeDiv);var c=a||function(a){this.hide(),OpenLayers.Event.stop(a)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(c,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(c,this))},panIntoView:function(){var a=this.map.getSize(),b=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),c=b.clone();b.x<this.map.paddingForPopups.left?c.x=this.map.paddingForPopups.left:b.x+this.size.w>a.w-this.map.paddingForPopups.right&&(c.x=a.w-this.map.paddingForPopups.right-this.size.w),b.y<this.map.paddingForPopups.top?c.y=this.map.paddingForPopups.top:b.y+this.size.h>a.h-this.map.paddingForPopups.bottom&&(c.y=a.h-this.map.paddingForPopups.bottom-this.size.h);var d=b.x-c.x,e=b.y-c.y;this.map.pan(d,e)},registerEvents:function(){function a(a){OpenLayers.Event.stop(a,!0)}this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:a,scope:this})
},onmousedown:function(a){this.mousedown=!0,OpenLayers.Event.stop(a,!0)},onmousemove:function(a){this.mousedown&&OpenLayers.Event.stop(a,!0)},onmouseup:function(a){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(a,!0))},onclick:function(a){OpenLayers.Event.stop(a,!0)},onmouseout:function(){this.mousedown=!1},ondblclick:function(a){OpenLayers.Event.stop(a,!0)},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px",OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.eTop){this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top";{this.topInUnits.length}this.div.appendChild(this.eTop),this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible"}return this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(a){var b,c=parseInt(Math.log(a)/Math.log(10)),d=Math.pow(10,c),e=parseInt(a/d);return b=e>5?5:e>2?2:1,b*d},update:function(){var a=this.map.getResolution();if(a){var b=this.map.getUnits(),c=OpenLayers.INCHES_PER_UNIT,d=this.maxWidth*a*c[b],e=1;if(this.geodesic===!0){var f=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,g=d/c.km;e=f/g,d*=e}var h,i;d>1e5?(h=this.topOutUnits,i=this.bottomOutUnits):(h=this.topInUnits,i=this.bottomInUnits);var j=d/c[h],k=d/c[i],l=this.getBarLen(j),m=this.getBarLen(k);j=l/c[b]*c[h],k=m/c[b]*c[i];var n=j/a/e,o=k/a/e;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(o)+"px",this.eBottom.innerHTML=m+" "+i),"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(n)+"px",this.eTop.innerHTML=l+" "+h)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"}),OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,c,d){this.url=a,this.size=b||{w:20,h:20},this.offset=c||{x:-(this.size.w/2),y:-(this.size.h/2)},this.calculateOffset=d;var e=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(e)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(a){null!=a&&(this.size=a),this.draw()},setUrl:function(a){null!=a&&(this.url=a),this.draw()},draw:function(a){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(a),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,a)},moveTo:function(a){null!=a&&(this.px=a),null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(a){this.imageDiv.style.display=a?"":"none"},isDrawn:function(){var a=this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType;return a},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(a,b){this.lonlat=a;var c=b?b:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=c:(this.icon.url=c.url,this.icon.size=c.size,this.icon.offset=c.offset,this.icon.calculateOffset=c.calculateOffset),this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase(),this.map=null,this.events.destroy(),this.events=null,null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(a){return this.icon.draw(a)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(a){null!=a&&null!=this.icon&&this.icon.moveTo(a),this.lonlat=this.map.getLonLatFromLayerPx(a)},isDrawn:function(){var a=this.icon&&this.icon.isDrawn();return a},onScreen:function(){var a=!1;if(this.map){var b=this.map.getExtent();a=b.containsLonLat(this.lonlat)}return a},inflate:function(a){this.icon&&this.icon.setSize({w:this.icon.size.w*a,h:this.icon.size.h*a})},setOpacity:function(a){this.icon.setOpacity(a)},setUrl:function(a){this.icon.setUrl(a)},display:function(a){this.icon.display(a)},CLASS_NAME:"OpenLayers.Marker"}),OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})},OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(a,b,c,d){this.layername=c,OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,{},d]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(a){return null==a&&(a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b=this.getServerResolution(),c=this.maxExtent,d=this.tileSize,e=Math.round((a.left-c.left)/(b*d.w)),f=Math.round((a.bottom-c.bottom)/(b*d.h)),g=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoom(),h=[this.layername,OpenLayers.Number.zeroPad(g,2),OpenLayers.Number.zeroPad(parseInt(e/1e6),3),OpenLayers.Number.zeroPad(parseInt(e/1e3)%1e3,3),OpenLayers.Number.zeroPad(parseInt(e)%1e3,3),OpenLayers.Number.zeroPad(parseInt(f/1e6),3),OpenLayers.Number.zeroPad(parseInt(f/1e3)%1e3,3),OpenLayers.Number.zeroPad(parseInt(f)%1e3,3)+"."+this.extension],i=h.join("/"),j=this.url;return OpenLayers.Util.isArray(j)&&(j=this.selectUrl(i,j)),j="/"==j.charAt(j.length-1)?j:j+"/",j+i},CLASS_NAME:"OpenLayers.Layer.TileCache"}),OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this}),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})),a},cacheFeatures:function(a){this.paging||(this.clearCache(),this.features=a.features,this.pageNext(a))},clearCache:function(){if(this.features)for(var a=0;a<this.features.length;++a)this.features[a].destroy();this.features=null,this.num=null},pageCount:function(){var a=this.features?this.features.length:0;return Math.ceil(a/this.length)},pageNum:function(){return this.num},pageLength:function(a){return a&&a>0&&(this.length=a),this.length},pageNext:function(a){var b=!1;if(this.features){null===this.num&&(this.num=-1);var c=(this.num+1)*this.length;b=this.page(c,a)}return b},pagePrevious:function(){var a=!1;if(this.features){null===this.num&&(this.num=this.pageCount());var b=(this.num-1)*this.length;a=this.page(b)}return a},page:function(a,b){var c=!1;if(this.features&&a>=0&&a<this.features.length){var d=Math.floor(a/this.length);if(d!=this.num){this.paging=!0;var e=this.features.slice(a,a+this.length);this.layer.removeFeatures(this.layer.features),this.num=d,b&&b.features?b.features=e:this.layer.addFeatures(e),this.paging=!1,c=!0}}return c},CLASS_NAME:"OpenLayers.Strategy.Paging"}),OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(){},onDrag:function(){},onComplete:function(){},onEnter:function(){},onLeave:function(){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.layer=a,this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(a){this.handlers.feature.touch&&!this.over&&this.overFeature(a)&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(a){this.handlers.feature.touch&&this.over&&(this.outFeature(a),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.handlers.drag.deactivate(),this.handlers.feature.deactivate(),this.feature=null,this.dragging=!1,this.lastPixel=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(a){var b=!1;return this.handlers.drag.dragging?this.over=this.feature.id==a.id?!0:!1:(this.feature=a,this.handlers.drag.activate(),b=!0,this.over=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(a)),b},downFeature:function(a){this.lastPixel=a,this.onStart(this.feature,a)},moveFeature:function(a){var b=this.map.getResolution();this.feature.geometry.move(b*(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y)),this.layer.drawFeature(this.feature),this.lastPixel=a,this.onDrag(this.feature,a)},upFeature:function(){this.over||this.handlers.drag.deactivate()},doneDragging:function(a){this.onComplete(this.feature,a)},outFeature:function(a){this.handlers.drag.dragging?this.feature.id==a.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(a),this.feature=null)},cancel:function(){this.handlers.drag.deactivate(),this.over=!1},setMap:function(a){this.handlers.drag.setMap(a),this.handlers.feature.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"}),OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.layer=a,this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,cursor:"pointer"}),this.createBox(),this.createControl()},activate:function(){var a=!1;return OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),a=!0),a},setMap:function(a){this.dragControl.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(a,b){b=OpenLayers.Util.applyDefaults(b,{rotation:0,scale:1,ratio:1});var c=this.rotation,d=this.center;OpenLayers.Util.extend(this,b);var e=this.events.triggerEvent("beforesetfeature",{feature:a});if(e!==!1){this.feature=a,this.activate(),this._setfeature=!0;var f=this.feature.geometry.getBounds();this.box.move(f.getCenterLonLat()),this.box.geometry.rotate(-c,d),this._angle=0;var g;if(this.rotation){var h=a.geometry.clone();h.rotate(-this.rotation,this.center);var i=new OpenLayers.Feature.Vector(h.getBounds().toGeometry());i.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(i.geometry.getBounds().getCenterLonLat());var j=i.geometry.components[0].components[0];g=j.getBounds().getCenterLonLat()}else g=new OpenLayers.LonLat(f.left,f.bottom);this.handles[0].move(g),delete this._setfeature,this.events.triggerEvent("setfeature",{feature:a})}},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.scale=1,this.ratio=1)},createBox:function(){var a=this;this.center=new OpenLayers.Geometry.Point(0,0),this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,"string"==typeof this.renderIntent?null:this.renderIntent),this.box.geometry.move=function(b,c){a._moving=!0,OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments),a.center.move(b,c),delete a._moving};for(var b,c,d,e=function(a,b){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.move(a,b),this._handle.geometry.move(a,b)},f=function(a,b,c){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.resize(a,b,c),this._handle.geometry.resize(a,b,c)},g=function(a,b){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.rotate(a,b),this._handle.geometry.rotate(a,b)},h=function(b,c){var d=this.x,e=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,b,c),!a._moving){var f=a.dragControl.handlers.drag.evt,g=!a._setfeature&&a.preserveAspectRatio,h=!(g||f&&f.shiftKey),i=new OpenLayers.Geometry.Point(d,e),j=a.center;this.rotate(-a.rotation,j),i.rotate(-a.rotation,j);var k=this.x-j.x,l=this.y-j.y,m=k-(this.x-i.x),n=l-(this.y-i.y);a.irregular&&!a._setfeature&&(k-=(this.x-i.x)/2,l-=(this.y-i.y)/2),this.x=d,this.y=e;var o,p=1;if(h)o=Math.abs(n)<1e-5?1:l/n,p=(Math.abs(m)<1e-5?1:k/m)/o;else{var q=Math.sqrt(m*m+n*n),r=Math.sqrt(k*k+l*l);o=r/q}if(a._moving=!0,a.box.geometry.rotate(-a.rotation,j),delete a._moving,a.box.geometry.resize(o,j,p),a.box.geometry.rotate(a.rotation,j),a.transformFeature({scale:o,ratio:p}),a.irregular&&!a._setfeature){var s=j.clone();s.x+=Math.abs(d-j.x)<1e-5?0:this.x-d,s.y+=Math.abs(e-j.y)<1e-5?0:this.y-e,a.box.geometry.move(this.x-d,this.y-e),a.transformFeature({center:s})}}},i=function(b,c){var d=this.x,e=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,b,c),!a._moving){var f=a.dragControl.handlers.drag.evt,g=f&&f.shiftKey?45:1,h=a.center,i=this.x-h.x,j=this.y-h.y,k=i-b,l=j-c;this.x=d,this.y=e;var m=Math.atan2(l,k),n=Math.atan2(j,i),o=n-m;o*=180/Math.PI,a._angle=(a._angle+o)%360;var p=a.rotation%g;(Math.abs(a._angle)>=g||0!==p)&&(o=Math.round(a._angle/g)*g-p,a._angle=0,a.box.geometry.rotate(o,h),a.transformFeature({rotation:o}))}},j=new Array(8),k=new Array(4),l=["sw","s","se","e","ne","n","nw","w"],m=0;8>m;++m)b=this.box.geometry.components[m],c=new OpenLayers.Feature.Vector(b.clone(),{role:l[m]+"-resize"},"string"==typeof this.renderIntent?null:this.renderIntent),m%2==0&&(d=new OpenLayers.Feature.Vector(b.clone(),{role:l[m]+"-rotate"},"string"==typeof this.rotationHandleSymbolizer?null:this.rotationHandleSymbolizer),d.geometry.move=i,b._rotationHandle=d,k[m/2]=d),b.move=e,b.resize=f,b.rotate=g,c.geometry.move=h,b._handle=c,j[m]=c;this.rotationHandles=k,this.handles=j},createControl:function(){var a=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,moveFeature:function(){this.feature===a.feature&&(this.feature=a.box),OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(b){b===a.box&&a.transformFeature({center:a.center})},onStart:function(b){var c=!a.geometryTypes||-1!==OpenLayers.Util.indexOf(a.geometryTypes,b.geometry.CLASS_NAME),d=OpenLayers.Util.indexOf(a.handles,b);d+=OpenLayers.Util.indexOf(a.rotationHandles,b),b!==a.feature&&b!==a.box&&-2==d&&c&&a.setFeature(b)},onComplete:function(){a.events.triggerEvent("transformcomplete",{feature:a.feature})}})},drawHandles:function(){for(var a=this.layer,b=0;8>b;++b)this.rotate&&b%2===0&&a.drawFeature(this.rotationHandles[b/2],this.rotationHandleSymbolizer),a.drawFeature(this.handles[b],this.renderIntent)},transformFeature:function(a){if(!this._setfeature){this.scale*=a.scale||1,this.ratio*=a.ratio||1;var b=this.rotation;if(this.rotation=(this.rotation+(a.rotation||0))%360,this.events.triggerEvent("beforetransform",a)!==!1){var c=this.feature,d=c.geometry,e=this.center;d.rotate(-b,e),a.scale||a.ratio?d.resize(a.scale,e,a.ratio):a.center&&c.move(a.center.getBounds().getCenterLonLat()),d.rotate(this.rotation,e),this.layer.drawFeature(c),c.toState(OpenLayers.State.UPDATE),this.events.triggerEvent("transform",a)}}this.layer.drawFeature(this.box,this.renderIntent),this.drawHandles()},destroy:function(){for(var a,b=0;8>b;++b)a=this.box.geometry.components[b],a._handle.destroy(),a._handle=null,a._rotationHandle&&a._rotationHandle.destroy(),a._rotationHandle=null;this.center=null,this.feature=null,this.handles=null,this.rotationHandleSymbolizer=null,this.rotationHandles=null,this.box.destroy(),this.box=null,this.layer=null,this.dragControl.destroy(),this.dragControl=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(a)},startBox:function(){this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999}),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(a){var b=this.dragHandler.start.x,c=this.dragHandler.start.y,d=Math.abs(b-a.x),e=Math.abs(c-a.y),f=this.getBoxOffsets();this.zoomBox.style.width=d+f.width+1+"px",this.zoomBox.style.height=e+f.height+1+"px",this.zoomBox.style.left=(a.x<b?b-d-f.left:b-f.left)+"px",this.zoomBox.style.top=(a.y<c?c-e-f.top:c-f.top)+"px"},endBox:function(a){var b;if(Math.abs(this.dragHandler.start.x-a.x)>5||Math.abs(this.dragHandler.start.y-a.y)>5){var c=this.dragHandler.start,d=Math.min(c.y,a.y),e=Math.max(c.y,a.y),f=Math.min(c.x,a.x),g=Math.max(c.x,a.x);b=new OpenLayers.Bounds(f,e,g,d)}else b=this.dragHandler.start.clone();this.removeBox(),this.callback("done",[b])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox),this.zoomBox=null,this.boxOffsets=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){if(!this.boxOffsets){var a=document.createElement("div");a.style.position="absolute",a.style.border="1px solid black",a.style.width="3px",document.body.appendChild(a);var b=3==a.clientWidth;document.body.removeChild(a);var c=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),d=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),e=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),f=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:c,right:d,top:e,bottom:f,width:b===!1?c+d:0,height:b===!1?e+f:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(a){if(a instanceof OpenLayers.Bounds){var b,c=a.getCenterPixel();if(this.out){var d=a.right-a.left,e=a.bottom-a.top,f=Math.min(this.map.size.h/e,this.map.size.w/d),g=this.map.getExtent(),h=this.map.getLonLatFromPixel(c),i=h.lon-g.getWidth()/2*f,j=h.lon+g.getWidth()/2*f,k=h.lat-g.getHeight()/2*f,l=h.lat+g.getHeight()/2*f;b=new OpenLayers.Bounds(i,k,j,l)}else{var m=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),n=this.map.getLonLatFromPixel({x:a.right,y:a.top});b=new OpenLayers.Bounds(m.lon,m.lat,n.lon,n.lat)}var o=this.map.getZoom(),p=this.map.getSize(),q={x:p.w/2,y:p.h/2},r=this.map.getZoomForExtent(b),s=this.map.getResolution(),t=this.map.getResolutionForZoom(r);if(s==t)this.map.setCenter(this.map.getLonLatFromPixel(c));else{var u={x:(s*c.x-t*q.x)/(s-t),y:(s*c.y-t*q.y)/(s-t)};this.map.zoomTo(r,u)}o==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(o+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,a):this.map.zoomTo(this.map.getZoom()+1,a))},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var a={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(a=OpenLayers.Util.extend(a,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(a)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(a){this.kinetic&&this.kinetic.update(a),this.panned=!0,this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!0,animate:!1})},panMapDone:function(a){if(this.panned){var b=null;if(this.kinetic&&(b=this.kinetic.end(a)),this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!!b,animate:!1}),b){var c=this;this.kinetic.move(b,function(a,b,d){c.map.pan(a,b,{dragging:!d,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var a={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},b={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,a,b),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw();var c=this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(c,this.mouseWheelOptions)),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(a){a.lastTouches&&2==a.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(a){this.map.zoomTo(this.map.zoom+1,a.xy)},defaultDblRightClick:function(a){this.map.zoomTo(this.map.zoom-1,a.xy)},wheelChange:function(a,b){this.map.fractionalZoom||(b=Math.round(b));var c=this.map.getZoom(),d=c+b;d=Math.max(d,0),d=Math.min(d,this.map.getNumZoomLevels()),d!==c&&this.map.zoomTo(d,a.xy)},wheelUp:function(a,b){this.wheelChange(a,b||1)},wheelDown:function(a,b){this.wheelChange(a,b||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(a,b,c){OpenLayers.Control.prototype.initialize.apply(this,[c]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(a,b){this.layer.events.triggerEvent("sketchmodified",{vertex:a,feature:b})},create:function(a,b){this.layer.events.triggerEvent("sketchstarted",{vertex:a,feature:b})}},this.callbacks),this.layer=a,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:a.renderers,rendererOptions:a.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);var d=this.layer.styleMap&&this.layer.styleMap.styles.temporary;d&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":d})})),this.handler=new b(this,this.callbacks,this.handlerOptions)},drawFeature:function(a){var b=new OpenLayers.Feature.Vector(a),c=this.layer.events.triggerEvent("sketchcomplete",{feature:b});c!==!1&&(b.state=OpenLayers.State.INSERT,this.layer.addFeatures([b]),this.featureAdded(b),this.events.triggerEvent("featureadded",{feature:b}))},insertXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertXY(a,b)},insertDeltaXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeltaXY(a,b)},insertDirectionLength:function(a,b){this.handler&&this.handler.line&&this.handler.insertDirectionLength(a,b)},insertDeflectionLength:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(a,b)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(c),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var a,b,c=this.point.geometry,d=this.control.layer.features,e=d.length-1;e>=0;--e)if(a=d[e].geometry,(a instanceof OpenLayers.Geometry.Polygon||a instanceof OpenLayers.Geometry.MultiPolygon)&&a.intersects(c)){b=d[e],this.control.layer.removeFeatures([b],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),b.geometry.addComponent(this.line.geometry),this.polygon=b,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(a){var b=a.vertex,c=this.line.geometry.components;if(!this.polygon.geometry.intersects(b)){var d=c[c.length-3];b.x=d.x,b.y=d.y}},finishGeometry:function(){var a=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[a]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var a=this.line.geometry,b=0!==a.getArea();if(b){for(var c=this.polygon.geometry.components,d=c.length-2;d>=0;--d)if(a.intersects(c[d])){b=!1;break}if(b){a:for(var d=c.length-2;d>0;--d)for(var e=c[d].components,f=0,g=e.length;g>f;++f)if(a.containsPoint(e[f])){b=!1;break a}}}return b?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(a),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(a){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,a||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(a){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,a),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiPolygon([a])),a},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:!1,initialize:function(a,b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]),this.addControls([new OpenLayers.Control.Navigation]);var c=[new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})];
this.addControls(c)},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),a},CLASS_NAME:"OpenLayers.Control.EditingToolbar"}),OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update()),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),a},update:function(a){var b=this.getMapBounds();null!==b&&(a&&a.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(b))&&(this.calculateBounds(b),this.resolution=this.layer.map.getResolution(),this.triggerRead(a))},getMapBounds:function(){if(null===this.layer.map)return null;var a=this.layer.map.getExtent();return a&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)),a},invalidBounds:function(a){a||(a=this.getMapBounds());var b=!this.bounds||!this.bounds.containsBounds(a);if(!b&&this.resFactor){var c=this.resolution/this.layer.map.getResolution();b=c>=this.resFactor||c<=1/this.resFactor}return b},calculateBounds:function(a){a||(a=this.getMapBounds());var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio,d=a.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(b.lon-c/2,b.lat-d/2,b.lon+c/2,b.lat+d/2)},triggerRead:function(a){!this.response||a&&a.noAbort===!0||(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));var b={filter:this.createFilter()};this.layer.events.triggerEvent("loadstart",b),this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:b.filter,callback:this.merge,scope:this},a))},createFilter:function(){var a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});return this.layer.filter&&(a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,a]})),a},merge:function(a){if(this.layer.destroyFeatures(),a.success()){var b=a.features;if(b&&b.length>0){var c=this.layer.projection,d=this.layer.map.getProjectionObject();if(!d.equals(c))for(var e,f=0,g=b.length;g>f;++f)e=b[f].geometry,e&&e.transform(c,d);this.layer.addFeatures(b)}}else this.bounds=null;this.response=null,this.layer.events.triggerEvent("loadend",{response:a})},CLASS_NAME:"OpenLayers.Strategy.BBOX"}),OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(a,b,c,d,e,f){this.lzd=c,this.zoomLevels=d;var g=[];g.push(a,b,e,f),OpenLayers.Layer.Grid.prototype.initialize.apply(this,g),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){{var a=this.map.getZoom();this.map.getMaxExtent()}return a-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(a){a=this.adjustBounds(a);var b=this.getZoom(),c=this.map.getMaxExtent(),d=this.lzd/Math.pow(2,this.getZoom()),e=Math.floor((a.left-c.left)/d),f=Math.floor((a.bottom-c.bottom)/d);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:b,X:e,Y:f}):OpenLayers.Util.getImageLocation("blank.gif")},CLASS_NAME:"OpenLayers.Layer.WorldWind"}),OpenLayers.Protocol.CSW=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.CSW.DEFAULTS);var b=OpenLayers.Protocol.CSW["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSW version: "+a.version;return new b(a)},OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"},OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(a,b){if(!("layer"in b))throw new Error("Missing property 'layer' in configuration.");for(var c,d=a.contents,e=(d.layers,0),f=d.layers.length;f>e;++e)if(d.layers[e].identifier===b.layer){c=d.layers[e];break}if(!c)throw new Error("Layer not found");var g=b.format;!g&&c.formats&&c.formats.length&&(g=c.formats[0]);var h;if(b.matrixSet?h=d.tileMatrixSets[b.matrixSet]:c.tileMatrixSetLinks.length>=1&&(h=d.tileMatrixSets[c.tileMatrixSetLinks[0].tileMatrixSet]),!h)throw new Error("matrixSet not found");for(var i,e=0,f=c.styles.length;f>e&&(i=c.styles[e],!i.isDefault);++e);var j=b.requestEncoding;if(!j&&(j="KVP",a.operationsMetadata.GetTile.dcp.http)){var k=a.operationsMetadata.GetTile.dcp.http;if(k.get[0].constraints){var l=k.get[0].constraints,m=l.GetEncoding.allowedValues;m.KVP||!m.REST&&!m.RESTful||(j="REST")}}var n=[],o=b.params||{};delete b.params;for(var p=0,q=c.dimensions.length;q>p;p++){var r=c.dimensions[p];n.push(r.identifier),o.hasOwnProperty(r.identifier)||(o[r.identifier]=r["default"])}var s=b.projection||h.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),t=b.units||("EPSG:4326"===s?"degrees":"m"),u=[];for(var v in h.matrixIds)h.matrixIds.hasOwnProperty(v)&&u.push(28e-5*h.matrixIds[v].scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[t]);var w;if("REST"===j&&c.resourceUrls){w=[];for(var x,y=(c.resourceUrls,0),z=c.resourceUrls.length;z>y;++y)x=c.resourceUrls[y],x.format===g&&"tile"===x.resourceType&&w.push(x.template)}else{var A=a.operationsMetadata.GetTile.dcp.http.get;w=[];for(var B,e=0,f=A.length;f>e;e++)B=A[e].constraints,(!B||B&&B.GetEncoding.allowedValues[j])&&w.push(A[e].url)}return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(b,{url:w,requestEncoding:j,name:c.title,style:i.identifier,format:g,matrixIds:h.matrixIds,matrixSet:h.identifier,projection:s,units:t,resolutions:b.isBaseLayer===!1?void 0:u,serverResolutions:u,tileFullExtent:h.bounds,dimensions:n,params:o}))},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"}),OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var a,b=OpenLayers.Layer.Google.cache[this.map.id];if(b)a=b.mapObject,++b.count;else{var c=this.map.getCenter(),d=document.createElement("div");d.className="olForeignContainer",d.style.width="100%",d.style.height="100%",a=new google.maps.Map(d,{center:c?new google.maps.LatLng(c.lat,c.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1});var e=document.createElement("div");e.style.width="100%",e.style.height="100%",a.controls[google.maps.ControlPosition.TOP_LEFT].push(e),b={googleControl:e,mapObject:a,count:1},OpenLayers.Layer.Google.cache[this.map.id]=b}this.mapObject=a,this.setGMapVisibility(this.visibility)},onMapResize:function(){this.visibility&&google.maps.event.trigger(this.mapObject,"resize")},setGMapVisibility:function(a){var b=OpenLayers.Layer.Google.cache[this.map.id],c=this.map;if(b){for(var d,e=this.type,f=c.layers,g=f.length-1;g>=0;--g)if(d=f[g],d instanceof OpenLayers.Layer.Google&&d.visibility===!0&&d.inRange===!0){e=d.type,a=!0;break}var h=this.mapObject.getDiv();if(a===!0){if(h.parentNode!==c.div)if(b.rendered)c.div.appendChild(h),b.googleControl.appendChild(c.viewPortDiv),google.maps.event.trigger(this.mapObject,"resize");else{var i=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){b.rendered=!0,i.setGMapVisibility(i.getVisibility()),i.moveTo(i.map.getCenter())})}this.mapObject.setMapTypeId(e)}else b.googleControl.hasChildNodes()&&(c.div.appendChild(c.viewPortDiv),c.div.removeChild(h))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(a){var b=null;if(null!=a){var c=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),d=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right);b=new google.maps.LatLngBounds(new google.maps.LatLng(c.lat,c.lon),new google.maps.LatLng(d.lat,d.lon))}return b},getMapObjectLonLatFromMapObjectPixel:function(a){var b=this.map.getSize(),c=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),d=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),e=this.map.getResolution(),f=a.x-b.w/2,g=a.y-b.h/2,h=new OpenLayers.LonLat(c+f*e,d-g*e);return this.wrapDateLine&&(h=h.wrapDateLine(this.maxExtent)),this.getMapObjectLonLatFromLonLat(h.lon,h.lat)},getMapObjectPixelFromMapObjectLonLat:function(a){var b=this.getLongitudeFromMapObjectLonLat(a),c=this.getLatitudeFromMapObjectLonLat(a),d=this.map.getResolution(),e=this.map.getExtent();return this.getMapObjectPixelFromXY(1/d*(b-e.left),1/d*(e.top-c))},setMapObjectCenter:function(a,b){if(this.animationEnabled===!1&&b!=this.mapObject.zoom){var c=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){c.style.visibility=""}),c.style.visibility="hidden"}this.mapObject.setOptions({center:a,zoom:b})},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(a,b){var c;if(this.sphericalMercator){var d=this.inverseMercator(a,b);c=new google.maps.LatLng(d.lat,d.lon)}else c=new google.maps.LatLng(b,a);return c},getMapObjectPixelFromXY:function(a,b){return new google.maps.Point(a,b)}},OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{wps:{ProcessDescriptions:function(a,b){b.processDescriptions={},this.readChildNodes(a,b.processDescriptions)},ProcessDescription:function(a,b){var c=this.getAttributeNS(a,this.namespaces.wps,"processVersion"),d={processVersion:c,statusSupported:"true"===a.getAttribute("statusSupported"),storeSupported:"true"===a.getAttribute("storeSupported")};this.readChildNodes(a,d),b[d.identifier]=d},DataInputs:function(a,b){b.dataInputs=[],this.readChildNodes(a,b.dataInputs)},ProcessOutputs:function(a,b){b.processOutputs=[],this.readChildNodes(a,b.processOutputs)},Output:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)},ComplexOutput:function(a,b){b.complexOutput={},this.readChildNodes(a,b.complexOutput)},LiteralOutput:function(a,b){b.literalOutput={},this.readChildNodes(a,b.literalOutput)},Input:function(a,b){var c={maxOccurs:parseInt(a.getAttribute("maxOccurs")),minOccurs:parseInt(a.getAttribute("minOccurs"))};this.readChildNodes(a,c),b.push(c)},BoundingBoxData:function(a,b){b.boundingBoxData={},this.readChildNodes(a,b.boundingBoxData)},CRS:function(a,b){b.CRSs||(b.CRSs={}),b.CRSs[this.getChildValue(a)]=!0},LiteralData:function(a,b){b.literalData={},this.readChildNodes(a,b.literalData)},ComplexData:function(a,b){b.complexData={},this.readChildNodes(a,b.complexData)},Default:function(a,b){b["default"]={},this.readChildNodes(a,b["default"])},Supported:function(a,b){b.supported={},this.readChildNodes(a,b.supported)},Format:function(a,b){var c={};this.readChildNodes(a,c),b.formats||(b.formats={}),b.formats[c.mimeType]=!0},MimeType:function(a,b){b.mimeType=this.getChildValue(a)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"}),OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b,c,d;a=a.replace(/[\n\r]/g," ");var e=this.regExes.typeStr.exec(a);if(e&&(c=e[1].toLowerCase(),d=e[2],this.parse[c]&&(b=this.parse[c].apply(this,[d])),this.internalProjection&&this.externalProjection))if(b&&"OpenLayers.Feature.Vector"==b.CLASS_NAME)b.geometry.transform(this.externalProjection,this.internalProjection);else if(b&&"geometrycollection"!=c&&"object"==typeof b)for(var f=0,g=b.length;g>f;f++){var h=b[f];h.geometry.transform(this.externalProjection,this.internalProjection)}return b},write:function(a){var b,c,d;a.constructor==Array?(b=a,d=!0):(b=[a],d=!1);var e=[];d&&e.push("GEOMETRYCOLLECTION(");for(var f=0,g=b.length;g>f;++f)d&&f>0&&e.push(","),c=b[f].geometry,e.push(this.extractGeometry(c));return d&&e.push(")"),e.join("")},extractGeometry:function(a){var b=a.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[b])return null;this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var c="collection"==b?"GEOMETRYCOLLECTION":b.toUpperCase(),d=c+"("+this.extract[b].apply(this,[a])+")";return d},extract:{point:function(a){return a.x+" "+a.y},multipoint:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push("("+this.extract.point.apply(this,[a.components[c]])+")");return b.join(",")},linestring:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b.join(",")},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},polygon:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push("("+this.extract.polygon.apply(this,[a.components[c]])+")");return b.join(",")},collection:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extractGeometry.apply(this,[a.components[c]]));return b.join(",")}},parse:{point:function(a){var b=OpenLayers.String.trim(a).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b[0],b[1]))},multipoint:function(a){for(var b,c=OpenLayers.String.trim(a).split(","),d=[],e=0,f=c.length;f>e;++e)b=c[e].replace(this.regExes.trimParens,"$1"),d.push(this.parse.point.apply(this,[b]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(d))},linestring:function(a){for(var b=OpenLayers.String.trim(a).split(","),c=[],d=0,e=b.length;e>d;++d)c.push(this.parse.point.apply(this,[b[d]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(c))},multilinestring:function(a){for(var b,c=OpenLayers.String.trim(a).split(this.regExes.parenComma),d=[],e=0,f=c.length;f>e;++e)b=c[e].replace(this.regExes.trimParens,"$1"),d.push(this.parse.linestring.apply(this,[b]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(d))},polygon:function(a){for(var b,c,d,e=OpenLayers.String.trim(a).split(this.regExes.parenComma),f=[],g=0,h=e.length;h>g;++g)b=e[g].replace(this.regExes.trimParens,"$1"),c=this.parse.linestring.apply(this,[b]).geometry,d=new OpenLayers.Geometry.LinearRing(c.components),f.push(d);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(f))},multipolygon:function(a){for(var b,c=OpenLayers.String.trim(a).split(this.regExes.doubleParenComma),d=[],e=0,f=c.length;f>e;++e)b=c[e].replace(this.regExes.trimParens,"$1"),d.push(this.parse.polygon.apply(this,[b]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(d))},geometrycollection:function(a){a=a.replace(/,\s*([A-Za-z])/g,"|$1");for(var b=OpenLayers.String.trim(a).split("|"),c=[],d=0,e=b.length;e>d;++d)c.push(OpenLayers.Format.WKT.prototype.read.apply(this,[b[d]]));return c}},CLASS_NAME:"OpenLayers.Format.WKT"}),OpenLayers.WPSProcess=OpenLayers.Class({client:null,server:null,identifier:null,description:null,localWPS:"http://geoserver/wps",formats:null,chained:0,executeCallbacks:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.executeCallbacks=[],this.formats={"application/wkt":new OpenLayers.Format.WKT,"application/json":new OpenLayers.Format.GeoJSON}},describe:function(a){if(a=a||{},this.description){if(a.callback){var b=this.description;window.setTimeout(function(){a.callback.call(a.scope,b)},0)}}else this.client.describeProcess(this.server,this.identifier,function(b){this.description||this.parseDescription(b),a.callback&&a.callback.call(a.scope,this.description)},this)},configure:function(a){return this.describe({callback:function(){var b,c,d,e=this.description,f=a.inputs;for(c=0,d=e.dataInputs.length;d>c;++c)b=e.dataInputs[c],this.setInputData(b,f[b.identifier]);a.callback&&a.callback.call(a.scope)},scope:this}),this},execute:function(a){this.configure({inputs:a.inputs,callback:function(){var b=this,c=this.getOutputIndex(b.description.processOutputs,a.output);b.setResponseForm({outputIndex:c}),function d(){return OpenLayers.Util.removeItem(b.executeCallbacks,d),0!==b.chained?void b.executeCallbacks.push(d):void OpenLayers.Request.POST({url:b.client.servers[b.server].url,data:(new OpenLayers.Format.WPSExecute).write(b.description),success:function(d){var e=b.description.processOutputs[c],f=b.findMimeType(e.complexOutput.supported.formats),g=b.formats[f].read(d.responseText);if(g instanceof OpenLayers.Feature.Vector&&(g=[g]),a.success){var h={};h[a.output||"result"]=g,a.success.call(a.scope,h)}},scope:b})}()},scope:this})},output:function(a){return new OpenLayers.WPSProcess.ChainLink({process:this,output:a})},parseDescription:function(){var a=this.client.servers[this.server];this.description=(new OpenLayers.Format.WPSDescribeProcess).read(a.processDescription[this.identifier]).processDescriptions[this.identifier]},setInputData:function(a,b){if(delete a.data,delete a.reference,b instanceof OpenLayers.WPSProcess.ChainLink)++this.chained,a.reference={method:"POST",href:b.process.server===this.server?this.localWPS:this.client.servers[b.process.server].url},b.process.describe({callback:function(){--this.chained,this.chainProcess(a,b)},scope:this});else{a.data={};var c=a.complexData;if(c){var d=this.findMimeType(c.supported.formats);a.data.complexData={mimeType:d,value:this.formats[d].write(this.toFeatures(b))}}else a.data.literalData={value:b}}},setResponseForm:function(a){a=a||{};var b=this.description.processOutputs[a.outputIndex||0];this.description.responseForm={rawDataOutput:{identifier:b.identifier,mimeType:this.findMimeType(b.complexOutput.supported.formats,a.supportedFormats)}}},getOutputIndex:function(a,b){var c;if(b){for(var d=a.length-1;d>=0;--d)if(a[d].identifier===b){c=d;break}}else c=0;return c},chainProcess:function(a,b){var c=this.getOutputIndex(b.process.description.processOutputs,b.output);a.reference.mimeType=this.findMimeType(a.complexData.supported.formats,b.process.description.processOutputs[c].complexOutput.supported.formats);var d={};for(d[a.reference.mimeType]=!0,b.process.setResponseForm({outputIndex:c,supportedFormats:d}),a.reference.body=b.process.description;this.executeCallbacks.length>0;)this.executeCallbacks[0]()},toFeatures:function(a){var b=OpenLayers.Util.isArray(a);b||(a=[a]);for(var c,d=new Array(a.length),e=0,f=a.length;f>e;++e)c=a[e],d[e]=c instanceof OpenLayers.Feature.Vector?c:new OpenLayers.Feature.Vector(c);return b?d:d[0]},findMimeType:function(a,b){b=b||this.formats;for(var c in a)if(c in b)return c},CLASS_NAME:"OpenLayers.WPSProcess"}),OpenLayers.WPSProcess.ChainLink=OpenLayers.Class({process:null,output:null,initialize:function(a){OpenLayers.Util.extend(this,a)},CLASS_NAME:"OpenLayers.WPSProcess.ChainLink"}),OpenLayers.WPSClient=OpenLayers.Class({servers:null,version:"1.0.0",lazy:!1,events:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.events=new OpenLayers.Events(this),this.servers={};for(var b in a.servers)this.servers[b]="string"==typeof a.servers[b]?{url:a.servers[b],version:this.version,processDescription:{}}:a.servers[b]},execute:function(a){var b=this.getProcess(a.server,a.process);b.execute({inputs:a.inputs,success:a.success,scope:a.scope})},getProcess:function(a,b){var c=new OpenLayers.WPSProcess({client:this,server:a,identifier:b});return this.lazy||c.describe(),c},describeProcess:function(a,b,c,d){var e=this.servers[a];e.processDescription[b]?window.setTimeout(function(){c.call(d,e.processDescription[b])},0):b in e.processDescription?this.events.register("describeprocess",this,function f(a){a.identifier===b&&(this.events.unregister("describeprocess",this,f),c.call(d,a.raw))}):(e.processDescription[b]=null,OpenLayers.Request.GET({url:e.url,params:{SERVICE:"WPS",VERSION:e.version,REQUEST:"DescribeProcess",IDENTIFIER:b},success:function(a){e.processDescription[b]=a.responseText,this.events.triggerEvent("describeprocess",{identifier:b,raw:a.responseText})},scope:this}))},destroy:function(){this.events.destroy(),this.events=null,this.servers=null},CLASS_NAME:"OpenLayers.WPSClient"}),OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{csw:{GetRecordsResponse:function(a,b){b.records=[],this.readChildNodes(a,b);var c=this.getAttributeNS(a,"","version");""!=c&&(b.version=c)},RequestId:function(a,b){b.RequestId=this.getChildValue(a)},SearchStatus:function(a,b){b.SearchStatus={};var c=this.getAttributeNS(a,"","timestamp");""!=c&&(b.SearchStatus.timestamp=c)},SearchResults:function(a,b){this.readChildNodes(a,b);for(var c=a.attributes,d={},e=0,f=c.length;f>e;++e)d[c[e].name]="numberOfRecordsMatched"==c[e].name||"numberOfRecordsReturned"==c[e].name||"nextRecord"==c[e].name?parseInt(c[e].nodeValue):c[e].nodeValue;b.SearchResults=d},SummaryRecord:function(a,b){var c={type:"SummaryRecord"};this.readChildNodes(a,c),b.records.push(c)},BriefRecord:function(a,b){var c={type:"BriefRecord"};this.readChildNodes(a,c),b.records.push(c)},DCMIRecord:function(a,b){var c={type:"DCMIRecord"};this.readChildNodes(a,c),b.records.push(c)},Record:function(a,b){var c={type:"Record"};this.readChildNodes(a,c),b.records.push(c)},"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();b[c]=this.getChildValue(a)}},geonet:{info:function(a,b){var c={};this.readChildNodes(a,c),b.gninfo=c}},dc:{"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]);for(var d={},e=a.attributes,f=0,g=e.length;g>f;++f)d[e[f].name]=e[f].nodeValue;d.value=this.getChildValue(a),""!=d.value&&b[c].push(d)}},dct:{"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]),b[c].push(this.getChildValue(a))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(a,b){b.bounds&&(b.BoundingBox=[{crs:b.projection,value:[b.bounds.left,b.bounds.bottom,b.bounds.right,b.bounds.top]}],delete b.projection,delete b.bounds),OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(a){var b=this.writeNode("csw:GetRecords",a);return b.setAttribute("xmlns:gmd",this.namespaces.gmd),OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetRecords:function(a){a||(a={});var b=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:a.requestId||this.requestId,resultType:a.resultType||this.resultType,outputFormat:a.outputFormat||this.outputFormat,outputSchema:a.outputSchema||this.outputSchema,startPosition:a.startPosition||this.startPosition,maxRecords:a.maxRecords||this.maxRecords}});(a.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",a.DistributedSearch||this.DistributedSearch,b);var c=a.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(c)&&c.length>0)for(var d=0,e=c.length;e>d;d++)this.writeNode("csw:ResponseHandler",c[d],b);return this.writeNode("Query",a.Query||this.Query,b),b},DistributedSearch:function(a){var b=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:a.hopCount}});return b},ResponseHandler:function(a){var b=this.createElementNSPlus("csw:ResponseHandler",{value:a.value});return b},Query:function(a){a||(a={});var b=this.createElementNSPlus("csw:Query",{attributes:{typeNames:a.typeNames||"csw:Record"}}),c=a.ElementName;if(OpenLayers.Util.isArray(c)&&c.length>0)for(var d=0,e=c.length;e>d;d++)this.writeNode("csw:ElementName",c[d],b);else this.writeNode("csw:ElementSetName",a.ElementSetName||{value:"summary"},b);return a.Constraint&&this.writeNode("csw:Constraint",a.Constraint,b),a.SortBy&&this.writeNode("ogc:SortBy",a.SortBy,b),b},ElementName:function(a){var b=this.createElementNSPlus("csw:ElementName",{value:a.value});return b},ElementSetName:function(a){var b=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:a.typeNames},value:a.value});return b},Constraint:function(a){var b=this.createElementNSPlus("csw:Constraint",{attributes:{version:a.version}});if(a.Filter){var c=new OpenLayers.Format.Filter({version:a.version});b.appendChild(c.write(a.Filter))}else if(a.CqlText){var d=this.createElementNSPlus("CqlText",{value:a.CqlText.value});b.appendChild(d)}return b}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"}),/**
 * @license Apache 2 
 *  
 * Contains portions of Rico <http://openrico.org/>
 * 
 * Copyright 2005 Sabre Airline Solutions  
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you
 * may not use this file except in compliance with the License. You
 * may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0  
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 * implied. See the License for the specific language governing
 * permissions and limitations under the License. 
 */
OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(a,b,c){this.bounds=a,this.div=OpenLayers.Util.createDiv(),this.div.style.overflow="hidden",this.events=new OpenLayers.Events(this,this.div),this.setBorder(b,c)},destroy:function(){this.bounds=null,this.div=null,OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(a,b){a||(a="red"),b||(b=2),this.div.style.border=b+"px solid "+a},draw:function(a,b){return OpenLayers.Util.modifyDOMElement(this.div,null,a,b),this.div},onScreen:function(){var a=!1;if(this.map){var b=this.map.getExtent();a=b.containsBounds(this.bounds,!0,!0)}return a},display:function(a){this.div.style.display=a?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"}),OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(a){a=a||{},a.extractStyles!==!1&&(a.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}),OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){for(var b,c=a.split("\n"),d=[],e=0;e<c.length-1;e++){var f=c[e].replace(/^\s*/,"").replace(/\s*$/,"");if("#"!=f.charAt(0))if(b){for(var g=f.split("	"),h=new OpenLayers.Geometry.Point(0,0),i={},j=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,k=!1,l=0;l<g.length;l++)if(g[l])if("point"==b[l]){var m=g[l].split(",");h.y=parseFloat(m[0]),h.x=parseFloat(m[1]),k=!0}else if("lat"==b[l])h.y=parseFloat(g[l]),k=!0;else if("lon"==b[l])h.x=parseFloat(g[l]),k=!0;else if("title"==b[l])i.title=g[l];else if("image"==b[l]||"icon"==b[l]&&j)j.externalGraphic=g[l];else if("iconSize"==b[l]&&j){var n=g[l].split(",");j.graphicWidth=parseFloat(n[0]),j.graphicHeight=parseFloat(n[1])}else if("iconOffset"==b[l]&&j){var o=g[l].split(",");j.graphicXOffset=parseFloat(o[0]),j.graphicYOffset=parseFloat(o[1])}else"description"==b[l]?i.description=g[l]:"overflow"==b[l]?i.overflow=g[l]:i[b[l]]=g[l];if(k){this.internalProjection&&this.externalProjection&&h.transform(this.externalProjection,this.internalProjection);var p=new OpenLayers.Feature.Vector(h,i,j);d.push(p)}}else b=f.split("	")}return d},CLASS_NAME:"OpenLayers.Format.Text"}),OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments),this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadText:function(){if(!this.loaded&&null!=this.location){var a=function(){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:a,scope:this}),this.loaded=!0}},moveTo:function(){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadText()},parseData:function(a){var b=a.responseText,c={};OpenLayers.Util.extend(c,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(c.externalProjection=this.projection,c.internalProjection=this.map.getProjectionObject());for(var d=new OpenLayers.Format.Text(c),e=d.read(b),f=0,g=e.length;g>f;f++){var h,i,j,k={},l=e[f];h=new OpenLayers.LonLat(l.geometry.x,l.geometry.y),l.style.graphicWidth&&l.style.graphicHeight&&(i=new OpenLayers.Size(l.style.graphicWidth,l.style.graphicHeight)),void 0!==l.style.graphicXOffset&&void 0!==l.style.graphicYOffset&&(j=new OpenLayers.Pixel(l.style.graphicXOffset,l.style.graphicYOffset)),null!=l.style.externalGraphic?k.icon=new OpenLayers.Icon(l.style.externalGraphic,i,j):(k.icon=OpenLayers.Marker.defaultIcon(),null!=i&&k.icon.setSize(i)),null!=l.attributes.title&&null!=l.attributes.description&&(k.popupContentHTML="<h2>"+l.attributes.title+"</h2><p>"+l.attributes.description+"</p>"),k.overflow=l.attributes.overflow||"auto";var m=new OpenLayers.Feature(this,h,k);this.features.push(m);var n=m.createMarker();null!=l.attributes.title&&null!=l.attributes.description&&n.events.register("click",m,this.markerClick),this.addMarker(n)}this.events.triggerEvent("loadend")},markerClick:function(a){var b=this==this.layer.selectedFeature;this.layer.selectedFeature=b?null:this;for(var c=0,d=this.layer.map.popups.length;d>c;c++)this.layer.map.removePopup(this.layer.map.popups[c]);b||this.layer.map.addPopup(this.createPopup()),OpenLayers.Event.stop(a)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a),a.destroy()}},CLASS_NAME:"OpenLayers.Layer.Text"}),OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.Drag.prototype.initialize.apply(this,[a,b,c]),this.options=c?c:{}},setOptions:function(a){OpenLayers.Util.extend(this.options,a),OpenLayers.Util.extend(this,a)},activate:function(){var a=!1;if(OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)){var b=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b),this.map.addLayer(this.layer),a=!0}return a},deactivate:function(){var a=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.layer=null,this.feature=null,a=!0),a},down:function(a){this.fixedRadius=!!this.radius;var b=this.layer.getLonLatFromViewPortPx(a.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat),(!this.fixedRadius||this.irregular)&&(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style)},move:function(a){var b=this.layer.getLonLatFromViewPortPx(a.xy),c=new OpenLayers.Geometry.Point(b.lon,b.lat);if(this.irregular){var d=Math.sqrt(2)*Math.abs(c.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,d)}else this.fixedRadius?this.origin=c:(this.calculateAngle(c,a),this.radius=Math.max(this.map.getResolution()/2,c.distanceTo(this.origin)));if(this.modifyGeometry(),this.irregular){var e,f=c.x-this.origin.x,g=c.y-this.origin.y;e=0==g?f/(this.radius*Math.sqrt(2)):f/g,this.feature.geometry.resize(1,this.origin,e),this.feature.geometry.move(f/2,g/2)}this.layer.drawFeature(this.feature,this.style)},up:function(a){this.finalize(),this.start==this.last&&this.callback("done",[a.xy])},out:function(){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-.5),this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180)),this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var a,b,c=this.feature.geometry.components[0];c.components.length!=this.sides+1&&(this.createGeometry(),c=this.feature.geometry.components[0]);for(var d=0;d<this.sides;++d)b=c.components[d],a=this.angle+2*d*Math.PI/this.sides,b.x=this.origin.x+this.radius*Math.cos(a),b.y=this.origin.y+this.radius*Math.sin(a),b.clearBounds()},calculateAngle:function(a,b){var c=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!b[this.snapToggle]){var d=Math.PI/180*this.snapAngle;this.angle=Math.round(c/d)*d}else this.angle=c},cancel:function(){this.callback("cancel",null),this.finalize()},finalize:function(){this.origin=null,this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(a){this.callbacks[a]&&this.callbacks[a].apply(this.control,[this.feature.geometry.clone()]),this.persist||"done"!=a&&"cancel"!=a||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"}),OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks),this.handlerOptions=this.handlerOptions||{},this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}}),this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})})),this.handler=new a(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var a in this.layerCache)delete this.layerCache[a];for(var a in this.wfsCache)delete this.wfsCache[a];OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(a){this.setVisibility(a.object.getVisibility())},createSelectionLayer:function(a){var b;return this.layerCache[a.id]?b=this.layerCache[a.id]:(b=new OpenLayers.Layer.WMS(a.name,a.url,a.params,OpenLayers.Util.applyDefaults(this.layerOptions,a.getOptions())),this.layerCache[a.id]=b,this.layerOptions.displayInLayerSwitcher===!1&&a.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:b}),this.map.addLayer(b)),b},createSLD:function(a,b,c){for(var d={version:"1.0.0",namedLayers:{}},e=[a.params.LAYERS].join(",").split(","),f=0,g=e.length;g>f;f++){var h=e[f];d.namedLayers[h]={name:h,userStyles:[]};var i=this.selectionSymbolizer,j=c[f];j.type.indexOf("Polygon")>=0?i={Polygon:this.selectionSymbolizer.Polygon}:j.type.indexOf("LineString")>=0?i={Line:this.selectionSymbolizer.Line}:j.type.indexOf("Point")>=0&&(i={Point:this.selectionSymbolizer.Point});var k=b[f];d.namedLayers[h].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:i,filter:k,maxScaleDenominator:a.options.minScale})]})}return new OpenLayers.Format.SLD({srsName:this.map.getProjection()}).write(d)},parseDescribeLayer:function(a){var b=new OpenLayers.Format.WMSDescribeLayer,c=a.responseXML;c&&c.documentElement||(c=a.responseText);for(var d=b.read(c),e=[],f=null,g=0,h=d.length;h>g;g++)"WFS"==d[g].owsType&&(e.push(d[g].typeName),f=d[g].owsURL);var i={url:f,params:{SERVICE:"WFS",TYPENAME:e.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(a){var b=new OpenLayers.Format.WFSDescribeFeatureType,c=a.responseXML;c&&c.documentElement||(c=a.responseText);var d=b.read(c);this.control.wfsCache[this.layer.id]=d,this.control._queue&&this.control.applySelection()},scope:this};OpenLayers.Request.GET(i)},getGeometryAttributes:function(a){for(var b=[],c=this.wfsCache[a.id],d=0,e=c.featureTypes.length;e>d;d++)for(var f=c.featureTypes[d],g=f.properties,h=0,i=g.length;i>h;h++){var j=g[h],k=j.type;(k.indexOf("LineString")>=0||k.indexOf("GeometryAssociationType")>=0||k.indexOf("GeometryPropertyType")>=0||k.indexOf("Point")>=0||k.indexOf("Polygon")>=0)&&b.push(j)}return b},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a)for(var b=0,c=this.layers.length;c>b;b++){var d=this.layers[b];if(d&&!this.wfsCache[d.id]){var e={url:d.url,params:{SERVICE:"WMS",VERSION:d.params.VERSION,LAYERS:d.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:d,control:this}};OpenLayers.Request.GET(e)}}return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);if(a)for(var b=0,c=this.layers.length;c>b;b++){var d=this.layers[b];if(d&&this.clearOnDeactivate===!0){var e=this.layerCache,f=e[d.id];f&&(d.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:f}),f.destroy(),delete e[d.id])}}return a},setLayers:function(a){this.active?(this.deactivate(),this.layers=a,this.activate()):this.layers=a},createFilter:function(a,b){var c=null;return this.handler instanceof OpenLayers.Handler.RegularPolygon?c=new OpenLayers.Filter.Spatial(this.handler.irregular===!0?{type:OpenLayers.Filter.Spatial.BBOX,property:a.name,value:b.getBounds()}:{type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Polygon?c=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Path?c=new OpenLayers.Filter.Spatial(a.type.indexOf("Point")>=0?{type:OpenLayers.Filter.Spatial.DWITHIN,property:a.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:b}:{type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Click&&(c=new OpenLayers.Filter.Spatial(a.type.indexOf("Polygon")>=0?{type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}:{type:OpenLayers.Filter.Spatial.DWITHIN,property:a.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:b})),c},select:function(a){this._queue=function(){for(var b=0,c=this.layers.length;c>b;b++){for(var d=this.layers[b],e=this.getGeometryAttributes(d),f=[],g=0,h=e.length;h>g;g++){var i=e[g];if(null!==i){if(!(a instanceof OpenLayers.Geometry)){var j=this.map.getLonLatFromPixel(a.xy);a=new OpenLayers.Geometry.Point(j.lon,j.lat)}var k=this.createFilter(i,a);null!==k&&f.push(k)}}var l=this.createSelectionLayer(d);this.events.triggerEvent("selected",{layer:d,filters:f});var m=this.createSLD(d,f,e);l.mergeNewParams({SLD_BODY:m}),delete this._queue}},this.applySelection()},applySelection:function(){for(var a=!0,b=0,c=this.layers.length;c>b;b++)if(!this.wfsCache[this.layers[b].id]){a=!1;break}a&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"}),OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.element=OpenLayers.Util.getElement(a)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element)),this.map.events.register("moveend",this,this.updateScale),this.updateScale(),this.div},updateScale:function(){var a;if(this.geodesic===!0){var b=this.map.getUnits();if(!b)return;var c=OpenLayers.INCHES_PER_UNIT;a=(this.map.getGeodesicPixelSize().w||1e-6)*c.km*OpenLayers.DOTS_PER_INCH}else a=this.map.getScale();a&&(a=a>=9500&&95e4>=a?Math.round(a/1e3)+"K":a>=95e4?Math.round(a/1e6)+"M":Math.round(a),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:a}))},CLASS_NAME:"OpenLayers.Control.Scale"}),OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),(null==d||null==d.isBaseLayer)&&(this.isBaseLayer="true"!=this.transparent&&1!=this.transparent),d&&null!=d.useOverlay&&(this.useOverlay=d.useOverlay),this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b,c=a.getCenterLonLat(),d=this.map.getSize();if(this.singleTile){var e={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:d.h*this.ratio,setdisplaywidth:d.w*this.ratio,setviewcenterx:c.lon,setviewcentery:c.lat,setviewscale:this.map.getScale()};if(this.useOverlay&&!this.useAsyncOverlay){var f={};f=OpenLayers.Util.extend(f,e),f.operation="GETVISIBLEMAPEXTENT",f.version="1.0.0",f.session=this.params.session,f.mapName=this.params.mapName,f.format="text/xml",b=this.getFullRequestString(f),OpenLayers.Request.GET({url:b,async:!1})}b=this.getFullRequestString(e)}else{var g=this.map.getResolution(),h=Math.floor((a.left-this.maxExtent.left)/g);h=Math.round(h/this.tileSize.w);var i=Math.floor((this.maxExtent.top-a.top)/g);i=Math.round(i/this.tileSize.h),b=this.useHttpTile?this.getImageFilePath({tilecol:h,tilerow:i,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:h,tilerow:i,scaleindex:this.resolutions.length-this.map.zoom-1})}return b},getFullRequestString:function(a,b){var c=null==b?this.url:b;"object"==typeof c&&(c=c[Math.floor(Math.random()*c.length)]);var d=c,e=OpenLayers.Util.extend({},this.params);e=OpenLayers.Util.extend(e,a);var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(var g in e)g.toUpperCase()in f&&delete e[g];var h=OpenLayers.Util.getParameterString(e);if(h=h.replace(/,/g,"+"),""!=h){var i=c.charAt(c.length-1);d+="&"==i||"?"==i?h:-1==c.indexOf("?")?"?"+h:"&"+h}return d},getImageFilePath:function(a,b){var c=null==b?this.url:b;"object"==typeof c&&(c=c[Math.floor(Math.random()*c.length)]);var d=c,e="",f="";a.tilerow<0&&(e="-"),e+=0==a.tilerow?"0":Math.floor(Math.abs(a.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder,a.tilecol<0&&(f="-"),f+=0==a.tilecol?"0":Math.floor(Math.abs(a.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder;var g="/S"+Math.floor(a.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+e+"/C"+f+"/"+a.tilerow%this.params.tileRowsPerFolder+"_"+a.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format;return this.params.querystring&&(g+="?"+this.params.querystring),d+=g},CLASS_NAME:"OpenLayers.Layer.MapGuide"}),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);var c={done:this.measureComplete,point:this.measurePartial};this.immediate&&(c.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(c,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new a(this,this.callbacks,this.handlerOptions)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay(),this.handler.cancel()},setImmediate:function(a){this.immediate=a,this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(a,b){var c=this.active;c&&this.deactivate(),this.handler=new a(this,this.callbacks,b),c&&this.activate()},measureComplete:function(a){this.cancelDelay(),this.measure(a,"measure")},measurePartial:function(a,b){this.cancelDelay(),b=b.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(b,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(b,"measurepartial")},this),this.partialDelay)},measureImmediate:function(a,b,c){c&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(b.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(a,b){var c,d;a.CLASS_NAME.indexOf("LineString")>-1?(c=this.getBestLength(a),d=1):(c=this.getBestArea(a),d=2),this.events.triggerEvent(b,{measure:c[0],units:c[1],order:d,geometry:a})},getBestArea:function(a){for(var b,c,d=this.displaySystemUnits[this.displaySystem],e=0,f=d.length;f>e&&(b=d[e],c=this.getArea(a,b),!(c>1));++e);return[c,b]},getArea:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicArea(this.map.getProjectionObject()),d="m"):(c=a.getArea(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];if(e){var f=OpenLayers.INCHES_PER_UNIT[d];c*=Math.pow(f/e,2)}return c},getBestLength:function(a){for(var b,c,d=this.displaySystemUnits[this.displaySystem],e=0,f=d.length;f>e&&(b=d[e],c=this.getLength(a,b),!(c>1));++e);return[c,b]},getLength:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicLength(this.map.getProjectionObject()),d="m"):(c=a.getLength(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];if(e){var f=OpenLayers.INCHES_PER_UNIT[d];c*=f/e}return c},CLASS_NAME:"OpenLayers.Control.Measure"}),OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_wmc_SRS:function(a,b){var c=this.getChildValue(b);"object"!=typeof a.projections&&(a.projections={});for(var d=c.split(/ +/),e=0,f=d.length;f>e;e++)a.projections[d[e]]=!0},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);if(a.srs){var c=[];for(var d in a.srs)c.push(d);b.appendChild(this.createElementDefaultNS("SRS",c.join(" ")))}b.appendChild(this.write_wmc_FormatList(a)),b.appendChild(this.write_wmc_StyleList(a)),a.dimensions&&b.appendChild(this.write_wmc_DimensionList(a)),b.appendChild(this.write_wmc_LayerExtension(a))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"}),OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(a,b,c,d,e,f,g){var h=[a,b,c,d,f,g];OpenLayers.Popup.prototype.initialize.apply(this,h),this.anchor=null!=e?e:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null,this.relativePosition=null,OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition(),OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(a){var b=this.relativePosition;this.relativePosition=this.calculateRelativePosition(a),OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(a)),this.relativePosition!=b&&this.updateRelativePosition()},setSize:function(){if(OpenLayers.Popup.prototype.setSize.apply(this,arguments),this.lonlat&&this.map){var a=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(a)}},calculateRelativePosition:function(a){var b=this.map.getLonLatFromLayerPx(a),c=this.map.getExtent(),d=c.determineQuadrant(b);return OpenLayers.Bounds.oppositeQuadrant(d)},updateRelativePosition:function(){},calculateNewPx:function(a){var b=a.offset(this.anchor.offset),c=this.size||this.contentSize,d="t"==this.relativePosition.charAt(0);b.y+=d?-c.h:this.anchor.size.h;var e="l"==this.relativePosition.charAt(1);return b.x+=e?-c.w:this.anchor.size.w,b},CLASS_NAME:"OpenLayers.Popup.Anchored"}),OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(a,b,c,d,e,f){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments),this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(){return this.relativePosition}),this.contentDiv.style.position="absolute",this.contentDiv.style.zIndex=1,f&&(this.closeDiv.style.zIndex=1),this.groupDiv.style.position="absolute",this.groupDiv.style.top="0px",this.groupDiv.style.left="0px",this.groupDiv.style.height="100%",this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null,this.imageSize=null,this.isAlphaImage=null,this.fixedRelativePosition=!1,this.positionBlocks=null;for(var a=0;a<this.blocks.length;a++){var b=this.blocks[a];b.image&&b.div.removeChild(b.image),b.image=null,b.div&&this.groupDiv.removeChild(b.div),b.div=null}this.blocks=null,OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(){},setBorder:function(){},setOpacity:function(){},setSize:function(){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.updateBlocks()},updateRelativePosition:function(){if(this.padding=this.positionBlocks[this.relativePosition].padding,this.closeDiv){var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+this.padding.right+"px",this.closeDiv.style.top=a.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(){var a=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return a=a.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var a=null;for(var b in this.positionBlocks){a=b;break}for(var c=this.positionBlocks[a],d=0;d<c.blocks.length;d++){var e={};this.blocks.push(e);var f=this.id+"_FrameDecorationDiv_"+d;e.div=OpenLayers.Util.createDiv(f,null,null,null,"absolute",null,"hidden",null);var g=this.id+"_FrameDecorationImg_"+d,h=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;e.image=h(g,null,this.imageSize,this.imageSrc,"absolute",null,null,null),e.div.appendChild(e.image),this.groupDiv.appendChild(e.div)}},updateBlocks:function(){if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(var a=this.positionBlocks[this.relativePosition],b=0;b<a.blocks.length;b++){var c=a.blocks[b],d=this.blocks[b],e=c.anchor.left,f=c.anchor.bottom,g=c.anchor.right,h=c.anchor.top,i=isNaN(c.size.w)?this.size.w-(g+e):c.size.w,j=isNaN(c.size.h)?this.size.h-(f+h):c.size.h;d.div.style.width=(0>i?0:i)+"px",d.div.style.height=(0>j?0:j)+"px",d.div.style.left=null!=e?e+"px":"",d.div.style.bottom=null!=f?f+"px":"",d.div.style.right=null!=g?g+"px":"",d.div.style.top=null!=h?h+"px":"",d.image.style.left=c.position.x+"px",d.image.style.top=c.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px",this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"}),OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png"),OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments),this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"}),OpenLayers.Tile.Image.IFrame={useIFrame:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",draw:function(){var a=OpenLayers.Tile.Image.prototype.shouldDraw.call(this);if(a){var b=this.layer.getURL(this.bounds),c=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&b.length>this.maxGetUrlLength;var d=c&&!this.useIFrame,e=!c&&this.useIFrame;(d||e)&&(this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,d&&this.frame.removeChild(this.frame.firstChild))}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(this.useIFrame===!0){if(!this.frame.childNodes.length){var a=document.createElement("div"),b=a.style;b.position="absolute",b.width="100%",b.height="100%",b.zIndex=1,b.backgroundImage="url("+this.blankImageUrl+")",this.frame.appendChild(a)}var c,d=this.id+"_iFrame";return parseFloat(navigator.appVersion.split("MSIE")[1])<9?(c=document.createElement('<iframe name="'+d+'">'),c.style.backgroundColor="#FFFFFF",c.style.filter="chroma(color=#FFFFFF)"):(c=document.createElement("iframe"),c.style.backgroundColor="transparent",c.name=d),c.scrolling="no",c.marginWidth="0px",c.marginHeight="0px",c.frameBorder="0",c.style.position="absolute",c.style.width="100%",c.style.height="100%",this.layer.opacity<1&&OpenLayers.Util.modifyDOMElement(c,null,null,null,null,null,null,this.layer.opacity),this.frame.appendChild(c),this.imgDiv=c,c}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var a=document.createElement("form");a.method="POST";var b=this.layer.params._OLSALT;b=(b?b+"_":"")+this.bounds.toBBOX(),a.action=OpenLayers.Util.urlAppend(this.layer.url,b),a.target=this.id+"_iFrame";
var c,d=(this.layer.getImageSize(),OpenLayers.Util.getParameters(this.url));for(var e in d)c=document.createElement("input"),c.type="hidden",c.name=e,c.value=d[e],a.appendChild(c);return a},setImgSrc:function(a){if(this.useIFrame===!0)if(a){var b=this.createRequestForm();this.frame.appendChild(b),b.submit(),this.frame.removeChild(b)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments),this.useIFrame===!0&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var a;return this.useIFrame===!1&&(a=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this)),a}},OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"}),OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),this.options=a},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{gml:OpenLayers.Util.applyDefaults({name:function(a,b){b.name=this.getChildValue(a)},TimePeriod:function(a,b){b.timePeriod={},this.readChildNodes(a,b.timePeriod)},beginPosition:function(a,b){b.beginPosition=this.getChildValue(a)},endPosition:function(a,b){b.endPosition=this.getChildValue(a)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={},this.readChildNodes(a,b.contents)},ObservationOfferingList:function(a,b){b.offeringList={},this.readChildNodes(a,b.offeringList)},ObservationOffering:function(a,b){var c=this.getAttributeNS(a,this.namespaces.gml,"id");b[c]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]},this.readChildNodes(a,b[c])},time:function(a,b){b.time={},this.readChildNodes(a,b.time)},procedure:function(a,b){b.procedures.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},observedProperty:function(a,b){b.observedProperties.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},featureOfInterest:function(a,b){b.featureOfInterestIds.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},responseFormat:function(a,b){b.responseFormats.push(this.getChildValue(a))},resultModel:function(a,b){b.resultModels.push(this.getChildValue(a))},responseMode:function(a,b){b.responseModes.push(this.getChildValue(a))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(a){var b=!0;if(this.pinching=!1,OpenLayers.Event.isMultiTouch(a))this.started=!0,this.last=this.start={distance:this.getDistance(a.touches),delta:0,scale:1},this.callback("start",[a,this.start]),b=!this.stopDown;else{if(this.started)return!1;this.started=!1,this.start=null,this.last=null}return OpenLayers.Event.preventDefault(a),b},touchmove:function(a){if(this.started&&OpenLayers.Event.isMultiTouch(a)){this.pinching=!0;var b=this.getPinchData(a);this.callback("move",[a,b]),this.last=b,OpenLayers.Event.stop(a)}else if(this.started)return!1;return!0},touchend:function(a){return this.started&&!OpenLayers.Event.isMultiTouch(a)?(this.started=!1,this.pinching=!1,this.callback("done",[a,this.start,this.last]),this.start=null,this.last=null,!1):!0},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.pinching=!1,this.start=null,this.last=null,a=!0),a},getDistance:function(a){var b=a[0],c=a[1];return Math.sqrt(Math.pow(b.olClientX-c.olClientX,2)+Math.pow(b.olClientY-c.olClientY,2))},getPinchData:function(a){var b=this.getDistance(a.touches),c=b/this.start.distance;return{distance:b,delta:this.last.distance-b,scale:c}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),a},CLASS_NAME:"OpenLayers.Control.NavToolbar"}),OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&(this.layer.visibility===!0&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this})),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&(this.stop(),this.layer.events.un({visibilitychanged:this.reset,scope:this})),a},reset:function(){this.layer.visibility===!0?this.start():this.stop()},start:function(){this.interval&&"number"==typeof this.interval&&this.interval>0&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&this.layer.refresh&&"function"==typeof this.layer.refresh&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"}),OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c),e.push(a,b,c,d),OpenLayers.Layer.Grid.prototype.initialize.apply(this,e),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"jpg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.projection.getCode().split(":"),c=b[b.length-1],d=this.getImageSize(),e={BBOX:a.toBBOX(),SIZE:d.w+","+d.h,F:"image",BBOXSR:c,IMAGESR:c};if(this.layerDefs){var f,g=[];for(f in this.layerDefs)this.layerDefs.hasOwnProperty(f)&&this.layerDefs[f]&&(g.push(f),g.push(":"),g.push(this.layerDefs[f]),g.push(";"));g.length>0&&(e.LAYERDEFS=g.join(""))}var h=this.getFullRequestString(e);return h},setLayerFilter:function(a,b){this.layerDefs||(this.layerDefs={}),b?this.layerDefs[a]=b:delete this.layerDefs[a]},clearLayerFilter:function(a){a?delete this.layerDefs[a]:delete this.layerDefs},mergeNewParams:function(a){var b=OpenLayers.Util.upperCaseObject(a),c=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,c)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"}),OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(a){return this.passesTolerance(a.xy)&&(this.clearTimer(),this.callback("move",[a]),this.px=a.xy,a=OpenLayers.Util.extend({},a),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)),!this.stopMove},mouseout:function(a){return OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[a])),!0},passesTolerance:function(a){var b=!0;if(this.pixelTolerance&&this.px){var c=Math.sqrt(Math.pow(this.px.x-a.x,2)+Math.pow(this.px.y-a.y,2));c<this.pixelTolerance&&(b=!1)}return b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(a){this.callback("pause",[a])},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),a=!0),a},CLASS_NAME:"OpenLayers.Handler.Hover"}),OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(a){a.handlerOptions=a.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.features={},this.handlers={},this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})),this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))),this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active)for(var a in this.handlers)this.handlers[a].activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active)for(var a in this.handlers)this.handlers[a].deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(a){var b=this.pixelToBounds(a.xy);this.setModifiers(a),this.request(b,{single:this.single})},selectBox:function(a){var b;if(a instanceof OpenLayers.Bounds){var c=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),d=this.map.getLonLatFromPixel({x:a.right,y:a.top});b=new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)}else{if(this.click)return;b=this.pixelToBounds(a)}this.setModifiers(this.handlers.box.dragHandler.evt),this.request(b)},selectHover:function(a){var b=this.pixelToBounds(a.xy);this.request(b,{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(a,b){b=b||{};var c=new OpenLayers.Filter.Spatial({type:this.filterType,value:a});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var d=this.protocol.read({maxFeatures:1==b.single?this.maxFeatures:void 0,filter:c,callback:function(c){c.success()&&(c.features.length?1==b.single?this.selectBestFeature(c.features,a.getCenterLonLat(),b):this.select(c.features):b.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll())),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});1==b.hover&&(this.hoverResponse=d)},selectBestFeature:function(a,b,c){if(c=c||{},a.length){for(var d,e,f,g=new OpenLayers.Geometry.Point(b.lon,b.lat),h=Number.MAX_VALUE,i=0;i<a.length&&(d=a[i],!(d.geometry&&(f=g.distanceTo(d.geometry,{edge:!1}),h>f&&(h=f,e=d,0==h))));++i);1==c.hover?this.hoverSelect(e):this.select(e||a)}},setModifiers:function(a){this.modifiers={multiple:this.multiple||this.multipleKey&&a[this.multipleKey],toggle:this.toggle||this.toggleKey&&a[this.toggleKey]}},select:function(a){this.modifiers.multiple||this.modifiers.toggle||this.unselectAll(),OpenLayers.Util.isArray(a)||(a=[a]);var b=this.events.triggerEvent("beforefeaturesselected",{features:a});if(b!==!1){for(var c,d=[],e=0,f=a.length;f>e;++e)c=a[e],this.features[c.fid||c.id]?this.modifiers.toggle&&this.unselect(this.features[c.fid||c.id]):(b=this.events.triggerEvent("beforefeatureselected",{feature:c}),b!==!1&&(this.features[c.fid||c.id]=c,d.push(c),this.events.triggerEvent("featureselected",{feature:c})));this.events.triggerEvent("featuresselected",{features:d})}},hoverSelect:function(a){var b=a?a.fid||a.id:null,c=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;c&&c!=b&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null),b&&b!=c&&(this.events.triggerEvent("hoverfeature",{feature:a}),this.hoverFeature=a)},unselect:function(a){delete this.features[a.fid||a.id],this.events.triggerEvent("featureunselected",{feature:a})},unselectAll:function(){for(var a in this.features)this.unselect(this.features[a])},setMap:function(a){for(var b in this.handlers)this.handlers[b].setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(a){var b=a.add(-this.clickTolerance/2,this.clickTolerance/2),c=a.add(this.clickTolerance/2,-this.clickTolerance/2),d=this.map.getLonLatFromPixel(b),e=this.map.getLonLatFromPixel(c);return new OpenLayers.Bounds(d.lon,d.lat,e.lon,e.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"}),OpenLayers.Format.QueryStringFilter=function(){function a(a){return a=a.replace(/%/g,"\\%"),a=a.replace(/\\\\\.(\*)?/g,function(a,b){return b?a:"\\\\_"}),a=a.replace(/\\\\\.\*/g,"\\\\%"),a=a.replace(/(\\)?\.(\*)?/g,function(a,b,c){return b||c?a:"_"}),a=a.replace(/(\\)?\.\*/g,function(a,b){return b?a:"%"}),a=a.replace(/\\\./g,"."),a=a.replace(/(\\)?\\\*/g,function(a,b){return b?a:"*"})}var b={};return b[OpenLayers.Filter.Comparison.EQUAL_TO]="eq",b[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne",b[OpenLayers.Filter.Comparison.LESS_THAN]="lt",b[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",b[OpenLayers.Filter.Comparison.GREATER_THAN]="gt",b[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",b[OpenLayers.Filter.Comparison.LIKE]="ilike",OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(c,d){d=d||{};var e=c.CLASS_NAME,f=e.substring(e.lastIndexOf(".")+1);switch(f){case"Spatial":switch(c.type){case OpenLayers.Filter.Spatial.BBOX:d.bbox=c.value.toArray(),this.srsInBBOX&&c.projection&&d.bbox.push(c.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:d.tolerance=c.distance;case OpenLayers.Filter.Spatial.WITHIN:d.lon=c.value.x,d.lat=c.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+c.type)}break;case"Comparison":var g=b[c.type];if(void 0!==g){var h=c.value;c.type==OpenLayers.Filter.Comparison.LIKE&&(h=a(h),this.wildcarded&&(h="%"+h+"%")),d[c.property+"__"+g]=h,d.queryable=d.queryable||[],d.queryable.push(c.property)}else OpenLayers.Console.warn("Unknown comparison filter type "+c.type);break;case"Logical":if(c.type===OpenLayers.Filter.Logical.AND)for(var i=0,j=c.filters.length;j>i;i++)d=this.write(c.filters[i],d);else OpenLayers.Console.warn("Unsupported logical filter type "+c.type);break;default:OpenLayers.Console.warn("Unknown filter type "+f)}return d},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}(),OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0):!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.div.left="",this.div.top="",this.element=this.div),this.div},redraw:function(a){var b;if(null==a)return void this.reset();if(null==this.lastXy||Math.abs(a.xy.x-this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity)return void(this.lastXy=a.xy);if(b=this.map.getLonLatFromPixel(a.xy)){this.displayProjection&&b.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=a.xy;var c=this.formatOutput(b);c!=this.element.innerHTML&&(this.element.innerHTML=c)}},reset:function(){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(a){var b=parseInt(this.numDigits),c=this.prefix+a.lon.toFixed(b)+this.separator+a.lat.toFixed(b)+this.suffix;return c},CLASS_NAME:"OpenLayers.Control.MousePosition"}),OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:null,available:"geolocation"in navigator,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.available&&!this.geolocation&&(this.geolocation=navigator.geolocation),this.geolocation?OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1:(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){return this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(a){var b=new OpenLayers.LonLat(a.coords.longitude,a.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(b),this.events.triggerEvent("locationupdated",{position:a,point:new OpenLayers.Geometry.Point(b.lon,b.lat)})},getCurrentLocation:function(){return!this.active||this.watch?!1:(this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions),!0)},failure:function(a){this.events.triggerEvent("locationfailed",{error:a})},CLASS_NAME:"OpenLayers.Control.Geolocate"}),OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear(),OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(a)if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var b=new OpenLayers.Protocol.Script({url:this.url,callback:function(a){this.isLoading=!1,this.events.triggerEvent("loadend"),this.json=a.data},scope:this});b.read(),this.request=b}else this.request=OpenLayers.Request.GET({url:this.url,callback:function(a){this.isLoading=!1,this.events.triggerEvent("loadend"),200===a.status&&this.parseData(a.responseText)},scope:this});else this.unload();return a},abortLoading:function(){this.request&&(this.request.abort(),delete this.request),this.isLoading=!1},getFeatureInfo:function(a,b){var c=null;if(this.json){var d=this.getFeatureId(a,b);null!==d&&(c={id:d,data:this.json.data[d]})}return c},getFeatureId:function(a,b){var c=null;if(this.json){var d=this.utfgridResolution,e=Math.floor(b/d),f=Math.floor(a/d),g=this.json.grid[e].charCodeAt(f),h=this.indexFromCharCode(g),i=this.json.keys;!isNaN(h)&&h in i&&(c=i[h])}return c},indexFromCharCode:function(a){return a>=93&&a--,a>=35&&a--,a-32},parseData:function(a){this.format||(this.format=new OpenLayers.Format.JSON),this.json=this.format.read(a)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"}),OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(a){if(a=a||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(a,c){return b.write(a,c)}}},destroy:function(){this.params=null,this.headers=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=a||{},a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params),a=OpenLayers.Util.applyDefaults(a,this.options),a.filter&&this.filterToParams&&(a.params=this.filterToParams(a.filter,a.params));var b=void 0!==a.readWithPOST?a.readWithPOST:this.readWithPOST,c=new OpenLayers.Protocol.Response({requestType:"read"});if(b){var d=a.headers||{};d["Content-Type"]="application/x-www-form-urlencoded",c.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,c,a),data:OpenLayers.Util.getParameterString(a.params),headers:d})}else c.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,c,a),params:a.params,headers:a.headers});return c},handleRead:function(a,b){this.handleResponse(a,b)},create:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"create"});return c.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleCreate,c,b),headers:b.headers,data:this.format.write(a)}),c},handleCreate:function(a,b){this.handleResponse(a,b)},update:function(a,b){b=b||{};var c=b.url||a.url||this.options.url+"/"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"update"}),e=this.updateWithPOST?"POST":"PUT";return d.priv=OpenLayers.Request[e]({url:c,callback:this.createCallback(this.handleUpdate,d,b),headers:b.headers,data:this.format.write(a)}),d},handleUpdate:function(a,b){this.handleResponse(a,b)},"delete":function(a,b){b=b||{};var c=b.url||a.url||this.options.url+"/"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"delete"}),e=this.deleteWithPOST?"POST":"DELETE",f={url:c,callback:this.createCallback(this.handleDelete,d,b),headers:b.headers};return this.deleteWithPOST&&(f.data=this.format.write(a)),d.priv=OpenLayers.Request[e](f),d},handleDelete:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){var c=a.priv;b.callback&&(c.status>=200&&c.status<300?("delete"!=a.requestType&&(a.features=this.parseFeatures(c)),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a))},parseFeatures:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),!b||b.length<=0?null:this.format.read(b)},commit:function(a,b){function c(a){for(var b=a.features?a.features.length:0,c=new Array(b),e=0;b>e;++e)c[e]=a.features[e].fid;o.insertIds=c,d.apply(this,[a])}function d(a){this.callUserCallback(a,b),n=n&&a.success(),f++,f>=m&&b.callback&&(o.code=n?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,b.callback.apply(b.scope,[o]))}b=OpenLayers.Util.applyDefaults(b,this.options);var e=[],f=0,g={};g[OpenLayers.State.INSERT]=[],g[OpenLayers.State.UPDATE]=[],g[OpenLayers.State.DELETE]=[];for(var h,i,j=[],k=0,l=a.length;l>k;++k)h=a[k],i=g[h.state],i&&(i.push(h),j.push(h));var m=(g[OpenLayers.State.INSERT].length>0?1:0)+g[OpenLayers.State.UPDATE].length+g[OpenLayers.State.DELETE].length,n=!0,o=new OpenLayers.Protocol.Response({reqFeatures:j}),p=g[OpenLayers.State.INSERT];p.length>0&&e.push(this.create(p,OpenLayers.Util.applyDefaults({callback:c,scope:this},b.create))),p=g[OpenLayers.State.UPDATE];for(var k=p.length-1;k>=0;--k)e.push(this.update(p[k],OpenLayers.Util.applyDefaults({callback:d,scope:this},b.update)));p=g[OpenLayers.State.DELETE];for(var k=p.length-1;k>=0;--k)e.push(this["delete"](p[k],OpenLayers.Util.applyDefaults({callback:d,scope:this},b["delete"])));return e},abort:function(a){a&&a.priv.abort()},callUserCallback:function(a,b){var c=b[a.requestType];c&&c.callback&&c.callback.call(c.scope,a)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this}),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this})),a},cacheFeatures:function(a){var b=!0;return this.clustering||(this.clearCache(),this.features=a.features,this.cluster(),b=!1),b},clearCache:function(){this.clustering||(this.features=null)},cluster:function(a){if((!a||a.zoomChanged)&&this.features){var b=this.layer.map.getResolution();if(b!=this.resolution||!this.clustersExist()){this.resolution=b;for(var c,d,e,f=[],g=0;g<this.features.length;++g)if(c=this.features[g],c.geometry){d=!1;for(var h=f.length-1;h>=0;--h)if(e=f[h],this.shouldCluster(e,c)){this.addToCluster(e,c),d=!0;break}d||f.push(this.createCluster(this.features[g]))}if(this.clustering=!0,this.layer.removeAllFeatures(),this.clustering=!1,f.length>0){if(this.threshold>1){var i=f.slice();f=[];for(var j,g=0,k=i.length;k>g;++g)j=i[g],j.attributes.count<this.threshold?Array.prototype.push.apply(f,j.cluster):f.push(j)}this.clustering=!0,this.layer.addFeatures(f),this.clustering=!1}this.clusters=f}}},clustersExist:function(){var a=!1;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){a=!0;for(var b=0;b<this.clusters.length;++b)if(this.clusters[b]!=this.layer.features[b]){a=!1;break}}return a},shouldCluster:function(a,b){var c=a.geometry.getBounds().getCenterLonLat(),d=b.geometry.getBounds().getCenterLonLat(),e=Math.sqrt(Math.pow(c.lon-d.lon,2)+Math.pow(c.lat-d.lat,2))/this.resolution;return e<=this.distance},addToCluster:function(a,b){a.cluster.push(b),a.attributes.count+=1},createCluster:function(a){var b=a.geometry.getBounds().getCenterLonLat(),c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),{count:1});return c.cluster=[a],c},CLASS_NAME:"OpenLayers.Strategy.Cluster"}),OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return a&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})),a},deactivate:function(){return this.cache=null,this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}),OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(a){if(!this.caching&&this.filter){var b=a.features;a.features=[];for(var c,d=0,e=b.length;e>d;++d)c=b[d],this.filter.evaluate(c)?a.features.push(c):this.cache.push(c)}},handleRemove:function(){this.caching||(this.cache=[])},setFilter:function(a){this.filter=a;var b=this.cache;if(this.cache=[],this.handleAdd({features:this.layer.features}),this.cache.length>0&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1),b.length>0){var c={features:b};this.handleAdd(c),c.features.length>0&&(this.caching=!0,this.layer.addFeatures(c.features),this.caching=!1)}},CLASS_NAME:"OpenLayers.Strategy.Filter"}),OpenLayers.Protocol.SOS=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.SOS.DEFAULTS);var b=OpenLayers.Protocol.SOS["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported SOS version: "+a.version;return new b(a)},OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g},namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(a,b){var c,d,e=[],f={},g={complexTypes:e,customTypes:f};this.readChildNodes(a,g);var h,i,j=a.attributes;for(c=0,d=j.length;d>c;++c)h=j[c],i=h.name,0===i.indexOf("xmlns")?this.setNamespace(i.split(":")[1]||"",h.value):b[i]=h.value;b.featureTypes=e,b.targetPrefix=this.namespaceAlias[b.targetNamespace];var k,l;for(c=0,d=e.length;d>c;++c)k=e[c],l=f[k.typeName],f[k.typeName]&&(k.typeName=l.name)},complexType:function(a,b){var c={typeName:a.getAttribute("name")};this.readChildNodes(a,c),b.complexTypes.push(c)},complexContent:function(a,b){this.readChildNodes(a,b)},extension:function(a,b){this.readChildNodes(a,b)},sequence:function(a,b){var c={elements:[]};this.readChildNodes(a,c),b.properties=c.elements},element:function(a,b){var c;if(b.elements){for(var d,e={},f=a.attributes,g=0,h=f.length;h>g;++g)d=f[g],e[d.name]=d.value;c=e.type,c||(c={},this.readChildNodes(a,c),e.restriction=c,e.type=c.base);var i=c.base||c;e.localType=i.split(":").pop(),b.elements.push(e),this.readChildNodes(a,e)}if(b.complexTypes){c=a.getAttribute("type");var j=c.split(":").pop();b.customTypes[j]={name:a.getAttribute("name"),type:c}}},annotation:function(a,b){b.annotation={},this.readChildNodes(a,b.annotation)},appinfo:function(a,b){b.appinfo||(b.appinfo=[]),b.appinfo.push(this.getChildValue(a))},documentation:function(a,b){b.documentation||(b.documentation=[]);var c=this.getChildValue(a);b.documentation.push({lang:a.getAttribute("xml:lang"),textContent:c.replace(this.regExes.trimSpace,"")})},simpleType:function(a,b){this.readChildNodes(a,b)},restriction:function(a,b){b.base=a.getAttribute("base"),this.readRestriction(a,b)}}},readRestriction:function(a,b){for(var c,d,e,f=a.childNodes,g=0,h=f.length;h>g;++g)c=f[g],1==c.nodeType&&(d=c.nodeName.split(":").pop(),e=c.getAttribute("value"),b[d]?("string"==typeof b[d]&&(b[d]=[b[d]]),b[d].push(e)):b[d]=e)},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};if("ExceptionReport"===a.nodeName.split(":").pop()){var c=new OpenLayers.Format.OGCExceptionReport;b.error=c.read(a)}else this.readNode(a,b);return b},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"}),OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(a){var b=this.getElementsByTagNameNS(a,this.georssns,"point"),c=this.getElementsByTagNameNS(a,this.geons,"lat"),d=this.getElementsByTagNameNS(a,this.geons,"long"),e=this.getElementsByTagNameNS(a,this.georssns,"line"),f=this.getElementsByTagNameNS(a,this.georssns,"polygon"),g=this.getElementsByTagNameNS(a,this.georssns,"where"),h=this.getElementsByTagNameNS(a,this.georssns,"box");if(b.length>0||c.length>0&&d.length>0){var i;b.length>0?(i=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s+/),2!=i.length&&(i=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s*,\s*/))):i=[parseFloat(c[0].firstChild.nodeValue),parseFloat(d[0].firstChild.nodeValue)];var j=new OpenLayers.Geometry.Point(i[1],i[0])}else if(e.length>0){for(var b,k=OpenLayers.String.trim(this.getChildValue(e[0])).split(/\s+/),l=[],m=0,n=k.length;n>m;m+=2)b=new OpenLayers.Geometry.Point(k[m+1],k[m]),l.push(b);j=new OpenLayers.Geometry.LineString(l)}else if(f.length>0){for(var b,k=OpenLayers.String.trim(this.getChildValue(f[0])).split(/\s+/),l=[],m=0,n=k.length;n>m;m+=2)b=new OpenLayers.Geometry.Point(k[m+1],k[m]),l.push(b);
j=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)])}else if(g.length>0){this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy}));var o=this.gmlParser.parseFeature(g[0]);j=o.geometry}else if(h.length>0){var b,k=OpenLayers.String.trim(h[0].firstChild.nodeValue).split(/\s+/),l=[];k.length>3&&(b=new OpenLayers.Geometry.Point(k[1],k[0]),l.push(b),b=new OpenLayers.Geometry.Point(k[1],k[2]),l.push(b),b=new OpenLayers.Geometry.Point(k[3],k[2]),l.push(b),b=new OpenLayers.Geometry.Point(k[3],k[0]),l.push(b),b=new OpenLayers.Geometry.Point(k[1],k[0]),l.push(b)),j=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)])}return j&&this.internalProjection&&this.externalProjection&&j.transform(this.externalProjection,this.internalProjection),j},createFeatureFromItem:function(a){var b=this.createGeometryFromItem(a),c=this._getChildValue(a,"*","title",this.featureTitle),d=this._getChildValue(a,"*","description",this._getChildValue(a,"*","content",this._getChildValue(a,"*","summary",this.featureDescription))),e=this._getChildValue(a,"*","link");if(!e)try{e=this.getElementsByTagNameNS(a,"*","link")[0].getAttribute("href")}catch(f){e=null}var g=this._getChildValue(a,"*","id",null),h={title:c,description:d,link:e},i=new OpenLayers.Feature.Vector(b,h);return i.fid=g,i},_getChildValue:function(a,b,c,d){var e,f=this.getElementsByTagNameNS(a,b,c);return e=f&&f[0]&&f[0].firstChild&&f[0].firstChild.nodeValue?this.getChildValue(f[0]):void 0==d?"":d},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null;b=this.getElementsByTagNameNS(a,"*","item"),0==b.length&&(b=this.getElementsByTagNameNS(a,"*","entry"));for(var c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=this.createFeatureFromItem(b[e]);return d},write:function(a){var b;if(OpenLayers.Util.isArray(a)){b=this.createElementNS(this.rssns,"rss");for(var c=0,d=a.length;d>c;c++)b.appendChild(this.createFeatureXML(a[c]))}else b=this.createFeatureXML(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.rssns,"item"),d=this.createElementNS(this.rssns,"title");d.appendChild(this.createTextNode(a.attributes.title?a.attributes.title:""));var e=this.createElementNS(this.rssns,"description");if(e.appendChild(this.createTextNode(a.attributes.description?a.attributes.description:"")),c.appendChild(d),c.appendChild(e),a.attributes.link){var f=this.createElementNS(this.rssns,"link");f.appendChild(this.createTextNode(a.attributes.link)),c.appendChild(f)}for(var g in a.attributes)if("link"!=g&&"title"!=g&&"description"!=g){var h=this.createTextNode(a.attributes[g]),i=g;-1!=g.search(":")&&(i=g.split(":")[1]);var j=this.createElementNS(this.featureNS,"feature:"+i);j.appendChild(h),c.appendChild(j)}return c.appendChild(b),c},buildGeometryNode:function(a){this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b;if("OpenLayers.Geometry.Polygon"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:polygon"),b.appendChild(this.buildCoordinatesNode(a.components[0]));else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:line"),b.appendChild(this.buildCoordinatesNode(a));else{if("OpenLayers.Geometry.Point"!=a.CLASS_NAME)throw"Couldn't parse "+a.CLASS_NAME;b=this.createElementNS(this.georssns,"georss:point"),b.appendChild(this.buildCoordinatesNode(a))}return b},buildCoordinatesNode:function(a){var b=null;a.components&&(b=a.components);var c;if(b){for(var d=b.length,e=new Array(d),f=0;d>f;f++)e[f]=b[f].y+" "+b[f].x;c=e.join(" ")}else c=a.y+" "+a.x;return this.createTextNode(c)},CLASS_NAME:"OpenLayers.Format.GeoRSS"}),OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"}),OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{wps:{Capabilities:function(a,b){this.readChildNodes(a,b)},ProcessOfferings:function(a,b){b.processOfferings={},this.readChildNodes(a,b.processOfferings)},Process:function(a,b){var c=this.getAttributeNS(a,this.namespaces.wps,"processVersion"),d={processVersion:c};this.readChildNodes(a,d),b[d.identifier]=d},Languages:function(a,b){b.languages=[],this.readChildNodes(a,b.languages)},Default:function(a,b){var c={isDefault:!0};this.readChildNodes(a,c),b.push(c)},Supported:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"}),OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(a){var b=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):a.xy;this.pinchOrigin=b,this.currentCenter=b},pinchMove:function(a,b){var c=b.scale,d=this.map.layerContainerOriginPx,e=this.pinchOrigin,f=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):a.xy,g=Math.round(d.x+f.x-e.x+(c-1)*(d.x-e.x)),h=Math.round(d.y+f.y-e.y+(c-1)*(d.y-e.y));this.map.applyTransform(g,h,c),this.currentCenter=f},pinchDone:function(a,b,c){this.map.applyTransform();var d=this.map.getZoomForResolution(this.map.getResolution()/c.scale,!0);if(d!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var e=this.map.getResolutionForZoom(d),f=this.map.getLonLatFromPixel(this.pinchOrigin),g=this.currentCenter,h=this.map.getSize();f.lon+=e*(h.w/2-g.x),f.lat-=e*(h.h/2-g.y),this.map.div.clientWidth=this.map.div.clientWidth,this.map.setCenter(f,d)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"}),OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var a={click:this.defaultClick,dblclick:this.defaultDblClick},b=OpenLayers.Util.extend({"double":!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,a,b),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.dragPan.draw(),this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(a){a.lastTouches&&2==a.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(a){this.map.zoomTo(this.map.zoom+1,a.xy)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"}),OpenLayers.Console.warn("OpenLayers.Rico is deprecated"),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(a,b,c){this.rgb={r:a,g:b,b:c}},setRed:function(a){this.rgb.r=a},setGreen:function(a){this.rgb.g=a},setBlue:function(a){this.rgb.b=a},setHue:function(a){var b=this.asHSB();b.h=a,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setSaturation:function(a){var b=this.asHSB();b.s=a,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setBrightness:function(a){var b=this.asHSB();b.b=a,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},darken:function(a){var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.max(b.b-a,0))},brighten:function(a){var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.min(b.b+a,1))},blend:function(a){this.rgb.r=Math.floor((this.rgb.r+a.rgb.r)/2),this.rgb.g=Math.floor((this.rgb.g+a.rgb.g)/2),this.rgb.b=Math.floor((this.rgb.b+a.rgb.b)/2)},isBright:function(){this.asHSB();return this.asHSB().b>.5},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}}),OpenLayers.Rico.Color.createFromHex=function(a){if(4==a.length)for(var b=a,a="#",c=1;4>c;c++)a+=b.charAt(c)+b.charAt(c);0==a.indexOf("#")&&(a=a.substring(1));var d=a.substring(0,2),e=a.substring(2,4),f=a.substring(4,6);return new OpenLayers.Rico.Color(parseInt(d,16),parseInt(e,16),parseInt(f,16))},OpenLayers.Rico.Color.createColorFromBackground=function(a){var b=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(a),"backgroundColor");if("transparent"==b&&a.parentNode)return OpenLayers.Rico.Color.createColorFromBackground(a.parentNode);if(null==b)return new OpenLayers.Rico.Color(255,255,255);if(0==b.indexOf("rgb(")){var c=b.substring(4,b.length-1),d=c.split(",");return new OpenLayers.Rico.Color(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]))}return 0==b.indexOf("#")?OpenLayers.Rico.Color.createFromHex(b):new OpenLayers.Rico.Color(255,255,255)},OpenLayers.Rico.Color.HSBtoRGB=function(a,b,c){var d=0,e=0,f=0;if(0==b)d=parseInt(255*c+.5),e=d,f=d;else{var g=6*(a-Math.floor(a)),h=g-Math.floor(g),i=c*(1-b),j=c*(1-b*h),k=c*(1-b*(1-h));switch(parseInt(g)){case 0:d=255*c+.5,e=255*k+.5,f=255*i+.5;break;case 1:d=255*j+.5,e=255*c+.5,f=255*i+.5;break;case 2:d=255*i+.5,e=255*c+.5,f=255*k+.5;break;case 3:d=255*i+.5,e=255*j+.5,f=255*c+.5;break;case 4:d=255*k+.5,e=255*i+.5,f=255*c+.5;break;case 5:d=255*c+.5,e=255*i+.5,f=255*j+.5}}return{r:parseInt(d),g:parseInt(e),b:parseInt(f)}},OpenLayers.Rico.Color.RGBtoHSB=function(a,b,c){var d,e,f,g=a>b?a:b;c>g&&(g=c);var h=b>a?a:b;if(h>c&&(h=c),f=g/255,e=0!=g?(g-h)/g:0,0==e)d=0;else{var i=(g-a)/(g-h),j=(g-b)/(g-h),k=(g-c)/(g-h);d=a==g?k-j:b==g?2+i-k:4+j-i,d/=6,0>d&&(d+=1)}return{h:d,s:e,b:f}},OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a=0,b=this.rules.length;b>a;a++)this.rules[a].destroy();delete this.rules},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;c>b;++b)a.rules.push(this.rules[b].clone())}return new OpenLayers.Style2(a)},CLASS_NAME:"OpenLayers.Style2"}),OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(a,b){OpenLayers.Format.GML.prototype.initialize.apply(this,[a]),this.layer=b,this.layer.featureNS&&(this.featureNS=this.layer.featureNS),this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column),this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(a){var b=this.createElementNS(this.wfsns,"wfs:Transaction");b.setAttribute("version","1.0.0"),b.setAttribute("service","WFS");for(var c=0;c<a.length;c++)switch(a[c].state){case OpenLayers.State.INSERT:b.appendChild(this.insert(a[c]));break;case OpenLayers.State.UPDATE:b.appendChild(this.update(a[c]));break;case OpenLayers.State.DELETE:b.appendChild(this.remove(a[c]))}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.featureNS,"feature:"+this.geometryName);c.appendChild(b);var d=this.createElementNS(this.featureNS,"feature:"+this.featureName);d.appendChild(c);for(var e in a.attributes){var f=this.createTextNode(a.attributes[e]),g=e;-1!=e.search(":")&&(g=e.split(":")[1]);var h=this.createElementNS(this.featureNS,"feature:"+g);h.appendChild(f),d.appendChild(h)}return d},insert:function(a){var b=this.createElementNS(this.wfsns,"wfs:Insert");return b.appendChild(this.createFeatureXML(a)),b},update:function(a){a.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));var b=this.createElementNS(this.wfsns,"wfs:Update");b.setAttribute("typeName",this.featurePrefix+":"+this.featureName),b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.wfsns,"wfs:Property"),d=this.createElementNS(this.wfsns,"wfs:Name"),e=this.createTextNode(this.geometryName);d.appendChild(e),c.appendChild(d);var f=this.createElementNS(this.wfsns,"wfs:Value"),g=this.buildGeometryNode(a.geometry);a.layer&&g.setAttribute("srsName",a.layer.projection.getCode()),f.appendChild(g),c.appendChild(f),b.appendChild(c);for(var h in a.attributes)c=this.createElementNS(this.wfsns,"wfs:Property"),d=this.createElementNS(this.wfsns,"wfs:Name"),d.appendChild(this.createTextNode(h)),c.appendChild(d),f=this.createElementNS(this.wfsns,"wfs:Value"),f.appendChild(this.createTextNode(a.attributes[h])),c.appendChild(f),b.appendChild(c);var i=this.createElementNS(this.ogcns,"ogc:Filter"),j=this.createElementNS(this.ogcns,"ogc:FeatureId");return j.setAttribute("fid",a.fid),i.appendChild(j),b.appendChild(i),b},remove:function(a){if(!a.fid)return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1;var b=this.createElementNS(this.wfsns,"wfs:Delete");b.setAttribute("typeName",this.featurePrefix+":"+this.featureName),b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.ogcns,"ogc:Filter"),d=this.createElementNS(this.ogcns,"ogc:FeatureId");return d.setAttribute("fid",a.fid),c.appendChild(d),b.appendChild(c),b},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"}),OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.priority=c)},VendorOption:function(a,b){b.vendorOptions||(b.vendorOptions={}),b.vendorOptions[a.getAttribute("name")]=this.getChildValue(a)},TextSymbolizer:function(a,b){OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,arguments);var c=this.multipleSymbolizers?b.symbolizers[b.symbolizers.length-1]:b.symbolizer.Text;void 0===c.graphic&&(c.graphic=!1)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Priority",a)},VendorOption:function(a){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:a.name},value:a.value})},TextSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers,c=b.sld.TextSymbolizer.apply(this,arguments);return a.graphic!==!1&&(a.externalGraphic||a.graphicName)&&this.writeNode("Graphic",a,c),"priority"in a&&this.writeNode("Priority",a.priority,c),this.addVendorOptions(c,a)},PointSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers,c=b.sld.PointSymbolizer.apply(this,arguments);return this.addVendorOptions(c,a)},LineSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers,c=b.sld.LineSymbolizer.apply(this,arguments);return this.addVendorOptions(c,a)},PolygonSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers,c=b.sld.PolygonSymbolizer.apply(this,arguments);return this.addVendorOptions(c,a)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(a,b){var c=b.vendorOptions;if(c)for(var d in b.vendorOptions)this.writeNode("VendorOption",{name:d,value:b.vendorOptions[d]},a);return a},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"}),OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(a){var b=this.map.getLayerPxFromLonLat({lon:a.bounds.left,lat:a.bounds.top}),c=this.map.getLayerPxFromLonLat({lon:a.bounds.right,lat:a.bounds.bottom});if(null==c||null==b)a.display(!1);else{var d=a.draw(b,{w:Math.max(1,c.x-b.x),h:Math.max(1,c.y-b.y)});a.drawn||(this.div.appendChild(d),a.drawn=!0)}},removeMarker:function(a){OpenLayers.Util.removeItem(this.markers,a),null!=a.div&&a.div.parentNode==this.div&&this.div.removeChild(a.div)},CLASS_NAME:"OpenLayers.Layer.Boxes"}),OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(a,b){b.service={},this.readChildNodes(a,b.service)},Fees:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.fees=c)},AccessConstraints:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.accessConstraints=c)},OnlineResource:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.onlineResource=c)},Keywords:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.keywords=c.split(", "))},Capability:function(a,b){b.capability={},this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={},this.readChildNodes(a,b.request)},GetFeature:function(a,b){b.getfeature={href:{},formats:[]},this.readChildNodes(a,b.getfeature)},ResultFormat:function(a,b){for(var c,d=a.childNodes,e=0;e<d.length;e++)c=d[e],1==c.nodeType&&b.formats.push(c.nodeName)},DCPType:function(a,b){this.readChildNodes(a,b)},HTTP:function(a,b){this.readChildNodes(a,b.href)},Get:function(a,b){b.get=a.getAttribute("onlineResource")},Post:function(a,b){b.post=a.getAttribute("onlineResource")},SRS:function(a,b){var c=this.getChildValue(a);c&&(b.srs=c)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"}),OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(a,b){this.readChildNodes(a,b)},LayerLimit:function(a,b){b.layerLimit=parseInt(this.getChildValue(a))},MaxWidth:function(a,b){b.maxWidth=parseInt(this.getChildValue(a))},MaxHeight:function(a,b){b.maxHeight=parseInt(this.getChildValue(a))},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("CRS"),b.bbox[c.srs]=c},CRS:function(a,b){this.readers.wms.SRS.apply(this,[a,b])},EX_GeographicBoundingBox:function(a,b){b.llbbox=[],this.readChildNodes(a,b.llbbox)},westBoundLongitude:function(a,b){b[0]=this.getChildValue(a)},eastBoundLongitude:function(a,b){b[2]=this.getChildValue(a)},southBoundLatitude:function(a,b){b[1]=this.getChildValue(a)},northBoundLatitude:function(a,b){b[3]=this.getChildValue(a)},MinScaleDenominator:function(a,b){b.maxScale=parseFloat(this.getChildValue(a)).toPrecision(16)},MaxScaleDenominator:function(a,b){b.minScale=parseFloat(this.getChildValue(a)).toPrecision(16)},Dimension:function(a,b){var c=a.getAttribute("name").toLowerCase(),d={name:c,units:a.getAttribute("units"),unitsymbol:a.getAttribute("unitSymbol"),nearestVal:"1"===a.getAttribute("nearestValue"),multipleVal:"1"===a.getAttribute("multipleValues"),"default":a.getAttribute("default")||"",current:"1"===a.getAttribute("current"),values:this.getChildValue(a).split(",")};b.dimensions[d.name]=d},Keyword:function(a,b){var c={value:this.getChildValue(a),vocabulary:a.getAttribute("vocabulary")};b.keywords&&b.keywords.push(c)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(a,b){this.readers.wms.UserDefinedSymbolization.apply(this,[a,b]),b.userSymbols.inlineFeature=1==parseInt(a.getAttribute("InlineFeature")),b.userSymbols.remoteWCS=1==parseInt(a.getAttribute("RemoteWCS"))},DescribeLayer:function(a,b){this.readers.wms.DescribeLayer.apply(this,[a,b])},GetLegendGraphic:function(a,b){this.readers.wms.GetLegendGraphic.apply(this,[a,b])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"}),OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(a,b,c,d){this.initializeZoomify(c),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,c,{},d])},initializeZoomify:function(a){var b=a.clone();this.size=a.clone();var c=new OpenLayers.Size(Math.ceil(b.w/this.standardTileSize),Math.ceil(b.h/this.standardTileSize));for(this.tierSizeInTiles=[c],this.tierImageSize=[b];b.w>this.standardTileSize||b.h>this.standardTileSize;)b=new OpenLayers.Size(Math.floor(b.w/2),Math.floor(b.h/2)),c=new OpenLayers.Size(Math.ceil(b.w/this.standardTileSize),Math.ceil(b.h/this.standardTileSize)),this.tierSizeInTiles.push(c),this.tierImageSize.push(b);this.tierSizeInTiles.reverse(),this.tierImageSize.reverse(),this.numberOfTiers=this.tierSizeInTiles.length;var d=[1];this.tileCountUpToTier=[0];for(var e=1;e<this.numberOfTiers;e++)d.unshift(Math.pow(2,e)),this.tileCountUpToTier.push(this.tierSizeInTiles[e-1].w*this.tierSizeInTiles[e-1].h+this.tileCountUpToTier[e-1]);this.serverResolutions||(this.serverResolutions=d)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments),this.tileCountUpToTier.length=0,this.tierSizeInTiles.length=0,this.tierImageSize.length=0},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),d=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h)),e=this.getZoomForResolution(b),f=c+d*this.tierSizeInTiles[e].w+this.tileCountUpToTier[e],g="TileGroup"+Math.floor(f/256)+"/"+e+"-"+c+"-"+d+".jpg",h=this.url;return OpenLayers.Util.isArray(h)&&(h=this.selectUrl(g,h)),h+g},getImageSize:function(){if(arguments.length>0){var a=this.adjustBounds(arguments[0]),b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),d=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h)),e=this.getZoomForResolution(b),f=this.standardTileSize,g=this.standardTileSize;if(c==this.tierSizeInTiles[e].w-1)var f=this.tierImageSize[e].w%this.standardTileSize;if(d==this.tierSizeInTiles[e].h-1)var g=this.tierImageSize[e].h%this.standardTileSize;return new OpenLayers.Size(f,g)}return this.tileSize},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},CLASS_NAME:"OpenLayers.Layer.Zoomify"}),OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS),(null==d||null==d.isBaseLayer)&&(this.isBaseLayer="true"!=this.params.transparent&&1!=this.params.transparent)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=[a.left,a.bottom,a.right,a.top],c=this.getImageSize(),d=this.getFullRequestString({mapext:b,imgext:b,map_size:[c.w,c.h],imgx:c.w/2,imgy:c.h/2,imgxy:[c.w,c.h]});return d},getFullRequestString:function(a,b){var c=null==b?this.url:b,d=OpenLayers.Util.extend({},this.params);d=OpenLayers.Util.extend(d,a);var e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&&(c=this.selectUrl(e,c));var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(var g in d)g.toUpperCase()in f&&delete d[g];e=OpenLayers.Util.getParameterString(d);var h=c;if(e=e.replace(/,/g,"+"),""!=e){var i=c.charAt(c.length-1);h+="&"==i||"?"==i?e:-1==c.indexOf("?")?"?"+e:"&"+e}return h},CLASS_NAME:"OpenLayers.Layer.MapServer"}),OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var a=document.createStyleSheet(),b=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],c=0,d=b.length;d>c;c++)a.addRule("olv\\:"+b[c],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=a.left/d|0,f=a.top/d-this.size.h|0;b||!this.offset?(this.offset={x:e,y:f},e=0,f=0):(e-=this.offset.x,f-=this.offset.y);var g=e-this.xOffset+" "+f;this.root.coordorigin=g;for(var h,i=[this.root,this.vectorRoot,this.textRoot],j=0,k=i.length;k>j;++j){h=i[j];var l=this.size.w+" "+this.size.h;h.coordsize=l}return this.root.style.flip="y",c},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var a,b=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],c=this.size.w+"px",d=this.size.h+"px",e=0,f=b.length;f>e;++e)a=b[e],a.style.width=c,a.style.height=d},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":c=b.externalGraphic?"olv:rect":this.isComplexSymbol(b.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":c="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":c="olv:shape"}return c},setStyle:function(a,b,c,d){b=b||a._style,c=c||a._options;var e=b.fillColor,f=b.title||b.graphicTitle;if(f&&(a.title=f),"OpenLayers.Geometry.Point"===a._geometryClass)if(b.externalGraphic){c.isFilled=!0;var g=b.graphicWidth||b.graphicHeight,h=b.graphicHeight||b.graphicWidth;g=g?g:2*b.pointRadius,h=h?h:2*b.pointRadius;var i=this.getResolution(),j=void 0!=b.graphicXOffset?b.graphicXOffset:-(.5*g),k=void 0!=b.graphicYOffset?b.graphicYOffset:-(.5*h);a.style.left=((d.x-this.featureDx)/i-this.offset.x+j|0)+"px",a.style.top=(d.y/i-this.offset.y-(k+h)|0)+"px",a.style.width=g+"px",a.style.height=h+"px",a.style.flip="y",e="none",c.isStroked=!1}else if(this.isComplexSymbol(b.graphicName)){var l=this.importSymbol(b.graphicName);a.path=l.path,a.coordorigin=l.left+","+l.bottom;var m=l.size;a.coordsize=m+","+m,this.drawCircle(a,d,b.pointRadius),a.style.flip="y"}else this.drawCircle(a,d,b.pointRadius);c.isFilled?a.fillcolor=e:a.filled="false";var n=a.getElementsByTagName("fill"),o=0==n.length?null:n[0];c.isFilled?(o||(o=this.createNode("olv:fill",a.id+"_fill")),o.opacity=b.fillOpacity,"OpenLayers.Geometry.Point"===a._geometryClass&&b.externalGraphic&&(b.graphicOpacity&&(o.opacity=b.graphicOpacity),o.src=b.externalGraphic,o.type="frame",b.graphicWidth&&b.graphicHeight||(o.aspect="atmost")),o.parentNode!=a&&a.appendChild(o)):o&&a.removeChild(o);var p=b.rotation;(void 0!==p||void 0!==a._rotation)&&(a._rotation=p,b.externalGraphic?(this.graphicRotate(a,j,k,b),o.opacity=0):"OpenLayers.Geometry.Point"===a._geometryClass&&(a.style.rotation=p||0));var q=a.getElementsByTagName("stroke"),r=0==q.length?null:q[0];return c.isStroked?(r||(r=this.createNode("olv:stroke",a.id+"_stroke"),a.appendChild(r)),r.on=!0,r.color=b.strokeColor,r.weight=b.strokeWidth+"px",r.opacity=b.strokeOpacity,r.endcap="butt"==b.strokeLinecap?"flat":b.strokeLinecap||"round",b.strokeDashstyle&&(r.dashstyle=this.dashStyle(b))):(a.stroked=!1,r&&(r.on=!1)),"inherit"!=b.cursor&&null!=b.cursor&&(a.style.cursor=b.cursor),a},graphicRotate:function(a,b,c,d){var e,f,d=d||a._style,g=d.rotation||0;if(!d.graphicWidth||!d.graphicHeight){var h=new Image;return h.onreadystatechange=OpenLayers.Function.bind(function(){("complete"==h.readyState||"interactive"==h.readyState)&&(e=h.width/h.height,f=Math.max(2*d.pointRadius,d.graphicWidth||0,d.graphicHeight||0),b*=e,d.graphicWidth=f*e,d.graphicHeight=f,this.graphicRotate(a,b,c,d))},this),void(h.src=d.externalGraphic)}f=Math.max(d.graphicWidth,d.graphicHeight),e=d.graphicWidth/d.graphicHeight;var i=Math.round(d.graphicWidth||f*e),j=Math.round(d.graphicHeight||f);a.style.width=i+"px",a.style.height=j+"px";var k=document.getElementById(a.id+"_image");k||(k=this.createNode("olv:imagedata",a.id+"_image"),a.appendChild(k)),k.style.width=i+"px",k.style.height=j+"px",k.src=d.externalGraphic,k.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var l=g*Math.PI/180,m=Math.sin(l),n=Math.cos(l),o="progid:DXImageTransform.Microsoft.Matrix(M11="+n+",M12="+-m+",M21="+m+",M22="+n+",SizingMethod='auto expand')\n",p=d.graphicOpacity||d.fillOpacity;p&&1!=p&&(o+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+p+")\n"),a.style.filter=o;var q=new OpenLayers.Geometry.Point(-b,-c),r=new OpenLayers.Bounds(0,0,i,j).toGeometry();r.rotate(d.rotation,q);var s=r.getBounds();a.style.left=Math.round(parseInt(a.style.left)+s.left)+"px",a.style.top=Math.round(parseInt(a.style.top)-s.bottom)+"px"},postDraw:function(a){a.style.visibility="visible";var b=a._style.fillColor,c=a._style.strokeColor;"none"==b&&a.fillcolor!=b&&(a.fillcolor=b),"none"==c&&a.strokecolor!=c&&(a.strokecolor=c)},setNodeDimension:function(a,b){var c=b.getBounds();if(c){var d=this.getResolution(),e=new OpenLayers.Bounds((c.left-this.featureDx)/d-this.offset.x|0,c.bottom/d-this.offset.y|0,(c.right-this.featureDx)/d-this.offset.x|0,c.top/d-this.offset.y|0);a.style.left=e.left+"px",a.style.top=e.top+"px",a.style.width=e.getWidth()+"px",a.style.height=e.getHeight()+"px",a.coordorigin=e.left+" "+e.top,a.coordsize=e.getWidth()+" "+e.getHeight()}},dashStyle:function(a){var b=a.strokeDashstyle;switch(b){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return b;default:var c=b.split(/[ ,]/);return 2==c.length?1*c[0]>=2*c[1]?"longdash":1==c[0]||1==c[1]?"dot":"dash":4==c.length?1*c[0]>=2*c[1]?"longdashdot":"dashdot":"solid"}},createNode:function(a,b){var c=document.createElement(a);return b&&(c.id=b),c.unselectable="on",c.onselectstart=OpenLayers.Function.False,c},nodeTypeCompare:function(a,b){var c=b,d=c.indexOf(":");-1!=d&&(c=c.substr(d+1));var e=a.nodeName;return d=e.indexOf(":"),-1!=d&&(e=e.substr(d+1)),c==e},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){if(!isNaN(b.x)&&!isNaN(b.y)){var d=this.getResolution();a.style.left=((b.x-this.featureDx)/d-this.offset.x|0)-c+"px",a.style.top=(b.y/d-this.offset.y|0)-c+"px";var e=2*c;return a.style.width=e+"px",a.style.height=e+"px",a
}return!1},drawLineString:function(a,b){return this.drawLine(a,b,!1)},drawLinearRing:function(a,b){return this.drawLine(a,b,!0)},drawLine:function(a,b,c){this.setNodeDimension(a,b);for(var d,e,f,g=this.getResolution(),h=b.components.length,i=new Array(h),j=0;h>j;j++)d=b.components[j],e=(d.x-this.featureDx)/g-this.offset.x|0,f=d.y/g-this.offset.y|0,i[j]=" "+e+","+f+" l ";var k=c?" x e":" e";return a.path="m"+i.join("")+k,a},drawPolygon:function(a,b){this.setNodeDimension(a,b);var c,d,e,f,g,h,i,j,k,l,m,n,o=this.getResolution(),p=[];for(c=0,d=b.components.length;d>c;c++){for(p.push("m"),e=b.components[c].components,f=0===c,g=null,h=null,i=0,j=e.length;j>i;i++)k=e[i],m=(k.x-this.featureDx)/o-this.offset.x|0,n=k.y/o-this.offset.y|0,l=" "+m+","+n,p.push(l),0==i&&p.push(" l"),f||(g?g!=l&&(h?h!=l&&(f=!0):h=l):g=l);p.push(f?" x ":" ")}return p.push("e"),a.path=p.join(""),a},drawRectangle:function(a,b){var c=this.getResolution();return a.style.left=((b.x-this.featureDx)/c-this.offset.x|0)+"px",a.style.top=(b.y/c-this.offset.y|0)+"px",a.style.width=(b.width/c|0)+"px",a.style.height=(b.height/c|0)+"px",a},drawText:function(a,b,c){var d=this.nodeFactory(a+this.LABEL_ID_SUFFIX,"olv:rect"),e=this.nodeFactory(a+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),f=this.getResolution();d.style.left=((c.x-this.featureDx)/f-this.offset.x|0)+"px",d.style.top=(c.y/f-this.offset.y|0)+"px",d.style.flip="y",e.innerText=b.label,"inherit"!=b.cursor&&null!=b.cursor&&(e.style.cursor=b.cursor),b.fontColor&&(e.style.color=b.fontColor),b.fontOpacity&&(e.style.filter="alpha(opacity="+100*b.fontOpacity+")"),b.fontFamily&&(e.style.fontFamily=b.fontFamily),b.fontSize&&(e.style.fontSize=b.fontSize),b.fontWeight&&(e.style.fontWeight=b.fontWeight),b.fontStyle&&(e.style.fontStyle=b.fontStyle),b.labelSelect===!0&&(d._featureId=a,e._featureId=a,e._geometry=c,e._geometryClass=c.CLASS_NAME),e.style.whiteSpace="nowrap",e.inset="1px,0px,0px,0px",d.parentNode||(d.appendChild(e),this.textRoot.appendChild(d));var g=b.labelAlign||"cm";1==g.length&&(g+="m");var h=e.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(0,1)],i=e.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(1,1)];d.style.left=parseInt(d.style.left)-h-1+"px",d.style.top=parseInt(d.style.top)+i+"px"},moveRoot:function(a){var b=this.map.getLayer(a.container.id);b instanceof OpenLayers.Layer.Vector.RootContainer&&(b=this.map.getLayer(this.container.id)),b&&b.renderer.clear(),OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments),b&&b.redraw()},importSymbol:function(a){var b=this.container.id+"-"+a,c=this.symbolCache[b];if(c)return c;var d=OpenLayers.Renderer.symbol[a];if(!d)throw new Error(a+" is not a valid symbol name");for(var e=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),f=["m"],g=0;g<d.length;g+=2){var h=d[g],i=d[g+1];e.left=Math.min(e.left,h),e.bottom=Math.min(e.bottom,i),e.right=Math.max(e.right,h),e.top=Math.max(e.top,i),f.push(h),f.push(i),0==g&&f.push("l")}f.push("x e");var j=f.join(" "),k=(e.getWidth()-e.getHeight())/2;return k>0?(e.bottom=e.bottom-k,e.top=e.top+k):(e.left=e.left+k,e.right=e.right-k),c={path:j,size:e.getWidth(),left:e.left,bottom:e.bottom},this.symbolCache[b]=c,c},CLASS_NAME:"OpenLayers.Renderer.VML"}),OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1},OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:!0,setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);var b,c=this.layers||a.layers;for(b=c.length-1;b>=0;--b)this.addLayer({layer:c[b]});this.layers||a.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(a){a.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(a){a.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(a){if(this.active&&window.localStorage&&a.tile instanceof OpenLayers.Tile.Image){var b=a.tile,c=b.url;!b.layer.crossOriginKeyword&&OpenLayers.ProxyHost&&0===c.indexOf(OpenLayers.ProxyHost)&&(c=OpenLayers.Control.CacheWrite.urlMap[c]);var d=window.localStorage.getItem("olCache_"+c);d&&(b.url=d,"tileerror"===a.type&&b.setImgSrc(d))}},destroy:function(){if(this.layers||this.map){var a,b=this.layers||this.map.layers;for(a=b.length-1;a>=0;--a)this.removeLayer({layer:b[a]})}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"}),OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"}),OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(a){var b;"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var c=a.documentElement;if(c){var d=this["read_"+c.nodeName];b=d?d.call(this,c):new OpenLayers.Format.GML(this.options?this.options:{}).read(a)}else b=a;return b},read_msGMLOutput:function(a){var b=[],c=this.getSiblingNodesByTagCriteria(a,this.layerIdentifier);if(c)for(var d=0,e=c.length;e>d;++d){var f=c[d],g=f.nodeName;f.prefix&&(g=g.split(":")[1]);var g=g.replace(this.layerIdentifier,""),h=this.getSiblingNodesByTagCriteria(f,this.featureIdentifier);if(h)for(var i=0;i<h.length;i++){var j=h[i],k=this.parseGeometry(j),l=this.parseAttributes(j),m=new OpenLayers.Feature.Vector(k.geometry,l,null);m.bounds=k.bounds,m.type=g,b.push(m)}}return b},read_FeatureInfoResponse:function(a){for(var b=[],c=this.getElementsByTagNameNS(a,"*","FIELDS"),d=0,e=c.length;e>d;d++){var f,g=c[d],h=null,i={},j=g.attributes.length;if(j>0)for(f=0;j>f;f++){var k=g.attributes[f];i[k.nodeName]=k.nodeValue}else{var l=g.childNodes;for(f=0,j=l.length;j>f;++f){var m=l[f];3!=m.nodeType&&(i[m.getAttribute("name")]=m.getAttribute("value"))}}b.push(new OpenLayers.Feature.Vector(h,i,null))}return b},getSiblingNodesByTagCriteria:function(a,b){var c,d,e,f,g,h=[];if(a&&a.hasChildNodes()){c=a.childNodes,e=c.length;for(var i=0;e>i;i++){for(g=c[i];g&&1!=g.nodeType;)g=g.nextSibling,i++;d=g?g.nodeName:"",d.length>0&&d.indexOf(b)>-1?h.push(g):(f=this.getSiblingNodesByTagCriteria(g,b),f.length>0&&(0==h.length?h=f:h.push(f)))}}return h},parseAttributes:function(a){var b={};if(1==a.nodeType)for(var c=a.childNodes,d=c.length,e=0;d>e;++e){var f=c[e];if(1==f.nodeType){var g=f.childNodes,h=f.prefix?f.nodeName.split(":")[1]:f.nodeName;if(0==g.length)b[h]=null;else if(1==g.length){var i=g[0];if(3==i.nodeType||4==i.nodeType){var j=i.nodeValue.replace(this.regExes.trimSpace,"");b[h]=j}}}}return b},parseGeometry:function(a){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var b,c=this.gmlFormat.parseFeature(a),d=null;return c&&(b=c.geometry&&c.geometry.clone(),d=c.bounds&&c.bounds.clone(),c.destroy()),{geometry:b,bounds:d}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"}),OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(a){if(a=a||{},a.handlerOptions=a.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var b={};b[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{})}},getInfoForClick:function(a){this.request(a.xy,{})},getInfoForHover:function(a){this.request(a.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,this.pending<=0&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var a,b=this.layers||this.map.layers,c=[],d=b.length-1;d>=0&&(a=b[d],!(a instanceof OpenLayers.Layer.WMTS&&a.requestEncoding===this.requestEncoding)||this.queryVisible&&!a.getVisibility()||(c.push(a),this.drillDown&&!this.hover));--d);return c},buildRequestOptions:function(a,b){var c=this.map.getLonLatFromPixel(b),d=a.getURL(new OpenLayers.Bounds(c.lon,c.lat,c.lon,c.lat)),e=OpenLayers.Util.getParameters(d),f=a.getTileInfo(c);return OpenLayers.Util.extend(e,{service:"WMTS",version:a.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:f.i,j:f.j}),OpenLayers.Util.applyDefaults(e,this.vendorParams),{url:OpenLayers.Util.isArray(a.url)?a.url[0]:a.url,params:OpenLayers.Util.upperCaseObject(e),callback:function(c){this.handleResponse(b,c,a)},scope:this}},request:function(a,b){b=b||{};var c=this.findLayers();if(c.length>0){for(var d,e,f=0,g=c.length;g>f;f++)if(e=c[f],d=this.events.triggerEvent("beforegetfeatureinfo",{xy:a,layer:e}),d!==!1){++this.pending;var h=this.buildRequestOptions(e,a),i=OpenLayers.Request.GET(h);b.hover===!0&&(this.hoverRequest=i)}this.pending>0&&OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(a,b,c){if(--this.pending,this.pending<=0&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),b.status&&(b.status<200||b.status>=300))this.events.triggerEvent("exception",{xy:a,request:b,layer:c});else{var d=b.responseXML;d&&d.documentElement||(d=b.responseText);var e,f;try{e=this.format.read(d)}catch(g){f=!0,this.events.triggerEvent("exception",{xy:a,request:b,error:g,layer:c})}f||this.events.triggerEvent("getfeatureinfo",{text:b.responseText,features:e,request:b,xy:a,layer:c})}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"}),OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]),a.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){a=OpenLayers.Util.extend({},a),OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.format.write(a.params||a);return b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c}),b},handleRead:function(a,b){if(b.callback){var c=a.priv;c.status>=200&&c.status<300?(a.data=this.parseData(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a)}},parseData:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),!b||b.length<=0?null:this.format.read(b)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"}),OpenLayers.Format.WCSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows/1.1"},errorProperty:"operationsMetadata",readers:{wcs:OpenLayers.Util.applyDefaults({Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contentMetadata=[],this.readChildNodes(a,b.contentMetadata)},CoverageSummary:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},SupportedCRS:function(a,b){var c=this.getChildValue(a);c&&(b.supportedCRS||(b.supportedCRS=[]),b.supportedCRS.push(c))},SupportedFormat:function(a,b){var c=this.getChildValue(a);c&&(b.supportedFormat||(b.supportedFormat=[]),b.supportedFormat.push(c))}},OpenLayers.Format.WCSCapabilities.v1.prototype.readers.wcs),ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_1_0"}),OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:.5},labelSymbolizer:{},gratLayer:null,initialize:function(a){a=a||{},a.layerName=a.layerName||OpenLayers.i18n("Graticule"),OpenLayers.Control.prototype.initialize.apply(this,[a]),this.labelSymbolizer.stroke=!1,this.labelSymbolizer.fill=!1,this.labelSymbolizer.label="${label}",this.labelSymbolizer.labelAlign="${labelAlign}",this.labelSymbolizer.labelXOffset="${xOffset}",this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.gratLayer){var a=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":a}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0):!1},update:function(){var a=this.map.getExtent();if(a){this.gratLayer.destroyFeatures();var b=new OpenLayers.Projection("EPSG:4326"),c=this.map.getProjectionObject(),d=this.map.getResolution();c.proj&&"longlat"==c.proj.projName&&(this.numPoints=1);var e=this.map.getCenter(),f=new OpenLayers.Pixel(e.lon,e.lat);OpenLayers.Projection.transform(f,c,b);var g=this.targetSize*d;g*=g;for(var h,i=0;i<this.intervals.length;++i){h=this.intervals[i];var j=h/2,k=f.offset({x:-j,y:-j}),l=f.offset({x:j,y:j});OpenLayers.Projection.transform(k,b,c),OpenLayers.Projection.transform(l,b,c);var m=(k.x-l.x)*(k.x-l.x)+(k.y-l.y)*(k.y-l.y);if(g>=m)break}f.x=Math.floor(f.x/h)*h,f.y=Math.floor(f.y/h)*h;var n,o=0,p=[f.clone()],q=f.clone();do q=q.offset({x:0,y:h}),n=OpenLayers.Projection.transform(q.clone(),b,c),p.unshift(q);while(a.containsPixel(n)&&++o<1e3);q=f.clone();do q=q.offset({x:0,y:-h}),n=OpenLayers.Projection.transform(q.clone(),b,c),p.push(q);while(a.containsPixel(n)&&++o<1e3);o=0;var r=[f.clone()];q=f.clone();do q=q.offset({x:-h,y:0}),n=OpenLayers.Projection.transform(q.clone(),b,c),r.unshift(q);while(a.containsPixel(n)&&++o<1e3);q=f.clone();do q=q.offset({x:h,y:0}),n=OpenLayers.Projection.transform(q.clone(),b,c),r.push(q);while(a.containsPixel(n)&&++o<1e3);for(var s=[],i=0;i<r.length;++i){for(var t=r[i].x,u=[],v=null,w=Math.min(p[0].y,90),x=Math.max(p[p.length-1].y,-90),y=(w-x)/this.numPoints,z=x,A=0;A<=this.numPoints;++A){var B=new OpenLayers.Geometry.Point(t,z);B.transform(b,c),u.push(B),z+=y,B.y>=a.bottom&&!v&&(v=B)}if(this.labelled){var C=new OpenLayers.Geometry.Point(v.x,a.bottom),D={value:t,label:this.labelled?OpenLayers.Util.getFormattedLonLat(t,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(C,D))}var E=new OpenLayers.Geometry.LineString(u);s.push(new OpenLayers.Feature.Vector(E))}for(var A=0;A<p.length;++A)if(z=p[A].y,!(-90>z||z>90)){for(var u=[],F=r[0].x,G=r[r.length-1].x,H=(G-F)/this.numPoints,t=F,v=null,i=0;i<=this.numPoints;++i){var B=new OpenLayers.Geometry.Point(t,z);B.transform(b,c),u.push(B),t+=H,B.x<a.right&&(v=B)}if(this.labelled){var C=new OpenLayers.Geometry.Point(a.right,v.y),D={value:z,label:this.labelled?OpenLayers.Util.getFormattedLonLat(z,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(C,D))}var E=new OpenLayers.Geometry.LineString(u);s.push(new OpenLayers.Feature.Vector(E))}this.gratLayer.addFeatures(s)}},CLASS_NAME:"OpenLayers.Control.Graticule"}),OpenLayers.Console.warn("OpenLayers.Rico is deprecated"),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Corner={round:function(a,b){a=OpenLayers.Util.getElement(a),this._setOptions(b);var c=this.options.color;"fromElement"==this.options.color&&(c=this._background(a));var d=this.options.bgColor;"fromParent"==this.options.bgColor&&(d=this._background(a.offsetParent)),this._roundCornersImpl(a,c,d)},changeColor:function(a,b){a.style.backgroundColor=b;for(var c=a.parentNode.getElementsByTagName("span"),d=0;d<c.length;d++)c[d].style.backgroundColor=b},changeOpacity:function(a,b){var c=b,d="alpha(opacity="+100*b+")";a.style.opacity=c,a.style.filter=d;for(var e=a.parentNode.getElementsByTagName("span"),f=0;f<e.length;f++)e[f].style.opacity=c,e[f].style.filter=d},reRound:function(a,b){var c=a.parentNode.childNodes[0],d=a.parentNode.childNodes[2];a.parentNode.removeChild(c),a.parentNode.removeChild(d),this.round(a.parentNode,b)},_roundCornersImpl:function(a,b,c){this.options.border&&this._renderBorder(a,c),this._isTopRounded()&&this._roundTopCorners(a,b,c),this._isBottomRounded()&&this._roundBottomCorners(a,b,c)},_renderBorder:function(a,b){var c="1px solid "+this._borderColor(b),d="border-left: "+c,e="border-right: "+c,f="style='"+d+";"+e+"'";a.innerHTML="<div "+f+">"+a.innerHTML+"</div>"},_roundTopCorners:function(a,b,c){for(var d=this._createCorner(c),e=0;e<this.options.numSlices;e++)d.appendChild(this._createCornerSlice(b,c,e,"top"));a.style.paddingTop=0,a.insertBefore(d,a.firstChild)},_roundBottomCorners:function(a,b,c){for(var d=this._createCorner(c),e=this.options.numSlices-1;e>=0;e--)d.appendChild(this._createCornerSlice(b,c,e,"bottom"));a.style.paddingBottom=0,a.appendChild(d)},_createCorner:function(a){var b=document.createElement("div");return b.style.backgroundColor=this._isTransparent()?"transparent":a,b},_createCornerSlice:function(a,b,c,d){var e=document.createElement("span"),f=e.style;f.backgroundColor=a,f.display="block",f.height="1px",f.overflow="hidden",f.fontSize="1px";var g=this._borderColor(a,b);return this.options.border&&0==c?(f.borderTopStyle="solid",f.borderTopWidth="1px",f.borderLeftWidth="0px",f.borderRightWidth="0px",f.borderBottomWidth="0px",f.height="0px",f.borderColor=g):g&&(f.borderColor=g,f.borderStyle="solid",f.borderWidth="0px 1px"),this.options.compact||c!=this.options.numSlices-1||(f.height="2px"),this._setMargin(e,c,d),this._setBorder(e,c,d),e},_setOptions:function(a){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1},OpenLayers.Util.extend(this.options,a||{}),this.options.numSlices=this.options.compact?2:4,this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")?"":this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0?"":this.options.corners.indexOf("tl")>=0?"left":this.options.corners.indexOf("tr")>=0?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")?"":this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0?"":this.options.corners.indexOf("bl")>=0?"left":this.options.corners.indexOf("br")>=0?"right":""},_borderColor:function(a,b){return"transparent"==a?b:this.options.border?this.options.border:this.options.blend?this._blend(b,a):""},_setMargin:function(a,b,c){var d=this._marginSize(b),e="top"==c?this._whichSideTop():this._whichSideBottom();"left"==e?(a.style.marginLeft=d+"px",a.style.marginRight="0px"):"right"==e?(a.style.marginRight=d+"px",a.style.marginLeft="0px"):(a.style.marginLeft=d+"px",a.style.marginRight=d+"px")},_setBorder:function(a,b,c){var d=this._borderSize(b),e="top"==c?this._whichSideTop():this._whichSideBottom();"left"==e?(a.style.borderLeftWidth=d+"px",a.style.borderRightWidth="0px"):"right"==e?(a.style.borderRightWidth=d+"px",a.style.borderLeftWidth="0px"):(a.style.borderLeftWidth=d+"px",a.style.borderRightWidth=d+"px"),0!=this.options.border&&(a.style.borderLeftWidth=d+"px",a.style.borderRightWidth=d+"px")},_marginSize:function(a){if(this._isTransparent())return 0;var b=[5,3,2,1],c=[3,2,1,0],d=[2,1],e=[1,0];return this.options.compact&&this.options.blend?e[a]:this.options.compact?d[a]:this.options.blend?c[a]:b[a]},_borderSize:function(a){var b=[5,3,2,1],c=[2,1,1,1],d=[1,0],e=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?d[a]:this.options.blend?c[a]:this.options.border?e[a]:this._isTransparent()?b[a]:0},_hasString:function(a){for(var b=1;b<arguments.length;b++)if(a.indexOf(arguments[b])>=0)return!0;return!1},_blend:function(a,b){var c=OpenLayers.Rico.Color.createFromHex(a);return c.blend(OpenLayers.Rico.Color.createFromHex(b)),c},_background:function(a){try{return OpenLayers.Rico.Color.createColorFromBackground(a).asHex()}catch(b){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(a){return 1==a.childNodes.length&&3==a.childNodes[0].nodeType}},OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var b={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(b,this.previousOptions),this.previous=new OpenLayers.Control.Button(b);var c={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(c,this.nextOptions),this.next=new OpenLayers.Control.Button(c),this.clear()},onPreviousChange:function(a){a&&!this.previous.active?this.previous.activate():!a&&this.previous.active&&this.previous.deactivate()},onNextChange:function(a){a&&!this.next.active?this.next.activate():!a&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this),this.previous.destroy(),this.next.destroy(),this.deactivate();for(var a in this)this[a]=null},setMap:function(a){this.map=a,this.next.setMap(a),this.previous.setMap(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments),this.next.draw(),this.previous.draw()},previousTrigger:function(){var a=this.previousStack.shift(),b=this.previousStack.shift();return void 0!=b?(this.nextStack.unshift(a),this.previousStack.unshift(b),this.restoring=!0,this.restore(b),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(a),b},nextTrigger:function(){var a=this.nextStack.shift();return void 0!=a&&(this.previousStack.unshift(a),this.restoring=!0,this.restore(a),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)),a},clear:function(){this.previousStack=[],this.previous.deactivate(),this.nextStack=[],this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(a){var b,c;if(this.map.getProjectionObject()==a.projection)c=this.map.getZoomForResolution(a.resolution),b=a.center;else{b=a.center.clone(),b.transform(a.projection,this.map.getProjectionObject());var d=a.units,e=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,f=d&&e?OpenLayers.INCHES_PER_UNIT[d]/OpenLayers.INCHES_PER_UNIT[e]:1;c=this.map.getZoomForResolution(f*a.resolution)}this.map.setCenter(b,c)},setListeners:function(){this.listeners={};for(var a in this.registry)this.listeners[a]=OpenLayers.Function.bind(function(){if(!this.restoring){var b=this.registry[a].apply(this,arguments);this.previousStack.unshift(b),this.previousStack.length>1&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1),this.previousStack.length>this.limit+1&&this.previousStack.pop(),this.nextStack.length>0&&(this.nextStack=[],this.onNextChange(null,0))}return!0},this)},activate:function(){var a=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var b in this.listeners)this.map.events.register(b,this,this.listeners[b]);a=!0,0==this.previousStack.length&&this.initStack()}return a},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var a=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var b in this.listeners)this.map.events.unregister(b,this,this.listeners[b]);this.clearOnDeactivate&&this.clear(),a=!0}return a},CLASS_NAME:"OpenLayers.Control.NavigationHistory"}),OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:!1,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(a){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a.name,a.url,{},a]),this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},createBackBuffer:function(){},clone:function(a){return null==a&&(a=new OpenLayers.Layer.UTFGrid(this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getFeatureInfo:function(a){var b=null,c=this.getTileData(a);return c&&c.tile&&(b=c.tile.getFeatureInfo(c.i,c.j)),b},getFeatureId:function(a){var b=null,c=this.getTileData(a);return c.tile&&(b=c.tile.getFeatureId(c.i,c.j)),b},CLASS_NAME:"OpenLayers.Layer.UTFGrid"}),OpenLayers.TileManager=OpenLayers.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.maps=[],this.tileQueueId={},this.tileQueue={},this.tileCache={},this.tileCacheIndex=[]},addMap:function(a){if(!this._destroyed&&OpenLayers.Layer.Grid){this.maps.push(a),this.tileQueue[a.id]=[];for(var b=0,c=a.layers.length;c>b;++b)this.addLayer({layer:a.layers[b]});a.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}},removeMap:function(a){if(!this._destroyed&&OpenLayers.Layer.Grid){if(window.clearTimeout(this.tileQueueId[a.id]),a.layers)for(var b=0,c=a.layers.length;c>b;++b)this.removeLayer({layer:a.layers[b]});a.events&&a.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this}),delete this.tileQueue[a.id],delete this.tileQueueId[a.id],OpenLayers.Util.removeItem(this.maps,a)}},move:function(a){this.updateTimeout(a.object,this.moveDelay,!0)},zoomEnd:function(a){this.updateTimeout(a.object,this.zoomDelay)},changeLayer:function(a){("visibility"===a.property||"params"===a.property)&&this.updateTimeout(a.object,0)},addLayer:function(a){var b=a.layer;if(b instanceof OpenLayers.Layer.Grid){b.events.on({addtile:this.addTile,retile:this.clearTileQueue,scope:this});var c,d,e;for(c=b.grid.length-1;c>=0;--c)for(d=b.grid[c].length-1;d>=0;--d)e=b.grid[c][d],this.addTile({tile:e}),e.url&&!e.imgDiv&&this.manageTileCache({object:e})}},removeLayer:function(a){var b=a.layer;if(b instanceof OpenLayers.Layer.Grid&&(this.clearTileQueue({object:b}),b.events&&b.events.un({addtile:this.addTile,retile:this.clearTileQueue,scope:this}),b.grid)){var c,d,e;for(c=b.grid.length-1;c>=0;--c)for(d=b.grid[c].length-1;d>=0;--d)e=b.grid[c][d],this.unloadTile({object:e})}},updateTimeout:function(a,b,c){window.clearTimeout(this.tileQueueId[a.id]);var d=this.tileQueue[a.id];(!c||d.length)&&(this.tileQueueId[a.id]=window.setTimeout(OpenLayers.Function.bind(function(){this.drawTilesFromQueue(a),d.length&&this.updateTimeout(a,this.frameDelay)},this),b))},addTile:function(a){a.tile instanceof OpenLayers.Tile.Image?a.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}):this.removeLayer({layer:a.tile.layer})},unloadTile:function(a){var b=a.object;b.events.un({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}),OpenLayers.Util.removeItem(this.tileQueue[b.layer.map.id],b)},queueTileDraw:function(a){var b=a.object,c=!1,d=b.layer,e=d.getURL(b.bounds),f=this.tileCache[e];if(f&&"olTileImage"!==f.className&&(delete this.tileCache[e],OpenLayers.Util.removeItem(this.tileCacheIndex,e),f=null),d.url&&(d.async||!f)){var g=this.tileQueue[d.map.id];~OpenLayers.Util.indexOf(g,b)||g.push(b),c=!0}return!c},drawTilesFromQueue:function(a){for(var b=this.tileQueue[a.id],c=this.tilesPerFrame,d=a.zoomTween&&a.zoomTween.playing;!d&&b.length&&c;)b.shift().draw(!0),--c},manageTileCache:function(a){var b=a.object,c=this.tileCache[b.url];c&&(c.parentNode&&OpenLayers.Element.hasClass(c.parentNode,"olBackBuffer")&&(c.parentNode.removeChild(c),c.id=null),c.parentNode||(c.style.visibility="hidden",c.style.opacity=0,b.setImage(c),OpenLayers.Util.removeItem(this.tileCacheIndex,b.url),this.tileCacheIndex.push(b.url)))},addToCache:function(a){var b=a.object;this.tileCache[b.url]||OpenLayers.Element.hasClass(b.imgDiv,"olImageLoadError")||(this.tileCacheIndex.length>=this.cacheSize&&(delete this.tileCache[this.tileCacheIndex[0]],this.tileCacheIndex.shift()),this.tileCache[b.url]=b.imgDiv,this.tileCacheIndex.push(b.url))},clearTileQueue:function(a){for(var b=a.object,c=this.tileQueue[b.map.id],d=c.length-1;d>=0;--d)c[d].layer===b&&c.splice(d,1)},destroy:function(){for(var a=this.maps.length-1;a>=0;--a)this.removeMap(this.maps[a]);this.maps=null,this.tileQueue=null,this.tileQueueId=null,this.tileCache=null,this.tileCacheIndex=null,this._destroyed=!0}}),OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(){if(OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])),this.layerInfo){var a=this.layerInfo,b=new OpenLayers.Bounds(a.fullExtent.xmin,a.fullExtent.ymin,a.fullExtent.xmax,a.fullExtent.ymax);if(this.projection="EPSG:"+a.spatialReference.wkid,this.sphericalMercator=102100==a.spatialReference.wkid,this.units="esriFeet"==a.units?"ft":"m",a.tileInfo){this.tileSize=new OpenLayers.Size(a.tileInfo.width||a.tileInfo.cols,a.tileInfo.height||a.tileInfo.rows),this.tileOrigin=new OpenLayers.LonLat(a.tileInfo.origin.x,a.tileInfo.origin.y);var c=new OpenLayers.Geometry.Point(b.left,b.top),d=new OpenLayers.Geometry.Point(b.right,b.bottom);this.useScales?this.scales=[]:this.resolutions=[],this.lods=[];for(var e in a.tileInfo.lods)if(a.tileInfo.lods.hasOwnProperty(e)){var f=a.tileInfo.lods[e];
this.useScales?this.scales.push(f.scale):this.resolutions.push(f.resolution);var g=this.getContainingTileCoords(c,f.resolution);f.startTileCol=g.x,f.startTileRow=g.y;var h=this.getContainingTileCoords(d,f.resolution);f.endTileCol=h.x,f.endTileRow=h.y,this.lods.push(f)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]),this.serverResolutions=this.resolutions,this.overrideDPI&&a.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=a.tileInfo.dpi)}}},getContainingTileCoords:function(a,b){return new OpenLayers.Pixel(Math.max(Math.floor((a.x-this.tileOrigin.lon)/(this.tileSize.w*b)),0),Math.max(Math.floor((this.tileOrigin.lat-a.y)/(this.tileSize.h*b)),0))},calculateMaxExtentWithLOD:function(a){var b=a.endTileCol-a.startTileCol+1,c=a.endTileRow-a.startTileRow+1,d=this.tileOrigin.lon+a.startTileCol*this.tileSize.w*a.resolution,e=d+b*this.tileSize.w*a.resolution,f=this.tileOrigin.lat-a.startTileRow*this.tileSize.h*a.resolution,g=f-c*this.tileSize.h*a.resolution;return new OpenLayers.Bounds(d,g,e,f)},calculateMaxExtentWithExtent:function(a,b){var c=new OpenLayers.Geometry.Point(a.left,a.top),d=new OpenLayers.Geometry.Point(a.right,a.bottom),e=this.getContainingTileCoords(c,b),f=this.getContainingTileCoords(d,b),g={resolution:b,startTileCol:e.x,startTileRow:e.y,endTileCol:f.x,endTileRow:f.y};return this.calculateMaxExtentWithLOD(g)},getUpperLeftTileCoord:function(a){var b=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(b,a)},getLowerRightTileCoord:function(a){var b=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(b,a)},getMaxExtentForResolution:function(a){var b=this.getUpperLeftTileCoord(a),c=this.getLowerRightTileCoord(a),d=c.x-b.x+1,e=c.y-b.y+1,f=this.tileOrigin.lon+b.x*this.tileSize.w*a,g=f+d*this.tileSize.w*a,h=this.tileOrigin.lat-b.y*this.tileSize.h*a,i=h-e*this.tileSize.h*a;return new OpenLayers.Bounds(f,i,g,h)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},initGriddedTiles:function(){delete this._tileOrigin,OpenLayers.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)},getMaxExtent:function(){var a=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(a)},getTileOrigin:function(){if(!this._tileOrigin){var a=this.getMaxExtent();this._tileOrigin=new OpenLayers.LonLat(a.left,a.bottom)}return this._tileOrigin},getURL:function(a){var b=this.getResolution(),c=this.tileOrigin.lon+b*this.tileSize.w/2,d=this.tileOrigin.lat-b*this.tileSize.h/2,e=a.getCenterLonLat(),f=({x:e.lon,y:e.lat},Math.round(Math.abs((e.lon-c)/(b*this.tileSize.w)))),g=Math.round(Math.abs((d-e.lat)/(b*this.tileSize.h))),h=this.map.getZoom();if(this.lods){var i=this.lods[this.map.getZoom()];if(f<i.startTileCol||f>i.endTileCol||g<i.startTileRow||g>i.endTileRow)return null}else{var j=this.getUpperLeftTileCoord(b),k=this.getLowerRightTileCoord(b);if(f<j.x||f>=k.x||g<j.y||g>=k.y)return null}var l=this.url,m=""+f+g+h;return OpenLayers.Util.isArray(l)&&(l=this.selectUrl(m,l)),this.useArcGISServer?l+="/tile/${z}/${y}/${x}":(f="C"+OpenLayers.Number.zeroPad(f,8,16),g="R"+OpenLayers.Number.zeroPad(g,8,16),h="L"+OpenLayers.Number.zeroPad(h,2,10),l=l+"/${z}/${y}/${x}."+this.type),l=OpenLayers.String.format(l,{x:f,y:g,z:h}),OpenLayers.Util.urlAppend(l,OpenLayers.Util.getParameterString(this.params))},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"}),OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(a){if(a=a||{},a.handlerOptions=a.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var b={};b[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{})}},getInfoForClick:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy}),OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait"),this.request(a.xy,{})},getInfoForHover:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy}),this.request(a.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var a,b,c=this.layers||this.map.layers,d=[],e=c.length-1;e>=0;--e)a=c[e],a instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||a.getVisibility())&&(b=OpenLayers.Util.isArray(a.url)?a.url[0]:a.url,this.drillDown!==!1||this.url||(this.url=b),(this.drillDown===!0||this.urlMatches(b))&&d.push(a));return d},urlMatches:function(a){var b=OpenLayers.Util.isEquivalentUrl(this.url,a);if(!b&&this.layerUrls)for(var c=0,d=this.layerUrls.length;d>c;++c)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[c],a)){b=!0;break}return b},buildWMSOptions:function(a,b,c,d){for(var e=[],f=[],g=0,h=b.length;h>g;g++)null!=b[g].params.LAYERS&&(e=e.concat(b[g].params.LAYERS),f=f.concat(this.getStyleNames(b[g])));var i=b[0],j=this.map.getProjection(),k=i.projection;k&&k.equals(this.map.getProjectionObject())&&(j=k.getCode());var l=OpenLayers.Util.extend({service:"WMS",version:i.params.VERSION,request:"GetFeatureInfo",exceptions:i.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,i.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:d,info_format:i.params.INFO_FORMAT||this.infoFormat},parseFloat(i.params.VERSION)>=1.3?{crs:j,i:parseInt(c.x),j:parseInt(c.y)}:{srs:j,x:parseInt(c.x),y:parseInt(c.y)});return 0!=e.length&&(l=OpenLayers.Util.extend({layers:e,query_layers:e,styles:f},l)),OpenLayers.Util.applyDefaults(l,this.vendorParams),{url:a,params:OpenLayers.Util.upperCaseObject(l),callback:function(b){this.handleResponse(c,b,a)},scope:this}},getStyleNames:function(a){var b;return b=a.params.STYLES?a.params.STYLES:OpenLayers.Util.isArray(a.params.LAYERS)?new Array(a.params.LAYERS.length):a.params.LAYERS.replace(/[^,]/g,"")},request:function(a,b){var c=this.findLayers();if(0==c.length)return this.events.triggerEvent("nogetfeatureinfo"),void OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");if(b=b||{},this.drillDown===!1){var d=this.buildWMSOptions(this.url,c,a,c[0].params.FORMAT),e=OpenLayers.Request.GET(d);b.hover===!0&&(this.hoverRequest=e)}else{this._requestCount=0,this._numRequests=0,this.features=[];for(var f,g={},h=0,i=c.length;i>h;h++){var j=c[h];f=OpenLayers.Util.isArray(j.url)?j.url[0]:j.url,f in g?g[f].push(j):(this._numRequests++,g[f]=[j])}var c;for(var f in g){c=g[f];var d=this.buildWMSOptions(f,c,a,c[0].params.FORMAT);OpenLayers.Request.GET(d)}}},triggerGetFeatureInfo:function(a,b,c){this.events.triggerEvent("getfeatureinfo",{text:a.responseText,features:c,request:a,xy:b}),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(a,b,c){var d=b.responseXML;d&&d.documentElement||(d=b.responseText);var e=this.format.read(d);this.drillDown===!1?this.triggerGetFeatureInfo(b,a,e):(this._requestCount++,this._features=(this._features||[]).concat("object"===this.output?{url:c,features:e}:e),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(b,a,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"}),OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"}),OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={features:[]};this.readNode(a,b);for(var c=[],d=0,e=b.features.length;e>d;d++){var f=b.features[d];this.internalProjection&&this.externalProjection&&f.components[0]&&f.components[0].transform(this.externalProjection,this.internalProjection);var g=new OpenLayers.Feature.Vector(f.components[0],f.attributes);c.push(g)}return c},readers:{sa:{SamplingPoint:function(a,b){if(!b.attributes){var c={attributes:{}};b.features.push(c),b=c}b.attributes.id=this.getAttributeNS(a,this.namespaces.gml,"id"),this.readChildNodes(a,b)},position:function(a,b){this.readChildNodes(a,b)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,b){this.readChildNodes(a,b)},featureMember:function(a,b){var c={attributes:{}};b.features.push(c),this.readChildNodes(a,c)},name:function(a,b){b.attributes.name=this.getChildValue(a)},pos:function(a,b){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(a.getAttribute("srsName"))),OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[a,b])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(a){for(var b=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}}),c=0,d=a.fois.length;d>c;c++)this.writeNode("FeatureOfInterestId",{foi:a.fois[c]},b);return b},FeatureOfInterestId:function(a){var b=this.createElementNSPlus("FeatureOfInterestId",{value:a.foi});return b}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"}),OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={measurements:[],observations:[]};return this.readNode(a,b),b},write:function(a){var b=this.writeNode("sos:GetObservation",a);return b.setAttribute("xmlns:om",this.namespaces.om),b.setAttribute("xmlns:ogc",this.namespaces.ogc),this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[b])},readers:{om:{ObservationCollection:function(a,b){b.id=this.getAttributeNS(a,this.namespaces.gml,"id"),this.readChildNodes(a,b)},member:function(a,b){this.readChildNodes(a,b)},Measurement:function(a,b){var c={};b.measurements.push(c),this.readChildNodes(a,c)},Observation:function(a,b){var c={};b.observations.push(c),this.readChildNodes(a,c)},samplingTime:function(a,b){var c={};b.samplingTime=c,this.readChildNodes(a,c)},observedProperty:function(a,b){b.observedProperty=this.getAttributeNS(a,this.namespaces.xlink,"href"),this.readChildNodes(a,b)},procedure:function(a,b){b.procedure=this.getAttributeNS(a,this.namespaces.xlink,"href"),this.readChildNodes(a,b)},featureOfInterest:function(a,b){var c={features:[]};b.fois=[],b.fois.push(c),this.readChildNodes(a,c);for(var d=[],e=0,f=c.features.length;f>e;e++){var g=c.features[e];d.push(new OpenLayers.Feature.Vector(g.components[0],g.attributes))}c.features=d},result:function(a,b){var c={};b.result=c,""!==this.getChildValue(a)?(c.value=this.getChildValue(a),c.uom=a.getAttribute("uom")):this.readChildNodes(a,c)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(a,b){var c={};b.timeInstant=c,this.readChildNodes(a,c)},timePosition:function(a,b){b.timePosition=this.getChildValue(a)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(a){var b=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",a,b),a.eventTime&&this.writeNode("eventTime",a,b);for(var c in a.procedures)this.writeNode("procedure",a.procedures[c],b);for(var d in a.observedProperties)this.writeNode("observedProperty",a.observedProperties[d],b);return a.foi&&this.writeNode("featureOfInterest",a.foi,b),this.writeNode("responseFormat",a,b),a.resultModel&&this.writeNode("resultModel",a,b),a.responseMode&&this.writeNode("responseMode",a,b),b},featureOfInterest:function(a){var b=this.createElementNSPlus("featureOfInterest");return this.writeNode("ObjectID",a.objectId,b),b},ObjectID:function(a){return this.createElementNSPlus("ObjectID",{value:a})},responseFormat:function(a){return this.createElementNSPlus("responseFormat",{value:a.responseFormat})},procedure:function(a){return this.createElementNSPlus("procedure",{value:a})},offering:function(a){return this.createElementNSPlus("offering",{value:a.offering})},observedProperty:function(a){return this.createElementNSPlus("observedProperty",{value:a})},eventTime:function(a){var b=this.createElementNSPlus("eventTime");return"latest"===a.eventTime&&this.writeNode("ogc:TM_Equals",a,b),b},resultModel:function(a){return this.createElementNSPlus("resultModel",{value:a.resultModel})},responseMode:function(a){return this.createElementNSPlus("responseMode",{value:a.responseMode})}},ogc:{TM_Equals:function(a){var b=this.createElementNSPlus("ogc:TM_Equals");return this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},b),"latest"===a.eventTime&&this.writeNode("gml:TimeInstant",{value:"latest"},b),b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})}},gml:{TimeInstant:function(a){var b=this.createElementNSPlus("gml:TimeInstant");return this.writeNode("gml:timePosition",a,b),b},timePosition:function(a){var b=this.createElementNSPlus("gml:timePosition",{value:a.value});return b}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"}),OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,"double":!1,stopSingle:!1,stopDouble:!1},handlerMode:"click",setHandler:function(a){this.handlerMode=a,this.resetHandler()},resetHandler:function(){return this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null),"hover"==this.handlerMode?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions):"click"==this.handlerMode?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):"move"==this.handlerMode&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions)),this.handler?!0:!1},initialize:function(a){a=a||{},a.handlerOptions=a.handlerOptions||this.defaultHandlerOptions,OpenLayers.Control.prototype.initialize.apply(this,[a]),this.resetHandler()},handleEvent:function(a){if(null==a)return void this.reset();var b=this.map.getLonLatFromPixel(a.xy);if(b){var c=this.findLayers();if(c.length>0){for(var d,e,f={},g=0,h=c.length;h>g;g++)d=c[g],e=OpenLayers.Util.indexOf(this.map.layers,d),f[e]=d.getFeatureInfo(b);this.callback(f,b,a.xy)}}},callback:function(){},reset:function(){this.callback(null)},findLayers:function(){for(var a,b=this.layers||this.map.layers,c=[],d=b.length-1;d>=0;--d)a=b[d],a instanceof OpenLayers.Layer.UTFGrid&&c.push(a);return c},CLASS_NAME:"OpenLayers.Control.UTFGrid"}),OpenLayers.Format.CQL=function(){function a(a,b){return b instanceof RegExp?b.exec(a):b(a)}function b(b,c){var d,e,g=c.length;for(d=0;g>d;d++){e=c[d];var h=f[e],i=a(b,h);if(i){var j=i[0],k=b.substr(j.length).replace(/^\s*/,"");return{type:e,text:j,remainder:k}}}var l="ERROR: In parsing: ["+b+"], expected one of: ";for(d=0;g>d;d++)e=c[d],l+="\n    "+e+": "+f[e];throw new Error(l)}function c(a){var c,d=[],e=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{if(c=b(a,e),a=c.remainder,e=g[c.type],"END"!=c.type&&!e)throw new Error("No follows list for "+c.type);d.push(c)}while("END"!=c.type);return d}function d(a){function b(){var a=d.pop();switch(a.type){case"LOGICAL":var c=b(),e=b();return new OpenLayers.Filter.Logical({filters:[e,c],type:j[a.text.toUpperCase()]});case"NOT":var f=b();return new OpenLayers.Filter.Logical({filters:[f],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":var g,i,k;return d.pop(),i=b(),g=b(),k=b(),new OpenLayers.Filter.Comparison({property:k,lowerBoundary:g,upperBoundary:i,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":var l=b(),k=b();return new OpenLayers.Filter.Comparison({property:k,value:l,type:h[a.text.toUpperCase()]});case"IS_NULL":var k=b();return new OpenLayers.Filter.Comparison({property:k,type:h[a.text.toUpperCase()]});case"VALUE":var m=a.text.match(/^'(.*)'$/);return m?m[1].replace(/''/g,"'"):Number(a.text);case"SPATIAL":switch(a.text.toUpperCase()){case"BBOX":var n=b(),o=b(),p=b(),q=b(),r=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:r,value:OpenLayers.Bounds.fromArray([q,p,o,n])});case"INTERSECTS":var l=b(),k=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:k,value:l});case"WITHIN":var l=b(),k=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:k,value:l});case"CONTAINS":var l=b(),k=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:k,value:l});case"DWITHIN":var s=b(),l=b(),k=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:l,property:k,distance:Number(s)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(a.text);default:return a.text}}for(var c=[],d=[];a.length;){var e=a.shift();switch(e.type){case"PROPERTY":case"GEOMETRY":case"VALUE":d.push(e);break;case"COMPARISON":case"BETWEEN":case"IS_NULL":case"LOGICAL":for(var f=l[e.type];c.length>0&&l[c[c.length-1].type]<=f;)d.push(c.pop());c.push(e);break;case"SPATIAL":case"NOT":case"LPAREN":c.push(e);break;case"RPAREN":for(;c.length>0&&"LPAREN"!=c[c.length-1].type;)d.push(c.pop());c.pop(),c.length>0&&"SPATIAL"==c[c.length-1].type&&d.push(c.pop());case"COMMA":case"END":break;default:throw new Error("Unknown token type "+e.type)}}for(;c.length>0;)d.push(c.pop());var g=b();if(d.length>0){for(var i="Remaining tokens after building AST: \n",k=d.length-1;k>=0;k--)i+=d[k].type+": "+d[k].text+"\n";throw new Error(i)}return g}var e,f={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(a){var b=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(a);if(b){var c=a.length,d=a.indexOf("(",b[0].length);if(d>-1)for(var e=1;c>d&&e>0;)switch(d++,a.charAt(d)){case"(":e++;break;case")":e--}return[a.substr(0,d+1)]}},END:/^$/},g={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},h={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN,"IS NULL":OpenLayers.Filter.Comparison.IS_NULL},i={},j={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},k={},l={RPAREN:3,LOGICAL:2,COMPARISON:1};for(e in h)h.hasOwnProperty(e)&&(i[h[e]]=e);for(e in j)j.hasOwnProperty(e)&&(k[j[e]]=e);return OpenLayers.Class(OpenLayers.Format,{read:function(a){var b=d(c(a));return this.keepData&&(this.data=b),b},write:function(a){if(a instanceof OpenLayers.Geometry)return a.toString();switch(a.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(a.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+a.property+","+a.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+a.property+", "+this.write(a.value)+", "+a.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+a.property+", "+this.write(a.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+a.property+", "+this.write(a.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+a.property+", "+this.write(a.value)+")";default:throw new Error("Unknown spatial filter type: "+a.type)}case"OpenLayers.Filter.Logical":if(a.type==OpenLayers.Filter.Logical.NOT)return"NOT ("+this.write(a.filters[0])+")";for(var b="(",c=!0,d=0;d<a.filters.length;d++)c?c=!1:b+=") "+k[a.type]+" (",b+=this.write(a.filters[d]);return b+")";case"OpenLayers.Filter.Comparison":return a.type==OpenLayers.Filter.Comparison.BETWEEN?a.property+" BETWEEN "+this.write(a.lowerBoundary)+" AND "+this.write(a.upperBoundary):null!==a.value?a.property+" "+i[a.type]+" "+this.write(a.value):a.property+" "+i[a.type];case void 0:if("string"==typeof a)return"'"+a.replace(/'/g,"''")+"'";if("number"==typeof a)return String(a);default:throw new Error("Can't encode: "+a.CLASS_NAME+" "+a)}},CLASS_NAME:"OpenLayers.Format.CQL"})}(),OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.options=a||{},this.options.source&&this.setSource(this.options.source)},setSource:function(a){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=a,this.activate()):this.source=a},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);return a&&(this.source?this.source.events&&this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}):(this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(a){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(a)})}},{layerOptions:this.sourceOptions})),this.handler.activate())),a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);return a&&this.source&&this.source.events&&this.source.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}),a},onSketchComplete:function(a){return this.feature=null,!this.considerSplit(a.feature)},afterFeatureModified:function(a){if(a.modified){var b=a.feature;"function"==typeof b.geometry.split&&(this.feature=a.feature,this.considerSplit(a.feature))}},removeByGeometry:function(a,b){for(var c=0,d=a.length;d>c;++c)if(a[c].geometry===b){a.splice(c,1);break}},isEligible:function(a){return a.geometry?a.state!==OpenLayers.State.DELETE&&"function"==typeof a.geometry.split&&this.feature!==a&&(!this.targetFilter||this.targetFilter.evaluate(a.attributes)):!1},considerSplit:function(a){var b=!1,c=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(a.attributes)){for(var d,e,f,g,h,i,j,k=this.layer&&this.layer.features||[],l=[],m=[],n=this.layer===this.source&&this.mutual,o={edge:this.edge,tolerance:this.tolerance,mutual:n},p=[a.geometry],q=0,r=k.length;r>q;++q)if(g=k[q],this.isEligible(g)){h=[g.geometry];for(var s=0;s<p.length;++s){i=p[s];for(var t=0;t<h.length;++t)d=h[t],i.getBounds().intersectsBounds(d.getBounds())&&(e=i.split(d,o),e&&(f=this.events.triggerEvent("beforesplit",{source:a,target:g}),f!==!1&&(n&&(j=e[0],j.length>1&&(j.unshift(s,1),Array.prototype.splice.apply(p,j),s+=j.length-3),e=e[1]),e.length>1&&(e.unshift(t,1),Array.prototype.splice.apply(h,e),t+=e.length-3))))}h&&h.length>1&&(this.geomsToFeatures(g,h),this.events.triggerEvent("split",{original:g,features:h}),Array.prototype.push.apply(l,h),m.push(g),c=!0)}if(p&&p.length>1&&(this.geomsToFeatures(a,p),this.events.triggerEvent("split",{original:a,features:p}),Array.prototype.push.apply(l,p),m.push(a),b=!0),b||c){if(this.deferDelete){for(var u,v=[],q=0,r=m.length;r>q;++q)u=m[q],u.state===OpenLayers.State.INSERT?v.push(u):(u.state=OpenLayers.State.DELETE,this.layer.drawFeature(u));this.layer.destroyFeatures(v,{silent:!0});for(var q=0,r=l.length;r>q;++q)l[q].state=OpenLayers.State.INSERT}else this.layer.destroyFeatures(m,{silent:!0});this.layer.addFeatures(l,{silent:!0}),this.events.triggerEvent("aftersplit",{source:a,features:l})}}return b},geomsToFeatures:function(a,b){var c=a.clone();delete c.geometry;for(var d,e=0,f=b.length;f>e;++e)d=c.clone(),d.geometry=b[e],d.state=OpenLayers.State.INSERT,b[e]=d},destroy:function(){this.active&&this.deactivate(),OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"}),OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(a){var b={url:!0,layer:!0,style:!0,matrixSet:!0};for(var c in b)if(!(c in a))throw new Error("Missing property '"+c+"' in layer configuration.");a.params=OpenLayers.Util.upperCaseObject(a.params);var d=[a.name,a.url,a.params,a];if(OpenLayers.Layer.Grid.prototype.initialize.apply(this,d),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()),this.matrixIds){var e=this.matrixIds.length;if(e&&"string"==typeof this.matrixIds[0]){var f=this.matrixIds;this.matrixIds=new Array(e);for(var g=0;e>g;++g)this.matrixIds[g]={identifier:f[g]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){this.matrix=this.getMatrix(),this.matrix&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))},moveTo:function(a,b){return(b||!this.matrix)&&this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.WMTS(this.options)),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var a;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var b,c=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/28e-5,d=Number.POSITIVE_INFINITY,e=0,f=this.matrixIds.length;f>e;++e)b=Math.abs(1-this.matrixIds[e].scaleDenominator/c),d>b&&(d=b,a=this.matrixIds[e]);else a=this.matrixIds[this.getIdentifier()];else a={identifier:this.getIdentifier()};return a},getTileInfo:function(a){var b=this.getServerResolution(),c=(a.lon-this.tileOrigin.lon)/(b*this.tileSize.w),d=(this.tileOrigin.lat-a.lat)/(b*this.tileSize.h),e=Math.floor(c),f=Math.floor(d);return{col:e,row:f,i:Math.floor((c-e)*this.tileSize.w),j:Math.floor((d-f)*this.tileSize.h)}},getURL:function(a){a=this.adjustBounds(a);var b="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(a)){var c,d=a.getCenterLonLat(),e=this.getTileInfo(d),f=(this.matrix.identifier,this.dimensions);if(b=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,e.row,e.col].join(","),this.url):this.url,"REST"===this.requestEncoding.toUpperCase())if(c=this.params,-1!==b.indexOf("{")){var g=b.replace(/\{/g,"${"),h={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:e.row,TileCol:e.col};if(f){var i,j;for(j=f.length-1;j>=0;--j)i=f[j],h[i]=c[i.toUpperCase()]}b=OpenLayers.String.format(g,h)}else{var k=this.version+"/"+this.layer+"/"+this.style+"/";if(f)for(var j=0;j<f.length;j++)c[f[j]]&&(k=k+c[f[j]]+"/");k=k+this.matrixSet+"/"+this.matrix.identifier+"/"+e.row+"/"+e.col+"."+this.formatSuffix,b.match(/\/$/)||(b+="/"),b+=k}else"KVP"===this.requestEncoding.toUpperCase()&&(c={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:e.row,TILECOL:e.col,FORMAT:this.format},b=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[c]))}return b},mergeNewParams:function(a){return"KVP"===this.requestEncoding.toUpperCase()?OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(a)]):void 0},CLASS_NAME:"OpenLayers.Layer.WMTS"}),OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]),a.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){a=OpenLayers.Util.extend({},a),OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.format,d=OpenLayers.Format.XML.prototype.write.apply(c,[c.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);return b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),data:d}),b},handleRead:function(a,b){if(b.callback){var c=a.priv;c.status>=200&&c.status<300?(a.features=this.parseFeatures(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a)}},parseFeatures:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),!b||b.length<=0?null:this.format.read(b)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"}),OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments),this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(a){a=this.adjustBounds(a);var b=this.map.getResolution(),c=Math.round(1e4*this.map.getScale())/1e4,d=Math.round(a.left/b),e=-Math.round(a.top/b),f=Math.floor(d/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,g=Math.floor(e/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,h=["/",this.params.map,"/",c,"/",this.params.g.replace(/\s/g,"_"),"/def/t",g,"/l",f,"/t",e,"l",d,".",this.extension],i=this.url;
return OpenLayers.Util.isArray(i)&&(i=this.selectUrl(h.join(""),i)),i+h.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"}),OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments),this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"}),OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){b.srs[this.getChildValue(a)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(a,b){b.vendorSpecific={tileSets:[]},this.readChildNodes(a,b.vendorSpecific)},TileSet:function(a,b){var c={srs:{},bbox:{},resolutions:[]};this.readChildNodes(a,c),b.tileSets.push(c)},Resolutions:function(a,b){for(var c=this.getChildValue(a).split(" "),d=0,e=c.length;e>d;d++)""!=c[d]&&b.resolutions.push(parseFloat(c[d]))},Width:function(a,b){b.width=parseInt(this.getChildValue(a))},Height:function(a,b){b.height=parseInt(this.getChildValue(a))},Layers:function(a,b){b.layers=this.getChildValue(a)},Styles:function(a,b){b.styles=this.getChildValue(a)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"}),OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.layerStates=[]},destroy:function(){this.clearLayersArray("base"),this.clearLayersArray("data"),this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.loadContents(),this.outsideViewport||this.minimizeControl(),this.redraw(),this.div},onButtonClick:function(a){var b=a.buttonElement;b===this.minimizeDiv?this.minimizeControl():b===this.maximizeDiv?this.maximizeControl():b._layerSwitcher===this.id&&(b["for"]&&(b=document.getElementById(b["for"])),b.disabled||("radio"==b.type?(b.checked=!0,this.map.setBaseLayer(this.map.getLayer(b._layer))):(b.checked=!b.checked,this.updateMap())))},clearLayersArray:function(a){this[a+"LayersDiv"].innerHTML="",this[a+"Layers"]=[]},checkRedraw:function(){if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length)return!0;for(var a=0,b=this.layerStates.length;b>a;a++){var c=this.layerStates[a],d=this.map.layers[a];if(c.name!=d.name||c.inRange!=d.inRange||c.id!=d.id||c.visibility!=d.visibility)return!0}return!1},redraw:function(){if(!this.checkRedraw())return this.div;this.clearLayersArray("base"),this.clearLayersArray("data");var a=!1,b=!1,c=this.map.layers.length;this.layerStates=new Array(c);for(var d=0;c>d;d++){var e=this.map.layers[d];this.layerStates[d]={name:e.name,visibility:e.visibility,inRange:e.inRange,id:e.id}}var f=this.map.layers.slice();this.ascending||f.reverse();for(var d=0,c=f.length;c>d;d++){var e=f[d],g=e.isBaseLayer;if(e.displayInLayerSwitcher){g?b=!0:a=!0;var h=g?e==this.map.baseLayer:e.getVisibility(),i=document.createElement("input"),j=OpenLayers.Util.createUniqueID(this.id+"_input_");i.id=j,i.name=g?this.id+"_baseLayers":e.name,i.type=g?"radio":"checkbox",i.value=e.name,i.checked=h,i.defaultChecked=h,i.className="olButton",i._layer=e.id,i._layerSwitcher=this.id,g||e.inRange||(i.disabled=!0);var k=document.createElement("label");k["for"]=i.id,OpenLayers.Element.addClass(k,"labelSpan olButton"),k._layer=e.id,k._layerSwitcher=this.id,g||e.inRange||(k.style.color="gray"),k.innerHTML=e.name,k.style.verticalAlign=g?"bottom":"baseline";var l=document.createElement("br"),m=g?this.baseLayers:this.dataLayers;m.push({layer:e,inputElem:i,labelSpan:k});var n=g?this.baseLayersDiv:this.dataLayersDiv;n.appendChild(i),n.appendChild(k),n.appendChild(l)}}return this.dataLbl.style.display=a?"":"none",this.baseLbl.style.display=b?"":"none",this.div},updateMap:function(){for(var a=0,b=this.baseLayers.length;b>a;a++){var c=this.baseLayers[a];c.inputElem.checked&&this.map.setBaseLayer(c.layer,!1)}for(var a=0,b=this.dataLayers.length;b>a;a++){var c=this.dataLayers[a];c.layer.setVisibility(c.inputElem.checked)}},maximizeControl:function(a){this.div.style.width="",this.div.style.height="",this.showControls(!1),null!=a&&OpenLayers.Event.stop(a)},minimizeControl:function(a){this.div.style.width="0px",this.div.style.height="0px",this.showControls(!0),null!=a&&OpenLayers.Event.stop(a)},showControls:function(a){this.maximizeDiv.style.display=a?"":"none",this.minimizeDiv.style.display=a?"none":"",this.layersDiv.style.display=a?"none":""},loadContents:function(){this.layersDiv=document.createElement("div"),this.layersDiv.id=this.id+"_layersDiv",OpenLayers.Element.addClass(this.layersDiv,"layersDiv"),this.baseLbl=document.createElement("div"),this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer"),OpenLayers.Element.addClass(this.baseLbl,"baseLbl"),this.baseLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv"),this.dataLbl=document.createElement("div"),this.dataLbl.innerHTML=OpenLayers.i18n("Overlays"),OpenLayers.Element.addClass(this.dataLbl,"dataLbl"),this.dataLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv"),this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv)),this.div.appendChild(this.layersDiv);var a=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,a,"absolute"),OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton"),this.maximizeDiv.style.display="none",this.div.appendChild(this.maximizeDiv);var a=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,a,"absolute"),OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton"),this.minimizeDiv.style.display="none",this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"}),OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(a){return"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),this.parseFeatures(a)},write:function(a){var b;if(OpenLayers.Util.isArray(a)){b=this.createElementNSPlus("atom:feed"),b.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var c=0,d=a.length;d>c;c++)b.appendChild(this.buildEntryNode(a[c]))}else b=this.buildEntryNode(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},buildContentNode:function(a){var b=this.createElementNSPlus("atom:content",{attributes:{type:a.type||null}});if(a.src)b.setAttribute("src",a.src);else if("text"==a.type||null==a.type)b.appendChild(this.createTextNode(a.value));else if("html"==a.type){if("string"!=typeof a.value)throw"HTML content must be in form of an escaped string";b.appendChild(this.createTextNode(a.value))}else b.appendChild("xhtml"==a.type?a.value:"xhtml"==a.type||a.type.match(/(\+|\/)xml$/)?a.value:this.createTextNode(a.value));return b},buildEntryNode:function(a){var b=a.attributes,c=b.atom||{},d=this.createElementNSPlus("atom:entry");if(c.authors)for(var e=OpenLayers.Util.isArray(c.authors)?c.authors:[c.authors],f=0,g=e.length;g>f;f++)d.appendChild(this.buildPersonConstructNode("author",e[f]));if(c.categories)for(var h,i=OpenLayers.Util.isArray(c.categories)?c.categories:[c.categories],f=0,g=i.length;g>f;f++)h=i[f],d.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:h.term,scheme:h.scheme||null,label:h.label||null}}));if(c.content&&d.appendChild(this.buildContentNode(c.content)),c.contributors)for(var j=OpenLayers.Util.isArray(c.contributors)?c.contributors:[c.contributors],f=0,g=j.length;g>f;f++)d.appendChild(this.buildPersonConstructNode("contributor",j[f]));if(a.fid&&d.appendChild(this.createElementNSPlus("atom:id",{value:a.fid})),c.links)for(var k,l=OpenLayers.Util.isArray(c.links)?c.links:[c.links],f=0,g=l.length;g>f;f++)k=l[f],d.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:k.href,rel:k.rel||null,type:k.type||null,hreflang:k.hreflang||null,title:k.title||null,length:k.length||null}}));if(c.published&&d.appendChild(this.createElementNSPlus("atom:published",{value:c.published})),c.rights&&d.appendChild(this.createElementNSPlus("atom:rights",{value:c.rights})),(c.summary||b.description)&&d.appendChild(this.createElementNSPlus("atom:summary",{value:c.summary||b.description})),d.appendChild(this.createElementNSPlus("atom:title",{value:c.title||b.title||this.defaultEntryTitle})),c.updated&&d.appendChild(this.createElementNSPlus("atom:updated",{value:c.updated})),a.geometry){var m=this.createElementNSPlus("georss:where");m.appendChild(this.buildGeometryNode(a.geometry)),d.appendChild(m)}return d},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(a){this.gmlParser||this.initGmlParser();var b=this.gmlParser.writeNode("feature:_geometry",a);return b.firstChild},buildPersonConstructNode:function(a,b){var c=["uri","email"],d=this.createElementNSPlus("atom:"+a);d.appendChild(this.createElementNSPlus("atom:name",{value:b.name}));for(var e=0,f=c.length;f>e;e++)b[c[e]]&&d.appendChild(this.createElementNSPlus("atom:"+c[e],{value:b[c[e]]}));return d},getFirstChildValue:function(a,b,c,d){var e,f=this.getElementsByTagNameNS(a,b,c);return e=f&&f.length>0?this.getChildValue(f[0],d):d},parseFeature:function(a){var b={},c=null,d=null,e=null,f=this.namespaces.atom;this.parsePersonConstructs(a,"author",b),d=this.getElementsByTagNameNS(a,f,"category"),d.length>0&&(b.categories=[]);for(var g=0,h=d.length;h>g;g++)c={},c.term=d[g].getAttribute("term"),e=d[g].getAttribute("scheme"),e&&(c.scheme=e),e=d[g].getAttribute("label"),e&&(c.label=e),b.categories.push(c);d=this.getElementsByTagNameNS(a,f,"content"),d.length>0&&(c={},e=d[0].getAttribute("type"),e&&(c.type=e),e=d[0].getAttribute("src"),e?c.src=e:(c.value="text"==c.type||"html"==c.type||null==c.type?this.getFirstChildValue(a,f,"content",null):"xhtml"==c.type||c.type.match(/(\+|\/)xml$/)?this.getChildEl(d[0]):this.getFirstChildValue(a,f,"content",null),b.content=c)),this.parsePersonConstructs(a,"contributor",b),b.id=this.getFirstChildValue(a,f,"id",null),d=this.getElementsByTagNameNS(a,f,"link"),d.length>0&&(b.links=new Array(d.length));for(var i=["rel","type","hreflang","title","length"],g=0,h=d.length;h>g;g++){c={},c.href=d[g].getAttribute("href");for(var j=0,k=i.length;k>j;j++)e=d[g].getAttribute(i[j]),e&&(c[i[j]]=e);b.links[g]=c}c=this.getFirstChildValue(a,f,"published",null),c&&(b.published=c),c=this.getFirstChildValue(a,f,"rights",null),c&&(b.rights=c),c=this.getFirstChildValue(a,f,"summary",null),c&&(b.summary=c),b.title=this.getFirstChildValue(a,f,"title",null),b.updated=this.getFirstChildValue(a,f,"updated",null);var l={title:b.title,description:b.summary,atom:b},m=this.parseLocations(a)[0],n=new OpenLayers.Feature.Vector(m,l);return n.fid=b.id,n},parseFeatures:function(a){var b=[],c=this.getElementsByTagNameNS(a,this.namespaces.atom,"entry");0==c.length&&(c=[a]);for(var d=0,e=c.length;e>d;d++)b.push(this.parseFeature(c[d]));return b},parseLocations:function(a){var b=this.namespaces.georss,c={components:[]},d=this.getElementsByTagNameNS(a,b,"where");if(d&&d.length>0){this.gmlParser||this.initGmlParser();for(var e=0,f=d.length;f>e;e++)this.gmlParser.readChildNodes(d[e],c)}var g=c.components,h=this.getElementsByTagNameNS(a,b,"point");if(h&&h.length>0)for(var e=0,f=h.length;f>e;e++){var i=OpenLayers.String.trim(h[e].firstChild.nodeValue).split(/\s+/);2!=i.length&&(i=OpenLayers.String.trim(h[e].firstChild.nodeValue).split(/\s*,\s*/)),g.push(new OpenLayers.Geometry.Point(i[1],i[0]))}var j=this.getElementsByTagNameNS(a,b,"line");if(j&&j.length>0)for(var k,l,m,e=0,f=j.length;f>e;e++){k=OpenLayers.String.trim(j[e].firstChild.nodeValue).split(/\s+/),m=[];for(var n=0,o=k.length;o>n;n+=2)l=new OpenLayers.Geometry.Point(k[n+1],k[n]),m.push(l);g.push(new OpenLayers.Geometry.LineString(m))}var p=this.getElementsByTagNameNS(a,b,"polygon");if(p&&p.length>0)for(var k,l,m,e=0,f=p.length;f>e;e++){k=OpenLayers.String.trim(p[e].firstChild.nodeValue).split(/\s+/),m=[];for(var n=0,o=k.length;o>n;n+=2)l=new OpenLayers.Geometry.Point(k[n+1],k[n]),m.push(l);g.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(m)]))}if(this.internalProjection&&this.externalProjection)for(var e=0,f=g.length;f>e;e++)g[e]&&g[e].transform(this.externalProjection,this.internalProjection);return g},parsePersonConstructs:function(a,b,c){for(var d=[],e=this.namespaces.atom,f=this.getElementsByTagNameNS(a,e,b),g=["uri","email"],h=0,i=f.length;i>h;h++){var j={};j.name=this.getFirstChildValue(f[h],e,"name",null);for(var k=0,l=g.length;l>k;k++){var m=this.getFirstChildValue(f[h],e,g[k],null);m&&(j[g[k]]=m)}d.push(j)}d.length>0&&(c[b+"s"]=d)},CLASS_NAME:"OpenLayers.Format.Atom"}),OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){var a=this.observeElement||document;this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:a})},defaultKeyPress:function(a){var b,c=!0,d=OpenLayers.Event.element(a);if(!d||"INPUT"!=d.tagName&&"TEXTAREA"!=d.tagName&&"SELECT"!=d.tagName){switch(a.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:b=this.map.getSize(),this.map.pan(0,-.75*b.h);break;case 34:b=this.map.getSize(),this.map.pan(0,.75*b.h);break;case 35:b=this.map.getSize(),this.map.pan(.75*b.w,0);break;case 36:b=this.map.getSize(),this.map.pan(-.75*b.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:c=!1}c&&OpenLayers.Event.stop(a)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"}),OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),this.options=a;var b=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(b,this.yx)},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b.version=this.version,b},readers:{wmts:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={},b.contents.layers=[],b.contents.tileMatrixSets={},this.readChildNodes(a,b.contents)},Layer:function(a,b){var c={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};c.layers=[],this.readChildNodes(a,c),b.layers.push(c)},Style:function(a,b){var c={};c.isDefault="true"===a.getAttribute("isDefault"),this.readChildNodes(a,c),b.styles.push(c)},Format:function(a,b){b.formats.push(this.getChildValue(a))},TileMatrixSetLink:function(a,b){var c={};this.readChildNodes(a,c),b.tileMatrixSetLinks.push(c)},TileMatrixSet:function(a,b){if(b.layers){var c={matrixIds:[]};this.readChildNodes(a,c),b.tileMatrixSets[c.identifier]=c}else b.tileMatrixSet=this.getChildValue(a)},TileMatrix:function(a,b){var c={supportedCRS:b.supportedCRS};this.readChildNodes(a,c),b.matrixIds.push(c)},ScaleDenominator:function(a,b){b.scaleDenominator=parseFloat(this.getChildValue(a))},TopLeftCorner:function(a,b){var c,d=this.getChildValue(a),e=d.split(" ");if(b.supportedCRS){var f=b.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");c=!!this.yx[f]}b.topLeftCorner=c?new OpenLayers.LonLat(e[1],e[0]):new OpenLayers.LonLat(e[0],e[1])},TileWidth:function(a,b){b.tileWidth=parseInt(this.getChildValue(a))},TileHeight:function(a,b){b.tileHeight=parseInt(this.getChildValue(a))},MatrixWidth:function(a,b){b.matrixWidth=parseInt(this.getChildValue(a))},MatrixHeight:function(a,b){b.matrixHeight=parseInt(this.getChildValue(a))},ResourceURL:function(a,b){b.resourceUrl=b.resourceUrl||{};var c=a.getAttribute("resourceType");b.resourceUrls||(b.resourceUrls=[]);var d=b.resourceUrl[c]={format:a.getAttribute("format"),template:a.getAttribute("template"),resourceType:c};b.resourceUrls.push(d)},WSDL:function(a,b){b.wsdl={},b.wsdl.href=a.getAttribute("xlink:href")},ServiceMetadataURL:function(a,b){b.serviceMetadataUrl={},b.serviceMetadataUrl.href=a.getAttribute("xlink:href")},LegendURL:function(a,b){b.legend={},b.legend.href=a.getAttribute("xlink:href"),b.legend.format=a.getAttribute("format")},Dimension:function(a,b){var c={values:[]};this.readChildNodes(a,c),b.dimensions.push(c)},Default:function(a,b){b["default"]=this.getChildValue(a)},Value:function(a,b){b.values.push(this.getChildValue(a))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"}),define("openlayers",function(a){return function(){var b;return b||a.OpenLayers}}(this)),define("extensions.qliktech/map/base-map-layer",["jquery","angular","objects.views/charts/components/chart-component","objects.utils/shapes/rect","objects.utils/shapes/point","openlayers","general.services/media-tool/media-tool-service"],function(a,b,c,d,e,f,g){function h(){var a,b,c,d;a=this._viewportProjection?this._viewportProjection.getViewRectangleInLonLat():void 0,a&&(b=new f.Geometry.Point(a.x,a.y),b.transform(u,t),c=new f.Geometry.Point(a.x+a.width,a.y+a.height),c.transform(u,t),d=new f.Bounds,d.extend(b),d.extend(c),d.toBBOX(),this._openLayers.zoomToExtent(d))}function i(a,b){var c=document.createElement("script");c.type="text/javascript",c.readyState?c.onreadystatechange=function(){("loaded"===c.readyState||"complete"===c.readyState)&&(c.onreadystatechange=null,"function"==typeof b&&b())}:c.onload=function(){"function"==typeof b&&b()},c.src=a,document.body.appendChild(c)}function j(){var a;for(A=y,f.Map.prototype.adjustZoom=function(a){return a},f.Element.hasClass=function(a,b){var c=a?a.className:void 0;return!!c&&RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},f.Event.observe=function(a,b,c,d){var e,g,h;e=f.Util.getElement(a),e&&(d=d||!1,"keypress"===b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.attachEvent)&&(b="keydown"),this.observers||(this.observers={}),e._eventCacheID||(h="eventCacheID_",e.id&&(h=e.id+"_"+h),e._eventCacheID=f.Util.createUniqueID(h)),g=e._eventCacheID,this.observers[g]||(this.observers[g]=[]),this.observers[g].push({element:e,name:b,observer:c,useCapture:d}),e.addEventListener?e.addEventListener(b,c,d):e.attachEvent&&e.attachEvent("on"+b,c))},t=new f.Projection("EPSG:900913"),u=new f.Projection("EPSG:4326"),a=z.shift();a;)a(),a=z.shift()}function k(a){this._attribution=g.toHTML(a),this.fire("attributionChanged",[a])}function l(){var a,b;a=this._viewportProjection.getZoomLevel(),b=this._viewportProjection.getMapCenterInLonLat(),this.setMapCenter(b),this.setZoomLevel(a)}function m(){if(this._viewportProjection&&this.show){var a,b,c,d,e=!1;a=this.getZoomLevel(),b=this.getMapCenter(),c=this._viewportProjection.getZoomLevel(),d=this._viewportProjection.getMapCenterInLonLat(),b||(b=d),Math.abs(a-c)<.001&&(!d||d.closeTo(b,1e-6))||(this._viewportProjection.enabledChangeEvent=!1,e=e||this._viewportProjection.setZoomLevel(a),e=e||this._viewportProjection.setMapCenterInLonLat(b),this._viewportProjection.inResetZoomMode&&(this._viewportProjection.inResetZoomMode=!1,this._viewportProjection.fire("resetZoomFinished")),e&&this._viewportProjection.fire("changed"),this._viewportProjection.enabledChangeEvent=!0)}}function n(a){a.events.register("loadend",this,m),this._openLayers.addLayer(a),this._openLayers.setBaseLayer(a),o.call(this),this._baseLayer=a}function o(){this._baseLayer&&(this._openLayers.removeLayer(this._baseLayer),this._baseLayer.events.unregister("loadend",this,m)),this._baseLayer=void 0}function p(a){var c,d=a.urls,e=a.attribution||"";(this._urls!==d||this._attribution!==e)&&(b.equals(this._urls,d)||(this._urls=d,this._urls&&this._urls.some(function(a){return a&&a.trim()})?(c=new f.Layer.XYZ("XYZ",this._urls,{wrapDateLine:!0}),n.call(this,c)):o.call(this)),this._attribution!==e&&k.call(this,e))}function q(a){var c,d=a.urls,e=a.params||"";try{e=JSON.parse(e)}catch(g){return}(this._urls!==d||this._params!==e)&&(this._params=e,b.equals(this._urls,d)||(this._urls=d,this._urls?(c=new f.Layer.WMS("WMS",this._urls,this._params),n.call(this,c)):o.call(this)))}function r(a){var c,d=a.urls,e=a.params||"";try{e=JSON.parse(e)}catch(g){return}b.equals(this._urls,d)||(this._params=e,this._urls!==d&&(this._urls=d,this._urls?(c=new f.Layer.TMS("TMS",this._urls?this._urls:"blank",this._params),n.call(this,c)):o.call(this)))}var s,t,u,v,w=1,x=2,y=3,z=[],A=w,B=1e-9,C=1e-4,D=20,E=0;return window.hasOwnProperty("OpenLayers")&&j(),s=c.extend("BaseMapLayer",{init:function(){function b(){v=new f.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}}),c._openLayers=new f.Map({div:c.container,transitionEffect:null,zoomMethod:null,controls:[v],projection:new f.Projection("EPSG:900913"),displayProjection:new f.Projection("EPSG:4326"),maxExtent:new f.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),displayOutsideMaxExtent:!0,wrapDateLine:!0}),0!==c._viewState&&c._openLayers.controls.length&&v.deactivate(),c._minZoomLevel=0,c._maxZoomLevel=20,h.call(c),c._zoomCenterInitialized=!1,c._viewportProjection&&(c.updateViewportToBaseMap(!1),c._zoomCenterInitialized=!0),c._ready=!0}this._super.apply(this,arguments),this._attribution=null,this._mapCenter=null,this._zoomLevel=null,this._layerNames=["OSM","MQ-OSM","MQSatellite"],this._selectedLayerName="OSM",this._googleMapLayersAdded=!1,this._isBingMapUsed=!1,this._needToSetBackgroundMapType=!1;var c=this;a(this.container).css({width:"100%",height:"100%"}),window.hasOwnProperty("OpenLayers")?b():A===w?(A=x,z.push(b),i("http://www.openlayers.org/api/OpenLayers.js",j)):A===x&&z.push(b)},getAttribution:function(){return void 0===this._attribution?"":this._attribution},setViewportProjection:function(a){this._viewportProjection!==a&&(this._viewportProjection&&(this._viewportProjection.stopListen("changed",l,this),this._viewportProjection.stopListen("changedByInteraction",l,this)),this._viewportProjection=a,this._viewportProjection&&(this._viewportProjection.listen("changed",l,this),this._viewportProjection.listen("changedByInteraction",l,this)),this.updateViewportToBaseMap(!0))},setRect:function(a,b,c,e){this._super(a,b,c,e),this._viewport=new d(a,b,c,e)},getViewport:function(){return this._viewport},setFirstAutoZoomed:function(a){this._firstAutoZoomed=a},getFirstAutoZoomed:function(){return this._firstAutoZoomed},hasValidSize:function(){if(!this._openLayers)return!1;var a=this._openLayers.getSize();return a&&a.w>0&&a.h>0},isReady:function(){return this._ready&&this._openLayers&&this._openLayers.layers&&this._openLayers.layers.length>0&&this._baseLayer},setViewState:function(a){this._viewState=a,this._openLayers&&0!==this._openLayers.controls.length&&(0===this._viewState?v.activate():v.deactivate())},showComponent:function(){this._super(),this._openLayers&&this._openLayers.baseLayer&&this._openLayers.baseLayer.setVisibility(!0),this.updateViewportToBaseMap(!0)},hideComponent:function(){this._super(),this._openLayers&&this._openLayers.baseLayer&&this._openLayers.baseLayer.setVisibility(!1)},getMapCenter:function(){if(this.show&&this.isReady()&&this.hasValidSize()){var a=this._openLayers.getCenter();if(a)return a.transform(this._openLayers.getProjectionObject(),u),new e(a.lon,a.lat)}},setMapCenter:function(a){if(a&&this.show&&this.isReady()&&this.hasValidSize()){var b,c;b=this.getMapCenter(),b&&b.closeTo(a,B)||(this._mapCenter=a,c=new f.LonLat(a.x,a.y),c.transform(u,this._openLayers.getProjectionObject()),this._openLayers.setCenter(c))}},getZoomLevel:function(){return this.show&&this.isReady()&&this.hasValidSize()?this._openLayers.zoom:0},setZoomLevel:function(a){this.show&&this._openLayers&&this.hasValidSize()&&!(Math.abs(this.getZoomLevel()-a)<C)&&this.isReady()&&(this._zoomLevel=a,this._openLayers.zoomTo(a))},panBy:function(a,b){this.show&&this.isReady()&&this.hasValidSize()&&this._openLayers.moveByPx(a,b)},fromLonLatToViewport:function(a){if(!this.show||!this.isReady()||!this.hasValidSize())return void 0;var b,c;return b=new f.LonLat(a.x,a.y),b.transform(u,this._openLayers.getProjectionObject()),c=this._openLayers.getViewPortPxFromLonLat(b),new e(c.x,c.y)},fromViewportToLonLat:function(a){if(!this.show||!this.isReady()||!this.hasValidSize())return void 0;var b,c,d;return b=new f.Pixel(a.x,a.y),c=this._openLayers.getLonLatFromViewPortPx(b),d=this._openLayers.getProjectionObject(),c.transform(d,u),new e(c.lon,c.lat)},updateViewportToBaseMap:function(a){var b,c,d,e,f=!1;return this._viewportProjection&&this.isReady()?(c=this._viewportProjection.getZoomLevel(),b=this._viewportProjection.getMapCenterInLonLat(),b=b?b:{x:0,y:0},c=Math.min(D,Math.max(E,c)),this.setMapCenter(b),this.setZoomLevel(c),a&&(d=this.getMapCenter(),e=this.getZoomLevel(),this._viewportProjection.enabledChangeEvent=!1,Math.abs(e-c)>C&&(f=f||this._viewportProjection.setZoomLevel(e)),d&&b&&!d.closeTo(b)&&(f=f||this._viewportProjection.setMapCenterInLonLat(d)),f&&this._viewportProjection.fire("changedByInteraction"),this._viewportProjection.enabledChangeEvent=!0),f):f},setData:function(a){this._super(a);var b,c,d,e;if(d=this._data.background.defaultMapService,d?(b={urls:["http://a.tiles.mapbox.com/v3/qlik.a9f74321/${z}/${x}/${y}.png?access_token=pk.eyJ1IjoicWxpayIsImEiOiJwZHptbGw4In0.FbrCcSWr4wJj9DeIj7VLgQ","http://b.tiles.mapbox.com/v3/qlik.a9f74321/${z}/${x}/${y}.png?access_token=pk.eyJ1IjoicWxpayIsImEiOiJwZHptbGw4In0.FbrCcSWr4wJj9DeIj7VLgQ","http://c.tiles.mapbox.com/v3/qlik.a9f74321/${z}/${x}/${y}.png?access_token=pk.eyJ1IjoicWxpayIsImEiOiJwZHptbGw4In0.FbrCcSWr4wJj9DeIj7VLgQ","http://d.tiles.mapbox.com/v3/qlik.a9f74321/${z}/${x}/${y}.png?access_token=pk.eyJ1IjoicWxpayIsImEiOiJwZHptbGw4In0.FbrCcSWr4wJj9DeIj7VLgQ"],type:"XYZ",attribution:"<a href='https://www.mapbox.com/about/maps/'>&copy; Mapbox &copy; OpenStreetMap</a> <a class='mapbox-improve-map' href='https://www.mapbox.com/map-feedback/' target='_blank'>Improve this map</a>"},c="XYZ"):(b=this._data.background.layers?this._data.background.layers[0]:{},c=b.type||"XYZ"),b&&(this._urls||b.urls))switch(c){case"XYZ":p.call(this,b);break;case"WMS":q.call(this,b);break;case"TMS":r.call(this,b)}this._openLayers&&this._baseLayer&&(E=this._openLayers.getMinZoom(),D=this._openLayers.getNumZoomLevels()+E-1,(this._minZoomLevel!==E||this._maxZoomLevel!==D)&&(this._minZoomLevel=E,this._maxZoomLevel=D,this.fire("maxMinZoomLevelChanged",[D,E]))),e=this._data&&this._data.background&&this._data.background.show&&(d||this._data.background.layers&&this._data.background.layers.length>0&&this._data.background.layers[0].urls&&this._data.background.layers[0].urls.length>0&&this._data.background.layers[0].urls.some(function(a){return a&&a.trim()})),e?this.showComponent():this.hideComponent(),this.fire("baseLayerChanged"),this.invalidateProperties("BaseMapLayer.setData")},hasValidData:function(){return!0},paint:function(){this._super(this._layoutMode);var a,b,c;this._openLayers&&(a=this._openLayers.getSize(),b=a.w,c=a.h,(b!==this.rect.width||c!==this.rect.height)&&this._openLayers.updateSize())},_updateProperties:function(){!this.show},afterPaint:function(){},release:function(){this._super(),o.call(this),v.destroy(),this._openLayers.destroy()}})}),define("extensions.qliktech/map/layer-dependency",["objects.views/charts/events/event-launcher"],function(a){function b(){this._layer&&(this._colorMapData=this._layer.getLayerOutputData(),this.fire("changed"))}var c;return c=a.extend("LayerDependency",{init:function(){this._super()},setLayer:function(a){this._layer!==a&&(this._layer&&this._layer.stopListen("dataChanged",b,this),this._layer=a,this._layer&&this._layer.listen("dataChanged",b,this))},getColorMapData:function(){return this._colorMapData},release:function(){this._layer&&this._layer.stopListen("dataChanged",b,this),this._layer=null}})}),define("extensions.qliktech/map/map-area",["jquery","objects.views/charts/components/chart-component","objects.utils/shapes/rect","extensions.qliktech/map/map-polygon-layer","extensions.qliktech/map/map-polygon2-layer","extensions.qliktech/map/map-polygon3-layer","extensions.qliktech/map/map-glyph-layer","extensions.qliktech/map/base-map-layer","extensions.qliktech/map/layer-dependency","objects.views/charts/utils/chart-formatting","touche"],function(a,b,c,d,e,f,g,h,i,j){function k(a){switch(a.type){case"polygon":return"2"===a.version?e:"3"===a.version?f:d;case"point":return g}return null}function l(a){var b;a.setLayoutMode(this._layoutMode),b=this.rect,a.setRect(b.x,b.y,b.width,b.height),b=this.outerRect,a.setOuterRect(b.x,b.y,b.width,b.height),b=this.containerRect,a.setContainerRect(b.x,b.y,b.width,b.height),b=this.layoutToContainerRatios,a.setLayoutToContainerRatios(b.x,b.y),a.setViewportProjection(this._viewportProjection)}function m(a,b,c,d){var e="layer."+d+"."+b+(void 0===c?"":c),f=new a(this.layersContainer,{clazz:a},e);return f.setLayerType(b),f.setVersion(c),f}function n(){var a,b,c,d,e,f,g,i;for(b=this._data?this._data.layers:null,d=b?b.length:0,d=Math.min(d,this._maxNumLayers),!this.baseMapLayer&&this._data&&this._data.background&&this._data.background.show&&(this._data.background.defaultMapService||this._data.background.layers&&this._data.background.layers.length>0&&this._data.background.layers[0].urls&&this._data.background.layers[0].urls.length>0&&this._data.background.layers[0].urls.some(function(a){return a&&a.trim()}))&&(this.addBaseMapLayer(new h(this.layersContainer,{clazz:h},"BaseMapLayer")),this.addAttributionLayer(document.createElement("div"))),a=0;d>a;a++)c=b[a],f=c.type,g=c.version,i=k(c),i&&(e=this.layers[a],e?(e.getLayerType()!==f||e.getVersion()!==g)&&this.removeLayer(e,!0):(e=m.apply(this,[i,f,g,a]),this.addLayer(e,a)));
if(this._numLayers>d)for(a=d;a<this._numLayers;a++)e=this._layers[a],e&&this.removeLayer(e);this._numLayers=d,this.attributionLayer&&this.container.appendChild(this.attributionLayer)}function o(){for(var a=0;a<this._numLayers;a++)this.layers[a].setData(this._data,this._data.layers[a]);this.baseMapLayer&&(this.baseMapLayer.setData(this._data),v.call(this))}function p(){this._numLayers<1||this.layers[this._numLayers-1].updateBackendApi()}function q(a,b){var c,d,e,f,g,h,i,j;a&&(c=a.x,d=a.x+a.width,e=a.y,f=a.y+a.height,g=b.x,h=b.x+b.width,i=b.y,j=b.y+b.height,g>c&&(c=g),d>h&&(d=h),i>e&&(e=i),f>j&&(f=j),a.set(c,e,d-c,f-e))}function r(){var a,b;for(a=0;a<this._numLayers;a++)b=this.layers[a],b&&!b.hasValidData()&&b.clear()}function s(){var a,b,c=Math.min(this._numLayers,this._maxNumLayers);for(a=0;c>a;a++){if(b=this._data.layers[a],b&&b.qHyperCube&&b.qHyperCube.qDimensionInfo&&b.qHyperCube.qDimensionInfo.length>0)return this.layers[a];if(b&&b.qListObject&&b.qListObject.qDimensionInfo&&b.qListObject.qDimensionInfo.qFallbackTitle)return this.layers[a]}}function t(){var a=this._colorMap.getLegendDataProvider();a.setLegendMarker("point"===this.coloredLayer.getLayerData().type?"circle":"rect")}function u(a,b){this._interactionController.setMaxZoomLevel(a),this._interactionController.setMinZoomLevel(b)}function v(){this.attributionLayer.innerHTML=this.baseMapLayer&&this.baseMapLayer.show&&this.baseMapLayer.isReady()?this.baseMapLayer.getAttribution():""}function w(){var a=this.baseMapLayer&&this.baseMapLayer.show&&this.baseMapLayer.isReady();this.map.setFractionalZoomMode(!a)}function x(){this.updateSelectableShapes()}function y(){var a,b,c,d,e=!1,f=!1,g=this._changedBoundsLayers?this._changedBoundsLayers.length:0;if(this.layersReady&&0!==g){for(b=0;b<this._numLayers;b++)this.layers[b].isVisible()&&(c=this.layers[b].getLayerBounds(),c&&(d=d?d.union(c):c.clone()));if(q.apply(this,[d,this._worldBounds]),this._unionBounds=void 0===d&&void 0===this._unionBounds?this._worldBounds:d,this._unionBounds&&this._unionBounds.hasNaN()&&(this._unionBounds=this._worldBounds),this._unionBounds&&void 0!==d){for(b=0;g>b;b++)a=this._changedBoundsLayers[b],a&&(e=!0,(!a.getFirstAutoZoomed()||this.map.getAutoZoomOnDataChange())&&(this._unionBounds.width||this._unionBounds.height)&&(f=!0,a.setFirstAutoZoomed(!0)));e&&this.map.setMapBounds(this._unionBounds),f&&!this.map.isSnapshot()&&this.map.zoomOnMapBounds()}else 0===g&&this.baseMapLayer&&void 0===d&&!this.baseMapLayer.getFirstAutoZoomed()&&((void 0===this._unionBounds||this._unionBounds.hasNaN())&&(this._unionBounds=this._worldBounds),this.map.setMapBounds(this._unionBounds),this._unionBounds.width&&this._unionBounds.height&&!this.map.isSnapshot()&&(this.map.zoomOnMapBounds(),this.baseMapLayer.setFirstAutoZoomed(!0)));this._changedBoundsLayers=[]}}function z(a){-1===this._changedBoundsLayers.indexOf(a)&&(this._changedBoundsLayers.push(a),y.call(this))}function A(){var a,b,c,d=0;for(a=0;a<this._numLayers;a++)b=this.layers[a],c=b&&b.getNumPoints?b.getNumPoints():0,d+=c;this.map.setZoomPanByWebkitTransform(d>E)}function B(){var a=this._layerDependency.getColorMapData();this._colorMap.setData(a),this._legend.setData(a),this._chartContext.refresh(a),t.call(this),this.layersReady=!0,this.map.layersReady=!0,this.map.paint(this._data),y.call(this)}var C,D=".maparea",E=3e4;return C=b.extend("MapArea",{init:function(a,b){this._super.apply(this,Array.prototype.slice.call(arguments)),this.layers=[],this._maxNumLayers=1,this._numLayers=0,this.options=b,this._unionBounds=void 0,this._worldBounds=new c(-180,-180,360,360),this._changedBoundsLayers=[],this._layerDependency=new i,this._layerDependency.listen("changed",B,this)},setMaxNumLayers:function(a){isNaN(a)&&(a=0),this._maxNumLayers=a},getMaxNumLayers:function(){return this._maxNumLayers},setData:function(a){this.layersReady=!1,this._data=a,n.call(this),p.call(this),this.coloredLayer=s.call(this),this._layerDependency.setLayer(this.coloredLayer),o.call(this),r.call(this),this.map.setFormatter(new j(this.backendApi.localeInfo,this.coloredLayer.getMeasureInfo()))},addLayer:function(a,b){a&&(a.setLayerIndex(b),a.setBackendApi(this.backendApi),a.listen("selectableShapesChanged",x,this),a.listen("boundsChanged",z,this),a.listen("numPointsChanged",A,this),a.setColorMap(this._colorMap),l.call(this,a),this.layers[b]=a)},removeLayer:function(a,b){if(a){var c,d,e=this.layers.indexOf(a);a.stopListen("selectableShapesChanged",x,this),a.stopListen("boundsChanged",z,this),a.stopListen("numPointsChanged",A,this),a.clear(),a.release(),a.off(),a.container&&a.container.parentElement&&(c=a.container,d=c.parentElement,d.removeChild(c)),!b&&e>-1&&this.layers.splice(e,1)}},addBaseMapLayer:function(a){this.baseMapLayer||(this.baseMapLayer=a,this.layersContainer.insertBefore(a.container,this.layersContainer.firstChild),l.call(this,a),a.listen("maxMinZoomLevelChanged",u,this),a.listen("attributionChanged",v,this),a.listen("baseLayerChanged",w,this),a.setViewState(this.map.getViewState()))},removeBaseMapLayer:function(){if(this.baseMapLayer){var a,b;this.baseMapLayer.stopListen("maxMinZoomLevelChanged",u,this),this.baseMapLayer.stopListen("attributionChanged",v,this),this.baseMapLayer.stopListen("baseLayerChanged",w,this),this.baseMapLayer.container&&this.baseMapLayer.container.parentElement&&(a=this.baseMapLayer.container,b=a.parentElement,b.removeChild(a))}},addAttributionLayer:function(a){this.attributionLayer||(this.attributionLayer=a,a.style.position="absolute",a.style.bottom="0",a.style.right="0",Touche(a).tap({id:D,options:{preventDefault:!1},start:function(){Touche.preventGestures(this.gestureHandler)}}),this.container.appendChild(a))},removeAttributionLayer:function(){this.attributionLayer&&this.container.removeChild(this.attributionLayer)},setBackendApi:function(a){this.backendApi=a;for(var b=0;b<this._numLayers;b++)this.layers[b].setBackendApi(a)},setMap:function(a){this.map=a},getMap:function(){return this.map},setViewportProjection:function(a){if(this._viewportProjection!==a){this._viewportProjection=a;for(var b=0;b<this._numLayers;b++)this.layers[b].setViewportProjection(this._viewportProjection);this.baseMapLayer&&this.baseMapLayer.setViewportProjection(this._viewportProjection)}},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setLegend:function(a){this._legend=a},setChartContext:function(a){this._chartContext=a},setInteractionController:function(a){this._interactionController=a},setHasValidData:function(a){this._super(a);for(var b=0;b<this._numLayers;b++)this.layers[b].setHasValidData(a)},hasValidData:function(){return this._super()&&this._data},setLayoutMode:function(a){this._super(a);for(var b=0;b<this._numLayers;b++)this.layers[b].setLayoutMode(a);this.baseMapLayer&&this.baseMapLayer.setLayoutMode(a)},setRect:function(a,b,c,d){this._super(a,b,c,d);for(var e=0;e<this._numLayers;e++)this.layers[e].setRect(0,0,c,d);this.baseMapLayer&&this.baseMapLayer.setRect(0,0,c,d)},setOuterRect:function(a,b,c,d){this._super(a,b,c,d);for(var e=0;e<this._numLayers;e++)this.layers[e].setOuterRect(0,0,c,d);this.baseMapLayer&&this.baseMapLayer.setOuterRect(0,0,c,d)},setLayoutToContainerRatios:function(a,b){this._super(a,b);for(var c=0;c<this._numLayers;c++)this.layers[c].setLayoutToContainerRatios(a,b);this.baseMapLayer&&this.baseMapLayer.setLayoutToContainerRatios(a,b)},updateSize:function(){this._super(),this.rect.x*=this.layoutToContainerRatios.x||1,this.rect.width*=this.layoutToContainerRatios.x||1,this.rect.y*=this.layoutToContainerRatios.y||1,this.rect.height*=this.layoutToContainerRatios.y||1,this.layoutToContainerRatios={x:1,y:1};for(var a in this.renderers)this.renderers[a].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[a].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1);for(var b=0;b<this._numLayers;b++)this.layers[b].updateSize()},setContainerRect:function(a,b,c,d){this._super(a,b,c,d);for(var e=0;e<this._numLayers;e++)this.layers[e].setContainerRect(0,0,c,d);this.baseMapLayer&&this.baseMapLayer.setContainerRect(0,0,c,d)},showComponent:function(){this._super();var a,b;for(a=0;a<this._numLayers;a++)for(b=0;b<this.layers[a].renderers.length;b++)this.layers[a].renderers[b].show();this.baseMapLayer&&(this.baseMapLayer.showComponent(),v.call(this))},hideComponent:function(){this._super();var a,b;for(a=0;a<this._numLayers;a++)for(b=0;b<this.layers[a].renderers.length;b++)this.layers[a].renderers[b].hide();this.baseMapLayer&&(this.baseMapLayer.hideComponent(),v.call(this))},hasVisibleLayer:function(){for(var a=0;a<this._numLayers;a++)if(this.layers[a].show)return!0;return!1},hasVisibleBaseLayer:function(){return this.baseMapLayer&&this.baseMapLayer.show},isVisible:function(a){return this._super(a)&&this.rect&&this.rect.width>0&&this.rect.height>0},clear:function(){for(var a=0;a<this._numLayers;a++)this.layers[a].clear()},release:function(){for(var a=0;a<this._numLayers;a++)this.layers[a].release();this.baseMapLayer&&(this.baseMapLayer.release(),this.baseMapLayer.stopListen("attributionChanged"),this.baseMapLayer.stopListen("baseLayerChanged")),this.map=null,this.baseMapLayer=null,this.backendApi=null},setGlobalOpacity:function(a,b){this._globalAlpha=a;for(var c=0;c<this._numLayers;c++)this.layers[c].setGlobalOpacity(a,b)},updateSelectableShapes:function(){if(0!==this._numLayers){var a,b,c;for(c=this.layers[0].getSelectableShapes(),a=1;a<this._numLayers;a++)b=this.layers[a].getSelectableShapes(),b&&b.length>0&&(c=c.concat(b));this.setSelectableShapes(c)}},paint:function(a,b){if(this.layersReady&&b){this._super(a,b);for(var c=0;c<this._numLayers;c++)this.layers[c].invalidateProperties("MapArea.paint"),this.layers[c].invalidateDisplay("MapArea.paint");this.baseMapLayer&&this.baseMapLayer.invalidateDisplay("MapArea.paint")}},setPreselectionMode:function(a){this._preselectionMode=a;for(var b=0;b<this._numLayers;b++)this.layers[b].setPreselectionMode(a)},_updateProperties:function(){this._data&&this.invalidateDisplay("MapArea._updateProperties")},_createRenderArea:function(){this.parentContainer&&(this.container=document.createElement("div"),this._$renderAreaWrap=a(this.container),this._$renderAreaWrap.attr("tid",this.testId),this._$renderAreaWrap.css({position:"absolute",overflow:"hidden"}).addClass("qv-chart-component"),this.parentContainer.appendChild(this.container),this.layersContainer=document.createElement("div"),this._$layersContainerWrap=a(this.layersContainer),this._$layersContainerWrap.css({position:"absolute",width:"100%",height:"100%"}),this.container.appendChild(this.layersContainer))}}),Object.defineProperty(C.prototype,"className",{value:"MapArea"}),C}),define("extensions.qliktech/map/map-util",["general.utils/array-util"],function(a){var b=!1,c=!1,d={isGeoField:function(a){return d.isGeoPointField(a)||d.isGeoPolygonField(a)},isGeoPointField:function(a){return a.qTags.indexOf("$geopoint")>-1},isGeoPolygonField:function(a){return a.qTags.indexOf("$geomultipolygon")>-1||a.qTags.indexOf("$geopolygon")>-1},getFieldsInTable:function(b,c){var d,e,f=[];for(d=0;d<c.length;d++)e=c[d],a.contains(e.qSrcTables,b)&&f.push(e);return f},getFieldsInArchipelago:function(a,b){function c(a,g){var h,i,j,k,l;for(h=0;h<a.length;h++)if(j=a[h],!f[j])for(f[j]=!0,k=d.getFieldsInTable(j,b),i=0;i<k.length;i++)l=k[i],e[l.qName]||(e[l.qName]={field:l,distance:g},c(l.qSrcTables,++g))}var e={},f={};return c(a.qSrcTables,0),e},filterFields:function(a,b){function c(a,b){return Array.isArray(b)?b.some(function(b){return c(a,b)}):a.qTags.indexOf(b)>-1}var d,e,f=a?a.length:0,g=[];for(d=0;f>d;d++)e=a[d],c(e,b)&&g.push(e);return g},findGeoAssociatedFields:function(a,b){var c,e,f,g,h,i,j,k={};for(c=0;c<b.length;c++)for(f=b[c],i=d.getFieldsInArchipelago(f,a),g=Object.keys(i),e=0;e<g.length;e++)h=g[e],j=i[h].field,k[h]?k[h].geoFields.push(f):k[h]={field:j,geoFields:[f],distance:i[h]};return Object.keys(k).map(function(a){return k[a]})},createPolygonExpression:function(a){var b,c,d="";return b=void 0===a.tags?a.qTags:a.tags,c=void 0===a.name?a.qName:a.name,c="["+c+"]",b&&b.indexOf("$mercator")>-1&&(d="$mercator"),{qExpr:"GeoReduceGeometry({1}"+c+")",geoType:"polygon",projection:d}},addLayer:function(a,e,f){var g,h,i=a.geoField;return h="field"===a.type?f.createFieldDimension(a.value):f.createLibraryDimension(a.libraryId),d.isGeoPointField(i)?(g=f.addPointLayer(),f.addDimension(h),f.addDimension(f.createFieldDimension(i.qName))):(g=b?f.addPolygonLayer():c?f.addPolygon2Layer():f.addPolygon3Layer(),f.addDimension(h),b?f.addFieldAsGeoPolygonField(i):c?f.addFieldAsGeoPolygon2Field(i):f.addFieldAsGeoPolygon3Field(i)),g}};return d}),define("extensions.qliktech/map/map-handler",["objects.utils/data-properties/data-property-handler","core.utils/deferred","general.utils/array-util","extensions.qliktech/map/map-util","util"],function(a,b,c,d,e){function f(a){var b,c,d=a?a.length:0;for(b=0;d>b;b++){if(c=a[b],c.qHyperCubeDef&&c.qHyperCubeDef.qDimensions&&1===c.qHyperCubeDef.qDimensions.length&&c.qHyperCubeDef.qDimensions[0].qDef&&(c.qHyperCubeDef.qDimensions[0].qLibraryId||c.qHyperCubeDef.qDimensions[0].qDef.qFieldDefs[0]))return c;if(c.qHyperCubeDef&&c.qHyperCubeDef.qDimensions&&2===c.qHyperCubeDef.qDimensions.length&&c.qHyperCubeDef.qDimensions[0].qDef&&(c.qHyperCubeDef.qDimensions[0].qLibraryId||c.qHyperCubeDef.qDimensions[0].qDef.qFieldDefs[0])&&c.qHyperCubeDef.qDimensions[1].qDef&&c.qHyperCubeDef.qDimensions[1].qDef.qFieldDefs[0])return c;if(c.qListObjectDef&&(c.qListObjectDef.qLibraryId||c.qListObjectDef.qDef&&c.qListObjectDef.qDef.qFieldDefs&&c.qListObjectDef.qDef.qFieldDefs.length&&c.qListObjectDef.qDef.qFieldDefs[0]))return c}}function g(){var a=this.properties.color;a.auto&&"primary"===a.mode&&(a.auto=!1,a.mode="byMeasure")}var h,i,j;return j=[{qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1}],i={qDef:{qFieldDefs:[],qFieldLabels:[],qSortCriterias:[]}},h=a.extend({init:function(a,b){this._super(a,null,b,null),this.dimensionProperties=this.autoSortDimension(i)},setProperties:function(a){a&&a.layers&&a.layers[0]&&a.layers[0].qListObjectDef&&a.layers[0].qListObjectDef.qExpressions&&a.layers[0].qListObjectDef.qExpressions[0]&&void 0===a.layers[0].qListObjectDef.qExpressions[0].qLabel&&(a.layers[0].qListObjectDef.qExpressions[0].qLabel=a.layers[0].qListObjectDef.qExpressions[0].qExpr),a&&a.layers&&a.layers[0]&&a.layers[0].qHyperCubeDef&&a.layers[0].qHyperCubeDef.qMeasures&&a.layers[0].qHyperCubeDef.qMeasures[0]&&a.layers[0].qHyperCubeDef.qMeasures[0].qDef&&void 0===a.layers[0].qHyperCubeDef.qMeasures[0].qDef.qLabel&&(a.layers[0].qHyperCubeDef.qMeasures[0].qDef.qLabel=a.layers[0].qHyperCubeDef.qMeasures[0].qDef.qDef),this._super(a)},getDimensions:function(a){if(a||(a=f(this.properties.layers)),!a)return[];if(a.qHyperCubeDef)return a.qHyperCubeDef.qDimensions;if(a.qListObjectDef){var b=a.qListObjectDef.qDef;return b&&b.qFieldDefs&&b.qFieldDefs.length||a.qListObjectDef.qLibraryId?[a.qListObjectDef]:[]}return[]},getMeasures:function(a){if(a||(a=f(this.properties.layers)),!a)return[];if(a.qHyperCubeDef){if("polygon"!==a.type)return a.qHyperCubeDef.qMeasures;if(a.qHyperCubeDef.qMeasures&&a.qHyperCubeDef.qMeasures[0]&&(a.qHyperCubeDef.qMeasures[0].qLibraryId||a.qHyperCubeDef.qMeasures[0].qDef&&void 0!==a.qHyperCubeDef.qMeasures[0].qDef.qDef&&""!==a.qHyperCubeDef.qMeasures[0].qDef.qDef.trim()))return[a.qHyperCubeDef.qMeasures[0]]}return a.qListObjectDef&&a.qListObjectDef.qExpressions&&a.qListObjectDef.qExpressions[0]&&(a.qListObjectDef.qExpressions[0].qExpr||a.qListObjectDef.qExpressions[0].qLibraryId)?[a.qListObjectDef.qExpressions[0]]:[]},getLayerType:function(a){return a||(a=f(this.properties.layers)),a?a.type:void 0},getLayerTypeAndVersion:function(a){return a||(a=f(this.properties.layers)),a?[a.type,a.version]:[void 0,void 0]},addPointLayer:function(){var a=e.generateId(),b={type:"point",cId:a,show:!0,opacity:1,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInterColumnSortOrder:[],qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:3,qHeight:1e3}],qReductionMode:"N",qMode:"S"},useSize:!0,bubbleSizes:8,rangeBubbleSizes:[2,32],autoMinMax:!0,minMax:"minMax",customMin:0,customMax:10};return this.properties.layers.push(b),void 0===this.properties.background&&(this.properties.background={}),this.properties.background.show=!0,b},addPolygonLayer:function(){var a=e.generateId(),b={type:"polygon",cId:a,show:!0,opacity:1,qListObjectDef:{qDef:{qGrouping:"N",qFieldDefs:[],qFieldLabels:[],qSortCriterias:[],qNumberPresentations:[]},qFrequencyMode:"N",qShowAlternatives:!0,qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:2,qHeight:1e3}],qExpressions:[{qExpr:""},{qExpr:"",geoType:"polygon"}]}};return this.properties.layers.push(b),b},addPolygon2Layer:function(){var a=e.generateId(),b={type:"polygon",version:"2",cId:a,show:!0,qHyperCubeDef:{qDimensions:[],qMeasures:[{qDef:{qAggrFunc:"None"}}],qInterColumnSortOrder:[],qReductionMode:"N",qMode:"S"},measureDef:"",measureLibraryId:""};return this.properties.layers.push(b),b},addPolygon3Layer:function(){var a=e.generateId(),b={type:"polygon",version:"3",cId:a,show:!0,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:2,qHeight:1e3}],qInterColumnSortOrder:[],qReductionMode:"N",qMode:"S"},geodata:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInterColumnSortOrder:[],qReductionMode:"N",qMode:"S"}},measureDef:"",measureLibraryId:""};return this.properties.layers.push(b),b},autoSortDimension:function(a){return b.resolve(h.autoSortDimension(a))},createFieldDimension:function(a){var b=e.extend(!0,{},i);return b.qDef.qFieldDefs[0]=a,b.qDef.qFieldLabels[0]="",b},getLayers:function(){return this.properties.layers},getLayersWithoutMeasure:function(){return this.properties.layers.filter(function(a){switch(a.type){case"polygon":return"2"===a.version||"3"===a.version?!(a.qHyperCubeDef.qMeasures&&a.qHyperCubeDef.qMeasures[0]&&a.qHyperCubeDef.qMeasures[0].qDef&&a.qHyperCubeDef.qMeasures[0].qDef.qDef):!a.qListObjectDef.qExpressions[0].qExpr&&!a.qListObjectDef.qExpressions[0].qLibraryId;case"point":return!a.qHyperCubeDef.qMeasures.length}return!1})},addHypercubeDimension:function(a,d){var f=this.getDimensions(d);return a.qDef.cId||(a.qDef.cId=e.generateId()),f.length<2&&(f.push(a),c.indexAdded(d.qHyperCubeDef.qInterColumnSortOrder,f.length-1)),"polygon"===d.type&&"3"===d.version&&(f=d.geodata.qHyperCubeDef.qDimensions,a=e.extend(!0,{},a),a.qDef.cId=e.generateId(),f.length<2&&f.push(a)),b.resolve(a)},addListObjectDimension:function(a,b){return b.qListObjectDef=e.extend(!0,b.qListObjectDef,a),a},addDimension:function(a){var c,d=this.properties.layers.length;if(d>0){if(c=this.properties.layers[d-1],c.qListObjectDef)return this.addListObjectDimension(a,c);if(c.qHyperCubeDef)return this.addHypercubeDimension(a,c)}return b.resolve(a)},replaceDimension:function(a,c){var d,f,g,h,i=this.properties.layers.length;return i>0&&(d=this.properties.layers[i-1],d.qListObjectDef?(h=e.extend(!0,d.qListObjectDef,c),c.qLibraryId?(delete h.qDef.qFieldDefs,delete h.qDef.qFieldLabels):delete h.qLibraryId,this.properties.layers[i-1].qListObjectDef=h):d.qHyperCubeDef&&(f=this.getDimensions(d),g=f[a],c.qDef.cId=e.generateId(),f[a]=c,"function"==typeof this.dimensionDefinition.replace&&this.dimensionDefinition.replace.call(null,c,g,a,this.properties,this))),b.resolve(c)},removeDimension:function(){},getDimensionLayout:function(){var a=this.layout?this.layout.layers:void 0;return a&&1===a.length&&a[0].qListObject&&a[0].qListObject.qDimensionInfo?a[0].qListObject.qDimensionInfo:""},hasPolygonData:function(){var a,b=this.properties.layers[0].qListObjectDef.qExpressions;for(a=0;a<b.length;++a)if("polygon"===b[a].geoType.toLowerCase())return!0;return!1},addFieldAsGeoPolygonField:function(a){var b=d.createPolygonExpression(a),c=this.properties.layers[this.properties.layers.length-1].qListObjectDef.qExpressions;return c[1]=b,b},addFieldAsGeoPolygon2Field:function(a){var b=this.properties.layers[this.properties.layers.length-1],c=d.createPolygonExpression(a),e=c.qExpr,f=c.projection,g=this.createExpressionMeasure(e,e);g.qDef.projection=f,g.qDef.qAggrFunc="None",g.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},b.qHyperCubeDef.qMeasures[1]=g},addFieldAsGeoPolygon3Field:function(a){var b=this.properties.layers[this.properties.layers.length-1],c=d.createPolygonExpression(a),e=c.qExpr,f=c.projection,g=this.createExpressionMeasure(e,e);g.qDef.projection=f,g.qDef.qAggrFunc="None",g.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},b.geodata.qHyperCubeDef.qMeasures[0]=g},addMeasureToPolygonLayer:function(a,b){a.qListObjectDef.qExpressions[0]=b,g.call(this)},addMeasureToPolygon2Layer:function(a,b){b.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},b.qDef.qAggrFunc="None",a.qHyperCubeDef.qMeasures[0]=b,a.measureDef=b.qDef.qDef,a.measureLibraryId=b.qLibraryId,g.call(this)},addMeasureToPolygon3Layer:function(a,b){b.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},b.qDef.qAggrFunc="None",a.qHyperCubeDef.qMeasures[0]=b,a.measureDef=b.qDef.qDef,a.measureLibraryId=b.qLibraryId,g.call(this)},addMeasureToPointLayer:function(a,b){b.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},a.qHyperCubeDef.qMeasures.length?a.qHyperCubeDef.qMeasures[0]=b:(a.qHyperCubeDef.qMeasures.push(b),a.qHyperCubeDef.qInterColumnSortOrder.splice(0,0,2)),g.call(this)},addMeasure:function(a){var c={qExpr:a.qDef.qDef},d=this.properties.layers[0].qListObjectDef.qExpressions;return this.hasPolygonData()?d[0]&&"polygon"!==d[0].geoType.toLowerCase()?d[0]=c:d.splice(d.length-2,0,c):0===d.length?d.push(c):d[0]=c,b.resolve(a)}}),h.autoSortDimension=function(a){return a.qDef.qSortCriterias=e.extend(!0,[],j),a},h}),define("extensions.qliktech/map/map-autocomplete",["extensions.qliktech/map/map-util","translator"],function(a,b){function c(a){return a.sort(function(a,b){var c;return c=a.distance<b.distance?-1e3:a.distance>b.distance?1e3:0,a.value<b.value?c-=10:a.value>b.value&&(c+=10),c})}return{getFieldSuggestions:function(d,e){var f=b.get("Common.Fields"),g=e.map(function(b){var c=b.field.qName,e={label:c,value:c,field:b.field,geoFields:b.geoFields,associatedFields:[],distance:b.distance,category:f,type:"field"};if(a.isGeoField(b.field)){var g=a.getFieldsInArchipelago(b.field,d),h=d.filter(function(c){var d=c.qName;return g[d]&&(!a.isGeoField(c)||a.isGeoPointField(c)&&a.isGeoPointField(b.field))});e.associatedFields=h,e.hasAlternatives=h.length>1}else e.hasAlternatives=b.geoFields.length>1;return e});return c(g)},getDimensionSuggestions:function(d,e,f){function g(a,b){var c,d;if(a&&b)for(c=0;c<a.length;c++)if(d=a[c],d.field.qName===b)return d}var h=b.get("Common.Dimensions"),i=d.map(function(a){var b=a&&a.qData&&a.qData.info&&a.qData.info[0]?a.qData.info[0].qName:"",c=""===b?null:g(f,b);return c?{dimension:a,associatedField:c}:void 0}).filter(function(a){return!!a}),j=i.map(function(b){var c=b.dimension.qData.title,d=b.associatedField,f={label:c,value:c,field:d.field,libraryId:b.dimension.qInfo.qId,geoFields:d.geoFields,associatedFields:[],distance:b.distance,category:h,type:"dimension"};if(a.isGeoField(d.field)){var g=a.getFieldsInArchipelago(d.field,e),i=e.filter(function(b){var c=b.qName;return g[c]&&(!a.isGeoField(b)||a.isGeoPointField(b)&&a.isGeoPointField(d.field))});f.associatedFields=i,f.hasAlternatives=i.length>1}else f.hasAlternatives=d.geoFields.length>1;return f});return c(j)}}}),define("text!extensions.qliktech/map/add-popover/add-layer-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)">\r\n	<div class="object-add-popover" ng-show="!step2">\r\n		<object-add-typeahead>\r\n			<div class="object-add-popover-header">\r\n				<div class="qui-inputwithicon">\r\n					<input type="text" name="new-dimension" autocomplete="off" ng-model="search.term" tid="add-dimension-input" qva-focus="autoFocus"\r\n						   object-add-typeahead-input on-escape="onEscape($event)" maxlength="255"/>\r\n				</div>\r\n			</div>\r\n			<div class="object-add-popover-content" object-add-typeahead-menu>\r\n				<div class="object-add-popover-list-header" ng-if="dimensions.length" q-translation="Common.Dimensions"></div>\r\n				<ul class="object-add-popover-list qui-list">\r\n					<li class="object-add-popover-list-item qui-list-item steppable" ng-repeat="dimension in dimensions"  tid="dimension-item"\r\n							object-add-typeahead-item="dimension" on-select="selectItem(dimension)">\r\n						<span qve-highlight text="{{dimension.label}}" query="search.term" class="list-item-text"></span>\r\n						<i class="toggle-step2 icon-triangle-right" ng-if="dimension.hasAlternatives"></i>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Common.Fields"></div>\r\n				<ul class="object-add-popover-list qui-list">\r\n					<li class="object-add-popover-list-item qui-list-item steppable" ng-repeat="field in fields" tid="field-item"\r\n						object-add-typeahead-item="field" on-select="selectItem(field)">\r\n						<i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery icon" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\r\n						<i class="toggle-step2 icon-triangle-right" ng-if="field.hasAlternatives"></i>\r\n						<span qve-highlight text="{{field.label}}" query="search.term" ng-class="{ \'name-with-icon\': isDirectDiscoveryField( field ) }" class="list-item-text"></span>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-nohits" ng-if="!dimensions.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\r\n			</div>\r\n		</object-add-typeahead>\r\n	</div>\r\n	<div class="object-add-popover back" ng-show="step2">\r\n		<div class="object-add-popover-header">\r\n			<div qva-activate="goBack($event);">\r\n				<i class="icon-triangle-left"></i>\r\n				<span q-translation="Visualization.Requirements.Back"></span>\r\n			</div>\r\n		</div>\r\n		<div class="object-add-popover-content">\r\n			<div class="object-add-popover-list-header" q-translation="Visualization.Requirements.SelectGeoFieldForLayer"></div>\r\n			<ul class="object-add-popover-list qui-list">\r\n				<li class="object-add-popover-list-item qui-list-item" ng-repeat="suggestedItem in suggestedItems"\r\n					qva-activate="selectItem(suggestedItem)" tid="from-field-item">\r\n					<span class="list-item-text">{{getSuggestionLabel(suggestedItem)}}</span>\r\n				</li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n</immidiate-contextual>'}),define("extensions.qliktech/map/add-popover/add-layer-popover",["core.utils/deferred","general.utils/string-normalization","translator","general.utils/array-util","general.utils/support","extensions.qliktech/map/map-util","extensions.qliktech/map/map-autocomplete","general.models/field","general.models/library/dimension","text!./add-layer-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(a,b,c,d,e,f,g,h,i,j,k){function l(a,c){return""===c?a:a.filter(function(a){return"undefined"==typeof a.value?!1:b.string(a.value.toLowerCase()).indexOf(b.string(c.toLowerCase()))>-1})}var m=100,n={template:j,controller:["$scope",function(b){b.search={term:""},b.isDirectDiscoveryField=k.isDirectDiscoveryField,b.getDirectDiscoveryTypeTranslationKey=k.getTypeTranslationKey,b.autoFocus=e.treatAsDesktop(),b.suggestedItems=[],b.position||(b.position="right"),b.getSuggestionLabel=function(a){return f.isGeoPointField(a.geoFields[0])?c.get("properties.layers.autocomplete.pointSuggestion",[a.label]):c.get("properties.layers.autocomplete.regionSuggestion",[a.label])},b.selectItem=function(a){1===a.geoFields.length?"dimension"===a.type?b.addLibraryDimension({libraryId:a.libraryId,type:a.type,geoField:a.geoFields[0]}):b.addFieldDimension({value:a.value,type:a.type,geoField:a.geoFields[0]}):f.isGeoField(a.field)?(b.suggestedItems=a.associatedFields.map(function(b){return{label:b.qName,value:b.qName,type:"field",geoFields:[a.field]}}),b.step2=!0):(b.suggestedItems=a.geoFields.map(function(b){return{label:a.label,value:a.value,libraryId:a.libraryId,type:a.type,geoFields:[b]}}),b.step2=!0)},b.onEscape=function(a){""!==b.search.term?(a.stopPropagation(),b.search.term=""):b.closeAddPopover()},b.goBack=function(a){a.preventDefault(),b.suggestedItems=[],b.step2=!1};var j=null;b.$watch("search.term",function(c){function e(){var a=l(j.fields,c),e=l(j.dimensions,c);e.length>m?(e=d.limit(e,m),a=[]):a.length+e.length>m&&(a=d.limit(a,m-e.length)),b.fields=a,b.dimensions=e}j?e():a.all({fields:h.getListLayout(),dimensions:i.getListLayout()}).then(function(a){var b=f.filterFields(a.fields,["$geomultipolygon","$geopolygon","$geopoint"]),c=f.findGeoAssociatedFields(a.fields,b);j={fields:g.getFieldSuggestions(a.fields,c),dimensions:g.getDimensionSuggestions(a.dimensions,a.fields,c)},e()})})}],scope:{alignTo:"=",addFieldDimension:"=",addLibraryDimension:"=",closeAddPopover:"=",position:"="}};return n}),define("extensions.qliktech/map/map-layer-creation",["translator","qvangular","core.models/app","extensions.qliktech/map/map-util","general.models/field","util"],function(a,b,c,d,e,f){function g(a,b,c,d){c.addPolygonLayer(),c.addDimension(a),c.addFieldAsGeoPolygonField(b),d.save()}function h(a,b,c,d){c.addPolygon2Layer(),c.addDimension(a),c.addFieldAsGeoPolygon2Field(b),d.save()}function i(a,b,c,d){c.addPolygon3Layer(),c.addDimension(a),c.addFieldAsGeoPolygon3Field(b),d.save()}function j(a,b,c,d){c.addPointLayer(),c.addDimension(a),c.addDimension(b),d.save()}function k(a,c,d,e,f,j){q&&c.addItem({translation:d,tid:"add-as-polygon-layer",select:function(){g(e,a,f,j),b.$rootScope.$broadcast("pp-open-path","data."+f.properties.layers[0].cId)}}),r&&c.addItem({translation:d,tid:"add-as-polygon-layer",select:function(){h(e,a,f,j),b.$rootScope.$broadcast("pp-open-path","data."+f.properties.layers[0].cId)}}),s&&c.addItem({translation:d,tid:"add-as-polygon-layer",select:function(){i(e,a,f,j),b.$rootScope.$broadcast("pp-open-path","data."+f.properties.layers[0].cId)}})}function l(a,c,d,e,f,g){c.addItem({translation:d,tid:"add-as-point-layer",select:function(){var c=f.createFieldDimension(a.qName);j(e,c,f,g),b.$rootScope.$broadcast("pp-open-path","data."+f.properties.layers[0].cId)}})}function m(a,b,c,e,f){var g;d.isGeoPointField(a)?1===b.length?l(a,c.menu,"Object.Map.DropActions.AddAsPointLayer",b[0].dimension,e,f):b.length>1&&(g=c.menu.addItem({translation:"Object.Map.DropActions.AddAsPointLayer",tid:"add-as-point-layer"}),b.forEach(function(b){l(a,g,["properties.layers.autocomplete.pointSuggestion",b.name],b.dimension,e,f)})):1===b.length?k(a,c.menu,"Object.Map.DropActions.AddAsRegionLayer",b[0].dimension,e,f):b.length>1&&(g=c.menu.addItem({translation:"Object.Map.DropActions.AddAsRegionLayer",tid:"add-as-polygon-layer"}),b.forEach(function(b){k(a,g,["properties.layers.autocomplete.regionSuggestion",b.name],b.dimension,e,f)}))}function n(a,b,c,e,f){var g=[],h=[];b.forEach(function(a){d.isGeoPointField(a)?g.push(a):h.push(a)});var i;1===h.length?k(h[0],c.menu,"Object.Map.DropActions.AddAsRegionLayer",a,e,f):h.length>1&&(i=c.menu.addItem({translation:"Object.Map.DropActions.AddAsRegionLayer",tid:"add-as-polygon-layer"}),h.forEach(function(b){k(b,i,["properties.layers.autocomplete.regionSuggestion",b.qName],a,e,f)})),1===g.length?l(g[0],c.menu,"Object.Map.DropActions.AddAsPointLayer",a,e,f):g.length>1&&(i=c.menu.addItem({translation:"Object.Map.DropActions.AddAsPointLayer",tid:"add-as-point-layer"}),g.forEach(function(b){l(b,i,["properties.layers.autocomplete.pointSuggestion",b.qName],a,e,f)}))}function o(b,c,d,e){b.forEach(function(b){var g=c.properties.layers.indexOf(b),h=p>1?"Add as measure in layer "+(g+1):a.get("contextMenu.addFieldAsMeasure"),i=f.escapeField(d.item.name),j=d.menu.addItem({translation:h,tid:"add-as-measure"});["Sum","Count","Avg","Min","Max"].forEach(function(a){var d=a+"("+i+")";
j.addItem({label:a,tid:a.toLowerCase(),select:function(){var a;switch(b.type){case"polygon":"2"===b.version?(a=c.createExpressionMeasure(d,d),c.addMeasureToPolygon2Layer(b,a)):"3"===b.version?(a=c.createExpressionMeasure(d,d),c.addMeasureToPolygon3Layer(b,a)):c.addMeasureToPolygonLayer(b,{qExpr:d,qLabel:d});break;case"point":a=c.createExpressionMeasure(d,d),c.addMeasureToPointLayer(b,a);break;default:return}e.save()}})})})}var p=1,q=!1,r=!1,s=!0;return{getDropFieldOptions:function(a,b,f,k){var l=a.item,s=b.getLayers(),t=b.getLayersWithoutMeasure(),u={qTags:l.tags,qSrcTables:l.srcTables,qName:l.name};d.isGeoField(u)?t.length?(o(t,b,a,f),k()):s.length>=p?k():e.getListLayout().then(function(c){var e=d.getFieldsInArchipelago(u,c),g=c.filter(function(a){var b=a.qName;return e[b]&&(!d.isGeoField(a)||d.isGeoPointField(a)&&d.isGeoPointField(u))}),h=g.map(function(a){var c=b.createFieldDimension(a.qName);return{name:a.qName,dimension:c}});m(u,h,a,b,f),k()}):c.current.findMatchingFields(a.item.name,["$geomultipolygon","$geopolygon","$geopoint"]).then(function(c){var e,m,u=c.qFieldNames;t.length?(o(t,b,a,f),k()):s.length>=p||0===u.length?k():1===u.length?(e=b.createFieldDimension(l.name),d.isGeoPointField(u[0])?(m=b.createFieldDimension(u[0].qName),j(e,m,b,f)):q?g(e,u[0],b,f):r?h(e,u[0],b,f):i(e,u[0],b,f)):(e=b.createFieldDimension(l.name),n(e,u,a,b,f),k())})},getDropDimensionOptions:function(a,b,f,k){var l=a.item;d.isGeoField(l.info[0])?e.getListLayout().then(function(c){for(var e,g=0;g<c.length;g++)if(c[g].qName===l.info[0].qName){e=c[g];break}if(e){var h=d.getFieldsInArchipelago(e,c),i=c.filter(function(a){var b=a.qName;return h[b]&&(!d.isGeoField(a)||d.isGeoPointField(a)&&d.isGeoPointField(e))}),j=i.map(function(a){var c=b.createFieldDimension(a.qName);return{name:a.qName,dimension:c}});m(e,j,a,b,f)}k()}):c.current.findMatchingFields(l.info[0].qName,["$geomultipolygon","$geopolygon","$geopoint"]).then(function(c){var e,l,m=a.item,o=c.qFieldNames;return b.getLayers().length>0?void k():void(0===o.length?k():1===o.length?(e=b.createLibraryDimension(m.id),d.isGeoPointField(o[0])?(l=b.createFieldDimension(o[0].qName),j(e,l,b,f)):q?g(e,o[0],b,f):r?h(e,o[0],b,f):i(e,o[0],b,f)):(e=b.createLibraryDimension(m.id),n(e,o,a,b,f),k()))})},getDropMeasureOptions:function(a,c,d,e){var f=a.item,g=c.getLayersWithoutMeasure();g.length&&g.forEach(function(e){a.menu.addItem({translation:"properties.measures.add",tid:"add-measure",select:function(){var a;switch(e.type){case"polygon":"2"===e.version?(a=c.createLibraryMeasure(f.id),c.addMeasureToPolygon2Layer(e,a)):"3"===e.version?(a=c.createLibraryMeasure(f.id),c.addMeasureToPolygon3Layer(e,a)):c.addMeasureToPolygonLayer(e,{qLibraryId:f.id});break;case"point":a=c.createLibraryMeasure(f.id),c.addMeasureToPointLayer(e,a);break;default:return}d.save(),b.$rootScope.$broadcast("pp-open-path","data."+e.cId)}})}),e()},addFieldDimension:function(a,c){return c.model.getProperties().then(function(e){if(!(e.layers.length>=p)){var f=c.ext.getCreatePropertyHandler();f.setProperties(e),d.addLayer(a,e,f),b.$rootScope.$broadcast("pp-open-path","data."+e.layers[0].cId)}})},addLibraryDimension:function(a,c){return c.model.getProperties().then(function(e){if(!(e.layers.length>=p)){var f=c.ext.getCreatePropertyHandler();f.setProperties(e),d.addLayer(a,e,f),b.$rootScope.$broadcast("pp-open-path","data."+e.layers[0].cId)}})}}}),define("extensions.qliktech/map/interaction-controller",["jquery","util","objects.utils/event-utils","objects.utils/shapes/point","objects.views/charts/utils/matrix","extensions.qliktech/map/projection/unit-projection","touche"],function(a,b,c,d,e,f){function g(a){if(a){var b=a.getActiveType?a.getActiveType():void 0,c=a.types?a.types.tooltip:void 0;b&&b.clearSelection&&b.getActiveMode&&"item"!==b.getActiveMode()&&b.clearSelection(),c&&c.clearSelection&&c.clearSelection()}}function h(){var a=this._viewportProjection.getMapCenterInLonLat();Math.abs(a.x)>180&&(a.x=a.x%360,a.x>180?a.x-=360:a.x<-180&&(a.x+=360),this._viewportProjection.setMapCenterInLonLat(a))}function i(a){g(this.chart.selections),a=Math.min(Math.max(a,this._minZoomLevel),this._maxZoomLevel),this._viewportProjection.setZoomLevel(a)}function j(a,b,c,d){var f,g,h,i,j,k=new e,l=c/d;h=b.x-a.x,i=b.y-a.y,f=this._localMatrix.clone().invert().transformPoint(a),k.translate(f.x,f.y),k.scale(l,l),k.translate(-f.x,-f.y),this._localMatrix=this._localMatrix.multiply(k),j=this._localMatrix.elements,this._localMatrix.translate(h/j[0][0],i/j[1][1]),m.call(this),k.identity(),g=this._globalMatrix.clone().invert().transformPoint(a),k.translate(g.x,g.y),k.scale(l,l),k.translate(-g.x,-g.y),this._globalMatrix=this._globalMatrix.multiply(k),j=this._globalMatrix.elements,this._globalMatrix.translate(h/j[0][0],i/j[1][1])}function k(a){var b=this.dataArea.layersContainer;b.style["-webkit-transform"]=a,b.style["-moz-transform"]=a,b.style["-o-transform"]=a,b.style["-ms-transform"]=a,b.style.transform=a}function l(){if(!this._setTransformOrigin){var a=this.dataArea.layersContainer,b="top left";a.style["-webkit-transform-origin"]=b,a.style["-moz-transform-origin"]=b,a.style["-o-transform-origin"]=b,a.style["-ms-transform-origin"]=b,a.style["transform-origin"]=b,this._setTransformOrigin=!0}}function m(){var a=this._localMatrix.elements,b="matrix("+a[0][0]+",0,0,"+a[1][1]+","+a[0][2]+","+a[1][2]+")";k.call(this,b)}function n(){this._interactionStarted||(g(this.chart.selections),this._localMatrix.identity(),this._globalMatrix=this._viewportProjection.getTransformMatrix().clone(),this._interactionStarted=!0)}function o(){if(!(this._zooming||this._panning||this._pinching)){var a=!1;k.call(this,"matrix(1,0,0,1,0,0)"),this._viewportProjection.enabledChangeEvent=!1,this._viewportProjection.setTransformMatrix(this._globalMatrix),this.dataArea.hasVisibleBaseLayer()&&(h.call(this),a=this.dataArea.baseMapLayer.updateViewportToBaseMap(!0)),a||this._viewportProjection.fire("changedByInteraction"),this._viewportProjection.enabledChangeEvent=!0,this._interactionStarted=!1}}function p(a,b){q.apply(this,[a,b])}function q(a,c){if(!this._disableZoomOnMouseWheel){this._disableZoomOnMouseWheel=!0;var d=this;if(setTimeout(function(){d._disableZoomOnMouseWheel=!1},d._mouseWheelTimeoutPeriod),!this._zoomPanByWebkitTransform&&!b.isTouchDevice())return void w.apply(this,[a,c]);var f,g,h=new e;this._zooming=!0,n.call(this),f=this._localMatrix.clone().invert().transformPoint(a),h.translate(f.x,f.y),h.scale(c,c),h.translate(-f.x,-f.y),this._localMatrix=this._localMatrix.multiply(h),m.call(this),h.identity(),g=this._globalMatrix.clone().invert().transformPoint(a),h.translate(g.x,g.y),h.scale(c,c),h.translate(-g.x,-g.y),this._globalMatrix=this._globalMatrix.multiply(h)}}function r(){this._zooming=!1,(this._zoomPanByWebkitTransform||b.isTouchDevice())&&o.call(this)}function s(a,b){t.apply(this,[a,b])}function t(a,c){if(!this._zoomPanByWebkitTransform&&!b.isTouchDevice())return void v.apply(this,[a,c]);this._panning=!0,n.call(this);var d=this._localMatrix.elements;this._localMatrix.translate(a/d[0][0],c/d[1][1]),m.call(this),d=this._globalMatrix.elements,this._globalMatrix.translate(a/d[0][0],c/d[1][1])}function u(){this._panning=!1,(this._zoomPanByWebkitTransform||b.isTouchDevice())&&o.call(this)}function v(a,b){this._viewportProjection.enabledChangeEvent=!1,this.moveViewport(a,b),this._viewportProjection.fire("changedByInteraction"),this._viewportProjection.enabledChangeEvent=!0}function w(a,b){this._viewportProjection.enabledChangeEvent=!1,this.zoomOnPixel(a,b),this._viewportProjection.fire("changedByInteraction"),this._viewportProjection.enabledChangeEvent=!0}function x(a,b){this.chart=a,this.dataArea=this.chart.components.dataArea,this._minZoomLevel=0,this._maxZoomLevel=20,this._interactionStarted=!1,this._zoomPanByWebkitTransform=!1,this._fractionalZoomMode=!0,this._defaultScale=Math.pow(2,.5),this._invDefaultScale=1/this._defaultScale,this._mouseWheelTimeoutPeriod=50,this._viewportProjection=b,this._viewportProjection.setMinZoomLevel(this._minZoomLevel),this._viewportProjection.setMaxZoomLevel(this._maxZoomLevel),this._localMatrix=new e}var y=200,z=1e-6;return x.prototype={setOffset:function(a){this._offset=a},navigate:function(a){var b,c=this;switch(a){case"resetZoom":c.zoomOnMapBounds();break;case"zoomIn":if(b=c.getZoomLevel(),void 0===b||null===b||b===c._maxZoomLevel)return;c.zoom(c._defaultScale);break;case"zoomOut":if(b=c.getZoomLevel(),void 0===b||null===b||b===c._minZoomLevel)return;c.zoom(c._invDefaultScale);break;case"navUp":v.apply(c,[0,y]);break;case"navDown":v.apply(c,[0,-y]);break;case"navLeft":v.apply(c,[y,0]);break;case"navRight":v.apply(c,[-y,0])}},onPan:function(a,b,c){var d=this;switch(a){case"start":s.apply(d,[c.swipe.deltaX,c.swipe.deltaY]);break;case"update":t.apply(d,[c.swipe.curDeltaX,c.swipe.curDeltaY]);break;case"end":u.apply(d)}},on:function(b,e){var f,g,h,i,k=this,m=!1,v=!1;l.call(this),a(e).on("mousewheel"+b+" DOMMouseScroll"+b,c.throttle(function(a){var b,e,f,g,h=c.getMouseWheelData(a.originalEvent);b=h.x-k._offset.left,e=h.y-k._offset.top,f=new d(b,e),g=h.delta>0?k._defaultScale:k._invDefaultScale,v?q.apply(k,[f,g]):p.apply(k,[f,g]),v=!0,null!==i&&clearTimeout(i),i=setTimeout(function(){i=null,r.call(k),v=!1},250)},20)),Touche(e).wheelswipe({id:b,start:function(a){k._panX=a.pageX,k._panY=a.pageY,m=!1},update:function(a){var b,c,d,e,f;b=a.pageX,c=a.pageY,d=b-k._panX,e=c-k._panY,f=m,!m&&(Math.abs(d)>3||Math.abs(e)>3)&&(m=!0),m&&(k._panX=b,k._panY=c,f?t.apply(k,[d,e]):s.apply(k,[d,e]))},end:function(){m?u.call(k):k.zoomOnMapBounds(),m=!1}}),Touche(e).pinch({id:b,options:{useMomentum:!0,inertia:.7},start:function(a,b){g={},g.x=(this.pinch.start.point1.x+this.pinch.start.point2.x)/2-k._offset.left,g.y=(this.pinch.start.point1.y+this.pinch.start.point2.y)/2-k._offset.top,h={x:b.centerPoint.x-k._offset.left,y:b.centerPoint.y-k._offset.top},k._pinching=!0,n.call(k),j.apply(k,[g,h,b.scale,b.scale]),f=b.scale,g=h,Touche.preventGestures(this.gestureHandler)},update:function(a,b){h={x:b.centerPoint.x-k._offset.left,y:b.centerPoint.y-k._offset.top},k._pinching=!0,n.call(k),j.apply(k,[g,h,b.scale,f]),f=b.scale,g=h,Touche.preventGestures(this.gestureHandler)},end:function(){k._pinching=!1,o.call(k)}}),Touche(e).swipe({id:b,options:{useMomentum:!0,touches:2,inertia:.7},start:function(a,b){k.onPan("start",a,b),Touche.preventGestures(this.gestureHandler)},update:function(a,b){k.onPan("update",a,b)},end:function(a,b){k.onPan("end",a,b)}}),Touche(e).tap({id:b,options:{touches:3},end:function(){k.zoomOnMapBounds(),Touche.preventGestures(this.gestureHandler)}})},setMaxZoomLevel:function(a){this._maxZoomLevel=a,this._viewportProjection&&this._viewportProjection.setMaxZoomLevel(a)},setMinZoomLevel:function(a){this._minZoomLevel=a,this._viewportProjection&&this._viewportProjection.setMinZoomLevel(a)},setMapCenter:function(a){g(this.chart.selections),this._viewportProjection&&this._viewportProjection.setMapCenter(a)},getMapCenter:function(){return this._viewportProjection?this._viewportProjection.getMapCenter():null},setZoomLevel:function(a){!isNaN(a)&&isFinite(a)&&(Math.abs(a-Math.round(a))<z&&(a=Math.round(a)),i.call(this,a))},getZoomLevel:function(){return this._viewportProjection?this._viewportProjection.getZoomLevel():0},moveViewport:function(a,b){var c,e,g;this.dataArea.baseMapLayer&&this.dataArea.baseMapLayer.isReady()&&this.dataArea.baseMapLayer.show?(this.dataArea.baseMapLayer.panBy(-a,-b),c=this.dataArea.baseMapLayer.getMapCenter(),e=this._viewportProjection.getProjection()instanceof f?this._viewportProjection.getMercatorProjection().project(c):c,this.setMapCenter(e)):(g=this._viewportProjection.getSize(),this.setMapCenter(this._viewportProjection.invProject(new d(g.x/2-a,g.y/2-b))))},zoom:function(a){if(a>0){var b=Math.log(a)/Math.LN2;Math.abs(b-Math.round(b))<z&&(b=Math.round(b)),this.setZoomLevel(this.getZoomLevel()+b)}},zoomOnPixel:function(a,b){var c,d,e=this.getZoomLevel();e<=this._minZoomLevel&&1>=b||e>=this._maxZoomLevel&&b>=1||(g(this.chart.selections),c=Math.pow(2,this._minZoomLevel-e),d=Math.pow(2,this._maxZoomLevel-e),b=Math.min(Math.max(b,c),d),this._viewportProjection.zoomOnPixel(a,b),this.dataArea.hasVisibleBaseLayer()&&h.call(this))},zoomOnMapRectangle:function(a){g(this.chart.selections),this._viewportProjection.zoomOnMapRectangle(a)},zoomOnViewportRectangle:function(a){var b=this._viewportProjection.fromViewportRectToMapRect(a);this.zoomOnMapRectangle(b)},setMapBounds:function(a){!a||this._mapBounds&&this._mapBounds.equal(a)||(this._mapBounds=a.clone())},zoomOnMapBounds:function(){var a=this._mapBounds&&!this._mapBounds.hasNaN()?this._mapBounds:this._worldBounds;a&&(this.zoomOnMapRectangle(a),this.dataArea.hasVisibleBaseLayer()&&(this._viewportProjection.inResetZoomMode=!0),this._viewportProjection.fire("resetZoomFinished"))},setFractionalZoomMode:function(a){this._fractionalZoomMode=a,this._defaultScale=this._fractionalZoomMode?Math.pow(2,.5):2,this._invDefaultScale=1/this._defaultScale,this._mouseWheelTimeoutPeriod=this._fractionalZoomMode?50:100,this._viewportProjection&&this._viewportProjection.setFractionalZoomMode(a)},getFractionalZoomMode:function(){return this._fractionalZoomMode},setZoomPanByWebkitTransform:function(a){this._zoomPanByWebkitTransform=a},getZoomPanByWebkitTransform:function(){return this._zoomPanByWebkitTransform}},x}),define("extensions.qliktech/map/properties/layers",["jquery","client.property-panel/components/components","translator","touche","general.services/show-service/show-service","general.utils/property-resolver","objects.utils/data-properties/listobject-handler","objects.utils/data-properties/hypercube-handler","general.utils/support","extensions.qliktech/map/map-util","extensions.qliktech/map/add-popover/add-layer-popover","general.components/context-menu/context-menu-service","general.sortable/sortable-item-lists","util","text!client.property-panel/components/common/data.ng.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=1,q={template:o,controller:["$scope",function(o){function q(){return"function"==typeof o.definition.max?o.definition.max.call(null,o.data,this):o.definition.max||1e6}function r(a){if(!(o.data.layers&&o.data.layers.length>=p)){var b=j.addLayer(a,o.data,o.args.handler);o.$emit("saveProperties"),v.put(w+b.cId,!0),u()}}function s(){var a=f.getValue(o.data,o.definition.ref,[]),d=o.definition.items.pointLayer,e=o.definition.items.polygonLayer,i=o.definition.items.polygon2Layer,j=o.definition.items.polygon3Layer;if(o.sortableItemLists.reset(),a.forEach(function(a,f){var k,l,m=a.type,p=a.version,q=n.extend({},o.args);switch(m){case"polygon":"2"===p?(l=new h({},{}),k=i):"3"===p?(l=new h({},{}),k=j):(l=new g({}),k=e);break;case"point":l=new h({},{}),k=d}l.setProperties(a),o.args.handler.layout&&o.args.handler.layout.layers[f]&&l.setLayout(o.args.handler.layout.layers[f]),q.handler=l;var r=x.createItem({title:function(){return c.get("polygon"===m?"properties.layers.regionLayer":"properties.layers.pointLayer")},component:b.getComponent("items"),definition:k,data:a,args:q,templateSrc:"pp-data-item.ng.html",id:a.cId,index:f,expanded:v.get(w+a.cId)||!1,sortable:k.allowMove!==!1});x.addItem(r)}),x.isEmpty()){var k=x.createItem({id:"empty-item",templateSrc:"pp-empty-data-item.ng.html",index:-1});x.addItem(k)}}function t(){x.items.forEach(function(a){a.expanded=!1,v.put(w+a.id,!1)})}function u(b){y&&(y.destroy(),y=null),b&&a(b.target).hasClass("pp-toplist-add-button")&&d.preventGestures(),o.adding=!1}var v=o.args.cache,w="layers_";o.expandClicked=function(b,c){c.disabled||a(b.target).hasClass("pp-move-item")||(c.expanded=!c.expanded,v.put(w+c.data.cId,c.expanded))},o.removeItem=function(a){o.data.layers.splice(a.index,1),o.data.color.auto=!0,o.data.color.mode="primary",o.$emit("saveProperties")},o.getAddLabel=function(){return c.get(o.definition.addTranslation)},o.addClicked=function(b){o.data.layers&&o.data.layers.length<=p&&!o.adding&&(y=e.show(k,{alignTo:a(b.target),position:"bottom",closeAddPopover:u,addFieldDimension:r,addLibraryDimension:r}),o.adding=!0)},o.addDisabled=function(){return o.data.layers&&o.data.layers.length>=q()},o.$on("pp-open-path",function(a,b){var c=b.split("."),d=c[0],e=c[1];"data"===d&&e&&(v.put(w+e,!0),s())}),o.isInvalid=function(a){var b=o.args.layout,c=a.data?a.data.type:void 0,d=b.layers[a.index];switch(c){case"polygon":return"2"===a.data.version||"3"===a.data.version?d&&d.qHyperCube&&d.qHyperCube.qDimensionInfo&&d.qHyperCube.qDimensionInfo[0]&&!!d.qHyperCube.qDimensionInfo[0].qError:d&&d.qListObject&&d.qListObject.qDimensionInfo&&!!d.qListObject.qDimensionInfo.qError;case"point":return d&&d.qHyperCube&&d.qHyperCube.qDimensionInfo&&d.qHyperCube.qDimensionInfo[0]&&!!d.qHyperCube.qDimensionInfo[0].qError}},o.sortableItemLists=m.create({options:{direction:"vertical",listKey:"list",listSelector:".pp-expandable-list",itemKey:"item",itemSelector:".qv-pp-sortable",itemDragSelector:".qv-pp-sortable-handle",gesture:{name:"swipe",options:{radiusThreshold:i.treatAsDesktop()?4:0,preventDefault:!1}}},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.addClass("qv-pp-sortable"),a.templateSrc="pp-data-item.ng.html"},onBegin:function(){this._super.apply(this,arguments),t()},onMove:function(){this._super.apply(this,arguments);var a=x.get().map(function(a){return a.data});f.setValue(o.data,o.definition.ref,a),o.$emit("saveProperties")}});var x=o.sortableItemLists.createList(1,{title:c.get("properties.layers"),tid:"layers"}),y=null,z=null;o.openContextMenu=function(a,b){var c=l.menu();c.addItem({translation:"Common.Delete",tid:"delete",select:function(){o.removeItem(b)}}),z=l.show(c,{position:{x:a.pageX,y:a.pageY},docking:"Top"})},o.$watchCollection("data."+o.definition.ref,function(){s()}),o.$on("layoutchanged",function(a,b){var c,d=x.items;for(c=0;c<d.length;c++)b.layers[c]&&d[c]&&d[c].args.handler.setLayout(b.layers[c])}),o.$on("$destroy",function(){u(),z&&(z.destroy(),z=null)})}]};return b.addComponent("layers",q),q}),define("extensions.qliktech/map/map",["jquery","objects.views/charts/chart","objects.views/charts/components/chart-component","client.utils/state","objects.backend-api/map-api","objects.views/charts/representation/combo-color-map","objects.views/charts/utils/binding","text!./map.ng.html","extensions.qliktech/map/map-properties","extensions.qliktech/map/projection/viewport-projection","extensions.qliktech/map/projection/unit-projection","extensions.qliktech/map/map-area","objects.utils/shapes/rect","objects.utils/event-utils","general.utils/property-mapper","extensions.qliktech/map/map-handler","objects.views/charts/components/axis/axis","objects.views/charts/components/legend","extensions.qliktech/map/add-popover/add-layer-popover","extensions.qliktech/map/map-layer-creation","extensions.qliktech/map/interaction-controller","core.utils/deferred","extensions.qliktech/scatterplot/scatterplot-navigation","touche","extensions.qliktech/map/properties/layers","objects.views/charts/disclaimers/chart-disclaimer-directive"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){function w(a){var b=a&&a.qDimensionInfo&&!a.qDimensionInfo.qError;return b}function x(a){var b=a&&a.qDimensionInfo.length&&!a.qDimensionInfo.some(function(a){return!!a.qError});return a.qMeasureInfo&&a.qMeasureInfo.length&&(b=b&&!a.qMeasureInfo.some(function(a){return!!a.qError})),b}function y(a){if(!(a&&(a.layers&&0!==a.layers.length||a.background&&a.background.show)))return!1;var b,c,d=Math.min(a.layers.length,M);for(b=0;d>b;b++)if(c=a.layers[b],c.qListObject){if(w(c.qListObject))return!0}else{if(!c.qHyperCube)return!1;if(x(c.qHyperCube))return!0}return a.background&&a.background.show}function z(a){var b=a&&a.qDimensionInfo.every(function(a){return a.qLocked!==!0});return b}function A(a){var b=a&&a.qDimensionInfo.qLocked!==!0;return b}function B(a){this._projection&&a&&this._projection.getProjectionType()===a.getProjectionType()||(this._projection=a,this._projection||(this._projection=this._unitProjection),this._viewportProjection.setProjection(this._projection))}function C(a){this._viewportProjection.setSize(a)}function D(){this.updateNavigation(),this._resizing||(this._mapRect=this._viewportProjection.getViewRectangleInMapCoordinate())}function E(){if(this.selections){var a=this.components.dataArea.getSelectableShapes(),b=this.components.dataArea.layers,c=this.selections.getActiveType?this.selections.getActiveType():!1,d=!!c;this.selections.cache&&(this.selections.cache.clear(),a.forEach(function(a){this.selections.cache.add(a)},this),d&&("item"===c.getActiveMode()?a.forEach(function(a){var c=b[a.layerIndex].getSelectedRows();a.selected=c&&c.indexOf(a.rowIndex)>=0}):(c.activeComponent instanceof q&&!c.activeComponent.isDiscrete()||c.activeComponent instanceof r&&"range"===c.getActiveMode())&&c.updateShapesState()),this.providers&&this.providers.tooltip&&this.providers.tooltip.setSelectableShapes(a)),Object.keys(this.components).forEach(function(b){["legend","xAxis","dimensionAxis"].contains(b)&&this.components[b].setSelectableShapes(a)},this)}}function F(a){var b,c,d,e=a?a.length:0,f=[];for(b=0;e>b;b++)c=a[b],d=c.layerIndex,void 0===f[d]&&(f[d]=[]),f[d][f[d].length]=c;return f}function G(a,b,c){var d,e,f,g,h;for(d=c;d>-1;d--)for(e=b[d],f=e?e.length:0,g=0;f>g;g++)h=e[g],h.selected=!1}function H(a,b){a.setDock(!b||b.legend&&"auto"===b.legend.dock?a.outerRect.height/a.outerRect.width<1?"right":"bottom":b.legend.dock)}function I(){this._zoomInFineMode=this.getZoomLevel(),this._centerInFineMode=this.getMapCenter().clone(),this._sizeInFineMode=this._viewportProjection.getSize().clone(),this.updateNavigation()}function J(){var a,b,c;return a=this.getZoomLevel(),b=this.getMapCenter(),c=this._viewportProjection.getSize(),void 0===this._zoomInFineMode||void 0===this._centerInFineMode||void 0===this._sizeInFineMode?!1:c.closeTo(this._sizeInFineMode,.001)?Math.abs(a-this._zoomInFineMode)>.001?!1:b.closeTo(this._centerInFineMode,1e-9)?!0:!1:!1}var K,L=".map",M=1;return K=b.extend("Map",{namespace:L,init:function(b,d,e,h){var i=this;e=a.extend(!0,e||{},{providers:{colorMap:{clazz:f,multiDimScheme:"first",colorBy:"primary",autoMode:"primary"}},components:{dataArea:{show:!0,dock:"center",clazz:l,showFlag:c.prototype.ShowFlags.SPARK},legend:{show:!1,dock:"right",relevantSize:126,label:"legend",showFlag:c.prototype.ShowFlags.MEDIUM}}}),this._super(b,d,e,h),this.backendApi=h,this._autoZoomOnDataChange=!0,this._worldBounds=new m(-180,-180,360,360),this._unitProjection=new k,this.setViewportProjection(new j),B.call(this,this._unitProjection),this.interactionController=new u(this,this._viewportProjection),this.components.dataArea.setMaxNumLayers(M),this.components.dataArea.setMap(this),this.components.dataArea.setBackendApi(this.backendApi),this.components.dataArea.setLegend(this.components.legend),this.components.dataArea.setChartContext(this._chartContext),this.components.dataArea.setInteractionController(this.interactionController),this._changeWatchers=this._changeWatchers||[],this._changeWatchers.push(g.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(g.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this.onNavigationPressed=b.$on("navigationPressed",function(a,b){a.preventDefault(),i.interactionController.navigate(b)}),this.$scope.navigationDisabled=!0,this._scaleMapOnResize=!1},setFormatter:function(a){var b;if(this.chartFormatter=a,this.chartFormatter){for(b in this.components)this.components[b].chartFormatter=this.chartFormatter,this.components[b].measureFormatters=this.chartFormatter.getFormatters(),this.components[b].combinedMeasuresFormatter=this.chartFormatter.getCombinedMeasuresFormatter();this.providers.colorMap&&(this.providers.colorMap.setMeasureFormatters(this.chartFormatter.getFormatters()),this.providers.colorMap.setGenericFormatter(this.chartFormatter.createFormatter())),this.selections&&this.selections.types.tooltip&&(this.selections.types.tooltip.measureFormatters=this.chartFormatter.getFormatters())}},setViewportProjection:function(a){this._viewportProjection&&(this._viewportProjection.stopListen("resetZoomFinished",I,this),this._viewportProjection.stopListen("changed",D,this),this._viewportProjection.stopListen("changedByInteraction",D,this)),this._viewportProjection=a,this.components.dataArea.setViewportProjection(this._viewportProjection),this._viewportProjection&&(this._viewportProjection.listen("resetZoomFinished",I,this),this._viewportProjection.listen("changed",D,this),this._viewportProjection.listen("changedByInteraction",D,this))},getViewportProjection:function(){return this._viewportProjection},paint:function(a,b){this._super(a,b)},suppressOnPaint:function(a){var b;return this.$scope.object.forcePaint?(this.$scope.object.forcePaint=!1,b=!1):b=a.qSelectionInfo&&a.qSelectionInfo.qInSelections,b&&this.prePaint(a),b},prePaint:function(a){var b=this,c=!1;a.layers.forEach(function(a){var d=a.qHyperCube?a.qHyperCube:a.qListObject,e=d&&d.qDataPages&&d.qDataPages[0]&&d.qDataPages[0].qMatrix?d.qDataPages[0].qMatrix.length:0;b.$scope.dataAttributes.limitedData=e>0&&d.qSize.qcy>e,b.$scope.dataAttributes.limitedData&&(c=!0)}),this.$scope.options.showDisclaimerStar=c,this.$element.toggleClass("qv-viz-with-disclaimer",c)},_updateData:function(a,b){this.layersReady=!1,this._data=a,this._readStoredData=a&&a.snapshotData&&a.snapshotData.content&&!this.isEffect&&this.backendApi.isSnapshot,this.setAutoZoomOnDataChange(this._data.autoZoomOnSelection),this.updateSelectableState(a),this.components.dataArea.setData(a),this.selections&&this.selections.types&&this.selections.types.tooltip&&(this.selections.types.tooltip.enabled=this.components.dataArea.hasVisibleLayer(),this.selections.types.tooltip.parentScope=this.$scope,this.selections.types.tooltip.colorMap=this.providers.colorMap),this.updateLegend(a,b)},_postResize:function(){this._super(),H.apply(this,[this.components.legend,this._data])},updateLegend:function(a){if(this.components.legend){H.apply(this,[this.components.legend,a]),this.components.legend.setShowTitle(a&&a.legend&&a.legend.showTitle);var b=a&&a.legend&&a.legend.show;b=b&&this.components.dataArea.hasVisibleLayer(),b?this.components.legend.showComponent():this.components.legend.hideComponent()}},updateSelectableState:function(a){this.selections&&(this.isDataSelectable(a||this._data)?(this.selections.setLocked(!1),"byMeasure"===this._data.color.mode&&this._data.layers[0].qListObject?this.selections.types.legend.removeComponent("legend",this.components.legend):this.selections.types.legend.setComponent("legend",this.components.legend)):this.selections.setLocked(!0))},isValid:function(a){var b,c=y(a);for(b in this.components)this.components[b].setHasValidData(c);return c},isDataSelectable:function(a){if(!this.isValid(a)||!this.allowInteraction(d))return!1;var b,c=Math.min(a.layers.length,M);for(b=0;c>b;b++){if(a.layers[b].qListObject&&A(a.layers[b].qListObject))return!0;if(a.layers[b].qHyperCube&&z(a.layers[b].qHyperCube))return!0}return!1},setAutoZoomOnDataChange:function(a){this._autoZoomOnDataChange=!!a},getAutoZoomOnDataChange:function(){return this._autoZoomOnDataChange},setScaleMapOnResize:function(a){this._scaleMapOnResize=a},getScaleMapOnResize:function(){return this._scaleMapOnResize},setMapCenter:function(a){this.interactionController.setMapCenter(a)},getMapCenter:function(){return this.interactionController.getMapCenter()},setZoomLevel:function(a){this.interactionController.setZoomLevel(a)},getZoomLevel:function(){return this.interactionController.getZoomLevel()},setMapBounds:function(a){this.interactionController.setMapBounds(a)},zoomOnMapBounds:function(){this.interactionController.zoomOnMapBounds()},setFractionalZoomMode:function(a){this.interactionController.setFractionalZoomMode(a)},getFractionalZoomMode:function(){return this.interactionController.getFractionalZoomMode()},setZoomPanByWebkitTransform:function(a){this.interactionController.setZoomPanByWebkitTransform(a)},getZoomPanByWebkitTransform:function(){return this.interactionController.getZoomPanByWebkitTransform()},on:function(){return this._on?void this._super():(this.interactionController.on(L,this.components.dataArea.container),Touche(this.container).longtap({id:L}),this._super(),this.$scope.navigationDisabled=!1,void(this._on=!0))},off:function(){this.$scope.navigationDisabled=!0,this._on&&(Touche(this.components.dataArea.container).off("*",L),Touche(this.container).off("*",L),a(this.components.dataArea.container).off(L),a(this.container).off(L),this._super(),this._on=!1)},initSelections:function(){this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.legend.setComponent("legend",this.components.legend),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.selections.ToggleShapes.bind(this.ToggleShapes.bind(this)),this.selections.Activated.bind(this.Activated.bind(this)),this.selections.Deactivated.bind(this.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Pan.bind(this.interactionController.onPan.bind(this.interactionController)),this.selections.Select.bind(this.Select.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.Cancel.bind(this)),this.selections.Clear.bind(this.Clear.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this))},selectWhileLocked:function(){var a,b=[];this._data.layers.forEach(function(c){a=c.qHyperCube?c.qHyperCube:c.qListObject,b.push(a.qDimensionInfo instanceof Array?a.qDimensionInfo[0]:a.qDimensionInfo)}),n.showLockedFeedback(b)},ToggleShapes:function(a,b){if(a&&0!==a.length){var c,d,e,f,g,h,i,j=this;for(this._haveToggledShapes=!1,this._renderOnToggleShapes=!0,setTimeout(function(){j._renderOnToggleShapes&&j.onSelection.scheduleInvalidation.call(j,!0),j._renderOnToggleShapes=!1},50),e=this._data&&this._data.layers?Math.min(this._data.layers.length,M):0,d=F(a),h=4===(4&b)?!0:!1,this._layerIndexOfClick=-1,f=e-1;f>-1;f--)if(c=this.components.dataArea.layers[f],g=d[f],i=g?g.length:0,c.isVisible()&&0!==i&&(c.toggleShapes(g),h))return this._layerIndexOfClick=f,void G(a,d,f-1)}},Activated:function(){this.onSelection.Activated.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!0)},Deactivated:function(){this._renderOnToggleShapes=!1,this.onSelection.Deactivated.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Cancel:function(){this.onSelection.Cancel.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Clear:function(){this.onSelection.Clear.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Select:function(a,b,c){var d,e=F(a),f=Array.isArray(c)?c:[c||0],g=this.components.dataArea.layers,h=g?g.length:0;if(-1===this._layerIndexOfClick){for(d=0;h>d;d++)"hyperCube"===g[d].getDataType()&&g[d].selectOnLayer(e[d],f);for(d=0;h>d;d++)"listObject"===g[d].getDataType()&&g[d].selectOnLayer(e[d],f)}else d=this._layerIndexOfClick,g[d].selectOnLayer(e[d],f)},_initiateBindings:function(){this._changeWatchers||(this._changeWatchers=[]);var a;for(a in this.components)this._changeWatchers.push(g.bindProperty(this.components[a],"layoutMode",this,"layoutMode"));this.components.dataArea&&this._changeWatchers.push(g.bindSetter(E.bind(this),this.components.dataArea,"selectableShapes"))},resize:function(){var a;this._resizing=!0,this._zoomOnMapBounds=!1,this._viewportProjection&&(a=J.call(this),a&&(this._zoomOnMapBounds=!1)),this._super(),this._resizing=!1},layout:function(){this._super();var b=this.components.dataArea?this.components.dataArea.rect:this.rect;C.call(this,{x:b.width,y:b.height}),this.components.dataArea.setRect(b.x,b.y,b.width,b.height),this.components.dataArea.updateSize(),this.components.dataArea&&this.interactionController.setOffset(a(this.components.dataArea.container).offset())
},setPreselectionMode:function(a){this._preselectionMode=a,this.components.dataArea.setPreselectionMode(a)},_paint:function(){if(this.layersReady){var a;if(this._super()===!1)return!1;if(this.layout(),this.backendApi.isSnapshot&&this._readStoredData){var b=this.getSnapshotStoredChartData();this._viewportProjection.zoomOnMapRectangle(b.mapRect,!0)}else this._zoomOnMapBounds?this.zoomOnMapBounds():this._scaleMapOnResize&&this._mapRect&&this._viewportProjection.zoomOnMapRectangle(this._mapRect);for(a in this.components)this.components[a].invalidateDisplay("Map._paint");return this.updateNavigation(),this._dataChanged=!1,this._zoomOnMapBounds=!1,!0}},updateNavigation:function(a){var b,c,d,e=this;this._data&&this.rect&&(b=(this.rect.width<400||this.rect.height<400||!this._data.navigation)&&!this.backendApi.isSnapshot&&this._layoutMode>3,c=J.call(this),d=void 0===a?!(c&&!this._data.navigation||this.backendApi.isSnapshot||!(this._layoutMode>3||b&&this._layoutMode>=3)):!a,this.$scope.navigationHomeOnly=b,this.$scope.navigationVisible=d,this.$scope.navigationStyle={top:this.components.dataArea.rect.y+13+"px",right:this.rect.width-this.components.dataArea.rect.x-this.components.dataArea.rect.width+13+"px"},void 0===this._timeoutID&&(this._timeoutID=setTimeout(function(){e._timeoutID=void 0,e.$scope.$apply()})))},getContextMenu:function(a,b){var c=a,e=c.model,f=e.layout;c.isReadonly||b.addItem({translation:"Common.Navigation",tid:"navigation",icon:"icon-hub-home",select:function(){if(d.isInEditMode())e.getProperties().then(function(a){a.navigation=!a.navigation,e.save()});else{var a=[[],!0];a[0][0]={qPath:"/navigation",qOp:"replace",qValue:f.navigation?"false":"true"},c.backendApi.applyPatches(a)}}})},destroy:function(){this._super(),this._viewportProjection&&(this._viewportProjection.stopListen("resetZoomFinished"),this._viewportProjection.stopListen("changed"),this._viewportProjection.stopListen("changedByInteraction")),this.onNavigationPressed()},getViewState:function(){return d.state},setSnapshotData:function(a){var b=[];if(this._super(a),this.isSnapshot())return v.resolve();for(var c=0;c<this._data.layers.length;c++)b[c]=this.components.dataArea.layers[c].getSnapshotLayerData(a.layers[c]);return v.all(b)},getSnapshotChartData:function(){return a.extend(!0,this._super()||{},{mapRect:this._viewportProjection.getViewRectangleInMapCoordinate()})},isSnapshot:function(){return this.backendApi&&this.backendApi.isSnapshot}}),{type:"map",BackendApi:e,template:h,View:K,definition:i,initialProperties:{version:"0.9",layers:[]},exportProperties:null,importProperties:null,getDimensionInfo:function(){return[]},getMeasureInfo:function(){return[]},onStateChanged:function(a){this.components.dataArea.baseMapLayer&&this.components.dataArea.baseMapLayer.setViewState(a)},mapProperties:function(){this.mappedDefinition=o.mapDefinition(this.definition,this.type),this.dimensionDefinition={min:1,max:1,ppPath:"data"}},addFieldDimension:t.addFieldDimension,addLibraryDimension:t.addLibraryDimension,addDimensionPopoverComponent:s,getDropFieldOptions:t.getDropFieldOptions,getDropDimensionOptions:t.getDropDimensionOptions,getDropMeasureOptions:t.getDropMeasureOptions,getCreatePropertyHandler:function(){var a=this;return a.propertyHandler||(a.propertyHandler=new p(a.dimensionDefinition)),a.propertyHandler},showRequirements:function(a){var b=a.layout;return!b.layers||!b.layers.length},snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},legend:{}}}}}),define("extensions.qliktech/combochart/markerarea",["objects.views/charts/components/chart-component","objects.views/charts/renderers/canvas-renderer","objects.views/charts/shapes/container","objects.views/charts/shapes/circle","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect","extensions.qliktech/linechart/layers/oob-layer"],function(a,b,c,d,e,f,g){function h(a){switch(a){case"diamond":case"triangle":return new e;case"circle":return new d;case"line":return new f;default:return new f}}function i(a,b,c,d,e,f){var g,h=e.type,i=e.rgb,j=e.shiftedRgb,k=.5,l=e.isFilled,m=!0;switch(h){case"circle":a.set(b,c,Math.max(2,Math.min(6,.125*d)));break;case"diamond":g=Math.max(2,Math.min(12,.25*d)),a.set([{x:b,y:c-g/2},{x:b-g/2,y:c},{x:b,y:c+g/2},{x:b+g/2,y:c}]);break;case"triangle":g=Math.max(2,Math.min(12,.25*d)),a.set([{x:b,y:c-g/2},{x:b-g/2,y:c+g/2},{x:b+g/2,y:c+g/2}]);break;case"line":g=Math.max(2,.5*d),24>g?a.set(b-g/2,Math.floor(c)-k,g,Math.min(3,Math.max(2,Math.round(g/4)))):a.set(Math.floor(b-g/2)-k,Math.floor(c)-k,Math.ceil(g),Math.min(3,Math.max(2,Math.round(g/4)))),l=!0;break;default:g=Math.max(2,Math.min(12,.25*d)),a.set(b-g/2,c-g/2,g,g)}m&&l!==!1?(a.fill=i,a.stroke=j):(a.stroke=i,delete a.fill),f&&(a.stroke="#000000")}function j(a){var b,c,d,e,f,g,h,j=this._shapes?this._shapes.length:0,k=this.rect.width,l=this._majorAxis;for(this._outOfRange={up:{},down:{},points:[]},b=0;j>b;b++)h=this._shapes[b],e=this._minorAxes[h.data.axisIdx],f=a[this._measureToAxisIndex[h.data.measureIdx]],g=l.getWidthOfId(h.data.axisId),c=l.getPositionOfId(h.data.axisId),d=e.getPositionOfValue(h.data.end),h.data.x=c,h.data.y=d,h.data.outOfRangeUp=d<f.topCutoff,h.data.outOfRangeDown=d>f.bottomCutoff,h.data.selected=h.data.cacheItem&&h.data.cacheItem.selected,h.opacity=h.data.outOfRangeUp||h.data.outOfRangeDown?0:h.data.selected?1:this._globalAlpha,d=Math.max(f.topCutoff+4,Math.min(f.bottomCutoff-4,d)),i(h,c,d,g,h.data,h.data.cacheItem&&h.data.cacheItem.selected),h.data.isVisible=c>0&&k>c,h.data.isVisible&&(h.data.outOfRangeUp||h.data.outOfRangeDown)&&(h.data.outOfRangeUp&&!this._outOfRange.up[c]?(this._outOfRange.points.push(h),this._outOfRange.up[c]=!0):h.data.outOfRangeDown&&!this._outOfRange.down[c]&&(this._outOfRange.points.push(h),this._outOfRange.down[c]=!0))}var k;return k=a.extend("MarkerArea",{init:function(){this._super.apply(this,arguments),this.renderers={markers:new b(this.container,{name:"marker-layer"})},this._oobLayer=new g(this.container),this.layers=[this._oobLayer],this._markerRenderer=this.renderers.markers},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},getMeasureIndices:function(){return this._measureIndices},setMeasureIndices:function(a){this._measureIndices=a},setMajorAxis:function(a){this._majorAxis=a,this._majorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setMajorAxis")},this)},setMinorAxis:function(a){this._minorAxis=a,this._minorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setMinorAxis")},this)},setSecondaryMinorAxis:function(a){this._secondaryMinorAxis=a,this._secondaryMinorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setSecondaryMinorAxis")},this)},setDimensionTree:function(a){this._tree=a,this.invalidateProperties(),this.invalidateDisplay()},hasValidData:function(){return this._super()&&this._data},getMajorAxisData:function(){return this._majorAxisData},createAxisData:function(a,b,c,d){d||(this._cacheIndex=0);var e=a.children;return e.map(function(a){var c;return"dimension"===b.types[d]&&(c={label:a.data.qText,group:!1,id:a.data.id,cacheIndex:[]},"measure"===b.types[d+1]&&c.cacheIndex.push(this._cacheIndex++)),c},this)},_createMeasureDisplayNode:function(a,b,c,d){var e=h(c),f=a.children[0].data,g=a.parent.cacheItem,i=this.measureFormatters[b],j="undefined"!=typeof f.qValue?f.qValue:f.qNum,k=a.ancestors.filter(function(a){return"qElemNo"in a.data}).map(function(a){return a.data.qElemNo}).reverse();return e.data={qText:a.data.qText,qNum:j,start:0,end:j,valueLabel:i&&"U"===i.type?i.formatValue(j):a.data.qText,cacheItem:g,type:c,isFilled:d,measureIdx:b,color:this._colorMap.getColor(k,j,b,a.data.rowIndex)},g.addShape("dataArea",e,!0),e.fill=e.data.color.toHex(),e.data.rgb=e.data.color.toRGBA(),e.data.shiftedRgb=e.data.color.createShiftedColor().toRGBA(),e},_createDimensionDisplayNode:function(a){var b=new c;return b.data={qText:a.data.qText},b},_applyIds:function(a,b,c,d){var e;a.children.forEach(function(f,g){e=a.data.id?a.data.id+";"||"":"","dimension"===c[d]?(f.data.id=e+b[d]+":"+f.data.qElemNo,this._applyIds(f,b,c,d+1)):"measure"===c[d]&&(f.data.id=e+b[d+g])},this)},getRenderTree:function(a,b,c,d){var e,f,g;return f=a.children,"measure"===b.types[d]&&this._measureIndices&&(f=f.filter(function(a,b){return this._measureIndices.indexOf(b)>=0},this)),f.map(function(a,f){var h;return"dimension"===b.types[d]?(h=this._createDimensionDisplayNode(a),e=this.getRenderTree(a,b,c,d+1),e.forEach(function(a){h.addChild(a)})):"measure"===b.types[d]&&(g=this._measureIndices?this._measureIndices[f]:f,h=this._createMeasureDisplayNode(a,g,this._data.qHyperCube.qMeasureInfo[g].series.marker||"circle",this._data.qHyperCube.qMeasureInfo[g].series.markerFill),h.data.axisId=a.parent.data.id,h.data.axisIdx=b.measureToAxisIndex[g],c.shapes.push(h)),h},this)},_updateProperties:function(){if(this._markerRenderer.stage.removeChildren(),this._data&&this._tree){var a,b,c=this._data.qHyperCube.qDimensionInfo.length,d=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,e=c+1,f=new Array(c).join(",").split(",").map(function(){return"dimension"}),g=this._data.qHyperCube.qDimensionInfo.concat(this._data.qHyperCube.qMeasureInfo).map(function(a){return a.cId}),h=this._data.qHyperCube.qDimensionInfo.map(function(a){return a.qApprMaxGlyphCount});h.push(this._data.qHyperCube.qMeasureInfo.reduce(function(a,b){return Math.max(a,b.qApprMaxGlyphCount)},0)),this._minorAxes=[this._minorAxis],this._secondaryMinorAxis&&this._minorAxes.push(this._secondaryMinorAxis);var i=this._minorAxes,j=[],k=[];if(this._measureIndices)k=this._measureIndices;else if(d>0&&20>d)for(;k.length<d;)k.push(k.slice(-1)[0]+1||0);k.forEach(function(a){j[a]=i.filter(function(b){return b._dataIndices?b._dataIndices.indexOf(a)>=0:!0})[0]}),this._measureToAxis=j,this._measureToAxisIndex=j.map(function(a){return i.indexOf(a)}),f.push("measure"),a={shapes:[],shapesToLabel:[],globalPositiveSum:0,globalNegativeSum:0},b={colIds:g,types:f,numLevels:e,numMeasures:d,measureToAxisIndex:this._measureToAxisIndex,axesSettings:this._minorAxes.map(this._getAxisDetails)},this._applyIds(this._tree,g,f,0);var l=this.getRenderTree(this._tree,b,a,0);this._objects=l,this._shapes=a.shapes,l.forEach(function(a){this._markerRenderer.stage.addChild(a)},this);var m=this.createAxisData(this._tree,b,a,0),n=f.map(function(a,b){return{qApprMaxGlyphCount:h[b],show:b<f.length-1}});this._majorAxisData={data:m,info:n},this.setSelectableShapes(a.shapes.map(function(a){return a.data.cacheItem}))}},paint:function(){this._super(this._layoutMode,this._data);var a=this._minorAxes.map(this._getAxisDetails);j.call(this,a),this._oobLayer&&(this._oobLayer.update(this._outOfRange.points,{measureToAxisIndex:this._measureToAxisIndex,axesSettings:a,globalAlpha:this._globalAlpha,markerSize:Math.min(8,this._majorAxis.getDiscreteSpacing()/2)}),this._oobLayer.render()),this._markerRenderer.render()},updateSize:function(){this._super(),this.layers.forEach(function(a){a.rect=this.rect,a.renderer.setDimensions(0,0,this.rect.width,this.rect.height),a.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y)},this)},release:function(){this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this),this._secondaryMinorAxis&&this._secondaryMinorAxis.stopListen("changed",null,this)},_getAxisDetails:function(a){var b=a.getPlotMin(),c=a.getPlotMax(),d=c-b,e=a.getPadding(),f=e.top-1,g=a.rect.height-e.bottom,h=0;return h=b>0?g:0>c?f:Math.floor(a.getPositionOfValue(0))-.5,{plotMin:b,plotMax:c,posMin:a.getPositionOfValue(b),posMax:a.getPositionOfValue(c),plotRange:d,topCutoff:f,bottomCutoff:g,areaStartBase:h,zeroPos:Math.floor(a.getPositionOfValue(0))-.5}}})}),define("extensions.qliktech/combochart/comboarea",["objects.views/charts/components/chart-component","extensions.qliktech/linechart/linearea","extensions.qliktech/barchart/bararea","extensions.qliktech/combochart/markerarea"],function(a,b,c,d){var e;return e=a.extend("ComboArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._cacheItems=[],this._colorMap=null;var a=new(Function.prototype.bind.apply(c,[null].concat([].slice.call(arguments)))),e=new(Function.prototype.bind.apply(b,[null].concat([].slice.call(arguments)))),f=new(Function.prototype.bind.apply(d,[null].concat([].slice.call(arguments))));e.setShowDataPoints(!0),e.setShowDataPointLabels(!1),a.setShowDataPoints(!1),this.subComponents=[a,e,f],this.lineArea=e,this.barArea=a,this.markerArea=f},setColorMap:function(a){this._colorMap=a,this.subComponents.forEach(function(b){b.setColorMap(a)})},getColorMap:function(){return this._colorMap},setShowDataPoints:function(){},setMajorAxis:function(a){this.subComponents.forEach(function(b){b.setMajorAxis(a)}),this._majorAxis=a},setMinorAxis:function(a){this._minorAxis=a,this.subComponents[0].setMinorAxis(this._minorAxis),this.subComponents[2].setMinorAxis(this._minorAxis)},setSecondaryMinorAxis:function(a){this._secondaryMinorAxis=a},setDimensionTree:function(a){this._tree=a,this.subComponents.forEach(function(b){b.setDimensionTree(a)})},setData:function(a){this._super(a);for(var b=[],c=[],d=[],e=0;e<a.qHyperCube.qMeasureInfo.length;e++)a.qHyperCube.qMeasureInfo[e].series&&"line"===a.qHyperCube.qMeasureInfo[e].series.type?b.push(e):a.qHyperCube.qMeasureInfo[e].series&&"marker"===a.qHyperCube.qMeasureInfo[e].series.type?d.push(e):c.push(e);this.subComponents[0].setHasValidData(c.length>0),this.subComponents[1].setHasValidData(b.length>0),this.subComponents[2].setHasValidData(d.length>0),this.lineArea.setMeasureIndices(b),this.barArea.setMeasureIndices(c),this.markerArea.setMeasureIndices(d),this.subComponents.forEach(function(b){b.setData(a)}),this.barArea.setMinorAxis(this._minorAxis),this.lineArea.setMinorAxis(this._secondaryMinorAxis),this.lineArea.setSecondaryMinorAxis(this._minorAxis),this.markerArea.setMinorAxis(this._minorAxis),this.markerArea.setSecondaryMinorAxis(this._secondaryMinorAxis),this.invalidateProperties()},setHasValidData:function(a){this.subComponents.forEach(function(b){b.setHasValidData(a)})},setLayoutMode:function(a){this._super(a),this.subComponents.forEach(function(b){b.setLayoutMode(a)})},setRect:function(a,b,c,d){this._super(a,b,c,d),this.subComponents.forEach(function(e){e.setRect(a,b,c,d)})},setOuterRect:function(a,b,c,d){this._super(a,b,c,d),this.subComponents.forEach(function(e){e.setOuterRect(a,b,c,d)})},setLayoutToContainerRatios:function(a,b){this._super(a,b),this.subComponents.forEach(function(c){c.setLayoutToContainerRatios(a,b)})},setContainerRect:function(a,b,c,d){this._super(a,b,c,d),this.subComponents.forEach(function(e){e.setContainerRect(a,b,c,d)})},insertAdjacentTo:function(){this._super.apply(this,[].slice.call(arguments)),this.subComponents.forEach(function(a){a.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},this)},setGlobalOpacity:function(a,b){this._super(a,b),this.subComponents.forEach(function(c){c.setGlobalOpacity(a,b)},this)},setLineType:function(){},updateSize:function(){this._super(),this.subComponents.forEach(function(a){a.updateSize()},this)},_updateDisplay:function(){this.subComponents.forEach(function(a){a.invalidateDisplay()})},_updateSize:function(){},_updateProperties:function(){if(this._data&&this._tree){this.subComponents[0].updateNow(["properties"]),this.subComponents[1].updateNow(["properties"]),this.subComponents[2].updateNow(["properties"]);var a=this.subComponents[0].getSelectableShapes();a&&a.length||(a=this.subComponents[1].getSelectableShapes()),a&&a.length||(a=this.subComponents[2].getSelectableShapes()),this.setSelectableShapes(a)}},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data},paint:function(){this._majorAxis.updateNow(),this._minorAxis.updateNow()},release:function(){this.subComponents.forEach(function(a){a.release()})}})}),define("extensions.qliktech/combochart/combochart-properties",["translator","general.utils/property-resolver"],function(a,b){function c(a,c,d){var e,f=d||0;e=c?c.getMeasureLayouts():b.getValue(a,"qHyperCubeDef.qMeasures",[]).map(function(a){return a.qDef});var g=e.filter(function(a){return b.getValue(a,"series.axis",0)===f||0===f&&"bar"===b.getValue(a,"series.type","bar")});return g}function d(a,b){return b?b.getDimensionLayouts():a.qHyperCubeDef.qDimensions.map(function(a){return a.qDef})}function e(a,b){return b.getMeasures().filter(function(a){return a.qDef.series&&"line"===a.qDef.series.type}).length>0}function f(a,b){return b.getMeasures().filter(function(a){return!a.qDef.series||"bar"===a.qDef.series.type}).length>1}var g,h,i,j;return g={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,show:function(a,b){return e(a,b)||f(a,b)},items:{grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",defaultValue:"grouped",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(a,b){return f(a,b)}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"vertical",horizontal:!0,show:!1,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]},nullMode:{type:"string",component:"dropdown",ref:"nullMode",translation:"properties.nullMode",options:[{value:"gap",translation:"properties.nullMode.gap"},{value:"connect",translation:"properties.nullMode.connect"},{value:"zero",translation:"properties.nullMode.zero"}],defaultValue:"gap",show:function(a,b){return e(a,b)&&b.getMeasures().length>1}},dataPoints:{ref:"dataPoint.show",translation:"properties.dataPoints.showDataPoints",type:"boolean",defaultValue:!1,show:function(a,b){return e(a,b)}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{type:"items",label:function(b,c){var e,f="x",g=d(b,c).map(function(a){return a.qFallbackTitle||""}).join(", ");return e=g?a.get("properties."+f+"AxisWithInfo",[g]):a.get("properties."+f+"Axis")},items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(a){return["all","labels"].contains(a.dimensionAxis.show)}},dock:{ref:"dimensionAxis.dock",translation:"Common.Position",type:"string",component:"dropdown",defaultValue:"near",options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}],show:function(a){return"none"!==a.dimensionAxis.show}}}},measureAxis:{uses:"measureAxis",label:function(b,d){var e,f=c(b,d,0).map(function(a){return a.qFallbackTitle});return e=f.length?a.get("properties.yAxisWithInfo",[f.join(",")]):a.get("properties.yAxis")},show:function(a){return c(a,null,0).length>0},items:{axis:{items:{show:{ref:"measureAxes.0.show",snapshot:{title:"properties.yAxis",tid:"property-yAxis"}},dock:{ref:"measureAxes.0.dock",show:function(a){return"none"!==a.measureAxes[0].show},options:[{value:"near",translation:"properties.dock.left"},{value:"far",translation:"properties.dock.right"}]},spacing:{ref:"measureAxes.0.spacing",show:function(a){return a.measureAxes[0]&&"none"!==a.measureAxes[0].show}}}},minMax:{items:{autoMinMax:{ref:"measureAxes.0.autoMinMax"},minMax:{ref:"measureAxes.0.minMax",defaultValue:"min",show:function(a){return!a.measureAxes[0].autoMinMax}},min:{ref:"measureAxes.0.min",show:function(a){return["min","minMax"].contains(a.measureAxes[0].minMax)&&!a.measureAxes[0].autoMinMax},invalid:function(a){return"minMax"===a.measureAxes[0].minMax?a.measureAxes[0].min>=a.measureAxes[0].max:!1}},max:{ref:"measureAxes.0.max",show:function(a){return["max","minMax"].contains(a.measureAxes[0].minMax)&&!a.measureAxes[0].autoMinMax},invalid:function(a){return"minMax"===a.measureAxes[0].minMax?a.measureAxes[0].min>=a.measureAxes[0].max:!1}}}}}},secondaryMeasureAxis:{uses:"measureAxis",label:function(b,d){var e,f=c(b,d,1).map(function(a){return a.qFallbackTitle});return e=f.length?a.get("properties.yAxisWithInfo",[f.join(",")]):a.get("properties.yAxis")},show:function(a){return c(a,null,1).length>0},items:{axis:{items:{show:{ref:"measureAxes.1.show"},dock:{ref:"measureAxes.1.dock",defaultValue:"far",show:function(a){return"none"!==a.measureAxes[1].show},options:[{value:"near",translation:"properties.dock.left"},{value:"far",translation:"properties.dock.right"}]},spacing:{ref:"measureAxes.1.spacing",show:function(a){return a.measureAxes[1]&&"none"!==a.measureAxes[1].show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"measureAxes.1.autoMinMax"},minMax:{ref:"measureAxes.1.minMax",defaultValue:"min",show:function(a){return!a.measureAxes[1].autoMinMax}},min:{ref:"measureAxes.1.min",show:function(a){return["min","minMax"].contains(a.measureAxes[1].minMax)&&!a.measureAxes[1].autoMinMax},invalid:function(a){return"minMax"===a.measureAxes[1].minMax?a.measureAxes[1].min>=a.measureAxes[1].max:!1}},max:{ref:"measureAxes.1.max",show:function(a){return["max","minMax"].contains(a.measureAxes[1].minMax)&&!a.measureAxes[1].autoMinMax},invalid:function(a){return"minMax"===a.measureAxes[1].minMax?a.measureAxes[1].min>=a.measureAxes[1].max:!1}}}}}}}},h={uses:"data",items:{dimensions:{},measures:{items:{series:{type:"items",items:{seriesType:{ref:"qDef.series.type",type:"string",component:"item-selection-list",defaultValue:"bar",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.bar",value:"bar"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.marker",value:"marker"}],change:function(){}},seriesAxis:{ref:"qDef.series.axis",type:"integer",component:"dropdown",defaultValue:0,options:[{translation:"properties.axis.primary",value:0},{translation:"properties.axis.secondary",value:1}],show:function(a){return a.qDef.series&&a.qDef.series.type&&"bar"!==a.qDef.series.type}},seriesMarker:{ref:"qDef.series.marker",type:"string",component:"dropdown",defaultValue:"circle",options:[{translation:"properties.marker.circle",value:"circle"},{translation:"properties.marker.rect",value:"rect"},{translation:"properties.marker.diamond",value:"diamond"},{translation:"properties.marker.triangle",value:"triangle"},{translation:"properties.marker.line",value:"line"}],show:function(a){return a.qDef.series&&"marker"===a.qDef.series.type}},seriesMarkerFill:{ref:"qDef.series.markerFill",translation:"properties.series.fill",type:"boolean",defaultValue:!0,show:function(a){return a.qDef.series&&"marker"===a.qDef.series.type&&!["line"].contains(a.qDef.series.marker)}}}}}}}},j={uses:"sorting"},i={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"}}},{type:"items",component:"accordion",items:{data:h,sorting:j,addons:i,settings:g}}}),define("extensions.qliktech/combochart/combochart-data",["general.utils/property-resolver"],function(a){function b(b,c){var d=c.getMeasures(),e=a.getValue(b,"color.mode");"byMeasure"===e&&d.length>1?a.setValue(b,"color.mode","byDimension"):"byDimension"===e&&1===d.length&&"line"===a.getValue(d[0].qDef,"series.type")&&a.setValue(b,"color.mode","primary")}return{dimensions:{min:1,max:1,add:function(a,c,d){b(c,d)}},measures:{min:1,max:15,add:function(a,c,d){b(c,d)},replace:function(a,b){b.qDef.series&&(a.qDef.series.type=b.qDef.series.type||"bar")}}}}),define("text!extensions.qliktech/combochart/combochart.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>'}),define("extensions.qliktech/combochart/combochart",["jquery","util","qvangular","client.utils/state","objects.views/charts/scrollable-chart","objects.views/charts/components/chart-component","extensions.qliktech/combochart/comboarea","extensions.qliktech/combochart/combochart-properties","extensions.qliktech/combochart/combochart-data","objects.backend-api/hypercube-api","objects.extension/default-extension","objects.extension/object-conversion","text!./combochart.ng.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,c,d,e,f,g){if(c.length){var h,i,j;f?(h=f.min,i=f.max):(h=Math.min.apply(this,c.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return a.qMin})),i=Math.max.apply(this,c.filter(function(a){return!isNaN(a.qMax)}).map(function(a){return a.qMax}))),b.isNumeric(h)||(h=-1),b.isNumeric(i)||(i=1),j=this.getAxisOptions(d),e&&(i=Math.max(0,i),h=Math.min(0,h)),g&&(g.min=h,g.max=i,g.minMeasure&&g.maxMeasure?(this._cutMode=this.getSpikeSettings(g,j),h=this._cutMode.min,i=this._cutMode.max):this._cutMode={positive:!1,negative:!1}),a.setRealDataRange(void 0,void 0),this.setAxisDataRange(a,i,h,j.max,j.min,1)}}function o(a,b){var d,e=this.item,f=["contextMenu.add",e.name];b.canAddMeasure()&&(d=this.menu.addItem({translation:f,tid:"add-as"}),d.addItem({translation:"contextMenu.asBar",tid:"as-bar",icon:"icon-bar-chart-vertical",select:function(){b.addLibraryMeasure(e.id).then(function(b){b.qDef.series.type="bar",a.save(),c.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)})}}),d.addItem({translation:"contextMenu.asLine",tid:"as-line",icon:"icon-line-chart",select:function(){b.addLibraryMeasure(e.id).then(function(b){b.qDef.series.type="line",b.qDef.series.axis=1,a.save(),c.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)})}}),d.addItem({translation:"contextMenu.asMarker",tid:"as-marker",icon:"icon-shapes",select:function(){b.addLibraryMeasure(e.id).then(function(b){b.qDef.series.type="marker",b.qDef.series.axis=1,a.save()})}}))}var p,q={NONE:0,ONE_DIM:1,TWO_DIM:2};return p=e.extend("ComboChart",{namespace:".combochart",init:function(b,c,d,e){d=a.extend(!0,{components:{dataArea:{clazz:g},axis:{show:!0,order:1.1,reductionOrder:2.1,dock:"right",relevantSize:90,showFlag:f.prototype.ShowFlags.XSMALL}}},d||{}),this._super(b,c,d,e),this.components.scrollArea.setUseMiniChart(!1),this.components.axis.setShowStrategy("all"),this.components.dataArea.setSecondaryMinorAxis(this.components.axis),Object.keys(this.components).forEach(function(a){this.components[a].setUseTransition(!1)},this)},partialUpdate:function(a){var b,c,d;this._chartContext.refresh(a),this.providers.colorMap.setData(a),c=a.qHyperCube.qStackedDataPages.length>0?this._pagingInfo.y:a.qHyperCube.qDataPages[0].qArea.qTop,this.components.dimensionAxis.setInnerOffset(c*this.scrollMultiplicator);for(b in this.components)"miniChart"!==b&&this.components[b].invalidateProperties("ScrollableChart.partialUpdate");this.components.dataArea.updateNow(["properties"]),d=this.components.dataArea.barArea.getMeasureIndices().length?this.components.dataArea.barArea.getMajorAxisData():this.components.dataArea.markerArea.getMeasureIndices().length?this.components.dataArea.markerArea.getMajorAxisData():this.components.dataArea.lineArea.getMajorAxisData(),this.components.dimensionAxis.setDataRange(d.data,d.info),this.components.dimensionAxis.updateNow(["properties"]),this.components.legend.updateNow(["properties"]),this.components.dimensionAxis.updateLevels(),this.components.dimensionAxis.invalidateDisplay("ScrollableChart.partialUpdate"),this.components.dataArea.invalidateDisplay("ScrollableChart.partialUpdate"),this.components.legend.invalidateDisplay("ScrollableChart.partialUpdate")},_paint:function(){if(this._super()===!1)return!1;var a,b=this.components.scrollArea,c=this.rect.height,d=this.getSnapshotStoredChartData(),e=0;if((this._cutMode.positive||this._cutMode.negative)&&(this._layoutMode>=31&&(e=48),e=this._layoutMode>=15?32:this._layoutMode>=7?16:8),this.components.measureAxis.setPadding(this._cutMode.positive?e:0,0,this._cutMode.negative?e:0,0),this.components.axis.setPadding(this._cutMode.positive?e:0,0,this._cutMode.negative?e:0,0),this.components.dimensionAxis.setMaxDiscreteUnitSize(Math.max(1,Math.ceil(c/4))),this.components.dataArea.updateNow(["properties"]),this.components.dimensionAxis.updateNow(["properties"]),this.layout(),this._readStoredData&&(this.components.dimensionAxis.setInnerOffset(d.axisInnerOffset),this.components.scrollArea.setOffset(d.scrollOffset)),!this.checkPage()){for(a in this.components)this.components[a].invalidateDisplay("ComboChart.paint");b.viewState.min+b.viewState.range>b.fullState.max&&b.setOffset(b.fullState.max-b.viewState.range)}},_updateData:function(b){this._checkPage=!1;var c,e,g,h,i,j,k,l,m,n,o=this.getSnapshotStoredChartData();if(c=b.qHyperCube.qMeasureInfo.filter(function(a){return a.series&&"line"===a.series.type}),e=b.qHyperCube.qMeasureInfo.filter(function(a){return!a.series||"bar"===a.series.type}),g=b.qHyperCube.qMeasureInfo.filter(function(a){return a.series&&"marker"===a.series.type}),h=[],i=[],b.qHyperCube.qMeasureInfo.forEach(function(a){a.series&&"bar"!==a.series.type&&1===a.series.axis?i.push(a):h.push(a)}),this.isStacked=!1,this.components.measureAxis.isStacked="stacked"===b.barGrouping.grouping&&e.length>1,this.components.axis.isStacked=!1,this._pagingMode=q.NONE,this.scrollMultiplicator=1,b.qHyperCube.qSize.qcy>b.qHyperCube.qDataPages[0].qArea.qHeight){this._pagingMode=q.ONE_DIM;var p=b.qHyperCube.qSize.qcy;"grouped"===b.barGrouping.grouping&&e.length>1&&(this.scrollMultiplicator=e+1,p*=this.scrollMultiplicator),this.components.dimensionAxis.setNumDiscreteUnits(p)}else this.components.dimensionAxis.setNumDiscreteUnits(null);this.components.dimensionAxis.isDiscrete()||(this._pagingMode=q.NONE),j=h.map(function(a){return a.qFallbackTitle}).join(", "),k=b.qHyperCube.qDimensionInfo.map(function(a){return a.qFallbackTitle}).join(", "),l=i.map(function(a){return a.qFallbackTitle}).join(", "),m={primary:h,secondary:i,lineSeries:c,markerSeries:g,barSeries:e,axes:{measureAxis:{component:this.components.measureAxis,data:a.extend(!0,{},b.measureAxes[0],{show:h.length?b.measureAxes[0].show:"none"}),title:b.measureAxes[0].title||j,dataIndices:h.map(function(a){return b.qHyperCube.qMeasureInfo.indexOf(a)})},secondaryMeasureAxis:{component:this.components.axis,data:a.extend(!0,{},b.measureAxes[1],{show:i.length?b.measureAxes[1].show:"none",dock_:["near","far"].contains(b.measureAxes[0].dock)?"near"===b.measureAxes[0].dock?"far":"near":f.prototype.getOppositeDock.call({options:{dock:b.measureAxes[0].dock}})}),title:b.measureAxes[1].title||l,dataIndices:i.map(function(a){return b.qHyperCube.qMeasureInfo.indexOf(a)})},dimensionAxis:{component:this.components.dimensionAxis,data:b.dimensionAxis,title:d.view!==d.Views.story?"":k,dataIndices:b.qHyperCube.qDimensionInfo.map(function(a,b){return b})}},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle,data:b.dimensionAxis,title:d.view!==d.Views.story?"":k}}},n=this.components.dimensionAxisTitle,this._data=b,n.setData(b),this.components.dataArea.setData(b),this.providers.colorMap.setData(b),this.components.legend.setData(b);var r=this.providers.colorMap.getLegendDataProvider();r.setMeasureLegendTypes(b.qHyperCube.qMeasureInfo.map(function(a){return a.series&&a.series.type?"line"===a.series.type?b.dataPoint.show?["line","circle"]:["line"]:"marker"===a.series.type?[(a.series.markerFill===!1?"!":"")+(a.series.marker||"circle")]:["rect"]:["rect"]
})),this._super(b,m),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(o.axisInnerOffset),this.components.scrollArea.setOffset(o.scrollOffset)):(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)),this._checkPage=!0},initSelections:function(){this._super(),this.selections.types.range.addComponent("y",this.components.axis),this.selections.Select.bind(function(a,b){var c,d=this.selections.getActiveType().activeComponent;c=d.subComponents?this.components.dimensionAxis.getType().current:d.getSelectionIndices(),this.onSelection.Select.apply(this,[a,b,c])}.bind(this))},updateDataArea:function(a){this._super.apply(this,[].slice.call(arguments)),this.components.dataArea.lineArea.setShowDataPoints(a.dataPoint.show),this.components.dataArea.lineArea.setLineType("area"===a.lineType&&a.stackedArea?"stackedArea":a.lineType),this.components.dataArea.lineArea.setNullMode(a.nullMode),this.components.dataArea.barArea.setGroupingMode(a.barGrouping.grouping),this.components.dataArea.updateNow(["properties"])},getMinDiscreteUnitSize:function(){return this._minDiscreteUnitSize},updateAxis:function(a,b){var c,e,f,g=b.primary.indexOf(b.barSeries[0])>=0;this._super(a,b),this._cutMode={positive:!1,negative:!1},n.apply(this,[this.components.measureAxis,b.primary,b.axes.measureAxis,g,this.components.dataArea.barArea.getMinorAxisData(),this.getPrimaryMeasureSettings(a,b)]),n.apply(this,[this.components.axis,b.secondary,b.axes.secondaryMeasureAxis,"zero"===a.nullMode,null]),e=this.chartFormatter.getFormattersForMeasures(a.qHyperCube.qMeasureInfo,b.primary.map(function(b){return a.qHyperCube.qMeasureInfo.indexOf(b)})),f=this.chartFormatter.getFormattersForMeasures(a.qHyperCube.qMeasureInfo,b.secondary.map(function(b){return a.qHyperCube.qMeasureInfo.indexOf(b)})),this.components.measureAxis.combinedMeasuresFormatter=this.chartFormatter.getFormatterFromFormatters(e),this.components.axis.combinedMeasuresFormatter=this.chartFormatter.getFormatterFromFormatters(f),c=b.barSeries.length?this.components.dataArea.barArea.getMajorAxisData():b.markerSeries.length?this.components.dataArea.markerArea.getMajorAxisData():b.lineSeries.length?this.components.dataArea.lineArea.getMajorAxisData():{data:[],info:[],groupSize:null},this.components.dimensionAxis.setDataRange(c.data,c.info),this.components.dimensionAxis.setGroupSize(c.groupSize,c.info),this._updateMinDiscreteUnitSize(this.components.dimensionAxis),!b.primary.length&&b.secondary.length||["all","labels"].indexOf(b.axes.measureAxis.data.show)<0&&b.secondary.length&&["all","labels"].indexOf(b.axes.secondaryMeasureAxis.data.show)>=0?this.components.grid.setAxes(this.components.dimensionAxis,this.components.axis):this.components.grid.setAxes(this.components.dimensionAxis,this.components.measureAxis);var h=this.components.dimensionAxisTitle;h.setDock("far"===a.dimensionAxis.dock?"top":"bottom"),d.view===d.Views.story&&h.hideComponent()},_updateMinDiscreteUnitSize:function(a){this._super(a)},getPrimaryMeasureSettings:function(a,c){var d,e,f,g,h=c.barSeries.filter(function(a){return!isNaN(a.qMin)}).map(function(b){return{min:b.qMin,max:b.qMax,index:a.qHyperCube.qMeasureInfo.indexOf(b),isBarSeries:c.barSeries.indexOf(b)>=0}}),i=c.primary.filter(function(a){return!isNaN(a.qMin)&&c.barSeries.indexOf(a)<0});return h.length&&(d=h.reduce(function(a,b){return a.min<b.min?a:b},h[0]),e=h.reduce(function(a,b){return a.max>b.max?a:b},h[0]),e&&(g=d.max),d&&(f=d.min),b.isNumeric(f)||(f=0),b.isNumeric(g)||(g=1)),{minMeasure:d,maxMeasure:e,nonBarSeriesMax:Math.max.apply(null,i.map(function(a){return a.qMax})),nonBarSeriesMin:Math.min.apply(null,i.map(function(a){return a.qMin})),min:f,max:g,data:a,options:c}},getSpikeSettings:function(a,b){var c,d,e=a.data,f=a.minMeasure,g=a.maxMeasure,h=a.min,i=a.max,j=0,k=0,l=0,m=0,n=!1,o=!1,p=g.index+e.qHyperCube.qDimensionInfo.length,q=f.index+e.qHyperCube.qDimensionInfo.length,r=e.qHyperCube.qDataPages[0]?e.qHyperCube.qDataPages[0].qMatrix:[];if(!isNaN(a.nonBarSeriesMax)&&a.nonBarSeriesMax>0&&(j=a.nonBarSeriesMax),!isNaN(a.nonBarSeriesMin)&&a.nonBarSeriesMin<0&&(k=a.nonBarSeriesMin),!this.components.measureAxis.isStacked){for(var s=0;s<r.length;s++)c=r[s],d=c[p].qNum,d>0&&!isNaN(d)&&(c[0].qIsOtherCell||c[1].qIsOtherCell?l=Math.max(d,l):j=Math.max(d,j)),d=c[q].qNum,0>d&&!isNaN(d)&&(c[0].qIsOtherCell||c[1].qIsOtherCell?m=Math.min(d,m):k=Math.min(d,k));null!==b.max&&b.max<g.max?n=b.max>0:j>0&&l/j>5&&(i=j,n=i>=0),null!==b.min&&b.min>f.min?o=b.min<0:0>k&&m/k>5&&(h=k,o=0>h)}return{max:i,min:h,positive:n,negative:o}}}),{type:"ComboChart",BackendApi:j,template:m,View:p,definition:h,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:17,qHeight:500}],qSuppressMissing:!0},measureAxes:[{autoMinMax:!0,dock:"near",max:10,min:0,minMax:"min",show:"all",spacing:1},{autoMinMax:!0,dock:"far",max:10,min:0,minMax:"min",show:"all",spacing:1}]},data:i,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},range:{},legend:{},tooltip:{}}},getDropMeasureOptions:function(a,b,c,d,e){"measure"===a.item.type?(o.call(a,c,b,e),b.getMeasures().length>=b.minMeasures()&&a.ReplaceMeasures(c,b,e),d()):k.getDropMeasureOptions(a,b,c,d,e)},importProperties:function(a,c,d){var e,f=l.axisChart.importProperties.apply(l,[a,c,d]),g="linechart"===a.properties.visualization,h=[];return f.qProperty.qHyperCubeDef.qMeasures.forEach(function(a){a.qDef.series||(a.qDef.series={type:g?"line":"bar",axis:g?1:0,marker:"circle",markerFill:!0}),h.indexOf(a.qDef.series.axis)<0&&h.push(a.qDef.series.axis)}),e=h.sort().shift(),f.qProperty.measureAxes[e]&&a.properties.measureAxis&&"undefined"!=typeof a.properties.measureAxis.autoMinMax&&b.extend(!0,f.qProperty.measureAxes[e],a.properties.measureAxis,{logarithmic:!1}),f},exportProperties:l.axisChart.exportProperties.bind(l)}}),define("objects.backend-api/pivot-api",["./backend-api"],function(a){function b(a,b,c){var d,e,f,g=[];for(e=0;e<b.length;e++)for(d=0;d<a.length;d++)f={qType:c,qCol:b[e],qRow:a[d]},g.push(f);return g}var c;return c=a.extend("PivotApi",{init:function(a){this._super(a,"/qHyperCubeDef",{mode:"P"}),this.cacheCube.setMethodName("GetHyperCubePivotData")},updateCache:function(a){a&&a.qHyperCube&&"P"===a.qHyperCube.qMode?(this.cacheCube.set(a.qHyperCube.qPivotDataPages),this.cacheCube.setCubeSize(a.qHyperCube.qSize)):this.cacheCube.clear(),this.backendStackThrottle.clear()},getData:function(a){switch(this.model.layout.qHyperCube.qMode){case"P":return this.cacheCube.getData(a);default:throw"you are using a non-supported backend-api"}},getReducedData:function(a,b,c){return c=void 0!==c?c:"D1",this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,a,b,c])},select:function(a,c,d){switch(this.model.layout.qHyperCube.qMode){case"P":return this.model.rpc("SelectPivotCells",null,[this.path,b(a,c,d)]);default:throw"you are using a non-supported backend-api"}},expandTop:function(a,b,c){return this.model.rpc("ExpandTop",null,[this.path,a,b,c])},expandLeft:function(a,b,c){return this.model.rpc("ExpandLeft",null,[this.path,a,b,c])},collapseTop:function(a,b,c){return this.model.rpc("CollapseTop",null,[this.path,a,b,c])},collapseLeft:function(a,b,c){return this.model.rpc("CollapseLeft",null,[this.path,a,b,c])},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},getSize:function(){return this.model.layout.qHyperCube.qSize}})}),define("extensions.qliktech/pivot-table/pivot-table-properties",["client.property-panel/default-properties","general.utils/property-resolver","util","translator"],function(a,b,c,d){function e(a,b,c){if(!c.properties.qHyperCubeDef.qIndentMode)return!0;var d,e=c.properties.qHyperCubeDef.qInterColumnSortOrder.indexOf(-1),f=c.properties.qHyperCubeDef.qNoOfLeftDims;return e>-1&&f>e&&f--,d=c.properties.qHyperCubeDef.qDimensions.indexOf(a),0===d||d>=f}var f,g;f={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",items:{alwaysFullyExpanded:{ref:"qHyperCubeDef.qAlwaysFullyExpanded",type:"boolean",translation:"properties.pivot.fullyExpanded",defaultValue:!1},indentMode:{ref:"qHyperCubeDef.qIndentMode",type:"boolean",translation:"properties.pivot.indentMode"}}}}},g={uses:"sorting",component:"pivot-sorting"};var h={type:"array",component:"pivot-data",translation:"properties.data",addTranslation:"Properties.AddData",items:{dimensions:c.extend(!0,{},a.dimensions,{items:{globalGrouping:{type:"boolean",translation:"properties.dimensionLimits.globalGrouping",ref:"qOtherTotalSpec.qGlobalOtherGrouping",defaultValue:!1,show:function(a){return"OTHER_OFF"!==b.getValue(a,"qOtherTotalSpec.qOtherMode")}},totalMode:{type:"string",component:"switch",translation:"properties.showTotals",ref:"qOtherTotalSpec.qTotalMode",defaultValue:"TOTAL_OFF",trueOption:{value:"TOTAL_EXPR",translation:"properties.on"},falseOption:{value:"TOTAL_OFF",translation:"properties.off"},show:e},totalsLabel:{type:"string",component:"expression",expressionType:"StringExpr",ref:"qTotalLabel",translation:"properties.dimensionLimits.totals",defaultValue:function(){return d.get("properties.dimensionLimits.totals")},show:function(a,c,d){return"TOTAL_OFF"!==b.getValue(a,"qOtherTotalSpec.qTotalMode")&&e(a,c,d)}}}}),measures:c.extend(!0,{},a.measures,{items:{tableColorBgByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.0.qExpression",translation:"Object.Table.Measure.BackgroundExpression",defaultValue:""},tableColorByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.1.qExpression",translation:"Object.Table.Measure.ForegroundExpression",defaultValue:"",change:function(a){void 0===a.qAttributeExpressions[0]&&(a.qAttributeExpressions[0]={})}}}})}};return{type:"items",component:"accordion",items:{data:h,sorting:g,settings:f}}}),define("extensions.qliktech/pivot-table/pivot-sorting-util",["general.utils/array-util"],function(a){function b(a){function b(b){var c={},e=!1;b.forEach(function(a){c[a]?e=!0:c[a]=!0});var f=-1!==a.qInterColumnSortOrder.indexOf(-1);e=f?e||d.length+1!==Object.keys(c).length:e||d.length!==Object.keys(c).length;var g=[];Object.keys(c).forEach(function(a){"-1"!==a&&g.push(parseInt(a,10))}),g=g.sort();for(var h=0;h<g.length;++h)e=e||g[h]!==h;return e}function c(){for(var b=[],c=0;c<d.length;c++)b.push(c);var e=a.qMeasures.length>=2;return e&&b.push(-1),b}var d=a.qDimensions;b(a.qInterColumnSortOrder)&&(a.qInterColumnSortOrder=c())}function c(c){function d(){for(var b=0;b<e.length;b++)if(-1!==e[b]&&e[b]!==b){var c=e[b],d=e.indexOf(b),h=e[d];a.swap(e,b,d),a.swap(f,b,d),a.swap(g,g.indexOf(c),g.indexOf(h))}}b(c);var e,f=c.qDimensions,g=c.qInterColumnSortOrder;e=g.filter(function(a){return-1!==a}),d()}function d(a,b){var c=a.qDimensions,d=a.qInterColumnSortOrder,e=[],f=b.indexOf(-1);b.forEach(function(a){-1!==a&&e.push(c[a])}),e.forEach(function(a,b){c[b]=a}),d.splice(0,d.length);for(var g=0;g<e.length;g++)d.push(g);f>-1&&d.splice(f,0,-1)}function e(a,b){var c=a.qMeasures,d=[];b.forEach(function(a){d.push(c[a])}),c.splice(0,c.length),d.forEach(function(a){c.push(a)})}return{validatePivotHyperCube:b,fixPivotHypercubeOrders:c,reorderPivotDimensions:d,reorderMeasures:e}}),define("extensions.qliktech/pivot-table/pivot-hypercube-handler",["objects.utils/data-properties/hypercube-handler","core.utils/deferred","general.utils/array-util","extensions.qliktech/pivot-table/pivot-sorting-util","util"],function(a,b,c,d,e){var f,g=1e3;return f=a.extend({addDimension:function(a,c){var f=this.getDimensions(),g=this;return a.qDef.cId||(a.qDef.cId=e.generateId()),f.length<this.maxDimensions()?this.autoSortDimension(a).then(function(){var e=g.hcProperties.qNoOfLeftDims,h=g.hcProperties.qInterColumnSortOrder,i=h.indexOf(-1),j=f.length;return d.fixPivotHypercubeOrders(g.hcProperties),c||-1!==e?!c&&e>=0?(i>=e?(h.splice(i,1),h.push(j),h.splice(i+1,0,-1)):h.push(j),f.splice(e,0,a),g.hcProperties.qNoOfLeftDims++):(0===j&&(g.hcProperties.qNoOfLeftDims=0),h.push(j),f.push(a)):(g.hcProperties.qNoOfLeftDims=1,h.unshift(j),f.splice(0,0,a)),b.resolve(a)}):void 0},removeDimension:function(a){var e,f,g,h=this.getDimensions(),i=this.properties.qHyperCubeDef.qNoOfLeftDims,j=this.hcProperties.qInterColumnSortOrder;for(g=0;g<j.length;g++)if(j[g]===a){f=g;break}return i>=f+1&&this.properties.qHyperCubeDef.qNoOfLeftDims--,e=h.splice(a,1)[0],c.indexRemoved(this.hcProperties.qInterColumnSortOrder,a),d.fixPivotHypercubeOrders(this.hcProperties),b.resolve(e)},addMeasure:function(a){var c=this.getMeasures(),d=this;if(a.qDef.cId||(a.qDef.cId=e.generateId()),delete a.qDef.qNumFormat,c.length<this.maxMeasures()){var f=1===c.length;return c.push(a),this.autoSortMeasure(a).then(function(){return f&&d.hcProperties.qInterColumnSortOrder.push(-1),a})}return c.length<g?(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.push(a),b.resolve(a)):void 0},removeMeasure:function(a){var c,d,e,f=this.getMeasures();if(a<f.length){if(c=2===f.length,d=this.hcProperties.qMeasures.splice(a,1)[0],this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length)f.push(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(0,1)[0]);else if(c){var g=this.hcProperties.qInterColumnSortOrder;e=g.indexOf(-1),g.splice(e,1),e+1<=this.hcProperties.qNoOfLeftDims&&this.hcProperties.qNoOfLeftDims--}}else d=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(a-f.length,1)[0];return b.resolve(d)},getSorting:function(){throw"don't call this"},changeSorting:function(){throw"don't call this"},setSorting:function(){throw"don't call this"}})}),define("text!extensions.qliktech/pivot-table/pivot-table.ng.html",[],function(){return'<div class="qv-pt" ng-class="{ \'qv-pt-interactive\': interactive, \'sortable-active\': pivoting.dragPlaceholder }">\r\n	<qv-scroll-area x-non-mouse-viewport-scrolling="nonMouseViewportScrolling"\r\n					class="qv-grid-object-scroll-area"\r\n					qva-delegated-activate=".qv-pt-expandable#interactive && collapseExpand($event);"\r\n					qv-sortable-list="pivoting">\r\n		<table>\r\n			<tbody>\r\n				<tr>\r\n					<th ng-repeat="cell in metaGhostHeaders.headers" ng-style="cell.style" class="meta-ghost-header"></th>\r\n				</tr>\r\n				<tr ng-repeat="row in grid.headerRows"\r\n					ng-class="row.classList">\r\n					<th ng-repeat="cell in row.cells"\r\n						ng-class="cell.classList"\r\n						class="cell"\r\n						colspan="{{cell.colspan}}"\r\n						rowspan="{{cell.rowspan}}"\r\n						ng-style="cell.style"\r\n						ng-include src="cell.templateSrc ? cell.templateSrc : \'pt-cell-item.ng.html\'"\r\n						title="{{cell.text}}"></th>\r\n				</tr>\r\n				<tr ng-repeat="row in grid.rows" tid="data.row">\r\n					<td ng-repeat="cell in row.cells"\r\n						ng-class="cell.classList"\r\n						class="cell"\r\n						colspan="{{cell.colspan}}"\r\n						rowspan="{{cell.rowspan}}"\r\n						ng-style="cell.style"\r\n						ng-include src="cell.templateSrc ? cell.templateSrc : \'pt-cell-item.ng.html\'"\r\n						title="{{cell.text}}"\r\n						tid="data.row.cell"></td>\r\n				</tr>\r\n			</tbody>\r\n		</table>\r\n	</qv-scroll-area>\r\n</div>\r\n'}),define("text!extensions.qliktech/pivot-table/cell-item.ng.html",[],function(){return'<div class="value">\n	{{cell.text}}\n</div>'}),define("text!extensions.qliktech/pivot-table/header-cell-item.ng.html",[],function(){return'<div class="value">\n	<i class="qv-pt-expandable" ng-if="cell.collapseExpandClass" ng-class="cell.collapseExpandClass"></i>\n	{{cell.text}}\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-left.ng.html",[],function(){return'<div class="left-meta-headers list"\r\n	 tid="meta.rows"\r\n	 ng-repeat="list in [pivoting.rows]"\r\n	 ng-include src="list.templateSrc">\r\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-top.ng.html",[],function(){return'<div class="top-meta-headers list"\r\n	 tid="meta.columns"\r\n	 ng-repeat="list in [pivoting.columns]"\r\n	 ng-include src="list.templateSrc">\r\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-list.ng.html",[],function(){return'<div class="button-wrapper"\n	 ng-repeat="header in list.items track by header.id"\n	 ng-include src="header.templateSrc">\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-item.ng.html",[],function(){return'<button class="qui-outlinebutton"\r\n		tid="meta.button"\r\n		ng-style="header.style"\r\n		ng-class="{ \'qui-active\': header.open, \'pseudo\': header.isPseudoDim, \'dragging\': header.dragging }"\r\n		qva-outside-ignore-for="{{header.qvaOutsideIgnoreFor}}"\r\n		qva-activate="!header.isPseudoDim && interactive && showDimension($event, header)"\r\n		title="{{header.title}}">\r\n	{{header.title}}\r\n</button>'}),define("objects.grid/data-grid-provider",["qvangular","./data-grid"],function(a,b){a.provider("qvDataGrid",function(){this.$get=[function(){return function(a){return new b(a)}}]})}),define("extensions.qliktech/pivot-table/meta/ghost-headers-provider",["qvangular","util","translator"],function(a,b,c){function d(a){this.calcApprMaxGlyphCnt=a,this.style={}}function e(a,c,d){this.opts=b.extend(!0,{glyphWidth:8,collapseExpandIconGlyphCnt:3,columnPaddingGlyphCnt:3,metaHeaderMaxGlyphCnt:155/8,leftTree:{emptyGlyphCnt:3,widthFactor:.35},topTree:{wideWidthFactor:.3,growFactor:1.2}},a),this.layout=c,this.viewportRect=d,this.headers=[],this.availableGlyphs=0,this.totLeftGlyphCnt=0,this.leftCellCnt=0,this.dataColumnsInfo={cnt:0,width:0}}function f(a){var b=!!this.layout.qHyperCube.qAlwaysFullyExpanded;return this.sortOrder.filter(function(b,c){return a?c>=this.leftDimCnt:c<this.leftDimCnt},this).map(function(a,c){var d=0;if(-1===a)return 0;var e=this.layout.qHyperCube.qDimensionInfo[a];return c+1<this.leftDimCnt?(d=e.qApprMaxGlyphCount,b||(d+=this.opts.collapseExpandIconGlyphCnt),d=Math.max(e.othersLabel.length,d)):(d=e.qApprMaxGlyphCount,d+=this.opts.columnPaddingGlyphCnt),d},this).sort(function(a,b){return b-a})[0]||0}function g(a){return this.sortOrder.filter(function(b,c){return a?c>=this.leftDimCnt:c<this.leftDimCnt},this).map(function(a){var b=0;return-1===a?b=c.get("Common.Measures").length:(b=this.layout.qHyperCube.qDimensionInfo[a].qFallbackTitle.length,b=Math.max(this.layout.qHyperCube.qDimensionInfo[a].othersLabel.length,b)),b+2},this).sort(function(a,b){return b-a})[0]||0}e.prototype={_reset:function(){this.headers.length=0,this.availableGlyphs=0,this.totLeftGlyphCnt=0,this.leftCellCnt=0,this.dataColumnsInfo.cnt=0,this.dataColumnsInfo.width=0},_addCollapseExpandHeader:function(){var a=new d(this.opts.collapseExpandIconGlyphCnt);this.headers.push(a),++this.leftCellCnt,this.availableGlyphs-=this.opts.collapseExpandIconGlyphCnt,this.totLeftGlyphCnt+=this.opts.collapseExpandIconGlyphCnt},_addCollapseExpandHeaders:function(){for(var a=0;a<this.leftDimCnt-1&&this.leftDimCnt>1&&this.leftDimCnt<=this.sortOrderCnt;++a)this._addCollapseExpandHeader()},_addLeftTreeMetaGhostHeader:function(a){var b=new d(a);this.headers.push(b),++this.leftCellCnt,this.availableGlyphs-=a,this.totLeftGlyphCnt+=a},_addEmptyLeftTreeMetaGhostHeader:function(a){var b=new d(a||this.opts.leftTree.emptyGlyphCnt);this.headers.push(b),++this.leftCellCnt,this.availableGlyphs-=b.calcApprMaxGlyphCnt},_addDataGhostHeader:function(){for(var a;this.availableGlyphs>0&&this.totDataColCnt>0&&this.dataColumnsInfo.cnt<this.totDataColCnt;){if(a=this.longestMeasureGlyphCnt,a+=this.opts.columnPaddingGlyphCnt,a/this.longestTopDimGlyphCnt<this.opts.topTree.wideWidthFactor&&(a+=a*this.opts.topTree.growFactor),this.availableGlyphs-a<0){this.availableGlyphs=0;break}this.availableGlyphs-=a;var b=new d(a);this.headers.push(b),++this.dataColumnsInfo.cnt}},_calculateGhostMetaHeadersWidth:function(a){var b,c=1;this.headers.forEach(function(b){b.widthFactor=b.calcApprMaxGlyphCnt*this.opts.glyphWidth/a,b.style.width=100*b.widthFactor+"%",c-=b.widthFactor},this),b=this.headers.slice(this.leftCellCnt),c>0&&b.forEach(function(a){a.widthFactor+=c/this.dataColumnsInfo.cnt,a.style.width=100*a.widthFactor+"%"},this),b.length&&(this.dataColumnsInfo.width=b[0].widthFactor*a)},update:function(a,b){this._reset();var c=this.longestLeftDimGlyphCnt,d=this.longestLeftDimTitleGlyphCnt;this.availableGlyphs=Math.floor(this.viewportRect.width/this.opts.glyphWidth),d/this.availableGlyphs<this.opts.metaHeaderMaxGlyphCnt&&(c=Math.min(this.opts.metaHeaderMaxGlyphCnt,Math.max(c,d))),this.pseudoInLeftTree&&(c+=this.longestMeasureTitleGlyphCnt),c/this.availableGlyphs>this.opts.leftTree.widthFactor&&(c=Math.floor(this.opts.leftTree.widthFactor*this.availableGlyphs)),this.availableGlyphs-c>0&&(c>0?this.isIndentMode?(this._addCollapseExpandHeaders(),this._addLeftTreeMetaGhostHeader(c)):this._getLeftDimsWidths(c,b).forEach(function(a){this._addCollapseExpandHeader(),this._addLeftTreeMetaGhostHeader(a)},this):this._addEmptyLeftTreeMetaGhostHeader(a),this._addDataGhostHeader(),this._calculateGhostMetaHeadersWidth(this.viewportRect.width))},_getLeftDimsWidths:function(a,b){for(var c=[],d=0,e=0,f=0;b>f;++f){var g=Math.min(a,this._getDimGlyphCnt(f));d+=g,c.push(g)}return d>this.availableGlyphs*this.opts.leftTree.widthFactor&&(e=(d-this.availableGlyphs*this.opts.leftTree.widthFactor)/b),c.map(function(a){return a-e})},_getDimGlyphCnt:function(a){var b=this.pseudoDimIndex;if(b===a)return this.longestMeasureTitleGlyphCnt;var c=a>b?a-1:a;return this.layout.qHyperCube.qDimensionInfo[c].qApprMaxGlyphCount}},Object.defineProperties(e.prototype,{isIndentMode:{get:function(){return this.layout.qHyperCube.qIndentMode}},pseudoDimIndex:{get:function(){var a=this.sortOrder.indexOf(-1);return~a?a:this.sortOrderCnt}},longestMeasureGlyphCnt:{get:function(){return this.layout.qHyperCube.qMeasureInfo.map(function(a){return a.qApprMaxGlyphCount}).sort(function(a,b){return b-a})[0]||0}},longestMeasureTitleGlyphCnt:{get:function(){return this.layout.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle.length}).sort(function(a,b){return b-a})[0]||0}},longestLeftDimTitleGlyphCnt:{get:function(){return g.call(this)}},longestLeftDimGlyphCnt:{get:function(){return f.call(this)}},longestTopDimGlyphCnt:{get:function(){return f.call(this,!0)}},sortOrder:{get:function(){return this.layout.qHyperCube.qEffectiveInterColumnSortOrder}},sortOrderCnt:{get:function(){return this.sortOrder.length}},leftDimCnt:{get:function(){return this.layout.qHyperCube.qNoOfLeftDims>=0?this.layout.qHyperCube.qNoOfLeftDims:this.sortOrderCnt}},totDataColCnt:{get:function(){return this.layout.qHyperCube.qSize.qcx}},pseudoInLeftTree:{get:function(){return this.pseudoDimIndex<this.leftDimCnt}}}),a.provider("qvPivotTableMetaGhostHeadersProvider",function(){this.$get=[function(){return function(a,b,c){return new e(a,b,c)}}]})}),define("extensions.qliktech/pivot-table/meta/pivoting",["general.sortable/sortable-item-lists","translator"],function(a,b){var c;return c=a.extend("SortableMetaLists",{init:function(a,b,c,d,e,f,g){this._super.apply(this,[a]),this.layout=e,this.backendApi=b,this.grid=c,this.metaGhostHeaders=d,this.$id=f,this.currentPopover=g,this.rows=this.createList(),this.rows.templateSrc="pt-meta-list.ng.html",this.columns=this.createList(),this.columns.templateSrc="pt-meta-list.ng.html"},reset:function(){this._super.apply(this,arguments)},update:function(a,c,d,e){var f,g,h,i,j;for(this.reset(),f=0;f<this.sortOrderCnt;++f){if(g=this.sortOrder[f],f<this.leftDimCnt)h=this.rows;else{if(0>=d)continue;h=this.columns}-1!==g?(j=this.layout.qHyperCube.qDimensionInfo[g].qGroupFieldDefs[this.layout.qHyperCube.qDimensionInfo[g].qGroupPos],i=h.createItem({title:this.layout.qHyperCube.qDimensionInfo[g].qFallbackTitle,id:this.layout.qHyperCube.qDimensionInfo[g].cId,fieldName:j,style:{},qvaOutsideIgnoreFor:"qv-pt-meta-header-"+this.$id,open:this.currentPopover.header&&j===this.currentPopover.header.fieldName,dimIx:g})):i=h.createItem({title:b.get("Common.Measures"),dimIx:-1,isPseudoDim:!0,style:{}}),i.templateSrc="pt-meta-item.ng.html",f<this.leftDimCnt&&i.title.length+2>a&&(i.style.maxWidth=a*c-5,i.style.minWidth=0),f>=this.leftDimCnt&&1===d&&i.title.length>Math.floor(e/c)&&(i.style.maxWidth=Math.floor(e)-5,i.style.minWidth=0),h.addItem(i)}}}),Object.defineProperties(c.prototype,{sortOrder:{get:function(){return this.layout.qHyperCube.qEffectiveInterColumnSortOrder}},sortOrderCnt:{get:function(){return this.sortOrder.length}},leftDimCnt:{get:function(){return this.layout.qHyperCube.qNoOfLeftDims>=0?this.layout.qHyperCube.qNoOfLeftDims:this.sortOrderCnt}}}),c}),define("extensions.qliktech/pivot-table/meta/pivoting-provider",["qvangular","./pivoting"],function(a,b){function c(){this.$get=[function(){return function(a,c,d,e,f,g){return new(b.extend("PivotTableSortableMetaLists",{addPlaceholder:function(a,b){var c=this._super.apply(this,arguments);c.style.width=b.width,c.templateSrc="pt-meta-item.ng.html",a.dragging=!0},allowAutoScroll:function(){return!1},onBegin:function(){this._super.apply(this,arguments),this.toggleCellsWhenSorting(this.grid.headerRows,this.grid.rows,!0)},enable:function(){this._super.apply(this,arguments),this.toggleCellsWhenSorting(this.grid.headerRows,this.grid.rows,!1)},onMove:function(){this._super.apply(this,arguments),this.patchPivotingProperties()},onMoveToList:function(){this._super.apply(this,arguments),this.patchPivotingProperties()},onEnterList:function(a){a===this.rows&&a.isEmpty()&&this.metaGhostHeaders.update(2*this.metaGhostHeaders.opts.leftTree.emptyGlyphCnt),this._super.apply(this,arguments),a===this.columns&&this.rows.isEmpty()&&this.metaGhostHeaders.update(this.metaGhostHeaders.opts.leftTree.emptyGlyphCnt)},patchPivotingProperties:function(){var a,b=[];this.rows.items.forEach(function(a){b.push(a.dimIx)}),a=b.length,this.columns.items.forEach(function(a){b.push(a.dimIx)});var c=[[],!0];c[0][0]={qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:JSON.stringify(b)},c[0][1]={qPath:"/qHyperCubeDef/qNoOfLeftDims",qOp:"replace",qValue:JSON.stringify(a)},this.backendApi.applyPatches(c)},toggleCellsWhenSorting:function(){var a,b;for(a=arguments.length-1;a>=0;--a)if(Array.isArray(arguments[a])){var c,d,e,f,g=arguments[a];for(c=0;c<g.length;++c)for(e=g[c].cells.length,d=0;e>d;++d)f=g[c].cells[d],f[b?"addClass":"removeClass"](f.isMeta?"drop":"locked")}else b=arguments[a]}}))({listSelector:".meta",listKey:function(a){return a.find(".list").scope().list},itemSelector:".button-wrapper",itemDragSelector:".button-wrapper",itemKey:"header"},a,c,d,e,f,g)}}]}a.provider("qvPivotTablePivoting",c)}),define("extensions.qliktech/pivot-table/snapshot/snapshot-helper",[],function(){function a(a,b){var c=a[0].getBoundingClientRect();return b&&!b.freeResize?{height:b.size.h,width:b.size.w,top:c.top,left:c.left}:c}return{getSnapshotScrollAreaBBox:a}}),define("extensions.qliktech/pivot-table/viewport-provider",["qvangular","extensions.qliktech/pivot-table/snapshot/snapshot-helper"],function(a,b){function c(a,c,d,e,f,g,h,i){var j,k,l=c.find(e),m=l.find(f);return j={minRowHeight:d,rect:{left:0,top:0,width:0,height:0},scrollRect:{left:0,top:0,width:0,height:0},rowCount:0,getVirtualScrollController:function(){return l.controller("qvScrollArea")},getSortableListController:function(){return l.controller("qvSortableList")},getFirstDataCell:function(){var a=l.find(g);return a.length?a.position():{top:0,left:0}},getTopHeaders:function(){return l.find(h)},getScrollAreaBBox:function(){return i?b.getSnapshotScrollAreaBBox(l,i.object):l[0].getBoundingClientRect()},getScrollAreaPosition:function(){return l.position()},getScrollContentBBox:function(){return m[0].getBoundingClientRect()},updateRowCount:function(a){j.rowCount=Math.ceil(a)},getVisibleRowCount:function(){function a(a,b){var c=a.offsetTop+a.getBoundingClientRect().height,d=b.top+b.height;return d>=c}function b(c,d){var e=c.length,f=Math.floor(e/2),g=a(c[f],j.scrollRect);return 0===e||1===e&&!g?-1:1===e?d:(d+=g?f:0,c=g?c.splice(f):c.splice(0,f),b(c,d))}var d,e,f=c[0].querySelector(g);return f?(d=f.parentNode,e=Array.prototype.slice.call(d.parentNode.childNodes),e=e.filter(function(a){return a.nodeType===Node.ELEMENT_NODE}),e=e.splice(e.indexOf(d)),b(e,0)+1):0},updateRect:function(){return a.cancel(k),k=a(function(){var a=j.getScrollAreaBBox();j.rect.top=a.top,j.rect.left=a.left,j.rect.width=a.width,j.rect.height=a.height,j.updateRowCount(j.rect.height/d)})},updateScrollRect:function(){return a.cancel(k),k=a(function(){var a=j.getScrollAreaPosition(),b=j.getScrollContentBBox(),c=j.getFirstDataCell();j.scrollRect.top=a.top+c.top,j.scrollRect.left=c.left,j.scrollRect.width=j.rect.width-c.left,j.scrollRect.height=j.rect.height-c.top,b.height<j.rect.height&&(j.scrollRect.height=b.height-c.top),j.updateRowCount(j.collapsedRowCount||j.scrollRect.height/d),delete j.collapsedRowCount})}}}function d(a){return c.bind(null,a)}function e(){this.$get=["$timeout",d]}a.provider("qvPivotTableViewportProvider",e)}),define("extensions.qliktech/pivot-table/virtual-scroll-provider",["qvangular"],function(a){function b(a,b,c){var d,e,f=a.getVirtualScrollController(),g={active:!1,y:0};return e={page:{qLeft:0,qTop:0,qWidth:0,qHeight:0},equalsPage:function(a){return this.page.qLeft===a.qLeft&&this.page.qTop===a.qTop&&this.page.qWidth===a.qWidth&&this.page.qHeight===a.qHeight},setPage:function(a){this.page.qLeft=a.qLeft,this.page.qTop=a.qTop,this.page.qWidth=a.qWidth,this.page.qHeight=a.qHeight},onGetData:function(a){d=a},setVirtualSize:function(){var d=this;a.updateScrollRect().then(function(){var h,i,j,k,l=a.getVisibleRowCount(),m=f.getVirtualPosition();g.active=!1,a.scrollRect.top+a.scrollRect.height>=a.rect.height&&0===m.vPosY&&l<e.page.qHeight&&e.page.qHeight>=c.qcy&&(g.active=!0,g.y=0,a.updateRowCount(l)),h={vPosY:d.page.qTop,vPosX:d.page.qLeft*b.width},j=e.page.qWidth===c.qcx?a.scrollRect.width:c.qcx*b.width,i={width:j,height:c.qcy},k={width:a.scrollRect.width,height:a.rowCount},f.setVirtualSize(i,k,{left:a.scrollRect.left,top:a.scrollRect.top,width:a.scrollRect.width,height:a.rect.height-a.scrollRect.top}),(h.vPosY>0||h.vPosX>0)&&f.scroll(h.vPosX,h.vPosY)})}},f.onScroll(function(){var h,i=f.getVirtualPosition(),j=f.getMaxPosition(),k=b.cnt>0?Math.round(i.vPosX/b.width):0,l=Math.round(i.vPosY),m=b.cnt,n=a.rowCount;j.vPosY>0&&i.vPosY===j.vPosY?(n=a.getVisibleRowCount(),g.active||n===a.rowCount||(g.active=!0,g.y=i.vPosY)):g.active&&i.vPosY<g.y&&(g.active=!1,n=a.scrollRect.height/a.minRowHeight),n!==a.rowCount&&(a.updateRowCount(n),f.setVirtualViewport({width:a.scrollRect.width,height:a.rowCount})),l>0&&l+n>c.qcy&&(l=Math.max(0,c.qcy-n),n=Math.min(c.qcy,n)),k>0&&k+m>c.qcx&&(k=Math.max(0,c.qcx-m),m=Math.min(c.qcx,m)),h={qLeft:k,qTop:l,qWidth:m,qHeight:n},e.equalsPage(h)||(e.setPage(h),d(e.page))}),f.getScrollAmount=function(c,d,e){var g=f.getVirtualPosition(),h=f.getMaxPosition();switch(e){case 1:return{deltaX:b.width*c,deltaY:d};case 2:return{deltaX:b.cnt*b.width*c,deltaY:a.rowCount*d};case 10:return{deltaX:0,deltaY:d>0?g.vPosY*d:g.vPosY-h.vPosY};default:return{deltaX:c,deltaY:Math.floor(d/a.minRowHeight)}}},e}function c(){return b}function d(){this.$get=[c]}a.provider("qvPivotTableVirtualScrollProvider",d)}),define("extensions.qliktech/pivot-table/properties/pivot-data/pivot-data",["jquery","touche","client.property-panel/components/components","objects.error-handling/error-translation","translator","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover","general.services/show-service/show-service","general.utils/support","client.property-panel/popovers/type-popover","general.components/context-menu/context-menu-service","text!client.property-panel/components/common/data.ng.html","general.sortable/sortable-item-lists","extensions.qliktech/pivot-table/pivot-sorting-util","general.sortable/sortable-list"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={template:l,controller:["$scope","$element","$timeout",function(l,o,p){function q(a,b){var c=l.args.handler.createFieldDimension(a.value,"");l.args.handler.addDimension(c,b).then(function(a){F.put(G+a.qDef.cId,!0),l.$emit("saveProperties",l.data),v(),u(b?"rows":"columns")
})}function r(a,b){var c=l.args.handler.createLibraryDimension(a.libraryId);l.args.handler.addDimension(c,b).then(function(a){F.put(G+a.qDef.cId,!0),l.$emit("saveProperties",l.data),v(),u(b?"rows":"columns")})}function s(a){l.args.handler.addLibraryMeasure(a.libraryId).then(function(a){F.put(G+a.qDef.cId,!0),l.$emit("saveProperties",l.data),v(),u("measures")})}function t(a){l.args.handler.addExpressionMeasure(a.value,"").then(function(a){F.put(G+a.qDef.cId,!0),l.$emit("saveProperties",l.data),v(),u("measures")})}function u(a){p(function(){var b=o.find(".pp-toplist-content"),c=o.find("[tid='"+a+"'] .pp-data-list"),d=c.children().last();b[0].scrollTop=d[0].offsetTop-1},100)}function v(){K&&(K.destroy(),K=null)}function w(){var a=0,b=[],c=[];C.get().forEach(function(c){"empty-item"!==c.id&&(b.push(c.index),a++)}),D.get().forEach(function(a){"empty-item"!==a.id&&b.push(a.index)}),E.get().forEach(function(a){"empty-item"!==a.id&&c.push(a.index)}),l.data.qHyperCubeDef.qNoOfLeftDims=a,n.fixPivotHypercubeOrders(l.data.qHyperCubeDef),n.reorderPivotDimensions(l.data.qHyperCubeDef,b),n.reorderMeasures(l.data.qHyperCubeDef,c),l.$emit("saveProperties")}function x(){C.get().forEach(function(a){a.expanded=!1,F.put(G+a.id,!1)}),D.get().forEach(function(a){a.expanded=!1,F.put(G+a.id,!1)}),E.get().forEach(function(a){a.expanded=!1,F.put(G+a.id,!1)})}function y(c){I&&(I.destroy(),I=null),c&&a(c.target).hasClass("pp-toplist-add-button")&&b.preventGestures()}function z(a,b){y(),x(),K="rows"===a?h.show(f,{alignTo:b,position:"bottom",allowExpressionEditor:!0,closeAddPopover:v,addFieldDimension:q,addLibraryDimension:r}):"columns"===a?h.show(f,{alignTo:b,position:"bottom",allowExpressionEditor:!0,closeAddPopover:v,addFieldDimension:function(a){q(a,!0)},addLibraryDimension:function(a){r(a,!0)}}):h.show(g,{alignTo:b,position:"bottom",allowExpressionEditor:!0,closeAddPopover:v,addLibraryMeasure:s,addExpressionMeasure:t})}function A(b){var c=a(b.currentTarget);I=h.show(j,{items:[{translation:"Common.Row",tid:"row",select:function(){z("rows",c)},disabled:function(){return l.args.handler.getDimensions().length>=l.args.handler.maxDimensions()}},{translation:"Common.Column",tid:"column",select:function(){z("columns",c)},disabled:function(){return l.args.handler.getMeasures().length>=l.args.handler.maxMeasures()}},{translation:"Common.Measure",tid:"measure",select:function(){z("measures",c)},disabled:function(){return l.args.handler.getMeasures().length>=l.args.handler.maxMeasures()}}],closeTypeFoldout:y,alignTo:c})}function B(){var a=l.data.qHyperCubeDef.qNoOfLeftDims>=0?l.data.qHyperCubeDef.qNoOfLeftDims:l.data.qHyperCubeDef.qDimensions.length;l.sortableItemLists.reset(),l.data.qHyperCubeDef.qInterColumnSortOrder.forEach(function(b,c){var e,f=a>c?C:D;if(-1!==b){var g=l.data.qHyperCubeDef.qDimensions[b],h=g.qDef.cId;e=f.createItem({component:H,definition:l.definition.items.dimensions.items,data:g,args:l.args,id:h,index:b,type:"dimension",expanded:F.get(G+h)||!1,templateSrc:"pp-data-item.ng.html",markerClass:"pp-dimension",title:function(){var a=l.args.handler.getDimensionLayout(h);return a&&a.qError?d.getDimensionError(a.qError.qErrorCode,!0):g.qLibraryId?a&&a.title||"":a&&a.qFallbackTitle||""},typeFlag:1})}else-1===b&&(e=f.createItem({id:"pp-pseudo-item",templateSrc:"pp-pseudo-item.ng.html",index:-1}));f.addItem(e)}),l.data.qHyperCubeDef.qMeasures.forEach(function(a,b){var c=a.qDef.cId,e=E.createItem({component:H,definition:l.definition.items.measures.items,data:a,args:l.args,id:c,index:b,type:"measure",expanded:F.get(G+c)||!1,templateSrc:"pp-data-item.ng.html",markerClass:"pp-measure",title:function(){var a=l.args.handler.getMeasureLayout(c);return a&&a.qError?d.getMeasureError(a.qError.qErrorCode,!0):a&&a.qFallbackTitle||""},typeFlag:2});E.addItem(e)});var b;C.isEmpty()&&(b=C.createItem({id:"empty-item",templateSrc:"pp-empty-data-item.ng.html",index:-1}),C.addItem(b)),D.isEmpty()&&(b=D.createItem({id:"empty-item",templateSrc:"pp-empty-data-item.ng.html",index:-1}),D.addItem(b)),E.isEmpty()&&(b=E.createItem({id:"empty-item",templateSrc:"pp-empty-data-item.ng.html",index:-1}),E.addItem(b))}var C,D,E,F=l.args.cache,G="data_",H=c.getComponent("items"),I=null,J=null,K=null;l.sortableItemLists=m.create({options:{direction:"vertical",listKey:"list",listSelector:".pp-expandable-list",itemKey:"item",itemSelector:".qv-pp-sortable",itemDragSelector:".qv-pp-sortable-handle",gesture:{name:"swipe",options:{radiusThreshold:i.treatAsDesktop()?4:0,preventDefault:!1}}},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.templateSrc="pp-data-item.ng.html",a.classList.push("qv-pp-sortable")},onBegin:function(){this._super.apply(this,arguments),x()},onMove:function(){this._super.apply(this,arguments),w()},onMoveToList:function(){this._super.apply(this,arguments),w()}}),C=l.sortableItemLists.createList(1,{title:e.get("Common.Rows"),tid:"rows"}),D=l.sortableItemLists.createList(1,{title:e.get("Common.Columns"),tid:"columns"}),E=l.sortableItemLists.createList(2,{title:e.get("Common.Measures"),tid:"measures"}),l.addClicked=function(a){A(a)},l.getAddLabel=function(){return e.get(l.definition.addTranslation)},l.hasMultipleAddOptions=function(){return!0},l.openContextMenu=function(a,b){var c=k.menu();c.addItem({translation:"Common.Delete",tid:"delete",select:function(){l.removeItem(b)}}),J=k.show(c,{position:{x:a.pageX,y:a.pageY},docking:"Top"})},l.expandClicked=function(a,b){b.expanded=!b.expanded,F.put(G+b.id,b.expanded),a.stopPropagation()},l.removeItem=function(a){"measure"===a.type?l.args.handler.removeMeasure(a.index).then(function(){l.$emit("saveProperties")}):l.args.handler.removeDimension(a.index).then(function(){l.$emit("saveProperties")})},l.$watchCollection("data.qHyperCubeDef.qDimensions",B),l.$watchCollection("data.qHyperCubeDef.qMeasures",B),l.$watchCollection("data.qHyperCubeDef.qInterColumnSortOrder",B),l.$watch("data.qHyperCubeDef.qNoOfLeftDims",B),l.$on("$destroy",function(){y(),v(),J&&J.destroy()})}]};return c.addComponent("pivot-data",o),o}),define("text!extensions.qliktech/pivot-table/properties/pivot-sorting/pivot-sorting.ng.html",[],function(){return'<div class="pp-component pp-sorting-component" style="position:relative; height: 100%;" tcl="sorting">\n	<div ng-if="list.isEmpty()" class="pp-data-empty-hint">\n		<span q-translation="Common.NoData"></span>\n	</div>\n	<ul class="pp-expandable-list pp-data-list">\n		<li ng-repeat="item in list.items track by item.id" ng-include src="item.templateSrc"></li>\n	</ul>\n</div>'}),define("extensions.qliktech/pivot-table/properties/pivot-sorting/pivot-sorting",["client.property-panel/components/components","general.utils/property-resolver","objects.error-handling/error-translation","text!extensions.qliktech/pivot-table/properties/pivot-sorting/pivot-sorting.ng.html"],function(a,b,c,d){var e={template:d,controller:["$scope",function(d){function e(){d.list.items.splice(0,d.list.items.length);var e,h=d.definition.items.dimensions,i=b.getValue(d.data,"qHyperCubeDef.qDimensions",[]),j=i.map(function(b,e){var i="qHyperCubeDef.qDimensions"+e,j=b.qDef.cId;return{title:function(){var a=d.args.handler.getDimensionLayout(j);return a&&a.qError?c.getDimensionError(a.qError.qErrorCode,!0):b.qLibraryId?a&&a.title||"":a&&a.qFallbackTitle||""},isInvalid:function(){var a=d.args.handler.getDimensionLayout(j);return a&&!!a.qError},id:j,component:a.getComponent("items"),definition:h,data:b,args:d.args,expanded:f.get(g+i)||!1,sortable:!1,templateSrc:"pp-sorting-item.ng.html"}}),k=b.getValue(d.data,"qHyperCubeDef.qInterColumnSortOrder");e=k?k.map(function(a){return-1===a?null:j[a]}).filter(function(a){return!!a}):j,e.forEach(function(a,b){a.priority=b+1,d.list.items.push(a)})}var f=d.args.cache,g="sortable_";d.expandClicked=function(a,b){b.disabled||(b.expanded=!b.expanded,f.put(g+b.uiIndex,b.expanded))},d.list={isEmpty:function(){return!d.list.items.length},items:[]},Object.keys(d.definition.items).forEach(function(a){var b=d.definition.items[a];d.$watchCollection("data."+b.ref,function(){e()})}),d.$watchCollection("data."+d.definition.sortIndexRef,function(){e()})}]};return a.addComponent("pivot-sorting",e),e}),define("text!extensions.qliktech/pivot-table/pivot-panel/pivot-panel.ng.html",[],function(){return'<div class="qv-pivot-panel"\r\n	 qv-sortable-list="sortableItemLists">\r\n	<div class="qv-pivot-panel-row" ng-repeat="row in grid.rows">\r\n		<div class="qv-pivot-panel-column" ng-if="$first"></div>\r\n		<div ng-repeat="list in row.lists" class="qv-pivot-panel-column" ng-class="{\'qv-pivot-panel-disabled\': list.disabled}">\r\n			<h2>{{list.title}}</h2>\r\n			<div class="qv-pivot-panel-list">\r\n				<ul>\r\n					<li ng-repeat="item in list.items track by item.id" class="qv-pivot-panel-item" ng-class="item.classList" ng-include src="itemTemplateSrc"></li>\r\n				</ul>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("text!extensions.qliktech/pivot-table/pivot-panel/pivot-panel-item.ng.html",[],function(){return'<div class="field-wrapper field-token" ng-style="item.style">\r\n	<div ng-if="list.showMoveHandle" class="icon-handle"></div>\r\n	<div class="field-text">{{item.title}}</div>\r\n</div>\r\n'}),define("extensions.qliktech/pivot-table/pivot-panel/pivot-panel",["jquery","qvangular","text!./pivot-panel.ng.html","text!./pivot-panel-item.ng.html","ng!$templateCache","general.sortable/sortable-item-lists","translator","general.sortable/sortable-list"],function(a,b,c,d,e,f,g){var h={Dimension:"dimension",Measure:"measure",Pseudo:"pseudo"};e.put("pivot-panel-item.ng.html",d),b.directive("qvPivotPanel2",function(){return{restrict:"E",template:c,replace:!0,scope:{layout:"=layout",backendApi:"=backendApi"},controller:["$scope","$element",function(b,c){function d(a){var b;return b=a.qLibraryId?a.title||"":a.qFallbackTitle||""}function e(){var a,c=b.layout.qHyperCube.qNoOfLeftDims;b.sortableItemLists.reset(),a=b.layout.qHyperCube.qEffectiveInterColumnSortOrder.map(function(a){var c;return b.$broadcast("pivotPanelUpdated"),-1===a?{title:"Measures",cId:"pseudo-dimension",type:h.Pseudo,dimIndex:a,cssClass:["sortable","is-pseudo"]}:(c=b.layout.qHyperCube.qDimensionInfo[a],{title:d(c),cId:c.cId,type:h.Dimension,dimIndex:a,cssClass:["sortable"]})}),c=0>c?a.length:c,a.splice(0,c).forEach(function(a){var c=b.rows.add(a.title,a.cId,a.cssClass,1);c.dimIndex=a.dimIndex}),a.forEach(function(a){var c=b.columns.add(a.title,a.cId,a.cssClass,1);c.dimIndex=a.dimIndex}),b.layout.qHyperCube.qMeasureInfo.forEach(function(a){b.measures.add(a.qFallbackTitle||"",a.cId,[],2)})}var i=this;b.itemTemplateSrc="pivot-panel-item.ng.html",b.sortableItemLists=f.create({options:{listKey:"list",listSelector:".qv-pivot-panel-column",itemSelector:".sortable",itemDragSelector:".icon-handle",itemKey:"item"},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.addClass("sortable")},bindAutoScroll:function(){var b=c.find(".qv-pivot-panel-list ul");b.each(function(){var b=a(this),c=b.scope().list;c.scrollInfo={elem:b[0],clientRect:b[0].getBoundingClientRect(),scrollWidth:b[0].scrollWidth,scrollHeight:b[0].scrollHeight}})},onBegin:function(){this._super.apply(this,arguments),this.bindAutoScroll()},onEnterList:function(){this.bindAutoScroll()},onMove:function(){this._super.apply(this,arguments),i.sortOrderUpdated()},onMoveToList:function(a,b){this._super.apply(this,arguments),b.disabled||i.sortOrderUpdated()},onAutoScroll:function(a,b,c,d){if(this._super.apply(this,arguments),!b&&c&&(b=this.getList(c)),b){var e=b.scrollInfo;d(e.elem,e.clientRect,e.scrollWidth,e.scrollHeight)}}}),b.columns=b.sortableItemLists.createList(1,{title:g.get("Common.Columns"),showMoveHandle:!0}),b.rows=b.sortableItemLists.createList(1,{title:g.get("Common.Rows"),showMoveHandle:!0}),b.measures=b.sortableItemLists.createList(2,{title:g.get("Common.Measures")}),b.grid={rows:[]},b.grid.rows.push({lists:[b.columns]}),b.grid.rows.push({lists:[b.rows,b.measures]}),i.sortOrderUpdated=function(){var a,c=[];b.rows.items.forEach(function(a){c.push(a.dimIndex)}),a=c.length,b.columns.items.forEach(function(a){c.push(a.dimIndex)});var d=[[],!0];d[0][0]={qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:JSON.stringify(c)},d[0][1]={qPath:"/qHyperCubeDef/qNoOfLeftDims",qOp:"replace",qValue:JSON.stringify(a)},b.backendApi.applyPatches(d)},b.$watchCollection("layout.qHyperCube.qDimensionInfo",e),b.$watchCollection("layout.qHyperCube.qEffectiveInterColumnSortOrder",e),b.$watchCollection("layout.qHyperCube.qMeasureInfo",e),b.$watchCollection("layout.qHyperCube.qNoOfLeftDims",e)}]}})}),define("extensions.qliktech/pivot-table/pivot-table",["qvangular","jquery","objects.backend-api/pivot-api","extensions.qliktech/pivot-table/pivot-table-properties","extensions.qliktech/pivot-table/pivot-hypercube-handler","objects.extension/object-conversion","general.utils/property-mapper","text!./pivot-table.ng.html","text!./cell-item.ng.html","text!./header-cell-item.ng.html","text!./meta/meta-left.ng.html","text!./meta/meta-top.ng.html","text!./meta/meta-list.ng.html","text!./meta/meta-item.ng.html","ng!$templateCache","objects.grid/data-grid-provider","./meta/ghost-headers-provider","./meta/pivoting-provider","./viewport-provider","./virtual-scroll-provider","general.scroll/scroll-area","objects.grid/services/data-service","extensions.qliktech/pivot-table/properties/pivot-data/pivot-data","extensions.qliktech/pivot-table/properties/pivot-sorting/pivot-sorting","objects.grid/services/selections","extensions.qliktech/pivot-table/pivot-panel/pivot-panel"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a,c,d,e,f,g,i){function j(h,j,k,l){var m,n;h.currentPopover={header:void 0},h.nonMouseViewportScrolling={scrollbarSize:36,className:"show-non-mouse-scrollbars"},h.grid=a("pivot"),h.viewport=g(j,21,".qv-grid-object-scroll-area",".scroll-content",".first-data-cell","th.top:nth-child(2)",h.layout.snapshotData),m=h.viewport.getVirtualScrollController(),n=h.viewport.getSortableListController(),h.metaGhostHeaders=f({},h.layout,h.viewport.rect),h.pivoting=e(h.backendApi,h.grid,h.metaGhostHeaders,h.layout,h.$id,h.currentPopover),h.virtualScroll=i(h.viewport,h.metaGhostHeaders.dataColumnsInfo,h.layout.qHyperCube.qSize),h.virtualScroll.onGetData(function(a){h.getData(a,!0)}),h.getData=function(a,b){return h.backendApi.getData([a]).then(function(c){return h.onUpdateData(c,a,b)})},h.onUpdateData=function(a,b,d){return c.updatePivotItems(h,a,[b],d),{dataPages:a,dataRect:b}},h.process=function(a){return h.virtualScroll.setPage(a),h.getData(a).then(function(){h.virtualScroll.setVirtualSize()})},h.processPaint=function(){h.updateMetaInfo().then(function(a){var b=h.layout.qHyperCube.qLastExpandedPos,c=b&&void 0!==h.expandedPosDiffX&&void 0!==h.expandedPosDiffY,d={qLeft:Math.max(0,c?b.qx-h.expandedPosDiffX:0),qTop:Math.max(0,c?b.qy-h.expandedPosDiffY:0),qWidth:a.qWidth,qHeight:a.qHeight};if(b&&d.qLeft+d.qWidth>h.layout.qHyperCube.qSize.qcx&&(d.qLeft=Math.max(0,h.layout.qHyperCube.qSize.qcx-a.qWidth)),b&&h.collapsed&&d.qTop+d.qHeight>h.layout.qHyperCube.qSize.qcy){var e=h.viewport.getVisibleRowCount();h.viewport.collapsedRowCount=e,d.qTop=Math.max(0,h.layout.qHyperCube.qSize.qcy-e),d.qHeight=e}return delete h.expandedPosDiffX,delete h.expandedPosDiffY,delete h.collapsed,h.process(d)})},h.processResize=function(){return h.updateMetaInfo().then(function(a){var b=h.layout.qHyperCube.qSize,c={qLeft:h.virtualScroll.page.qLeft,qTop:h.virtualScroll.page.qTop,qWidth:a.qWidth,qHeight:a.qHeight};return c.qTop+c.qHeight>b.qcy&&(c.qTop=Math.max(0,b.qcy-c.qHeight)),c.qLeft+c.qWidth>b.qcx&&(c.qLeft=Math.max(0,b.qcx-c.qWidth)),h.process(c)})},h.updateMetaInfo=function(){return h.viewport.updateRect().then(function(){return h.metaGhostHeaders.update(0,c.getLeftTreeDepth(h.layout.qHyperCube.qPivotDataPages[0])),h.pivoting.update(h.metaGhostHeaders.totLeftGlyphCnt,h.metaGhostHeaders.opts.glyphWidth,h.metaGhostHeaders.dataColumnsInfo.cnt,h.metaGhostHeaders.dataColumnsInfo.width),{qWidth:h.metaGhostHeaders.dataColumnsInfo.cnt,qHeight:h.viewport.rowCount}})},h.collapseExpand=function(a){var c,d=b(a.target);c=d.scope().cell,c&&(h.expandedPosDiffX=c.dataColIx-h.virtualScroll.page.qLeft,h.expandedPosDiffY=c.dataRowIx-h.virtualScroll.page.qTop,"icon-add"===c.collapseExpandClass?c.hasClass("top")?h.backendApi.expandTop(c.dataRowIx,c.dataColIx,!1):c.hasClass("left")&&h.backendApi.expandLeft(c.dataRowIx,c.dataColIx,!1):"icon-remove"===c.collapseExpandClass&&(h.collapsed=!0,c.hasClass("top")?h.backendApi.collapseTop(c.dataRowIx,c.dataColIx,!1):c.hasClass("left")&&h.backendApi.collapseLeft(c.dataRowIx,c.dataColIx,!1)))},h.showDimension=function(a,c){var e=b(a.target).closest("button");return n.off(),h.currentPopover.header===c?(c.open=!1,h.currentPopover.header=void 0,void d.close()):(h.currentPopover.header&&(h.currentPopover.header.open=!1,h.currentPopover.header=void 0),d.showField(c.fieldName,{$alignToElement:e,qvaOutsideIgnoreFor:"qv-pt-meta-header-"+h.$id,collision:"flipfit"},null,function(){h.currentPopover.header=void 0,h.updateMetaInfo(),n.on()}),c.open=!0,void(h.currentPopover.header=c))},l.addChildController({onStateChanged:function(a){this.allowInteraction(a)?(m.on(),n.on(),h.interactive=!0):(m.off(),n.off(),h.interactive=!1)},onPaint:function(){n.cancel(),h.processPaint()},onResize:function(){h.processResize()},setSnapshotData:function(a){var b=h.virtualScroll.page;return h.backendApi.getData([b]).then(function(c){return h.backendApi.isSnapshot||(c[0].qArea.qTop=0,c[0].qArea.qLeft=0,a.qHyperCube.qSize.qcx=b.qWidth,a.qHyperCube.qSize.qcy=b.qHeight),a.qHyperCube.qPivotDataPages=c,a})}},h)}return{restrict:"E",replace:!0,template:h,require:"^qvObject",link:j}}return o.put("pt-cell-item.ng.html",i),o.put("pt-header-cell-item.ng.html",j),o.put("pt-meta-left.ng.html",k),o.put("pt-meta-top.ng.html",l),o.put("pt-meta-list.ng.html",m),o.put("pt-meta-item.ng.html",n),a.directive("qvPivotTable",["qvDataGrid","qvGridObjectDataService","qvListboxPopoverService","qvPivotTablePivoting","qvPivotTableMetaGhostHeadersProvider","qvPivotTableViewportProvider","qvPivotTableVirtualScrollProvider",p]),{initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0,qMode:"P",qShowTotalsAbove:!0,qInitialDataFetch:[{qTop:0,qLeft:0,qWidth:50,qHeight:50}],qIndentMode:!0}},data:{dimensions:{min:1,max:1e3},measures:{min:1,max:1e3}},getCreatePropertyHandler:function(){var a=this;if(!a.propertyHandler){var b=g.mapProperties(a.mappedDefinition.items.data.items.dimensions),c=g.mapProperties(a.mappedDefinition.items.data.items.measures);a.propertyHandler=new e(a.dimensionDefinition,a.measureDefinition,b,c)}return a.propertyHandler},snapshot:{canTakeSnapshot:!0},type:"pivot-table",template:"<qv-pivot-table></qv-pivot-table>",BackendApi:c,definition:d,importProperties:f.pivotChart.importProperties.bind(f),exportProperties:f.pivotChart.exportProperties.bind(f)}});